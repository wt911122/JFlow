(function(t){function e(e){for(var r,a,c=e[0],u=e[1],s=e[2],f=0,h=[];f<c.length;f++)a=c[f],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&h.push(o[a][0]),o[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);l&&l(e);while(h.length)h.shift()();return i.push.apply(i,s||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],r=!0,c=1;c<n.length;c++){var u=n[c];0!==o[u]&&(r=!1)}r&&(i.splice(e--,1),t=a(a.s=n[0]))}return t}var r={},o={app:0},i=[];function a(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=r,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(n,r,function(e){return t[e]}.bind(null,r));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=e,c=c.slice();for(var s=0;s<c.length;s++)e(c[s]);var l=u;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=n("9018"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.$style.body,attrs:{id:"app"}},[n("div",{class:t.$style.sidebar},[n("div",[n("div",{class:t.$style.part,attrs:{draggable:"true",type:"IfStatement"},on:{dragstart:t.onDragStartRectangle}},[t._v("IfStatement")])]),n("div",[n("div",{class:t.$style.part,attrs:{draggable:"true",type:"variable"},on:{dragstart:t.onDragStartPoint}},[t._v("Variable")])])]),n("div",{staticStyle:{position:"relative"}},[n("j-jflow",{ref:"jflow",class:t.$style.wrapper,attrs:{configs:t.configs},on:{click:t.onClickNoWhere,drop:t.onDrop,pressEnd:t.onPressEnd},scopedSlots:t._u([{key:"start",fn:function(t){var e=t.configs;return[n("j-start",{attrs:{node:e}})]}},{key:"end",fn:function(t){var e=t.configs;return[n("j-end",{attrs:{node:e}})]}},{key:"variable",fn:function(e){var r=e.configs,o=e.meta;return[n("j-variable",{attrs:{node:r},on:{pressStart:function(e){return t.onPressStart(r)},outOfFlow:function(e){return t.onOutOfFlow(e,o)},change:function(e){return t.onChangeContent(e,r)}}})]}},{key:"IfStatement",fn:function(e){var r=e.configs,o=e.meta;return[n("j-ifstatement",{attrs:{node:r},on:{pressStart:function(e){return t.onPressStart(r)},outOfFlow:function(e){return t.onOutOfFlow(e,o)}}})]}},{key:"SwitchStatement",fn:function(e){var r=e.configs,o=e.meta;return[n("j-switch",{attrs:{node:r},on:{pressStart:function(e){return t.onPressStart(r)},outOfFlow:function(e){return t.onOutOfFlow(e,o)}}})]}},{key:"WhileStatement",fn:function(e){var r=e.configs,o=e.meta;return[n("j-whilestatement",{attrs:{node:r},on:{pressStart:function(e){return t.onPressStart(r)},outOfFlow:function(e){return t.onOutOfFlow(e,o)}}})]}},{key:"endpoint",fn:function(t){var e=t.configs;return[n("j-endpoint",{attrs:{node:e}})]}},{key:"CallLogic",fn:function(e){var r=e.configs,o=e.meta;return[n("j-calllogic",{attrs:{node:r},on:{"toggle-select":function(e){return t.onToggleSelect(e,r)},pressStart:function(e){return t.onPressStart(r)},outOfFlow:function(e){return t.onOutOfFlow(e,o)}}})]}},{key:"plainlink",fn:function(e){var r=e.configs;return[n("instance-link",{attrs:{linkConfigs:r},on:{drop:function(e){return t.onDropToLink(e,r)}}})]}}])}),t.isHover?n("div",{ref:"hoverblock",class:t.$style.hoverblock,style:"transform: translate("+t.offsetX+"px, "+t.offsetY+"px)"},[n("ul",t._l(t.logics,(function(e){return n("li",{key:e.content,on:{click:function(n){return t.onSelectLogic(e)}}},[t._v(t._s(e.content))])})),0)]):t._e()],1),n("div",{class:t.$style.ast},[n("pre",{domProps:{innerHTML:t._s(t.prettyJson(t.ast))}})])])},a=[],c=n("3835"),u=(n("53ca"),n("d3b7"),n("b64b"),n("99af"),n("a15b"),n("4de4"),n("a434"),n("18a5"),n("68ca")),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("j-diamond-group",t._g({attrs:{jflowId:t.node.id,configs:t.groupConfig}},t.$listeners),[n("j-text",{attrs:{configs:{fontSize:"12px",textColor:"#585c63",content:t.node.content,lineHeight:26,editable:!0}},on:{change:t.onContentChange}})],1)},l=[],f={props:{node:Object},computed:{groupConfig:function(){return{layout:new o["LinearLayout"]({direction:"horizontal",gap:0}),borderColor:"#517cff",borderWidth:2,borderRadius:5,padding:10}}},methods:{onContentChange:function(t){console.log(t.detail),this.$emit("change",{val:t.detail.val,oldVal:t.detail.oldVal})}}},h=f,p=n("2877"),d=Object(p["a"])(h,s,l,!1,null,null,null),y=d.exports,v=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("j-rhombus-group",t._g({attrs:{jflowId:t.node.id,configs:t.groupConfig},on:{mouseenter:function(e){t.touch=!0},mouseleave:function(e){t.touch=!1}}},t.$listeners),[n("j-point",{attrs:{configs:{backgroundColor:"#99DBC5",radius:8,borderColor:"#33B88C",borderWidth:2,absolutePosition:{top:2,right:10}}},on:{click:function(e){t.shrink=!t.shrink}}}),n("j-group",[t.shrink?n("j-text",{attrs:{configs:{fontSize:"12px",textColor:"#585c63",content:"ifstatement "+t.node.id,lineHeight:26,indent:10}}}):n("j-rectangle",{attrs:{configs:{backgroundColor:"#FAAAAA",width:36,height:72}}})],1)],1)},g=[],b={props:{node:Object},inject:["renderJFlow"],data:function(){return{touch:!1,shrinkButton:{backgroundColor:"#99DBC5",radius:20,borderColor:"#33B88C"},shrink:!1}},computed:{groupConfig:function(){return{layout:new o["LinearLayout"]({direction:"horizontal",gap:0}),borderColor:"#517cff",backgroundColor:this.touch?"red":"#fff",shadowColor:"#517cff",shadowBlur:15,borderWidth:2,borderRadius:5,padding:30}}},watch:{touch:function(t){console.log(t)}},updated:function(){this.renderJFlow()}},m=b,w=Object(p["a"])(m,v,g,!1,null,null,null),_=w.exports,k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("j-group",{attrs:{jflowId:t.node.id,configs:t.configs}},[n("j-text",{ref:"start",attrs:{configs:{fontSize:"12px",textColor:"#000",content:"Start"}}}),n("j-point",{attrs:{configs:{backgroundColor:"#99DBC5",radius:20,borderColor:"#33B88C",borderWidth:2,shadowBlur:8,shadowColor:"rgba(0, 0, 0, 0.1)",shadowOffsetY:2,shadowOffsetX:0}}})],1)},O=[],j={props:{node:Object},data:function(){return{configs:{layout:new o["LinearLayout"]({direction:"vertical",gap:10}),borderColor:"transparent",borderWidth:0}}}},x=j,S=Object(p["a"])(x,k,O,!1,null,null,null),P=S.exports,T=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("j-group",{attrs:{jflowId:t.node.id,configs:t.configs}},[n("j-text",{attrs:{configs:{fontSize:"12px",textColor:"#000",content:"End"}}}),n("j-rectangle",{attrs:{configs:{backgroundColor:"#FAAAAA",width:36,height:36,borderRadius:8,borderWidth:2,borderColor:"#F55656",shadowBlur:8,shadowColor:"rgba(0, 0, 0, 0.1)",shadowOffsetY:2,shadowOffsetX:0}}})],1)},E=[],C={props:{node:Object},data:function(){return{configs:{layout:new o["LinearLayout"]({direction:"vertical",gap:0}),borderColor:"transparent",borderWidth:0}}}},R=C,I=Object(p["a"])(R,T,E,!1,null,null,null),D=I.exports,M=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("j-point",{attrs:{jflowId:t.node.id,configs:{backgroundColor:"#fff",borderColor:"#000",borderWidth:1,radius:5,ignoreHit:!0}}})},B=[],L={props:{node:Object}},A=L,z=Object(p["a"])(A,M,B,!1,null,null,null),F=z.exports,H=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("j-capsule-vertical-group",t._g({attrs:{jflowId:t.node.id,configs:t.configs}},t.$listeners),[n("j-text",{attrs:{configs:{fontSize:"12px",textColor:t.textColor,content:t.node.id}}}),t._l(t.node.cases,(function(t){return[n("j-switchcase",{key:t.id,attrs:{node:t}})]}))],2)},W=[],G=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("j-diamond-group",t._g({attrs:{jflowId:t.node.id,configs:t.groupConfig,rootLink:!0}},t.$listeners),[n("j-text",{attrs:{configs:{fontSize:"12px",textColor:"#585c63",content:t.node.content,lineHeight:26}}})],1)},Y=[],$={props:{node:Object},computed:{groupConfig:function(){return{layout:new o["LinearLayout"]({direction:"horizontal",gap:0}),borderColor:"#517cff",paddingTop:2,paddingBottom:2,padding:10,borderWidth:2,borderRadius:5}}}},X=$,q=Object(p["a"])(X,G,Y,!1,null,null,null),N=q.exports,J={components:{"j-switchcase":N},props:{node:Object},data:function(){return{textColor:"#585c63",configs:{layout:new o["LinearLayout"]({direction:"vertical",gap:10}),borderColor:"#517cff",borderWidth:2,borderRadius:5,paddingTop:20,paddingBottom:20}}}},U=J,Z=Object(p["a"])(U,H,W,!1,null,null,null),V=Z.exports,K=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("j-rhombus-group",t._g({attrs:{jflowId:t.node.id,configs:t.groupConfig}},t.$listeners),[n("j-text",{attrs:{configs:{fontSize:"12px",textColor:"#585c63",content:t.node.content,lineHeight:26,indent:10}}})],1)},Q=[],tt={props:{node:Object},computed:{groupConfig:function(){return{layout:new o["LinearLayout"]({direction:"horizontal",gap:0}),borderColor:"#517cff",borderWidth:2,borderRadius:5,padding:30}}}},et=tt,nt=Object(p["a"])(et,K,Q,!1,null,null,null),rt=nt.exports,ot=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("j-group",t._g({attrs:{jflowId:t.node.id,configs:t.configs}},t.$listeners),[n("j-group",{attrs:{configs:t.headerConfigs}},[n("j-icon",{attrs:{configs:t.imageConfig}}),n("j-text",{attrs:{configs:{fontSize:"16px",textColor:"#585c63",content:"调用逻辑"}}})],1),n("j-group",{attrs:{configs:t.contentConfigs},on:{click:t.onClick}},[n("j-text",{attrs:{configs:{fontSize:"12px",textColor:"#585c63",content:t.node.content||"请选择接口"}}})],1),t.node.params&&t.node.params.length?[n("j-group",{ref:"paramGroup",attrs:{configs:t.paramsConfigs}},[n("j-text",{attrs:{configs:{fontSize:"16px",textColor:"#585c63",content:"参数"}}}),t._l(t.node.params,(function(t){return n("j-text",{key:t.content,attrs:{configs:{fontSize:"16px",textColor:"#585c63",content:t.content}}})}))],2)]:t._e()],2)},it=[],at=n("8896"),ct=n.n(at),ut=new Image;ut.src=ct.a;var st={props:{node:Object},data:function(){return{configs:{layout:new o["LinearLayout"]({direction:"vertical",gap:0,alignment:"start"}),padding:10,borderColor:"#517cff",borderWidth:2,borderRadius:12},headerConfigs:{layout:new o["LinearLayout"]({direction:"horizontal",gap:0}),borderRadius:10,borderColor:"#ccc",borderWidth:0},contentConfigs:{layout:new o["LinearLayout"]({direction:"horizontal",gap:0,justify:"start"}),borderColor:"#517cff",borderWidth:2,borderRadius:5,width:200,height:36},paramsConfigs:{layout:new o["LinearLayout"]({direction:"vertical",gap:0,alignment:"end"}),borderColor:"transparent",hoverStyle:"transparent"},imageConfig:{image:ut,width:30,height:30}}},watch:{"node.params":function(t){var e=this;this.$nextTick((function(){if(e.$refs.paramGroup){var t=e.$refs.paramGroup._jflowInstance;t.recalculateUp(),t._jflow._render()}}))}},methods:{onClick:function(t){console.log(t),t.detail.bubbles=!1;var e=t.currentTarget,n=[-e.width/2,e.height/2];console.log(n);var r=e.calculateToRealWorld(n);this.$emit("toggle-select",r)}}},lt=st,ft=Object(p["a"])(lt,ot,it,!1,null,null,null),ht=ft.exports,pt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("jPolyLink",{attrs:{configs:t.configs,from:t.configs.from,to:t.configs.to},on:{dragover:t.onDragOver,dragoverend:t.onDragOverEnd,drop:t.onDropToLink}})},dt=[],yt=n("5530"),vt={props:{linkConfigs:Object},data:function(){return{isDragOver:!1}},computed:{configs:function(){return Object(yt["a"])(Object(yt["a"])({},this.linkConfigs),{},{radius:5,approximate:400,backgroundColor:this.isDragOver?"rgba(81, 124, 255, 0.5)":"#000"})}},methods:{onDropToLink:function(t){this.$emit("drop",t)},onDragOver:function(t){this.isDragOver=!0},onDragOverEnd:function(){this.isDragOver=!1}}},gt=vt,bt=Object(p["a"])(gt,pt,dt,!1,null,null,null),mt=bt.exports;console.log(o["commonEventAdapter"]);var wt=0,_t={components:{"j-variable":y,"j-start":P,"j-end":D,"j-endpoint":F,"j-switch":V,"j-ifstatement":_,"j-whilestatement":rt,"j-calllogic":ht,instanceLink:mt},provide:function(){return{renderJFlow:this.renderJFlow}},data:function(){var t={type:"Root",body:[{type:"start",id:"start"},{type:"IfStatement",content:"aaaa",id:"logic1",consequent:[{type:"variable",content:"vvvkjhkjhvvvv",id:"logic5"}],alternate:[{type:"IfStatement",content:"ggggggg",id:"logic6",consequent:[{type:"variable",content:"jkhvvvv",id:"logic77"}],alternate:[{type:"variable",content:"yuuo",id:"logic88"}]},{type:"CallLogic",id:"CallLogic1",content:"",params:[]}]},{type:"SwitchStatement",id:"swtch1",cases:[{type:"SwitchCase",id:"switchcase11",content:"switchcase11",alternate:[{type:"variable",content:"yuuo",id:"sc1111122"}]},{type:"SwitchCase",id:"switchcase12",content:"switchcase12",alternate:[{type:"variable",content:"asdfag",id:"sc12344455"}],consequent:[{type:"variable",content:"dfhsdfg",id:"sc125444"}]}]},{type:"WhileStatement",id:"while1",content:"while1",body:[]},{type:"end",id:"end"}],playground:[]},e=new o["Lowcodelayout"]({linkLength:30,ast:t});return{ast:t,configs:{allowDrop:!0,layout:e,initialZoom:1},isHover:!1,offsetX:0,offsetY:0,currentTarget:null,prepareBody:[],logics:[{content:"aaa",params:[{content:"p1"}]},{content:"vvvv",params:[{content:"p1"},{content:"p2"}]},{content:"sadasdf",params:[{content:"p1"}]},{content:"ggggg",params:[{content:"p1"},{content:"p2"},{content:"p3"}]}],currentEditingTarget:null}},computed:{inflowInstances:function(){return this.ast.body.filter((function(t){return!t.outflow}))}},mounted:function(){console.log(this.$refs.jflow.getInstance())},methods:{prettyJson:function(){return u["a"].toHtml(this.ast)},onDragStartRectangle:function(){var t=this.$refs.jflow.getInstance();t.sendMessage({instance:{type:"IfStatement",content:"IfStatement-rec".concat(wt++),id:"IfStatement-rec".concat(wt++),consequent:[],alternate:[]}})},onDragStartPoint:function(){var t=this.$refs.jflow.getInstance();t.sendMessage({instance:{type:"variable",content:"vvvvvvdasdfasfd",id:"logic-point".concat(wt++)}})},onOutOfFlow:function(t,e){var n=e.parentIterateType,r=e.idx,o=e.parent.source[n].splice(r,1),i=Object(c["a"])(o,1),a=i[0];this.ast.playground.push(a),this.configs.layout.reOrder(this.ast),this.$refs.jflow.reflow(),e.getJflowInstance().anchor=t.detail.point},onDrop:function(t){var e=this,n=t.detail.instance;this.ast.playground.push(n),this.configs.layout.reOrder(this.ast),this.$refs.jflow.reflow((function(){var r=e.configs.layout.findLayoutNode(n);r&&(r.getJflowInstance().anchor=t.detail.point)}))},onClick:function(t){var e=t.currentTarget,n=[0,e.height/2],r=e.calculateToRealWorld(n),o=Object(c["a"])(r,2),i=o[0],a=o[1];this.isHover=!this.isHover,this.offsetX=i,this.offsetY=a},onPressStart:function(t){console.log("pressStart"),console.log(t),this.currentTarget=t},onPressEnd:function(){console.log("pressEnd"),this.currentTarget=null},onDropToLink:function(t,e){console.log(t,e);var n=t.detail.instance;this.currentTarget&&(n.removeFromLayoutSource(),n=this.currentTarget),e.meta.from.linkSource(n,e),this.configs.layout.reOrder(this.ast),this.$refs.jflow.reflow()},onToggleSelect:function(t,e){var n=Object(c["a"])(t,2),r=n[0],o=n[1];this.offsetX=r,this.offsetY=o,this.isHover=!this.isHover,this.isHover?this.currentEditingTarget=e:this.currentEditingTarget=null},onSelectLogic:function(t){this.isHover=!1,console.log(this.currentEditingTarget),this.currentEditingTarget.content=t.content,this.currentEditingTarget.params=t.params},onClickNoWhere:function(){this.isHover=!1,this.currentEditingTarget=null},onChangeContent:function(t,e){e.content=t.val},renderJFlow:function(){this.$refs.jflow.renderJFlow()}}},kt=_t,Ot=n("5bb9");function jt(t){this["$style"]=Ot["default"].locals||Ot["default"]}var xt=Object(p["a"])(kt,i,a,!1,jt,null,null),St=xt.exports;r["a"].config.productionTip=!1,r["a"].use(o["JFlowVuePlugin"]),new r["a"]({render:function(t){return t(St)}}).$mount("#app")},"5bb9":function(t,e,n){"use strict";var r=n("a7d4"),o=n.n(r);n.d(e,"default",(function(){return o.a}))},8896:function(t,e,n){t.exports=n.p+"img/logic.17805d7a.svg"},9018:function(e,n,r){(function(e){var o,i,a,c=r("448a").default,u=r("970b").default,s=r("5bc3").default,l=r("7037").default;r("fb6a"),r("b64b"),r("a4d3"),r("e01a"),r("d3b7"),r("944a"),r("0c47"),r("23dc"),r("aff5"),r("a9e3"),r("e6e1"),r("e9c4"),r("a434"),r("a15b"),r("d81d"),r("159b"),r("99af"),r("4de4"),r("ac1f"),r("1276"),r("25f0"),r("a630"),r("3ca3"),r("4e82"),r("ddb0"),r("4ae1"),r("f8c9"),r("d28b"),r("b0c0"),r("00b4"),r("caad"),r("2532"),r("4ec9"),r("3410"),r("18a5"),r("9911"),r("c740"),r("e439"),r("dbb4"),r("cb29"),r("7db0"),r("07ac"),function(t,r){"object"==l(n)&&"object"==l(e)?e.exports=r():(i=[],o=r,a="function"===typeof o?o.apply(n,i):o,void 0===a||(e.exports=a))}(self,(function(){return function(){"use strict";var e={359:function(t){function e(){return n(null,[].slice.call(arguments,0))}function n(t,e){for(var n,o,i,a,c,u=e.length,s=e[0],l={},f=t&&t.equal||r,h=1;h<u;h++)for(n=e[h],i=(o=Object.keys(n)).length,c=0;c<i;c++)f(n[a=o[c]],s[a])||(l[a]=n[a]);return l}function r(t,e){return t===e}e.custom=function(t){return n(t,[].slice.call(arguments,1))},t.exports=e}},n={};function r(t){var o=n[t];if(void 0!==o)return o.exports;var i=n[t]={exports:{}};return e[t](i,i.exports,r),i.exports}r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,{a:e}),e},r.d=function(t,e){for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return function(){r.r(o),r.d(o,{BaseLink:function(){return ie},BezierLink:function(){return qr},Capsule:function(){return Ve},CapsuleGroup:function(){return on},CapsuleVerticalGroup:function(){return dn},Diamond:function(){return xn},DiamondGroup:function(){return Dn},DiamondVerticalGroup:function(){return Wn},ERLayout:function(){return Co},Group:function(){return He},Icon:function(){return mr},Instance:function(){return jt},JFlowEvent:function(){return Ft},JFlowVuePlugin:function(){return ri},LinearLayout:function(){return Zr},Link:function(){return Pr},Lowcodelayout:function(){return _o},Node:function(){return Kt},Point:function(){return ye},PolyLink:function(){return Br},Rectangle:function(){return Se},Rhombus:function(){return Vn},RhombusGroup:function(){return or},Text:function(){return pr},commonEventAdapter:function(){return $t},default:function(){return oi}});var e={};r.r(e),r.d(e,{BaseLink:function(){return ie},BezierLink:function(){return qr},Capsule:function(){return Ve},CapsuleGroup:function(){return on},CapsuleVerticalGroup:function(){return dn},Diamond:function(){return xn},DiamondGroup:function(){return Dn},DiamondVerticalGroup:function(){return Wn},ERLayout:function(){return Co},Group:function(){return He},Icon:function(){return mr},Instance:function(){return jt},JFlowEvent:function(){return Ft},LinearLayout:function(){return Zr},Link:function(){return Pr},Lowcodelayout:function(){return _o},Node:function(){return Kt},Point:function(){return ye},PolyLink:function(){return Br},Rectangle:function(){return Se},Rhombus:function(){return Vn},RhombusGroup:function(){return or},Text:function(){return pr},commonEventAdapter:function(){return $t},default:function(){return Ho}});var n=document.createElement("canvas");n.width=1,n.height=1;var i=n.getContext("2d"),a=window.devicePixelRatio;function f(t){i.clearRect(0,0,5,5),i.save(),t(i),i.restore(),i.clearRect(0,0,5,5)}i.scale(a,a);var h=Math.abs,p=Math.cos,d=Math.sin,y=Math.acos,v=Math.atan2,g=Math.sqrt,b=Math.pow;function m(t){return t<0?-b(-t,1/3):b(t,1/3)}var w=Math.PI,_=2*w,k=w/2,O=Number.MAX_SAFE_INTEGER||9007199254740991,j=Number.MIN_SAFE_INTEGER||-9007199254740991,x={x:0,y:0,z:0},S={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){var n=e(t),r=n.x*n.x+n.y*n.y;return void 0!==n.z&&(r+=n.z*n.z),g(r)},compute:function(t,e,n){if(0===t)return e[0].t=0,e[0];var r=e.length-1;if(1===t)return e[r].t=1,e[r];var o=1-t,i=e;if(0===r)return e[0].t=t,e[0];if(1===r){var a={x:o*i[0].x+t*i[1].x,y:o*i[0].y+t*i[1].y,t:t};return n&&(a.z=o*i[0].z+t*i[1].z),a}if(r<4){var c,u,s,l=o*o,f=t*t,h=0;2===r?(i=[i[0],i[1],i[2],x],c=l,u=o*t*2,s=f):3===r&&(c=l*o,u=l*t*3,s=o*f*3,h=t*f);var p={x:c*i[0].x+u*i[1].x+s*i[2].x+h*i[3].x,y:c*i[0].y+u*i[1].y+s*i[2].y+h*i[3].y,t:t};return n&&(p.z=c*i[0].z+u*i[1].z+s*i[2].z+h*i[3].z),p}for(var d=JSON.parse(JSON.stringify(e));d.length>1;){for(var y=0;y<d.length-1;y++)d[y]={x:d[y].x+(d[y+1].x-d[y].x)*t,y:d[y].y+(d[y+1].y-d[y].y)*t},void 0!==d[y].z&&(d[y]=d[y].z+(d[y+1].z-d[y].z)*t);d.splice(d.length-1,1)}return d[0].t=t,d[0]},computeWithRatios:function(t,e,n,r){var o,i=1-t,a=n,c=e,u=a[0],s=a[1],l=a[2],f=a[3];return u*=i,s*=t,2===c.length?(o=u+s,{x:(u*c[0].x+s*c[1].x)/o,y:(u*c[0].y+s*c[1].y)/o,z:!!r&&(u*c[0].z+s*c[1].z)/o,t:t}):(u*=i,s*=2*i,l*=t*t,3===c.length?(o=u+s+l,{x:(u*c[0].x+s*c[1].x+l*c[2].x)/o,y:(u*c[0].y+s*c[1].y+l*c[2].y)/o,z:!!r&&(u*c[0].z+s*c[1].z+l*c[2].z)/o,t:t}):(u*=i,s*=1.5*i,l*=3*i,f*=t*t*t,4===c.length?(o=u+s+l+f,{x:(u*c[0].x+s*c[1].x+l*c[2].x+f*c[3].x)/o,y:(u*c[0].y+s*c[1].y+l*c[2].y+f*c[3].y)/o,z:!!r&&(u*c[0].z+s*c[1].z+l*c[2].z+f*c[3].z)/o,t:t}):void 0))},derive:function(t,e){for(var n=[],r=t,o=r.length,i=o-1;o>1;o--,i--){for(var a,c=[],u=0;u<i;u++)a={x:i*(r[u+1].x-r[u].x),y:i*(r[u+1].y-r[u].y)},e&&(a.z=i*(r[u+1].z-r[u].z)),c.push(a);n.push(c),r=c}return n},between:function(t,e,n){return e<=t&&t<=n||S.approximately(t,e)||S.approximately(t,n)},approximately:function(t,e,n){return h(t-e)<=(n||1e-6)},length:function(t){for(var e,n=S.Tvalues.length,r=0,o=0;o<n;o++)e=.5*S.Tvalues[o]+.5,r+=S.Cvalues[o]*S.arcfn(e,t);return.5*r},map:function(t,e,n,r,o){return r+(t-e)/(n-e)*(o-r)},lerp:function(t,e,n){var r={x:e.x+t*(n.x-e.x),y:e.y+t*(n.y-e.y)};return void 0!==e.z&&void 0!==n.z&&(r.z=e.z+t*(n.z-e.z)),r},pointToString:function(t){var e=t.x+"/"+t.y;return void 0!==t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map(S.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,n){var r=e.x-t.x,o=e.y-t.y,i=n.x-t.x,a=n.y-t.y;return v(r*a-o*i,r*i+o*a)},round:function(t,e){var n=""+t,r=n.indexOf(".");return parseFloat(n.substring(0,r+1+e))},dist:function(t,e){var n=t.x-e.x,r=t.y-e.y;return g(n*n+r*r)},closest:function(t,e){var n,r,o=b(2,63);return t.forEach((function(t,i){r=S.dist(e,t),r<o&&(o=r,n=i)})),{mdist:o,mpos:n}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;var n=b(t,e)+b(1-t,e);return h((n-1)/n)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;var n=b(1-t,e);return n/(b(t,e)+n)},lli8:function(t,e,n,r,o,i,a,c){var u=(t-n)*(i-c)-(e-r)*(o-a);return 0!=u&&{x:((t*r-e*n)*(o-a)-(t-n)*(o*c-i*a))/u,y:((t*r-e*n)*(i-c)-(e-r)*(o*c-i*a))/u}},lli4:function(t,e,n,r){var o=t.x,i=t.y,a=e.x,c=e.y,u=n.x,s=n.y,l=r.x,f=r.y;return S.lli8(o,i,a,c,u,s,l,f)},lli:function(t,e){return S.lli4(t,t.c,e,e.c)},makeline:function(t,e){var n=t.x,r=t.y,o=e.x,i=e.y,a=(o-n)/3,c=(i-r)/3;return new L(n,r,n+a,r+c,n+2*a,r+2*c,o,i)},findbbox:function(t){var e=O,n=O,r=j,o=j;return t.forEach((function(t){var i=t.bbox();e>i.x.min&&(e=i.x.min),n>i.y.min&&(n=i.y.min),r<i.x.max&&(r=i.x.max),o<i.y.max&&(o=i.y.max)})),{x:{min:e,mid:(e+r)/2,max:r,size:r-e},y:{min:n,mid:(n+o)/2,max:o,size:o-n}}},shapeintersections:function(t,e,n,r,o){if(!S.bboxoverlap(e,r))return[];var i=[],a=[t.startcap,t.forward,t.back,t.endcap],c=[n.startcap,n.forward,n.back,n.endcap];return a.forEach((function(e){e.virtual||c.forEach((function(r){if(!r.virtual){var a=e.intersects(r,o);a.length>0&&(a.c1=e,a.c2=r,a.s1=t,a.s2=n,i.push(a))}}))})),i},makeshape:function(t,e,n){var r=e.points.length,o=t.points.length,i=S.makeline(e.points[r-1],t.points[0]),a=S.makeline(t.points[o-1],e.points[0]),c={startcap:i,forward:t,back:e,endcap:a,bbox:S.findbbox([i,t,e,a]),intersections:function(t){return S.shapeintersections(c,c.bbox,t,t.bbox,n)}};return c},getminmax:function(t,e,n){if(!n)return{min:0,max:0};var r,o,i=O,a=j;-1===n.indexOf(0)&&(n=[0].concat(n)),-1===n.indexOf(1)&&n.push(1);for(var c=0,u=n.length;c<u;c++)r=n[c],o=t.get(r),o[e]<i&&(i=o[e]),o[e]>a&&(a=o[e]);return{min:i,mid:(i+a)/2,max:a,size:a-i}},align:function(t,e){var n=e.p1.x,r=e.p1.y,o=-v(e.p2.y-r,e.p2.x-n);return t.map((function(t){return{x:(t.x-n)*p(o)-(t.y-r)*d(o),y:(t.x-n)*d(o)+(t.y-r)*p(o)}}))},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};var n=t.length-1,r=S.align(t,e),o=function(t){return 0<=t&&t<=1};if(2===n){var i=r[0].y,a=r[1].y,c=r[2].y,u=i-2*a+c;if(0!==u){var s=-g(a*a-i*c),l=-i+a;return[-(s+l)/u,-(-s+l)/u].filter(o)}return a!==c&&0===u?[(2*a-c)/(2*a-2*c)].filter(o):[]}var f=r[0].y,h=r[1].y,d=r[2].y,v=3*h-f-3*d+r[3].y,b=3*f-6*h+3*d,w=-3*f+3*h,k=f;if(S.approximately(v,0)){if(S.approximately(b,0))return S.approximately(w,0)?[]:[-k/w].filter(o);var O=g(w*w-4*b*k),j=2*b;return[(O-w)/j,(-w-O)/j].filter(o)}b/=v,w/=v,k/=v;var x,P,T,E,C,R=(3*w-b*b)/3,I=R/3,D=(2*b*b*b-9*b*w+27*k)/27,M=D/2,B=M*M+I*I*I;if(B<0){var L=-R/3,A=g(L*L*L),z=-D/(2*A),F=y(z<-1?-1:z>1?1:z),H=2*m(A);return T=H*p(F/3)-b/3,E=H*p((F+_)/3)-b/3,C=H*p((F+2*_)/3)-b/3,[T,E,C].filter(o)}if(0===B)return x=M<0?m(-M):-m(M),T=2*x-b/3,E=-x-b/3,[T,E].filter(o);var W=g(B);return x=m(-M+W),P=m(M+W),[x-P-b/3].filter(o)},droots:function(t){if(3===t.length){var e=t[0],n=t[1],r=t[2],o=e-2*n+r;if(0!==o){var i=-g(n*n-e*r),a=-e+n;return[-(i+a)/o,-(-i+a)/o]}return n!==r&&0===o?[(2*n-r)/(2*(n-r))]:[]}if(2===t.length){var c=t[0],u=t[1];return c!==u?[c/(c-u)]:[]}return[]},curvature:function(t,e,n,r,o){var i,a,c,u,s=0,l=0,f=S.compute(t,e),p=S.compute(t,n),d=f.x*f.x+f.y*f.y;if(r?(i=g(b(f.y*p.z-p.y*f.z,2)+b(f.z*p.x-p.z*f.x,2)+b(f.x*p.y-p.x*f.y,2)),a=b(d+f.z*f.z,1.5)):(i=f.x*p.y-f.y*p.x,a=b(d,1.5)),0===i||0===a)return{k:0,r:0};if(s=i/a,l=a/i,!o){var y=S.curvature(t-.001,e,n,r,!0).k,v=S.curvature(t+.001,e,n,r,!0).k;u=(v-s+(s-y))/2,c=(h(v-s)+h(s-y))/2}return{k:s,r:l,dk:u,adk:c}},inflections:function(t){if(t.length<4)return[];var e=S.align(t,{p1:t[0],p2:t.slice(-1)[0]}),n=e[2].x*e[1].y,r=e[3].x*e[1].y,o=e[1].x*e[2].y,i=18*(-3*n+2*r+3*o-e[3].x*e[2].y),a=18*(3*n-r-3*o),c=18*(o-n);if(S.approximately(i,0)){if(!S.approximately(a,0)){var u=-c/a;if(0<=u&&u<=1)return[u]}return[]}var s=a*a-4*i*c,l=Math.sqrt(s),f=2*i;return S.approximately(f,0)?[]:[(l-a)/f,-(a+l)/f].filter((function(t){return 0<=t&&t<=1}))},bboxoverlap:function(t,e){for(var n,r,o,i,a=["x","y"],c=a.length,u=0;u<c;u++)if(n=a[u],r=t[n].mid,o=e[n].mid,i=(t[n].size+e[n].size)/2,h(r-o)>=i)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,n){var r=t.bbox(),o=e.bbox(),i=1e5,a=n||.5;if(r.x.size+r.y.size<a&&o.x.size+o.y.size<a)return[(i*(t._t1+t._t2)/2|0)/i+"/"+(i*(e._t1+e._t2)/2|0)/i];var c=t.split(.5),u=e.split(.5),s=[{left:c.left,right:u.left},{left:c.left,right:u.right},{left:c.right,right:u.right},{left:c.right,right:u.left}];s=s.filter((function(t){return S.bboxoverlap(t.left.bbox(),t.right.bbox())}));var l=[];return 0===s.length||(s.forEach((function(t){l=l.concat(S.pairiteration(t.left,t.right,a))})),l=l.filter((function(t,e){return l.indexOf(t)===e}))),l},getccenter:function(t,e,n){var r,o=e.x-t.x,i=e.y-t.y,a=n.x-e.x,c=n.y-e.y,u=o*p(k)-i*d(k),s=o*d(k)+i*p(k),l=a*p(k)-c*d(k),f=a*d(k)+c*p(k),h=(t.x+e.x)/2,y=(t.y+e.y)/2,g=(e.x+n.x)/2,b=(e.y+n.y)/2,m=h+u,w=y+s,O=g+l,j=b+f,x=S.lli8(h,y,m,w,g,b,O,j),P=S.dist(x,t),T=v(t.y-x.y,t.x-x.x),E=v(e.y-x.y,e.x-x.x),C=v(n.y-x.y,n.x-x.x);return T<C?((T>E||E>C)&&(T+=_),T>C&&(r=C,C=T,T=r)):C<E&&E<T?(r=C,C=T,T=r):C+=_,x.s=T,x.e=C,x.r=P,x},numberSort:function(t,e){return t-e}},P=function(){function t(e){u(this,t),this.curves=[],this._3d=!1,e&&(this.curves=e,this._3d=this.curves[0]._3d)}return s(t,[{key:"valueOf",value:function(){return this.toString()}},{key:"toString",value:function(){return"["+this.curves.map((function(t){return S.pointsToString(t.points)})).join(", ")+"]"}},{key:"addCurve",value:function(t){this.curves.push(t),this._3d=this._3d||t._3d}},{key:"length",value:function(){return this.curves.map((function(t){return t.length()})).reduce((function(t,e){return t+e}))}},{key:"curve",value:function(t){return this.curves[t]}},{key:"bbox",value:function(){for(var t=this.curves,e=t[0].bbox(),n=1;n<t.length;n++)S.expandbox(e,t[n].bbox());return e}},{key:"offset",value:function(e){var n=[];return this.curves.forEach((function(t){n.push.apply(n,c(t.offset(e)))})),new t(n)}}]),t}(),T=Math.abs,E=Math.min,C=Math.max,R=Math.cos,I=Math.sin,D=Math.acos,M=Math.sqrt,B=Math.PI,L=function(){function e(t){u(this,e);var n=t&&t.forEach?t:Array.from(arguments).slice(),r=!1;if("object"==l(n[0])){r=n.length;var o=[];n.forEach((function(t){["x","y","z"].forEach((function(e){void 0!==t[e]&&o.push(t[e])}))})),n=o}var i=!1,a=n.length;if(r){if(r>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");i=!0}}else if(6!==a&&8!==a&&9!==a&&12!==a&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");for(var c=this._3d=!i&&(9===a||12===a)||t&&t[0]&&void 0!==t[0].z,s=this.points=[],f=0,h=c?3:2;f<a;f+=h){var p={x:n[f],y:n[f+1]};c&&(p.z=n[f+2]),s.push(p)}var d=this.order=s.length-1,y=this.dims=["x","y"];c&&y.push("z"),this.dimlen=y.length;var v=S.align(s,{p1:s[0],p2:s[d]});this._linear=!v.some((function(t){return T(t.y)>1e-4})),this._lut=[],this._t1=0,this._t2=1,this.update()}return s(e,[{key:"getUtils",value:function(){return e.getUtils()}},{key:"valueOf",value:function(){return this.toString()}},{key:"toString",value:function(){return S.pointsToString(this.points)}},{key:"toSVG",value:function(){if(this._3d)return!1;for(var t=this.points,e=["M",t[0].x,t[0].y,2===this.order?"Q":"C"],n=1,r=t.length;n<r;n++)e.push(t[n].x),e.push(t[n].y);return e.join(" ")}},{key:"setRatios",value:function(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}},{key:"verify",value:function(){var t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}},{key:"coordDigest",value:function(){return this.points.map((function(t,e){return""+e+t.x+t.y+(t.z?t.z:0)})).join("")}},{key:"update",value:function(){this._lut=[],this.dpoints=S.derive(this.points,this._3d),this.computedirection()}},{key:"computedirection",value:function(){var t=this.points,e=S.angle(t[0],t[this.order],t[1]);this.clockwise=e>0}},{key:"length",value:function(){return S.length(this.derivative.bind(this))}},{key:"getABC",value:function(t,n){n=n||this.get(t);var r=this.points[0],o=this.points[this.order];return e.getABC(this.order,r,n,o,t)}},{key:"getLUT",value:function(t){if(this.verify(),t=t||100,this._lut.length===t)return this._lut;this._lut=[],t--;for(var e,n,r=0;r<t;r++)n=r/(t-1),e=this.compute(n),e.t=n,this._lut.push(e);return this._lut}},{key:"on",value:function(e,n){n=n||5;for(var r,o=this.getLUT(),i=[],a=0;a<o.length;a++)r=o[a],S.dist(r,e)<n&&(i.push(r),a/o.length);return!!i.length&&(t/=i.length)}},{key:"project",value:function(t){var e,n,r=this.getLUT(),o=r.length-1,i=S.closest(r,t),a=i.mpos,c=(a-1)/o,u=(a+1)/o,s=.1/o,l=i.mdist,f=c,h=f;for(l+=1;f<u+s;f+=s)e=this.compute(f),n=S.dist(t,e),n<l&&(l=n,h=f);return h=h<0?0:h>1?1:h,e=this.compute(h),e.t=h,e.d=l,e}},{key:"get",value:function(t){return this.compute(t)}},{key:"point",value:function(t){return this.points[t]}},{key:"compute",value:function(t){return this.ratios?S.computeWithRatios(t,this.points,this.ratios,this._3d):S.compute(t,this.points,this._3d,this.ratios)}},{key:"raise",value:function(){for(var t,n,r=this.points,o=[r[0]],i=r.length,a=1;a<i;a++)t=r[a],n=r[a-1],o[a]={x:(i-a)/i*t.x+a/i*n.x,y:(i-a)/i*t.y+a/i*n.y};return o[i]=r[i-1],new e(o)}},{key:"derivative",value:function(t){return S.compute(t,this.dpoints[0],this._3d)}},{key:"dderivative",value:function(t){return S.compute(t,this.dpoints[1],this._3d)}},{key:"align",value:function(){var t=this.points;return new e(S.align(t,{p1:t[0],p2:t[t.length-1]}))}},{key:"curvature",value:function(t){return S.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}},{key:"inflections",value:function(){return S.inflections(this.points)}},{key:"normal",value:function(t){return this._3d?this.__normal3(t):this.__normal2(t)}},{key:"__normal2",value:function(t){var e=this.derivative(t),n=M(e.x*e.x+e.y*e.y);return{x:-e.y/n,y:e.x/n}}},{key:"__normal3",value:function(t){var e=this.derivative(t),n=this.derivative(t+.01),r=M(e.x*e.x+e.y*e.y+e.z*e.z),o=M(n.x*n.x+n.y*n.y+n.z*n.z);e.x/=r,e.y/=r,e.z/=r,n.x/=o,n.y/=o,n.z/=o;var i={x:n.y*e.z-n.z*e.y,y:n.z*e.x-n.x*e.z,z:n.x*e.y-n.y*e.x},a=M(i.x*i.x+i.y*i.y+i.z*i.z);i.x/=a,i.y/=a,i.z/=a;var c=[i.x*i.x,i.x*i.y-i.z,i.x*i.z+i.y,i.x*i.y+i.z,i.y*i.y,i.y*i.z-i.x,i.x*i.z-i.y,i.y*i.z+i.x,i.z*i.z];return{x:c[0]*e.x+c[1]*e.y+c[2]*e.z,y:c[3]*e.x+c[4]*e.y+c[5]*e.z,z:c[6]*e.x+c[7]*e.y+c[8]*e.z}}},{key:"hull",value:function(t){var e=this.points,n=[],r=[],o=0;for(r[o++]=e[0],r[o++]=e[1],r[o++]=e[2],3===this.order&&(r[o++]=e[3]);e.length>1;){n=[];for(var i,a=0,c=e.length-1;a<c;a++)i=S.lerp(t,e[a],e[a+1]),r[o++]=i,n.push(i);e=n}return r}},{key:"split",value:function(t,n){if(0===t&&n)return this.split(n).left;if(1===n)return this.split(t).right;var r=this.hull(t),o={left:2===this.order?new e([r[0],r[3],r[5]]):new e([r[0],r[4],r[7],r[9]]),right:2===this.order?new e([r[5],r[4],r[2]]):new e([r[9],r[8],r[6],r[3]]),span:r};return o.left._t1=S.map(0,0,1,this._t1,this._t2),o.left._t2=S.map(t,0,1,this._t1,this._t2),o.right._t1=S.map(t,0,1,this._t1,this._t2),o.right._t2=S.map(1,0,1,this._t1,this._t2),n?(n=S.map(n,t,1,0,1),o.right.split(n).left):o}},{key:"extrema",value:function(){var t={},e=[];return this.dims.forEach(function(n){var r=function(t){return t[n]},o=this.dpoints[0].map(r);t[n]=S.droots(o),3===this.order&&(o=this.dpoints[1].map(r),t[n]=t[n].concat(S.droots(o))),t[n]=t[n].filter((function(t){return t>=0&&t<=1})),e=e.concat(t[n].sort(S.numberSort))}.bind(this)),t.values=e.sort(S.numberSort).filter((function(t,n){return e.indexOf(t)===n})),t}},{key:"bbox",value:function(){var t=this.extrema(),e={};return this.dims.forEach(function(n){e[n]=S.getminmax(this,n,t[n])}.bind(this)),e}},{key:"overlaps",value:function(t){var e=this.bbox(),n=t.bbox();return S.bboxoverlap(e,n)}},{key:"offset",value:function(t,n){if(void 0!==n){var r=this.get(t),o=this.normal(t),i={c:r,n:o,x:r.x+o.x*n,y:r.y+o.y*n};return this._3d&&(i.z=r.z+o.z*n),i}if(this._linear){var a=this.normal(0),c=this.points.map((function(e){var n={x:e.x+t*a.x,y:e.y+t*a.y};return e.z&&a.z&&(n.z=e.z+t*a.z),n}));return[new e(c)]}return this.reduce().map((function(e){return e._linear?e.offset(t)[0]:e.scale(t)}))}},{key:"simple",value:function(){if(3===this.order){var t=S.angle(this.points[0],this.points[3],this.points[1]),e=S.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&e<0||t<0&&e>0)return!1}var n=this.normal(0),r=this.normal(1),o=n.x*r.x+n.y*r.y;return this._3d&&(o+=n.z*r.z),T(D(o))<B/3}},{key:"reduce",value:function(){var t,e,n=0,r=0,o=.01,i=[],a=[],c=this.extrema().values;for(-1===c.indexOf(0)&&(c=[0].concat(c)),-1===c.indexOf(1)&&c.push(1),n=c[0],t=1;t<c.length;t++)r=c[t],e=this.split(n,r),e._t1=n,e._t2=r,i.push(e),n=r;return i.forEach((function(t){for(n=0,r=0;r<=1;)for(r=n+o;r<=1.01;r+=o)if(e=t.split(n,r),!e.simple()){if(r-=o,T(n-r)<o)return[];e=t.split(n,r),e._t1=S.map(n,0,1,t._t1,t._t2),e._t2=S.map(r,0,1,t._t1,t._t2),a.push(e),n=r;break}n<1&&(e=t.split(n,1),e._t1=S.map(n,0,1,t._t1,t._t2),e._t2=t._t2,a.push(e))})),a}},{key:"scale",value:function(t){var n=this,r=this.order,o=!1;if("function"==typeof t&&(o=t),o&&2===r)return this.raise().scale(o);var i=this.clockwise,a=o?o(0):t,c=o?o(1):t,u=[this.offset(0,10),this.offset(1,10)],s=this.points,l=[],f=S.lli4(u[0],u[0].c,u[1],u[1].c);if(!f)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach((function(t){var e=l[t*r]=S.copy(s[t*r]);e.x+=(t?c:a)*u[t].n.x,e.y+=(t?c:a)*u[t].n.y})),o?([0,1].forEach((function(e){if(2!==r||!e){var n=s[e+1],a={x:n.x-f.x,y:n.y-f.y},c=o?o((e+1)/r):t;o&&!i&&(c=-c);var u=M(a.x*a.x+a.y*a.y);a.x/=u,a.y/=u,l[e+1]={x:n.x+c*a.x,y:n.y+c*a.y}}})),new e(l)):([0,1].forEach((function(t){if(2!==r||!t){var e=l[t*r],o=n.derivative(t),i={x:e.x+o.x,y:e.y+o.y};l[t+1]=S.lli4(e,i,f,s[t+1])}})),new e(l))}},{key:"outline",value:function(t,e,n,r){e=void 0===e?t:e;var o,i=this.reduce(),a=i.length,c=[],u=[],s=0,l=this.length(),f=void 0!==n&&void 0!==r;function h(t,e,n,r,o){return function(i){var a=r/n,c=(r+o)/n,u=e-t;return S.map(i,0,1,t+a*u,t+c*u)}}i.forEach((function(o){var i=o.length();f?(c.push(o.scale(h(t,n,l,s,i))),u.push(o.scale(h(-e,-r,l,s,i)))):(c.push(o.scale(t)),u.push(o.scale(-e))),s+=i})),u=u.map((function(t){return o=t.points,o[3]?t.points=[o[3],o[2],o[1],o[0]]:t.points=[o[2],o[1],o[0]],t})).reverse();var p=c[0].points[0],d=c[a-1].points[c[a-1].points.length-1],y=u[a-1].points[u[a-1].points.length-1],v=u[0].points[0],g=S.makeline(y,p),b=S.makeline(d,v),m=[g].concat(c).concat([b]).concat(u);return m.length,new P(m)}},{key:"outlineshapes",value:function(t,e,n){e=e||t;for(var r=this.outline(t,e).curves,o=[],i=1,a=r.length;i<a/2;i++){var c=S.makeshape(r[i],r[a-i],n);c.startcap.virtual=i>1,c.endcap.virtual=i<a/2-1,o.push(c)}return o}},{key:"intersects",value:function(t,n){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof e&&(t=t.reduce()),this.curveintersects(this.reduce(),t,n)):this.selfintersects(n)}},{key:"lineIntersects",value:function(t){var e=this,n=E(t.p1.x,t.p2.x),r=E(t.p1.y,t.p2.y),o=C(t.p1.x,t.p2.x),i=C(t.p1.y,t.p2.y);return S.roots(this.points,t).filter((function(t){var a=e.get(t);return S.between(a.x,n,o)&&S.between(a.y,r,i)}))}},{key:"selfintersects",value:function(t){for(var e,n,r,o=this.reduce(),i=o.length-2,a=[],u=0;u<i;u++)n=o.slice(u,u+1),r=o.slice(u+2),e=this.curveintersects(n,r,t),a.push.apply(a,c(e));return a}},{key:"curveintersects",value:function(t,e,n){var r=[];t.forEach((function(t){e.forEach((function(e){t.overlaps(e)&&r.push({left:t,right:e})}))}));var o=[];return r.forEach((function(t){var e=S.pairiteration(t.left,t.right,n);e.length>0&&(o=o.concat(e))})),o}},{key:"arcs",value:function(t){return t=t||.5,this._iterate(t,[])}},{key:"_error",value:function(t,e,n,r){var o=(r-n)/4,i=this.get(n+o),a=this.get(r-o),c=S.dist(t,e),u=S.dist(t,i),s=S.dist(t,a);return T(u-c)+T(s-c)}},{key:"_iterate",value:function(t,e){var n,r=0,o=1;do{n=0,o=1;var i=void 0,a=void 0,c=void 0,u=void 0,s=void 0,l=this.get(r),f=!1,h=!1,p=o,d=1;do{if(h=f,u=c,p=(r+o)/2,i=this.get(p),a=this.get(o),c=S.getccenter(l,i,a),c.interval={start:r,end:o},f=this._error(c,l,r,o)<=t,s=h&&!f,s||(d=o),f){if(o>=1){if(c.interval.end=d=1,u=c,o>1){var y={x:c.x+c.r*R(c.e),y:c.y+c.r*I(c.e)};c.e+=S.angle({x:c.x,y:c.y},y,this.get(1))}break}o+=(o-r)/2}else o=p}while(!s&&n++<100);if(n>=100)break;u=u||c,e.push(u),r=d}while(o<1);return e}}],[{key:"quadraticFromPoints",value:function(t,n,r,o){if(void 0===o&&(o=.5),0===o)return new e(n,n,r);if(1===o)return new e(t,n,n);var i=e.getABC(2,t,n,r,o);return new e(t,i.A,r)}},{key:"cubicFromPoints",value:function(t,n,r,o,i){void 0===o&&(o=.5);var a=e.getABC(3,t,n,r,o);void 0===i&&(i=S.dist(n,a.C));var c=i*(1-o)/o,u=S.dist(t,r),s=(r.x-t.x)/u,l=(r.y-t.y)/u,f=i*s,h=i*l,p=c*s,d=c*l,y=n.x-f,v=n.y-h,g=n.x+p,b=n.y+d,m=a.A,w=m.x+(y-m.x)/(1-o),_=m.y+(v-m.y)/(1-o),k=m.x+(g-m.x)/o,O=m.y+(b-m.y)/o,j={x:t.x+(w-t.x)/o,y:t.y+(_-t.y)/o},x={x:r.x+(k-r.x)/(1-o),y:r.y+(O-r.y)/(1-o)};return new e(t,j,x,r)}},{key:"getUtils",value:function(){return S}},{key:"PolyBezier",get:function(){return P}},{key:"getABC",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=S.projectionratio(o,t),a=1-i,c={x:i*e.x+a*r.x,y:i*e.y+a*r.y},u=S.abcratio(o,t);return{A:{x:n.x+(n.x-c.x)/u,y:n.y+(n.y-c.y)/u},B:n,C:c,S:e,E:r}}}]),e}(),A={RIGHT:0,BOTTOM:1,LEFT:2,TOP:3,SELF:100};function z(t,e,n){return z=F()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&H(o,n.prototype),o},z.apply(null,arguments)}function F(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function H(t,e){return H=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},H(t,e)}function W(t){return function(t){if(Array.isArray(t))return G(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return G(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Y(t){var e=1/0,n=1/0,r=-1/0,o=-1/0;for(var i in t){var a=t[i];a[0]<e&&(e=a[0]),a[0]>r&&(r=a[0]),a[1]<n&&(n=a[1]),a[1]>o&&(o=a[1])}return{width:Math.max(r-e,10),height:Math.max(o-n,10),x:e,y:n}}function $(t){return t*t}function X(t,e){return $(t[0]-e[0])+$(t[1]-e[1])}function q(t,e,n){var r=X(e,n);if(0===r)return X(t,e);var o=((t[0]-e[0])*(n[0]-e[0])+(t[1]-e[1])*(n[1]-e[1]))/r;return o=Math.max(0,Math.min(1,o)),X(t,[e[0]+o*(n[0]-e[0]),e[1]+o*(n[1]-e[1])])}function N(t,e){var n={fromDir:null,fromP:null,toDir:null,toP:null,distMin:1/0};return Object.keys(t).forEach((function(r){if(+r!==A.SELF){var o=t[r];Object.keys(e).forEach((function(t){if(+t!==A.SELF){var i=e[t],a=X(o,i);a<n.distMin&&Object.assign(n,{distMin:a,fromDir:+r,fromP:o,toDir:+t,toP:i})}}))}})),n}function J(t,e,n,r){return e===A.TOP?[t[0],t[1]-r]:e===A.BOTTOM?[t[0],t[1]+r]:e===A.LEFT?[t[0]-n,t[1]]:e===A.RIGHT?[t[0]+n,t[1]]:void 0}function U(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.TOP,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.TOP,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=Math.max(Math.abs((t[0]-e[0])/2),o),c=Math.max(Math.abs((t[1]-e[1])/2),i),u=J(t,n,a,c),s=J(e,r,a,c),l=[A.TOP,A.LEFT].includes(r)?-5:5,f=[A.TOP,A.BOTTOM].includes(r),h=f?e[0]:e[0]+l,p=f?e[1]+l:e[1];return[].concat(W(u),W(s),[h,p])}function Z(t,e,n,r,o,i,a,c,u){var s=Math.pow(1-t,2)*(r-e)+2*t*(1-t)*(i-r)+t*t*(c-i),l=Math.pow(1-t,2)*(o-n)+2*t*(1-t)*(a-o)+t*t*(u-a);return-Math.atan2(s,l)+.5*Math.PI}function V(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.TOP,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.TOP,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:10,a=arguments.length>6?arguments[6]:void 0,c=Math.abs(n-r),u=n===A.TOP||n===A.BOTTOM,s=[];switch(c){case 0:if(n===A.TOP){var l=Math.min(t[1],e[1]),f=l-i;s.push([t[0],f]),s.push([e[0],f])}if(n===A.BOTTOM){var h=Math.max(t[1],e[1]),p=h+i;s.push([t[0],p]),s.push([e[0],p])}if(n===A.LEFT){var d=Math.min(t[0],e[0]),y=d-o;s.push([y,t[1]]),s.push([y,e[1]])}if(n===A.RIGHT){var v=Math.max(t[0],e[0]),g=v+o;s.push([g,t[1]]),s.push([g,e[1]])}break;case 1:case 3:if(a)u?(s.push([t[0],t[1]+i]),s.push([e[0]+o,t[1]+i]),s.push([e[0]+o,e[1]])):(s.push([t[0]+o,t[1]]),s.push([t[0]+o,e[1]+i]),s.push([e[0],e[1]+i]));else{var b=u?[t[0],e[1]]:[e[0],t[1]];s.push(b)}break;case 2:var m=[(t[0]-e[0])/2+e[0],(t[1]-e[1])/2+e[1]];u?(s.push([t[0],m[1]]),s.push([e[0],m[1]])):(s.push([m[0],t[1]]),s.push([m[0],e[1]]))}return s.unshift(t),s.push(e),s}function K(t,e){return[t[0]-e[0],t[1]-e[1]]}function Q(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function tt(t,e){return[t[0]*e,t[1]*e]}function et(t){return et="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},et(t)}function nt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function rt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ot(t,e){if(e&&("object"===et(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function it(t){var e="function"==typeof Map?new Map:void 0;return it=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return at(t,arguments,st(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ut(r,t)},it(t)}function at(t,e,n){return at=ct()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&ut(o,n.prototype),o},at.apply(null,arguments)}function ct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function ut(t,e){return ut=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ut(t,e)}function st(t){return st=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},st(t)}var lt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ut(t,e)}(a,t);var e,n,r,o,i=(e=a,n=ct(),function(){var t,r=st(e);if(n){var o=st(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return ot(this,t)});function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this))._currentHit=null,t}return r=a,o=[{key:"render",value:function(t){var e;this.forEach((function(n){n._isMoving?e=n:n.visible&&(t.save(),n.render(t),t.restore())})),e&&(t.save(),e.render(t),t.restore())}},{key:"checkHit",value:function(t,e){for(var n=this.length-1;n>=0;){var r=this[n];if(r.visible&&!r.ignoreHit){if(e&&e(r)){n--;continue}var o=r.isHit(t,e);if(r._isHit=!!o,o)return this._currentHit!==r&&(this._currentHit&&(this._currentHit._isHit=!1),this._currentHit=r),"boolean"!=typeof o?o:r}n--}return this._currentHit=null,null}},{key:"getBoundingRectPoints",value:function(){var t=[];return this.forEach((function(e){var n;e.visible&&!e.absolutePosition&&t.splice.apply(t,[t.length,0].concat(function(t){if(Array.isArray(t))return nt(t)}(n=e.getBoundingRect())||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return nt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nt(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))})),t}},{key:"getAnchorRectPoints",value:function(){var t=[];return this.forEach((function(e){e.visible&&!e.absolutePosition&&t.push(e.anchor)})),t}}],o&&rt(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),a}(it(Array)),ft=lt;function ht(t){return ht="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},ht(t)}function pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function yt(t,e){if(e&&("object"===ht(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return vt(t)}function vt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gt(t){var e="function"==typeof Map?new Map:void 0;return gt=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return bt(t,arguments,_t(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),wt(r,t)},gt(t)}function bt(t,e,n){return bt=mt()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&wt(o,n.prototype),o},bt.apply(null,arguments)}function mt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function wt(t,e){return wt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},wt(t,e)}function _t(t){return _t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},_t(t)}var kt=Symbol("ishit"),Ot=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wt(t,e)}(a,t);var e,n,r,o,i=(e=a,n=mt(),function(){var t,r=_t(e);if(n){var o=_t(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return yt(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return pt(this,a),t=i.call(this),Object.assign(vt(t),e),t.visible=!0,t._belongs=void 0,t[kt]=!1,t._layoutNode=void 0,t.borderWidth=e.borderWidth||0,t.borderColor=e.borderColor||"transparent",t.backgroundColor=e.backgroundColor||"transparent",t.shadowColor=e.shadowColor,t.shadowBlur=e.shadowBlur||5,t.shadowOffsetX=e.shadowOffsetX||0,t.shadowOffsetY=e.shadowOffsetY||0,t}return r=a,o=[{key:"_isTargeting",get:function(){return this===(this._jflow._target.instance||this._jflow._target.link)}},{key:"_isMoving",get:function(){return this===this._jflow._getMovingTarget()}},{key:"_isHit",get:function(){return this[kt]},set:function(t){this[kt]!==t&&this.dispatchEvent(new CustomEvent(t?"mouseenter":"mouseleave",{detail:{instance:this}})),this[kt]=t}},{key:"_jflow",get:function(){return"jflow"===this._belongs.uniqueName?this._belongs:this._belongs._jflow}},{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n])}))}},{key:"render",value:function(t){throw"require render implement"}},{key:"isHit",value:function(t){throw"require isHit implement"}},{key:"getBoundingRect",value:function(){throw"require getBoundingRect implement"}},{key:"calculateIntersection",value:function(){throw"require calculateIntersection implement"}},{key:"getIntersectionsInFourDimension",value:function(){throw"require getIntersectionsInFourDimension implement"}},{key:"getCenter",value:function(){return this.anchor}},{key:"getBoundingDimension",value:function(){var t=instance.getBoundingRect(),e=1/0,n=-1/0,r=1/0,o=-1/0;return t.forEach((function(t){n=Math.max(n,t[1]),e=Math.min(e,t[1]),o=Math.max(o,t[0]),r=Math.min(r,t[0])})),{height:n-e,width:o-r}}},{key:"bubbleEvent",value:function(t){this.dispatchEvent(t),t.detail.bubbles&&(this._belongs.bubbleEvent?this._belongs.bubbleEvent(t):this._belongs.dispatchEvent(t))}},{key:"calculateToRealWorld",value:function(t){return this._belongs&&this._belongs.calculateToRealWorld?this._belongs.calculateToRealWorld(t):t}},{key:"calculateToRealWorldWithScalar",value:function(t){return this._jflow.scale*t}},{key:"removeFromLayoutSource",value:function(){this._layoutNode&&this._layoutNode.remove()}},{key:"recalculateUp",value:function(){this.belongs&&this.belongs.recalculateUp()}}],o&&dt(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),a}(gt(EventTarget)),jt=Ot,xt={instances:[],links:[],_stack:null,_linkStack:null,initStack:function(t){var e=this,n=t.data;this._stack=new ft,this._linkStack=new ft,n&&(this.instances=n.instances,this.links=n.links,this.instances.forEach((function(t){e._stack.push(t),t._belongs=e})),this.links.forEach((function(t){e._linkStack.push(t),t._belongs=e})))},addToStack:function(t){t._belongs=this,this._stack.push(t)},replaceFromStack:function(t,e){var n=this._stack.findIndex((function(e){return e===t}));this._stack.splice(n,1,e),t._belongs=null,e._belongs=this},addToLinkStack:function(t){t._belongs=this,this._linkStack.push(t)},removeFromStack:function(t){var e=this._stack.findIndex((function(e){return e===t}));this._stack.splice(e,1)},removeFromLinkStack:function(t){var e=this._linkStack.findIndex((function(e){return e===t}));this._linkStack.splice(e,1)},emptyLink:function(){this._linkStack=new ft},resetChildrenPosition:function(){this._stack.forEach((function(t){t.anchor=[0,0]}))},addInstanceToLink:function(t,e){this.addToStack(e);var n=t.from,r=t.to,o=this._linkStack.findIndex((function(e){return e===t})),i=t.__proto__.constructor,a=new i({from:n,to:e});a._belongs=this;var c=new i({from:e,to:r});c._belongs=this,this._linkStack.splice(o,1,a,c)},interateNodeStack:function(t){this._stack.forEach((function(e){t(e)}))}},St={_layout:null,initLayout:function(t){this._layout=t.layout},recalculateUp:function(){var t=!0;if(this.getBoundingDimension){var e=this.getBoundingDimension(),n=e.width,r=e.height;this.resetChildrenPosition&&this.resetChildrenPosition(),this._getBoundingGroupRect&&this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect();var o=this.getBoundingDimension(),i=o.width,a=o.height;t=n!==i||r!==a}else this.reflow();this._belongs&&t&&this._belongs.recalculateUp()},recalculate:function(){this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect()},staticCheck:function(t){return!!this._layout&&this._layout.staticCheck(t,this)},reflow:function(){this._layout&&this._layout.reflow(this)}};function Pt(t){return Pt="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},Pt(t)}function Tt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Et(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Tt(Object(n),!0).forEach((function(e){Ct(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Tt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ct(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Rt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function It(t,e){if(e&&("object"===Pt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Dt(t){var e="function"==typeof Map?new Map:void 0;return Dt=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return Mt(t,arguments,At(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Lt(r,t)},Dt(t)}function Mt(t,e,n){return Mt=Bt()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&Lt(o,n.prototype),o},Mt.apply(null,arguments)}function Bt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Lt(t,e){return Lt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Lt(t,e)}function At(t){return At=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},At(t)}var zt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lt(t,e)}(i,t);var e,n,r,o=(e=i,n=Bt(),function(){var t,r=At(e);if(n){var o=At(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return It(this,t)});function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Rt(this,i);var n=Et(Et({},e),{},{originEvent:e.event,target:e.target,jflow:e.jflow,bubbles:e.bubbles||!1});return o.call(this,t,{detail:n})}return r=i,Object.defineProperty(r,"prototype",{writable:!1}),r}(Dt(CustomEvent)),Ft=zt;function Ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Wt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Gt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ht(this,t),this.plugin={canvas:{wheel:function(t,e){t.preventDefault();var n=t.offsetX,r=t.offsetY,o=t.deltaX,i=t.deltaY;t.ctrlKey?(i=-i,e.zoomHandler(n,r,o,i,t)):e.panHandler(-o,-i,t)},pointerdown:function(t,e){var n=t.offsetX,r=t.offsetY;t.deltaY,0===t.button&&e.pressStartHandler(n,r,t)},pointermove:function(t,e){var n=t.offsetX,r=t.offsetY;e.pressMoveHandler(n,r,t)},pointerup:function(t,e){t.preventDefault(),t.stopPropagation(),0===t.button&&e.pressUpHanlder(!1,t)},contextmenu:function(t,e){t.preventDefault(),t.stopPropagation();var n=t.offsetX,r=t.offsetY;e.contextMenuHanlder(n,r,t)}},document:{pointerup:function(t,e){e.pressUpHanlder(!0,t)}}},this.use(e),this.canvasHandlers=[],this.documentHandlers=[]}var e,n;return e=t,n=[{key:"use",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.canvas,n=t.document;if(e)for(var r in e)e.hasOwnProperty(r)&&(this.plugin.canvas[r]=e[r]);if(n)for(var o in n)n.hasOwnProperty(o)&&(this.plugin.document[o]=n[o])}},{key:"apply",value:function(t){var e=this,n=this.plugin,r=n.canvas,o=n.document,i=t.canvas,a=function(n){var o=r[n];function a(e){o(e,t)}i.addEventListener(n,a),e.canvasHandlers.push({eventName:n,handlerWrapperd:a})};for(var c in r)a(c);var u=function(n){var r=o[n];function i(e){r(e,t)}document.addEventListener(n,i),e.documentHandlers.push({eventName:n,handlerWrapperd:i})};for(var s in o)u(s)}},{key:"unload",value:function(t){var e=t.canvas;this.canvasHandlers.forEach((function(t){var n=t.eventName,r=t.handlerWrapperd;e.removeEventListener(n,r)})),this.documentHandlers.forEach((function(t){var e=t.eventName,n=t.handlerWrapperd;document.removeEventListener(e,n)}))}}],n&&Wt(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Yt=Gt,$t={canvas:{wheel:function(t,e){t.preventDefault();var n=t.offsetX,r=t.offsetY,o=t.deltaX,i=t.deltaY;t.ctrlKey&&(i=-i),e.zoomHandler(n,r,o,i,t)}}};function Xt(t){return Xt="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},Xt(t)}function qt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Nt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Jt(t,e){return Jt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Jt(t,e)}function Ut(t,e){if(e&&("object"===Xt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Zt(t){return Zt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Zt(t)}var Vt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Jt(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Zt(r);if(o){var n=Zt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Ut(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return qt(this,a),(t=i.call(this,e))._rawConfigs=e,t.anchor=e.anchor||[0,0],t.absolutePosition=e.absolutePosition,t}return e=a,(n=[{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n],e._rawConfigs[n]=t[n])}))}},{key:"clone",value:function(){return new(0,this.constructor)(this._rawConfigs)}}])&&Nt(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(jt),Kt=Vt;function Qt(t){return Qt="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},Qt(t)}function te(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ee(t,e){return ee=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ee(t,e)}function ne(t,e){if(e&&("object"===Qt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function re(t){return re=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},re(t)}var oe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ee(t,e)}(i,t);var e,n,r,o=(n=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=re(n);if(r){var o=re(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return ne(this,t)});function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return te(this,i),(t=o.call(this)).from=e.from,t.to=e.to,t.fromDir=e.fromDir,t.toDir=e.toDir,t.key=e.key,t._cachePoints=null,t.backgroundColor=e.backgroundColor||"#000",t}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(jt),ie=oe;function ae(t){return ae="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},ae(t)}function ce(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ue(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return se(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?se(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function se(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function le(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function fe(t,e){return fe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},fe(t,e)}function he(t,e){if(e&&("object"===ae(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function pe(t){return pe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},pe(t)}var de=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fe(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=pe(r);if(o){var n=pe(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return he(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).type="Point",e.radius=t.radius||10,e.radiusExpo2=e.radius*e.radius,e}return e=a,n=[{key:"render",value:function(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath(),t.arc(this.anchor[0],this.anchor[1],this.radius,0,2*Math.PI),t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}},{key:"isHit",value:function(t){var e=this.anchor;return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)<this.radiusExpo2}},{key:"getBoundingRect",value:function(){var t=this.anchor,e=this.radius,n=t[0]-e,r=t[1]-e,o=t[0]+e,i=t[1]+e;return[[n,r],[o,r],[o,i],[n,i]]}},{key:"calculateIntersection",value:function(t){var e=ue(t,2),n=e[0],r=e[1],o=ue(this.anchor,2),i=o[0],a=o[1],c=i-n,u=a-r,s=Math.sqrt(c*c+u*u),l=this.radius/s;return[i-l*c,a-l*u]}},{key:"getIntersectionsInFourDimension",value:function(){var t,e=ue(this.anchor,2),n=e[0],r=e[1],o=this.radius;return ce(t={},A.RIGHT,[n+o,r]),ce(t,A.LEFT,[n-o,r]),ce(t,A.BOTTOM,[n,r+o]),ce(t,A.TOP,[n,r-o]),t}},{key:"calculateIntersectionInFourDimension",value:function(t,e){var n,r=ue(t,2),o=r[0],i=r[1],a=ue(this.anchor,2),c=a[0],u=a[1],s=this.radius,l=c-o,f=u-i,h=(ce(n={},A.RIGHT,[c+s,u]),ce(n,A.LEFT,[c-s,u]),ce(n,A.BOTTOM,[c,u+s]),ce(n,A.TOP,[c,u-s]),n),p=Math.abs(f)>Math.abs(l)?f<0?A.BOTTOM:A.TOP:l<0?A.RIGHT:A.LEFT;return{p:h[p],dir:p}}},{key:"getBoundingDimension",value:function(){return{width:2*this.radius,height:2*this.radius}}}],n&&le(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Kt),ye=de;function ve(t){return ve="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},ve(t)}function ge(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function be(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return me(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?me(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function me(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function we(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ke(t,e){return ke=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ke(t,e)}function Oe(t,e){if(e&&("object"===ve(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function je(t){return je=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},je(t)}var xe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ke(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=je(r);if(o){var n=je(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Oe(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return we(this,a),(t=i.call(this,e)).type="Rectangle",t.width=e.width||10,t.height=e.height||10,t.borderRadius=e.borderRadius||0,t._setBorder(e),t}return e=a,n=[{key:"_setBorder",value:function(t){var e,n,r,o,i,a,c,u,s,l,f,h,p,d,y,v,g,b,m,w,_,k,O,j;this.border={top:{color:(null===(e=t.border)||void 0===e||null===(n=e.top)||void 0===n?void 0:n.borderColor)||t.borderColor||"transparent",width:(null===(r=t.border)||void 0===r||null===(o=r.top)||void 0===o?void 0:o.borderWidth)||t.borderWidth||0,enable:null===(i=t.border)||void 0===i||null===(a=i.top)||void 0===a?void 0:a.borderWidth},right:{color:(null===(c=t.border)||void 0===c||null===(u=c.right)||void 0===u?void 0:u.borderColor)||t.borderColor||"transparent",width:(null===(s=t.border)||void 0===s||null===(l=s.right)||void 0===l?void 0:l.borderWidth)||t.borderWidth||0,enable:null===(f=t.border)||void 0===f||null===(h=f.right)||void 0===h?void 0:h.borderWidth},bottom:{color:(null===(p=t.border)||void 0===p||null===(d=p.bottom)||void 0===d?void 0:d.borderColor)||t.borderColor||"transparent",width:(null===(y=t.border)||void 0===y||null===(v=y.bottom)||void 0===v?void 0:v.borderWidth)||t.borderWidth||0,enable:null===(g=t.border)||void 0===g||null===(b=g.bottom)||void 0===b?void 0:b.borderWidth},left:{color:(null===(m=t.border)||void 0===m||null===(w=m.left)||void 0===w?void 0:w.borderColor)||t.borderColor||"transparent",width:(null===(_=t.border)||void 0===_||null===(k=_.left)||void 0===k?void 0:k.borderWidth)||t.borderWidth||0,enable:null===(O=t.border)||void 0===O||null===(j=O.left)||void 0===j?void 0:j.borderWidth}},this.borderColor=t.borderColor||"transparent",this.borderWidth=t.borderWidth||0}},{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n],e._rawConfigs[n]=t[n])})),this._setBorder(t)}},{key:"render",value:function(t){t.save(),this._isMoving&&(t.globalAlpha=.6);var e=this.borderRadius,n=(this.anchor,this.width),r=this.height,o=this.anchor[0]-this.width/2,i=this.anchor[1]-this.height/2,a=this.anchor[0]+this.width/2,c=this.anchor[1]+this.height/2;this.borderRadius?(t.beginPath(),t.moveTo(o+e,i),t.lineTo(o+n-e,i),t.quadraticCurveTo(o+n,i,o+n,i+e),t.lineTo(o+n,i+r-e),t.quadraticCurveTo(o+n,i+r,o+n-e,i+r),t.lineTo(o+e,i+r),t.quadraticCurveTo(o,i+r,o,i+r-e),t.lineTo(o,i+e),t.quadraticCurveTo(o,i,o+e,i),t.closePath(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke())):(t.beginPath(),t.rect(this.anchor[0]-this.width/2,this.anchor[1]-this.height/2,this.width,this.height)),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderRadius?this.border.top.enable&&(t.save(),t.beginPath(),t.moveTo(o,i+e),t.quadraticCurveTo(o,i,o+e,i),t.lineTo(o+n-e,i),t.quadraticCurveTo(o+n,i,o+n,i+e),t.closePath(),t.clip(),t.beginPath(),t.rect(o,i,this.width,this.border.top.width),t.fillStyle=this.border.top.color,t.fill(),t.restore()):(this.border.top.width&&(t.beginPath(),t.moveTo(o,i),t.lineTo(a,i),t.strokeStyle=this.border.top.color,t.lineWidth=this.border.top.width,t.stroke()),this.border.right.width&&(t.beginPath(),t.moveTo(a,i),t.lineTo(a,c),t.strokeStyle=this.border.right.color,t.lineWidth=this.border.right.width,t.stroke()),this.border.bottom.width&&(t.beginPath(),t.moveTo(a,c),t.lineTo(o,c),t.strokeStyle=this.border.bottom.color,t.lineWidth=this.border.bottom.width,t.stroke()),this.border.left.width&&(t.beginPath(),t.moveTo(o,c),t.lineTo(o,i),t.strokeStyle=this.border.left.color,t.lineWidth=this.border.left.width,t.stroke())),t.restore()}},{key:"isHit",value:function(t){var e=this.anchor,n=this.width/2,r=this.height/2;return t[0]>e[0]-n&&t[0]<e[0]+n&&t[1]>e[1]-r&&t[1]<e[1]+r}},{key:"getBoundingRect",value:function(){var t=this.anchor,e=this.width/2,n=this.height/2,r=t[0]-e,o=t[1]-n,i=t[0]+e,a=t[1]+n;return[[r,o],[i,o],[i,a],[r,a]]}},{key:"getBoundingDimension",value:function(){return{height:this.height,width:this.width}}},{key:"calculateIntersection",value:function(t){var e,n,r=be(t,2),o=r[0],i=r[1],a=be(this.anchor,2),c=a[0],u=a[1],s=this.width/2,l=this.height/2,f=c-o,h=u-i,p=l/s,d=Math.abs(h/f),y=o>c,v=i>u;return d<p?(e=c+(y?s:-s),n=s*(v?d:-d)+u):(n=u+(v?l:-l),e=l/(y?d:-d)+c),[e,n]}},{key:"getIntersectionsInFourDimension",value:function(){var t,e=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(e=this._belongs.calculateToCoordination(e));var n=be(e,2),r=n[0],o=n[1],i=this.width/2,a=this.height/2;return ge(t={},A.RIGHT,[r+i,o]),ge(t,A.LEFT,[r-i,o]),ge(t,A.BOTTOM,[r,o+a]),ge(t,A.TOP,[r,o-a]),t}},{key:"calculateIntersectionInFourDimension",value:function(t,e){var n,r=be(t,2),o=r[0],i=r[1],a=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(a=this._belongs.calculateToCoordination(a));var c=be(a,2),u=c[0],s=c[1],l=this.width/2,f=this.height/2,h=(ge(n={},A.RIGHT,[u+l,s]),ge(n,A.LEFT,[u-l,s]),ge(n,A.BOTTOM,[u,s+f]),ge(n,A.TOP,[u,s-f]),n),p=u-o,d=s-i,y=f/l,v=o>u,g=Math.abs(d/p)>y?i>s?A.BOTTOM:A.TOP:v?A.RIGHT:A.LEFT;return{p:h[g],dir:g}}}],n&&_e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Kt),Se=xe;function Pe(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Te(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Te(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Te(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ee(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ce(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ee(Object(n),!0).forEach((function(e){Re(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Re(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ie=Ce(Ce(Ce({},xt),St),{},{initGroup:function(t){var e;this.initStack(t),this.initLayout(t),this.padding={top:t.paddingTop||t.padding||0,right:t.paddingRight||t.padding||0,bottom:t.paddingBottom||t.padding||0,left:t.paddingLeft||t.padding||0},this.definedWidth=t.width,this.minWidth=t.minWidth,this.definedHeight=t.height,this.lock=null===(e=t.lock)||void 0===e||e,this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect()},setConfig:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n],e._rawConfigs[n]=t[n])})),this.padding={top:t.paddingTop||t.padding||0,right:t.paddingRight||t.padding||0,bottom:t.paddingBottom||t.padding||0,left:t.paddingLeft||t.padding||0}},_getBoundingGroupRect:function(){var t=Y(this._stack.getBoundingRectPoints()),e=this.padding,n=this.minWidth-e.left-e.right,r=this.definedWidth-e.left-e.right,o=t.width+e.left+e.right,i=t.height+e.top+e.bottom;this.width=n?Math.max(n,o):r||o,this.height=this.definedHeight||i},renderGroup:function(t,e){t.save(),this._isMoving&&(t.globalAlpha=.6);var n=this.anchor;t.save(),e(t),t.restore();var r=this.padding,o=(r.left-r.right)/2,i=(r.top-r.bottom)/2;t.translate(n[0]+o,n[1]+i),this._stack.render(t),this._linkStack.render(t),t.translate(-n[0]-o,-n[1]-i),t.restore()},_calculatePointBack:function(t){var e=Pe(t,2),n=e[0],r=e[1],o=this.padding,i=(o.left-o.right)/2,a=(o.top-o.bottom)/2,c=this.anchor;return[n-c[0]-i,r-c[1]-a]},isHitGroup:function(t,e){var n=this._calculatePointBack(t);return this._currentp=n,this._stack.checkHit(n,e)||!1},calculateToCoordination:function(t){var e=Pe(t,2),n=e[0],r=e[1],o=this.padding,i=(o.left-o.right)/2,a=(o.top-o.bottom)/2,c=this.anchor,u=[n+c[0]+i,r+c[1]+a];return this._belongs&&this._belongs.calculateToCoordination?this._belongs.calculateToCoordination(u):u},calculateToRealWorld:function(t){var e=Pe(t,2),n=e[0],r=e[1],o=this.padding,i=(o.left-o.right)/2,a=(o.top-o.bottom)/2,c=this.anchor,u=[n+c[0]+i,r+c[1]+a];if(this._belongs&&this._belongs.calculateToRealWorld)return this._belongs.calculateToRealWorld(u)},clone:function(){var t=new(0,this.constructor)(Object.assign({},this._rawConfigs,{layout:this._layout&&this._layout.clone()}));return this.interateNodeStack((function(e){t.addToStack(e.clone())})),t.recalculate(),t}}),De=Ie;function Me(t){return Me="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},Me(t)}function Be(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Le(t,e){return Le=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Le(t,e)}function Ae(t,e){if(e&&("object"===Me(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ze(t){return ze=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ze(t)}var Fe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Le(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ze(r);if(o){var n=ze(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Ae(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).initGroup(t),e}return e=a,n=[{key:"render",value:function(t){var e=this;this.renderGroup(t,(function(){Se.prototype.render.call(e,t)}))}},{key:"isHit",value:function(t,e){return this.isHitGroup(t,e)||Se.prototype.isHit.call(this,t)}}],n&&Be(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Se);Object.assign(Fe.prototype,De),Object.assign(Fe.prototype,{setConfig:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n],e._rawConfigs[n]=t[n])})),this.padding={top:t.paddingTop||t.padding||0,right:t.paddingRight||t.padding||0,bottom:t.paddingBottom||t.padding||0,left:t.paddingLeft||t.padding||0},this._setBorder(t)}});var He=Fe;function We(t){return We="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},We(t)}function Ge(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ye(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return $e(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$e(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Xe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ne(t,e){return Ne=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ne(t,e)}function Je(t,e){if(e&&("object"===We(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ue(t){return Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ue(t)}var Ze=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ne(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ue(r);if(o){var n=Ue(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Je(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Xe(this,a),(t=i.call(this,e)).type="Capsule",t.width=e.width||20,t.height=e.height||10,t}return e=a,n=[{key:"render",value:function(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();var e=Ye(this.anchor,2),n=e[0],r=e[1],o=this.width/2,i=this.height/2,a=n-o+i,c=n+o-i,u=r-i,s=r+i;t.moveTo(a,u),t.lineTo(c,u),t.arc(c,r,i,-Math.PI/2,Math.PI/2),t.lineTo(a,s),t.arc(a,r,i,Math.PI/2,Math.PI/2*3),t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}},{key:"isHit",value:function(t){var e=this.anchor,n=this.width/2,r=this.height/2,o=Math.abs(n-r),i=e[0]-n+r,a=e[0]+n-r,c=r*r;return t[0]>e[0]-o&&t[0]<e[0]+o&&t[1]>e[1]-r&&t[1]<e[1]+r||Math.pow(t[0]-i,2)+Math.pow(t[1]-e[1],2)<c||Math.pow(t[0]-a,2)+Math.pow(t[1]-e[1],2)<c}},{key:"getBoundingRect",value:function(){var t=this.anchor,e=this.width/2,n=this.height/2,r=t[0]-e,o=t[1]-n,i=t[0]+e,a=t[1]+n;return[[r,o],[i,o],[i,a],[r,a]]}},{key:"getBoundingDimension",value:function(){return{height:this.height,width:this.width}}},{key:"getIntersectionsInFourDimension",value:function(){var t,e=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(e=this._belongs.calculateToCoordination(e));var n=Ye(e,2),r=n[0],o=n[1],i=this.width/2,a=this.height/2;return Ge(t={},A.RIGHT,[r+i,o]),Ge(t,A.LEFT,[r-i,o]),Ge(t,A.BOTTOM,[r,o+a]),Ge(t,A.TOP,[r,o-a]),t}}],n&&qe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Kt),Ve=Ze;function Ke(t){return Ke="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},Ke(t)}function Qe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function tn(t,e){return tn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},tn(t,e)}function en(t,e){if(e&&("object"===Ke(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function nn(t){return nn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},nn(t)}var rn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tn(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=nn(r);if(o){var n=nn(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return en(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).initGroup(t),e}return e=a,n=[{key:"render",value:function(t){var e=this;this.renderGroup(t,(function(){Ve.prototype.render.call(e,t)}))}},{key:"isHit",value:function(t,e){return this.isHitGroup(t,e)||Ve.prototype.isHit.call(this,t)}}],n&&Qe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ve);Object.assign(rn.prototype,De);var on=rn;function an(t){return an="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},an(t)}function cn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return un(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?un(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function un(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function sn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ln(t,e){return ln=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ln(t,e)}function fn(t,e){if(e&&("object"===an(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function hn(t){return hn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},hn(t)}var pn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ln(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=hn(r);if(o){var n=hn(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return fn(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).initGroup(t),e}return e=a,n=[{key:"render",value:function(t){var e=this;this.renderGroup(t,(function(){t.save(),e._isMoving&&(t.globalAlpha=.6),t.beginPath();var n=cn(e.anchor,2),r=n[0],o=n[1],i=e.width/2,a=e.height/2,c=o-a+i,u=o+a-i,s=r-i,l=r+i;t.moveTo(s,c),t.arc(r,c,i,-Math.PI,0),t.lineTo(l,u),t.arc(r,u,i,0,Math.PI),t.closePath(),t.fillStyle=e.backgroundColor,t.fill(),e.borderWidth&&(t.lineWidth=e.borderWidth,t.strokeStyle=e.borderColor,t.stroke()),t.restore()}))}},{key:"isHit",value:function(t,e){var n=this.isHitGroup(t,e);if(n)return n;var r=cn(this.anchor,2),o=r[0],i=r[1],a=this.width/2,c=this.height/2,u=Math.abs(c-a),s=i-c+a,l=i+c-a,f=a*a;return t[0]>o-a&&t[0]<o+a&&t[1]>i-u&&t[1]<i+u||Math.pow(t[0]-o,2)+Math.pow(t[1]-s,2)<f||Math.pow(t[0]-o,2)+Math.pow(t[1]-l,2)<f}}],n&&sn(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ve);Object.assign(pn.prototype,De);var dn=pn;function yn(t){return yn="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},yn(t)}function vn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function gn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return bn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bn(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function mn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _n(t,e){return _n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},_n(t,e)}function kn(t,e){if(e&&("object"===yn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function On(t){return On=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},On(t)}var jn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_n(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=On(r);if(o){var n=On(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return kn(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return mn(this,a),(t=i.call(this,e)).type="Diamond",t.width=e.width||20,t.height=e.height||10,t.side=e.side||6,t._cacheSide(),t}return e=a,n=[{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n],e._rawConfigs[n]=t[n])})),this._cacheSide()}},{key:"_cacheSide",value:function(){this.sinSIDE=Math.sin(Math.PI/3)*this.side,this.cosSIDE=Math.cos(Math.PI/3)*this.side}},{key:"render",value:function(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();var e=gn(this.anchor,2),n=e[0],r=e[1],o=this.width/2,i=this.height/2,a=i/1.732,c=n-o+a,u=n+o-a,s=n+o,l=n-o,f=r-i,h=r+i,p=this.side,d=this.sinSIDE,y=this.cosSIDE;t.moveTo(n,f),t.lineTo(u-p,f),t.quadraticCurveTo(u,f,u+y,f+d),t.lineTo(s-y,r-d),t.quadraticCurveTo(s,r,s-y,r+d),t.lineTo(u+y,h-d),t.quadraticCurveTo(u,h,u-p,h),t.lineTo(c+p,h),t.quadraticCurveTo(c,h,c-y,h-d),t.lineTo(l+y,r+d),t.quadraticCurveTo(l,r,l+y,r-d),t.lineTo(c-y,f+d),t.quadraticCurveTo(c,f,c+p,f),t.closePath(),t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore(),this._cachePoints=[[u,f],[s,r],[u,h],[c,h],[l,r],[c,f]]}},{key:"isHit",value:function(t){for(var e=this._cachePoints,n=!1,r=0,o=e.length-1;r<e.length;r++)e[r][1]>t[1]!=e[o][1]>t[1]&&t[0]<(e[o][0]-e[r][0])*(t[1]-e[r][1])/(e[o][1]-e[r][1])+e[r][0]&&(n=!n),o=r;return n}},{key:"getBoundingRect",value:function(){var t=this.anchor,e=this.width/2,n=this.height/2,r=t[0]-e,o=t[1]-n,i=t[0]+e,a=t[1]+n;return[[r,o],[i,o],[i,a],[r,a]]}},{key:"getBoundingDimension",value:function(){return{height:this.height,width:this.width}}},{key:"getIntersectionsInFourDimension",value:function(){var t,e=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(e=this._belongs.calculateToCoordination(e));var n=gn(e,2),r=n[0],o=n[1],i=this.width/2,a=this.height/2;return vn(t={},A.RIGHT,[r+i,o]),vn(t,A.LEFT,[r-i,o]),vn(t,A.BOTTOM,[r,o+a]),vn(t,A.TOP,[r,o-a]),t}}],n&&wn(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Kt),xn=jn;function Sn(t){return Sn="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},Sn(t)}function Pn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Tn(t,e){return Tn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Tn(t,e)}function En(t,e){if(e&&("object"===Sn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Cn(t){return Cn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Cn(t)}var Rn=1/Math.sqrt(3),In=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Tn(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Cn(r);if(o){var n=Cn(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return En(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).initGroup(t),e}return e=a,n=[{key:"render",value:function(t){var e=this;this.renderGroup(t,(function(){xn.prototype.render.call(e,t)}))}},{key:"isHit",value:function(t,e){return this.isHitGroup(t,e)||xn.prototype.isHit.call(this,t)}}],n&&Pn(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(xn);Object.assign(In.prototype,De),Object.assign(In.prototype,{_getBoundingGroupRect:function(){var t=Y(this._stack.getBoundingRectPoints()),e=this.padding,n=this.minWidth-e.left-e.right,r=this.definedWidth-e.left-e.right,o=t.width+e.left+e.right+t.height*Rn/2,i=t.height+e.top+e.bottom;this.width=n?Math.max(n,o):r||o,this.height=this.definedHeight||i},setConfig:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n],e._rawConfigs[n]=t[n])})),this.padding={top:t.paddingTop||t.padding||0,right:t.paddingRight||t.padding||0,bottom:t.paddingBottom||t.padding||0,left:t.paddingLeft||t.padding||0},this._cacheSide()}});var Dn=In;function Mn(t){return Mn="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},Mn(t)}function Bn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ln(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function An(t,e){return An=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},An(t,e)}function zn(t,e){if(e&&("object"===Mn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Fn(t){return Fn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Fn(t)}Math.sqrt(3);var Hn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&An(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Fn(r);if(o){var n=Fn(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return zn(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).initGroup(t),e}return e=a,n=[{key:"render",value:function(t){var e=this;this.renderGroup(t,(function(){t.save(),e._isMoving&&(t.globalAlpha=.6),t.beginPath();var n,r,o=(n=e.anchor,r=2,function(t){if(Array.isArray(t))return t}(n)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(n,r)||function(t,e){if(t){if("string"==typeof t)return Bn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bn(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],a=o[1],c=e.width/2,u=e.height/2,s=c/1.732,l=a-u,f=a+u,h=a-u+s,p=a+u-s,d=i-c,y=i+c;t.moveTo(i,l),t.lineTo(y,h),t.lineTo(y,p),t.lineTo(i,f),t.lineTo(d,p),t.lineTo(d,h),t.closePath(),t.fillStyle=e.backgroundColor,t.fill(),e.borderWidth&&(t.lineWidth=e.borderWidth,t.strokeStyle=e.borderColor,t.stroke()),t.restore(),e._cachePoints=[[i,l],[y,h],[y,p],[i,f],[d,p],[d,h]],console.log(e._cachePoints)}))}},{key:"isHit",value:function(t,e){return this.isHitGroup(t,e)||xn.prototype.isHit.call(this,t)}}],n&&Ln(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(xn);Object.assign(Hn.prototype,De),Object.assign(Hn.prototype,{_getBoundingGroupRect:function(){var t=Y(this._stack.getBoundingRectPoints()),e=Y(this._stack.getAnchorRectPoints()),n=this.padding,r=this.minWidth-n.left-n.right,o=this.definedWidth-n.left-n.right,i=t.width+n.left+n.right,a=e.height+i/1.732+n.top+n.bottom;this.width=r?Math.max(r,i):o||i,this.height=this.definedHeight||a}});var Wn=Hn;function Gn(t){return Gn="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},Gn(t)}function Yn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Xn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Nn(t,e){return Nn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Nn(t,e)}function Jn(t,e){if(e&&("object"===Gn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Un(t){return Un=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Un(t)}var Zn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nn(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Un(r);if(o){var n=Un(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Jn(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Xn(this,a),(t=i.call(this,e)).type="Rhombus",t.height=e.diagonalsV||10,t.width=e.diagonalsH||20,t}return e=a,n=[{key:"render",value:function(t){t.save(),this._isMoving&&(t.globalAlpha=.6);var e=this.width/2,n=this.height/2,r=this.anchor;t.translate(r[0],r[1]),t.beginPath(),t.moveTo(0,-n),t.lineTo(e,0),t.lineTo(0,n),t.lineTo(-e,0),t.closePath(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),t.translate(-r[0],-r[1]),t.restore()}},{key:"isHit",value:function(t){var e=this.height/2,n=this.width/2,r=this.anchor;return Math.abs(t[0]-r[0])/n+Math.abs(t[1]-r[1])/e<=1}},{key:"getBoundingRect",value:function(){var t=this.anchor,e=this.width/2,n=this.height/2,r=t[0]-e,o=t[1]-n,i=t[0]+e,a=t[1]+n;return[[r,o],[i,o],[i,a],[r,a]]}},{key:"getBoundingDimension",value:function(){return{height:this.height,width:this.width}}},{key:"getIntersectionsInFourDimension",value:function(){var t,e=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(e=this._belongs.calculateToCoordination(e));var n,r,o=(r=2,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(n,r)||function(t,e){if(t){if("string"==typeof t)return $n(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$n(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],a=o[1],c=this.width/2,u=this.height/2;return Yn(t={},A.RIGHT,[i+c,a]),Yn(t,A.LEFT,[i-c,a]),Yn(t,A.BOTTOM,[i,a+u]),Yn(t,A.TOP,[i,a-u]),Yn(t,A.SELF,[i+.618*c,a+.618*u]),t}}],n&&qn(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Kt),Vn=Zn;function Kn(t){return Kn="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},Kn(t)}function Qn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function tr(t,e){return tr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},tr(t,e)}function er(t,e){if(e&&("object"===Kn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function nr(t){return nr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},nr(t)}var rr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tr(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=nr(r);if(o){var n=nr(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return er(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).initGroup(t),e}return e=a,n=[{key:"render",value:function(t){var e=this;this.renderGroup(t,(function(){Vn.prototype.render.call(e,t)}))}},{key:"isHit",value:function(t,e){return this.isHitGroup(t,e)||Vn.prototype.isHit.call(this,t)}}],n&&Qn(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Vn);Object.assign(rr.prototype,De);var or=rr;function ir(t){return ir="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},ir(t)}function ar(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function cr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ur(t,e){return ur=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ur(t,e)}function sr(t,e){if(e&&("object"===ir(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function lr(t){return lr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},lr(t)}var fr="left",hr="right",pr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ur(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=lr(r);if(o){var n=lr(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return sr(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).type="Text",e.content=t.content||"",e.fontFamily=t.fontFamily||"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",e.fontSize=t.fontSize||"28px",e.textColor=t.textColor||"white",e.textAlign=t.textAlign||"center",e.textBaseline=t.textBaseline||"middle",e.lineHeight=t.lineHeight,e.indent=t.indent||0,e.backgroundColor=t.backgroundColor,e.editable=t.editable,e.acceptPatten=t.acceptPatten,e.minWidth=t.minWidth||0,e.editStatus={editting:!1},f((function(t){e.renderShadowText(t)})),e._makeEditable(),e}return e=a,(n=[{key:"_makeEditable",value:function(){var t=this;this.editable&&this.addEventListener("click",(function(e){var n,r,o,i=t.width/2,a=[t.textAlign===fr?t.anchor[0]-i+t.indent/2:t.textAlign===hr?t.anchor[0]+i:t.anchor[0]+t.indent/2,-t.height/2],c=+/(\d+)/.exec(t.fontSize)[1],u=(r=t.calculateToRealWorld(a),o=2,function(t){if(Array.isArray(t))return t}(r)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(r,o)||function(t,e){if(t){if("string"==typeof t)return ar(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ar(t,e):void 0}}(r,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=u[0],l=u[1],f=((n=document.createElement("input")).setAttribute("style","\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        background-image:none;\n        background-color:transparent;\n        -webkit-box-shadow: none;\n        -moz-box-shadow: none;\n        box-shadow: none;"),n),h=t._jflow.DOMwrapper,p=t.content;f.style.transform="translate(".concat(s,"px, ").concat(l,"px)"),f.style.width=t.calculateToRealWorldWithScalar(t.width)+"px",f.style.height=t.calculateToRealWorldWithScalar(t.height)+"px",f.style.fontFamily=t.fontFamily,h.style.fontSize="".concat(c*t._jflow.scale,"px"),f.style.fontSize="".concat(c*t._jflow.scale,"px"),f.style.lineHeight="".concat(t.lineHeight*t._jflow.scale,"px"),f.style.textIndent="".concat(t.indent*t._jflow.scale,"px"),f.value=t.content,f.style.color=t.textColor,f.addEventListener("focus",(function(){t.content="",t._jflow._render(),f.style.outline="none"}));var d=function(){if(t.acceptPatten);else{var e=f.value;t.dispatchEvent(new Ft("change",{target:t,oldVal:p,val:e})),t.content=p,t._jflow._render(),t._jflow.removeEventListener("zoompan",d),f.removeEventListener("blur",d),h.removeChild(f),f=null,d=null}};t._jflow.addEventListener("zoompan",d),f.addEventListener("blur",d),f.addEventListener("keypress",(function t(e){"Enter"!==e.key&&13!==e.keyCode||(e.preventDefault(),f.removeEventListener("keypress",t),d())})),h.append(f),f.focus()}))}},{key:"renderShadowText",value:function(t){t.beginPath(),t.font="".concat(this.fontSize," ").concat(this.fontFamily),t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.fillStyle=this.textColor;var e=t.measureText(this.content),n=e.actualBoundingBoxLeft,r=e.actualBoundingBoxRight,o=e.fontBoundingBoxAscent,i=e.fontBoundingBoxDescent;this._textWidth=this.indent+Math.abs(n)+Math.abs(r),this.width=Math.max(this.minWidth,this._textWidth);var a=Math.abs(o)+Math.abs(i);this.lineHeight?this.height=this.lineHeight:this.height=a}},{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n],e._rawConfigs[n]=t[n])})),f((function(t){e.renderShadowText(t)}))}},{key:"render",value:function(t){if(t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath(),t.font="".concat(this.fontSize," ").concat(this.fontFamily),t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.fillStyle=this.textColor,this.textAlign===fr){var e=this.width/2;t.fillText(this.content,this.anchor[0]-e+this.indent/2,this.anchor[1])}else if(this.textAlign===hr){var n=this.width/2;t.fillText(this.content,this.anchor[0]+n,this.anchor[1])}else t.fillText(this.content,this.anchor[0]+this.indent/2,this.anchor[1]);t.fill(),t.restore()}}])&&cr(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Se);function dr(t){return dr="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},dr(t)}function yr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vr(t,e){return vr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},vr(t,e)}function gr(t,e){if(e&&("object"===dr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function br(t){return br=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},br(t)}var mr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vr(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=br(r);if(o){var n=br(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return gr(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).image=t.image,e.image.onload=function(){requestAnimationFrame((function(){e._jflow._render()}))},e.imageBounding={width:t.imageWidth||t.width,height:t.imageHeight||t.height},e}return e=a,(n=[{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n],e._rawConfigs[n]=t[n])})),t.image&&!t.image.complete&&(this.image.onload=function(){requestAnimationFrame((function(){e._jflow._render()}))}),this.imageBounding={width:t.imageWidth||t.width||this.imageBounding.width,height:t.imageHeight||t.height||this.imageBounding.height}}},{key:"render",value:function(t){t.save(),this._isMoving&&(t.globalAlpha=.6),Se.prototype.render.call(this,t);var e=this.anchor[0]-this.width/2,n=this.anchor[1]-this.height/2;this.image.complete&&t.drawImage(this.image,e,n,this.imageBounding.width,this.imageBounding.height),t.restore()}}])&&yr(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Se);function wr(t){return wr="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},wr(t)}function _r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function kr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Or(t,e){return Or=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Or(t,e)}function jr(t,e){if(e&&("object"===wr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function xr(t){return xr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},xr(t)}var Sr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Or(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=xr(r);if(o){var n=xr(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return jr(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).from=t.from,e.to=t.to,e.controlPoints=[0,1,-10,1,-10,5],e._cachePoints=null,e.defaultStyle="black",e.hoverStyle="cornflowerblue",e}return e=a,n=[{key:"getColor",value:function(){return this._isTargeting?this.hoverStyle:this.defaultStyle}},{key:"_calculateAnchorPoints",value:function(){var t=this.from.calculateIntersection(this.to.getCenter()),e=this.to.calculateIntersection(this.from.getCenter());return this._cachePoints=[t,e],{startX:t[0],startY:t[1],endX:e[0],endY:e[1]}}},{key:"render",value:function(t){var e=this._calculateAnchorPoints(),n=e.startX,r=e.startY,o=e.endX,i=e.endY,a=this.controlPoints,c=o-n,u=i-r,s=Math.sqrt(c*c+u*u),l=u/s,f=c/s,h=[];h.push(0,0);for(var p=0;p<a.length;p+=2){var d=a[p],y=a[p+1];h.push(d<0?s+d:d,y)}for(h.push(s,0),p=a.length;p>0;p-=2)d=a[p-2],y=a[p-1],h.push(d<0?s+d:d,-y);for(h.push(0,0),t.fillStyle=t.strokeStyle=this.getColor(),t.beginPath(),p=0;p<h.length;p+=2)d=h[p]*f-h[p+1]*l+n,y=h[p]*l+h[p+1]*f+r,0===p?t.moveTo(d,y):t.lineTo(d,y);t.fill()}},{key:"isHit",value:function(t){if(!this._cachePoints)return!1;var e,n,r=(e=this._cachePoints,n=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return _r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_r(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return q(t,r[0],r[1])<6}},{key:"getBoundingRect",value:function(){var t=this._calculateAnchorPoints();return[[t.startX,t.startY],[t.endX,t.endY]]}}],n&&kr(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(ie),Pr=Sr;function Tr(t){return Tr="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},Tr(t)}function Er(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Cr(t,e){return Cr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Cr(t,e)}function Rr(t,e){if(e&&("object"===Tr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ir(t){return Ir=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ir(t)}var Dr=Math.PI/180,Mr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Cr(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ir(r);if(o){var n=Ir(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Rr(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).approximate=t.approximate||6,e.radius=t.radius||0,e.minSpanX=t.minSpanX||10,e.minSpanY=t.minSpanY||10,e.lineDash=t.lineDash,e.doubleLink=t.doubleLink,e.fontFamily=t.fontFamily="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",e.fontSize=t.fontSize||"12px",e.content=t.content||"",e.isSelf=!!t.isSelf,e}return e=a,n=[{key:"_calculateAnchorPoints",value:function(){var t=this.from.getIntersectionsInFourDimension(),e=this.to.getIntersectionsInFourDimension();if(this.isSelf){var n=V(t[this.fromDir],e[A.SELF],this.fromDir,A.BOTTOM,this.minSpanX,this.minSpanY,!0);this._cachePoints=n,this._cacheAngle=[this.fromDir,A.BOTTOM]}else if(void 0!==this.fromDir&&void 0!==this.toDir){var r=V(t[this.fromDir],e[this.toDir],this.fromDir,this.toDir,this.minSpanX,this.minSpanY);this._cachePoints=r,this._cacheAngle=[this.fromDir,this.toDir]}else{var o=N(t,e);console.log(o);var i=V(o.fromP,o.toP,o.fromDir,o.toDir,this.minSpanX,this.minSpanY);this._cachePoints=i,this._cacheAngle=[o.fromDir,o.toDir]}}},{key:"render",value:function(t){var e=this;this._calculateAnchorPoints();var n=this.radius,r=this._cachePoints,o=r[0],i=r[r.length-1],a=(this._cacheAngle[1]+2)%4*90*Dr;if(t.fillStyle=t.strokeStyle=this.backgroundColor,this.doubleLink){var c=(this._cacheAngle[0]+2)%4*90*Dr;t.beginPath(),t.translate(o[0],o[1]),t.rotate(c),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-c),t.translate(-o[0],-o[1])}t.beginPath(),t.moveTo(o[0],o[1]),r.slice(1,r.length-1).forEach((function(o,i){if(e.radius){var a=function(t,e,n,r){var o=K(e,t),i=K(e,n),a=Q(o),c=Q(i);if(!a||!c)return{p1:null,p2:null};var u=tt(o,r/a),s=tt(i,r/c);return{p1:K(e,u),p2:K(e,s)}}(r[i],o,r[i+2],n),c=a.p1,u=a.p2;c&&u?(t.lineTo(c[0],c[1]),t.quadraticCurveTo(o[0],o[1],u[0],u[1])):t.lineTo(o[0],o[1])}else t.lineTo(o[0],o[1])})),t.lineTo(i[0],i[1]),this.lineDash&&(t.save(),t.setLineDash(this.lineDash)),t.stroke(),this.lineDash&&t.restore(),t.beginPath(),t.translate(i[0],i[1]),t.rotate(a),t.moveTo(0,0),t.lineTo(-5,-4),t.lineTo(-5,4),t.lineTo(0,0),t.fill(),t.rotate(-a),t.translate(-i[0],-i[1])}},{key:"isHit",value:function(t){var e=this._cachePoints,n=e[0],r=e.slice(1);do{var o=r.shift();if(o&&q(t,n,o)<this.approximate)return!0;n=o}while(n);return!1}}],n&&Er(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(ie),Br=Mr;function Lr(t){return Lr="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},Lr(t)}function Ar(t){return function(t){if(Array.isArray(t))return Fr(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||zr(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zr(t,e){if(t){if("string"==typeof t)return Fr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Fr(t,e):void 0}}function Fr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Hr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Wr(t,e){return Wr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Wr(t,e)}function Gr(t,e){if(e&&("object"===Lr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Yr(t){return Yr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Yr(t)}var $r=Math.PI/180,Xr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wr(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Yr(r);if(o){var n=Yr(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Gr(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).approximate=t.approximate||6,e.minSpanX=t.minSpanX||0,e.minSpanY=t.minSpanY||0,e.lineDash=t.lineDash,e.doubleLink=t.doubleLink,e.fontFamily=t.fontFamily="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",e.fontSize=t.fontSize||"12px",e.content=t.content||"",e.isSelf=!!t.isSelf,e}return e=a,n=[{key:"_calculateAnchorPoints",value:function(){var t=this.from.getIntersectionsInFourDimension(),e=this.to.getIntersectionsInFourDimension();if(this.isSelf){var n=U(t[this.fromDir],e[A.SELF],this.fromDir,A.BOTTOM,this.minSpanX,this.minSpanY);this._cachePoints=[].concat(Ar(t[this.fromDir]),Ar(n)),console.log(n),this._cacheAngle=[this.fromDir,A.BOTTOM]}else if(void 0!==this.fromDir&&void 0!==this.toDir){var r=U(t[this.fromDir],e[this.toDir],this.fromDir,this.toDir,this.minSpanX,this.minSpanY);this._cachePoints=[].concat(Ar(t[this.fromDir]),Ar(r)),this._cacheAngle=[this.fromDir,this.toDir]}else{var o=N(t,e),i=U(o.fromP,o.toP,o.fromDir,o.toDir);this._cachePoints=[].concat(Ar(o.fromP),Ar(i)),this._cacheAngle=[o.fromDir,o.toDir]}}},{key:"render",value:function(t){this._calculateAnchorPoints();var e,n,r=this._cachePoints,o=Z.apply(null,[1].concat(Ar(r)));if(t.fillStyle=t.strokeStyle=this.backgroundColor,this.doubleLink){var i=(this._cacheAngle[0]+2)%4*90*$r;t.beginPath(),t.translate(r[0],r[1]),t.rotate(i),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-i),t.translate(-r[0],-r[1])}if(t.beginPath(),t.moveTo(r[0],r[1]),t.bezierCurveTo.apply(t,Ar(r.slice(2))),this.lineDash&&(t.save(),t.setLineDash(this.lineDash)),t.stroke(),this.lineDash&&t.restore(),t.beginPath(),t.translate(r[6],r[7]),t.rotate(o),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-o),t.translate(-r[6],-r[7]),this.content){t.beginPath();var a=function(t,e){var n=.5,r=.125*e[0]+.375*e[2]+.375*e[4]+.125*e[6],o=.125*e[1]+.375*e[3]+.375*e[5]+.125*e[7],i=n*n*(e[2]-e[0])+.5*(e[4]-e[2])+t*t*(e[6]-e[4]),a=n*n*(e[3]-e[1])+.5*(e[5]-e[3])+t*t*(e[7]-e[5]);return[r,o,Math.atan2(a,i)]}(.5,r),c=(n=3,function(t){if(Array.isArray(t))return t}(e=a)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,n)||zr(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=c[0],s=c[1],l=c[2];t.translate(u,s),t.rotate(l),t.font="".concat(this.fontSize," ").concat(this.fontFamily),t.textAlign="center",t.fillText(this.content,0,10),t.rotate(-l),t.translate(-u,-s)}}},{key:"isHit",value:function(t){if(!this._cachePoints)return!1;var e=function(t,e){var n=z(L,W(e)).project({x:t[0],y:t[1]});return X(t,[n.x,n.y])}(t,this._cachePoints);return e<this.approximate}},{key:"getBoundingRect",value:function(){var t=this._calculateAnchorPoints();return[[t.startX,t.startY],[t.endX,t.endY]]}}],n&&Hr(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(ie),qr=Xr;function Nr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ur=function(){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Nr(this,t),this.direction=n.direction||"vertical",this.gap=null!==(e=n.gap)&&void 0!==e?e:5,this.alignment=n.alignment||"center",this.justify=n.justify||"center",this._rawConfigs=n}var e,n;return e=t,n=[{key:"reflow",value:function(t){var e=this,n=t._stack.filter((function(t){return t.visible&&!t.absolutePosition})),r=t._stack.filter((function(t){return t.visible&&t.absolutePosition})),o=t.width-t.padding.left-t.padding.right;if("vertical"===this.direction){var i=0,a=0,c=0,u=0;n.forEach((function(t,n){var r=t.getBoundingDimension(),o=r.width,s=r.height,l=n>0?e.gap:0;c=Math.max(o,c),u+=s+l,i+=s/2+l+a,a=s/2,t.anchor=[0,i]})),c=Math.max(o,c),u/=2,"start"===this.alignment&&n.forEach((function(t,e){var n=t.getBoundingDimension().width;t.anchor[0]=-(c-n)/2,t.anchor[1]-=u})),"end"===this.alignment&&n.forEach((function(t,e){var n=t.getBoundingDimension().width;t.anchor[0]=(c-n)/2,t.anchor[1]-=u})),"center"===this.alignment&&n.forEach((function(t,e){t.getBoundingDimension().width,t.anchor[1]-=u}))}if("horizontal"===this.direction){var s=0,l=0,f=0,h=0;if(n.forEach((function(t,n){var r=t.getBoundingDimension(),o=r.width,i=r.height,a=n>0?e.gap:0;f=Math.max(i,f),h+=o+a,s+=o/2+a+l,l=o/2,t.anchor=[s,0]})),"start"===this.justify){var p=o/2;n.forEach((function(t,e){t.anchor[0]-=p}))}if("end"===this.justify){var d=o/2-h;n.forEach((function(t,e){t.anchor[0]+=d}))}if("center"===this.justify){var y=h/2;n.forEach((function(t,e){t.anchor[0]-=y}))}if("space-between"===this.justify&&n.length>1){var v=Math.max(o,h),g=(v-h)/(n.length-1),b=v/2;n.forEach((function(t,e){t.anchor[0]+=g*e-b}))}"start"===this.alignment&&n.forEach((function(t,e){var n=t.getBoundingDimension().height;t.anchor[1]=-(f-n)/2})),"end"===this.alignment&&n.forEach((function(t,e){var n=t.getBoundingDimension().height;t.anchor[1]=(f-n)/2}))}if(r.length){t._getBoundingGroupRect();var m=t.width/2,w=t.height/2;r.forEach((function(t){t.anchor=e._resolveAbsoluteAnchor(t.absolutePosition,t,m,w)}))}}},{key:"_resolveAbsoluteAnchor",value:function(t,e,n,r){var o=t.top,i=t.right,a=t.bottom,c=t.left,u=e.getBoundingDimension(),s=u.width/2,l=u.height/2,f=0,h=0;return o&&(f=o+l-r),i&&(h=n-i-s),a&&(f=r-a-l),c&&(h=c+s-n),[h,f]}},{key:"clone",value:function(){return new t(this._rawConfigs)}}],n&&Jr(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Zr=Ur;function Vr(t){return Vr="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},Vr(t)}function Kr(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qr(t,e)}function Qr(t,e){return Qr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Qr(t,e)}function to(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ro(t);if(e){var o=ro(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return eo(this,n)}}function eo(t,e){if(e&&("object"===Vr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return no(t)}function no(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ro(t){return ro=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ro(t)}function oo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function io(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ao(t,e,n){return e&&io(t.prototype,e),n&&io(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var co=function(){function t(e){var n=this;oo(this,t),this.source=e,this.id=e.id,this.type=e.type,this.isDraggable=!0,this.getJflowInstance=void 0,this.level=void 0,this.sequence=void 0,this.isLocked=!1,this.isFree=!1,this.parent=void 0,this.idx=void 0,this.parentIterateType=void 0,e._getAstNode=function(){return n}}return ao(t,[{key:"reflowPreCalculate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return this.level=t,this.sequence=e,this.spanX=1,this.spanY=1,n&&n(t,e,this),{spanX:this.spanX,spanY:this.spanY,level:t,sequence:e}}},{key:"makeLink",value:function(t){return this}},{key:"makeEndpoint",value:function(){}},{key:"traverse",value:function(t){t(this)}},{key:"getNodes",value:function(){var t=[];return this.traverse((function(e){e.getJflowInstance&&t.push(e.getJflowInstance())})),t}},{key:"linkSource",value:function(t){this.parent.source[this.parentIterateType].splice(this.idx+1,0,t)}},{key:"remove",value:function(){this.parent.source[this.parentIterateType].splice(this.idx,1)}}]),t}(),uo=function(t){Kr(n,t);var e=to(n);function n(t){var r;oo(this,n),(r=e.call(this,t)).isroot=!0,r.body=(t.body||[]).map(vo("body").bind(no(r)));var o=vo("playground").bind(no(r));return r.playground=(t.playground||[]).map((function(t,e){var n=o(t,e);return n.isFree=!0,n})),r}return ao(n,[{key:"reflowBodyPreCalculate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=1,o=1;return this.level=t,this.sequence=e,n&&n(t,e,this),this.body.forEach((function(i){var a=i.reflowPreCalculate(t+1,e,n),c=a.spanX,u=a.spanY;r=Math.max(c,r),o+=u,t+=u})),this.spanX=r,this.spanY=o,{spanX:r,spanY:o,level:t,sequence:e}}},{key:"reflowPlaygroundPreCalculate",value:function(t,e){this.playground.forEach((function(n){t(n),n.reflowPreCalculate(0,0,e)}))}},{key:"makeLink",value:function(t){var e;return this.body.forEach((function(n){e?(t({from:e.id,to:n.id,part:"body",fromDir:A.BOTTOM,toDir:A.TOP,meta:{from:e,to:n}}),n=n.makeLink(t),e=n):e=n})),this.playground.forEach((function(e){e.makeLink(t)})),this}},{key:"traverse",value:function(t){this.body.forEach((function(e){e.traverse(t)})),this.playground.forEach((function(e){e.traverse(t)}))}}]),n}(co),so=function(t){Kr(n,t);var e=to(n);function n(t){var r;return oo(this,n),(r=e.call(this,t)).consequent=(t.consequent||[]).map(vo("consequent").bind(no(r))),r.alternate=(t.alternate||[]).map(vo("alternate").bind(no(r))),r.isLocked=!0,r}return ao(n,[{key:"reflowPreCalculate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=1,o=1;this.level=t,this.sequence=e,n&&n(t,e,this);var i=1,a=0,c=0,u=0;this.consequent.forEach((function(r,o){var c=r.reflowPreCalculate(t+1,e,n),u=c.spanX,s=c.spanY;i=Math.max(i,u),a+=s,t+=s}));var s=e+i;t=this.level,this.alternate.forEach((function(e,r){var o=e.reflowPreCalculate(t+1,s,n),i=o.spanX,a=o.spanY;c=Math.max(c,i),u+=a,t+=a})),r=Math.max(1,i+c),o+=Math.max(a,u),t=this.level+o-1;var l=this.Endpoint.reflowPreCalculate(t+1,e,n),f=l.spanY;return o+=f,this.spanX=r,this.spanY=o,{spanX:r,spanY:o,level:t,sequence:e}}},{key:"makeLink",value:function(t){var e=this,n=this;this.consequent.forEach((function(e){t({from:n.id,to:e.id,part:"consequent",fromDir:A.BOTTOM,toDir:A.TOP,meta:{from:n,to:e}}),e=e.makeLink(t),n=e})),t({from:n.id,to:this.Endpoint.id,fromDir:A.BOTTOM,toDir:A.TOP,part:"consequent",meta:{from:n,to:this.Endpoint}});var r=this;return this.alternate.forEach((function(n){t({from:r.id,to:n.id,fromDir:r===e?A.RIGHT:A.BOTTOM,toDir:A.TOP,part:"alternate",meta:{from:r,to:n}}),n=n.makeLink(t),r=n})),t({from:r.id,to:this.Endpoint.id,fromDir:r===this?A.RIGHT:A.BOTTOM,toDir:A.RIGHT,part:"alternate",meta:{from:r,to:this.Endpoint}}),this.Endpoint}},{key:"makeEndpoint",value:function(){this.Endpoint=go({type:"endpoint",id:"".concat(this.id,"-endpoint")}),this.Endpoint.parent=this.parent,this.Endpoint.idx=this.idx,this.Endpoint.parentIterateType=this.parentIterateType}},{key:"traverse",value:function(t){t(this),this.consequent.forEach((function(e){e.traverse(t)})),this.alternate.forEach((function(e){e.traverse(t)})),t(this.Endpoint)}},{key:"linkSource",value:function(t,e){this.source[e.part].unshift(t)}}]),n}(co),lo=function(t){Kr(n,t);var e=to(n);function n(t){var r;return oo(this,n),(r=e.call(this,t)).cases=(t.cases||[]).map(vo("case").bind(no(r))),r.cases.length&&(r.cases[r.cases.length-1].lastCase=!0),r.isLocked=!0,r}return ao(n,[{key:"reflowPreCalculate",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,o=1,i=1;this.level=e,this.sequence=n,r&&r(e,n,this);var a=1,c=0;if(this.cases.length){var u=this.cases[this.cases.length-1].consequent;e=this.level,u.forEach((function(t){var o=t.reflowPreCalculate(e+1,n,r),i=o.spanX,u=o.spanY;a=Math.max(a,i),c+=u,e+=u}))}var s=a,l=0;this.cases.forEach((function(o,i){var a=n+s,c=0,u=0;e=t.level,o.alternate.forEach((function(t){var n=t.reflowPreCalculate(e+1,a,r),o=n.spanX,i=n.spanY;c=Math.max(c,o),u+=i,e+=i})),s+=c,l=Math.max(l,u)})),o=Math.max(1,s),i=Math.max(c,l),e=this.level+i;var f=this.Endpoint.reflowPreCalculate(e+1,n,r),h=f.spanY;return i+=h,i+=1,this.spanX=o,this.spanY=i,{spanX:o,spanY:i,level:e,sequence:n}}},{key:"makeLink",value:function(t){var e=this,n=this;return this.cases.length&&this.cases[this.cases.length-1].consequent.forEach((function(e,r){t({from:n.id,to:e.id,fromDir:A.BOTTOM,toDir:A.TOP,part:"consequent",meta:{from:n,to:e}}),n=e.makeLink(t)})),t({from:n.id,to:this.Endpoint.id,fromDir:A.BOTTOM,toDir:A.TOP,part:"alternate",meta:{from:n,to:this.Endpoint}}),this.cases.forEach((function(n,r){var o=n;n.alternate.forEach((function(e){t({from:o.id,to:e.id,fromDir:o===n?A.RIGHT:A.BOTTOM,toDir:A.TOP,part:"alternate",meta:{from:o,to:e}}),o=e.makeLink(t)})),t({from:o.id,to:e.Endpoint.id,fromDir:o===n?A.RIGHT:A.BOTTOM,toDir:A.RIGHT,part:"alternate",minSpanX:32*(r+1),meta:{from:o,to:e.Endpoint}})})),this.Endpoint}},{key:"makeEndpoint",value:function(){this.Endpoint=go({type:"endpoint",id:"".concat(this.id,"-endpoint")}),this.Endpoint.parent=this.parent,this.Endpoint.parentIterateType=this.parentIterateType,this.Endpoint.idx=this.idx}},{key:"traverse",value:function(t){t(this),this.cases.forEach((function(e){e.traverse(t)})),t(this.Endpoint)}}]),n}(co),fo=function(t){Kr(n,t);var e=to(n);function n(){return oo(this,n),e.apply(this,arguments)}return ao(n)}(co),ho=function(t){Kr(n,t);var e=to(n);function n(t){var r;return oo(this,n),(r=e.call(this,t)).body=(t.body||[]).map(vo("body").bind(no(r))),r.isLocked=!0,r}return ao(n,[{key:"reflowPreCalculate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=1,o=1;this.level=t,this.sequence=e,n&&n(t,e,this);var i=e+1;return this.body.forEach((function(e){var a=e.reflowPreCalculate(t+1,i,n),c=a.spanX,u=a.spanY;r=Math.max(c,r),o+=u,t+=u})),this.spanX=r+1,this.spanY=o,{spanX:r,spanY:o,level:t,sequence:e}}},{key:"makeLink",value:function(t){var e=this,n=this;return this.body.forEach((function(r,o){t({from:n.id,to:r.id,part:"body",fromDir:n===e?A.RIGHT:A.BOTTOM,toDir:A.TOP,meta:{from:n,to:r}}),r=r.makeLink(t),n=r})),t({from:n.id,to:this.id,part:"body",fromDir:n===this?A.RIGHT:A.BOTTOM,anticlock:n===this,toDir:A.BOTTOM,isSelf:!0,minSpanX:20,minSpanY:20,meta:{from:n,to:this}}),this}},{key:"traverse",value:function(t){t(this),this.body.forEach((function(e){e.traverse(t)}))}},{key:"linkSource",value:function(t,e){this.source[e.part].unshift(t)}}]),n}(co),po=function(t){Kr(n,t);var e=to(n);function n(t){var r;return oo(this,n),(r=e.call(this,t)).consequent=(t.consequent||[]).map(vo("consequent").bind(no(r))),r.alternate=(t.alternate||[]).map(vo("alternate").bind(no(r))),r.lastCase=!1,r}return ao(n,[{key:"reflowPreCalculate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=1,o=1;this.level=t,this.sequence=e,n&&n(t,e,this);var i=0,a=0,c=0,u=0;this.lastCase&&this.consequent.forEach((function(r,o){var c=r.reflowPreCalculate(t+1,e,n),u=c.spanX,s=c.spanY;i=Math.max(i,u),a+=s,t+=s}));var s=e+Math.max(i,1);return t=this.level,this.alternate.forEach((function(e,r){var o=e.reflowPreCalculate(t+1,s,n),i=o.spanX,a=o.spanY;c=Math.max(c,i),u+=a,t+=a})),r=Math.max(1,i+c),o+=Math.max(a,u),this.spanX=r,this.spanY=o,{spanX:r,spanY:o,level:t,sequence:e}}},{key:"traverse",value:function(t){t(this),this.consequent.forEach((function(e){e.traverse(t)})),this.alternate.forEach((function(e){e.traverse(t)}))}},{key:"linkSource",value:function(t,e){this.source[e.part].unshift(t)}}]),n}(co),yo={IfStatement:so,SwitchStatement:lo,SwitchCase:po,ForEachStatement:fo,WhileStatement:ho,Root:uo,other:co};function vo(t){return function(e,n){var r=go(e);return r.parent=this,r.idx=n,r.parentIterateType=t,r.makeEndpoint(),r}}function go(t){var e=t.type;return new(yo[e]||yo.other)(t)}function bo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mo(t){return t*t}var wo=function(){function t(e){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.linkLength=e.linkLength||18,this.gap=e.gap||30,this.treeItemDraggable=null===(n=e.treeItemDraggable)||void 0===n||n,this.reOrder(e.ast),this.static=!0}var e,n;return e=t,n=[{key:"reOrder",value:function(t){var e=this;this.ast=t,this.flowStack=[],this.flowLinkStack=[],this.root=go(this.ast),this.root.traverse((function(t){"playground"!==t.parentIterateType&&(t.isDraggable=e.treeItemDraggable),e.flowStack.push({type:t.type,configs:t.source,layoutMeta:t})}));var n,r={vertical:{},horizontal:{}},o={};this.root.reflowBodyPreCalculate(0,0,(function(t,e,n){n.isroot||(r.vertical[t]||(r.vertical[t]={}),r.vertical[t][e]=n,r.horizontal[e]||(r.horizontal[e]={}),r.horizontal[e][t]=n)})),this.root.reflowPlaygroundPreCalculate((function(t){n=t.id,o[t.id]={vertical:{},horizontal:{},node:t}}),(function(t,e,r){var i=o[n];i.vertical[t]||(i.vertical[t]={}),i.vertical[t][e]=r,i.horizontal[e]||(i.horizontal[e]={}),i.horizontal[e][t]=r})),this.layoutMapping=r,this.playgroundLayoutMapping=o,this.root.makeLink((function(t){e.flowLinkStack.push(t)}))}},{key:"staticCheck",value:function(t,e){if(t._layoutNode&&t._layoutNode.isFree)return!1;if(!e._linkStack.find((function(e){return e.from===t||e.to===t})))return!1;var n,r,o=t.anchor.slice();return e.reflow(),e._linkStack.length<2?void 0:(r=t.anchor,mo((n=o)[0]-r[0])+mo(n[1]-r[1])>1e3&&(t.dispatchEvent(new Ft("outOfFlow",{anchor:o,instance:t,jflow:e,point:o})),!0))}},{key:"reflowByMapping",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.linkLength,o=this.gap,i=t.vertical,a=t.horizontal,c=e;Object.keys(a).forEach((function(t,e){var n=a[t],r=0,i=Object.keys(n);i.forEach((function(t){var e=n[t].getJflowInstance().getBoundingDimension().width;r=Math.max(e,r)})),c+=0===e?0:r/2,i.forEach((function(t){n[t].getJflowInstance().anchor[0]=c})),c+=r/2+o}));var u=n;Object.keys(i).forEach((function(t,e){var n=i[t],o=0,a=Object.keys(n);a.forEach((function(t){var e=n[t].getJflowInstance().getBoundingDimension(),r=e.height;e.width,o=Math.max(r,o)})),u+=0===e?0:o/2,a.forEach((function(t){n[t].getJflowInstance().anchor[1]=u})),u+=o/2+r}))}},{key:"findLayoutNode",value:function(t){var e=this.flowStack.find((function(e){return e.configs===t}));return e?e.layoutMeta:null}},{key:"reflow",value:function(t){var e=this;this.reflowByMapping(this.layoutMapping),Object.values(this.playgroundLayoutMapping).forEach((function(t){var n=t.node.getJflowInstance();e.reflowByMapping(t,n.anchor[0],n.anchor[1])}))}}],n&&bo(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),_o=wo;function ko(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Oo(t,e,n){return e&&ko(t.prototype,e),n&&ko(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function jo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var xo=Oo((function t(e,n,r){jo(this,t),this.type="ERProperty",this.source=e,this.node=n,this.ref=e.ref,this.type=e.type,this.association=e.association,this.id=r?"".concat(n.id,"-").concat(e.name,"-navigation"):"".concat(n.id,"-").concat(e.name),this._selfLink=!1,this.parentPropertyRef=void 0,this.getJflowInstance=void 0,this.doubleRef=void 0})),So=function(){function t(e){var n=this;jo(this,t),this.type="ERNode",this.source=e,this.id=e.name,this.isDraggable=!0,this.getJflowInstance=void 0,this.propertyList=e.propertyList.map((function(t){return new xo(t,n)})),this.navigationPropertyList=e.navigationPropertyList.map((function(t){return new xo(t,n,!0)})),this.idProperty=this.propertyList.find((function(t){return"id"===t.source.name}))}return Oo(t,[{key:"_traverseProperty",value:function(t){var e=this;this.propertyList.forEach((function(n){var r=n.source.idRef;if(n.source.isParentRef,r&&"Array"!==n.source.type&&t[r]){var o=t[r];n.source.isParentRef&&(e.parentRef=o),o===e&&(n._selfLink=!0),n.parentPropertyRef=o.idProperty}})),this.navigationPropertyList.forEach((function(n){var r=n.source.objectRef;if(r&&t[r]){var o=t[r],i=o.navigationPropertyList.find((function(t){return t.source.objectRef===e.id}));o===e&&(n._selfLink=!0),n.doubleRef=i}}))}},{key:"traverse",value:function(e){e(this),this.propertyList.forEach((function(n){n.ref instanceof t&&e(n)}))}},{key:"makeLink",value:function(t){this.propertyList.forEach((function(e){if(e.parentPropertyRef instanceof xo){var n=e.parentPropertyRef;e._selfLink?t({from:e.id,to:n.id,part:"property",fromDir:A.LEFT,toDir:A.LEFT,content:e.association,minSpanX:80,meta:{from:e,to:n}}):t({from:e.id,to:n.id,part:"property",content:e.association,meta:{from:e,to:n}})}})),this.navigationPropertyList.forEach((function(e){if(e.doubleRef instanceof xo){var n=e.doubleRef;e._selfLink?t({from:e.id,to:n.id,part:"property",fromDir:A.LEFT,toDir:A.TOP,lineDash:[10,5],doubleLink:!0,content:e.association,minSpanX:80,minSpanY:80,meta:{from:e,to:n}}):t({from:e.id,to:n.id,part:"property",lineDash:[10,5],doubleLink:!0,content:e.association,meta:{from:e,to:n,isObjectRef:!0}})}}))}}]),t}();function Po(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function To(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Eo=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.static=!1,this.flowStack=[],this.flowLinkStack=[],this.erNodes=[],this.reOrder(e.entityRelationship)}var e,n;return e=t,n=[{key:"reOrder",value:function(t,e){var n=this;this.er=t,this.flowStack=[],this.flowLinkStack=[];var r=function(t){var e={},n=t.map((function(t){var n=new So(t);return e[t.name]=n,n}));return n.forEach((function(t){t._traverseProperty(e)})),n}(this.er),o=[];r.forEach((function(t){t.traverse((function(t){n.flowStack.push({type:t.type,configs:t.source,layoutMeta:t})})),t.makeLink((function(t){var e=t.from,r=t.to,i=t.meta;if(i.isObjectRef){var a="".concat(e,"-").concat(r),c="".concat(r,"-").concat(e),u=i.from;if(o.includes(a)||o.includes(c))return;u.source.isParentRef||(o.push(a),o.push(c),n.flowLinkStack.push(t))}else n.flowLinkStack.push(t)}))})),this.erNodes=r}},{key:"staticCheck",value:function(t,e){return!1}},{key:"reflow",value:function(t){this.flowLinkStack,this.erNodes;var e={},n=1e3;function r(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=[0,0];return t.parentRef?e.includes(t.parentRef)?[o[0]-500+t.source.diagramWeight*n,o[1]]:(e.push(t.parentRef),[(o=r(t.parentRef,e))[0]-500+t.source.diagramWeight*n,o[1]+600]):o}this.erNodes.forEach((function(t){var n,o,i=t.getJflowInstance(),a=(n=r(t),o=2,function(t){if(Array.isArray(t))return t}(n)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(n,o)||function(t,e){if(t){if("string"==typeof t)return Po(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Po(t,e):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=a[0],u=a[1];e[u]||(e[u]=[]),e[u].push(t),i.anchor=[c+500*e[u].length,u]}))}}],n&&To(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Co=Eo;function Ro(t){return Ro="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)},Ro(t)}function Io(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Do(t,e){if(e&&("object"===Ro(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Mo(t){var e="function"==typeof Map?new Map:void 0;return Mo=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return Bo(t,arguments,zo(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Ao(r,t)},Mo(t)}function Bo(t,e,n){return Bo=Lo()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&Ao(o,n.prototype),o},Bo.apply(null,arguments)}function Lo(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Ao(t,e){return Ao=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ao(t,e)}function zo(t){return zo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},zo(t)}var Fo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ao(t,e)}(a,t);var e,n,r,o,i=(e=a,n=Lo(),function(){var t,r=zo(e);if(n){var o=zo(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return Do(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this)).uniqueName="jflow",e.eventAdapter=new Yt(t.eventAdapter),e.initStack(t),e.initLayout(t),e.ctx=null,e.canvas=null,e.dpr=1,e.padding=20,e.position=null,e.scale=null,e.initialZoom=t.initialZoom,e.maxZoom=t.maxZoom||3,e.minZoom=t.minZoom||.5,e.offeset=null,e._lastState={x:null,y:null,dragging:!1,processing:!1},e._lastDragState={target:null,targetLink:null,processing:!1},e._target={instance:null,link:null,moving:null,isInstanceDirty:!1,isLinkDirty:!1,cache:{stack:null,belongs:null,point:null},meta:{x:void 0,y:void 0,initialX:void 0,initialY:void 0},status:{dragovering:!1,dragging:!1,processing:!1}},e._focus={instance:null},e._dragOverTarget=null,e.allowDrop=t.allowDrop,e._tempInstance=null,e}return r=a,o=[{key:"setTempDraggingInstance",value:function(t){t._belongs=this,this._tempInstance=t,Object.assign(this._target,{moving:[this._tempInstance],dragging:!0})}},{key:"removeTempDraggingInstance",value:function(){if(this._tempInstance){var t=this._tempInstance.anchor;return this._tempInstance=null,t}}},{key:"$mount",value:function(t){var e=function(t){var e=document.createElement("canvas"),n=e.getContext("2d"),r=t.getBoundingClientRect(),o=r.width,i=r.height,a=r.left,c=r.top;e.style.width=o+"px",e.style.height=i+"px",e.style.userSelect="none";var u=window.devicePixelRatio;return e.width=Math.floor(o*u),e.height=Math.floor(i*u),t&&(t.style.position="relative",t.append(e)),{canvas:e,width:o,height:i,raw_width:e.width,raw_height:e.height,left:a,top:c,ctx:n,scale:u}}(t),n=e.canvas,r=e.ctx,o=e.scale,i=e.width,a=e.height,c=e.raw_width,u=e.raw_height;e.left,e.top,this.reflow(),this.ctx=r,this.DOMwrapper=t,this.canvas=n,this.canvasMeta={width:c,height:u,actual_width:i,actual_height:a},this.dpr=o,this._createEventHandler(),this._getBoundingGroupRect();var s,l=this.padding,f=this.bounding_box,h=f.width,p=f.height,d=f.x,y=f.y,v={x:l,y:l,width:i-2*l,height:a-2*l},g={x:0,y:0,offsetX:0,offsetY:0},b=v.width/h,m=v.height/p,w=b<=m?"x":"y";s=this.initialZoom?this.initialZoom:Math.min(b,m),this.scale=s,s>this.maxZoom&&(this.maxZoom=s),s<this.minZoom&&(this.minZoom=s),g.x="x"===w?v.x:(v.width-h*s)/2+l,g.y="y"===w?v.y:(v.height-p*s)/2+l,g.offsetX=g.x-d*s,g.offsetY=g.y-y*s,this.position=g,this._render()}},{key:"_getBoundingGroupRect",value:function(){var t=this._stack.getBoundingRectPoints();if(this.bounding_box){this.bounding_box=Y(t);var e=this.bounding_box,n=e.x,r=e.y,o=this.scale;this.position.x=this.position.offsetX+n*o,this.position.y=this.position.offsetY+r*o}else this.bounding_box=Y(t)}},{key:"_createEventHandler",value:function(){var t,e=this,n=this.canvas;this.eventAdapter.apply(this);var r=function(){e.eventAdapter.unload(e)};if(t=r,this.allowDrop){var o=this._onDragover.bind(this),i=this._onDrop.bind(this);n.addEventListener("dragover",o),n.addEventListener("drop",i),t=function(){r(),n.removeEventListener("dragover",o),n.removeEventListener("drop",i)}}this.destroy=t}},{key:"_targetLockOn",value:function(t,e){var n=this,r=this._calculatePointBack(t),o=r;this._currentp=r;var i=this._stack,a=i.checkHit(r,(function(t){return n._target.status.dragging&&t===n._getMovingTarget()})),c=this._linkStack,u=this;a&&(c=a._belongs._linkStack,r=a._belongs._currentp,i=a._belongs._stack,u=a._belongs);var s=c.checkHit(r,(function(t){if(!n._target.status.dragging)return!1;var e=n._getMovingTarget();return t.from===e||t.to===e}));if(Object.assign(this._target,{instance:a,link:s,isInstanceDirty:a===this._target.instance,isLinkDirty:s===this._target.link}),Object.assign(this._target.cache,{stack:i,belongs:u,point:r,topLayerPoint:o}),Object.assign(this._target.meta,{x:t[0],y:t[1]}),"pressStart"===e&&!this._target.status.dragging&&!this._target.status.dragovering){for(var l=a;l&&l._belongs.lock&&l!==this;)l=l._belongs;l&&(l=l._layoutNode?l._layoutNode.isLocked?l._layoutNode.getNodes():l._layoutNode.isDraggable?[l]:void 0:[l]),Object.assign(this._target,{moving:l})}return this._target}},{key:"_getMovingTarget",value:function(){return this._target.moving&&this._target.moving[0]}},{key:"_processDragOver",value:function(t,e){if(this._dragOverTarget!==t){var n,r=null===(n=this.readMessage())||void 0===n?void 0:n.instance;if(this._dragCurrentData=r,this._dragOverTarget){var o=this._dragOverTarget;o.dispatchEvent(new Ft("dragleave",{event:e,instance:o,target:r}))}t&&t.dispatchEvent(new Ft("dragenter",{event:e,instance:t,target:r})),this._dragOverTarget=t}else this._dragOverTarget&&this._dragOverTarget.dispatchEvent(new Ft("dragover",{event:e,instance:t,target:this._dragCurrentData}))}},{key:"_onDragover",value:function(t){var e=this;if(t.preventDefault(),t.stopPropagation(),!this._lastDragState.processing){this._lastDragState.processing=!0;var n=t.offsetX,r=t.offsetY;Object.assign(this._target.status,{dragovering:!0}),this._targetLockOn([n,r]);var o=this._target.instance||this._target.link;this._processDragOver(o,t),this._target.isLinkDirty||this._target.isInstanceDirty?Promise.resolve().then((function(){e._render(),e._target.isLinkDirty=!1,e._target.isInstanceDirty=!1,e._lastDragState.processing=!1})):this._lastDragState.processing=!1}}},{key:"_onDrop",value:function(t){var e=this,n=(t.offsetX,t.offsetY,t.clientX,t.clientY,this.consumeMessage().instance);if(this._dragOverTarget){var r=this._dragOverTarget;r.dispatchEvent(new Ft("dragoverend",{event:t,instance:r})),this._dragOverTarget=null}var o=this._target,i=o.link,a=o.instance,c=this._target.cache,u=c.point,s=c.belongs;i?(n.anchor=u,i.dispatchEvent(new Ft("drop",{event:t,instance:n,link:i,jflow:this,belongs:s,point:u}))):a?a.dispatchEvent(new Ft("drop",{event:t,instance:n,jflow:this,target:a,point:u})):this.dispatchEvent(new Ft("drop",{event:t,instance:n,jflow:this,target:a,point:u})),requestAnimationFrame((function(){e._target.instance=null,e._target.link=null,Object.assign(e._target.status,{dragovering:!1})}))}},{key:"zoomHandler",value:function(t,e,n,r,o){var i=this;if(!this._zooming){this._zooming=!0;var a=this.bounding_box,c=a.width,u=a.height,s=a.x,l=a.y,f=this.scale;f*=r>0?1.1:1/1.1,this.maxZoom&&f>this.maxZoom&&(f=this.maxZoom),this.minZoom&&f<this.minZoom&&(f=this.minZoom);var h=f-this.scale,p=c*this.scale,d=u*this.scale,y=c*h,v=u*h,g=-(t-this.position.x)/p,b=-(e-this.position.y)/d;this.scale=f,this.position.x+=g*y,this.position.y+=b*v,this.position.offsetX=this.position.x-s*f,this.position.offsetY=this.position.y-l*f,this.dispatchEvent(new Ft("zoompan")),requestAnimationFrame((function(){i._render(),i._zooming=!1}))}}},{key:"panHandler",value:function(t,e,n){var r=this;this._panning||(this._panning=!0,this._recalculatePosition(t,e),this.dispatchEvent(new Ft("zoompan")),requestAnimationFrame((function(){r._render(),r._panning=!1})))}},{key:"pressStartHandler",value:function(t,e,n){if(this._targetLockOn([t,e],"pressStart"),Object.assign(this._target.meta,{initialX:t,initialY:e}),Object.assign(this._target.status,{dragging:!0,processing:!1}),this._target.moving){var r=this._getMovingTarget();r.dispatchEvent(new Ft("pressStart",{event:n,instance:r,jflow:this}))}if(this._target.instance){var o=this._target.instance;o.bubbleEvent(new Ft("instancePressStart",{event:n,target:o,jflow:this,bubbles:!0}))}}},{key:"pressMoveHandler",value:function(t,e,n){var r=this,o=this._target.status,i=o.dragging,a=o.processing,c=this._target.meta,u=c.x,s=c.y;if(this.canvas.style.cursor="default",!i&&!a){var l=this._targetLockOn([t,e]),f=(l.link,l.instance);f&&f.dispatchEvent(new Ft("instancemousemove",{event:n,instance:f,jflow:this}))}if(this.dispatchEvent(new Ft("canvasmousemove",{event:n,jflow:this})),i&&(this.canvas.style.cursor="grabbing",!a)){var h=this._target.moving;this._target.status.processing=!0;var p=t-u,d=e-s;h?h.forEach((function(t){t.anchor[0]+=p/r.scale,t.anchor[1]+=d/r.scale})):(this._recalculatePosition(p,d),this.dispatchEvent(new Ft("zoompan")));var y=this._targetLockOn([t,e]),v=y.instance,g=y.link;this._processDragOver(v||g,n),requestAnimationFrame((function(){r._render(),r._target.isLinkDirty=!1,r._target.isInstanceDirty=!1,r._target.status.processing=!1}))}}},{key:"pressUpHanlder",value:function(t,e){var n=this._target.meta;if(n.initialX===n.x&&n.initialY===n.y){if(e.target!==this.canvas)return void this._clearTarget();if(this._target.instance&&!t){var r=this._target.instance;return r.bubbleEvent(new Ft("click",{event:e,target:r,jflow:this,bubbles:!0})),this._clearTarget(),void this._render()}return this.dispatchEvent(new Ft("click",{event:e,jflow:this})),this._clearTarget(),void this._render()}if(this._target.moving){var o=!1;if(this._layout.static&&(o=this.staticCheck(this._getMovingTarget())),!o&&this._target.link){var i=this._target.cache,a=(i.point,i.belongs),c=this._target.link,u=this._getMovingTarget();c.dispatchEvent(new Ft("drop",{event:e,instance:u,link:c,jflow:this,belongs:a})),this._target.link=null,this._target.instance=null}this._target.moving&&(this._target.instance?(console.log("pressEnd",this._target.instance),this._target.instance.bubbleEvent(new Ft("pressEnd",{event:e,instance:this._getMovingTarget(),jflow:this,target:this._target.instance,bubbles:!0}))):this.dispatchEvent(new Ft("pressEnd",{event:e,instance:this._getMovingTarget(),jflow:this}))),this._target.moving=null,this.removeTempDraggingInstance(),this._render()}this._clearTarget()}},{key:"contextMenuHanlder",value:function(t,e,n){var r=this._targetLockOn([t,e]),o=r.link,i=r.instance,a=this._target.cache.topLayerPoint;if(i||o){var c=i||o;c.bubbleEvent(new Ft("contextclick",{event:n,jflow:this,target:c,topLayerPoint:a,bubbles:!0}))}else this.dispatchEvent(new Ft("contextclick",{event:n,jflow:this,topLayerPoint:a}))}},{key:"_clearTarget",value:function(){Object.assign(this._target.meta,{x:void 0,y:void 0,initialX:void 0,initialY:void 0}),Object.assign(this._target.status,{dragging:!1,processing:!1}),Object.assign(this._target,{instance:null,link:null,moving:null})}},{key:"_recalculatePosition",value:function(t,e,n){var r=this.bounding_box,o=r.x,i=r.y;void 0===n&&(n=this.scale),this.position.x+=t,this.position.y+=e,this.position.offsetX=this.position.x-o*n,this.position.offsetY=this.position.y-i*n}},{key:"calculateToRealWorld",value:function(t){var e=this.scale,n=this.position;return[t[0]*e+n.offsetX,t[1]*e+n.offsetY]}},{key:"_calculatePointBack",value:function(t){var e=this.scale,n=this.position;return[(t[0]-n.offsetX)/e,(t[1]-n.offsetY)/e]}},{key:"_calculateDistance",value:function(t){return this.scale*t}},{key:"_resetTransform",value:function(){var t=this.canvasMeta,e=t.width,n=t.height,r=this.position,o=this.scale,i=this.ctx;i.setTransform(),i.clearRect(0,0,e,n),i.scale(this.dpr,this.dpr),i.transform(o,0,0,o,r.offsetX,r.offsetY)}},{key:"_render",value:function(){this._resetTransform();var t=this.ctx;this._stack.render(t),this._linkStack.render(t),this._tempInstance&&(t.save(),this._tempInstance.render(t),t.restore())}}],o&&Io(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),a}(Mo(EventTarget));Object.assign(Fo.prototype,{_message:null,sendMessage:function(t){this._message=t},consumeMessage:function(){var t=this._message;return this._message=null,t},readMessage:function(){return this._message}}),Object.assign(Fo.prototype,xt),Object.assign(Fo.prototype,St);var Ho=Fo,Wo={provide:function(){return{addToStack:this.addToStack,addToLinkStack:this.addToLinkStack,removeFromStack:this.removeFromStack,removeFromLinkStack:this.removeFromLinkStack,getInstanceByJFlowId:this.getInstanceByJFlowId}},data:function(){return{stack:[]}},methods:{getInstanceByJFlowId:function(t){var e=this.stack.find((function(e){return e.jflowId===t}));return e?e.instance:null},addToStack:function(t,e){this._jflowInstance.addToStack(t),e&&this.stack.push({jflowId:e,instance:t})},addToLinkStack:function(t){this._jflowInstance.addToLinkStack(t)},removeFromStack:function(t){this._jflowInstance.removeFromStack(t)},removeFromLinkStack:function(t){this._jflowInstance.removeFromLinkStack(t)},onStackChangeHandler:function(){this._jflowInstance.recalculate(),this._jflowInstance.reflow()}}};function Go(t){return function(t){if(Array.isArray(t))return Xo(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||$o(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,e)||$o(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $o(t,e){if(t){if("string"==typeof t)return Xo(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xo(t,e):void 0}}function Xo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var qo={mixins:[Wo],provide:function(){return{renderJFlow:this.renderJFlow,addNameToRootStack:this.addNameToRootStack}},props:{configs:{type:Object,default:function(){return{}}}},data:function(){return{nodes:[],links:[]}},render:function(t){var e=this;if(this.nodes.length){var n=this.nodes.map((function(t){var n=t.type,r=t.configs,o=t.meta;if(!e.$scopedSlots[n]){if(!e.$scopedSlots.jflowcommon)return;n="jflowcommon"}var i=Yo(e.$scopedSlots[n]({configs:r,meta:o}),1)[0];return o.getJflowInstance=function(){for(var t=i.componentInstance;t&&!t._jflowInstance;)t=t.$children[0];return t._jflowInstance._layoutNode=o,t._jflowInstance},i.key=r.id,i})),r=this.links.map((function(t){var n=t.type||"plainlink";if(!e.$scopedSlots[n])return null;var r=Yo(e.$scopedSlots[n]({configs:t}),1)[0];return r.key="".concat(t.from,"-").concat(t.to,"-").concat(t.part),r}));return t("div",[].concat(Go(n),Go(r)))}return t("div",this.$slots.default)},created:function(){this._jflowInstance=new Ho(this.configs)},beforeDestroy:function(){this._jflowInstance.destroy()},mounted:function(){var t=this;this.nodes=this._jflowInstance._layout.flowStack.map((function(t){return{type:t.type,configs:t.configs,meta:t.layoutMeta}})),this.links=this._jflowInstance._layout.flowLinkStack.slice(),this.$nextTick((function(){t._jflowInstance.$mount(t.$el)})),Object.keys(this.$listeners).map((function(e){var n=t.$listeners[e].bind(t);t._jflowInstance.addEventListener(e,n)}))},methods:{reflow:function(t){var e=this,n=this._jflowInstance._layout.flowStack.map((function(t){return{type:t.type,configs:t.configs,meta:t.layoutMeta}}));this.nodes=n,this.links=this._jflowInstance._layout.flowLinkStack.slice(),this.$nextTick((function(){t&&t(),e._jflowInstance.recalculate(),e._jflowInstance._render()}))},getInstance:function(){return this._jflowInstance},renderJFlow:function(){this._jflowInstance._render()},addNameToRootStack:function(t,e){this.stack.push({jflowId:e,instance:t})}}},No=r(359),Jo=r.n(No);function Uo(t){var n="string"==typeof t?e[t]:t;return{inject:["addToStack","removeFromStack","addNameToRootStack"],props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},jflowId:{type:String}},watch:{configs:function(t,e){var n=Jo()(t,e);0!==Object.keys(n).length&&this._jflowInstance.setConfig(t)},$listeners:function(t,e){var n=this,r=[],o=[],i=Object.keys(t).map((function(e){return{event:e,handler:t[e]}})),a=Object.keys(e).map((function(t){return{event:t,handler:e[t]}}));i.forEach((function(t){var e=t.handler;a.find((function(t){return t.handler===e}))||r.push(t)})),a.forEach((function(t){var e=t.handler;i.find((function(t){return t.handler===e}))||o.push(t)})),r.forEach((function(t){n._jflowInstance.addEventListener(t.event,t.handler)})),o.forEach((function(t){n._jflowInstance.removeEventListener(t.event,t.handler)}))},visible:function(t){this._jflowInstance.visible=t}},render:function(t){return null},created:function(){this._jflowInstance=new n(this.configs),this._jflowInstance.visible=this.visible,this.bindListeners(),this.addToStack(this._jflowInstance,this.jflowId)},destroyed:function(){this.removeFromStack(this._jflowInstance)},methods:{bindListeners:function(){var t=this;Object.keys(this.$listeners).map((function(e){var n=t.$listeners[e];t._jflowInstance.addEventListener(e,n)}))}}}}function Zo(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Vo(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Zo(Object(n),!0).forEach((function(e){Ko(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Zo(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ko(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Qo(t){var n="string"==typeof t?e[t]:t;return{mixins:[Wo],inject:{addToBelongStack:{from:"addToStack"},removeFromBelongStack:{from:"removeFromStack"},renderJFlow:{from:"renderJFlow"},addNameToRootStack:{from:"addNameToRootStack"}},render:function(t){return t("template",this.$slots.default)},props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},jflowId:{type:String}},watch:{configs:function(t,e){JSON.stringify(t)!==JSON.stringify(e)&&this._jflowInstance.setConfig(t)},$listeners:function(t,e){var n=this,r=[],o=[],i=Object.keys(t).map((function(e){return{event:e,handler:t[e]}})),a=Object.keys(e).map((function(t){return{event:t,handler:e[t]}}));i.forEach((function(t){var e=t.handler;a.find((function(t){return t.handler===e}))||r.push(t)})),a.forEach((function(t){var e=t.handler;i.find((function(t){return t.handler===e}))||o.push(t)})),r.forEach((function(t){n._jflowInstance.addEventListener(t.event,t.handler)})),o.forEach((function(t){n._jflowInstance.removeEventListener(t.event,t.handler)}))},visible:function(t){this._jflowInstance.visible=t}},created:function(){var t=this;this._jflowInstance=new n(this.configs),this._jflowInstance.visible=this.visible,Object.keys(this.$listeners).map((function(e){var n=t.$listeners[e].bind(t);t._jflowInstance.addEventListener(e,n)})),this.addToBelongStack(this._jflowInstance,this.jflowId),this.addNameToRootStack(this._jflowInstance,this.jflowId)},mounted:function(){this._jflowInstance.recalculate()},updated:function(){this._jflowInstance.recalculateUp()},destroyed:function(){this.removeFromBelongStack(this._jflowInstance)}}}function ti(t){return function(t){if(Array.isArray(t))return ei(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return ei(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ei(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ei(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ni=[{name:"Jflow",component:qo},{name:"Group",component:Qo("Group")}].concat(ti(["CapsuleGroup","CapsuleVerticalGroup","DiamondGroup","DiamondVerticalGroup","RhombusGroup"].map((function(t){return{name:t,component:Qo(t)}}))),ti(["Point","Rectangle","Capsule","Diamond","Rhombus","Text","Icon"].map((function(t){return{name:t,component:Uo(t)}}))),ti(["Link","PolyLink","BezierLink"].map((function(t){return{name:t,component:(n=t,{inject:["addToLinkStack","removeFromLinkStack","getInstanceByJFlowId"],props:{configs:{type:Object,default:function(){return{}}},from:String,to:String},watch:{from:function(){this.resetLink()},to:function(){this.resetLink()},configs:function(t,e){t.backgroundColor!==e.backgroundColor&&(this._jflowInstance.backgroundColor=t.backgroundColor)}},render:function(t){return null},created:function(){var t=this.getInstanceByJFlowId(this.from),r=this.getInstanceByJFlowId(this.to),o=this.$vnode.key;t&&r&&(this._jflowInstance=new e[n](Vo(Vo({},this.configs),{},{key:o,from:t,to:r})),this.bindListeners(),this.addToLinkStack(this._jflowInstance))},methods:{resetLink:function(){var t=this.getInstanceByJFlowId(this.from),e=this.getInstanceByJFlowId(this.to);this._jflowInstance.from=t,this._jflowInstance.to=e},bindListeners:function(){var t=this;Object.keys(this.$listeners).map((function(e){var n=t.$listeners[e];t._jflowInstance.addEventListener(e,n)}))}},destroyed:function(){this._jflowInstance&&this.removeFromLinkStack(this._jflowInstance)}})};var n})))),ri={install:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="j";e&&e.prefix&&(n=e.prefix),ni.forEach((function(e){t.component("".concat(n).concat(e.name),e.component)})),e.custom&&Object.keys(e.custom).forEach((function(r){t.component("".concat(n).concat(r),Uo(e.custom[r]))}))}},oi=Ho}(),o}()}))}).call(this,r("62e4")(e))},a7d4:function(t,e,n){t.exports={app:"App_app_3cl75",wrapper:"App_wrapper_pE_0j",body:"App_body_1uhyl",sidebar:"App_sidebar_3dMLz",rect:"App_rect_2g-OE",part:"App_part_1uPSl",circle:"App_circle_2pifB",ast:"App_ast_3JyD2",hide:"App_hide_1hYJ-",hoverblock:"App_hoverblock_rjKeE"}}});
//# sourceMappingURL=app.65963ff4.js.map