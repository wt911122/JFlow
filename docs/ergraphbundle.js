(()=>{"use strict";class e{constructor(t){this.type="ERNode",this.source=t,this.id=t.name,this.linkIn=0,this.linkOut=0,this.level=0,this.linkOutArr=[]}makeLink(t){const{extends:e,mixins:i,implements:s,groupfrom:n}=this.source;n?(t({from:n,to:this.id,part:"groupfrom"}),t({from:"GroupTemplate",to:this.id,part:"generate"})):(e&&t({from:e,to:this.id,part:"extends"}),i&&i.forEach((e=>{t({from:e,to:this.id,part:"mixins",lineDash:[5,2]})})),s&&t({from:s,to:this.id,part:"implements"}))}}function i(t){const e=document.createElement("canvas"),i=e.getContext("2d"),{width:s,height:n,left:o,top:r}=t.getBoundingClientRect();e.style.width=s+"px",e.style.height=n+"px",e.style.userSelect="none";const h=window.devicePixelRatio;return e.width=Math.floor(s*h),e.height=Math.floor(n*h),t&&(t.style.position="relative",t.style.overflow="hidden",t.append(e)),{canvas:e,width:s,height:n,raw_width:e.width,raw_height:e.height,left:o,top:r,ctx:i,scale:h}}const s=document.createElement("canvas");s.width=1,s.height=1;const n=s.getContext("2d"),o=window.devicePixelRatio;function r(t){n.clearRect(0,0,5,5),n.save(),t(n),n.restore(),n.clearRect(0,0,5,5)}function h(t){matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`).addEventListener("change",(function(){console.log("devicePixelRatio changed: "+window.devicePixelRatio),t(window.devicePixelRatio),h(t)}),{once:!0})}n.scale(o,o);const{abs:a,cos:l,sin:c,acos:d,atan2:u,sqrt:g,pow:f}=Math;function p(t){return t<0?-f(-t,1/3):f(t,1/3)}const _=Math.PI,m=2*_,b=_/2,w=Number.MAX_SAFE_INTEGER||9007199254740991,v=Number.MIN_SAFE_INTEGER||-9007199254740991,x={x:0,y:0,z:0},y={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){const i=e(t);let s=i.x*i.x+i.y*i.y;return void 0!==i.z&&(s+=i.z*i.z),g(s)},compute:function(t,e,i){if(0===t)return e[0].t=0,e[0];const s=e.length-1;if(1===t)return e[s].t=1,e[s];const n=1-t;let o=e;if(0===s)return e[0].t=t,e[0];if(1===s){const e={x:n*o[0].x+t*o[1].x,y:n*o[0].y+t*o[1].y,t};return i&&(e.z=n*o[0].z+t*o[1].z),e}if(s<4){let e,r,h,a=n*n,l=t*t,c=0;2===s?(o=[o[0],o[1],o[2],x],e=a,r=n*t*2,h=l):3===s&&(e=a*n,r=a*t*3,h=n*l*3,c=t*l);const d={x:e*o[0].x+r*o[1].x+h*o[2].x+c*o[3].x,y:e*o[0].y+r*o[1].y+h*o[2].y+c*o[3].y,t};return i&&(d.z=e*o[0].z+r*o[1].z+h*o[2].z+c*o[3].z),d}const r=JSON.parse(JSON.stringify(e));for(;r.length>1;){for(let e=0;e<r.length-1;e++)r[e]={x:r[e].x+(r[e+1].x-r[e].x)*t,y:r[e].y+(r[e+1].y-r[e].y)*t},void 0!==r[e].z&&(r[e]=r[e].z+(r[e+1].z-r[e].z)*t);r.splice(r.length-1,1)}return r[0].t=t,r[0]},computeWithRatios:function(t,e,i,s){const n=1-t,o=i,r=e;let h,a=o[0],l=o[1],c=o[2],d=o[3];return a*=n,l*=t,2===r.length?(h=a+l,{x:(a*r[0].x+l*r[1].x)/h,y:(a*r[0].y+l*r[1].y)/h,z:!!s&&(a*r[0].z+l*r[1].z)/h,t}):(a*=n,l*=2*n,c*=t*t,3===r.length?(h=a+l+c,{x:(a*r[0].x+l*r[1].x+c*r[2].x)/h,y:(a*r[0].y+l*r[1].y+c*r[2].y)/h,z:!!s&&(a*r[0].z+l*r[1].z+c*r[2].z)/h,t}):(a*=n,l*=1.5*n,c*=3*n,d*=t*t*t,4===r.length?(h=a+l+c+d,{x:(a*r[0].x+l*r[1].x+c*r[2].x+d*r[3].x)/h,y:(a*r[0].y+l*r[1].y+c*r[2].y+d*r[3].y)/h,z:!!s&&(a*r[0].z+l*r[1].z+c*r[2].z+d*r[3].z)/h,t}):void 0))},derive:function(t,e){const i=[];for(let s=t,n=s.length,o=n-1;n>1;n--,o--){const t=[];for(let i,n=0;n<o;n++)i={x:o*(s[n+1].x-s[n].x),y:o*(s[n+1].y-s[n].y)},e&&(i.z=o*(s[n+1].z-s[n].z)),t.push(i);i.push(t),s=t}return i},between:function(t,e,i){return e<=t&&t<=i||y.approximately(t,e)||y.approximately(t,i)},approximately:function(t,e,i){return a(t-e)<=(i||1e-6)},length:function(t){const e=y.Tvalues.length;let i=0;for(let s,n=0;n<e;n++)s=.5*y.Tvalues[n]+.5,i+=y.Cvalues[n]*y.arcfn(s,t);return.5*i},map:function(t,e,i,s,n){return s+(t-e)/(i-e)*(n-s)},lerp:function(t,e,i){const s={x:e.x+t*(i.x-e.x),y:e.y+t*(i.y-e.y)};return void 0!==e.z&&void 0!==i.z&&(s.z=e.z+t*(i.z-e.z)),s},pointToString:function(t){let e=t.x+"/"+t.y;return void 0!==t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map(y.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,i){const s=e.x-t.x,n=e.y-t.y,o=i.x-t.x,r=i.y-t.y;return u(s*r-n*o,s*o+n*r)},round:function(t,e){const i=""+t,s=i.indexOf(".");return parseFloat(i.substring(0,s+1+e))},dist:function(t,e){const i=t.x-e.x,s=t.y-e.y;return g(i*i+s*s)},closest:function(t,e){let i,s,n=f(2,63);return t.forEach((function(t,o){s=y.dist(e,t),s<n&&(n=s,i=o)})),{mdist:n,mpos:i}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const i=f(t,e)+f(1-t,e);return a((i-1)/i)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const i=f(1-t,e);return i/(f(t,e)+i)},lli8:function(t,e,i,s,n,o,r,h){const a=(t-i)*(o-h)-(e-s)*(n-r);return 0!=a&&{x:((t*s-e*i)*(n-r)-(t-i)*(n*h-o*r))/a,y:((t*s-e*i)*(o-h)-(e-s)*(n*h-o*r))/a}},lli4:function(t,e,i,s){const n=t.x,o=t.y,r=e.x,h=e.y,a=i.x,l=i.y,c=s.x,d=s.y;return y.lli8(n,o,r,h,a,l,c,d)},lli:function(t,e){return y.lli4(t,t.c,e,e.c)},makeline:function(t,e){const i=t.x,s=t.y,n=e.x,o=e.y,r=(n-i)/3,h=(o-s)/3;return new z(i,s,i+r,s+h,i+2*r,s+2*h,n,o)},findbbox:function(t){let e=w,i=w,s=v,n=v;return t.forEach((function(t){const o=t.bbox();e>o.x.min&&(e=o.x.min),i>o.y.min&&(i=o.y.min),s<o.x.max&&(s=o.x.max),n<o.y.max&&(n=o.y.max)})),{x:{min:e,mid:(e+s)/2,max:s,size:s-e},y:{min:i,mid:(i+n)/2,max:n,size:n-i}}},shapeintersections:function(t,e,i,s,n){if(!y.bboxoverlap(e,s))return[];const o=[],r=[t.startcap,t.forward,t.back,t.endcap],h=[i.startcap,i.forward,i.back,i.endcap];return r.forEach((function(e){e.virtual||h.forEach((function(s){if(s.virtual)return;const r=e.intersects(s,n);r.length>0&&(r.c1=e,r.c2=s,r.s1=t,r.s2=i,o.push(r))}))})),o},makeshape:function(t,e,i){const s=e.points.length,n=t.points.length,o=y.makeline(e.points[s-1],t.points[0]),r=y.makeline(t.points[n-1],e.points[0]),h={startcap:o,forward:t,back:e,endcap:r,bbox:y.findbbox([o,t,e,r]),intersections:function(t){return y.shapeintersections(h,h.bbox,t,t.bbox,i)}};return h},getminmax:function(t,e,i){if(!i)return{min:0,max:0};let s,n,o=w,r=v;-1===i.indexOf(0)&&(i=[0].concat(i)),-1===i.indexOf(1)&&i.push(1);for(let h=0,a=i.length;h<a;h++)s=i[h],n=t.get(s),n[e]<o&&(o=n[e]),n[e]>r&&(r=n[e]);return{min:o,mid:(o+r)/2,max:r,size:r-o}},align:function(t,e){const i=e.p1.x,s=e.p1.y,n=-u(e.p2.y-s,e.p2.x-i);return t.map((function(t){return{x:(t.x-i)*l(n)-(t.y-s)*c(n),y:(t.x-i)*c(n)+(t.y-s)*l(n)}}))},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const i=t.length-1,s=y.align(t,e),n=function(t){return 0<=t&&t<=1};if(2===i){const t=s[0].y,e=s[1].y,i=s[2].y,o=t-2*e+i;if(0!==o){const s=-g(e*e-t*i),r=-t+e;return[-(s+r)/o,-(-s+r)/o].filter(n)}return e!==i&&0===o?[(2*e-i)/(2*e-2*i)].filter(n):[]}const o=s[0].y,r=s[1].y,h=s[2].y;let a=3*r-o-3*h+s[3].y,c=3*o-6*r+3*h,u=-3*o+3*r,f=o;if(y.approximately(a,0)){if(y.approximately(c,0))return y.approximately(u,0)?[]:[-f/u].filter(n);const t=g(u*u-4*c*f),e=2*c;return[(t-u)/e,(-u-t)/e].filter(n)}c/=a,u/=a,f/=a;const _=(3*u-c*c)/3,b=_/3,w=(2*c*c*c-9*c*u+27*f)/27,v=w/2,x=v*v+b*b*b;let k,T,M,S,E;if(x<0){const t=-_/3,e=g(t*t*t),i=-w/(2*e),s=d(i<-1?-1:i>1?1:i),o=2*p(e);return M=o*l(s/3)-c/3,S=o*l((s+m)/3)-c/3,E=o*l((s+2*m)/3)-c/3,[M,S,E].filter(n)}if(0===x)return k=v<0?p(-v):-p(v),M=2*k-c/3,S=-k-c/3,[M,S].filter(n);{const t=g(x);return k=p(-v+t),T=p(v+t),[k-T-c/3].filter(n)}},droots:function(t){if(3===t.length){const e=t[0],i=t[1],s=t[2],n=e-2*i+s;if(0!==n){const t=-g(i*i-e*s),o=-e+i;return[-(t+o)/n,-(-t+o)/n]}return i!==s&&0===n?[(2*i-s)/(2*(i-s))]:[]}if(2===t.length){const e=t[0],i=t[1];return e!==i?[e/(e-i)]:[]}return[]},curvature:function(t,e,i,s,n){let o,r,h,l,c=0,d=0;const u=y.compute(t,e),p=y.compute(t,i),_=u.x*u.x+u.y*u.y;if(s?(o=g(f(u.y*p.z-p.y*u.z,2)+f(u.z*p.x-p.z*u.x,2)+f(u.x*p.y-p.x*u.y,2)),r=f(_+u.z*u.z,1.5)):(o=u.x*p.y-u.y*p.x,r=f(_,1.5)),0===o||0===r)return{k:0,r:0};if(c=o/r,d=r/o,!n){const n=y.curvature(t-.001,e,i,s,!0).k,o=y.curvature(t+.001,e,i,s,!0).k;l=(o-c+(c-n))/2,h=(a(o-c)+a(c-n))/2}return{k:c,r:d,dk:l,adk:h}},inflections:function(t){if(t.length<4)return[];const e=y.align(t,{p1:t[0],p2:t.slice(-1)[0]}),i=e[2].x*e[1].y,s=e[3].x*e[1].y,n=e[1].x*e[2].y,o=18*(-3*i+2*s+3*n-e[3].x*e[2].y),r=18*(3*i-s-3*n),h=18*(n-i);if(y.approximately(o,0)){if(!y.approximately(r,0)){let t=-h/r;if(0<=t&&t<=1)return[t]}return[]}const a=r*r-4*o*h,l=Math.sqrt(a),c=2*o;return y.approximately(c,0)?[]:[(l-r)/c,-(r+l)/c].filter((function(t){return 0<=t&&t<=1}))},bboxoverlap:function(t,e){const i=["x","y"],s=i.length;for(let n,o,r,h,l=0;l<s;l++)if(n=i[l],o=t[n].mid,r=e[n].mid,h=(t[n].size+e[n].size)/2,a(o-r)>=h)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,i){const s=t.bbox(),n=e.bbox(),o=1e5,r=i||.5;if(s.x.size+s.y.size<r&&n.x.size+n.y.size<r)return[(o*(t._t1+t._t2)/2|0)/o+"/"+(o*(e._t1+e._t2)/2|0)/o];let h=t.split(.5),a=e.split(.5),l=[{left:h.left,right:a.left},{left:h.left,right:a.right},{left:h.right,right:a.right},{left:h.right,right:a.left}];l=l.filter((function(t){return y.bboxoverlap(t.left.bbox(),t.right.bbox())}));let c=[];return 0===l.length||(l.forEach((function(t){c=c.concat(y.pairiteration(t.left,t.right,r))})),c=c.filter((function(t,e){return c.indexOf(t)===e}))),c},getccenter:function(t,e,i){const s=e.x-t.x,n=e.y-t.y,o=i.x-e.x,r=i.y-e.y,h=s*l(b)-n*c(b),a=s*c(b)+n*l(b),d=o*l(b)-r*c(b),g=o*c(b)+r*l(b),f=(t.x+e.x)/2,p=(t.y+e.y)/2,_=(e.x+i.x)/2,w=(e.y+i.y)/2,v=f+h,x=p+a,k=_+d,T=w+g,M=y.lli8(f,p,v,x,_,w,k,T),S=y.dist(M,t);let E,C=u(t.y-M.y,t.x-M.x),B=u(e.y-M.y,e.x-M.x),O=u(i.y-M.y,i.x-M.x);return C<O?((C>B||B>O)&&(C+=m),C>O&&(E=O,O=C,C=E)):O<B&&B<C?(E=O,O=C,C=E):O+=m,M.s=C,M.e=O,M.r=S,M},numberSort:function(t,e){return t-e}};class k{constructor(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map((function(t){return y.pointsToString(t.points)})).join(", ")+"]"}addCurve(t){this.curves.push(t),this._3d=this._3d||t._3d}length(){return this.curves.map((function(t){return t.length()})).reduce((function(t,e){return t+e}))}curve(t){return this.curves[t]}bbox(){const t=this.curves;for(var e=t[0].bbox(),i=1;i<t.length;i++)y.expandbox(e,t[i].bbox());return e}offset(t){const e=[];return this.curves.forEach((function(i){e.push(...i.offset(t))})),new k(e)}}const{abs:T,min:M,max:S,cos:E,sin:C,acos:B,sqrt:O}=Math,P=Math.PI;class z{constructor(t){let e=t&&t.forEach?t:Array.from(arguments).slice(),i=!1;if("object"==typeof e[0]){i=e.length;const t=[];e.forEach((function(e){["x","y","z"].forEach((function(i){void 0!==e[i]&&t.push(e[i])}))})),e=t}let s=!1;const n=e.length;if(i){if(i>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");s=!0}}else if(6!==n&&8!==n&&9!==n&&12!==n&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const o=this._3d=!s&&(9===n||12===n)||t&&t[0]&&void 0!==t[0].z,r=this.points=[];for(let t=0,i=o?3:2;t<n;t+=i){var h={x:e[t],y:e[t+1]};o&&(h.z=e[t+2]),r.push(h)}const a=this.order=r.length-1,l=this.dims=["x","y"];o&&l.push("z"),this.dimlen=l.length;const c=y.align(r,{p1:r[0],p2:r[a]});this._linear=!c.some((t=>T(t.y)>1e-4)),this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(t,e,i,s){if(void 0===s&&(s=.5),0===s)return new z(e,e,i);if(1===s)return new z(t,e,e);const n=z.getABC(2,t,e,i,s);return new z(t,n.A,i)}static cubicFromPoints(t,e,i,s,n){void 0===s&&(s=.5);const o=z.getABC(3,t,e,i,s);void 0===n&&(n=y.dist(e,o.C));const r=n*(1-s)/s,h=y.dist(t,i),a=(i.x-t.x)/h,l=(i.y-t.y)/h,c=n*a,d=n*l,u=r*a,g=r*l,f=e.x-c,p=e.y-d,_=e.x+u,m=e.y+g,b=o.A,w=b.x+(f-b.x)/(1-s),v=b.y+(p-b.y)/(1-s),x=b.x+(_-b.x)/s,k=b.y+(m-b.y)/s,T={x:t.x+(w-t.x)/s,y:t.y+(v-t.y)/s},M={x:i.x+(x-i.x)/(1-s),y:i.y+(k-i.y)/(1-s)};return new z(t,T,M,i)}static getUtils(){return y}getUtils(){return z.getUtils()}static get PolyBezier(){return k}valueOf(){return this.toString()}toString(){return y.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const t=this.points,e=["M",t[0].x,t[0].y,2===this.order?"Q":"C"];for(let i=1,s=t.length;i<s;i++)e.push(t[i].x),e.push(t[i].y);return e.join(" ")}setRatios(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}verify(){const t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}coordDigest(){return this.points.map((function(t,e){return""+e+t.x+t.y+(t.z?t.z:0)})).join("")}update(){this._lut=[],this.dpoints=y.derive(this.points,this._3d),this.computedirection()}computedirection(){const t=this.points,e=y.angle(t[0],t[this.order],t[1]);this.clockwise=e>0}length(){return y.length(this.derivative.bind(this))}static getABC(t=2,e,i,s,n=.5){const o=y.projectionratio(n,t),r=1-o,h={x:o*e.x+r*s.x,y:o*e.y+r*s.y},a=y.abcratio(n,t);return{A:{x:i.x+(i.x-h.x)/a,y:i.y+(i.y-h.y)/a},B:i,C:h,S:e,E:s}}getABC(t,e){e=e||this.get(t);let i=this.points[0],s=this.points[this.order];return z.getABC(this.order,i,e,s,t)}getLUT(t){if(this.verify(),t=t||100,this._lut.length===t)return this._lut;this._lut=[],t--;for(let e,i,s=0;s<t;s++)i=s/(t-1),e=this.compute(i),e.t=i,this._lut.push(e);return this._lut}on(e,i){i=i||5;const s=this.getLUT(),n=[];for(let t,o=0,r=0;o<s.length;o++)t=s[o],y.dist(t,e)<i&&(n.push(t),r+=o/s.length);return!!n.length&&(t/=n.length)}project(t){const e=this.getLUT(),i=e.length-1,s=y.closest(e,t),n=s.mpos,o=(n-1)/i,r=(n+1)/i,h=.1/i;let a,l,c=s.mdist,d=o,u=d;for(c+=1;d<r+h;d+=h)a=this.compute(d),l=y.dist(t,a),l<c&&(c=l,u=d);return u=u<0?0:u>1?1:u,a=this.compute(u),a.t=u,a.d=c,a}get(t){return this.compute(t)}point(t){return this.points[t]}compute(t){return this.ratios?y.computeWithRatios(t,this.points,this.ratios,this._3d):y.compute(t,this.points,this._3d,this.ratios)}raise(){const t=this.points,e=[t[0]],i=t.length;for(let s,n,o=1;o<i;o++)s=t[o],n=t[o-1],e[o]={x:(i-o)/i*s.x+o/i*n.x,y:(i-o)/i*s.y+o/i*n.y};return e[i]=t[i-1],new z(e)}derivative(t){return y.compute(t,this.dpoints[0],this._3d)}dderivative(t){return y.compute(t,this.dpoints[1],this._3d)}align(){let t=this.points;return new z(y.align(t,{p1:t[0],p2:t[t.length-1]}))}curvature(t){return y.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return y.inflections(this.points)}normal(t){return this._3d?this.__normal3(t):this.__normal2(t)}__normal2(t){const e=this.derivative(t),i=O(e.x*e.x+e.y*e.y);return{x:-e.y/i,y:e.x/i}}__normal3(t){const e=this.derivative(t),i=this.derivative(t+.01),s=O(e.x*e.x+e.y*e.y+e.z*e.z),n=O(i.x*i.x+i.y*i.y+i.z*i.z);e.x/=s,e.y/=s,e.z/=s,i.x/=n,i.y/=n,i.z/=n;const o={x:i.y*e.z-i.z*e.y,y:i.z*e.x-i.x*e.z,z:i.x*e.y-i.y*e.x},r=O(o.x*o.x+o.y*o.y+o.z*o.z);o.x/=r,o.y/=r,o.z/=r;const h=[o.x*o.x,o.x*o.y-o.z,o.x*o.z+o.y,o.x*o.y+o.z,o.y*o.y,o.y*o.z-o.x,o.x*o.z-o.y,o.y*o.z+o.x,o.z*o.z];return{x:h[0]*e.x+h[1]*e.y+h[2]*e.z,y:h[3]*e.x+h[4]*e.y+h[5]*e.z,z:h[6]*e.x+h[7]*e.y+h[8]*e.z}}hull(t){let e=this.points,i=[],s=[],n=0;for(s[n++]=e[0],s[n++]=e[1],s[n++]=e[2],3===this.order&&(s[n++]=e[3]);e.length>1;){i=[];for(let o,r=0,h=e.length-1;r<h;r++)o=y.lerp(t,e[r],e[r+1]),s[n++]=o,i.push(o);e=i}return s}split(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;const i=this.hull(t),s={left:2===this.order?new z([i[0],i[3],i[5]]):new z([i[0],i[4],i[7],i[9]]),right:2===this.order?new z([i[5],i[4],i[2]]):new z([i[9],i[8],i[6],i[3]]),span:i};return s.left._t1=y.map(0,0,1,this._t1,this._t2),s.left._t2=y.map(t,0,1,this._t1,this._t2),s.right._t1=y.map(t,0,1,this._t1,this._t2),s.right._t2=y.map(1,0,1,this._t1,this._t2),e?(e=y.map(e,t,1,0,1),s.right.split(e).left):s}extrema(){const t={};let e=[];return this.dims.forEach(function(i){let s=function(t){return t[i]},n=this.dpoints[0].map(s);t[i]=y.droots(n),3===this.order&&(n=this.dpoints[1].map(s),t[i]=t[i].concat(y.droots(n))),t[i]=t[i].filter((function(t){return t>=0&&t<=1})),e=e.concat(t[i].sort(y.numberSort))}.bind(this)),t.values=e.sort(y.numberSort).filter((function(t,i){return e.indexOf(t)===i})),t}bbox(){const t=this.extrema(),e={};return this.dims.forEach(function(i){e[i]=y.getminmax(this,i,t[i])}.bind(this)),e}overlaps(t){const e=this.bbox(),i=t.bbox();return y.bboxoverlap(e,i)}offset(t,e){if(void 0!==e){const i=this.get(t),s=this.normal(t),n={c:i,n:s,x:i.x+s.x*e,y:i.y+s.y*e};return this._3d&&(n.z=i.z+s.z*e),n}if(this._linear){const e=this.normal(0),i=this.points.map((function(i){const s={x:i.x+t*e.x,y:i.y+t*e.y};return i.z&&e.z&&(s.z=i.z+t*e.z),s}));return[new z(i)]}return this.reduce().map((function(e){return e._linear?e.offset(t)[0]:e.scale(t)}))}simple(){if(3===this.order){const t=y.angle(this.points[0],this.points[3],this.points[1]),e=y.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&e<0||t<0&&e>0)return!1}const t=this.normal(0),e=this.normal(1);let i=t.x*e.x+t.y*e.y;return this._3d&&(i+=t.z*e.z),T(B(i))<P/3}reduce(){let t,e,i=0,s=0,n=.01,o=[],r=[],h=this.extrema().values;for(-1===h.indexOf(0)&&(h=[0].concat(h)),-1===h.indexOf(1)&&h.push(1),i=h[0],t=1;t<h.length;t++)s=h[t],e=this.split(i,s),e._t1=i,e._t2=s,o.push(e),i=s;return o.forEach((function(t){for(i=0,s=0;s<=1;)for(s=i+n;s<=1.01;s+=n)if(e=t.split(i,s),!e.simple()){if(s-=n,T(i-s)<n)return[];e=t.split(i,s),e._t1=y.map(i,0,1,t._t1,t._t2),e._t2=y.map(s,0,1,t._t1,t._t2),r.push(e),i=s;break}i<1&&(e=t.split(i,1),e._t1=y.map(i,0,1,t._t1,t._t2),e._t2=t._t2,r.push(e))})),r}scale(t){const e=this.order;let i=!1;if("function"==typeof t&&(i=t),i&&2===e)return this.raise().scale(i);const s=this.clockwise,n=i?i(0):t,o=i?i(1):t,r=[this.offset(0,10),this.offset(1,10)],h=this.points,a=[],l=y.lli4(r[0],r[0].c,r[1],r[1].c);if(!l)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach((function(t){const i=a[t*e]=y.copy(h[t*e]);i.x+=(t?o:n)*r[t].n.x,i.y+=(t?o:n)*r[t].n.y})),i?([0,1].forEach((function(n){if(2!==e||!n){var o=h[n+1],r={x:o.x-l.x,y:o.y-l.y},c=i?i((n+1)/e):t;i&&!s&&(c=-c);var d=O(r.x*r.x+r.y*r.y);r.x/=d,r.y/=d,a[n+1]={x:o.x+c*r.x,y:o.y+c*r.y}}})),new z(a)):([0,1].forEach((t=>{if(2===e&&t)return;const i=a[t*e],s=this.derivative(t),n={x:i.x+s.x,y:i.y+s.y};a[t+1]=y.lli4(i,n,l,h[t+1])})),new z(a))}outline(t,e,i,s){e=void 0===e?t:e;const n=this.reduce(),o=n.length,r=[];let h,a=[],l=0,c=this.length();const d=void 0!==i&&void 0!==s;function u(t,e,i,s,n){return function(o){const r=s/i,h=(s+n)/i,a=e-t;return y.map(o,0,1,t+r*a,t+h*a)}}n.forEach((function(n){const o=n.length();d?(r.push(n.scale(u(t,i,c,l,o))),a.push(n.scale(u(-e,-s,c,l,o)))):(r.push(n.scale(t)),a.push(n.scale(-e))),l+=o})),a=a.map((function(t){return h=t.points,h[3]?t.points=[h[3],h[2],h[1],h[0]]:t.points=[h[2],h[1],h[0]],t})).reverse();const g=r[0].points[0],f=r[o-1].points[r[o-1].points.length-1],p=a[o-1].points[a[o-1].points.length-1],_=a[0].points[0],m=y.makeline(p,g),b=y.makeline(f,_),w=[m].concat(r).concat([b]).concat(a);return w.length,new k(w)}outlineshapes(t,e,i){e=e||t;const s=this.outline(t,e).curves,n=[];for(let t=1,e=s.length;t<e/2;t++){const o=y.makeshape(s[t],s[e-t],i);o.startcap.virtual=t>1,o.endcap.virtual=t<e/2-1,n.push(o)}return n}intersects(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof z&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)}lineIntersects(t){const e=M(t.p1.x,t.p2.x),i=M(t.p1.y,t.p2.y),s=S(t.p1.x,t.p2.x),n=S(t.p1.y,t.p2.y);return y.roots(this.points,t).filter((t=>{var o=this.get(t);return y.between(o.x,e,s)&&y.between(o.y,i,n)}))}selfintersects(t){const e=this.reduce(),i=e.length-2,s=[];for(let n,o,r,h=0;h<i;h++)o=e.slice(h,h+1),r=e.slice(h+2),n=this.curveintersects(o,r,t),s.push(...n);return s}curveintersects(t,e,i){const s=[];t.forEach((function(t){e.forEach((function(e){t.overlaps(e)&&s.push({left:t,right:e})}))}));let n=[];return s.forEach((function(t){const e=y.pairiteration(t.left,t.right,i);e.length>0&&(n=n.concat(e))})),n}arcs(t){return t=t||.5,this._iterate(t,[])}_error(t,e,i,s){const n=(s-i)/4,o=this.get(i+n),r=this.get(s-n),h=y.dist(t,e),a=y.dist(t,o),l=y.dist(t,r);return T(a-h)+T(l-h)}_iterate(t,e){let i,s=0,n=1;do{i=0,n=1;let o,r,h,a,l,c=this.get(s),d=!1,u=!1,g=n,f=1,p=0;do{if(u=d,a=h,g=(s+n)/2,p++,o=this.get(g),r=this.get(n),h=y.getccenter(c,o,r),h.interval={start:s,end:n},d=this._error(h,c,s,n)<=t,l=u&&!d,l||(f=n),d){if(n>=1){if(h.interval.end=f=1,a=h,n>1){let t={x:h.x+h.r*E(h.e),y:h.y+h.r*C(h.e)};h.e+=y.angle({x:h.x,y:h.y},t,this.get(1))}break}n+=(n-s)/2}else n=g}while(!l&&i++<100);if(i>=100)break;a=a||h,e.push(a),s=f}while(n<1);return e}}const I={RIGHT:0,BOTTOM:1,LEFT:2,TOP:3,SELF:100},L="DEFAULT",D="LINKING";function R(t){if(0===t.length)return{width:1,height:1,x:0,y:0};let e=1/0,i=1/0,s=-1/0,n=-1/0;for(let o in t){const r=t[o];r[0]<e&&(e=r[0]),r[0]>s&&(s=r[0]),r[1]<i&&(i=r[1]),r[1]>n&&(n=r[1])}return{width:Math.max(s-e,10),height:Math.max(n-i,10),x:e,y:i}}function j(t){return t*t}function W(t,e){return j(t[0]-e[0])+j(t[1]-e[1])}function H(t,e,i,s){return e===I.TOP?[t[0],t[1]-s]:e===I.BOTTOM?[t[0],t[1]+s]:e===I.LEFT?[t[0]-i,t[1]]:e===I.RIGHT?[t[0]+i,t[1]]:void 0}function A(t,e,i=I.TOP,s=I.TOP,n=0,o=0){const r=Math.max(Math.abs((t[0]-e[0])/2),n),h=Math.max(Math.abs((t[1]-e[1])/2),o),a=H(t,i,r,h),l=H(e,s,r,h),c=[I.TOP,I.LEFT].includes(s)?-5:5,d=[I.TOP,I.BOTTOM].includes(s);return[...a,...l,d?e[0]:e[0]+c,d?e[1]+c:e[1]]}function N(t,e,i,s,n,o,r,h,a){var l=Math.pow(1-t,2)*(s-e)+2*t*(1-t)*(o-s)+t*t*(h-o),c=Math.pow(1-t,2)*(n-i)+2*t*(1-t)*(r-n)+t*t*(a-r);return-Math.atan2(l,c)+.5*Math.PI}function F(t,e){return t[0]!=t[2]&&t[1]!=t[3]&&e[0]!=e[2]&&e[1]!=e[3]&&!(t[2]<=e[0]||t[3]<=e[1]||t[0]>=e[2]||t[1]>=e[3])}const Y=Symbol("ishit"),X=Symbol("isInViewBox");class q extends EventTarget{constructor(t={}){super(),Object.assign(this,t),this.visible=!0,this._belongs=void 0,this[Y]=!1,this.borderWidth=t.borderWidth||0,this.borderColor=t.borderColor||"transparent",this.backgroundColor=t.backgroundColor||"transparent",this.shadowColor=t.shadowColor,this.shadowBlur=t.shadowBlur||5,this.shadowOffsetX=t.shadowOffsetX||0,this.shadowOffsetY=t.shadowOffsetY||0,this.opacity=t.opacity||1}get _isTargeting(){return this===(this._jflow._target.instance||this._jflow._target.link)}get _isMoving(){return this===this._jflow._getMovingTarget()&&this._jflow._target.status.movingState}get _isHit(){return this[Y]}get _jflow(){return"jflow"===this._belongs.uniqueName?this._belongs:this._belongs._jflow}set _isHit(t){this[Y]!==t&&this.dispatchEvent(new CustomEvent(t?"mouseenter":"mouseleave",{detail:{instance:this,jflow:this._jflow}})),this[Y]=t}get isInViewBox(){return this[X]}set _isInViewBox(t){t!==this[X]&&(t?this.onEnterViewbox():this.onLeaveViewbox()),this[X]=t}onEnterViewbox(){}onLeaveViewbox(){}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e])}))}render(t){throw"require render implement"}isHit(t){throw"require isHit implement"}getBoundingRect(){throw"require getBoundingRect implement"}calculateIntersection(){throw"require calculateIntersection implement"}getIntersectionsInFourDimension(){throw"require getIntersectionsInFourDimension implement"}getCenter(){return this.anchor}getBoundingDimension(){const t=instance.getBoundingRect();let e=1/0,i=-1/0,s=1/0,n=-1/0;return t.forEach((t=>{i=Math.max(i,t[1]),e=Math.min(e,t[1]),n=Math.max(n,t[0]),s=Math.min(s,t[0])})),{height:i-e,width:n-s}}bubbleEvent(t){t.detail.currentTarget=this,this.dispatchEvent(t),t.detail.bubbles&&(this._belongs.bubbleEvent?this._belongs.bubbleEvent(t):this._belongs.dispatchEvent(t))}calculateToRealWorld(t){return this._belongs&&this._belongs.calculateToRealWorld?this._belongs.calculateToRealWorld(t):t}calculateToRealWorldWithScalar(t){return this._jflow.scale*t}recalculateUp(){this.belongs&&this.belongs.recalculateUp()}destroy(){}}const G=q,V=class extends G{constructor(t={}){super(t),this._rawConfigs=t,this.anchor=t.anchor||[0,0],this.absolutePosition=t.absolutePosition}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])}))}setAnchorX(t){this.anchor[0]=t}setAnchorY(t){this.anchor[1]=t}setAnchor(t,e){this.anchor[0]=t,this.anchor[1]=e}clone(){const t=new(0,this.constructor)(this._rawConfigs);return t.visible=this.visible,t}},U=class extends V{constructor(t){super(t)}render(t){}isHit(t){return!1}calculateIntersection(t){return this.anchor}getIntersectionsInFourDimension(){const[t,e]=this.anchor;return{[I.RIGHT]:[t,e],[I.LEFT]:[t,e],[I.BOTTOM]:[t,e],[I.TOP]:[t,e]}}};class Z{constructor(){this._map=new WeakMap}get(t){return this._map.get(t)}set(t){const e={layoutNode:void 0,jflowNode:void 0,jflowlinks:[],jflowFromLinks:[],jflowToLinks:[]};return this._map.set(t,e),e}has(t){return this._map.has(t)}delete(t){this._map.delete(t)}clear(){this._map.clear()}}const $={initNodeWeakMap(){this.source_Layout_Render_NodeMap=new Z},getRenderNodeBySource(t){const e=this.source_Layout_Render_NodeMap.get(t);if(e)return e.jflowNode},getLayoutNodeBySource(t){const e=this.source_Layout_Render_NodeMap.get(t);if(e)return e.layoutNode},getSourceRenderMeta(t){return this.source_Layout_Render_NodeMap.get(t)},_getMap(t){const e=this.source_Layout_Render_NodeMap;let i;return i=e.has(t)?e.get(t):e.set(t),i},setLayoutNodeBySource(t,e){this._getMap(t).layoutNode=e},setRenderNodeBySource(t,e){this._getMap(t).jflowNode=e},addLinkNodeBySource(t,e,i){let s=this._getMap(t);s.jflowFromLinks.push(i),s=this._getMap(e),s.jflowToLinks.push(i)},removeLinkNodeBySource(t,e,i){let s=this._getMap(t),n=s.jflowFromLinks.findIndex((t=>t===i));-1!==n&&s.jflowFromLinks.splice(n,1),s=this._getMap(e),n=s.jflowToLinks.findIndex((t=>t===i)),-1!==n&&s.jflowToLinks.splice(n,1)}},J=class extends Array{constructor(){super(),this._currentHit=null}render(t,e){let i;this.forEach((s=>{s._isMoving?i=s:!s.visible||e&&!e(s)||(t.save(),s.render(t),t.restore())})),i&&(t.save(),i.render(t),t.restore())}checkHit(t,e,i){let s=this.length-1;for(;s>=0;){const n=this[s];if(n.visible&&!n.ignoreHit){if(e&&e(n)){s--;continue}if(i&&!i(n)){s--;continue}const o=n.isHit(t,e);if(n._isHit=!!o,o)return this._currentHit!==n&&(this._currentHit&&(this._currentHit._isHit=!1),this._currentHit=n),"boolean"!=typeof o?o:n}s--}return this._currentHit=null,null}getBoundingRectPoints(){const t=[];return this.forEach((e=>{if(e.visible&&!e.absolutePosition){const i=e.getBoundingRect();t.push([i[0],i[1]]),t.push([i[2],i[3]])}})),t}getAnchorRectPoints(){const t=[];return this.forEach((e=>{e.visible&&!e.absolutePosition&&t.push(e.anchor)})),t}},K={instances:[],links:[],_stack:null,_linkStack:null,initStack({data:t}){this._stack=new J,this._linkStack=new J,t&&(this.instances=t.instances,this.links=t.links,this.instances.forEach((t=>{this._stack.push(t),t._belongs=this})),this.links.forEach((t=>{this._linkStack.push(t),t._belongs=this})))},addToStack(t){t._belongs=this,this._stack.push(t)},replaceFromStack(t,e){const i=this._stack.findIndex((e=>e===t));this._stack.splice(i,1,e),t._belongs=null,e._belongs=this},addToLinkStack(t){t._belongs=this,this._linkStack.push(t)},removeFromStack(t){const e=this._stack.findIndex((e=>e===t));-1!==e&&this._stack.splice(e,1)},removeFromLinkStack(t){const e=this._linkStack.findIndex((e=>e===t));-1!==e&&this._linkStack.splice(e,1)},emptyLink(){this._linkStack=new J},resetChildrenPosition(){this._stack.forEach((t=>{t.anchor=[0,0]}))},addInstanceToLink(t,e){this.addToStack(e);const{from:i,to:s}=t,n=this._linkStack.findIndex((e=>e===t)),o=t.__proto__.constructor,r=new o({from:i,to:e});r._belongs=this;const h=new o({from:e,to:s});h._belongs=this,this._linkStack.splice(n,1,r,h)},interateNodeStack(t){this._stack.forEach((e=>{t(e)}))}},Q={_layout:null,initLayout(t){this._layout=t.layout},recalculateUp(){let t=!0;if(this.getBoundingDimension){const{width:e,height:i}=this.getBoundingDimension();this.resetChildrenPosition&&this.resetChildrenPosition(),this._getBoundingGroupRect&&this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect();const{width:s,height:n}=this.getBoundingDimension();t=e!==s||i!==n}else this.reflow();this._belongs&&t&&this._belongs.recalculateUp()},recalculate(){this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect()},staticCheck(t){return!!this._layout&&this._layout.staticCheck(t,this)},reflow(){this._layout&&this._layout.reflow(this)}},tt={_message:null,sendMessage(t){this._message=t},consumeMessage(){const t=this._message;return this._message=null,t},readMessage(){return this._message}},et={initAnime(){this.anime_queue=[],this.__animeClock__=void 0},requestJFlowAnime(t){const e=this.enqueueAnime(t);return this._runAnime(),e},enqueueAnime(t){const e={start:void 0,callback:t,cancel:()=>{this._cancelAnime(e),this._render()}};return this.anime_queue.push(e),e},_cancelAnime(t){const e=this.anime_queue.findIndex((e=>e===t));~e&&this.anime_queue.splice(e,1)},runAnime(){this._runAnime()},_runAnime(){this.anime_queue.length&&this.scheduleRender((t=>{this.__animeClock__!==t&&this._runAnime(),this.__animeClock__=t}))},runAnimeFrame(){this.anime_queue.forEach((t=>{const e=Date.now();t.start||(t.start=e);const i=e-t.start;t.callback(i)}))}},it={captureMap(t,{padding:e=0,placement:s="normal"}){this._getBoundingGroupRect();const{width:n,height:o,x:r,y:h}=this.bounding_box;if(!this.miniMap){this.miniMap=i(t);const{width:e,height:s,raw_width:n,raw_height:o}=this.miniMap;this.addEventListener("zoompan",(()=>{this._renderMap&&this._renderMap()}));let r=!1;this.miniMap.canvas.addEventListener("pointerdown",(t=>{let{offsetX:e,offsetY:i,deltaX:s,deltaY:n}=t;r=!0,this._onMoveMap&&this._onMoveMap(e,i)})),this.miniMap.canvas.addEventListener("pointermove",(t=>{let{offsetX:i,offsetY:n,deltaX:o,deltaY:h}=t;r&&this._onMoveMap&&this._onMoveMap(i,n),(n<5||i<5||i>e-5||n>s-5)&&(r=!1)})),this.miniMap.canvas.addEventListener("pointerup",(()=>{r=!1}));const h=document.createElement("canvas");h.width=n,h.height=o,this.cacheMinimapCtx=h.getContext("2d")}const{width:a,height:l,raw_width:c,raw_height:d,left:u,top:g,scale:f,ctx:p}=this.miniMap,_=2*e,m=e,b=(a-_)/n,w=(l-_)/o,v=Math.min(b,w);let x=0,y=0;"center"===s?(y=(l-o*v)/2-h*v,x=(a-n*v)/2-r*v):b<w?(y=(l-o*v)/2-h*v,x=m):(x=(a-n*v)/2-r*v,y=m);const k=this.cacheMinimapCtx;k.setTransform(),k.clearRect(0,0,c,d),k.scale(f,f),k.transform(v,0,0,v,x,y);const T=[0,0,0,0];this.NodeRenderTop?(this._linkStack.render(k,(t=>(t.isInViewBox(T),!0))),this._stack.render(k)):(this._stack.render(k),this._linkStack.render(k,(t=>(t.isInViewBox(T),!0))));const M=k.getImageData(0,0,c,d);this._renderMap=()=>{p.save(),p.setTransform(),p.clearRect(0,0,c,d),p.scale(f,f),p.putImageData(M,0,0),p.transform(v,0,0,v,x,y);const[t,e,i,s]=this._getViewBox();p.beginPath(),p.rect(t,e,i-t,s-e),p.setTransform(),p.rect(0,0,c,d),p.clip("evenodd"),p.fillStyle="rgba(0,0,0,0.4)",p.fillRect(0,0,c,d),p.restore()},this._renderMap(),this._onMoveMap=(t,e)=>{const[i,s,n,o]=this._getViewBox(),r=[((n-i)/2+i)*v+x,((o-s)/2+s)*v+y];this._recalculatePosition((r[0]-t)/v*this.scale,(r[1]-e)/v*this.scale),this._render(),this._renderMap()}}};class st{constructor(t,e={}){this.anchor=[0,0],this.width=e.barWidth||4,this.height=e.barWidth||4,this.barMarginX=0,this.barMarginY=0,this.dir=t,this.plainColor=e.plainColor||"rgba(0, 0, 0, 0.15)",this.focusColor=e.focusColor||"rgba(0, 0, 0, 0.25)",this.isFocus=!1}render(t){const[e,i]=this.anchor;if(t.save(),t.beginPath(),"x"===this.dir){const s=this.height/2,n=i+s,o=i+this.height,r=e+this.width-2*this.barMarginX-s,h=e+this.barMarginX+s;t.moveTo(h,o),t.arc(h,n,s,Math.PI/2,Math.PI/2*3),t.lineTo(r,i),t.arc(r,n,s,-Math.PI/2,Math.PI/2),t.closePath()}else{const s=this.width/2,n=i+this.barMarginY+s,o=i+this.height-2*this.barMarginY-s,r=e+s,h=e+this.width;t.moveTo(e,n),t.arc(r,n,s,-Math.PI,0),t.lineTo(h,o),t.arc(r,o,s,0,Math.PI),t.closePath()}t.fillStyle=this.isFocus?this.focusColor:this.plainColor,t.fill(),t.restore()}isHit(t){const e=this.anchor,i=this.width,s=this.height;return t[0]>e[0]-5&&t[0]<e[0]+i+5&&t[1]>e[1]-5&&t[1]<e[1]+s+5}}const nt={initScrollBar(t={}){const{barColor:e,barFocusColor:i,barMarginX:s,barMarginY:n,barWidth:o}=t;this._scrollbarEnable=!0,this._scrollbarX=new st("x",{plainColor:e,focusColor:i,barWidth:o}),this._scrollbarX.barMarginX=s||5,this._scrollbarY=new st("y",{plainColor:e,focusColor:i,barWidth:o}),this._scrollbarY.barMarginY=n||5,this._scrollBarStatus={dragging:!1,target:null,xscale:void 0,yscale:void 0,barInitX:0,barInitY:0},this.addEventListener("zoompan",(()=>{this.scrollBarOnPanAndZoom()})),this.scrollBarOnPanAndZoom()},onScrollbarPressStart(t,e){if(this._scrollbarEnable){if(this._scrollbarX.isHit([t,e]))return Object.assign(this._scrollBarStatus,{dragging:!0,target:this._scrollbarX,barStartX:this._scrollbarX.anchor[0],barInitX:t}),!0;if(this._scrollbarY.isHit([t,e]))return Object.assign(this._scrollBarStatus,{dragging:!0,target:this._scrollbarY,barStartY:this._scrollbarY.anchor[1],barInitY:e}),!0}return!1},onDraggingScrollbar(t,e){if(this._scrollbarEnable&&this._scrollBarStatus.dragging){const{target:i,barInitX:s,barStartX:n,barInitY:o,barStartY:r,xscale:h,yscale:a,scollbarHeight:l,scollbarWidth:c,realR:d,realL:u,realT:g,realB:f}=this._scrollBarStatus,{actual_width:p,actual_height:_}=this.canvasMeta,{x:m,y:b}=this.bounding_box;if("x"===i.dir){const e=n+(t-s),o=(m-((d-u)*((i.anchor[0]=Math.max(Math.min(e,p-c),0))/p)+u))*this.scale;Object.assign(this.position,{offsetX:o-m*this.scale,x:o})}if("y"===i.dir){const t=r+(e-o),s=(b-((f-g)*((i.anchor[1]=Math.max(Math.min(t,_-l),0))/_)+g))*this.scale;Object.assign(this.position,{offsetY:s-b*this.scale,y:s})}return this.scheduleRender(),!0}return!1},checkScrollBarHover(t,e){if(this._scrollbarEnable){if(this._scrollbarX.isHit([t,e]))return this._scrollbarX.isFocus||(this._scrollbarX.isFocus=!0,this.scheduleRender()),this.canvas.style.cursor="default",!0;if(this._scrollbarY.isHit([t,e]))return this._scrollbarY.isFocus||(this._scrollbarY.isFocus=!0,this.scheduleRender()),this.canvas.style.cursor="default",!0}return!1},resetScrollBarHover(){this._scrollbarEnable&&(this._scrollbarY.isFocus||this._scrollbarX.isFocus)&&(this._scrollbarY.isFocus=!1,this._scrollbarX.isFocus=!1,this.scheduleRender())},_getScrollViewBoundingbox(){const{width:t,height:e,x:i,y:s}=this.bounding_box;return{width:t+240,height:e+240,x:i-120,y:s-120}},scrollBarOnPanAndZoom(){if(!this._scrollbarEnable||this._scrollBarStatus.dragging)return;const{width:t,height:e,x:i,y:s}=this._getScrollViewBoundingbox();let[n,o,r,h]=this._getViewBox();const a=Math.max(r,i+t),l=Math.min(n,i),c=Math.min(o,s),d=Math.max(h,s+e),u=r-n,g=h-o,{actual_width:f,actual_height:p}=this.canvasMeta,_=u/(a-l);if(_<1){const t=f*_,e=(n-l)*_*this.scale;this._scrollbarX.anchor=[e,p-10],this._scrollbarX.width=t,this._scrollBarStatus.scollbarWidth=t}const m=g/(d-c);if(m<1){const t=p*m,e=(o-c)*m*this.scale;this._scrollbarY.anchor=[f-10,e],this._scrollbarY.height=t,this._scrollBarStatus.scollbarHeight=t}Object.assign(this._scrollBarStatus,{yscale:m,xscale:_,realR:a,realL:l,realT:c,realB:d})},resetScollBarStatus(){this._scrollbarEnable&&Object.assign(this._scrollBarStatus,{dragging:!1,target:null,x:void 0,y:void 0})},renderScrollBar(t){if(this._scrollbarEnable){t.setTransform(),t.scale(this.dpr,this.dpr);const{xscale:e,yscale:i}=this._scrollBarStatus;e<1&&this._scrollbarX.render(t),i<1&&this._scrollbarY.render(t)}}},ot={initSchedule(){this.__clock__=void 0},scheduleRender(t){requestAnimationFrame((e=>{this.__clock__!==e&&this.__render(),t&&t(e),this.__clock__=e}))}};class rt extends CustomEvent{constructor(t,e={}){super(t,{detail:{...e,originEvent:e.event,target:e.target,jflow:e.jflow,bubbles:e.bubbles||!1}})}}const ht=rt,at={...K,...Q,_setPadding(t){this.padding={top:t.paddingTop||t.padding||0,right:t.paddingRight||t.padding||0,bottom:t.paddingBottom||t.padding||0,left:t.paddingLeft||t.padding||0}},_setMargin(t){this.margin={top:t.marginTop||t.margin||0,right:t.marginRight||t.margin||0,bottom:t.marginBottom||t.margin||0,left:t.marginLeft||t.margin||0}},_getCenter(){const t=this.anchor,e=this.padding,i=this.margin,s=(i.left-i.right)/2,n=(i.top-i.bottom)/2,o=(e.left-e.right)/2+s,r=(e.top-e.bottom)/2+n;return this._shape.anchor=[t[0]+s,t[1]+n],[t[0]+o,t[1]+r]},setAnchorX(t){this.anchor[0]=t,this._getCenter()},setAnchorY(t){this.anchor[1]=t,this._getCenter()},setAnchor(t,e){this.anchor[0]=t,this.anchor[1]=e,this._getCenter()},_calculatePointBack(t){const[e,i]=t,[s,n]=this._getCenter();return[e-s,i-n]},calculateToCoordination(t){const[e,i]=t,[s,n]=this._getCenter(),o=[e+s,i+n];return this._belongs&&this._belongs.calculateToCoordination?this._belongs.calculateToCoordination(o):o},calculateToRealWorld(t){const[e,i]=t,[s,n]=this._getCenter(),o=[e+s,i+n];if(this._belongs&&this._belongs.calculateToRealWorld)return this._belongs.calculateToRealWorld(o)},clone(){const t=new(0,this.constructor)(Object.assign({},this._rawConfigs,{layout:this._layout&&this._layout.clone()}));return this.interateNodeStack((e=>{t.addToStack(e.clone())})),t.recalculate(),t.visible=this.visible,t},getBoundingDimension(){return{width:this.width,height:this.height}},getBoundingRect(){const t=this.anchor,e=this.width/2,i=this.height/2;return[t[0]-e,t[1]-i,t[0]+e,t[1]+i]},getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,i]=t,s=this.width/2,n=this.height/2;return{[I.RIGHT]:[e+s,i],[I.LEFT]:[e-s,i],[I.BOTTOM]:[e,i+n],[I.TOP]:[e,i-n],[I.SELF]:[e+.618*s,i+.618*n]}},calculateIntersection(t){const[e,i]=t,[s,n]=this.anchor,o=this.width/2,r=this.height/2,h=s-e,a=n-i,l=r/o,c=Math.abs(a/h),d=e>s,u=i>n;let g,f;return c<l?(g=s+(d?o:-o),f=o*(u?c:-c)+n):(f=n+(u?r:-r),g=r/(d?c:-c)+s),[g,f]},onEnterViewbox(){this.interateNodeStack((t=>{t.onEnterViewbox()}))},onLeaveViewbox(){this.interateNodeStack((t=>{t.onLeaveViewbox()}))},destroy(){this._shape.destroy(),this.interateNodeStack((t=>{t.destroy()}))}};function lt(t,e){return[t,e]}const ct=function(t,e={}){const i="function"==typeof e.shapeShift?e.shapeShift:lt;class s extends V{constructor(e){super(e),this.initStack(e),this.initLayout(e),this._shape=new t(e),this._shape.anchor=[0,0],this._shape._belongs=this,this._setPadding(e),this._setMargin(e),this.definedWidth=e.width,this.minWidth=e.minWidth,this.definedHeight=e.height,this.lock=e.lock??!0,this.display=e.display||"default",this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect()}}return Object.assign(s.prototype,at),Object.assign(s.prototype,{reflow(){at.reflow.call(this);const t=this.margin,[e,s]=i(this.width-t.left-t.right,this.height-t.top-t.bottom,this._shape);this._shape.width=e,this._shape.height=s},setConfig(t){this._shape.setConfig(t),this._setPadding(t),this._setMargin(t),"opacity"in t&&(this.opacity=t.opacity),t.layout&&this._layout!==t.layout&&(this._layout=t.layout)},_getBoundingGroupRect(){const t=R(this._stack.getBoundingRectPoints()),e=this.padding,s=this.minWidth-e.left-e.right,n=this.definedWidth-e.left-e.right,o=t.width+e.left+e.right,r=t.height+e.top+e.bottom,h=s?Math.max(s,o):n||o,a=this.definedHeight||r;this._paddingWidth=h,this._paddingHeight=a;const[l,c]=i(h,a,this._shape);this._shape.width=l,this._shape.height=c;const d=this.margin;this.width=l+d.left+d.right,this.height=c+d.top+d.bottom},render(t){t.save(),this._isMoving?t.globalAlpha=.6:1!==this.opacity&&(t.globalAlpha=this.opacity);const[e,i]=this._getCenter();this._shape.render(t),t.translate(e,i),this._stack.render(t),this._linkStack.render(t),t.translate(-e,-i),t.restore()},isHit(t,e){const i=this._calculatePointBack(t);this._currentp=i;return this._stack.checkHit(i,e)||this._shape.isHit(t)}}),s},dt=class extends V{constructor(t={}){super(t),this.type="Rectangle",this.width=t.width||10,this.height=t.height||10,this.borderRadius=t.borderRadius||0,this._setBorder(t)}_setBorder(t){this.border={top:{color:t.border?.top?.borderColor||t.borderColor||"transparent",width:t.border?.top?.borderWidth||t.borderWidth||0,enable:t.border?.top?.borderWidth},right:{color:t.border?.right?.borderColor||t.borderColor||"transparent",width:t.border?.right?.borderWidth||t.borderWidth||0,enable:t.border?.right?.borderWidth},bottom:{color:t.border?.bottom?.borderColor||t.borderColor||"transparent",width:t.border?.bottom?.borderWidth||t.borderWidth||0,enable:t.border?.bottom?.borderWidth},left:{color:t.border?.left?.borderColor||t.borderColor||"transparent",width:t.border?.left?.borderWidth||t.borderWidth||0,enable:t.border?.left?.borderWidth}},this.borderColor=t.borderColor||"transparent",this.borderWidth=t.borderWidth||0}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])})),this._setBorder(t)}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6);const{borderRadius:e,anchor:i,width:s,height:n}=this,o=this.anchor[0]-this.width/2,r=this.anchor[1]-this.height/2,h=this.anchor[0]+this.width/2,a=this.anchor[1]+this.height/2;if(this.borderRadius?(t.beginPath(),t.moveTo(o+e,r),t.lineTo(o+s-e,r),t.quadraticCurveTo(o+s,r,o+s,r+e),t.lineTo(o+s,r+n-e),t.quadraticCurveTo(o+s,r+n,o+s-e,r+n),t.lineTo(o+e,r+n),t.quadraticCurveTo(o,r+n,o,r+n-e),t.lineTo(o,r+e),t.quadraticCurveTo(o,r,o+e,r),t.closePath()):(t.beginPath(),t.rect(this.anchor[0]-this.width/2,this.anchor[1]-this.height/2,this.width,this.height)),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor),this.shadowColor&&"transparent"!==this.shadowColor){t.shadowColor=this.shadowColor;const i=this._jflow.scale;t.shadowBlur=this.shadowBlur*i,t.shadowOffsetX=this.shadowOffsetX*i,t.shadowOffsetY=this.shadowOffsetY*i;let h=new Path2D;this.borderRadius?(h.moveTo(o+e,r),h.lineTo(o+s-e,r),h.quadraticCurveTo(o+s,r,o+s,r+e),h.lineTo(o+s,r+n-e),h.quadraticCurveTo(o+s,r+n,o+s-e,r+n),h.lineTo(o+e,r+n),h.quadraticCurveTo(o,r+n,o,r+n-e),h.lineTo(o,r+e),h.quadraticCurveTo(o,r,o+e,r),h.closePath()):h.rect(this.anchor[0]-this.width/2,this.anchor[1]-this.height/2,this.width,this.height),h.rect(o-10,r-10,this.width+20,this.height+20),t.save(),t.clip(h,"evenodd"),t.stroke(),t.restore()}if(t.fillStyle=this.backgroundColor,t.fill(),this.borderRadius&&this.borderWidth&&(t.shadowColor="transparent",t.stroke()),this.borderRadius){if(this.border.top.enable){const i=r-this.border.top.width/2;t.beginPath();let n=new Path2D;n.moveTo(o,i+e),n.quadraticCurveTo(o,i,o+e,i),n.lineTo(o+s-e,i),n.quadraticCurveTo(o+s,i,o+s,i+e),n.closePath(),t.clip(n),t.save(),t.shadowColor="transparent",t.fillStyle=this.border.top.color,t.rect(o,i,this.width,this.border.top.width),t.fill(),t.restore()}}else this.border.top.width&&(t.beginPath(),t.moveTo(o,r),t.lineTo(h,r),t.strokeStyle=this.border.top.color,t.lineWidth=this.border.top.width,t.stroke()),this.border.right.width&&(t.beginPath(),t.moveTo(h,r),t.lineTo(h,a),t.strokeStyle=this.border.right.color,t.lineWidth=this.border.right.width,t.stroke()),this.border.bottom.width&&(t.beginPath(),t.moveTo(h,a),t.lineTo(o,a),t.strokeStyle=this.border.bottom.color,t.lineWidth=this.border.bottom.width,t.stroke()),this.border.left.width&&(t.beginPath(),t.moveTo(o,a),t.lineTo(o,r),t.strokeStyle=this.border.left.color,t.lineWidth=this.border.left.width,t.stroke());t.restore()}isHit(t){const e=this.anchor,i=this.width/2,s=this.height/2;return t[0]>e[0]-i&&t[0]<e[0]+i&&t[1]>e[1]-s&&t[1]<e[1]+s}getBoundingRect(){const t=this.anchor,e=this.width/2,i=this.height/2;return[t[0]-e,t[1]-i,t[0]+e,t[1]+i]}getBoundingDimension(){return{height:this.height,width:this.width}}calculateIntersection(t){const[e,i]=t,[s,n]=this.anchor,o=this.width/2,r=this.height/2,h=s-e,a=n-i,l=r/o,c=Math.abs(a/h),d=e>s,u=i>n;let g,f;return c<l?(g=s+(d?o:-o),f=o*(u?c:-c)+n):(f=n+(u?r:-r),g=r/(d?c:-c)+s),[g,f]}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,i]=t,s=this.width/2,n=this.height/2;return{[I.RIGHT]:[e+s,i],[I.LEFT]:[e-s,i],[I.BOTTOM]:[e,i+n],[I.TOP]:[e,i-n]}}calculateIntersectionInFourDimension(t,e){const[i,s]=t;let n=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(n=this._belongs.calculateToCoordination(n));const[o,r]=n,h=this.width/2,a=this.height/2,l={[I.RIGHT]:[o+h,r],[I.LEFT]:[o-h,r],[I.BOTTOM]:[o,r+a],[I.TOP]:[o,r-a]},c=o-i,d=r-s,u=a/h,g=i>o;let f=Math.abs(d/c)>u?s>r?I.BOTTOM:I.TOP:g?I.RIGHT:I.LEFT;return{p:l[f],dir:f}}},ut=class extends V{constructor(t={}){super(t),this.type="Capsule",this.width=t.width||20,this.height=t.height||10}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const[e,i]=this.anchor,s=this.width/2,n=this.height/2,o=e-s+n,r=e+s-n,h=i-n,a=i+n;t.moveTo(o,h),t.lineTo(r,h),t.arc(r,i,n,-Math.PI/2,Math.PI/2),t.lineTo(o,a),t.arc(o,i,n,Math.PI/2,Math.PI/2*3),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}isHit(t){const e=this.anchor,i=this.width/2,s=this.height/2,n=Math.abs(i-s),o=e[0]-i+s,r=e[0]+i-s,h=s*s;return t[0]>e[0]-n&&t[0]<e[0]+n&&t[1]>e[1]-s&&t[1]<e[1]+s||Math.pow(t[0]-o,2)+Math.pow(t[1]-e[1],2)<h||Math.pow(t[0]-r,2)+Math.pow(t[1]-e[1],2)<h}getBoundingRect(){const t=this.anchor,e=this.width/2,i=this.height/2;return[t[0]-e,t[1]-i,t[0]+e,t[1]+i]}getBoundingDimension(){return{height:this.height,width:this.width}}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,i]=t,s=this.width/2,n=this.height/2;return{[I.RIGHT]:[e+s,i],[I.LEFT]:[e-s,i],[I.BOTTOM]:[e,i+n],[I.TOP]:[e,i-n]}}},gt=class extends V{constructor(t={}){super(t),this.type="Diamond",this.width=t.width||20,this.height=t.height||10,this.side=t.side||6,this._doCache()}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])})),this._doCache()}_doCache(){this.sinSIDE=Math.sin(Math.PI/3)*this.side,this.cosSIDE=Math.cos(Math.PI/3)*this.side}render(t){const[e,i]=this.anchor,s=this.width/2,n=this.height/2,o=n/1.732,r=e-s+o,h=e+s-o,a=e+s,l=e-s,c=i-n,d=i+n;this._cachePoints=[[h,c],[a,i],[h,d],[r,d],[l,i],[r,c]],t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const{side:u,sinSIDE:g,cosSIDE:f}=this;t.moveTo(e,c),t.lineTo(h-u,c),t.quadraticCurveTo(h,c,h+f,c+g),t.lineTo(a-f,i-g),t.quadraticCurveTo(a,i,a-f,i+g),t.lineTo(h+f,d-g),t.quadraticCurveTo(h,d,h-u,d),t.lineTo(r+u,d),t.quadraticCurveTo(r,d,r-f,d-g),t.lineTo(l+f,i+g),t.quadraticCurveTo(l,i,l+f,i-g),t.lineTo(r-f,c+g),t.quadraticCurveTo(r,c,r+u,c),t.closePath(),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}isHit(t){if(!this._cachePoints)return!1;const e=this._cachePoints;let i=!1;for(let s=0,n=e.length-1;s<e.length;s++)e[s][1]>t[1]!=e[n][1]>t[1]&&t[0]<(e[n][0]-e[s][0])*(t[1]-e[s][1])/(e[n][1]-e[s][1])+e[s][0]&&(i=!i),n=s;return i}getBoundingRect(){const t=this.anchor,e=this.width/2,i=this.height/2;return[t[0]-e,t[1]-i,t[0]+e,t[1]+i]}getBoundingDimension(){return{height:this.height,width:this.width}}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,i]=t,s=this.width/2,n=this.height/2;return{[I.RIGHT]:[e+s,i],[I.LEFT]:[e-s,i],[I.BOTTOM]:[e,i+n],[I.TOP]:[e,i-n]}}};Math.sqrt(3);const ft={canvas:{wheel(t,e){t.preventDefault();let{offsetX:i,offsetY:s,deltaX:n,deltaY:o}=t;t.ctrlKey&&(o=-o),e.zoomHandler(i,s,n,o,t)}}},pt=class extends G{constructor(t={}){super(),this.from=t.from,this.to=t.to,this.fromDir=t.fromDir,this.toDir=t.toDir,this._cachePoints=null,this.backgroundColor=t.backgroundColor||"#000",this.isSelf=!!t.isSelf}isInViewBox(t){return!0}},_t="left",mt="right",bt=class extends dt{constructor(t){super(t),this.type="Text",this.content=t.content||"",this.fontFamily=t.fontFamily||"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",this.fontSize=t.fontSize||"28px",this.fontWeight=t.fontWeight||"",this.textColor=t.textColor||"white",this.placeholderColor=t.placeholderColor||t.textColor||"white",this.textAlign=t.textAlign||"center",this.textBaseline=t.textBaseline||"middle",this.lineHeight=t.lineHeight,this.indent=t.indent||0,this.backgroundColor=t.backgroundColor,this.editable=t.editable,this.minWidth=t.minWidth||0,this.maxWidth=t.maxWidth,this.ellipsis=t.ellipsis,this.placeholder=t.placeholder||"",this.emptyWhenInput=t.emptyWhenInput||!1,this.editting=!1,this.disabled=t.disabled,r((t=>{this.renderShadowText(t)})),this._makeEditable()}get currentContent(){return this.content||this.placeholder}get isEmpty(){return!this.content}_makeEditable(){this.editable&&this.addEventListener("click",(t=>{if(this.disabled)return;let e;const i=this.width/2;e=this.textAlign===_t?this.anchor[0]-i+this.indent/2:this.textAlign===mt?this.anchor[0]+i:this.anchor[0]+this.indent/2;const s=[e,-this.height/2],n=+/(\d+)/.exec(this.fontSize)[1],[o,r]=this.calculateToRealWorld(s);let h=function(){const t=document.createElement("input");return t.setAttribute("style","\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        background-image:none;\n        background-color:transparent;\n        -webkit-box-shadow: none;\n        -moz-box-shadow: none;\n        box-shadow: none;"),t}();const a=this._jflow.DOMwrapper;let l=this.content,c=this.textColor;h.style.margin=0,h.style.padding=0,h.style.transform=`translate(${o}px, ${r}px)`,h.style.width=this.calculateToRealWorldWithScalar(this.width)+"px",h.style.height=this.calculateToRealWorldWithScalar(this.height)+"px",h.style.fontFamily=this.fontFamily,a.style.fontSize=n*this._jflow.scale+"px",h.style.fontSize=n*this._jflow.scale+"px",h.style.lineHeight=this.lineHeight*this._jflow.scale+"px",h.style.textIndent=this.indent*this._jflow.scale+"px",h.value=this.emptyWhenInput?"":this.content,h.style.color=this.textColor,h.setAttribute("placeholder",this.placeholder),h.addEventListener("focus",(t=>{this.textColor="transparent",this.editting=!0,this._jflow._render(),h.style.outline="none"}));let d=()=>{this.editting=!1,this.dispatchEvent(new ht("blur",{target:this}));const t=h.value;this.dispatchEvent(new ht("change",{target:this,oldVal:l,val:t})),this.textColor=c,this._jflow._render(),this._jflow.removeEventListener("zoompan",d),h.removeEventListener("blur",d),h.removeEventListener("keypress",u),a.removeChild(h),h=null,d=null,this.inputElement=null};this._jflow.addEventListener("zoompan",d),h.addEventListener("blur",d);const u=t=>{if("Enter"===t.key||13===t.keyCode){t.preventDefault();let e=!0;this.dispatchEvent(new ht("enterkeypressed",{target:this,handler:t=>{e=t}})),e&&(h.removeEventListener("keypress",u),d())}};h.addEventListener("keypress",u),h.addEventListener("input",(t=>{let e=!1;this.dispatchEvent(new ht("input",{target:this,oldVal:l,val:t.target.value,handler(t){l=t,h.value=t,e=!0}})),e||(l=t.target.value)})),a.append(h),h.focus({preventScroll:!0}),this.inputElement=h}))}renderShadowText(t){t.beginPath(),t.font=`${this.fontSize} ${this.fontFamily}`,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.fillStyle=this.textColor;const e=parseInt(this.fontSize),i=this.currentContent,{actualBoundingBoxLeft:s,actualBoundingBoxRight:n,fontBoundingBoxAscent:o,fontBoundingBoxDescent:r}=t.measureText(i);if(this._textWidth=this.indent+Math.abs(s)+Math.abs(n),this.maxWidth&&this.ellipsis){if(this._textWidth>this.maxWidth){const t=this.maxWidth/this._textWidth,e=Math.floor(i.length*t-3);this.ellipsisContent=i.substring(0,e)+"..."}else this.ellipsisContent=i;this.width=this.maxWidth}else this.width=Math.max(this.minWidth,this._textWidth);const h=Math.abs(o)+Math.abs(r)||e;this.lineHeight?this.height=this.lineHeight:this.height=h}setConfig(t){Object.keys(t).forEach((e=>{void 0!==t[e]&&null!==t[e]&&(this[e]=t[e],this._rawConfigs[e]=t[e])})),r((t=>{this.renderShadowText(t)}))}render(t){if(t.save(),this._isMoving&&(t.globalAlpha=.6),this.editting)return;t.beginPath(),t.font=`${this.fontWeight} ${this.fontSize} ${this.fontFamily}`,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.fillStyle=this.isEmpty?this.placeholderColor:this.textColor;let e=this.currentContent;if(this.ellipsisContent&&(e=this.ellipsisContent),this.textAlign===_t){const i=this.width/2;t.fillText(e,this.anchor[0]-i+this.indent/2,this.anchor[1])}else if(this.textAlign===mt){const i=this.width/2;t.fillText(e,this.anchor[0]+i,this.anchor[1])}else t.fillText(e,this.anchor[0]+this.indent/2,this.anchor[1]);t.restore()}};Math.PI;const wt=Math.PI/180,vt=class extends pt{constructor(t){super(t),this.approximate=t.approximate||6,this.minSpanX=t.minSpanX||0,this.minSpanY=t.minSpanY||0,this.lineDash=t.lineDash,this.doubleLink=t.doubleLink,this.fontFamily=t.fontFamily="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",this.fontSize=t.fontSize||"12px",this.content=t.content||"",this.isSelf=!!t.isSelf}_calculateAnchorPoints(){const t=this.from.getIntersectionsInFourDimension(),e=this.to.getIntersectionsInFourDimension();if(this.isSelf){const i=A(t[this.fromDir],e[I.SELF],this.fromDir,I.BOTTOM,this.minSpanX,this.minSpanY);this._cachePoints=[...t[this.fromDir],...i],this._cacheAngle=[this.fromDir,I.BOTTOM]}else if(void 0!==this.fromDir&&void 0!==this.toDir){const i=A(t[this.fromDir],e[this.toDir],this.fromDir,this.toDir,this.minSpanX,this.minSpanY);this._cachePoints=[...t[this.fromDir],...i],this._cacheAngle=[this.fromDir,this.toDir]}else{const i=function(t,e){const i={fromDir:null,fromP:null,toDir:null,toP:null,distMin:1/0};return Object.keys(t).forEach((s=>{if(+s===I.SELF)return;let n=t[s];Object.keys(e).forEach((t=>{if(+t===I.SELF)return;let o=e[t];const r=W(n,o);r<i.distMin&&Object.assign(i,{distMin:r,fromDir:+s,fromP:n,toDir:+t,toP:o})}))})),i}(t,e),s=A(i.fromP,i.toP,i.fromDir,i.toDir);this._cachePoints=[...i.fromP,...s],this._cacheAngle=[i.fromDir,i.toDir]}}render(t){this._calculateAnchorPoints();const e=this._cachePoints,i=N.apply(null,[1,...e]);if(t.fillStyle=t.strokeStyle=this.backgroundColor,this.doubleLink){const i=(this._cacheAngle[0]+2)%4*90*wt;t.beginPath(),t.translate(e[0],e[1]),t.rotate(i),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-i),t.translate(-e[0],-e[1])}if(t.beginPath(),t.moveTo(e[0],e[1]),t.bezierCurveTo(...e.slice(2)),this.lineDash&&(t.save(),t.setLineDash(this.lineDash)),t.stroke(),this.lineDash&&t.restore(),t.beginPath(),t.translate(e[6],e[7]),t.rotate(i),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-i),t.translate(-e[6],-e[7]),this.content){t.beginPath();const i=e[0]>e[6];let[s,n,o]=function(t,e){const i=.5,s=.125*e[0]+.375*e[2]+.375*e[4]+.125*e[6],n=.125*e[1]+.375*e[3]+.375*e[5]+.125*e[7],o=i*i*(e[2]-e[0])+.5*(e[4]-e[2])+t*t*(e[6]-e[4]),r=i*i*(e[3]-e[1])+.5*(e[5]-e[3])+t*t*(e[7]-e[5]);return[s,n,Math.atan2(r,o)]}(.5,e);t.translate(s,n),t.rotate(o),i&&t.rotate(Math.PI),t.font=`${this.fontSize} ${this.fontFamily}`,t.textAlign="center",t.fillText(this.content,0,-(parseInt(this.fontSize)||12)/4),i&&t.rotate(Math.PI),t.rotate(-o),t.translate(-s,-n)}}isHit(t){if(!this._cachePoints)return!1;const e=function(t,e){const i=new z(...e).project({x:t[0],y:t[1]});return W(t,[i.x,i.y])}(t,this._cachePoints);return e<this.approximate}};class xt{constructor(t={}){this.direction=t.direction||"vertical",this.gap=t.gap??5,this.alignment=t.alignment||"center",this.justify=t.justify||"center",this._rawConfigs=t}reflow(t){const e=t._stack.filter((t=>t.visible&&!t.absolutePosition)),i=t._stack.filter((t=>t.visible&&t.absolutePosition)),s=t.width-t.padding.left-t.padding.right;if("vertical"===this.direction){let n=0,o=0,r=0,h=0;const a=e.concat(i);a.forEach(((t,e)=>{"block"===t.display&&(t.width=0,t.resetChildrenPosition(),t.reflow(),t._getBoundingGroupRect())})),e.forEach(((t,e)=>{const{width:i,height:s}=t.getBoundingDimension(),a=e>0?this.gap:0;"outstretch"!==t.display&&(r=Math.max(i,r)),h+=s+a,n+=s/2+a+o,o=s/2,t.anchor=[0,n]})),a.forEach(((e,i)=>{if("block"===e.display)e.resetChildrenPosition(),e.width=r,e.reflow();else if("outstretch"===e.display){const i=t._belongs.width-t._belongs.padding.left-t._belongs.padding.right;e.resetChildrenPosition(),e.width=Math.max(i,r),e.reflow()}})),r=Math.max(s,r),h/=2,"start"===this.alignment&&e.forEach(((t,e)=>{const{width:i}=t.getBoundingDimension();t.anchor[0]=-(r-i)/2,t.anchor[1]-=h})),"end"===this.alignment&&e.forEach(((t,e)=>{const{width:i}=t.getBoundingDimension();t.anchor[0]=(r-i)/2,t.anchor[1]-=h})),"center"===this.alignment&&e.forEach(((t,e)=>{const{width:i}=t.getBoundingDimension();t.anchor[1]-=h}))}if("horizontal"===this.direction){let t=0,i=0,n=0,o=0,r=0;if(e.forEach(((e,s)=>{const{width:h,height:a}=e.getBoundingDimension(),l=s>0?this.gap:0;n=Math.max(a,n),o+=h+l,r+=h,t+=h/2+l+i,i=h/2,e.anchor=[t,0]})),"start"===this.justify){const t=s/2;e.forEach(((e,i)=>{e.anchor[0]-=t}))}if("end"===this.justify){const t=s/2-o;e.forEach(((e,i)=>{e.anchor[0]+=t}))}if("center"===this.justify){const t=o/2;e.forEach(((e,i)=>{e.anchor[0]-=t}))}if("space-between"===this.justify&&e.length>1){const t=Math.max(s,o),i=(t-o)/(e.length-1),n=t/2;e.forEach(((t,e)=>{t.anchor[0]+=i*e-n}))}"start"===this.alignment&&e.forEach(((t,e)=>{const{height:i}=t.getBoundingDimension();t.anchor[1]=-(n-i)/2})),"end"===this.alignment&&e.forEach(((t,e)=>{const{height:i}=t.getBoundingDimension();t.anchor[1]=(n-i)/2}))}if(i.length){"block"===t.display?t.getBoundingDimension():t._getBoundingGroupRect();const e=t.width/2,s=t.height/2;i.forEach((t=>{t.anchor=this._resolveAbsoluteAnchor(t.absolutePosition,t,e,s)}))}}_resolveAbsoluteAnchor(t,e,i,s){const{top:n,right:o,bottom:r,left:h}=t,{width:a,height:l}=e.getBoundingDimension(),c=a/2,d=l/2;let u=0,g=0;return"number"==typeof n&&(u=n+d-s),"number"==typeof o&&(g=i-o-c),"number"==typeof r&&(u=s-r-d),"number"==typeof h&&(g=h+c-i),[g,u]}clone(){return new xt(this._rawConfigs)}}const yt=xt,kt=ct(dt);ct(ut),ct(class extends V{constructor(t={}){super(t),this.type="Rhombus",this.height=t.diagonalsV||10,this.width=t.diagonalsH||20}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6);const e=this.width/2,i=this.height/2,s=this.anchor;if(t.translate(s[0],s[1]),t.beginPath(),t.moveTo(0,-i),t.lineTo(e,0),t.lineTo(0,i),t.lineTo(-e,0),t.closePath(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor),this.shadowColor){t.shadowColor=this.shadowColor;const s=this._jflow.scale;t.shadowBlur=this.shadowBlur*s,t.shadowOffsetX=this.shadowOffsetX*s,t.shadowOffsetY=this.shadowOffsetY*s;let n=new Path2D;n.moveTo(0,-i),n.lineTo(e,0),n.lineTo(0,i),n.lineTo(-e,0),n.closePath(),n.rect(-e-10,-i-10,this.width+20,this.height+20),t.save(),t.clip(n,"evenodd"),t.stroke(),t.restore()}t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.shadowColor="transparent",t.stroke()),t.translate(-s[0],-s[1]),t.restore()}isHit(t){const e=this.height/2,i=this.width/2,s=this.anchor;return Math.abs(t[0]-s[0])/i+Math.abs(t[1]-s[1])/e<=1}getBoundingRect(){const t=this.anchor,e=this.width/2,i=this.height/2;return[t[0]-e,t[1]-i,t[0]+e,t[1]+i]}getBoundingDimension(){return{height:this.height,width:this.width}}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[e,i]=t,s=this.width/2,n=this.height/2;return{[I.RIGHT]:[e+s,i],[I.LEFT]:[e-s,i],[I.BOTTOM]:[e,i+n],[I.TOP]:[e,i-n],[I.SELF]:[e+.618*s,i+.618*n]}}}),ct(gt,{shapeShift:(t,e)=>[t+.28865*e,e]}),ct(class extends gt{constructor(t){super(t)}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const[e,i]=this.anchor,s=this.width/2,n=this.height/2,o=s/1.732,r=i-n,h=i+n,a=i-n+o,l=i+n-o,c=e-s,d=e+s;t.moveTo(e,r),t.lineTo(d,a),t.lineTo(d,l),t.lineTo(e,h),t.lineTo(c,l),t.lineTo(c,a),t.closePath(),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore(),this._cachePoints=[[e,r],[d,a],[d,l],[e,h],[c,l],[c,a]]}},{shapeShift:(t,e)=>[t,e+.5773*t]}),ct(class extends ut{render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const[e,i]=this.anchor,s=this.width/2,n=this.height/2,o=i-n+s,r=i+n-s,h=e-s,a=e+s;t.moveTo(h,o),t.arc(e,o,s,-Math.PI,0),t.lineTo(a,r),t.arc(e,r,s,0,Math.PI),t.closePath(),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}isHit(t,e){const[i,s]=this.anchor,n=this.width/2,o=this.height/2,r=Math.abs(o-n),h=s-o+n,a=s+o-n,l=n*n;return t[0]>i-n&&t[0]<i+n&&t[1]>s-r&&t[1]<s+r||Math.pow(t[0]-i,2)+Math.pow(t[1]-h,2)<l||Math.pow(t[0]-i,2)+Math.pow(t[1]-a,2)<l}}),ct(class extends V{constructor(t){super(t),this.type="Point",this.radius=t.radius||10}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath(),t.arc(this.anchor[0],this.anchor[1],this.radius,0,2*Math.PI),t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}isHit(t){const e=this.anchor;return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)<this.radius*this.radius}getBoundingRect(){const t=this.anchor,e=this.radius;return[t[0]-e,t[1]-e,t[0]+e,t[1]+e]}calculateIntersection(t){const[e,i]=t,[s,n]=this.anchor,o=s-e,r=n-i,h=Math.sqrt(o*o+r*r),a=this.radius/h;return[s-a*o,n-a*r]}getIntersectionsInFourDimension(){const[t,e]=this.anchor,i=this.radius;return{[I.RIGHT]:[t+i,e],[I.LEFT]:[t-i,e],[I.BOTTOM]:[t,e+i],[I.TOP]:[t,e-i]}}calculateIntersectionInFourDimension(t,e){const[i,s]=t,[n,o]=this.anchor,r=this.radius,h=n-i,a=o-s,l={[I.RIGHT]:[n+r,o],[I.LEFT]:[n-r,o],[I.BOTTOM]:[n,o+r],[I.TOP]:[n,o-r]};let c=Math.abs(a)>Math.abs(h)?a<0?I.BOTTOM:I.TOP:h<0?I.RIGHT:I.LEFT;return{p:l[c],dir:c}}getBoundingDimension(){return{width:2*this.radius,height:2*this.radius}}},{shapeShift(t,e,i){const s=Math.ceil(Math.sqrt(t*t+e*e)/2);i.radius=s;const n=2*s;return[n,n]}});class Tt extends EventTarget{constructor(t){super(),this.uniqueName="jflow",this.eventAdapter=new class{constructor(t={}){this.plugin={canvas:{wheel:function(t,e){t.preventDefault();let{offsetX:i,offsetY:s,deltaX:n,deltaY:o}=t;t.ctrlKey?(o=-o,e.zoomHandler(i,s,n,o,t)):e.panHandler(-n,-o,t)},pointerdown:function(t,e){const{offsetX:i,offsetY:s,deltaY:n,button:o}=t;0===o&&e.pressStartHandler(i,s,t)},pointermove:function(t,e){const{offsetX:i,offsetY:s}=t;e.pressMoveHandler(i,s,t)},pointerup:function(t,e){t.preventDefault(),t.stopPropagation();const{button:i}=t;0===i&&e.pressUpHanlder(!1,t)},contextmenu:function(t,e){t.preventDefault(),t.stopPropagation();const{offsetX:i,offsetY:s}=t;e.contextMenuHanlder(i,s,t)},dblclick:function(t,e){t.preventDefault(),t.stopPropagation();const{offsetX:i,offsetY:s}=t;e.dblclickHandler(i,s,t)},click:function(t,e){t.preventDefault(),t.stopPropagation();const{offsetX:i,offsetY:s}=t;e.clickHanlder(i,s,t)}},document:{pointerup:function(t,e){e.pressUpHanlder(!0,t)}}},this.use(t),this.canvasHandlers=[],this.documentHandlers=[]}use(t={}){const{canvas:e,document:i}=t;if(e)for(let t in e)e.hasOwnProperty(t)&&(this.plugin.canvas[t]=e[t]);if(i)for(let t in i)i.hasOwnProperty(t)&&(this.plugin.document[t]=i[t])}apply(t){const{canvas:e,document:i}=this.plugin,s=t.canvas;for(let i in e){const n=e[i];function o(e){n(e,t)}s.addEventListener(i,o),this.canvasHandlers.push({eventName:i,handlerWrapperd:o})}for(let e in i){const s=i[e];function n(e){s(e,t)}document.addEventListener(e,n),this.documentHandlers.push({eventName:e,handlerWrapperd:n})}}unload(t){const e=t.canvas;this.canvasHandlers.forEach((({eventName:t,handlerWrapperd:i})=>{e.removeEventListener(t,i)})),this.documentHandlers.forEach((({eventName:t,handlerWrapperd:e})=>{document.removeEventListener(t,e)}))}}(t.eventAdapter),this.initNodeWeakMap(),this.initAnime(),this.initStack(t),this.initLayout(t),this.ctx=null,this.canvas=null,this.dpr=1,this.padding=20,this.position=null,this.scale=null,this.initialZoom=t.initialZoom,this.initialPosition=t.setInitialPosition,this.maxZoom=t.maxZoom||3,this.minZoom=t.minZoom||.5,this.NodeRenderTop=!!t.NodeRenderTop,this.worldMargin=t.worldMargin,this.draggingbehavior=Object.assign({panInBorder:{enable:!0,padding:20,deltamovement:8}},t.draggingbehavior||{}),this.scrollBarBehavior=Object.assign({enable:!0},t.scrollBarBehavior||{}),this.offeset=null,this._lastState={x:null,y:null,dragging:!1,processing:!1},this._lastDragState={target:null,targetLink:null,processing:!1},this._target={instance:null,link:null,moving:null,isInstanceDirty:!1,isLinkDirty:!1,cache:{stack:null,belongs:null,point:null},meta:{x:void 0,y:void 0,initialX:void 0,initialY:void 0},status:{dragovering:!1,dragging:!1,processing:!1,movingState:!1}},this._focus={instance:null},this._dragOverTarget=null,this.allowDrop=t.allowDrop,this._tempNode=null,this._tempLink=null,this.mode=L,this._allowMovingTarget=!0}setMovingTargets(t){Object.assign(this._target,{moving:t})}setTempDraggingInstance(t){t._belongs=this,this._tempNode=t,Object.assign(this._target,{moving:[this._tempNode],dragging:!0})}removeTempDraggingInstance(){if(this._tempNode){const t=this._tempNode.anchor;return this._tempNode=null,t}}preventDefaultDragging(){this._allowMovingTarget=!1}allowDefaultDragging(){this._allowMovingTarget=!0}$mount(t){const{canvas:e,ctx:s,scale:n,width:o,height:r,raw_width:a,raw_height:l,left:c,top:d}=i(t);this.reflow(),this.ctx=s,this.DOMwrapper=t,this.canvas=e,this.canvas.setAttribute("data-jflow",!0),this.canvas.$jflow=this,this.canvasMeta={width:a,height:l,actual_width:o,actual_height:r},this.dpr=n,this._getBoundingGroupRect();const u=this.padding,{width:g,height:f,x:p,y:_}=this.bounding_box,m={x:u,y:u,width:o-2*u,height:r-2*u},b={x:0,y:0,offsetX:0,offsetY:0},w=m.width/g,v=m.height/f,x=w<=v?"x":"y";let y;y=this.initialZoom?this.initialZoom:Math.min(w,v),this.scale=y,y>this.maxZoom&&(this.maxZoom=y),y<this.minZoom&&(this.minZoom=y);const k=p*y,T=_*y,M=m.width,S=m.height;if(this.initialPosition){const{x:t,y:e}=this.initialPosition(k,T,M,S,m.x,m.y,o,r,p,_,g,f);b.x=t,b.y=e}else b.x="x"===x?m.x:(M-g*y)/2+u,b.y="y"===x?m.y:(S-f*y)/2+u;b.offsetX=b.x-k,b.offsetY=b.y-T,this.position=b,this._readyToRender=!0,this.scrollBarBehavior.enable&&this.initScrollBar(this.scrollBarBehavior),this.scheduleRender((()=>{this._createEventHandler()})),h((t=>{this.dpr=t,this.scheduleRender()}))}setLinkingMode(t,e){const i=this.getRenderNodeBySource(t);this._tempNode=new U,this._tempLink=e({from:i,to:this._tempNode}),this.sendMessage({instance:t}),this.mode=D}isInLinkingMode(){return this.mode===D}setLinkingLink(t){this.mode===D&&this._tempLink.setConfig(t)}resetLinkingLink(){this.mode===D&&this._tempLink.setConfig({to:this._tempNode})}resizeCanvas(){const{width:t,height:e,raw_width:i,raw_height:s}=function(t,e){const{width:i,height:s,left:n,top:o}=e.getBoundingClientRect();t.style.width=i+"px",t.style.height=s+"px";const r=window.devicePixelRatio;return t.width=Math.floor(i*r),t.height=Math.floor(s*r),{width:i,height:s,raw_width:t.width,raw_height:t.height}}(this.canvas,this.DOMwrapper);this.canvasMeta={width:i,height:s,actual_width:t,actual_height:e}}focusOn(t){const e=this._calculatePointBack([this.canvasMeta.actual_width/2,this.canvasMeta.actual_height/2]);let i=t.anchor;t._belongs.calculateToCoordination&&(i=t._belongs.calculateToCoordination(i));const s=(e[0]-i[0])*this.scale,n=(e[1]-i[1])*this.scale;this._recalculatePosition(s,n),this._render()}_getBoundingGroupRect(){const t=this._stack.getBoundingRectPoints();if(this.bounding_box){this.bounding_box=R(t);const{x:e,y:i}=this.bounding_box,s=this.scale;this.position.x=this.position.offsetX+e*s,this.position.y=this.position.offsetY+i*s}else this.bounding_box=R(t)}_createEventHandler(){const t=this.canvas;let e;this.eventAdapter.apply(this);const i=()=>{this.eventAdapter.unload(this)};if(e=i,this.allowDrop){const s=this._onDragover.bind(this),n=this._onDrop.bind(this),o=this._onDragLeave.bind(this);t.addEventListener("dragover",s),t.addEventListener("drop",n),t.addEventListener("dragleave",o),e=()=>{i(),t.removeEventListener("dragover",s),t.removeEventListener("drop",n),t.removeEventListener("dragleave",o)}}this.destroy=e}_targetLockOn(t,e){let i=this._calculatePointBack(t);const s=i;this._currentp=i;let n=this._stack;const o=this._getViewBox(),r=n.checkHit(i,(t=>this._target.status.dragging&&t===this._getMovingTarget()),(t=>F(o,t.getBoundingRect())));let h,a=this._linkStack;if(r&&r._belongs!==this||(h=a.checkHit(i,(t=>{if(!this._target.status.dragging)return!1;const e=this._getMovingTarget();return t.from===e||t.to===e}))),Object.assign(this._target,{instance:r,link:h,isInstanceDirty:r===this._target.instance,isLinkDirty:h===this._target.link}),Object.assign(this._target.cache,{stack:n,belongs:this,point:i,topLayerPoint:s}),Object.assign(this._target.meta,{x:t[0],y:t[1]}),"pressStart"===e&&!this._target.status.dragging&&!this._target.status.dragovering){let t=r;for(;t&&t._belongs.lock&&t!==this;)t=t._belongs;this.setMovingTargets(t&&[t]),t&&r.bubbleEvent(new ht("afterResolveMovingTarget",{event:e,target:t,jflow:this,bubbles:!0}))}return this._target}_getMovingTarget(){return this._target.moving&&this._target.moving[0]}_processDragOver(t,e){if(this._dragOverTarget!==t){const i=this.readMessage()?.instance;this._dragCurrentData=i;const{point:s}=this._target.cache;if(this._dragOverTarget){const t=this._dragOverTarget;t.dispatchEvent(new ht("dragleave",{event:e,instance:t,target:i,jflow:this,point:s}))}t&&t.dispatchEvent(new ht("dragenter",{event:e,instance:t,target:i,jflow:this,point:s})),this._dragOverTarget=t}else this._dragOverTarget&&this._dragOverTarget.dispatchEvent(new ht("dragover",{event:e,instance:t,jflow:this,target:this._dragCurrentData}));if(this.draggingbehavior?.panInBorder?.enable&&(this.draggingbehavior.panInBorder.timer||(this.draggingbehavior.panInBorder.timer=Date.now()),Date.now()-this.draggingbehavior.panInBorder.timer>500)){const[t,e,i,s]=this._cacheViewBox,[n,o]=this._currentp,{padding:r,deltamovement:h}=this.draggingbehavior.panInBorder;let a=0,l=0;n<t+r&&(a=h),n>i-r&&(a=-h),o<e+r&&(l=h),o>s-r&&(l=-h),this.__processOverAnime&&this.__processOverAnime.cancel(),a||l?this.__processOverAnime=this.requestJFlowAnime((()=>{this.panHandler(a,l)})):this.draggingbehavior.panInBorder.timer=null}}_onDragover(t){if(t.preventDefault(),t.stopPropagation(),this._lastDragState.processing)return;this._lastDragState.processing=!0;const{offsetX:e,offsetY:i}=t;Object.assign(this._target.status,{dragovering:!0}),this._targetLockOn([e,i]);const s=this._target.instance||this._target.link;this._processDragOver(s,t),this._target.isLinkDirty||this._target.isInstanceDirty?Promise.resolve().then((()=>{this._render(),this._target.isLinkDirty=!1,this._target.isInstanceDirty=!1,this._lastDragState.processing=!1})):this._lastDragState.processing=!1}_cancelPanInBorder(){this.__processOverAnime&&this.__processOverAnime.cancel(),this.draggingbehavior?.panInBorder&&(this.draggingbehavior.panInBorder.timer=null)}_onDragLeave(){this._cancelPanInBorder()}_onDrop(t){this._cancelPanInBorder();const e=this.consumeMessage().instance;if(this._dragOverTarget){const e=this._dragOverTarget;e.dispatchEvent(new ht("dragoverend",{event:t,instance:e})),this._dragOverTarget=null}const{link:i,instance:s}=this._target,{point:n,belongs:o}=this._target.cache;i?i.dispatchEvent(new ht("drop",{event:t,instance:e,link:i,jflow:this,belongs:o,point:n})):s?s.bubbleEvent(new ht("drop",{event:t,instance:e,jflow:this,target:s,point:n,bubbles:!0})):this.dispatchEvent(new ht("drop",{event:t,instance:e,jflow:this,target:s,point:n})),requestAnimationFrame((()=>{this.cancelDrop()}))}cancelDrop(){this._target.instance=null,this._target.link=null,Object.assign(this._target.status,{dragovering:!1})}zoomHandler(t,e,i,s,n){if(this._zooming)return;this._zooming=!0;const{width:o,height:r,x:h,y:a}=this.bounding_box,{actual_width:l,actual_height:c}=this.canvasMeta;let d=this.minZoom;if(this.worldMargin){const t=this.worldMargin,e=o+2*t,i=r+2*t;d=Math.max(d,Math.max(l/e,c/i))}let u=this.scale;u*=s>0?1.1:1/1.1,u=Math.min(this.maxZoom,Math.max(d,u));var g=u-this.scale,f=o*this.scale,p=r*this.scale,_=o*g,m=r*g,b=-(t-this.position.x)/f,w=-(e-this.position.y)/p;this.scale=u,this._recalculatePosition(b*_,w*m),this.dispatchEvent(new ht("zoompan")),this.scheduleRender((()=>{this._zooming=!1}))}panHandler(t,e,i){if(this._panning)return;this._panning=!0;const{dragging:s}=this._target.status;if(s){const i=this._target.moving;i&&this._allowMovingTarget&&i.forEach((i=>{i.anchor[0]+=-t/this.scale,i.anchor[1]+=-e/this.scale}))}this._recalculatePosition(t,e),this.dispatchEvent(new ht("zoompan")),this.scheduleRender((()=>{this._panning=!1}))}pressStartHandler(t,e,i){if(!this.onScrollbarPressStart(t,e)&&(Object.assign(this._target.meta,{initialX:t,initialY:e}),this._targetLockOn([t,e],"pressStart"),this.mode!==D)){if(Object.assign(this._target.status,{dragging:!0,processing:!1}),this._target.moving){const t=this._getMovingTarget();t.dispatchEvent(new ht("pressStart",{event:i,instance:t,jflow:this}))}if(this._target.instance){const t=this._target.instance;t.bubbleEvent(new ht("instancePressStart",{event:i,target:t,jflow:this,bubbles:!0}))}}}pressMoveHandler(t,e,i){if(this.onDraggingScrollbar(t,e))return;const{dragging:s,processing:n}=this._target.status,{x:o,y:r}=this._target.meta;if(!s){if(this.checkScrollBarHover(t,e))return;this.resetScrollBarHover()}if(!s&&!n){const{link:s,instance:n}=this._targetLockOn([t,e]),o=n||s;if(o?o.bubbleEvent(new ht("instancemousemove",{event:i,instance:o,jflow:this,bubbles:!0})):this.dispatchEvent(new ht("instancemousemove",{event:i,instance:null,jflow:this})),this.mode===D)return this._tempNode.anchor=this._currentp,void this.scheduleRender((()=>{this._target.isLinkDirty=!1,this._target.isInstanceDirty=!1,this._target.status.processing=!1}))}if(this.dispatchEvent(new ht("canvasmousemove",{event:i,jflow:this})),!s)return;if(n)return;const h=this._target.moving;this._target.status.movingState=!0,this._target.status.processing=!0;const a=t-o,l=e-r;h?this._allowMovingTarget&&h.forEach((t=>{t.anchor[0]+=a/this.scale,t.anchor[1]+=l/this.scale})):(this._recalculatePosition(a,l),this.dispatchEvent(new ht("zoompan")));const{instance:c,link:d}=this._targetLockOn([t,e]);this._processDragOver(c||d,i),this.scheduleRender((()=>{this._target.isLinkDirty=!1,this._target.isInstanceDirty=!1,this._target.status.processing=!1}))}pressUpHanlder(t,e){if(this.__processOverAnime&&this.__processOverAnime.cancel(),this._cancelPanInBorder(),this.resetScollBarStatus(),this._target.meta,this.mode===D){const t=this._target.instance,i=this.consumeMessage();if(t)t.bubbleEvent(new ht("link",{event:e,target:t,jflow:this,payload:i,bubbles:!0}));else{const{offsetX:t,offsetY:s}=e;this.dispatchEvent(new ht("link",{event:e,jflow:this,payload:i,anchor:this._calculatePointBack([t,s])}))}return this._clearTarget(),this._tempNode&&(this._tempNode.destroy(),this._tempNode=null),this._tempLink&&(this._tempLink.destroy(),this._tempLink=null),this.mode=L,void this._render()}if(this._target.moving){let t=!1;if(this._layout.static&&(t=this.staticCheck(this._getMovingTarget())),!t&&this._target.link){const{point:t,belongs:i}=this._target.cache,s=this._target.link,n=this._getMovingTarget();s.dispatchEvent(new ht("drop",{event:e,instance:n,link:s,jflow:this,belongs:i})),this._target.link=null,this._target.instance=null}this._target.moving&&(this._target.instance?this._target.instance.bubbleEvent(new ht("pressEnd",{event:e,instance:this._getMovingTarget(),jflow:this,target:this._target.instance,bubbles:!0})):this.dispatchEvent(new ht("pressEnd",{event:e,instance:this._getMovingTarget(),jflow:this}))),this._target.moving=null,this.removeTempDraggingInstance(),this._render()}this._clearTarget()}clickHanlder(t,e,i){const{link:s,instance:n,meta:o}=this._targetLockOn([t,e]);if(Math.abs(o.initialX-o.x)<1&&Math.abs(o.initialY-o.y)<1){if(i.target!==this.canvas)return this._clearTarget(),void Object.assign(this._target.meta,{initialX:void 0,initialY:void 0});const{topLayerPoint:t}=this._target.cache;if(n||s){const e=n||s;e.bubbleEvent(new ht("click",{event:i,jflow:this,target:e,topLayerPoint:t,bubbles:!0}))}else this.dispatchEvent(new ht("click",{event:i,jflow:this,topLayerPoint:t}));this._clearTarget(),Object.assign(this._target.meta,{initialX:void 0,initialY:void 0})}}contextMenuHanlder(t,e,i){const{link:s,instance:n}=this._targetLockOn([t,e]),{topLayerPoint:o}=this._target.cache;if(n||s){const t=n||s;t.bubbleEvent(new ht("contextclick",{event:i,jflow:this,target:t,topLayerPoint:o,bubbles:!0}))}else this.dispatchEvent(new ht("contextclick",{event:i,jflow:this,topLayerPoint:o}))}dblclickHandler(t,e,i){const{link:s,instance:n}=this._targetLockOn([t,e]),{topLayerPoint:o}=this._target.cache;if(n||s){const t=n||s;t.bubbleEvent(new ht("dblclick",{event:i,jflow:this,target:t,topLayerPoint:o,bubbles:!0}))}else this.dispatchEvent(new ht("dblclick",{event:i,jflow:this,topLayerPoint:o}))}_clearTarget(){Object.assign(this._target.meta,{x:void 0,y:void 0}),Object.assign(this._target.status,{dragging:!1,processing:!1,movingState:!1}),Object.assign(this._target,{instance:null,link:null,moving:null})}_recalculatePosition(t,e,i){const{x:s,y:n,width:o,height:r}=this.bounding_box,{actual_width:h,actual_height:a}=this.canvasMeta;if(void 0===i&&(i=this.scale),this.worldMargin){const l=this.worldMargin,c=(s+o+l)*i-h,d=(s-l)*i,u=s*i,g=this.position.x+t-u;this.position.offsetX=Math.min(Math.max(-c,g),-d),this.position.x=this.position.offsetX+u;const f=(n+r+l)*i-a,p=(n-l)*i,_=n*i,m=this.position.y+e-_;this.position.offsetY=Math.min(Math.max(-f,m),-p),this.position.y=this.position.offsetY+_}else this.position.x+=t,this.position.y+=e,this.position.offsetX=this.position.x-s*i,this.position.offsetY=this.position.y-n*i}calculateToRealWorld(t){const e=this.scale,i=this.position;return[t[0]*e+i.offsetX,t[1]*e+i.offsetY]}_calculatePointBack(t){const e=this.scale,i=this.position;return[(t[0]-i.offsetX)/e,(t[1]-i.offsetY)/e]}_calculateDistance(t){return this.scale*t}_resetTransform(){const{width:t,height:e}=this.canvasMeta,i=this.position,s=this.scale,n=this.ctx;n.setTransform(),n.clearRect(0,0,t,e),n.scale(this.dpr,this.dpr),n.transform(s,0,0,s,i.offsetX,i.offsetY)}_getViewBox(){const t=[...this._calculatePointBack([0,0]),...this._calculatePointBack([this.canvasMeta.actual_width,this.canvasMeta.actual_height])];return this._cacheViewBox=t,t}setNodeToTopLayer(t){const e=this._stack.findIndex((e=>e===t));if(-1!==e){const[t]=this._stack.splice(e,1);this._stack.push(t)}}getCacheViewBox(){return this._cacheViewBox}_render(){this.scheduleRender()}__render(){if(!this._readyToRender)return;this.runAnimeFrame(),this._resetTransform();const t=this.ctx,e=this._getViewBox();this._viewBox=e,this.NodeRenderTop?(this._linkStack.render(t,(t=>t.isInViewBox(e))),this._stack.render(t,(t=>{const i=F(e,t.getBoundingRect());return t._isInViewBox=i,i}))):(this._stack.render(t,(t=>{const i=F(e,t.getBoundingRect());return t._isInViewBox=i,i})),this._linkStack.render(t,(t=>t.isInViewBox(e)))),this._tempNode&&(t.save(),this._tempNode.render(t),t.restore()),this._tempLink&&(t.save(),this._tempLink.isInViewBox(e),this._tempLink.render(t),t.restore()),this.renderScrollBar(t)}}Object.assign(Tt.prototype,tt),Object.assign(Tt.prototype,K),Object.assign(Tt.prototype,Q),Object.assign(Tt.prototype,$),Object.assign(Tt.prototype,et),Object.assign(Tt.prototype,it),Object.assign(Tt.prototype,ot),Object.assign(Tt.prototype,nt);const Mt=Tt;window.renderErGraph=function(t,i){const s=new class{constructor(t){this.static=!1,this.flowStack=[],this.flowLinkStack=[],this.roots=[],this.reOrder(t)}reOrder(t){this.flowStack=[],this.flowLinkStack=[];const i=function(t){const i={};return t.map((t=>{const s=new e(t);return i[t.name]=s,s})),i}(t),s=Object.values(i);s.forEach((t=>{this.flowStack.push({type:t.type,source:t.source,layoutNode:t}),t.makeLink((t=>{const e=i[t.from],s=i[t.to];e&&s&&(e.linkOutArr.push(s),e.linkOut+=1,s.linkIn+=1,this.flowLinkStack.push({...t,from:e.source,to:s.source}))}))}));const n={};!function t(e,i=0){n[i]||(n[i]=[]);const s=i+1;e.forEach((e=>{const o=n[e.level].findIndex((t=>t===e));~o&&n[e.level].splice(o,1),e.level=Math.max(i,e.level),n[e.level].push(e),t(e.linkOutArr,s)}))}(s.filter((t=>0===t.linkIn))),this.levelMapping=n}reflow(t){this.flowLinkStack,this.flowStack;let e=0,i=0;Object.keys(this.levelMapping).forEach((s=>{const n=this.levelMapping[s];let o=0,r=0;n.forEach(((e,i)=>{const s=t.getRenderNodeBySource(e.source),{width:n,height:h}=s.getBoundingDimension();o=Math.max(n,o),i>0&&(r+=h/2),s.anchor[1]=r,r+=h/2+40})),r-=20;const h=r/2;e+=0===i?0:o/2,n.forEach((i=>{const s=t.getRenderNodeBySource(i.source);s.anchor[0]=e,s.anchor[1]-=h})),e+=o/2+150,i++}))}}(t);console.log(t);const n=new Mt({allowDrop:!1,layout:s,eventAdapter:ft});s.flowStack.forEach((({type:t,layoutNode:e,source:i})=>{const s=function(t){const e=new bt({content:t.id,textColor:"#2780E3"}),i=new kt({layout:new yt({direction:"vertical",gap:0}),borderRadius:8,borderColor:"#2780E3",borderWidth:2});if(t.source.module){const s=new bt({content:t.source.module.name,textColor:"#2780E3"}),n=new kt({padding:15,border:{right:{borderWidth:2,borderColor:"#2780E3"}}}),o=new kt({padding:15});n.addToStack(e),n.recalculate(),o.addToStack(s),o.recalculate();const r=new kt({layout:new yt({direction:"horizontal",gap:0})});r.addToStack(n),r.addToStack(o),r.recalculate(),i.addToStack(r);const h=new kt({padding:15}),a=new bt({content:t.source.configName,textColor:"#2780E3"});h.addToStack(a),h.recalculate(),r.width>h.width?r.setConfig({border:{bottom:{borderWidth:2,borderColor:"#2780E3"}}}):h.setConfig({border:{top:{borderWidth:2,borderColor:"#2780E3"}}}),i.addToStack(h),i.recalculate()}else i.addToStack(e),i.setConfig({padding:15,borderRadius:8,borderColor:"#2780E3",borderWidth:2}),i.recalculate();return i}(e);n.setLayoutNodeBySource(i,e),n.setRenderNodeBySource(i,s),n.addToStack(s)})),s.flowLinkStack.forEach((t=>{const e=function(t,e){return new vt({...t,from:e.getRenderNodeBySource(t.from),to:e.getRenderNodeBySource(t.to),content:t.part,backgroundColor:"#2780E3",fontSize:"16px"})}(t,n);n.addToLinkStack(e)}));const o=document.getElementById(i);o.style.width="100%",n.$mount(o)}})();