(()=>{"use strict";class i{constructor(t){this.type="ERNode",this.source=t,this.id=t.name,this.getJflowInstance=void 0,this.linkIn=0,this.linkOut=0,this.level=0,this.linkOutArr=[]}makeLink(t){const{extends:i,mixins:e,implements:n}=this.source;i&&t({from:i,to:this.id,part:"extends"}),e&&e.forEach((i=>{t({from:i,to:this.id,part:"mixins",lineDash:[5,2]})})),n&&t({from:n,to:this.id,part:"implements"})}}const e=document.createElement("canvas");e.width=1,e.height=1;const n=e.getContext("2d"),s=window.devicePixelRatio;function o(t){n.clearRect(0,0,5,5),n.save(),t(n),n.restore(),n.clearRect(0,0,5,5)}n.scale(s,s);const{abs:r,cos:h,sin:a,acos:c,atan2:l,sqrt:d,pow:u}=Math;function g(t){return t<0?-u(-t,1/3):u(t,1/3)}const p=Math.PI,f=2*p,m=p/2,b=Number.MAX_SAFE_INTEGER||9007199254740991,_=Number.MIN_SAFE_INTEGER||-9007199254740991,x={x:0,y:0,z:0},y={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,i){const e=i(t);let n=e.x*e.x+e.y*e.y;return void 0!==e.z&&(n+=e.z*e.z),d(n)},compute:function(t,i,e){if(0===t)return i[0].t=0,i[0];const n=i.length-1;if(1===t)return i[n].t=1,i[n];const s=1-t;let o=i;if(0===n)return i[0].t=t,i[0];if(1===n){const i={x:s*o[0].x+t*o[1].x,y:s*o[0].y+t*o[1].y,t};return e&&(i.z=s*o[0].z+t*o[1].z),i}if(n<4){let i,r,h,a=s*s,c=t*t,l=0;2===n?(o=[o[0],o[1],o[2],x],i=a,r=s*t*2,h=c):3===n&&(i=a*s,r=a*t*3,h=s*c*3,l=t*c);const d={x:i*o[0].x+r*o[1].x+h*o[2].x+l*o[3].x,y:i*o[0].y+r*o[1].y+h*o[2].y+l*o[3].y,t};return e&&(d.z=i*o[0].z+r*o[1].z+h*o[2].z+l*o[3].z),d}const r=JSON.parse(JSON.stringify(i));for(;r.length>1;){for(let i=0;i<r.length-1;i++)r[i]={x:r[i].x+(r[i+1].x-r[i].x)*t,y:r[i].y+(r[i+1].y-r[i].y)*t},void 0!==r[i].z&&(r[i]=r[i].z+(r[i+1].z-r[i].z)*t);r.splice(r.length-1,1)}return r[0].t=t,r[0]},computeWithRatios:function(t,i,e,n){const s=1-t,o=e,r=i;let h,a=o[0],c=o[1],l=o[2],d=o[3];return a*=s,c*=t,2===r.length?(h=a+c,{x:(a*r[0].x+c*r[1].x)/h,y:(a*r[0].y+c*r[1].y)/h,z:!!n&&(a*r[0].z+c*r[1].z)/h,t}):(a*=s,c*=2*s,l*=t*t,3===r.length?(h=a+c+l,{x:(a*r[0].x+c*r[1].x+l*r[2].x)/h,y:(a*r[0].y+c*r[1].y+l*r[2].y)/h,z:!!n&&(a*r[0].z+c*r[1].z+l*r[2].z)/h,t}):(a*=s,c*=1.5*s,l*=3*s,d*=t*t*t,4===r.length?(h=a+c+l+d,{x:(a*r[0].x+c*r[1].x+l*r[2].x+d*r[3].x)/h,y:(a*r[0].y+c*r[1].y+l*r[2].y+d*r[3].y)/h,z:!!n&&(a*r[0].z+c*r[1].z+l*r[2].z+d*r[3].z)/h,t}):void 0))},derive:function(t,i){const e=[];for(let n=t,s=n.length,o=s-1;s>1;s--,o--){const t=[];for(let e,s=0;s<o;s++)e={x:o*(n[s+1].x-n[s].x),y:o*(n[s+1].y-n[s].y)},i&&(e.z=o*(n[s+1].z-n[s].z)),t.push(e);e.push(t),n=t}return e},between:function(t,i,e){return i<=t&&t<=e||y.approximately(t,i)||y.approximately(t,e)},approximately:function(t,i,e){return r(t-i)<=(e||1e-6)},length:function(t){const i=y.Tvalues.length;let e=0;for(let n,s=0;s<i;s++)n=.5*y.Tvalues[s]+.5,e+=y.Cvalues[s]*y.arcfn(n,t);return.5*e},map:function(t,i,e,n,s){return n+(t-i)/(e-i)*(s-n)},lerp:function(t,i,e){const n={x:i.x+t*(e.x-i.x),y:i.y+t*(e.y-i.y)};return void 0!==i.z&&void 0!==e.z&&(n.z=i.z+t*(e.z-i.z)),n},pointToString:function(t){let i=t.x+"/"+t.y;return void 0!==t.z&&(i+="/"+t.z),i},pointsToString:function(t){return"["+t.map(y.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,i,e){const n=i.x-t.x,s=i.y-t.y,o=e.x-t.x,r=e.y-t.y;return l(n*r-s*o,n*o+s*r)},round:function(t,i){const e=""+t,n=e.indexOf(".");return parseFloat(e.substring(0,n+1+i))},dist:function(t,i){const e=t.x-i.x,n=t.y-i.y;return d(e*e+n*n)},closest:function(t,i){let e,n,s=u(2,63);return t.forEach((function(t,o){n=y.dist(i,t),n<s&&(s=n,e=o)})),{mdist:s,mpos:e}},abcratio:function(t,i){if(2!==i&&3!==i)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const e=u(t,i)+u(1-t,i);return r((e-1)/e)},projectionratio:function(t,i){if(2!==i&&3!==i)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const e=u(1-t,i);return e/(u(t,i)+e)},lli8:function(t,i,e,n,s,o,r,h){const a=(t-e)*(o-h)-(i-n)*(s-r);return 0!=a&&{x:((t*n-i*e)*(s-r)-(t-e)*(s*h-o*r))/a,y:((t*n-i*e)*(o-h)-(i-n)*(s*h-o*r))/a}},lli4:function(t,i,e,n){const s=t.x,o=t.y,r=i.x,h=i.y,a=e.x,c=e.y,l=n.x,d=n.y;return y.lli8(s,o,r,h,a,c,l,d)},lli:function(t,i){return y.lli4(t,t.c,i,i.c)},makeline:function(t,i){const e=t.x,n=t.y,s=i.x,o=i.y,r=(s-e)/3,h=(o-n)/3;return new M(e,n,e+r,n+h,e+2*r,n+2*h,s,o)},findbbox:function(t){let i=b,e=b,n=_,s=_;return t.forEach((function(t){const o=t.bbox();i>o.x.min&&(i=o.x.min),e>o.y.min&&(e=o.y.min),n<o.x.max&&(n=o.x.max),s<o.y.max&&(s=o.y.max)})),{x:{min:i,mid:(i+n)/2,max:n,size:n-i},y:{min:e,mid:(e+s)/2,max:s,size:s-e}}},shapeintersections:function(t,i,e,n,s){if(!y.bboxoverlap(i,n))return[];const o=[],r=[t.startcap,t.forward,t.back,t.endcap],h=[e.startcap,e.forward,e.back,e.endcap];return r.forEach((function(i){i.virtual||h.forEach((function(n){if(n.virtual)return;const r=i.intersects(n,s);r.length>0&&(r.c1=i,r.c2=n,r.s1=t,r.s2=e,o.push(r))}))})),o},makeshape:function(t,i,e){const n=i.points.length,s=t.points.length,o=y.makeline(i.points[n-1],t.points[0]),r=y.makeline(t.points[s-1],i.points[0]),h={startcap:o,forward:t,back:i,endcap:r,bbox:y.findbbox([o,t,i,r]),intersections:function(t){return y.shapeintersections(h,h.bbox,t,t.bbox,e)}};return h},getminmax:function(t,i,e){if(!e)return{min:0,max:0};let n,s,o=b,r=_;-1===e.indexOf(0)&&(e=[0].concat(e)),-1===e.indexOf(1)&&e.push(1);for(let h=0,a=e.length;h<a;h++)n=e[h],s=t.get(n),s[i]<o&&(o=s[i]),s[i]>r&&(r=s[i]);return{min:o,mid:(o+r)/2,max:r,size:r-o}},align:function(t,i){const e=i.p1.x,n=i.p1.y,s=-l(i.p2.y-n,i.p2.x-e);return t.map((function(t){return{x:(t.x-e)*h(s)-(t.y-n)*a(s),y:(t.x-e)*a(s)+(t.y-n)*h(s)}}))},roots:function(t,i){i=i||{p1:{x:0,y:0},p2:{x:1,y:0}};const e=t.length-1,n=y.align(t,i),s=function(t){return 0<=t&&t<=1};if(2===e){const t=n[0].y,i=n[1].y,e=n[2].y,o=t-2*i+e;if(0!==o){const n=-d(i*i-t*e),r=-t+i;return[-(n+r)/o,-(-n+r)/o].filter(s)}return i!==e&&0===o?[(2*i-e)/(2*i-2*e)].filter(s):[]}const o=n[0].y,r=n[1].y,a=n[2].y;let l=3*r-o-3*a+n[3].y,u=3*o-6*r+3*a,p=-3*o+3*r,m=o;if(y.approximately(l,0)){if(y.approximately(u,0))return y.approximately(p,0)?[]:[-m/p].filter(s);const t=d(p*p-4*u*m),i=2*u;return[(t-p)/i,(-p-t)/i].filter(s)}u/=l,p/=l,m/=l;const b=(3*p-u*u)/3,_=b/3,x=(2*u*u*u-9*u*p+27*m)/27,v=x/2,w=v*v+_*_*_;let k,T,E,S,z;if(w<0){const t=-b/3,i=d(t*t*t),e=-x/(2*i),n=c(e<-1?-1:e>1?1:e),o=2*g(i);return E=o*h(n/3)-u/3,S=o*h((n+f)/3)-u/3,z=o*h((n+2*f)/3)-u/3,[E,S,z].filter(s)}if(0===w)return k=v<0?g(-v):-g(v),E=2*k-u/3,S=-k-u/3,[E,S].filter(s);{const t=d(w);return k=g(-v+t),T=g(v+t),[k-T-u/3].filter(s)}},droots:function(t){if(3===t.length){const i=t[0],e=t[1],n=t[2],s=i-2*e+n;if(0!==s){const t=-d(e*e-i*n),o=-i+e;return[-(t+o)/s,-(-t+o)/s]}return e!==n&&0===s?[(2*e-n)/(2*(e-n))]:[]}if(2===t.length){const i=t[0],e=t[1];return i!==e?[i/(i-e)]:[]}return[]},curvature:function(t,i,e,n,s){let o,h,a,c,l=0,g=0;const p=y.compute(t,i),f=y.compute(t,e),m=p.x*p.x+p.y*p.y;if(n?(o=d(u(p.y*f.z-f.y*p.z,2)+u(p.z*f.x-f.z*p.x,2)+u(p.x*f.y-f.x*p.y,2)),h=u(m+p.z*p.z,1.5)):(o=p.x*f.y-p.y*f.x,h=u(m,1.5)),0===o||0===h)return{k:0,r:0};if(l=o/h,g=h/o,!s){const s=y.curvature(t-.001,i,e,n,!0).k,o=y.curvature(t+.001,i,e,n,!0).k;c=(o-l+(l-s))/2,a=(r(o-l)+r(l-s))/2}return{k:l,r:g,dk:c,adk:a}},inflections:function(t){if(t.length<4)return[];const i=y.align(t,{p1:t[0],p2:t.slice(-1)[0]}),e=i[2].x*i[1].y,n=i[3].x*i[1].y,s=i[1].x*i[2].y,o=18*(-3*e+2*n+3*s-i[3].x*i[2].y),r=18*(3*e-n-3*s),h=18*(s-e);if(y.approximately(o,0)){if(!y.approximately(r,0)){let t=-h/r;if(0<=t&&t<=1)return[t]}return[]}const a=r*r-4*o*h,c=Math.sqrt(a),l=2*o;return y.approximately(l,0)?[]:[(c-r)/l,-(r+c)/l].filter((function(t){return 0<=t&&t<=1}))},bboxoverlap:function(t,i){const e=["x","y"],n=e.length;for(let s,o,h,a,c=0;c<n;c++)if(s=e[c],o=t[s].mid,h=i[s].mid,a=(t[s].size+i[s].size)/2,r(o-h)>=a)return!1;return!0},expandbox:function(t,i){i.x.min<t.x.min&&(t.x.min=i.x.min),i.y.min<t.y.min&&(t.y.min=i.y.min),i.z&&i.z.min<t.z.min&&(t.z.min=i.z.min),i.x.max>t.x.max&&(t.x.max=i.x.max),i.y.max>t.y.max&&(t.y.max=i.y.max),i.z&&i.z.max>t.z.max&&(t.z.max=i.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,i,e){const n=t.bbox(),s=i.bbox(),o=1e5,r=e||.5;if(n.x.size+n.y.size<r&&s.x.size+s.y.size<r)return[(o*(t._t1+t._t2)/2|0)/o+"/"+(o*(i._t1+i._t2)/2|0)/o];let h=t.split(.5),a=i.split(.5),c=[{left:h.left,right:a.left},{left:h.left,right:a.right},{left:h.right,right:a.right},{left:h.right,right:a.left}];c=c.filter((function(t){return y.bboxoverlap(t.left.bbox(),t.right.bbox())}));let l=[];return 0===c.length||(c.forEach((function(t){l=l.concat(y.pairiteration(t.left,t.right,r))})),l=l.filter((function(t,i){return l.indexOf(t)===i}))),l},getccenter:function(t,i,e){const n=i.x-t.x,s=i.y-t.y,o=e.x-i.x,r=e.y-i.y,c=n*h(m)-s*a(m),d=n*a(m)+s*h(m),u=o*h(m)-r*a(m),g=o*a(m)+r*h(m),p=(t.x+i.x)/2,b=(t.y+i.y)/2,_=(i.x+e.x)/2,x=(i.y+e.y)/2,v=p+c,w=b+d,k=_+u,T=x+g,E=y.lli8(p,b,v,w,_,x,k,T),S=y.dist(E,t);let z,C=l(t.y-E.y,t.x-E.x),O=l(i.y-E.y,i.x-E.x),M=l(e.y-E.y,e.x-E.x);return C<M?((C>O||O>M)&&(C+=f),C>M&&(z=M,M=C,C=z)):M<O&&O<C?(z=M,M=C,C=z):M+=f,E.s=C,E.e=M,E.r=S,E},numberSort:function(t,i){return t-i}};class v{constructor(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map((function(t){return y.pointsToString(t.points)})).join(", ")+"]"}addCurve(t){this.curves.push(t),this._3d=this._3d||t._3d}length(){return this.curves.map((function(t){return t.length()})).reduce((function(t,i){return t+i}))}curve(t){return this.curves[t]}bbox(){const t=this.curves;for(var i=t[0].bbox(),e=1;e<t.length;e++)y.expandbox(i,t[e].bbox());return i}offset(t){const i=[];return this.curves.forEach((function(e){i.push(...e.offset(t))})),new v(i)}}const{abs:w,min:k,max:T,cos:E,sin:S,acos:z,sqrt:C}=Math,O=Math.PI;class M{constructor(t){let i=t&&t.forEach?t:Array.from(arguments).slice(),e=!1;if("object"==typeof i[0]){e=i.length;const t=[];i.forEach((function(i){["x","y","z"].forEach((function(e){void 0!==i[e]&&t.push(i[e])}))})),i=t}let n=!1;const s=i.length;if(e){if(e>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");n=!0}}else if(6!==s&&8!==s&&9!==s&&12!==s&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const o=this._3d=!n&&(9===s||12===s)||t&&t[0]&&void 0!==t[0].z,r=this.points=[];for(let t=0,e=o?3:2;t<s;t+=e){var h={x:i[t],y:i[t+1]};o&&(h.z=i[t+2]),r.push(h)}const a=this.order=r.length-1,c=this.dims=["x","y"];o&&c.push("z"),this.dimlen=c.length;const l=y.align(r,{p1:r[0],p2:r[a]});this._linear=!l.some((t=>w(t.y)>1e-4)),this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(t,i,e,n){if(void 0===n&&(n=.5),0===n)return new M(i,i,e);if(1===n)return new M(t,i,i);const s=M.getABC(2,t,i,e,n);return new M(t,s.A,e)}static cubicFromPoints(t,i,e,n,s){void 0===n&&(n=.5);const o=M.getABC(3,t,i,e,n);void 0===s&&(s=y.dist(i,o.C));const r=s*(1-n)/n,h=y.dist(t,e),a=(e.x-t.x)/h,c=(e.y-t.y)/h,l=s*a,d=s*c,u=r*a,g=r*c,p=i.x-l,f=i.y-d,m=i.x+u,b=i.y+g,_=o.A,x=_.x+(p-_.x)/(1-n),v=_.y+(f-_.y)/(1-n),w=_.x+(m-_.x)/n,k=_.y+(b-_.y)/n,T={x:t.x+(x-t.x)/n,y:t.y+(v-t.y)/n},E={x:e.x+(w-e.x)/(1-n),y:e.y+(k-e.y)/(1-n)};return new M(t,T,E,e)}static getUtils(){return y}getUtils(){return M.getUtils()}static get PolyBezier(){return v}valueOf(){return this.toString()}toString(){return y.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const t=this.points,i=["M",t[0].x,t[0].y,2===this.order?"Q":"C"];for(let e=1,n=t.length;e<n;e++)i.push(t[e].x),i.push(t[e].y);return i.join(" ")}setRatios(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}verify(){const t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}coordDigest(){return this.points.map((function(t,i){return""+i+t.x+t.y+(t.z?t.z:0)})).join("")}update(){this._lut=[],this.dpoints=y.derive(this.points,this._3d),this.computedirection()}computedirection(){const t=this.points,i=y.angle(t[0],t[this.order],t[1]);this.clockwise=i>0}length(){return y.length(this.derivative.bind(this))}static getABC(t=2,i,e,n,s=.5){const o=y.projectionratio(s,t),r=1-o,h={x:o*i.x+r*n.x,y:o*i.y+r*n.y},a=y.abcratio(s,t);return{A:{x:e.x+(e.x-h.x)/a,y:e.y+(e.y-h.y)/a},B:e,C:h,S:i,E:n}}getABC(t,i){i=i||this.get(t);let e=this.points[0],n=this.points[this.order];return M.getABC(this.order,e,i,n,t)}getLUT(t){if(this.verify(),t=t||100,this._lut.length===t)return this._lut;this._lut=[],t--;for(let i,e,n=0;n<t;n++)e=n/(t-1),i=this.compute(e),i.t=e,this._lut.push(i);return this._lut}on(i,e){e=e||5;const n=this.getLUT(),s=[];for(let t,o=0,r=0;o<n.length;o++)t=n[o],y.dist(t,i)<e&&(s.push(t),r+=o/n.length);return!!s.length&&(t/=s.length)}project(t){const i=this.getLUT(),e=i.length-1,n=y.closest(i,t),s=n.mpos,o=(s-1)/e,r=(s+1)/e,h=.1/e;let a,c,l=n.mdist,d=o,u=d;for(l+=1;d<r+h;d+=h)a=this.compute(d),c=y.dist(t,a),c<l&&(l=c,u=d);return u=u<0?0:u>1?1:u,a=this.compute(u),a.t=u,a.d=l,a}get(t){return this.compute(t)}point(t){return this.points[t]}compute(t){return this.ratios?y.computeWithRatios(t,this.points,this.ratios,this._3d):y.compute(t,this.points,this._3d,this.ratios)}raise(){const t=this.points,i=[t[0]],e=t.length;for(let n,s,o=1;o<e;o++)n=t[o],s=t[o-1],i[o]={x:(e-o)/e*n.x+o/e*s.x,y:(e-o)/e*n.y+o/e*s.y};return i[e]=t[e-1],new M(i)}derivative(t){return y.compute(t,this.dpoints[0],this._3d)}dderivative(t){return y.compute(t,this.dpoints[1],this._3d)}align(){let t=this.points;return new M(y.align(t,{p1:t[0],p2:t[t.length-1]}))}curvature(t){return y.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return y.inflections(this.points)}normal(t){return this._3d?this.__normal3(t):this.__normal2(t)}__normal2(t){const i=this.derivative(t),e=C(i.x*i.x+i.y*i.y);return{x:-i.y/e,y:i.x/e}}__normal3(t){const i=this.derivative(t),e=this.derivative(t+.01),n=C(i.x*i.x+i.y*i.y+i.z*i.z),s=C(e.x*e.x+e.y*e.y+e.z*e.z);i.x/=n,i.y/=n,i.z/=n,e.x/=s,e.y/=s,e.z/=s;const o={x:e.y*i.z-e.z*i.y,y:e.z*i.x-e.x*i.z,z:e.x*i.y-e.y*i.x},r=C(o.x*o.x+o.y*o.y+o.z*o.z);o.x/=r,o.y/=r,o.z/=r;const h=[o.x*o.x,o.x*o.y-o.z,o.x*o.z+o.y,o.x*o.y+o.z,o.y*o.y,o.y*o.z-o.x,o.x*o.z-o.y,o.y*o.z+o.x,o.z*o.z];return{x:h[0]*i.x+h[1]*i.y+h[2]*i.z,y:h[3]*i.x+h[4]*i.y+h[5]*i.z,z:h[6]*i.x+h[7]*i.y+h[8]*i.z}}hull(t){let i=this.points,e=[],n=[],s=0;for(n[s++]=i[0],n[s++]=i[1],n[s++]=i[2],3===this.order&&(n[s++]=i[3]);i.length>1;){e=[];for(let o,r=0,h=i.length-1;r<h;r++)o=y.lerp(t,i[r],i[r+1]),n[s++]=o,e.push(o);i=e}return n}split(t,i){if(0===t&&i)return this.split(i).left;if(1===i)return this.split(t).right;const e=this.hull(t),n={left:2===this.order?new M([e[0],e[3],e[5]]):new M([e[0],e[4],e[7],e[9]]),right:2===this.order?new M([e[5],e[4],e[2]]):new M([e[9],e[8],e[6],e[3]]),span:e};return n.left._t1=y.map(0,0,1,this._t1,this._t2),n.left._t2=y.map(t,0,1,this._t1,this._t2),n.right._t1=y.map(t,0,1,this._t1,this._t2),n.right._t2=y.map(1,0,1,this._t1,this._t2),i?(i=y.map(i,t,1,0,1),n.right.split(i).left):n}extrema(){const t={};let i=[];return this.dims.forEach(function(e){let n=function(t){return t[e]},s=this.dpoints[0].map(n);t[e]=y.droots(s),3===this.order&&(s=this.dpoints[1].map(n),t[e]=t[e].concat(y.droots(s))),t[e]=t[e].filter((function(t){return t>=0&&t<=1})),i=i.concat(t[e].sort(y.numberSort))}.bind(this)),t.values=i.sort(y.numberSort).filter((function(t,e){return i.indexOf(t)===e})),t}bbox(){const t=this.extrema(),i={};return this.dims.forEach(function(e){i[e]=y.getminmax(this,e,t[e])}.bind(this)),i}overlaps(t){const i=this.bbox(),e=t.bbox();return y.bboxoverlap(i,e)}offset(t,i){if(void 0!==i){const e=this.get(t),n=this.normal(t),s={c:e,n,x:e.x+n.x*i,y:e.y+n.y*i};return this._3d&&(s.z=e.z+n.z*i),s}if(this._linear){const i=this.normal(0),e=this.points.map((function(e){const n={x:e.x+t*i.x,y:e.y+t*i.y};return e.z&&i.z&&(n.z=e.z+t*i.z),n}));return[new M(e)]}return this.reduce().map((function(i){return i._linear?i.offset(t)[0]:i.scale(t)}))}simple(){if(3===this.order){const t=y.angle(this.points[0],this.points[3],this.points[1]),i=y.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&i<0||t<0&&i>0)return!1}const t=this.normal(0),i=this.normal(1);let e=t.x*i.x+t.y*i.y;return this._3d&&(e+=t.z*i.z),w(z(e))<O/3}reduce(){let t,i,e=0,n=0,s=.01,o=[],r=[],h=this.extrema().values;for(-1===h.indexOf(0)&&(h=[0].concat(h)),-1===h.indexOf(1)&&h.push(1),e=h[0],t=1;t<h.length;t++)n=h[t],i=this.split(e,n),i._t1=e,i._t2=n,o.push(i),e=n;return o.forEach((function(t){for(e=0,n=0;n<=1;)for(n=e+s;n<=1.01;n+=s)if(i=t.split(e,n),!i.simple()){if(n-=s,w(e-n)<s)return[];i=t.split(e,n),i._t1=y.map(e,0,1,t._t1,t._t2),i._t2=y.map(n,0,1,t._t1,t._t2),r.push(i),e=n;break}e<1&&(i=t.split(e,1),i._t1=y.map(e,0,1,t._t1,t._t2),i._t2=t._t2,r.push(i))})),r}scale(t){const i=this.order;let e=!1;if("function"==typeof t&&(e=t),e&&2===i)return this.raise().scale(e);const n=this.clockwise,s=e?e(0):t,o=e?e(1):t,r=[this.offset(0,10),this.offset(1,10)],h=this.points,a=[],c=y.lli4(r[0],r[0].c,r[1],r[1].c);if(!c)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach((function(t){const e=a[t*i]=y.copy(h[t*i]);e.x+=(t?o:s)*r[t].n.x,e.y+=(t?o:s)*r[t].n.y})),e?([0,1].forEach((function(s){if(2!==i||!s){var o=h[s+1],r={x:o.x-c.x,y:o.y-c.y},l=e?e((s+1)/i):t;e&&!n&&(l=-l);var d=C(r.x*r.x+r.y*r.y);r.x/=d,r.y/=d,a[s+1]={x:o.x+l*r.x,y:o.y+l*r.y}}})),new M(a)):([0,1].forEach((t=>{if(2===i&&t)return;const e=a[t*i],n=this.derivative(t),s={x:e.x+n.x,y:e.y+n.y};a[t+1]=y.lli4(e,s,c,h[t+1])})),new M(a))}outline(t,i,e,n){i=void 0===i?t:i;const s=this.reduce(),o=s.length,r=[];let h,a=[],c=0,l=this.length();const d=void 0!==e&&void 0!==n;function u(t,i,e,n,s){return function(o){const r=n/e,h=(n+s)/e,a=i-t;return y.map(o,0,1,t+r*a,t+h*a)}}s.forEach((function(s){const o=s.length();d?(r.push(s.scale(u(t,e,l,c,o))),a.push(s.scale(u(-i,-n,l,c,o)))):(r.push(s.scale(t)),a.push(s.scale(-i))),c+=o})),a=a.map((function(t){return h=t.points,h[3]?t.points=[h[3],h[2],h[1],h[0]]:t.points=[h[2],h[1],h[0]],t})).reverse();const g=r[0].points[0],p=r[o-1].points[r[o-1].points.length-1],f=a[o-1].points[a[o-1].points.length-1],m=a[0].points[0],b=y.makeline(f,g),_=y.makeline(p,m),x=[b].concat(r).concat([_]).concat(a);return x.length,new v(x)}outlineshapes(t,i,e){i=i||t;const n=this.outline(t,i).curves,s=[];for(let t=1,i=n.length;t<i/2;t++){const o=y.makeshape(n[t],n[i-t],e);o.startcap.virtual=t>1,o.endcap.virtual=t<i/2-1,s.push(o)}return s}intersects(t,i){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof M&&(t=t.reduce()),this.curveintersects(this.reduce(),t,i)):this.selfintersects(i)}lineIntersects(t){const i=k(t.p1.x,t.p2.x),e=k(t.p1.y,t.p2.y),n=T(t.p1.x,t.p2.x),s=T(t.p1.y,t.p2.y);return y.roots(this.points,t).filter((t=>{var o=this.get(t);return y.between(o.x,i,n)&&y.between(o.y,e,s)}))}selfintersects(t){const i=this.reduce(),e=i.length-2,n=[];for(let s,o,r,h=0;h<e;h++)o=i.slice(h,h+1),r=i.slice(h+2),s=this.curveintersects(o,r,t),n.push(...s);return n}curveintersects(t,i,e){const n=[];t.forEach((function(t){i.forEach((function(i){t.overlaps(i)&&n.push({left:t,right:i})}))}));let s=[];return n.forEach((function(t){const i=y.pairiteration(t.left,t.right,e);i.length>0&&(s=s.concat(i))})),s}arcs(t){return t=t||.5,this._iterate(t,[])}_error(t,i,e,n){const s=(n-e)/4,o=this.get(e+s),r=this.get(n-s),h=y.dist(t,i),a=y.dist(t,o),c=y.dist(t,r);return w(a-h)+w(c-h)}_iterate(t,i){let e,n=0,s=1;do{e=0,s=1;let o,r,h,a,c,l=this.get(n),d=!1,u=!1,g=s,p=1,f=0;do{if(u=d,a=h,g=(n+s)/2,f++,o=this.get(g),r=this.get(s),h=y.getccenter(l,o,r),h.interval={start:n,end:s},d=this._error(h,l,n,s)<=t,c=u&&!d,c||(p=s),d){if(s>=1){if(h.interval.end=p=1,a=h,s>1){let t={x:h.x+h.r*E(h.e),y:h.y+h.r*S(h.e)};h.e+=y.angle({x:h.x,y:h.y},t,this.get(1))}break}s+=(s-n)/2}else s=g}while(!c&&e++<100);if(e>=100)break;a=a||h,i.push(a),n=p}while(s<1);return i}}const P={RIGHT:0,BOTTOM:1,LEFT:2,TOP:3,SELF:100};function D(t){let i=1/0,e=1/0,n=-1/0,s=-1/0;for(let o in t){const r=t[o];r[0]<i&&(i=r[0]),r[0]>n&&(n=r[0]),r[1]<e&&(e=r[1]),r[1]>s&&(s=r[1])}return{width:Math.max(n-i,10),height:Math.max(s-e,10),x:i,y:e}}function B(t){return t*t}function j(t,i){return B(t[0]-i[0])+B(t[1]-i[1])}function H(t,i,e,n){return i===P.TOP?[t[0],t[1]-n]:i===P.BOTTOM?[t[0],t[1]+n]:i===P.LEFT?[t[0]-e,t[1]]:i===P.RIGHT?[t[0]+e,t[1]]:void 0}function I(t,i,e=P.TOP,n=P.TOP,s=0,o=0){const r=Math.max(Math.abs((t[0]-i[0])/2),s),h=Math.max(Math.abs((t[1]-i[1])/2),o),a=H(t,e,r,h),c=H(i,n,r,h),l=[P.TOP,P.LEFT].includes(n)?-5:5,d=[P.TOP,P.BOTTOM].includes(n);return[...a,...c,d?i[0]:i[0]+l,d?i[1]+l:i[1]]}function R(t,i,e,n,s,o,r,h,a){var c=Math.pow(1-t,2)*(n-i)+2*t*(1-t)*(o-n)+t*t*(h-o),l=Math.pow(1-t,2)*(s-e)+2*t*(1-t)*(r-s)+t*t*(a-r);return-Math.atan2(c,l)+.5*Math.PI}const W=class extends Array{constructor(){super(),this._currentHit=null}render(t){let i;this.forEach((e=>{e._isMoving?i=e:e.visible&&(t.save(),e.render(t),t.restore())})),i&&(t.save(),i.render(t),t.restore())}checkHit(t,i){let e=this.length-1;for(;e>=0;){const n=this[e];if(n.visible&&!n.ignoreHit){if(i&&i(n)){e--;continue}const s=n.isHit(t,i);if(n._isHit=!!s,s)return this._currentHit!==n&&(this._currentHit&&(this._currentHit._isHit=!1),this._currentHit=n),"boolean"!=typeof s?s:n}e--}return this._currentHit=null,null}getBoundingRectPoints(){const t=[];return this.forEach((i=>{i.visible&&!i.absolutePosition&&t.splice(t.length,0,...i.getBoundingRect())})),t}getAnchorRectPoints(){const t=[];return this.forEach((i=>{i.visible&&!i.absolutePosition&&t.push(i.anchor)})),t}},L={instances:[],links:[],_stack:null,_linkStack:null,initStack({data:t}){this._stack=new W,this._linkStack=new W,t&&(this.instances=t.instances,this.links=t.links,this.instances.forEach((t=>{this._stack.push(t),t._belongs=this})),this.links.forEach((t=>{this._linkStack.push(t),t._belongs=this})))},addToStack(t){t._belongs=this,this._stack.push(t)},replaceFromStack(t,i){const e=this._stack.findIndex((i=>i===t));this._stack.splice(e,1,i),t._belongs=null,i._belongs=this},addToLinkStack(t){t._belongs=this,this._linkStack.push(t)},removeFromStack(t){const i=this._stack.findIndex((i=>i===t));this._stack.splice(i,1)},removeFromLinkStack(t){const i=this._linkStack.findIndex((i=>i===t));this._linkStack.splice(i,1)},emptyLink(){this._linkStack=new W},resetChildrenPosition(){this._stack.forEach((t=>{t.anchor=[0,0]}))},addInstanceToLink(t,i){this.addToStack(i);const{from:e,to:n}=t,s=this._linkStack.findIndex((i=>i===t)),o=t.__proto__.constructor,r=new o({from:e,to:i});r._belongs=this;const h=new o({from:i,to:n});h._belongs=this,this._linkStack.splice(s,1,r,h)},interateNodeStack(t){this._stack.forEach((i=>{t(i)}))}},A={_layout:null,initLayout(t){this._layout=t.layout},recalculateUp(){let t=!0;if(this.getBoundingDimension){const{width:i,height:e}=this.getBoundingDimension();this.resetChildrenPosition&&this.resetChildrenPosition(),this._getBoundingGroupRect&&this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect();const{width:n,height:s}=this.getBoundingDimension();t=i!==n||e!==s}else this.reflow();this._belongs&&t&&this._belongs.recalculateUp()},recalculate(){this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect()},staticCheck(t){return!!this._layout&&this._layout.staticCheck(t,this)},reflow(){this._layout&&this._layout.reflow(this)}},F={_message:null,sendMessage(t){this._message=t},consumeMessage(){const t=this._message;return this._message=null,t},readMessage(){return this._message}};class G extends CustomEvent{constructor(t,i={}){super(t,{detail:{...i,originEvent:i.event,target:i.target,jflow:i.jflow,bubbles:i.bubbles||!1}})}}const Y=G,X={canvas:{wheel(t,i){t.preventDefault();let{offsetX:e,offsetY:n,deltaX:s,deltaY:o}=t;t.ctrlKey&&(o=-o),i.zoomHandler(e,n,s,o,t)}}},N=Symbol("ishit");class q extends EventTarget{constructor(t={}){super(),Object.assign(this,t),this.visible=!0,this._belongs=void 0,this[N]=!1,this._layoutNode=void 0,this.borderWidth=t.borderWidth||0,this.borderColor=t.borderColor||"transparent",this.backgroundColor=t.backgroundColor||"transparent",this.shadowColor=t.shadowColor,this.shadowBlur=t.shadowBlur||5,this.shadowOffsetX=t.shadowOffsetX||0,this.shadowOffsetY=t.shadowOffsetY||0}get _isTargeting(){return this===(this._jflow._target.instance||this._jflow._target.link)}get _isMoving(){return this===this._jflow._getMovingTarget()}get _isHit(){return this[N]}get _jflow(){return"jflow"===this._belongs.uniqueName?this._belongs:this._belongs._jflow}set _isHit(t){this[N]!==t&&this.dispatchEvent(new CustomEvent(t?"mouseenter":"mouseleave",{detail:{instance:this}})),this[N]=t}setConfig(t){Object.keys(t).forEach((i=>{void 0!==t[i]&&null!==t[i]&&(this[i]=t[i])}))}render(t){throw"require render implement"}isHit(t){throw"require isHit implement"}getBoundingRect(){throw"require getBoundingRect implement"}calculateIntersection(){throw"require calculateIntersection implement"}getIntersectionsInFourDimension(){throw"require getIntersectionsInFourDimension implement"}getCenter(){return this.anchor}getBoundingDimension(){const t=instance.getBoundingRect();let i=1/0,e=-1/0,n=1/0,s=-1/0;return t.forEach((t=>{e=Math.max(e,t[1]),i=Math.min(i,t[1]),s=Math.max(s,t[0]),n=Math.min(n,t[0])})),{height:e-i,width:s-n}}bubbleEvent(t){this.dispatchEvent(t),t.detail.bubbles&&(this._belongs.bubbleEvent?this._belongs.bubbleEvent(t):this._belongs.dispatchEvent(t))}calculateToRealWorld(t){return this._belongs&&this._belongs.calculateToRealWorld?this._belongs.calculateToRealWorld(t):t}calculateToRealWorldWithScalar(t){return this._jflow.scale*t}removeFromLayoutSource(){this._layoutNode&&this._layoutNode.remove()}recalculateUp(){this.belongs&&this.belongs.recalculateUp()}}const U=q,Z=class extends U{constructor(t={}){super(t),this._rawConfigs=t,this.anchor=t.anchor||[0,0],this.absolutePosition=t.absolutePosition}setConfig(t){Object.keys(t).forEach((i=>{void 0!==t[i]&&null!==t[i]&&(this[i]=t[i],this._rawConfigs[i]=t[i])}))}clone(){return new(0,this.constructor)(this._rawConfigs)}},J=class extends U{constructor(t={}){super(),this.from=t.from,this.to=t.to,this.fromDir=t.fromDir,this.toDir=t.toDir,this.key=t.key,this._cachePoints=null,this.backgroundColor=t.backgroundColor||"#000"}},$=class extends Z{constructor(t={}){super(t),this.type="Rectangle",this.width=t.width||10,this.height=t.height||10,this.borderRadius=t.borderRadius||0,this._setBorder(t)}_setBorder(t){this.border={top:{color:t.border?.top?.borderColor||t.borderColor||"transparent",width:t.border?.top?.borderWidth||t.borderWidth||0,enable:t.border?.top?.borderWidth},right:{color:t.border?.right?.borderColor||t.borderColor||"transparent",width:t.border?.right?.borderWidth||t.borderWidth||0,enable:t.border?.right?.borderWidth},bottom:{color:t.border?.bottom?.borderColor||t.borderColor||"transparent",width:t.border?.bottom?.borderWidth||t.borderWidth||0,enable:t.border?.bottom?.borderWidth},left:{color:t.border?.left?.borderColor||t.borderColor||"transparent",width:t.border?.left?.borderWidth||t.borderWidth||0,enable:t.border?.left?.borderWidth}},this.borderColor=t.borderColor||"transparent",this.borderWidth=t.borderWidth||0}setConfig(t){Object.keys(t).forEach((i=>{void 0!==t[i]&&null!==t[i]&&(this[i]=t[i],this._rawConfigs[i]=t[i])})),this._setBorder(t)}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6);const{borderRadius:i,anchor:e,width:n,height:s}=this,o=this.anchor[0]-this.width/2,r=this.anchor[1]-this.height/2,h=this.anchor[0]+this.width/2,a=this.anchor[1]+this.height/2;this.borderRadius?(t.beginPath(),t.moveTo(o+i,r),t.lineTo(o+n-i,r),t.quadraticCurveTo(o+n,r,o+n,r+i),t.lineTo(o+n,r+s-i),t.quadraticCurveTo(o+n,r+s,o+n-i,r+s),t.lineTo(o+i,r+s),t.quadraticCurveTo(o,r+s,o,r+s-i),t.lineTo(o,r+i),t.quadraticCurveTo(o,r,o+i,r),t.closePath(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke())):(t.beginPath(),t.rect(this.anchor[0]-this.width/2,this.anchor[1]-this.height/2,this.width,this.height)),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderRadius?this.border.top.enable&&(t.save(),t.beginPath(),t.moveTo(o,r+i),t.quadraticCurveTo(o,r,o+i,r),t.lineTo(o+n-i,r),t.quadraticCurveTo(o+n,r,o+n,r+i),t.closePath(),t.clip(),t.beginPath(),t.rect(o,r,this.width,this.border.top.width),t.fillStyle=this.border.top.color,t.fill(),t.restore()):(this.border.top.width&&(t.beginPath(),t.moveTo(o,r),t.lineTo(h,r),t.strokeStyle=this.border.top.color,t.lineWidth=this.border.top.width,t.stroke()),this.border.right.width&&(t.beginPath(),t.moveTo(h,r),t.lineTo(h,a),t.strokeStyle=this.border.right.color,t.lineWidth=this.border.right.width,t.stroke()),this.border.bottom.width&&(t.beginPath(),t.moveTo(h,a),t.lineTo(o,a),t.strokeStyle=this.border.bottom.color,t.lineWidth=this.border.bottom.width,t.stroke()),this.border.left.width&&(t.beginPath(),t.moveTo(o,a),t.lineTo(o,r),t.strokeStyle=this.border.left.color,t.lineWidth=this.border.left.width,t.stroke())),t.restore()}isHit(t){const i=this.anchor,e=this.width/2,n=this.height/2;return t[0]>i[0]-e&&t[0]<i[0]+e&&t[1]>i[1]-n&&t[1]<i[1]+n}getBoundingRect(){const t=this.anchor,i=this.width/2,e=this.height/2,n=t[0]-i,s=t[1]-e,o=t[0]+i,r=t[1]+e;return[[n,s],[o,s],[o,r],[n,r]]}getBoundingDimension(){return{height:this.height,width:this.width}}calculateIntersection(t){const[i,e]=t,[n,s]=this.anchor,o=this.width/2,r=this.height/2,h=n-i,a=s-e,c=r/o,l=Math.abs(a/h),d=i>n,u=e>s;let g,p;return l<c?(g=n+(d?o:-o),p=o*(u?l:-l)+s):(p=s+(u?r:-r),g=r/(d?l:-l)+n),[g,p]}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[i,e]=t,n=this.width/2,s=this.height/2;return{[P.RIGHT]:[i+n,e],[P.LEFT]:[i-n,e],[P.BOTTOM]:[i,e+s],[P.TOP]:[i,e-s]}}calculateIntersectionInFourDimension(t,i){const[e,n]=t;let s=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(s=this._belongs.calculateToCoordination(s));const[o,r]=s,h=this.width/2,a=this.height/2,c={[P.RIGHT]:[o+h,r],[P.LEFT]:[o-h,r],[P.BOTTOM]:[o,r+a],[P.TOP]:[o,r-a]},l=o-e,d=r-n,u=a/h,g=e>o;let p=Math.abs(d/l)>u?n>r?P.BOTTOM:P.TOP:g?P.RIGHT:P.LEFT;return{p:c[p],dir:p}}},V={...L,...A,initGroup(t){this.initStack(t),this.initLayout(t),this.padding={top:t.paddingTop||t.padding||0,right:t.paddingRight||t.padding||0,bottom:t.paddingBottom||t.padding||0,left:t.paddingLeft||t.padding||0},this.definedWidth=t.width,this.minWidth=t.minWidth,this.definedHeight=t.height,this.lock=t.lock??!0,this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect()},setConfig(t){Object.keys(t).forEach((i=>{void 0!==t[i]&&null!==t[i]&&(this[i]=t[i],this._rawConfigs[i]=t[i])})),this.padding={top:t.paddingTop||t.padding||0,right:t.paddingRight||t.padding||0,bottom:t.paddingBottom||t.padding||0,left:t.paddingLeft||t.padding||0}},_getBoundingGroupRect(){const t=D(this._stack.getBoundingRectPoints()),i=this.padding,e=this.minWidth-i.left-i.right,n=this.definedWidth-i.left-i.right,s=t.width+i.left+i.right,o=t.height+i.top+i.bottom;this.width=e?Math.max(e,s):n||s,this.height=this.definedHeight||o},renderGroup(t,i){t.save(),this._isMoving&&(t.globalAlpha=.6);const e=this.anchor;t.save(),i(t),t.restore();const n=this.padding,s=(n.left-n.right)/2,o=(n.top-n.bottom)/2;t.translate(e[0]+s,e[1]+o),this._stack.render(t),this._linkStack.render(t),t.translate(-e[0]-s,-e[1]-o),t.restore()},_calculatePointBack(t){const[i,e]=t,n=this.padding,s=(n.left-n.right)/2,o=(n.top-n.bottom)/2,r=this.anchor;return[i-r[0]-s,e-r[1]-o]},isHitGroup(t,i){const e=this._calculatePointBack(t);this._currentp=e;return this._stack.checkHit(e,i)||!1},calculateToCoordination(t){const[i,e]=t,n=this.padding,s=(n.left-n.right)/2,o=(n.top-n.bottom)/2,r=this.anchor,h=[i+r[0]+s,e+r[1]+o];return this._belongs&&this._belongs.calculateToCoordination?this._belongs.calculateToCoordination(h):h},calculateToRealWorld(t){const[i,e]=t,n=this.padding,s=(n.left-n.right)/2,o=(n.top-n.bottom)/2,r=this.anchor,h=[i+r[0]+s,e+r[1]+o];if(this._belongs&&this._belongs.calculateToRealWorld)return this._belongs.calculateToRealWorld(h)},clone(){const t=new(0,this.constructor)(Object.assign({},this._rawConfigs,{layout:this._layout&&this._layout.clone()}));return this.interateNodeStack((i=>{t.addToStack(i.clone())})),t.recalculate(),t}};class K extends ${constructor(t){super(t),this.initGroup(t)}render(t){this.renderGroup(t,(()=>{$.prototype.render.call(this,t)}))}isHit(t,i){return this.isHitGroup(t,i)||$.prototype.isHit.call(this,t)}}Object.assign(K.prototype,V),Object.assign(K.prototype,{setConfig(t){Object.keys(t).forEach((i=>{void 0!==t[i]&&null!==t[i]&&(this[i]=t[i],this._rawConfigs[i]=t[i])})),this.padding={top:t.paddingTop||t.padding||0,right:t.paddingRight||t.padding||0,bottom:t.paddingBottom||t.padding||0,left:t.paddingLeft||t.padding||0},this._setBorder(t)}});const Q=K,tt=class extends Z{constructor(t={}){super(t),this.type="Capsule",this.width=t.width||20,this.height=t.height||10}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const[i,e]=this.anchor,n=this.width/2,s=this.height/2,o=i-n+s,r=i+n-s,h=e-s,a=e+s;t.moveTo(o,h),t.lineTo(r,h),t.arc(r,e,s,-Math.PI/2,Math.PI/2),t.lineTo(o,a),t.arc(o,e,s,Math.PI/2,Math.PI/2*3),t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}isHit(t){const i=this.anchor,e=this.width/2,n=this.height/2,s=Math.abs(e-n),o=i[0]-e+n,r=i[0]+e-n,h=n*n;return t[0]>i[0]-s&&t[0]<i[0]+s&&t[1]>i[1]-n&&t[1]<i[1]+n||Math.pow(t[0]-o,2)+Math.pow(t[1]-i[1],2)<h||Math.pow(t[0]-r,2)+Math.pow(t[1]-i[1],2)<h}getBoundingRect(){const t=this.anchor,i=this.width/2,e=this.height/2,n=t[0]-i,s=t[1]-e,o=t[0]+i,r=t[1]+e;return[[n,s],[o,s],[o,r],[n,r]]}getBoundingDimension(){return{height:this.height,width:this.width}}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[i,e]=t,n=this.width/2,s=this.height/2;return{[P.RIGHT]:[i+n,e],[P.LEFT]:[i-n,e],[P.BOTTOM]:[i,e+s],[P.TOP]:[i,e-s]}}};Object.assign(class extends tt{constructor(t){super(t),this.initGroup(t)}render(t){this.renderGroup(t,(()=>{tt.prototype.render.call(this,t)}))}isHit(t,i){return this.isHitGroup(t,i)||tt.prototype.isHit.call(this,t)}}.prototype,V);Object.assign(class extends tt{constructor(t){super(t),this.initGroup(t)}render(t){this.renderGroup(t,(()=>{t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const[i,e]=this.anchor,n=this.width/2,s=this.height/2,o=e-s+n,r=e+s-n,h=i-n,a=i+n;t.moveTo(h,o),t.arc(i,o,n,-Math.PI,0),t.lineTo(a,r),t.arc(i,r,n,0,Math.PI),t.closePath(),t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}))}isHit(t,i){const e=this.isHitGroup(t,i);if(e)return e;const[n,s]=this.anchor,o=this.width/2,r=this.height/2,h=Math.abs(r-o),a=s-r+o,c=s+r-o,l=o*o;return t[0]>n-o&&t[0]<n+o&&t[1]>s-h&&t[1]<s+h||Math.pow(t[0]-n,2)+Math.pow(t[1]-a,2)<l||Math.pow(t[0]-n,2)+Math.pow(t[1]-c,2)<l}}.prototype,V);const it=class extends Z{constructor(t={}){super(t),this.type="Diamond",this.width=t.width||20,this.height=t.height||10,this.side=t.side||6,this._cacheSide()}setConfig(t){Object.keys(t).forEach((i=>{void 0!==t[i]&&null!==t[i]&&(this[i]=t[i],this._rawConfigs[i]=t[i])})),this._cacheSide()}_cacheSide(){this.sinSIDE=Math.sin(Math.PI/3)*this.side,this.cosSIDE=Math.cos(Math.PI/3)*this.side}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const[i,e]=this.anchor,n=this.width/2,s=this.height/2,o=s/1.732,r=i-n+o,h=i+n-o,a=i+n,c=i-n,l=e-s,d=e+s,{side:u,sinSIDE:g,cosSIDE:p}=this;t.moveTo(i,l),t.lineTo(h-u,l),t.quadraticCurveTo(h,l,h+p,l+g),t.lineTo(a-p,e-g),t.quadraticCurveTo(a,e,a-p,e+g),t.lineTo(h+p,d-g),t.quadraticCurveTo(h,d,h-u,d),t.lineTo(r+u,d),t.quadraticCurveTo(r,d,r-p,d-g),t.lineTo(c+p,e+g),t.quadraticCurveTo(c,e,c+p,e-g),t.lineTo(r-p,l+g),t.quadraticCurveTo(r,l,r+u,l),t.closePath(),t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore(),this._cachePoints=[[h,l],[a,e],[h,d],[r,d],[c,e],[r,l]]}isHit(t){const i=this._cachePoints;let e=!1;for(let n=0,s=i.length-1;n<i.length;n++)i[n][1]>t[1]!=i[s][1]>t[1]&&t[0]<(i[s][0]-i[n][0])*(t[1]-i[n][1])/(i[s][1]-i[n][1])+i[n][0]&&(e=!e),s=n;return e}getBoundingRect(){const t=this.anchor,i=this.width/2,e=this.height/2,n=t[0]-i,s=t[1]-e,o=t[0]+i,r=t[1]+e;return[[n,s],[o,s],[o,r],[n,r]]}getBoundingDimension(){return{height:this.height,width:this.width}}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[i,e]=t,n=this.width/2,s=this.height/2;return{[P.RIGHT]:[i+n,e],[P.LEFT]:[i-n,e],[P.BOTTOM]:[i,e+s],[P.TOP]:[i,e-s]}}},et=1/Math.sqrt(3);class nt extends it{constructor(t){super(t),this.initGroup(t)}render(t){this.renderGroup(t,(()=>{it.prototype.render.call(this,t)}))}isHit(t,i){return this.isHitGroup(t,i)||it.prototype.isHit.call(this,t)}}Object.assign(nt.prototype,V),Object.assign(nt.prototype,{_getBoundingGroupRect(){const t=D(this._stack.getBoundingRectPoints()),i=this.padding,e=this.minWidth-i.left-i.right,n=this.definedWidth-i.left-i.right,s=t.width+i.left+i.right+t.height*et/2,o=t.height+i.top+i.bottom;this.width=e?Math.max(e,s):n||s,this.height=this.definedHeight||o},setConfig(t){Object.keys(t).forEach((i=>{void 0!==t[i]&&null!==t[i]&&(this[i]=t[i],this._rawConfigs[i]=t[i])})),this.padding={top:t.paddingTop||t.padding||0,right:t.paddingRight||t.padding||0,bottom:t.paddingBottom||t.padding||0,left:t.paddingLeft||t.padding||0},this._cacheSide()}}),Math.sqrt(3);class st extends it{constructor(t){super(t),this.initGroup(t)}render(t){this.renderGroup(t,(()=>{t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();const[i,e]=this.anchor,n=this.width/2,s=this.height/2,o=n/1.732,r=e-s,h=e+s,a=e-s+o,c=e+s-o,l=i-n,d=i+n;t.moveTo(i,r),t.lineTo(d,a),t.lineTo(d,c),t.lineTo(i,h),t.lineTo(l,c),t.lineTo(l,a),t.closePath(),t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore(),this._cachePoints=[[i,r],[d,a],[d,c],[i,h],[l,c],[l,a]],console.log(this._cachePoints)}))}isHit(t,i){return this.isHitGroup(t,i)||it.prototype.isHit.call(this,t)}}Object.assign(st.prototype,V),Object.assign(st.prototype,{_getBoundingGroupRect(){const t=D(this._stack.getBoundingRectPoints()),i=D(this._stack.getAnchorRectPoints()),e=this.padding,n=this.minWidth-e.left-e.right,s=this.definedWidth-e.left-e.right,o=t.width+e.left+e.right,r=i.height+o/1.732+e.top+e.bottom;this.width=n?Math.max(n,o):s||o,this.height=this.definedHeight||r}});const ot=class extends Z{constructor(t={}){super(t),this.type="Rhombus",this.height=t.diagonalsV||10,this.width=t.diagonalsH||20}render(t){t.save(),this._isMoving&&(t.globalAlpha=.6);const i=this.width/2,e=this.height/2,n=this.anchor;t.translate(n[0],n[1]),t.beginPath(),t.moveTo(0,-e),t.lineTo(i,0),t.lineTo(0,e),t.lineTo(-i,0),t.closePath(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),t.translate(-n[0],-n[1]),t.restore()}isHit(t){const i=this.height/2,e=this.width/2,n=this.anchor;return Math.abs(t[0]-n[0])/e+Math.abs(t[1]-n[1])/i<=1}getBoundingRect(){const t=this.anchor,i=this.width/2,e=this.height/2,n=t[0]-i,s=t[1]-e,o=t[0]+i,r=t[1]+e;return[[n,s],[o,s],[o,r],[n,r]]}getBoundingDimension(){return{height:this.height,width:this.width}}getIntersectionsInFourDimension(){let t=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(t=this._belongs.calculateToCoordination(t));const[i,e]=t,n=this.width/2,s=this.height/2;return{[P.RIGHT]:[i+n,e],[P.LEFT]:[i-n,e],[P.BOTTOM]:[i,e+s],[P.TOP]:[i,e-s],[P.SELF]:[i+.618*n,e+.618*s]}}};Object.assign(class extends ot{constructor(t){super(t),this.initGroup(t)}render(t){this.renderGroup(t,(()=>{ot.prototype.render.call(this,t)}))}isHit(t,i){return this.isHitGroup(t,i)||ot.prototype.isHit.call(this,t)}}.prototype,V);const rt="left",ht="right",at=class extends ${constructor(t){super(t),this.type="Text",this.content=t.content||"",this.fontFamily=t.fontFamily||"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",this.fontSize=t.fontSize||"28px",this.textColor=t.textColor||"white",this.textAlign=t.textAlign||"center",this.textBaseline=t.textBaseline||"middle",this.lineHeight=t.lineHeight,this.indent=t.indent||0,this.backgroundColor=t.backgroundColor,this.editable=t.editable,this.acceptPatten=t.acceptPatten,this.minWidth=t.minWidth||0,o((t=>{this.renderShadowText(t)})),this._makeEditable()}_makeEditable(){this.editable&&this.addEventListener("click",(t=>{let i;const e=this.width/2;i=this.textAlign===rt?this.anchor[0]-e+this.indent/2:this.textAlign===ht?this.anchor[0]+e:this.anchor[0]+this.indent/2;const n=[i,-this.height/2],s=+/(\d+)/.exec(this.fontSize)[1],[o,r]=this.calculateToRealWorld(n);let h=function(){const t=document.createElement("input");return t.setAttribute("style","\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        background-image:none;\n        background-color:transparent;\n        -webkit-box-shadow: none;\n        -moz-box-shadow: none;\n        box-shadow: none;"),t}();const a=this._jflow.DOMwrapper,c=this.content;h.style.transform=`translate(${o}px, ${r}px)`,h.style.width=this.calculateToRealWorldWithScalar(this.width)+"px",h.style.height=this.calculateToRealWorldWithScalar(this.height)+"px",h.style.fontFamily=this.fontFamily,a.style.fontSize=s*this._jflow.scale+"px",h.style.fontSize=s*this._jflow.scale+"px",h.style.lineHeight=this.lineHeight*this._jflow.scale+"px",h.style.textIndent=this.indent*this._jflow.scale+"px",h.value=this.content,h.style.color=this.textColor,h.addEventListener("focus",(()=>{this.content="",this._jflow._render(),h.style.outline="none"}));let l=()=>{if(this.acceptPatten);else{const t=h.value;this.dispatchEvent(new Y("change",{target:this,oldVal:c,val:t})),this.content=c,this._jflow._render(),this._jflow.removeEventListener("zoompan",l),h.removeEventListener("blur",l),a.removeChild(h),h=null,l=null}};this._jflow.addEventListener("zoompan",l),h.addEventListener("blur",l);const d=t=>{"Enter"!==t.key&&13!==t.keyCode||(t.preventDefault(),h.removeEventListener("keypress",d),l())};h.addEventListener("keypress",d),a.append(h),h.focus()}))}renderShadowText(t){t.beginPath(),t.font=`${this.fontSize} ${this.fontFamily}`,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.fillStyle=this.textColor;const{actualBoundingBoxLeft:i,actualBoundingBoxRight:e,fontBoundingBoxAscent:n,fontBoundingBoxDescent:s}=t.measureText(this.content);this._textWidth=this.indent+Math.abs(i)+Math.abs(e),this.width=Math.max(this.minWidth,this._textWidth);const o=Math.abs(n)+Math.abs(s);this.lineHeight?this.height=this.lineHeight:this.height=o}setConfig(t){Object.keys(t).forEach((i=>{void 0!==t[i]&&null!==t[i]&&(this[i]=t[i],this._rawConfigs[i]=t[i])})),o((t=>{this.renderShadowText(t)}))}render(t){if(t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath(),t.font=`${this.fontSize} ${this.fontFamily}`,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.fillStyle=this.textColor,this.textAlign===rt){const i=this.width/2;t.fillText(this.content,this.anchor[0]-i+this.indent/2,this.anchor[1])}else if(this.textAlign===ht){const i=this.width/2;t.fillText(this.content,this.anchor[0]+i,this.anchor[1])}else t.fillText(this.content,this.anchor[0]+this.indent/2,this.anchor[1]);t.fill(),t.restore()}};Math.PI;const ct=Math.PI/180,lt=class extends J{constructor(t){super(t),this.approximate=t.approximate||6,this.minSpanX=t.minSpanX||0,this.minSpanY=t.minSpanY||0,this.lineDash=t.lineDash,this.doubleLink=t.doubleLink,this.fontFamily=t.fontFamily="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",this.fontSize=t.fontSize||"12px",this.content=t.content||"",this.isSelf=!!t.isSelf}_calculateAnchorPoints(){const t=this.from.getIntersectionsInFourDimension(),i=this.to.getIntersectionsInFourDimension();if(this.isSelf){const e=I(t[this.fromDir],i[P.SELF],this.fromDir,P.BOTTOM,this.minSpanX,this.minSpanY);this._cachePoints=[...t[this.fromDir],...e],console.log(e),this._cacheAngle=[this.fromDir,P.BOTTOM]}else if(void 0!==this.fromDir&&void 0!==this.toDir){const e=I(t[this.fromDir],i[this.toDir],this.fromDir,this.toDir,this.minSpanX,this.minSpanY);this._cachePoints=[...t[this.fromDir],...e],this._cacheAngle=[this.fromDir,this.toDir]}else{const e=function(t,i){const e={fromDir:null,fromP:null,toDir:null,toP:null,distMin:1/0};return Object.keys(t).forEach((n=>{if(+n===P.SELF)return;let s=t[n];Object.keys(i).forEach((t=>{if(+t===P.SELF)return;let o=i[t];const r=j(s,o);r<e.distMin&&Object.assign(e,{distMin:r,fromDir:+n,fromP:s,toDir:+t,toP:o})}))})),e}(t,i),n=I(e.fromP,e.toP,e.fromDir,e.toDir);this._cachePoints=[...e.fromP,...n],this._cacheAngle=[e.fromDir,e.toDir]}}render(t){this._calculateAnchorPoints();const i=this._cachePoints,e=R.apply(null,[1,...i]);if(t.fillStyle=t.strokeStyle=this.backgroundColor,this.doubleLink){const e=(this._cacheAngle[0]+2)%4*90*ct;t.beginPath(),t.translate(i[0],i[1]),t.rotate(e),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-e),t.translate(-i[0],-i[1])}if(t.beginPath(),t.moveTo(i[0],i[1]),t.bezierCurveTo(...i.slice(2)),this.lineDash&&(t.save(),t.setLineDash(this.lineDash)),t.stroke(),this.lineDash&&t.restore(),t.beginPath(),t.translate(i[6],i[7]),t.rotate(e),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-e),t.translate(-i[6],-i[7]),this.content){t.beginPath();const[e,n,s]=function(t,i){const e=.5,n=.125*i[0]+.375*i[2]+.375*i[4]+.125*i[6],s=.125*i[1]+.375*i[3]+.375*i[5]+.125*i[7],o=e*e*(i[2]-i[0])+.5*(i[4]-i[2])+t*t*(i[6]-i[4]),r=e*e*(i[3]-i[1])+.5*(i[5]-i[3])+t*t*(i[7]-i[5]);return[n,s,Math.atan2(r,o)]}(.5,i);t.translate(e,n),t.rotate(s),t.font=`${this.fontSize} ${this.fontFamily}`,t.textAlign="center",t.fillText(this.content,0,10),t.rotate(-s),t.translate(-e,-n)}}isHit(t){if(!this._cachePoints)return!1;const i=function(t,i){const e=new M(...i).project({x:t[0],y:t[1]});return j(t,[e.x,e.y])}(t,this._cachePoints);return i<this.approximate}getBoundingRect(){const{startX:t,startY:i,endX:e,endY:n}=this._calculateAnchorPoints();return[[t,i],[e,n]]}};class dt{constructor(t={}){this.direction=t.direction||"vertical",this.gap=t.gap??5,this.alignment=t.alignment||"center",this.justify=t.justify||"center",this._rawConfigs=t}reflow(t){const i=t._stack.filter((t=>t.visible&&!t.absolutePosition)),e=t._stack.filter((t=>t.visible&&t.absolutePosition)),n=t.width-t.padding.left-t.padding.right;if("vertical"===this.direction){let t=0,e=0,s=0,o=0;i.forEach(((i,n)=>{const{width:r,height:h}=i.getBoundingDimension(),a=n>0?this.gap:0;s=Math.max(r,s),o+=h+a,t+=h/2+a+e,e=h/2,i.anchor=[0,t]})),s=Math.max(n,s),o/=2,"start"===this.alignment&&i.forEach(((t,i)=>{const{width:e}=t.getBoundingDimension();t.anchor[0]=-(s-e)/2,t.anchor[1]-=o})),"end"===this.alignment&&i.forEach(((t,i)=>{const{width:e}=t.getBoundingDimension();t.anchor[0]=(s-e)/2,t.anchor[1]-=o})),"center"===this.alignment&&i.forEach(((t,i)=>{const{width:e}=t.getBoundingDimension();t.anchor[1]-=o}))}if("horizontal"===this.direction){let t=0,e=0,s=0,o=0,r=0;if(i.forEach(((i,n)=>{const{width:h,height:a}=i.getBoundingDimension(),c=n>0?this.gap:0;s=Math.max(a,s),o+=h+c,r+=h,t+=h/2+c+e,e=h/2,i.anchor=[t,0]})),"start"===this.justify){const t=n/2;i.forEach(((i,e)=>{i.anchor[0]-=t}))}if("end"===this.justify){const t=n/2-o;i.forEach(((i,e)=>{i.anchor[0]+=t}))}if("center"===this.justify){const t=o/2;i.forEach(((i,e)=>{i.anchor[0]-=t}))}if("space-between"===this.justify&&i.length>1){const t=Math.max(n,o),e=(t-o)/(i.length-1),s=t/2;i.forEach(((t,i)=>{t.anchor[0]+=e*i-s}))}"start"===this.alignment&&i.forEach(((t,i)=>{const{height:e}=t.getBoundingDimension();t.anchor[1]=-(s-e)/2})),"end"===this.alignment&&i.forEach(((t,i)=>{const{height:e}=t.getBoundingDimension();t.anchor[1]=(s-e)/2}))}if(e.length){t._getBoundingGroupRect();const i=t.width/2,n=t.height/2;e.forEach((t=>{t.anchor=this._resolveAbsoluteAnchor(t.absolutePosition,t,i,n)}))}}_resolveAbsoluteAnchor(t,i,e,n){const{top:s,right:o,bottom:r,left:h}=t,{width:a,height:c}=i.getBoundingDimension(),l=a/2,d=c/2;let u=0,g=0;return s&&(u=s+d-n),o&&(g=e-o-l),r&&(u=n-r-d),h&&(g=h+l-e),[g,u]}clone(){return new dt(this._rawConfigs)}}const ut=dt;class gt extends EventTarget{constructor(t){super(),this.uniqueName="jflow",this.eventAdapter=new class{constructor(t={}){this.plugin={canvas:{wheel:function(t,i){t.preventDefault();let{offsetX:e,offsetY:n,deltaX:s,deltaY:o}=t;t.ctrlKey?(o=-o,i.zoomHandler(e,n,s,o,t)):i.panHandler(-s,-o,t)},pointerdown:function(t,i){const{offsetX:e,offsetY:n,deltaY:s,button:o}=t;0===o&&i.pressStartHandler(e,n,t)},pointermove:function(t,i){const{offsetX:e,offsetY:n}=t;i.pressMoveHandler(e,n,t)},pointerup:function(t,i){t.preventDefault(),t.stopPropagation();const{button:e}=t;0===e&&i.pressUpHanlder(!1,t)},contextmenu:function(t,i){t.preventDefault(),t.stopPropagation();const{offsetX:e,offsetY:n}=t;i.contextMenuHanlder(e,n,t)}},document:{pointerup:function(t,i){i.pressUpHanlder(!0,t)}}},this.use(t),this.canvasHandlers=[],this.documentHandlers=[]}use(t={}){const{canvas:i,document:e}=t;if(i)for(let t in i)i.hasOwnProperty(t)&&(this.plugin.canvas[t]=i[t]);if(e)for(let t in e)e.hasOwnProperty(t)&&(this.plugin.document[t]=e[t])}apply(t){const{canvas:i,document:e}=this.plugin,n=t.canvas;for(let e in i){const s=i[e];function o(i){s(i,t)}n.addEventListener(e,o),this.canvasHandlers.push({eventName:e,handlerWrapperd:o})}for(let i in e){const n=e[i];function s(i){n(i,t)}document.addEventListener(i,s),this.documentHandlers.push({eventName:i,handlerWrapperd:s})}}unload(t){const i=t.canvas;this.canvasHandlers.forEach((({eventName:t,handlerWrapperd:e})=>{i.removeEventListener(t,e)})),this.documentHandlers.forEach((({eventName:t,handlerWrapperd:i})=>{document.removeEventListener(t,i)}))}}(t.eventAdapter),this.initStack(t),this.initLayout(t),this.ctx=null,this.canvas=null,this.dpr=1,this.padding=20,this.position=null,this.scale=null,this.initialZoom=t.initialZoom,this.maxZoom=t.maxZoom||3,this.minZoom=t.minZoom||.5,this.offeset=null,this._lastState={x:null,y:null,dragging:!1,processing:!1},this._lastDragState={target:null,targetLink:null,processing:!1},this._target={instance:null,link:null,moving:null,isInstanceDirty:!1,isLinkDirty:!1,cache:{stack:null,belongs:null,point:null},meta:{x:void 0,y:void 0,initialX:void 0,initialY:void 0},status:{dragovering:!1,dragging:!1,processing:!1}},this._focus={instance:null},this._dragOverTarget=null,this.allowDrop=t.allowDrop,this._tempInstance=null}setTempDraggingInstance(t){t._belongs=this,this._tempInstance=t,Object.assign(this._target,{moving:[this._tempInstance],dragging:!0})}removeTempDraggingInstance(){if(this._tempInstance){const t=this._tempInstance.anchor;return this._tempInstance=null,t}}$mount(t){const{canvas:i,ctx:e,scale:n,width:s,height:o,raw_width:r,raw_height:h,left:a,top:c}=function(t){const i=document.createElement("canvas"),e=i.getContext("2d"),{width:n,height:s,left:o,top:r}=t.getBoundingClientRect();i.style.width=n+"px",i.style.height=s+"px",i.style.userSelect="none";const h=window.devicePixelRatio;return i.width=Math.floor(n*h),i.height=Math.floor(s*h),t&&(t.style.position="relative",t.append(i)),{canvas:i,width:n,height:s,raw_width:i.width,raw_height:i.height,left:o,top:r,ctx:e,scale:h}}(t);this.reflow(),this.ctx=e,this.DOMwrapper=t,this.canvas=i,this.canvasMeta={width:r,height:h,actual_width:s,actual_height:o},this.dpr=n,this._createEventHandler(),this._getBoundingGroupRect();const l=this.padding,{width:d,height:u,x:g,y:p}=this.bounding_box,f={x:l,y:l,width:s-2*l,height:o-2*l},m={x:0,y:0,offsetX:0,offsetY:0},b=f.width/d,_=f.height/u,x=b<=_?"x":"y";let y;y=this.initialZoom?this.initialZoom:Math.min(b,_),this.scale=y,y>this.maxZoom&&(this.maxZoom=y),y<this.minZoom&&(this.minZoom=y),m.x="x"===x?f.x:(f.width-d*y)/2+l,m.y="y"===x?f.y:(f.height-u*y)/2+l,m.offsetX=m.x-g*y,m.offsetY=m.y-p*y,this.position=m,this._render()}_getBoundingGroupRect(){const t=this._stack.getBoundingRectPoints();if(this.bounding_box){this.bounding_box=D(t);const{x:i,y:e}=this.bounding_box,n=this.scale;this.position.x=this.position.offsetX+i*n,this.position.y=this.position.offsetY+e*n}else this.bounding_box=D(t)}_createEventHandler(){const t=this.canvas;let i;this.eventAdapter.apply(this);const e=()=>{this.eventAdapter.unload(this)};if(i=e,this.allowDrop){const n=this._onDragover.bind(this),s=this._onDrop.bind(this);t.addEventListener("dragover",n),t.addEventListener("drop",s),i=()=>{e(),t.removeEventListener("dragover",n),t.removeEventListener("drop",s)}}this.destroy=i}_targetLockOn(t,i){let e=this._calculatePointBack(t);const n=e;this._currentp=e;let s=this._stack;const o=s.checkHit(e,(t=>this._target.status.dragging&&t===this._getMovingTarget()));let r=this._linkStack,h=this;o&&(r=o._belongs._linkStack,e=o._belongs._currentp,s=o._belongs._stack,h=o._belongs);const a=r.checkHit(e,(t=>{if(!this._target.status.dragging)return!1;const i=this._getMovingTarget();return t.from===i||t.to===i}));if(Object.assign(this._target,{instance:o,link:a,isInstanceDirty:o===this._target.instance,isLinkDirty:a===this._target.link}),Object.assign(this._target.cache,{stack:s,belongs:h,point:e,topLayerPoint:n}),Object.assign(this._target.meta,{x:t[0],y:t[1]}),"pressStart"===i&&!this._target.status.dragging&&!this._target.status.dragovering){let t=o;for(;t&&t._belongs.lock&&t!==this;)t=t._belongs;t&&(t=t._layoutNode?t._layoutNode.isLocked?t._layoutNode.getNodes():t._layoutNode.isDraggable?[t]:void 0:[t]),Object.assign(this._target,{moving:t})}return this._target}_getMovingTarget(){return this._target.moving&&this._target.moving[0]}_processDragOver(t,i){if(this._dragOverTarget!==t){const e=this.readMessage()?.instance;if(this._dragCurrentData=e,this._dragOverTarget){const t=this._dragOverTarget;t.dispatchEvent(new Y("dragleave",{event:i,instance:t,target:e}))}t&&t.dispatchEvent(new Y("dragenter",{event:i,instance:t,target:e})),this._dragOverTarget=t}else this._dragOverTarget&&this._dragOverTarget.dispatchEvent(new Y("dragover",{event:i,instance:t,target:this._dragCurrentData}))}_onDragover(t){if(t.preventDefault(),t.stopPropagation(),this._lastDragState.processing)return;this._lastDragState.processing=!0;const{offsetX:i,offsetY:e}=t;Object.assign(this._target.status,{dragovering:!0}),this._targetLockOn([i,e]);const n=this._target.instance||this._target.link;this._processDragOver(n,t),this._target.isLinkDirty||this._target.isInstanceDirty?Promise.resolve().then((()=>{this._render(),this._target.isLinkDirty=!1,this._target.isInstanceDirty=!1,this._lastDragState.processing=!1})):this._lastDragState.processing=!1}_onDrop(t){const{offsetX:i,offsetY:e,clientX:n,clientY:s}=t,o=this.consumeMessage().instance;if(this._dragOverTarget){const i=this._dragOverTarget;i.dispatchEvent(new Y("dragoverend",{event:t,instance:i})),this._dragOverTarget=null}const{link:r,instance:h}=this._target,{point:a,belongs:c}=this._target.cache;r?(o.anchor=a,r.dispatchEvent(new Y("drop",{event:t,instance:o,link:r,jflow:this,belongs:c,point:a}))):h?h.dispatchEvent(new Y("drop",{event:t,instance:o,jflow:this,target:h,point:a})):this.dispatchEvent(new Y("drop",{event:t,instance:o,jflow:this,target:h,point:a})),requestAnimationFrame((()=>{this._target.instance=null,this._target.link=null,Object.assign(this._target.status,{dragovering:!1})}))}zoomHandler(t,i,e,n,s){if(this._zooming)return;this._zooming=!0;const{width:o,height:r,x:h,y:a}=this.bounding_box;let c=this.scale;c*=n>0?1.1:1/1.1,this.maxZoom&&c>this.maxZoom&&(c=this.maxZoom),this.minZoom&&c<this.minZoom&&(c=this.minZoom);var l=c-this.scale,d=o*this.scale,u=r*this.scale,g=o*l,p=r*l,f=-(t-this.position.x)/d,m=-(i-this.position.y)/u;this.scale=c,this.position.x+=f*g,this.position.y+=m*p,this.position.offsetX=this.position.x-h*c,this.position.offsetY=this.position.y-a*c,this.dispatchEvent(new Y("zoompan")),requestAnimationFrame((()=>{this._render(),this._zooming=!1}))}panHandler(t,i,e){this._panning||(this._panning=!0,this._recalculatePosition(t,i),this.dispatchEvent(new Y("zoompan")),requestAnimationFrame((()=>{this._render(),this._panning=!1})))}pressStartHandler(t,i,e){if(this._targetLockOn([t,i],"pressStart"),Object.assign(this._target.meta,{initialX:t,initialY:i}),Object.assign(this._target.status,{dragging:!0,processing:!1}),this._target.moving){const t=this._getMovingTarget();t.dispatchEvent(new Y("pressStart",{event:e,instance:t,jflow:this}))}if(this._target.instance){const t=this._target.instance;t.bubbleEvent(new Y("instancePressStart",{event:e,target:t,jflow:this,bubbles:!0}))}}pressMoveHandler(t,i,e){const{dragging:n,processing:s}=this._target.status,{x:o,y:r}=this._target.meta;if(this.canvas.style.cursor="default",!n&&!s){const{link:n,instance:s}=this._targetLockOn([t,i]);s&&s.dispatchEvent(new Y("instancemousemove",{event:e,instance:s,jflow:this}))}if(this.dispatchEvent(new Y("canvasmousemove",{event:e,jflow:this})),!n)return;if(this.canvas.style.cursor="grabbing",s)return;const h=this._target.moving;this._target.status.processing=!0;const a=t-o,c=i-r;h?h.forEach((t=>{t.anchor[0]+=a/this.scale,t.anchor[1]+=c/this.scale})):(this._recalculatePosition(a,c),this.dispatchEvent(new Y("zoompan")));const{instance:l,link:d}=this._targetLockOn([t,i]);this._processDragOver(l||d,e),requestAnimationFrame((()=>{this._render(),this._target.isLinkDirty=!1,this._target.isInstanceDirty=!1,this._target.status.processing=!1}))}pressUpHanlder(t,i){const e=this._target.meta;if(e.initialX===e.x&&e.initialY===e.y){if(i.target!==this.canvas)return void this._clearTarget();if(this._target.instance&&!t){const t=this._target.instance;return t.bubbleEvent(new Y("click",{event:i,target:t,jflow:this,bubbles:!0})),this._clearTarget(),void this._render()}return this.dispatchEvent(new Y("click",{event:i,jflow:this})),this._clearTarget(),void this._render()}if(this._target.moving){let t=!1;if(this._layout.static&&(t=this.staticCheck(this._getMovingTarget())),!t&&this._target.link){const{point:t,belongs:e}=this._target.cache,n=this._target.link,s=this._getMovingTarget();n.dispatchEvent(new Y("drop",{event:i,instance:s,link:n,jflow:this,belongs:e})),this._target.link=null,this._target.instance=null}this._target.moving&&(this._target.instance?(console.log("pressEnd",this._target.instance),this._target.instance.bubbleEvent(new Y("pressEnd",{event:i,instance:this._getMovingTarget(),jflow:this,target:this._target.instance,bubbles:!0}))):this.dispatchEvent(new Y("pressEnd",{event:i,instance:this._getMovingTarget(),jflow:this}))),this._target.moving=null,this.removeTempDraggingInstance(),this._render()}this._clearTarget()}contextMenuHanlder(t,i,e){const{link:n,instance:s}=this._targetLockOn([t,i]),{topLayerPoint:o}=this._target.cache;if(s||n){const t=s||n;t.bubbleEvent(new Y("contextclick",{event:e,jflow:this,target:t,topLayerPoint:o,bubbles:!0}))}else this.dispatchEvent(new Y("contextclick",{event:e,jflow:this,topLayerPoint:o}))}_clearTarget(){Object.assign(this._target.meta,{x:void 0,y:void 0,initialX:void 0,initialY:void 0}),Object.assign(this._target.status,{dragging:!1,processing:!1}),Object.assign(this._target,{instance:null,link:null,moving:null})}_recalculatePosition(t,i,e){const{x:n,y:s}=this.bounding_box;void 0===e&&(e=this.scale),this.position.x+=t,this.position.y+=i,this.position.offsetX=this.position.x-n*e,this.position.offsetY=this.position.y-s*e}calculateToRealWorld(t){const i=this.scale,e=this.position;return[t[0]*i+e.offsetX,t[1]*i+e.offsetY]}_calculatePointBack(t){const i=this.scale,e=this.position;return[(t[0]-e.offsetX)/i,(t[1]-e.offsetY)/i]}_calculateDistance(t){return this.scale*t}_resetTransform(){const{width:t,height:i}=this.canvasMeta,e=this.position,n=this.scale,s=this.ctx;s.setTransform(),s.clearRect(0,0,t,i),s.scale(this.dpr,this.dpr),s.transform(n,0,0,n,e.offsetX,e.offsetY)}_render(){this._resetTransform();const t=this.ctx;this._stack.render(t),this._linkStack.render(t),this._tempInstance&&(t.save(),this._tempInstance.render(t),t.restore())}}Object.assign(gt.prototype,F),Object.assign(gt.prototype,L),Object.assign(gt.prototype,A);const pt=gt;window.renderErGraph=function(t,e){const n=new class{constructor(t){this.static=!1,this.flowStack=[],this.flowLinkStack=[],this.roots=[],this.reOrder(t)}reOrder(t){this.flowStack=[],this.flowLinkStack=[];const e=function(t){const e={};return t.map((t=>{const n=new i(t);return e[t.name]=n,n})),e}(t),n=Object.values(e);n.forEach((t=>{this.flowStack.push(t),t.makeLink((t=>{const i=e[t.from],n=e[t.to];i&&n&&(i.linkOutArr.push(n),i.linkOut+=1,n.linkIn+=1,this.flowLinkStack.push({...t,meta:{from:i,to:n}}))}))}));const s={};!function t(i,e=0){s[e]||(s[e]=[]);const n=e+1;i.forEach((i=>{const o=s[i.level].findIndex((t=>t===i));~o&&s[i.level].splice(o,1),i.level=Math.max(e,i.level),s[i.level].push(i),t(i.linkOutArr,n)}))}(n.filter((t=>0===t.linkIn))),this.levelMapping=s}reflow(t){this.flowLinkStack,this.flowStack;let i=0;Object.keys(this.levelMapping).sort(((t,i)=>+i-+t)).forEach((t=>{const e=this.levelMapping[t];let n=0,s=0;e.forEach(((t,i)=>{const e=t.getJflowInstance(),{width:o,height:r}=e.getBoundingDimension();n=Math.max(o,n),i>0&&(s+=r/2),e.anchor[1]=s,s+=r/2+40})),s-=20;const o=s/2;e.forEach((t=>{const e=t.getJflowInstance();e.anchor[0]=i,e.anchor[1]-=o,console.log(e._ERnode.id,e.anchor[1])})),i+=n+150}))}}(t),s=new pt({allowDrop:!1,layout:n,eventAdapter:X});n.flowStack.forEach((t=>{const i=function(t){const i=new at({content:t.id,textColor:"#2780E3"}),e=new Q({layout:new ut({direction:"vertical",gap:0}),borderRadius:8,borderColor:"#2780E3",borderWidth:2});if(t.source.module){const n=new at({content:t.source.module.name,textColor:"#2780E3"}),s=new Q({padding:15,border:{right:{borderWidth:2,borderColor:"#2780E3"}}}),o=new Q({padding:15});s.addToStack(i),s.recalculate(),console.log(s.height),o.addToStack(n),o.recalculate(),console.log(o.height);const r=new Q({layout:new ut({direction:"horizontal",gap:0})});r.addToStack(s),r.addToStack(o),r.recalculate(),console.log(r.height),e.addToStack(r);const h=new Q({padding:15}),a=new at({content:t.source.configName,textColor:"#2780E3"});h.addToStack(a),h.recalculate(),r.width>h.width?r.setConfig({border:{bottom:{borderWidth:2,borderColor:"#2780E3"}}}):h.setConfig({border:{top:{borderWidth:2,borderColor:"#2780E3"}}}),e.addToStack(h),e.recalculate(),console.log(t.id,e.height)}else e.addToStack(i),e.setConfig({padding:15,borderRadius:8,borderColor:"#2780E3",borderWidth:2}),e.recalculate(),console.log(t.id,e.height);return e._ERnode=t,t.getJflowInstance=()=>e,e}(t);s.addToStack(i)})),n.flowLinkStack.forEach((t=>{const i=function(t){const i=t.meta;return new lt({...t,content:t.part,to:i.from.getJflowInstance(),from:i.to.getJflowInstance(),backgroundColor:"#2780E3",fontSize:"16px"})}(t);s.addToLinkStack(i)}));const o=document.getElementById(e);o.style.width="100%",s.$mount(o)}})();