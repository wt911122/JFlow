{"version":3,"sources":["core/instance/shapes/capsule.js"],"names":["Capsule","configs","type","width","height","ctx","save","_isMoving","globalAlpha","beginPath","anchor","x","y","hw","hh","leftCenter","rightCenter","top","bottom","moveTo","lineTo","arc","Math","PI","fillStyle","backgroundColor","fill","borderWidth","lineWidth","strokeStyle","borderColor","stroke","restore","point","ww","abs","rr","pow","w","h","ltx","lty","rbx","rby","p2","_belongs","calculateToCoordination","x2","y2","DIRECTION","RIGHT","LEFT","BOTTOM","TOP","Node"],"mappings":"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","sourcesContent":["import Node from '../node';\nimport { DIRECTION, oppositeDirection } from '../../utils/constance';\n/**\n * 胶囊单元 配置\n * @typedef {Node~Configs} Capsule~CapsuleConfigs\n * @property {number} width  - 内部矩形宽\n * @property {number} height - 内部矩形高\n */\n/**\n * 胶囊单元\n * @constructor Capsule\n * @extends Node\n * @param {Capsule~CapsuleConfigs} configs - 配置\n */\nclass Capsule extends Node {\n    constructor(configs = {}) {\n        super(configs);\n        this.type =             'Capsule';\n        this.width =            configs.width || 20;\n        this.height =           configs.height || 10;\n    }\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        ctx.beginPath();\n        const [x, y] = this.anchor;\n        const hw = this.width/2;\n        const hh = this.height/2;\n        const leftCenter = x - hw + hh;\n        const rightCenter = x + hw - hh;\n        const top = y - hh;\n        const bottom = y + hh;\n\n        ctx.moveTo(leftCenter, top);\n        ctx.lineTo(rightCenter, top);\n        ctx.arc(rightCenter, y, hh, -Math.PI/2, Math.PI/2);\n        ctx.lineTo(leftCenter, bottom);\n        ctx.arc(leftCenter, y, hh, Math.PI/2, Math.PI/2*3);\n\n        ctx.fillStyle = this.backgroundColor;\n        ctx.fill();\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n            ctx.stroke();\n        }\n        // ctx.fillStyle = 'rgba(0,0,0,0.3)';\n        // ctx.fillRect(x-hw, y-hh, this.width, this.height)\n\n        ctx.restore();\n    }\n\n    isHit(point) {\n        const anchor = this.anchor;\n        const hw = this.width/2;\n        const hh = this.height/2;\n        const ww =  Math.abs(hw - hh);\n        const leftCenter = anchor[0] - hw + hh;\n        const rightCenter = anchor[0] + hw - hh;\n        const rr = hh * hh;\n        return (point[0] > anchor[0] - ww\n            && point[0] < anchor[0] + ww\n            && point[1] > anchor[1] - hh\n            && point[1] < anchor[1] + hh)\n            || ( Math.pow(point[0] - leftCenter, 2) + Math.pow(point[1] - anchor[1], 2) < rr)\n            || ( Math.pow(point[0] - rightCenter, 2) + Math.pow(point[1] - anchor[1], 2) < rr)\n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        return [\n            [ltx, lty],\n            [rbx, lty],\n            [rbx, rby],\n            [ltx, rby],\n        ]\n    }\n\n    getBoundingDimension() {\n        return {\n            height: this.height,\n            width: this.width,\n        }\n    }\n\n    getIntersectionsInFourDimension() {\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n        return {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n        }\n    }\n}\n\nexport default Capsule;"],"file":"capsule.js"}