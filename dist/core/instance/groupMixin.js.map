{"version":3,"sources":["core/instance/groupMixin.js"],"names":["GroupMixin","StackMixin","LayoutMixin","initGroup","configs","initStack","initLayout","padding","top","paddingTop","right","paddingRight","bottom","paddingBottom","left","paddingLeft","definedWidth","width","minWidth","definedHeight","height","lock","_getBoundingGroupRect","reflow","setConfig","Object","keys","forEach","k","undefined","_rawConfigs","points","_stack","getBoundingRectPoints","bbox","w","h","Math","max","renderGroup","ctx","callback","save","_isMoving","globalAlpha","anchor","restore","centerX","centerY","translate","render","_linkStack","_calculatePointBack","point","gx","gy","p","isHitGroup","condition","_currentp","target","checkHit","calculateToCoordination","cx","cy","_belongs","calculateToRealWorld","clone","C","constructor","assign","layout","_layout","t","interateNodeStack","instance","addToStack","recalculate"],"mappings":"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","sourcesContent":["import StackMixin from './stackMixin';\nimport LayoutMixin from './layoutMixin';\nimport { bounding_box } from '../utils/functions';\nimport { DIRECTION } from '../utils/constance';\n\n/**\n * Group mixin 配置\n * @typedef {Object} GroupMixin~GroupConfigs\n * @property {number} width             - 设定宽度 \n * @property {number} minWidth          - 最小宽度 \n * @property {number} height            - 设定高度 \n * @property {number} padding          - 内边距\n * @property {number} paddingTop          - 内上边距\n * @property {number} paddingRight         - 内右边距\n * @property {number} paddingBottom        - 内下边距\n * @property {number} paddingLeft          - 内左边距\n * @property {boolean} lock            - 布局锁定状态 默认 true\n */\n\n /**\n * Group mixin 配置\n * @typedef {GroupMixin~GroupConfigs | LayoutMixin~LayoutConfigs} GroupMixin~LayoutGroupConfigs\n */\n\n/**\n * Group mixin 用于在形状上加上 Group 特性\n *\n * @mixin\n * @mixes LayoutMixin\n * @mixes StackMixin\n */\n \nconst GroupMixin = {\n    ...StackMixin,\n    ...LayoutMixin,\n    /**\n     * 配置 mixin\n     * @param {GroupMixin~LayoutGroupConfigs} configs - 配置 Group\n     */\n    initGroup(configs) {\n        this.initStack(configs);\n        this.initLayout(configs);\n        // this.padding =          configs.padding || 2;\n        this.padding = {\n            top: configs.paddingTop || configs.padding || 0,\n            right: configs.paddingRight || configs.padding || 0,\n            bottom: configs.paddingBottom || configs.padding || 0,\n            left: configs.paddingLeft || configs.padding || 0,\n        };\n        this.definedWidth =     configs.width;\n        this.minWidth =         configs.minWidth;\n        this.definedHeight =    configs.height;\n        this.lock =             configs.lock ?? true ;\n        // this.offsetY = 0;\n        // this.offsetX = 0;\n        this._getBoundingGroupRect();\n        this.reflow();\n        this._getBoundingGroupRect();\n    },\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k]\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n        this.padding = {\n            top: configs.paddingTop || configs.padding || 0,\n            right: configs.paddingRight || configs.padding || 0,\n            bottom: configs.paddingBottom || configs.padding || 0,\n            left: configs.paddingLeft || configs.padding || 0,\n        };\n    },\n    _getBoundingGroupRect() {\n        const points = this._stack.getBoundingRectPoints();\n        const bbox = bounding_box(points);\n        const padding = this.padding;\n        const minWidth = this.minWidth - padding.left - padding.right;\n        const definedWidth = this.definedWidth - padding.left - padding.right;\n        const w = bbox.width + padding.left + padding.right;\n        const h = bbox.height + padding.top + padding.bottom;\n        this.width = minWidth ? Math.max(minWidth, w) : definedWidth || w;\n        this.height = this.definedHeight || h;\n        // this.offsetY = bbox.y;\n        // this.offsetX = bbox.x;\n    },\n    renderGroup(ctx, callback) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.5;\n        }\n        // this._getBoundingGroupRect();\n        const anchor = this.anchor;\n        ctx.save();\n        callback(ctx);\n        ctx.restore();\n\n        // const height = this.height;\n        // const width = this.width;\n        const padding = this.padding;\n        // const spanV = height / 2 + this.offsetY - padding.top\n        // const spanH = width / 2 + this.offsetX - padding.left\n        const centerX = (padding.left - padding.right)/2;\n        const centerY = (padding.top - padding.bottom)/2;\n        ctx.translate(anchor[0] + centerX, anchor[1] + centerY);\n        this._stack.render(ctx);\n        this._linkStack.render(ctx);\n        ctx.translate(-anchor[0] - centerX, -anchor[1] - centerY);\n        \n        // if(this._isTargeting) {\n        //     this.renderFocus(ctx);\n        // }\n        ctx.restore();\n    },\n    _calculatePointBack(point) {\n        const [gx, gy] = point;\n        // const height = this.height;\n        // const width = this.width;\n        // const padding = this.padding;\n        const padding = this.padding;\n        const centerX = (padding.left - padding.right)/2;\n        const centerY = (padding.top - padding.bottom)/2;\n        // const spanV = height / 2 + this.offsetY - padding.top\n        // const spanH = width / 2 + this.offsetX -  padding.left\n        const anchor = this.anchor;\n        // const p = [gx - anchor[0] + spanH, gy - anchor[1] +spanV ];\n        const p = [gx - anchor[0] - centerX, gy - anchor[1] - centerY]\n        return p\n    },\n    isHitGroup(point, condition) {\n        const p = this._calculatePointBack(point);\n        this._currentp = p; // 暂存，为了后续计算别的位置\n        const target = this._stack.checkHit(p, condition);\n        if(target) return target;\n        return false;\n    },\n     /**\n     * 反算回 canvas 顶层坐标\n     * @param {Number[]} point\n     * @return {Number[]} 世界坐标\n     */\n    calculateToCoordination(point) {\n        const [cx, cy] = point;\n        // const height = this.height;\n        // const width = this.width;\n        // const padding = this.padding;\n        // const spanV = height / 2 + this.offsetY - padding.top\n        // const spanH = width / 2 + this.offsetX - padding.left\n        const padding = this.padding;\n        const centerX = (padding.left - padding.right)/2;\n        const centerY = (padding.top - padding.bottom)/2;\n        const anchor = this.anchor;\n        // const p = [cx + anchor[0] - spanH, cy + anchor[1] - spanV];\n        const p = [cx + anchor[0] + centerX, cy + anchor[1] + centerY]\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            return this._belongs.calculateToCoordination(p);\n        } else {\n            return p;\n        }\n    },\n    calculateToRealWorld(point) {\n        const [cx, cy] = point;\n        // const height = this.height;\n        // const width = this.width;\n        // const padding = this.padding;\n        // const spanV = height / 2 + this.offsetY - padding.top\n        // const spanH = width / 2 + this.offsetX - padding.left\n        const padding = this.padding;\n        const centerX = (padding.left - padding.right)/2;\n        const centerY = (padding.top - padding.bottom)/2;\n        const anchor = this.anchor;\n        // const p = [cx + anchor[0] - spanH, cy + anchor[1] - spanV];\n        const p = [cx + anchor[0] + centerX, cy + anchor[1] + centerY]\n        if(this._belongs && this._belongs.calculateToRealWorld) {\n            return this._belongs.calculateToRealWorld(p);\n        }\n    },\n    clone() {\n        const C = this.constructor;\n        const configs = Object.assign({}, this._rawConfigs, {\n            layout: this._layout && this._layout.clone(),\n        })\n        const t = new C(configs);\n        this.interateNodeStack((instance) => {\n            t.addToStack(instance.clone());\n        })\n        t.recalculate();\n        return t;\n    }\n}\n\nexport default GroupMixin;"],"file":"groupMixin.js"}