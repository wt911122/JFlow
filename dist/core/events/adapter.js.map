{"version":3,"sources":["core/events/adapter.js"],"names":["getDefaultPlugin","canvas","wheel","event","jflow","preventDefault","offsetX","offsetY","deltaX","deltaY","ctrlKey","zoomHandler","panHandler","pointerdown","button","pressStartHandler","pointermove","pressMoveHandler","pointerup","stopPropagation","pressUpHanlder","contextmenu","contextMenuHanlder","document","EventAdapter","plugin","use","canvasHandlers","documentHandlers","ca","docObj","eventName","hasOwnProperty","handler","handlerWrapperd","e","addEventListener","push","forEach","removeEventListener"],"mappings":"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","sourcesContent":["/**\n * 事件处理函数\n * @name EventAdapter~Handler\n * @function\n * @param {Event} event - 原生事件\n * @param {JFlow} jflow - 当前jflow 对象\n */\n\n/**\n * EventAdapter 对象 plugin 配置\n * @typedef {Object} EventAdapter~pluginDef\n * @property {Object} canvas - canvas 相关的事件\n * @property {EventAdapter~Handler} canvas[eventName] - 注册 canvas 上的事件处理\n * @property {Object} document - document 相关的事件\n * @property {EventAdapter~Handler} document[eventName] - 注册 document 上的事件处理\n */\n\nfunction getDefaultPlugin() {\n    return {\n        canvas: {\n            wheel: function (event, jflow) {\n                event.preventDefault();\n                let { offsetX, offsetY, deltaX, deltaY } = event\n                if(event.ctrlKey) { \n                    deltaY = -deltaY;\n                    jflow.zoomHandler(offsetX, offsetY, deltaX, deltaY, event);\n                } else {\n                    jflow.panHandler(-deltaX, -deltaY, event);\n                }\n            },\n            pointerdown: function (event, jflow) {\n                const { offsetX, offsetY, deltaY, button } = event\n                if(button !== 0) return;\n                jflow.pressStartHandler(offsetX, offsetY, event);\n            },\n            pointermove: function (event, jflow) {\n                const { offsetX, offsetY } = event\n                jflow.pressMoveHandler(offsetX, offsetY, event);\n            },\n            pointerup: function (event, jflow) {\n                event.preventDefault();\n                event.stopPropagation();\n                const { button } = event\n                if(button !== 0) return;\n                jflow.pressUpHanlder(false, event)\n            },\n            contextmenu: function (event, jflow) {\n                event.preventDefault();\n                event.stopPropagation();\n                const { offsetX, offsetY } = event;\n                jflow.contextMenuHanlder(offsetX, offsetY, event);\n            },\n        },\n        document: {\n            pointerup: function(event, jflow) {\n                jflow.pressUpHanlder(true, event);\n            }\n        }\n    }\n}\n\n/** \n * EventAdapter 对象\n * EventAdapter 通过 plugin 的形式实现多种交互方式的映射\n * @constructor EventAdapter\n */\nclass EventAdapter {\n    constructor(plugin = {}) {\n        this.plugin = getDefaultPlugin();\n        this.use(plugin);\n        this.canvasHandlers = [];\n        this.documentHandlers = [];\n    }\n    use(plugin = {}) {\n        const { canvas: ca, document: docObj } = plugin;\n        if(ca) {\n            for(let eventName in ca){\n                if (ca.hasOwnProperty(eventName)) {\n                    this.plugin.canvas[eventName] = ca[eventName];\n                }\n            }\n        }\n        if(docObj) {\n            for(let eventName in docObj){\n                if (docObj.hasOwnProperty(eventName)) {\n                    this.plugin.document[eventName] = docObj[eventName];\n                }\n            }\n        }\n    }\n\n    apply(jflow) {\n        const { canvas: ca, document: docObj } = this.plugin;\n        const canvas = jflow.canvas;\n        for(let eventName in ca){\n            const handler = ca[eventName];\n            function handlerWrapperd (e) {\n                handler(e, jflow);\n            }\n            canvas.addEventListener(eventName, handlerWrapperd)\n            this.canvasHandlers.push({\n                eventName,\n                handlerWrapperd\n            });\n        }\n        for(let eventName in docObj){\n            const handler = docObj[eventName];\n            function handlerWrapperd (e) {\n                handler(e, jflow);\n            }\n            document.addEventListener(eventName, handlerWrapperd)\n            this.documentHandlers.push({\n                eventName,\n                handlerWrapperd\n            });\n        }\n    }\n\n    unload(jflow) {\n        const canvas = jflow.canvas;\n        this.canvasHandlers.forEach(({ eventName, handlerWrapperd }) => {\n            canvas.removeEventListener(eventName, handlerWrapperd);\n        });\n        this.documentHandlers.forEach(({ eventName, handlerWrapperd }) => {\n            document.removeEventListener(eventName, handlerWrapperd);\n        })\n    }\n}\n\nexport default EventAdapter;\n"],"file":"adapter.js"}