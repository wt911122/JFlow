{"version":3,"file":"jflow.min.js","sources":["../src/core/utils/canvas.js","../node_modules/bezier-js/src/utils.js","../node_modules/bezier-js/src/poly-bezier.js","../node_modules/bezier-js/src/bezier.js","../src/core/utils/constance.js","../src/core/utils/functions.js","../src/core/instance/instance.js","../src/core/instance/node.js","../src/core/instance/ghostNode.js","../src/core/instance/nodeWeakMap.js","../src/core/instance/stack.js","../src/core/instance/stackMixin.js","../src/core/instance/layoutMixin.js","../src/core/anime/animeMixin.js","../src/core/miniMap/minimap-mixin.js","../src/core/scrollbar/scrollbarMixin.js","../src/core/flow/schedule.js","../src/core/events/index.js","../src/core/events/adapter.js","../src/core/instance/groupFactory.js","../src/core/instance/shapes/point.js","../src/core/instance/shapes/rectangle.js","../src/core/instance/shapes/capsule.js","../src/core/instance/shapes/capsule-vertical.js","../src/core/instance/shapes/rhombus.js","../src/core/instance/shapes/diamond.js","../src/core/instance/shapes/diamond-vertical.js","../src/core/instance/groups/scroll-group.js","../src/core/events/commonAdapter.js","../src/core/instance/base-link.js","../src/core/instance/shapes/shadow-cache.js","../src/core/instance/elements/text.js","../src/core/instance/image.js","../src/core/instance/shadowDom.js","../src/core/instance/link.js","../src/core/instance/poly-link.js","../src/core/instance/bezier-link.js","../src/core/layout/linear-layout.js","../src/core/layout/low-code-types/baseNode.js","../src/core/layout/low-code-layout.js","../src/core/layout/er-layout/er-node.js","../src/core/layout/er-layout/er-layout.js","../src/core/instance/text-group/base/constants.js","../src/core/instance/text-group/base/shadow-input.js","../src/core/instance/text-group/base/caret.js","../src/core/instance/text-group/storage/index.js","../src/core/instance/text-group/utils.js","../src/core/instance/text-group/base/range.js","../src/core/instance/text-group/undoredo.js","../src/core/instance/text-group/command/base.js","../src/core/instance/text-group/command/movement.js","../src/core/instance/text-group/command/input.js","../src/core/instance/text-group/command/mouse.js","../src/core/instance/text-group/command/shift.js","../src/core/instance/text-group/command/ctrl.js","../src/core/instance/text-group/command/undoredo.js","../src/core/instance/text-group/text-group.js","../src/core/instance/text.js","../src/core/flow/index.js","../src/core/instance/messageMixin.js","../src/index.js"],"sourcesContent":["\n/**\n * @typedef {Object} CanvasMeta\n * @property {Element} canvas - canvas 元素\n * @property {number} width - 画布宽度\n * @property {number} height - 画布高度\n * @property {number} raw_width - 画布元素宽度\n * @property {number} raw_height - 画布元素高度\n * @property {number} left - 画布距离左端距离\n * @property {number} top - 画布距离顶端距离\n * @property {Context2d} ctx - Context2d\n * @property {number} scale - 当前的像素设备比\n */\n/**\n * 创建一个 canvas 元素\n * @param  {Element} wrapper - dom元素\n * @return {CanvasMeta}\n */\nexport function createCanvas(wrapper) {\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    const { width, height, left, top } = wrapper.getBoundingClientRect();\n    canvas.style.width = width + \"px\";\n    canvas.style.height = height + \"px\";\n    canvas.style.userSelect = 'none';\n    const scale = window.devicePixelRatio;\n    canvas.width = Math.floor(width * scale);\n    canvas.height = Math.floor(height * scale);\n\n    if(wrapper) {\n        wrapper.style.position = 'relative';\n        wrapper.style.overflow = 'hidden';\n        wrapper.append(canvas);\n    }\n    return {\n        canvas,\n        width,\n        height,\n        raw_width: canvas.width,\n        raw_height: canvas.height,\n        left,\n        top,\n        ctx,\n        scale,\n    }\n}\n\nexport function resizeCanvas(canvas, wrapper) {\n    const { width, height, left, top } = wrapper.getBoundingClientRect();\n    canvas.style.width = width + \"px\";\n    canvas.style.height = height + \"px\";\n    const scale = window.devicePixelRatio;\n    canvas.width = Math.floor(width * scale);\n    canvas.height = Math.floor(height * scale);\n    return {\n        width,\n        height,\n        raw_width: canvas.width,\n        raw_height: canvas.height,\n    }\n}\n\nconst caheCanvas = document.createElement('canvas');\ncaheCanvas.width = 1;\ncaheCanvas.height = 1;\nconst caheCanvasctx = caheCanvas.getContext('2d');\nconst scale = window.devicePixelRatio;\ncaheCanvasctx.scale(scale, scale);\n\n/**\n * 在离线canvas上绘制元素\n * @param  {render} render - 绘图函数\n */\nexport function requestCacheCanvas(render) {\n    caheCanvasctx.clearRect(0,0,5,5);\n    caheCanvasctx.save();\n    render(caheCanvasctx);\n    caheCanvasctx.restore();\n    caheCanvasctx.clearRect(0,0,5,5);\n}\n\nexport function listenOnDevicePixelRatio(callback, destroyHandler) {\n    const target = matchMedia(\n        `(resolution: ${window.devicePixelRatio}dppx)`\n    );\n    function onChange() {\n      console.log(\"devicePixelRatio changed: \" + window.devicePixelRatio);\n      callback(window.devicePixelRatio);\n      listenOnDevicePixelRatio(callback, destroyHandler);\n    }\n    destroyHandler(() => {\n        console.log('remove devicePixelRatio event handler')\n        target.removeEventListener(\"change\", onChange, { once: true });\n    })\n    target.addEventListener(\"change\", onChange, { once: true });\n}","import { Bezier } from \"./bezier.js\";\n\n// math-inlining.\nconst { abs, cos, sin, acos, atan2, sqrt, pow } = Math;\n\n// cube root function yielding real roots\nfunction crt(v) {\n  return v < 0 ? -pow(-v, 1 / 3) : pow(v, 1 / 3);\n}\n\n// trig constants\nconst pi = Math.PI,\n  tau = 2 * pi,\n  quart = pi / 2,\n  // float precision significant decimal\n  epsilon = 0.000001,\n  // extremas used in bbox calculation and similar algorithms\n  nMax = Number.MAX_SAFE_INTEGER || 9007199254740991,\n  nMin = Number.MIN_SAFE_INTEGER || -9007199254740991,\n  // a zero coordinate, which is surprisingly useful\n  ZERO = { x: 0, y: 0, z: 0 };\n\n// Bezier utility functions\nconst utils = {\n  // Legendre-Gauss abscissae with n=24 (x_i values, defined at i=n as the roots of the nth order Legendre polynomial Pn(x))\n  Tvalues: [\n    -0.0640568928626056260850430826247450385909,\n    0.0640568928626056260850430826247450385909,\n    -0.1911188674736163091586398207570696318404,\n    0.1911188674736163091586398207570696318404,\n    -0.3150426796961633743867932913198102407864,\n    0.3150426796961633743867932913198102407864,\n    -0.4337935076260451384870842319133497124524,\n    0.4337935076260451384870842319133497124524,\n    -0.5454214713888395356583756172183723700107,\n    0.5454214713888395356583756172183723700107,\n    -0.6480936519369755692524957869107476266696,\n    0.6480936519369755692524957869107476266696,\n    -0.7401241915785543642438281030999784255232,\n    0.7401241915785543642438281030999784255232,\n    -0.8200019859739029219539498726697452080761,\n    0.8200019859739029219539498726697452080761,\n    -0.8864155270044010342131543419821967550873,\n    0.8864155270044010342131543419821967550873,\n    -0.9382745520027327585236490017087214496548,\n    0.9382745520027327585236490017087214496548,\n    -0.9747285559713094981983919930081690617411,\n    0.9747285559713094981983919930081690617411,\n    -0.9951872199970213601799974097007368118745,\n    0.9951872199970213601799974097007368118745,\n  ],\n\n  // Legendre-Gauss weights with n=24 (w_i values, defined by a function linked to in the Bezier primer article)\n  Cvalues: [\n    0.1279381953467521569740561652246953718517,\n    0.1279381953467521569740561652246953718517,\n    0.1258374563468282961213753825111836887264,\n    0.1258374563468282961213753825111836887264,\n    0.121670472927803391204463153476262425607,\n    0.121670472927803391204463153476262425607,\n    0.1155056680537256013533444839067835598622,\n    0.1155056680537256013533444839067835598622,\n    0.1074442701159656347825773424466062227946,\n    0.1074442701159656347825773424466062227946,\n    0.0976186521041138882698806644642471544279,\n    0.0976186521041138882698806644642471544279,\n    0.086190161531953275917185202983742667185,\n    0.086190161531953275917185202983742667185,\n    0.0733464814110803057340336152531165181193,\n    0.0733464814110803057340336152531165181193,\n    0.0592985849154367807463677585001085845412,\n    0.0592985849154367807463677585001085845412,\n    0.0442774388174198061686027482113382288593,\n    0.0442774388174198061686027482113382288593,\n    0.0285313886289336631813078159518782864491,\n    0.0285313886289336631813078159518782864491,\n    0.0123412297999871995468056670700372915759,\n    0.0123412297999871995468056670700372915759,\n  ],\n\n  arcfn: function (t, derivativeFn) {\n    const d = derivativeFn(t);\n    let l = d.x * d.x + d.y * d.y;\n    if (typeof d.z !== \"undefined\") {\n      l += d.z * d.z;\n    }\n    return sqrt(l);\n  },\n\n  compute: function (t, points, _3d) {\n    // shortcuts\n    if (t === 0) {\n      points[0].t = 0;\n      return points[0];\n    }\n\n    const order = points.length - 1;\n\n    if (t === 1) {\n      points[order].t = 1;\n      return points[order];\n    }\n\n    const mt = 1 - t;\n    let p = points;\n\n    // constant?\n    if (order === 0) {\n      points[0].t = t;\n      return points[0];\n    }\n\n    // linear?\n    if (order === 1) {\n      const ret = {\n        x: mt * p[0].x + t * p[1].x,\n        y: mt * p[0].y + t * p[1].y,\n        t: t,\n      };\n      if (_3d) {\n        ret.z = mt * p[0].z + t * p[1].z;\n      }\n      return ret;\n    }\n\n    // quadratic/cubic curve?\n    if (order < 4) {\n      let mt2 = mt * mt,\n        t2 = t * t,\n        a,\n        b,\n        c,\n        d = 0;\n      if (order === 2) {\n        p = [p[0], p[1], p[2], ZERO];\n        a = mt2;\n        b = mt * t * 2;\n        c = t2;\n      } else if (order === 3) {\n        a = mt2 * mt;\n        b = mt2 * t * 3;\n        c = mt * t2 * 3;\n        d = t * t2;\n      }\n      const ret = {\n        x: a * p[0].x + b * p[1].x + c * p[2].x + d * p[3].x,\n        y: a * p[0].y + b * p[1].y + c * p[2].y + d * p[3].y,\n        t: t,\n      };\n      if (_3d) {\n        ret.z = a * p[0].z + b * p[1].z + c * p[2].z + d * p[3].z;\n      }\n      return ret;\n    }\n\n    // higher order curves: use de Casteljau's computation\n    const dCpts = JSON.parse(JSON.stringify(points));\n    while (dCpts.length > 1) {\n      for (let i = 0; i < dCpts.length - 1; i++) {\n        dCpts[i] = {\n          x: dCpts[i].x + (dCpts[i + 1].x - dCpts[i].x) * t,\n          y: dCpts[i].y + (dCpts[i + 1].y - dCpts[i].y) * t,\n        };\n        if (typeof dCpts[i].z !== \"undefined\") {\n          dCpts[i] = dCpts[i].z + (dCpts[i + 1].z - dCpts[i].z) * t;\n        }\n      }\n      dCpts.splice(dCpts.length - 1, 1);\n    }\n    dCpts[0].t = t;\n    return dCpts[0];\n  },\n\n  computeWithRatios: function (t, points, ratios, _3d) {\n    const mt = 1 - t,\n      r = ratios,\n      p = points;\n\n    let f1 = r[0],\n      f2 = r[1],\n      f3 = r[2],\n      f4 = r[3],\n      d;\n\n    // spec for linear\n    f1 *= mt;\n    f2 *= t;\n\n    if (p.length === 2) {\n      d = f1 + f2;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y) / d,\n        z: !_3d ? false : (f1 * p[0].z + f2 * p[1].z) / d,\n        t: t,\n      };\n    }\n\n    // upgrade to quadratic\n    f1 *= mt;\n    f2 *= 2 * mt;\n    f3 *= t * t;\n\n    if (p.length === 3) {\n      d = f1 + f2 + f3;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y) / d,\n        z: !_3d ? false : (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z) / d,\n        t: t,\n      };\n    }\n\n    // upgrade to cubic\n    f1 *= mt;\n    f2 *= 1.5 * mt;\n    f3 *= 3 * mt;\n    f4 *= t * t * t;\n\n    if (p.length === 4) {\n      d = f1 + f2 + f3 + f4;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x + f4 * p[3].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y + f4 * p[3].y) / d,\n        z: !_3d\n          ? false\n          : (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z + f4 * p[3].z) / d,\n        t: t,\n      };\n    }\n  },\n\n  derive: function (points, _3d) {\n    const dpoints = [];\n    for (let p = points, d = p.length, c = d - 1; d > 1; d--, c--) {\n      const list = [];\n      for (let j = 0, dpt; j < c; j++) {\n        dpt = {\n          x: c * (p[j + 1].x - p[j].x),\n          y: c * (p[j + 1].y - p[j].y),\n        };\n        if (_3d) {\n          dpt.z = c * (p[j + 1].z - p[j].z);\n        }\n        list.push(dpt);\n      }\n      dpoints.push(list);\n      p = list;\n    }\n    return dpoints;\n  },\n\n  between: function (v, m, M) {\n    return (\n      (m <= v && v <= M) ||\n      utils.approximately(v, m) ||\n      utils.approximately(v, M)\n    );\n  },\n\n  approximately: function (a, b, precision) {\n    return abs(a - b) <= (precision || epsilon);\n  },\n\n  length: function (derivativeFn) {\n    const z = 0.5,\n      len = utils.Tvalues.length;\n\n    let sum = 0;\n\n    for (let i = 0, t; i < len; i++) {\n      t = z * utils.Tvalues[i] + z;\n      sum += utils.Cvalues[i] * utils.arcfn(t, derivativeFn);\n    }\n    return z * sum;\n  },\n\n  map: function (v, ds, de, ts, te) {\n    const d1 = de - ds,\n      d2 = te - ts,\n      v2 = v - ds,\n      r = v2 / d1;\n    return ts + d2 * r;\n  },\n\n  lerp: function (r, v1, v2) {\n    const ret = {\n      x: v1.x + r * (v2.x - v1.x),\n      y: v1.y + r * (v2.y - v1.y),\n    };\n    if (v1.z !== undefined && v2.z !== undefined) {\n      ret.z = v1.z + r * (v2.z - v1.z);\n    }\n    return ret;\n  },\n\n  pointToString: function (p) {\n    let s = p.x + \"/\" + p.y;\n    if (typeof p.z !== \"undefined\") {\n      s += \"/\" + p.z;\n    }\n    return s;\n  },\n\n  pointsToString: function (points) {\n    return \"[\" + points.map(utils.pointToString).join(\", \") + \"]\";\n  },\n\n  copy: function (obj) {\n    return JSON.parse(JSON.stringify(obj));\n  },\n\n  angle: function (o, v1, v2) {\n    const dx1 = v1.x - o.x,\n      dy1 = v1.y - o.y,\n      dx2 = v2.x - o.x,\n      dy2 = v2.y - o.y,\n      cross = dx1 * dy2 - dy1 * dx2,\n      dot = dx1 * dx2 + dy1 * dy2;\n    return atan2(cross, dot);\n  },\n\n  // round as string, to avoid rounding errors\n  round: function (v, d) {\n    const s = \"\" + v;\n    const pos = s.indexOf(\".\");\n    return parseFloat(s.substring(0, pos + 1 + d));\n  },\n\n  dist: function (p1, p2) {\n    const dx = p1.x - p2.x,\n      dy = p1.y - p2.y;\n    return sqrt(dx * dx + dy * dy);\n  },\n\n  closest: function (LUT, point) {\n    let mdist = pow(2, 63),\n      mpos,\n      d;\n    LUT.forEach(function (p, idx) {\n      d = utils.dist(point, p);\n      if (d < mdist) {\n        mdist = d;\n        mpos = idx;\n      }\n    });\n    return { mdist: mdist, mpos: mpos };\n  },\n\n  abcratio: function (t, n) {\n    // see ratio(t) note on http://pomax.github.io/bezierinfo/#abc\n    if (n !== 2 && n !== 3) {\n      return false;\n    }\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    } else if (t === 0 || t === 1) {\n      return t;\n    }\n    const bottom = pow(t, n) + pow(1 - t, n),\n      top = bottom - 1;\n    return abs(top / bottom);\n  },\n\n  projectionratio: function (t, n) {\n    // see u(t) note on http://pomax.github.io/bezierinfo/#abc\n    if (n !== 2 && n !== 3) {\n      return false;\n    }\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    } else if (t === 0 || t === 1) {\n      return t;\n    }\n    const top = pow(1 - t, n),\n      bottom = pow(t, n) + top;\n    return top / bottom;\n  },\n\n  lli8: function (x1, y1, x2, y2, x3, y3, x4, y4) {\n    const nx =\n        (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),\n      ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),\n      d = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n    if (d == 0) {\n      return false;\n    }\n    return { x: nx / d, y: ny / d };\n  },\n\n  lli4: function (p1, p2, p3, p4) {\n    const x1 = p1.x,\n      y1 = p1.y,\n      x2 = p2.x,\n      y2 = p2.y,\n      x3 = p3.x,\n      y3 = p3.y,\n      x4 = p4.x,\n      y4 = p4.y;\n    return utils.lli8(x1, y1, x2, y2, x3, y3, x4, y4);\n  },\n\n  lli: function (v1, v2) {\n    return utils.lli4(v1, v1.c, v2, v2.c);\n  },\n\n  makeline: function (p1, p2) {\n    const x1 = p1.x,\n      y1 = p1.y,\n      x2 = p2.x,\n      y2 = p2.y,\n      dx = (x2 - x1) / 3,\n      dy = (y2 - y1) / 3;\n    return new Bezier(\n      x1,\n      y1,\n      x1 + dx,\n      y1 + dy,\n      x1 + 2 * dx,\n      y1 + 2 * dy,\n      x2,\n      y2\n    );\n  },\n\n  findbbox: function (sections) {\n    let mx = nMax,\n      my = nMax,\n      MX = nMin,\n      MY = nMin;\n    sections.forEach(function (s) {\n      const bbox = s.bbox();\n      if (mx > bbox.x.min) mx = bbox.x.min;\n      if (my > bbox.y.min) my = bbox.y.min;\n      if (MX < bbox.x.max) MX = bbox.x.max;\n      if (MY < bbox.y.max) MY = bbox.y.max;\n    });\n    return {\n      x: { min: mx, mid: (mx + MX) / 2, max: MX, size: MX - mx },\n      y: { min: my, mid: (my + MY) / 2, max: MY, size: MY - my },\n    };\n  },\n\n  shapeintersections: function (\n    s1,\n    bbox1,\n    s2,\n    bbox2,\n    curveIntersectionThreshold\n  ) {\n    if (!utils.bboxoverlap(bbox1, bbox2)) return [];\n    const intersections = [];\n    const a1 = [s1.startcap, s1.forward, s1.back, s1.endcap];\n    const a2 = [s2.startcap, s2.forward, s2.back, s2.endcap];\n    a1.forEach(function (l1) {\n      if (l1.virtual) return;\n      a2.forEach(function (l2) {\n        if (l2.virtual) return;\n        const iss = l1.intersects(l2, curveIntersectionThreshold);\n        if (iss.length > 0) {\n          iss.c1 = l1;\n          iss.c2 = l2;\n          iss.s1 = s1;\n          iss.s2 = s2;\n          intersections.push(iss);\n        }\n      });\n    });\n    return intersections;\n  },\n\n  makeshape: function (forward, back, curveIntersectionThreshold) {\n    const bpl = back.points.length;\n    const fpl = forward.points.length;\n    const start = utils.makeline(back.points[bpl - 1], forward.points[0]);\n    const end = utils.makeline(forward.points[fpl - 1], back.points[0]);\n    const shape = {\n      startcap: start,\n      forward: forward,\n      back: back,\n      endcap: end,\n      bbox: utils.findbbox([start, forward, back, end]),\n    };\n    shape.intersections = function (s2) {\n      return utils.shapeintersections(\n        shape,\n        shape.bbox,\n        s2,\n        s2.bbox,\n        curveIntersectionThreshold\n      );\n    };\n    return shape;\n  },\n\n  getminmax: function (curve, d, list) {\n    if (!list) return { min: 0, max: 0 };\n    let min = nMax,\n      max = nMin,\n      t,\n      c;\n    if (list.indexOf(0) === -1) {\n      list = [0].concat(list);\n    }\n    if (list.indexOf(1) === -1) {\n      list.push(1);\n    }\n    for (let i = 0, len = list.length; i < len; i++) {\n      t = list[i];\n      c = curve.get(t);\n      if (c[d] < min) {\n        min = c[d];\n      }\n      if (c[d] > max) {\n        max = c[d];\n      }\n    }\n    return { min: min, mid: (min + max) / 2, max: max, size: max - min };\n  },\n\n  align: function (points, line) {\n    const tx = line.p1.x,\n      ty = line.p1.y,\n      a = -atan2(line.p2.y - ty, line.p2.x - tx),\n      d = function (v) {\n        return {\n          x: (v.x - tx) * cos(a) - (v.y - ty) * sin(a),\n          y: (v.x - tx) * sin(a) + (v.y - ty) * cos(a),\n        };\n      };\n    return points.map(d);\n  },\n\n  roots: function (points, line) {\n    line = line || { p1: { x: 0, y: 0 }, p2: { x: 1, y: 0 } };\n\n    const order = points.length - 1;\n    const aligned = utils.align(points, line);\n    const reduce = function (t) {\n      return 0 <= t && t <= 1;\n    };\n\n    if (order === 2) {\n      const a = aligned[0].y,\n        b = aligned[1].y,\n        c = aligned[2].y,\n        d = a - 2 * b + c;\n      if (d !== 0) {\n        const m1 = -sqrt(b * b - a * c),\n          m2 = -a + b,\n          v1 = -(m1 + m2) / d,\n          v2 = -(-m1 + m2) / d;\n        return [v1, v2].filter(reduce);\n      } else if (b !== c && d === 0) {\n        return [(2 * b - c) / (2 * b - 2 * c)].filter(reduce);\n      }\n      return [];\n    }\n\n    // see http://www.trans4mind.com/personal_development/mathematics/polynomials/cubicAlgebra.htm\n    const pa = aligned[0].y,\n      pb = aligned[1].y,\n      pc = aligned[2].y,\n      pd = aligned[3].y;\n\n    let d = -pa + 3 * pb - 3 * pc + pd,\n      a = 3 * pa - 6 * pb + 3 * pc,\n      b = -3 * pa + 3 * pb,\n      c = pa;\n\n    if (utils.approximately(d, 0)) {\n      // this is not a cubic curve.\n      if (utils.approximately(a, 0)) {\n        // in fact, this is not a quadratic curve either.\n        if (utils.approximately(b, 0)) {\n          // in fact in fact, there are no solutions.\n          return [];\n        }\n        // linear solution:\n        return [-c / b].filter(reduce);\n      }\n      // quadratic solution:\n      const q = sqrt(b * b - 4 * a * c),\n        a2 = 2 * a;\n      return [(q - b) / a2, (-b - q) / a2].filter(reduce);\n    }\n\n    // at this point, we know we need a cubic solution:\n\n    a /= d;\n    b /= d;\n    c /= d;\n\n    const p = (3 * b - a * a) / 3,\n      p3 = p / 3,\n      q = (2 * a * a * a - 9 * a * b + 27 * c) / 27,\n      q2 = q / 2,\n      discriminant = q2 * q2 + p3 * p3 * p3;\n\n    let u1, v1, x1, x2, x3;\n    if (discriminant < 0) {\n      const mp3 = -p / 3,\n        mp33 = mp3 * mp3 * mp3,\n        r = sqrt(mp33),\n        t = -q / (2 * r),\n        cosphi = t < -1 ? -1 : t > 1 ? 1 : t,\n        phi = acos(cosphi),\n        crtr = crt(r),\n        t1 = 2 * crtr;\n      x1 = t1 * cos(phi / 3) - a / 3;\n      x2 = t1 * cos((phi + tau) / 3) - a / 3;\n      x3 = t1 * cos((phi + 2 * tau) / 3) - a / 3;\n      return [x1, x2, x3].filter(reduce);\n    } else if (discriminant === 0) {\n      u1 = q2 < 0 ? crt(-q2) : -crt(q2);\n      x1 = 2 * u1 - a / 3;\n      x2 = -u1 - a / 3;\n      return [x1, x2].filter(reduce);\n    } else {\n      const sd = sqrt(discriminant);\n      u1 = crt(-q2 + sd);\n      v1 = crt(q2 + sd);\n      return [u1 - v1 - a / 3].filter(reduce);\n    }\n  },\n\n  droots: function (p) {\n    // quadratic roots are easy\n    if (p.length === 3) {\n      const a = p[0],\n        b = p[1],\n        c = p[2],\n        d = a - 2 * b + c;\n      if (d !== 0) {\n        const m1 = -sqrt(b * b - a * c),\n          m2 = -a + b,\n          v1 = -(m1 + m2) / d,\n          v2 = -(-m1 + m2) / d;\n        return [v1, v2];\n      } else if (b !== c && d === 0) {\n        return [(2 * b - c) / (2 * (b - c))];\n      }\n      return [];\n    }\n\n    // linear roots are even easier\n    if (p.length === 2) {\n      const a = p[0],\n        b = p[1];\n      if (a !== b) {\n        return [a / (a - b)];\n      }\n      return [];\n    }\n\n    return [];\n  },\n\n  curvature: function (t, d1, d2, _3d, kOnly) {\n    let num,\n      dnm,\n      adk,\n      dk,\n      k = 0,\n      r = 0;\n\n    //\n    // We're using the following formula for curvature:\n    //\n    //              x'y\" - y'x\"\n    //   k(t) = ------------------\n    //           (x'² + y'²)^(3/2)\n    //\n    // from https://en.wikipedia.org/wiki/Radius_of_curvature#Definition\n    //\n    // With it corresponding 3D counterpart:\n    //\n    //          sqrt( (y'z\" - y\"z')² + (z'x\" - z\"x')² + (x'y\" - x\"y')²)\n    //   k(t) = -------------------------------------------------------\n    //                     (x'² + y'² + z'²)^(3/2)\n    //\n\n    const d = utils.compute(t, d1);\n    const dd = utils.compute(t, d2);\n    const qdsum = d.x * d.x + d.y * d.y;\n\n    if (_3d) {\n      num = sqrt(\n        pow(d.y * dd.z - dd.y * d.z, 2) +\n          pow(d.z * dd.x - dd.z * d.x, 2) +\n          pow(d.x * dd.y - dd.x * d.y, 2)\n      );\n      dnm = pow(qdsum + d.z * d.z, 3 / 2);\n    } else {\n      num = d.x * dd.y - d.y * dd.x;\n      dnm = pow(qdsum, 3 / 2);\n    }\n\n    if (num === 0 || dnm === 0) {\n      return { k: 0, r: 0 };\n    }\n\n    k = num / dnm;\n    r = dnm / num;\n\n    // We're also computing the derivative of kappa, because\n    // there is value in knowing the rate of change for the\n    // curvature along the curve. And we're just going to\n    // ballpark it based on an epsilon.\n    if (!kOnly) {\n      // compute k'(t) based on the interval before, and after it,\n      // to at least try to not introduce forward/backward pass bias.\n      const pk = utils.curvature(t - 0.001, d1, d2, _3d, true).k;\n      const nk = utils.curvature(t + 0.001, d1, d2, _3d, true).k;\n      dk = (nk - k + (k - pk)) / 2;\n      adk = (abs(nk - k) + abs(k - pk)) / 2;\n    }\n\n    return { k: k, r: r, dk: dk, adk: adk };\n  },\n\n  inflections: function (points) {\n    if (points.length < 4) return [];\n\n    // FIXME: TODO: add in inflection abstraction for quartic+ curves?\n\n    const p = utils.align(points, { p1: points[0], p2: points.slice(-1)[0] }),\n      a = p[2].x * p[1].y,\n      b = p[3].x * p[1].y,\n      c = p[1].x * p[2].y,\n      d = p[3].x * p[2].y,\n      v1 = 18 * (-3 * a + 2 * b + 3 * c - d),\n      v2 = 18 * (3 * a - b - 3 * c),\n      v3 = 18 * (c - a);\n\n    if (utils.approximately(v1, 0)) {\n      if (!utils.approximately(v2, 0)) {\n        let t = -v3 / v2;\n        if (0 <= t && t <= 1) return [t];\n      }\n      return [];\n    }\n\n    const trm = v2 * v2 - 4 * v1 * v3,\n      sq = Math.sqrt(trm),\n      d2 = 2 * v1;\n\n    if (utils.approximately(d2, 0)) return [];\n\n    return [(sq - v2) / d2, -(v2 + sq) / d2].filter(function (r) {\n      return 0 <= r && r <= 1;\n    });\n  },\n\n  bboxoverlap: function (b1, b2) {\n    const dims = [\"x\", \"y\"],\n      len = dims.length;\n\n    for (let i = 0, dim, l, t, d; i < len; i++) {\n      dim = dims[i];\n      l = b1[dim].mid;\n      t = b2[dim].mid;\n      d = (b1[dim].size + b2[dim].size) / 2;\n      if (abs(l - t) >= d) return false;\n    }\n    return true;\n  },\n\n  expandbox: function (bbox, _bbox) {\n    if (_bbox.x.min < bbox.x.min) {\n      bbox.x.min = _bbox.x.min;\n    }\n    if (_bbox.y.min < bbox.y.min) {\n      bbox.y.min = _bbox.y.min;\n    }\n    if (_bbox.z && _bbox.z.min < bbox.z.min) {\n      bbox.z.min = _bbox.z.min;\n    }\n    if (_bbox.x.max > bbox.x.max) {\n      bbox.x.max = _bbox.x.max;\n    }\n    if (_bbox.y.max > bbox.y.max) {\n      bbox.y.max = _bbox.y.max;\n    }\n    if (_bbox.z && _bbox.z.max > bbox.z.max) {\n      bbox.z.max = _bbox.z.max;\n    }\n    bbox.x.mid = (bbox.x.min + bbox.x.max) / 2;\n    bbox.y.mid = (bbox.y.min + bbox.y.max) / 2;\n    if (bbox.z) {\n      bbox.z.mid = (bbox.z.min + bbox.z.max) / 2;\n    }\n    bbox.x.size = bbox.x.max - bbox.x.min;\n    bbox.y.size = bbox.y.max - bbox.y.min;\n    if (bbox.z) {\n      bbox.z.size = bbox.z.max - bbox.z.min;\n    }\n  },\n\n  pairiteration: function (c1, c2, curveIntersectionThreshold) {\n    const c1b = c1.bbox(),\n      c2b = c2.bbox(),\n      r = 100000,\n      threshold = curveIntersectionThreshold || 0.5;\n\n    if (\n      c1b.x.size + c1b.y.size < threshold &&\n      c2b.x.size + c2b.y.size < threshold\n    ) {\n      return [\n        (((r * (c1._t1 + c1._t2)) / 2) | 0) / r +\n          \"/\" +\n          (((r * (c2._t1 + c2._t2)) / 2) | 0) / r,\n      ];\n    }\n\n    let cc1 = c1.split(0.5),\n      cc2 = c2.split(0.5),\n      pairs = [\n        { left: cc1.left, right: cc2.left },\n        { left: cc1.left, right: cc2.right },\n        { left: cc1.right, right: cc2.right },\n        { left: cc1.right, right: cc2.left },\n      ];\n\n    pairs = pairs.filter(function (pair) {\n      return utils.bboxoverlap(pair.left.bbox(), pair.right.bbox());\n    });\n\n    let results = [];\n\n    if (pairs.length === 0) return results;\n\n    pairs.forEach(function (pair) {\n      results = results.concat(\n        utils.pairiteration(pair.left, pair.right, threshold)\n      );\n    });\n\n    results = results.filter(function (v, i) {\n      return results.indexOf(v) === i;\n    });\n\n    return results;\n  },\n\n  getccenter: function (p1, p2, p3) {\n    const dx1 = p2.x - p1.x,\n      dy1 = p2.y - p1.y,\n      dx2 = p3.x - p2.x,\n      dy2 = p3.y - p2.y,\n      dx1p = dx1 * cos(quart) - dy1 * sin(quart),\n      dy1p = dx1 * sin(quart) + dy1 * cos(quart),\n      dx2p = dx2 * cos(quart) - dy2 * sin(quart),\n      dy2p = dx2 * sin(quart) + dy2 * cos(quart),\n      // chord midpoints\n      mx1 = (p1.x + p2.x) / 2,\n      my1 = (p1.y + p2.y) / 2,\n      mx2 = (p2.x + p3.x) / 2,\n      my2 = (p2.y + p3.y) / 2,\n      // midpoint offsets\n      mx1n = mx1 + dx1p,\n      my1n = my1 + dy1p,\n      mx2n = mx2 + dx2p,\n      my2n = my2 + dy2p,\n      // intersection of these lines:\n      arc = utils.lli8(mx1, my1, mx1n, my1n, mx2, my2, mx2n, my2n),\n      r = utils.dist(arc, p1);\n\n    // arc start/end values, over mid point:\n    let s = atan2(p1.y - arc.y, p1.x - arc.x),\n      m = atan2(p2.y - arc.y, p2.x - arc.x),\n      e = atan2(p3.y - arc.y, p3.x - arc.x),\n      _;\n\n    // determine arc direction (cw/ccw correction)\n    if (s < e) {\n      // if s<m<e, arc(s, e)\n      // if m<s<e, arc(e, s + tau)\n      // if s<e<m, arc(e, s + tau)\n      if (s > m || m > e) {\n        s += tau;\n      }\n      if (s > e) {\n        _ = e;\n        e = s;\n        s = _;\n      }\n    } else {\n      // if e<m<s, arc(e, s)\n      // if m<e<s, arc(s, e + tau)\n      // if e<s<m, arc(s, e + tau)\n      if (e < m && m < s) {\n        _ = e;\n        e = s;\n        s = _;\n      } else {\n        e += tau;\n      }\n    }\n    // assign and done.\n    arc.s = s;\n    arc.e = e;\n    arc.r = r;\n    return arc;\n  },\n\n  numberSort: function (a, b) {\n    return a - b;\n  },\n};\n\nexport { utils };\n","import { utils } from \"./utils.js\";\n\n/**\n * Poly Bezier\n * @param {[type]} curves [description]\n */\nclass PolyBezier {\n  constructor(curves) {\n    this.curves = [];\n    this._3d = false;\n    if (!!curves) {\n      this.curves = curves;\n      this._3d = this.curves[0]._3d;\n    }\n  }\n\n  valueOf() {\n    return this.toString();\n  }\n\n  toString() {\n    return (\n      \"[\" +\n      this.curves\n        .map(function (curve) {\n          return utils.pointsToString(curve.points);\n        })\n        .join(\", \") +\n      \"]\"\n    );\n  }\n\n  addCurve(curve) {\n    this.curves.push(curve);\n    this._3d = this._3d || curve._3d;\n  }\n\n  length() {\n    return this.curves\n      .map(function (v) {\n        return v.length();\n      })\n      .reduce(function (a, b) {\n        return a + b;\n      });\n  }\n\n  curve(idx) {\n    return this.curves[idx];\n  }\n\n  bbox() {\n    const c = this.curves;\n    var bbox = c[0].bbox();\n    for (var i = 1; i < c.length; i++) {\n      utils.expandbox(bbox, c[i].bbox());\n    }\n    return bbox;\n  }\n\n  offset(d) {\n    const offset = [];\n    this.curves.forEach(function (v) {\n      offset.push(...v.offset(d));\n    });\n    return new PolyBezier(offset);\n  }\n}\n\nexport { PolyBezier };\n","/**\n  A javascript Bezier curve library by Pomax.\n\n  Based on http://pomax.github.io/bezierinfo\n\n  This code is MIT licensed.\n**/\n\nimport { utils } from \"./utils.js\";\nimport { PolyBezier } from \"./poly-bezier.js\";\n\n// math-inlining.\nconst { abs, min, max, cos, sin, acos, sqrt } = Math;\nconst pi = Math.PI;\n// a zero coordinate, which is surprisingly useful\nconst ZERO = { x: 0, y: 0, z: 0 };\n\n/**\n * Bezier curve constructor.\n *\n * ...docs pending...\n */\nclass Bezier {\n  constructor(coords) {\n    let args =\n      coords && coords.forEach ? coords : Array.from(arguments).slice();\n    let coordlen = false;\n\n    if (typeof args[0] === \"object\") {\n      coordlen = args.length;\n      const newargs = [];\n      args.forEach(function (point) {\n        [\"x\", \"y\", \"z\"].forEach(function (d) {\n          if (typeof point[d] !== \"undefined\") {\n            newargs.push(point[d]);\n          }\n        });\n      });\n      args = newargs;\n    }\n\n    let higher = false;\n    const len = args.length;\n\n    if (coordlen) {\n      if (coordlen > 4) {\n        if (arguments.length !== 1) {\n          throw new Error(\n            \"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n          );\n        }\n        higher = true;\n      }\n    } else {\n      if (len !== 6 && len !== 8 && len !== 9 && len !== 12) {\n        if (arguments.length !== 1) {\n          throw new Error(\n            \"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n          );\n        }\n      }\n    }\n\n    const _3d = (this._3d =\n      (!higher && (len === 9 || len === 12)) ||\n      (coords && coords[0] && typeof coords[0].z !== \"undefined\"));\n\n    const points = (this.points = []);\n    for (let idx = 0, step = _3d ? 3 : 2; idx < len; idx += step) {\n      var point = {\n        x: args[idx],\n        y: args[idx + 1],\n      };\n      if (_3d) {\n        point.z = args[idx + 2];\n      }\n      points.push(point);\n    }\n    const order = (this.order = points.length - 1);\n\n    const dims = (this.dims = [\"x\", \"y\"]);\n    if (_3d) dims.push(\"z\");\n    this.dimlen = dims.length;\n\n    const aligned = utils.align(points, { p1: points[0], p2: points[order] });\n    this._linear = !aligned.some((p) => abs(p.y) > 0.0001);\n\n    this._lut = [];\n\n    this._t1 = 0;\n    this._t2 = 1;\n    this.update();\n  }\n\n  static quadraticFromPoints(p1, p2, p3, t) {\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    }\n    // shortcuts, although they're really dumb\n    if (t === 0) {\n      return new Bezier(p2, p2, p3);\n    }\n    if (t === 1) {\n      return new Bezier(p1, p2, p2);\n    }\n    // real fitting.\n    const abc = Bezier.getABC(2, p1, p2, p3, t);\n    return new Bezier(p1, abc.A, p3);\n  }\n\n  static cubicFromPoints(S, B, E, t, d1) {\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    }\n    const abc = Bezier.getABC(3, S, B, E, t);\n    if (typeof d1 === \"undefined\") {\n      d1 = utils.dist(B, abc.C);\n    }\n    const d2 = (d1 * (1 - t)) / t;\n\n    const selen = utils.dist(S, E),\n      lx = (E.x - S.x) / selen,\n      ly = (E.y - S.y) / selen,\n      bx1 = d1 * lx,\n      by1 = d1 * ly,\n      bx2 = d2 * lx,\n      by2 = d2 * ly;\n    // derivation of new hull coordinates\n    const e1 = { x: B.x - bx1, y: B.y - by1 },\n      e2 = { x: B.x + bx2, y: B.y + by2 },\n      A = abc.A,\n      v1 = { x: A.x + (e1.x - A.x) / (1 - t), y: A.y + (e1.y - A.y) / (1 - t) },\n      v2 = { x: A.x + (e2.x - A.x) / t, y: A.y + (e2.y - A.y) / t },\n      nc1 = { x: S.x + (v1.x - S.x) / t, y: S.y + (v1.y - S.y) / t },\n      nc2 = {\n        x: E.x + (v2.x - E.x) / (1 - t),\n        y: E.y + (v2.y - E.y) / (1 - t),\n      };\n    // ...done\n    return new Bezier(S, nc1, nc2, E);\n  }\n\n  static getUtils() {\n    return utils;\n  }\n\n  getUtils() {\n    return Bezier.getUtils();\n  }\n\n  static get PolyBezier() {\n    return PolyBezier;\n  }\n\n  valueOf() {\n    return this.toString();\n  }\n\n  toString() {\n    return utils.pointsToString(this.points);\n  }\n\n  toSVG() {\n    if (this._3d) return false;\n    const p = this.points,\n      x = p[0].x,\n      y = p[0].y,\n      s = [\"M\", x, y, this.order === 2 ? \"Q\" : \"C\"];\n    for (let i = 1, last = p.length; i < last; i++) {\n      s.push(p[i].x);\n      s.push(p[i].y);\n    }\n    return s.join(\" \");\n  }\n\n  setRatios(ratios) {\n    if (ratios.length !== this.points.length) {\n      throw new Error(\"incorrect number of ratio values\");\n    }\n    this.ratios = ratios;\n    this._lut = []; //  invalidate any precomputed LUT\n  }\n\n  verify() {\n    const print = this.coordDigest();\n    if (print !== this._print) {\n      this._print = print;\n      this.update();\n    }\n  }\n\n  coordDigest() {\n    return this.points\n      .map(function (c, pos) {\n        return \"\" + pos + c.x + c.y + (c.z ? c.z : 0);\n      })\n      .join(\"\");\n  }\n\n  update() {\n    // invalidate any precomputed LUT\n    this._lut = [];\n    this.dpoints = utils.derive(this.points, this._3d);\n    this.computedirection();\n  }\n\n  computedirection() {\n    const points = this.points;\n    const angle = utils.angle(points[0], points[this.order], points[1]);\n    this.clockwise = angle > 0;\n  }\n\n  length() {\n    return utils.length(this.derivative.bind(this));\n  }\n\n  static getABC(order = 2, S, B, E, t = 0.5) {\n    const u = utils.projectionratio(t, order),\n      um = 1 - u,\n      C = {\n        x: u * S.x + um * E.x,\n        y: u * S.y + um * E.y,\n      },\n      s = utils.abcratio(t, order),\n      A = {\n        x: B.x + (B.x - C.x) / s,\n        y: B.y + (B.y - C.y) / s,\n      };\n    return { A, B, C, S, E };\n  }\n\n  getABC(t, B) {\n    B = B || this.get(t);\n    let S = this.points[0];\n    let E = this.points[this.order];\n    return Bezier.getABC(this.order, S, B, E, t);\n  }\n\n  getLUT(steps) {\n    this.verify();\n    steps = steps || 100;\n    if (this._lut.length === steps) {\n      return this._lut;\n    }\n    this._lut = [];\n    // We want a range from 0 to 1 inclusive, so\n    // we decrement and then use <= rather than <:\n    steps--;\n    for (let i = 0, p, t; i < steps; i++) {\n      t = i / (steps - 1);\n      p = this.compute(t);\n      p.t = t;\n      this._lut.push(p);\n    }\n    return this._lut;\n  }\n\n  on(point, error) {\n    error = error || 5;\n    const lut = this.getLUT(),\n      hits = [];\n    for (let i = 0, c, t = 0; i < lut.length; i++) {\n      c = lut[i];\n      if (utils.dist(c, point) < error) {\n        hits.push(c);\n        t += i / lut.length;\n      }\n    }\n    if (!hits.length) return false;\n    return (t /= hits.length);\n  }\n\n  project(point) {\n    // step 1: coarse check\n    const LUT = this.getLUT(),\n      l = LUT.length - 1,\n      closest = utils.closest(LUT, point),\n      mpos = closest.mpos,\n      t1 = (mpos - 1) / l,\n      t2 = (mpos + 1) / l,\n      step = 0.1 / l;\n\n    // step 2: fine check\n    let mdist = closest.mdist,\n      t = t1,\n      ft = t,\n      p;\n    mdist += 1;\n    for (let d; t < t2 + step; t += step) {\n      p = this.compute(t);\n      d = utils.dist(point, p);\n      if (d < mdist) {\n        mdist = d;\n        ft = t;\n      }\n    }\n    ft = ft < 0 ? 0 : ft > 1 ? 1 : ft;\n    p = this.compute(ft);\n    p.t = ft;\n    p.d = mdist;\n    return p;\n  }\n\n  get(t) {\n    return this.compute(t);\n  }\n\n  point(idx) {\n    return this.points[idx];\n  }\n\n  compute(t) {\n    if (this.ratios) {\n      return utils.computeWithRatios(t, this.points, this.ratios, this._3d);\n    }\n    return utils.compute(t, this.points, this._3d, this.ratios);\n  }\n\n  raise() {\n    const p = this.points,\n      np = [p[0]],\n      k = p.length;\n    for (let i = 1, pi, pim; i < k; i++) {\n      pi = p[i];\n      pim = p[i - 1];\n      np[i] = {\n        x: ((k - i) / k) * pi.x + (i / k) * pim.x,\n        y: ((k - i) / k) * pi.y + (i / k) * pim.y,\n      };\n    }\n    np[k] = p[k - 1];\n    return new Bezier(np);\n  }\n\n  derivative(t) {\n    return utils.compute(t, this.dpoints[0], this._3d);\n  }\n\n  dderivative(t) {\n    return utils.compute(t, this.dpoints[1], this._3d);\n  }\n\n  align() {\n    let p = this.points;\n    return new Bezier(utils.align(p, { p1: p[0], p2: p[p.length - 1] }));\n  }\n\n  curvature(t) {\n    return utils.curvature(t, this.dpoints[0], this.dpoints[1], this._3d);\n  }\n\n  inflections() {\n    return utils.inflections(this.points);\n  }\n\n  normal(t) {\n    return this._3d ? this.__normal3(t) : this.__normal2(t);\n  }\n\n  __normal2(t) {\n    const d = this.derivative(t);\n    const q = sqrt(d.x * d.x + d.y * d.y);\n    return { x: -d.y / q, y: d.x / q };\n  }\n\n  __normal3(t) {\n    // see http://stackoverflow.com/questions/25453159\n    const r1 = this.derivative(t),\n      r2 = this.derivative(t + 0.01),\n      q1 = sqrt(r1.x * r1.x + r1.y * r1.y + r1.z * r1.z),\n      q2 = sqrt(r2.x * r2.x + r2.y * r2.y + r2.z * r2.z);\n    r1.x /= q1;\n    r1.y /= q1;\n    r1.z /= q1;\n    r2.x /= q2;\n    r2.y /= q2;\n    r2.z /= q2;\n    // cross product\n    const c = {\n      x: r2.y * r1.z - r2.z * r1.y,\n      y: r2.z * r1.x - r2.x * r1.z,\n      z: r2.x * r1.y - r2.y * r1.x,\n    };\n    const m = sqrt(c.x * c.x + c.y * c.y + c.z * c.z);\n    c.x /= m;\n    c.y /= m;\n    c.z /= m;\n    // rotation matrix\n    const R = [\n      c.x * c.x,\n      c.x * c.y - c.z,\n      c.x * c.z + c.y,\n      c.x * c.y + c.z,\n      c.y * c.y,\n      c.y * c.z - c.x,\n      c.x * c.z - c.y,\n      c.y * c.z + c.x,\n      c.z * c.z,\n    ];\n    // normal vector:\n    const n = {\n      x: R[0] * r1.x + R[1] * r1.y + R[2] * r1.z,\n      y: R[3] * r1.x + R[4] * r1.y + R[5] * r1.z,\n      z: R[6] * r1.x + R[7] * r1.y + R[8] * r1.z,\n    };\n    return n;\n  }\n\n  hull(t) {\n    let p = this.points,\n      _p = [],\n      q = [],\n      idx = 0;\n    q[idx++] = p[0];\n    q[idx++] = p[1];\n    q[idx++] = p[2];\n    if (this.order === 3) {\n      q[idx++] = p[3];\n    }\n    // we lerp between all points at each iteration, until we have 1 point left.\n    while (p.length > 1) {\n      _p = [];\n      for (let i = 0, pt, l = p.length - 1; i < l; i++) {\n        pt = utils.lerp(t, p[i], p[i + 1]);\n        q[idx++] = pt;\n        _p.push(pt);\n      }\n      p = _p;\n    }\n    return q;\n  }\n\n  split(t1, t2) {\n    // shortcuts\n    if (t1 === 0 && !!t2) {\n      return this.split(t2).left;\n    }\n    if (t2 === 1) {\n      return this.split(t1).right;\n    }\n\n    // no shortcut: use \"de Casteljau\" iteration.\n    const q = this.hull(t1);\n    const result = {\n      left:\n        this.order === 2\n          ? new Bezier([q[0], q[3], q[5]])\n          : new Bezier([q[0], q[4], q[7], q[9]]),\n      right:\n        this.order === 2\n          ? new Bezier([q[5], q[4], q[2]])\n          : new Bezier([q[9], q[8], q[6], q[3]]),\n      span: q,\n    };\n\n    // make sure we bind _t1/_t2 information!\n    result.left._t1 = utils.map(0, 0, 1, this._t1, this._t2);\n    result.left._t2 = utils.map(t1, 0, 1, this._t1, this._t2);\n    result.right._t1 = utils.map(t1, 0, 1, this._t1, this._t2);\n    result.right._t2 = utils.map(1, 0, 1, this._t1, this._t2);\n\n    // if we have no t2, we're done\n    if (!t2) {\n      return result;\n    }\n\n    // if we have a t2, split again:\n    t2 = utils.map(t2, t1, 1, 0, 1);\n    return result.right.split(t2).left;\n  }\n\n  extrema() {\n    const result = {};\n    let roots = [];\n\n    this.dims.forEach(\n      function (dim) {\n        let mfn = function (v) {\n          return v[dim];\n        };\n        let p = this.dpoints[0].map(mfn);\n        result[dim] = utils.droots(p);\n        if (this.order === 3) {\n          p = this.dpoints[1].map(mfn);\n          result[dim] = result[dim].concat(utils.droots(p));\n        }\n        result[dim] = result[dim].filter(function (t) {\n          return t >= 0 && t <= 1;\n        });\n        roots = roots.concat(result[dim].sort(utils.numberSort));\n      }.bind(this)\n    );\n\n    result.values = roots.sort(utils.numberSort).filter(function (v, idx) {\n      return roots.indexOf(v) === idx;\n    });\n\n    return result;\n  }\n\n  bbox() {\n    const extrema = this.extrema(),\n      result = {};\n    this.dims.forEach(\n      function (d) {\n        result[d] = utils.getminmax(this, d, extrema[d]);\n      }.bind(this)\n    );\n    return result;\n  }\n\n  overlaps(curve) {\n    const lbbox = this.bbox(),\n      tbbox = curve.bbox();\n    return utils.bboxoverlap(lbbox, tbbox);\n  }\n\n  offset(t, d) {\n    if (typeof d !== \"undefined\") {\n      const c = this.get(t),\n        n = this.normal(t);\n      const ret = {\n        c: c,\n        n: n,\n        x: c.x + n.x * d,\n        y: c.y + n.y * d,\n      };\n      if (this._3d) {\n        ret.z = c.z + n.z * d;\n      }\n      return ret;\n    }\n    if (this._linear) {\n      const nv = this.normal(0),\n        coords = this.points.map(function (p) {\n          const ret = {\n            x: p.x + t * nv.x,\n            y: p.y + t * nv.y,\n          };\n          if (p.z && nv.z) {\n            ret.z = p.z + t * nv.z;\n          }\n          return ret;\n        });\n      return [new Bezier(coords)];\n    }\n    return this.reduce().map(function (s) {\n      if (s._linear) {\n        return s.offset(t)[0];\n      }\n      return s.scale(t);\n    });\n  }\n\n  simple() {\n    if (this.order === 3) {\n      const a1 = utils.angle(this.points[0], this.points[3], this.points[1]);\n      const a2 = utils.angle(this.points[0], this.points[3], this.points[2]);\n      if ((a1 > 0 && a2 < 0) || (a1 < 0 && a2 > 0)) return false;\n    }\n    const n1 = this.normal(0);\n    const n2 = this.normal(1);\n    let s = n1.x * n2.x + n1.y * n2.y;\n    if (this._3d) {\n      s += n1.z * n2.z;\n    }\n    return abs(acos(s)) < pi / 3;\n  }\n\n  reduce() {\n    // TODO: examine these var types in more detail...\n    let i,\n      t1 = 0,\n      t2 = 0,\n      step = 0.01,\n      segment,\n      pass1 = [],\n      pass2 = [];\n    // first pass: split on extrema\n    let extrema = this.extrema().values;\n    if (extrema.indexOf(0) === -1) {\n      extrema = [0].concat(extrema);\n    }\n    if (extrema.indexOf(1) === -1) {\n      extrema.push(1);\n    }\n\n    for (t1 = extrema[0], i = 1; i < extrema.length; i++) {\n      t2 = extrema[i];\n      segment = this.split(t1, t2);\n      segment._t1 = t1;\n      segment._t2 = t2;\n      pass1.push(segment);\n      t1 = t2;\n    }\n\n    // second pass: further reduce these segments to simple segments\n    pass1.forEach(function (p1) {\n      t1 = 0;\n      t2 = 0;\n      while (t2 <= 1) {\n        for (t2 = t1 + step; t2 <= 1 + step; t2 += step) {\n          segment = p1.split(t1, t2);\n          if (!segment.simple()) {\n            t2 -= step;\n            if (abs(t1 - t2) < step) {\n              // we can never form a reduction\n              return [];\n            }\n            segment = p1.split(t1, t2);\n            segment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n            segment._t2 = utils.map(t2, 0, 1, p1._t1, p1._t2);\n            pass2.push(segment);\n            t1 = t2;\n            break;\n          }\n        }\n      }\n      if (t1 < 1) {\n        segment = p1.split(t1, 1);\n        segment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n        segment._t2 = p1._t2;\n        pass2.push(segment);\n      }\n    });\n    return pass2;\n  }\n\n  scale(d) {\n    const order = this.order;\n    let distanceFn = false;\n    if (typeof d === \"function\") {\n      distanceFn = d;\n    }\n    if (distanceFn && order === 2) {\n      return this.raise().scale(distanceFn);\n    }\n\n    // TODO: add special handling for degenerate (=linear) curves.\n    const clockwise = this.clockwise;\n    const r1 = distanceFn ? distanceFn(0) : d;\n    const r2 = distanceFn ? distanceFn(1) : d;\n    const v = [this.offset(0, 10), this.offset(1, 10)];\n    const points = this.points;\n    const np = [];\n    const o = utils.lli4(v[0], v[0].c, v[1], v[1].c);\n\n    if (!o) {\n      throw new Error(\"cannot scale this curve. Try reducing it first.\");\n    }\n    // move all points by distance 'd' wrt the origin 'o'\n\n    // move end points by fixed distance along normal.\n    [0, 1].forEach(function (t) {\n      const p = (np[t * order] = utils.copy(points[t * order]));\n      p.x += (t ? r2 : r1) * v[t].n.x;\n      p.y += (t ? r2 : r1) * v[t].n.y;\n    });\n\n    if (!distanceFn) {\n      // move control points to lie on the intersection of the offset\n      // derivative vector, and the origin-through-control vector\n      [0, 1].forEach((t) => {\n        if (order === 2 && !!t) return;\n        const p = np[t * order];\n        const d = this.derivative(t);\n        const p2 = { x: p.x + d.x, y: p.y + d.y };\n        np[t + 1] = utils.lli4(p, p2, o, points[t + 1]);\n      });\n      return new Bezier(np);\n    }\n\n    // move control points by \"however much necessary to\n    // ensure the correct tangent to endpoint\".\n    [0, 1].forEach(function (t) {\n      if (order === 2 && !!t) return;\n      var p = points[t + 1];\n      var ov = {\n        x: p.x - o.x,\n        y: p.y - o.y,\n      };\n      var rc = distanceFn ? distanceFn((t + 1) / order) : d;\n      if (distanceFn && !clockwise) rc = -rc;\n      var m = sqrt(ov.x * ov.x + ov.y * ov.y);\n      ov.x /= m;\n      ov.y /= m;\n      np[t + 1] = {\n        x: p.x + rc * ov.x,\n        y: p.y + rc * ov.y,\n      };\n    });\n    return new Bezier(np);\n  }\n\n  outline(d1, d2, d3, d4) {\n    d2 = typeof d2 === \"undefined\" ? d1 : d2;\n    const reduced = this.reduce(),\n      len = reduced.length,\n      fcurves = [];\n\n    let bcurves = [],\n      p,\n      alen = 0,\n      tlen = this.length();\n\n    const graduated = typeof d3 !== \"undefined\" && typeof d4 !== \"undefined\";\n\n    function linearDistanceFunction(s, e, tlen, alen, slen) {\n      return function (v) {\n        const f1 = alen / tlen,\n          f2 = (alen + slen) / tlen,\n          d = e - s;\n        return utils.map(v, 0, 1, s + f1 * d, s + f2 * d);\n      };\n    }\n\n    // form curve oulines\n    reduced.forEach(function (segment) {\n      const slen = segment.length();\n      if (graduated) {\n        fcurves.push(\n          segment.scale(linearDistanceFunction(d1, d3, tlen, alen, slen))\n        );\n        bcurves.push(\n          segment.scale(linearDistanceFunction(-d2, -d4, tlen, alen, slen))\n        );\n      } else {\n        fcurves.push(segment.scale(d1));\n        bcurves.push(segment.scale(-d2));\n      }\n      alen += slen;\n    });\n\n    // reverse the \"return\" outline\n    bcurves = bcurves\n      .map(function (s) {\n        p = s.points;\n        if (p[3]) {\n          s.points = [p[3], p[2], p[1], p[0]];\n        } else {\n          s.points = [p[2], p[1], p[0]];\n        }\n        return s;\n      })\n      .reverse();\n\n    // form the endcaps as lines\n    const fs = fcurves[0].points[0],\n      fe = fcurves[len - 1].points[fcurves[len - 1].points.length - 1],\n      bs = bcurves[len - 1].points[bcurves[len - 1].points.length - 1],\n      be = bcurves[0].points[0],\n      ls = utils.makeline(bs, fs),\n      le = utils.makeline(fe, be),\n      segments = [ls].concat(fcurves).concat([le]).concat(bcurves),\n      slen = segments.length;\n\n    return new PolyBezier(segments);\n  }\n\n  outlineshapes(d1, d2, curveIntersectionThreshold) {\n    d2 = d2 || d1;\n    const outline = this.outline(d1, d2).curves;\n    const shapes = [];\n    for (let i = 1, len = outline.length; i < len / 2; i++) {\n      const shape = utils.makeshape(\n        outline[i],\n        outline[len - i],\n        curveIntersectionThreshold\n      );\n      shape.startcap.virtual = i > 1;\n      shape.endcap.virtual = i < len / 2 - 1;\n      shapes.push(shape);\n    }\n    return shapes;\n  }\n\n  intersects(curve, curveIntersectionThreshold) {\n    if (!curve) return this.selfintersects(curveIntersectionThreshold);\n    if (curve.p1 && curve.p2) {\n      return this.lineIntersects(curve);\n    }\n    if (curve instanceof Bezier) {\n      curve = curve.reduce();\n    }\n    return this.curveintersects(\n      this.reduce(),\n      curve,\n      curveIntersectionThreshold\n    );\n  }\n\n  lineIntersects(line) {\n    const mx = min(line.p1.x, line.p2.x),\n      my = min(line.p1.y, line.p2.y),\n      MX = max(line.p1.x, line.p2.x),\n      MY = max(line.p1.y, line.p2.y);\n    return utils.roots(this.points, line).filter((t) => {\n      var p = this.get(t);\n      return utils.between(p.x, mx, MX) && utils.between(p.y, my, MY);\n    });\n  }\n\n  selfintersects(curveIntersectionThreshold) {\n    // \"simple\" curves cannot intersect with their direct\n    // neighbour, so for each segment X we check whether\n    // it intersects [0:x-2][x+2:last].\n\n    const reduced = this.reduce(),\n      len = reduced.length - 2,\n      results = [];\n\n    for (let i = 0, result, left, right; i < len; i++) {\n      left = reduced.slice(i, i + 1);\n      right = reduced.slice(i + 2);\n      result = this.curveintersects(left, right, curveIntersectionThreshold);\n      results.push(...result);\n    }\n    return results;\n  }\n\n  curveintersects(c1, c2, curveIntersectionThreshold) {\n    const pairs = [];\n    // step 1: pair off any overlapping segments\n    c1.forEach(function (l) {\n      c2.forEach(function (r) {\n        if (l.overlaps(r)) {\n          pairs.push({ left: l, right: r });\n        }\n      });\n    });\n    // step 2: for each pairing, run through the convergence algorithm.\n    let intersections = [];\n    pairs.forEach(function (pair) {\n      const result = utils.pairiteration(\n        pair.left,\n        pair.right,\n        curveIntersectionThreshold\n      );\n      if (result.length > 0) {\n        intersections = intersections.concat(result);\n      }\n    });\n    return intersections;\n  }\n\n  arcs(errorThreshold) {\n    errorThreshold = errorThreshold || 0.5;\n    return this._iterate(errorThreshold, []);\n  }\n\n  _error(pc, np1, s, e) {\n    const q = (e - s) / 4,\n      c1 = this.get(s + q),\n      c2 = this.get(e - q),\n      ref = utils.dist(pc, np1),\n      d1 = utils.dist(pc, c1),\n      d2 = utils.dist(pc, c2);\n    return abs(d1 - ref) + abs(d2 - ref);\n  }\n\n  _iterate(errorThreshold, circles) {\n    let t_s = 0,\n      t_e = 1,\n      safety;\n    // we do a binary search to find the \"good `t` closest to no-longer-good\"\n    do {\n      safety = 0;\n\n      // step 1: start with the maximum possible arc\n      t_e = 1;\n\n      // points:\n      let np1 = this.get(t_s),\n        np2,\n        np3,\n        arc,\n        prev_arc;\n\n      // booleans:\n      let curr_good = false,\n        prev_good = false,\n        done;\n\n      // numbers:\n      let t_m = t_e,\n        prev_e = 1,\n        step = 0;\n\n      // step 2: find the best possible arc\n      do {\n        prev_good = curr_good;\n        prev_arc = arc;\n        t_m = (t_s + t_e) / 2;\n        step++;\n\n        np2 = this.get(t_m);\n        np3 = this.get(t_e);\n\n        arc = utils.getccenter(np1, np2, np3);\n\n        //also save the t values\n        arc.interval = {\n          start: t_s,\n          end: t_e,\n        };\n\n        let error = this._error(arc, np1, t_s, t_e);\n        curr_good = error <= errorThreshold;\n\n        done = prev_good && !curr_good;\n        if (!done) prev_e = t_e;\n\n        // this arc is fine: we can move 'e' up to see if we can find a wider arc\n        if (curr_good) {\n          // if e is already at max, then we're done for this arc.\n          if (t_e >= 1) {\n            // make sure we cap at t=1\n            arc.interval.end = prev_e = 1;\n            prev_arc = arc;\n            // if we capped the arc segment to t=1 we also need to make sure that\n            // the arc's end angle is correct with respect to the bezier end point.\n            if (t_e > 1) {\n              let d = {\n                x: arc.x + arc.r * cos(arc.e),\n                y: arc.y + arc.r * sin(arc.e),\n              };\n              arc.e += utils.angle({ x: arc.x, y: arc.y }, d, this.get(1));\n            }\n            break;\n          }\n          // if not, move it up by half the iteration distance\n          t_e = t_e + (t_e - t_s) / 2;\n        } else {\n          // this is a bad arc: we need to move 'e' down to find a good arc\n          t_e = t_m;\n        }\n      } while (!done && safety++ < 100);\n\n      if (safety >= 100) {\n        break;\n      }\n\n      // console.log(\"L835: [F] arc found\", t_s, prev_e, prev_arc.x, prev_arc.y, prev_arc.s, prev_arc.e);\n\n      prev_arc = prev_arc ? prev_arc : arc;\n      circles.push(prev_arc);\n      t_s = prev_e;\n    } while (t_e < 1);\n    return circles;\n  }\n}\n\nexport { Bezier };\n","/**\n * 方向\n * @readonly\n * @enum {number}\n */\nexport const DIRECTION = {\n    /** RIGHT */\n    RIGHT: 0,\n    /** BOTTOM */\n    BOTTOM: 1,\n    /** LEFT */\n    LEFT: 2,\n    /** TOP */\n    TOP: 3,\n    /** SELF */\n    SELF: 100,\n}\n\nexport function nextDirection(direction, clockwise) {\n    const nextDir = (direction + (clockwise ? 1 : -1)) % 4;\n    return nextDir;\n}\n\nexport function oppositeDirection(direction) {\n    return (direction + 2) % 4\n}\n\nexport const APPROXIMATE = 6;\n\nexport const JFLOW_MODE = {\n    DEFAULT: 'DEFAULT',\n    LINKING: 'LINKING',\n}\n\nexport const LINE_DIR = {\n    FROM: 'from',\n    TO: 'to',\n}","import {\n    Bezier,\n} from 'bezier-js';\nimport { DIRECTION } from './constance';\n\n/**\n * 根据点计算最小外接矩形\n * @param {number[][]} points - 点集合\n * @return {Object} demension 宽高，坐标\n */\nexport function bounding_box(points) {\n    if(points.length === 0) {\n        return {\n            width: 1,\n            height: 1,\n            x: 0,\n            y: 0,\n        }\n    }\n    let min_x = Infinity; \n    let min_y = Infinity; \n    let max_x = -Infinity; \n    let max_y = -Infinity; \n    for(let idx in points) {\n        const item = points[idx];\n        if(item[0] < min_x){\n            min_x = item[0]\n        }\n\n        if (item[0] > max_x) {\n            max_x = item[0]\n        } \n\n        if (item[1] < min_y) {\n            min_y = item[1]\n        }\n\n        if (item[1] > max_y) {\n            max_y = item[1]\n        }\n    }\n    return {\n        // points: [(min_x,min_y),(max_x,min_y),(max_x,max_y),(min_x,max_y)],\n        width: Math.max(max_x - min_x, 10),\n        height: Math.max(max_y - min_y, 10),\n        x: min_x,\n        y: min_y,\n    }\n}\n\nfunction sqr(x) {\n    return x * x;\n}\nexport function dist2(v, w) {\n    return sqr(v[0] - w[0]) + sqr(v[1] - w[1]);\n}\n\n// p - point\n// v - start point of segment\n// w - end point of segment\nexport function distToSegmentSquared(p, v, w) {\n    const l2 = dist2(v, w);\n    if (l2 === 0) return dist2(p, v);\n    let t = ((p[0] - v[0]) * (w[0] - v[0]) + (p[1] - v[1]) * (w[1] - v[1])) / l2;\n    t = Math.max(0, Math.min(1, t));\n    return dist2(p, [ v[0] + t * (w[0] - v[0]), v[1] + t * (w[1] - v[1]) ]);\n}\n\nexport function minIntersectionBetweenNodes(dmsfrom, dmsto) {\n    const meta = {\n        fromDir: null,\n        fromP: null,\n        toDir: null,\n        toP: null,\n        distMin: Infinity\n    }\n    Object.keys(dmsfrom).forEach(df => {\n        if((+df) === DIRECTION.SELF) {\n            return;\n        }\n        let pf = dmsfrom[df];\n        Object.keys(dmsto).forEach(dt => {\n            if((+dt) === DIRECTION.SELF) {\n                return;\n            }\n            let pt = dmsto[dt];\n            const dist = dist2(pf, pt);\n            if(dist < meta.distMin) {\n                Object.assign(meta, {\n                    distMin: dist,\n                    fromDir: +df,\n                    fromP: pf,\n                    toDir: +dt,\n                    toP: pt,\n                })\n            }\n        })\n    });\n    return meta;\n}\n\n// export function bezierPoints(p1, p2, start_dir = DIRECTION.TOP, end_dir = DIRECTION.TOP, anticlock = false) {\n//     const isSameDirection = start_dir === end_dir;\n//     const isVerticalStart = [DIRECTION.TOP, DIRECTION.BOTTOM].includes(start_dir);   \n//     const isVerticalEnd = [DIRECTION.TOP, DIRECTION.BOTTOM].includes(end_dir);\n//     const arrowspan = [DIRECTION.TOP, DIRECTION.LEFT].includes(end_dir) ? -5 : 5;\n//     const endX = isVerticalEnd ? p2[0] : p2[0] + arrowspan;\n//     const endY = isVerticalEnd ? p2[1] + arrowspan : p2[1];\n//     if(isSameDirection) {\n//         let span = Math.abs(isVerticalStart ? (endY - p1[1]) : (endX - p1[0]))\n//         span = Math.min(span, 50);\n//         const symb = [DIRECTION.RIGHT, DIRECTION.BOTTOM].includes(end_dir)\n//         span = symb ? span : - span;\n//         const cp1 = isVerticalStart ? [p1[0], p1[1] + span] : [p1[0] + span, p1[1]];\n//         const cp2 = isVerticalEnd ? [endX, endY + span] : [endX + span, endY];\n//         return [ \n//             ...cp1,\n//             ...cp2,\n//             endX, endY ];\n//     }\n//     let spanStart = (anticlock ? -5 : 1) * (isVerticalStart ? (endY - p1[1]) / 2 : (endX - p1[0]) / 2)\n//     let spanEnd = (anticlock ? -4 : 1) * (isVerticalEnd ? (p1[1] - endY) / 2 : (p1[0] - endX) / 2)\n//     let u1 = spanStart / Math.abs(spanStart);\n//     spanStart = u1 * Math.min(Math.abs(spanStart), 50);\n//     let u2 = spanEnd / Math.abs(spanEnd);\n//     spanEnd = u2 * Math.min(Math.abs(spanEnd), 50);\n//     const cp1 = isVerticalStart ? [p1[0], p1[1] + spanStart] : [p1[0] + spanStart, p1[1]];\n//     const cp2 = isVerticalEnd ? [endX, endY + spanEnd] : [endX + spanEnd, endY];\n//     return [ \n//         ...cp1,\n//         ...cp2,\n//         endX, endY ];\n// }\nfunction _resolveControlPoint(p, dir, spanx, spany){\n    if(dir === DIRECTION.TOP){\n        return [p[0], p[1]-spany]\n    }\n    if(dir === DIRECTION.BOTTOM){\n        return [p[0], p[1]+spany]\n    }\n    if(dir === DIRECTION.LEFT){\n        return [p[0]-spanx, p[1]]\n    }\n    if(dir === DIRECTION.RIGHT){\n        return [p[0]+spanx, p[1]]\n    }\n}\n\nexport function bezierPoints(p1, p2, start_dir = DIRECTION.TOP, end_dir = DIRECTION.TOP, minSpanX = 0, minSpanY = 0) {\n    const spanx = Math.max(Math.abs((p1[0] - p2[0])/2), minSpanX);\n    const spany = Math.max(Math.abs((p1[1] - p2[1])/2), minSpanY);\n    const cp1 = _resolveControlPoint(p1, start_dir, spanx, spany);\n    const cp2 = _resolveControlPoint(p2, end_dir, spanx, spany);\n    const arrowspan = [DIRECTION.TOP, DIRECTION.LEFT].includes(end_dir) ? -5 : 5;\n    const isVerticalEnd = [DIRECTION.TOP, DIRECTION.BOTTOM].includes(end_dir);\n    const endX = isVerticalEnd ? p2[0] : p2[0] + arrowspan;\n    const endY = isVerticalEnd ? p2[1] + arrowspan : p2[1];\n    return [ \n        ...cp1,\n        ...cp2,\n        endX, endY];\n}\n\nexport function bezierPoint(t, P) {\n    const q = 1-t;\n    const x = q*q*q*P[0] + 3*q*q*t*P[2] + 3*q*t*t*P[4] + t*t*t*P[6];\n    const y = q*q*q*P[1] + 3*q*q*t*P[3] + 3*q*t*t*P[5] + t*t*t*P[7];\n    const u = q*q*(P[2]-P[0]) + 2*t*q*(P[4]-P[2]) + t*t*(P[6]-P[4]);\n    const v = q*q*(P[3]-P[1]) + 2*t*q*(P[5]-P[3]) + t*t*(P[7]-P[5]);\n    let angle = Math.atan2(v, u);\n    // console.log(angle * 180)\n    // if(angle < 0) {\n    //     angle = Math.PI + angle;\n    // }\n    return [x, y, angle];\n}\n\n// export function bezierPoints(p1, p2, start_vec, end_vec) {\n\n// }\n\nexport function distToBezierSegmentSquared(p, points) {\n    const b = new Bezier(...points);\n\n    const point = b.project({ x: p[0], y: p[1] });\n    const d = dist2(p, [ point.x, point.y ]);\n    return d;\n}\n\nexport function getBezierAngle(t, sx, sy, cp1x, cp1y, cp2x, cp2y, ex, ey) {\n  var dx = Math.pow(1-t, 2)*(cp1x-sx) + 2*t*(1-t)*(cp2x-cp1x) + t * t * (ex - cp2x);\n  var dy = Math.pow(1-t, 2)*(cp1y-sy) + 2*t*(1-t)*(cp2y-cp1y) + t * t * (ey - cp2y);\n  return -Math.atan2(dx, dy) + 0.5*Math.PI;\n}\n\n\nexport function getInstanceHeight(instance) {\n    const rect = instance.getBoundingRect();\n    // let min_y = Infinity;\n    // let max_y = -Infinity;\n    // let min_x = Infinity;\n    // let max_x = -Infinity;\n    // rect.forEach(point => {\n    //     max_y = Math.max(max_y, point[1]);\n    //     min_y = Math.min(min_y, point[1]);\n    //     max_x = Math.max(max_x, point[0]);\n    //     min_x = Math.min(min_x, point[0]);\n    // });\n    return {\n        height: rect[3] - rect[1],\n        width: rect[2] - rect[0],\n    }\n}\n\nexport function polylinePoints(points, p1, p2, start_dir = DIRECTION.TOP, end_dir = DIRECTION.TOP, minSpanX = 10, minSpanY = 10, isSelf) {\n    const dirSpan = Math.abs(start_dir - end_dir);\n    // const spanx = Math.max(Math.abs((p1[0] - p2[0])/2), minSpanX);\n    // const spany = Math.max(Math.abs((p1[1] - p2[1])/2), minSpanY);\n    const isVerticalStart = (start_dir === DIRECTION.TOP || start_dir === DIRECTION.BOTTOM);\n    points.length = 0;\n    switch (dirSpan) {\n        case 0:\n            // 都按向右好了\n            if(start_dir === DIRECTION.TOP) {\n                const y = Math.min(p1[1], p2[1]);\n                const yp = y - minSpanY;\n                points.push([p1[0], yp]);\n                points.push([p2[0], yp]);\n            }\n            if(start_dir === DIRECTION.BOTTOM) {\n                const y = Math.max(p1[1], p2[1]);\n                const yp = y + minSpanY;\n                points.push([p1[0], yp]);\n                points.push([p2[0], yp]);\n            }\n            if(start_dir === DIRECTION.LEFT) {\n                const x = Math.min(p1[0], p2[0]);\n                const xp = x - minSpanX;\n                points.push([xp, p1[1]]);\n                points.push([xp, p2[1]]);\n            }\n            if(start_dir === DIRECTION.RIGHT) {\n                const x = Math.max(p1[0], p2[0]);\n                const xp = x + minSpanX;\n                points.push([xp, p1[1]]);\n                points.push([xp, p2[1]]);\n            }\n            break;\n        case 1:\n        case 3:  \n            if(isSelf) {\n                if(!isVerticalStart) {\n                    points.push([p1[0] + minSpanX, p1[1]]);\n                    points.push([p1[0] + minSpanX, p2[1] + minSpanY]);\n                    points.push([p2[0], p2[1] + minSpanY]);\n                } else {\n                    points.push([p1[0], p1[1] + minSpanY]);\n                    points.push([p2[0] + minSpanX, p1[1] + minSpanY]);\n                    points.push([p2[0] + minSpanX, p2[1]]);\n                }\n            } else {\n                const point = isVerticalStart ? [p1[0], p2[1]]: [p2[0], p1[1]]\n                points.push(point);\n            }\n            break;\n        case 2:\n            const pmiddle = [\n                (p1[0] - p2[0])/2 + p2[0],\n                (p1[1] - p2[1])/2 + p2[1]\n            ]; \n            if(isVerticalStart) {\n                points.push([p1[0], pmiddle[1]])\n                points.push([p2[0], pmiddle[1]])\n            } else {\n                points.push([pmiddle[0], p1[1]])\n                points.push([pmiddle[0], p2[1]])\n            }\n            break;\n        default:\n            break;\n    }\n    points.unshift(p1);\n    points.push(p2);\n}\n\nfunction minusVec(p1, p2) {\n    return [p1[0] - p2[0], p1[1] - p2[1]]\n}\n\nfunction absVec(vec) {\n    return Math.sqrt(vec[0] * vec[0] + vec[1] * vec[1]);\n}\n\nfunction scaleVec(vec, scale) {\n    return [vec[0] * scale, vec[1] * scale];\n}\n\nexport function makeRadiusFromVector(pbefore, p, pnext, radius) {\n    const vec1 = minusVec(p, pbefore);\n    const vec2 = minusVec(p, pnext);\n    const absVec1 = absVec(vec1);\n    const absVec2 = absVec(vec2);\n    if(!absVec1 || !absVec2) {\n        return {\n            p1: null,\n            p2: null,\n        }\n    }\n    const r1 = scaleVec(vec1, radius/absVec1);\n    const r2 = scaleVec(vec2, radius/absVec2);\n    return {\n        p1: minusVec(p, r1),\n        p2: minusVec(p, r2),\n    }\n}\n// 矩形重叠计算\nexport function doOverlap(rec1, rec2) {\n    if (rec1[0] == rec1[2] || rec1[1] == rec1[3] ||\n        rec2[0] == rec2[2] || rec2[1] == rec2[3]) {\n        // the line cannot have positive overlap\n        return false;\n    }\n\n    return !(rec1[2] <= rec2[0] ||   // left\n                rec1[3] <= rec2[1] ||   // bottom\n                rec1[0] >= rec2[2] ||   // right\n                rec1[1] >= rec2[3]);    // top\n}\n\nexport function isPolyLineIntersectionRectange(polyline, rect) {\n    let p = polyline[0];\n    let l = polyline.length;\n    let i = 1;\n    const [l0, l1, r0, r1] = rect;\n    while (i < l) {\n        const cp = polyline[i];\n        if(p[0] === cp[0]) {\n            // vertical\n            if(p[0] < r0 && p[0] > l0 \n                && !((p[1] > r1 && cp[1] > r1) || (p[1] < l1 && cp[1] < l1))){\n                    return true;\n                } \n        } else {\n            // horizontal\n            if(p[1] < r1 && p[1] > l1\n                && !((p[0] > r0 && cp[0] > r0) || (p[0] < l0 && cp[0] < l0))){\n                    return true;\n                } \n        }\n        p = cp;\n        i++;\n    }\n    return false;\n}\n\nexport function debounce(func, timeout = 300){\n    let timer;\n    return () => {\n      clearTimeout(timer);\n      timer = setTimeout(() => { func.call(this); }, timeout);\n    };\n  }\n\nexport function compareBoundingbox(a, b) {\n    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\nexport function copyBoundingbox(a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = b[3];\n}","// import { setUniqueId, getUniqueId } from '../utils/functions';\n// import { nextDirection } from '../utils/constance';\n// const margin = 5;\nconst ishitKey = Symbol('ishit');\nconst isInViewBox = Symbol('isInViewBox');\n/**\n * @typedef Instance~Configs\n * @type {object}\n * @property {number} borderWidth      - 边的宽度 默认是 2\n * @property {string} borderColor      - 边框颜色 默认 black\n * @property {string} color            - 填充颜色 默认 white\n * @property {string} shadowColor      - 阴影颜色\n * @property {string} shadowBlur       - 阴影扩散范围\n * @property {string} shadowOffsetX    - 阴影偏移 X\n * @property {string} shadowOffsetX    - 阴影偏移 Y\n */\n\n/** \n * 图中的最小单元\n * @constructor Instance\n * @extends EventTarget\n * @param {Instance~Configs} configs - 最小单元的一些通用属性配置\n */\nclass Instance extends EventTarget{\n    constructor(configs = {}) {\n        super();\n        Object.assign(this, configs);\n        // this.anchor = configs.anchor || [0, 0];\n        // this.belongs = undefined;\n        /** @member {boolean}      - 元素可见 默认 true */\n        this.visible = true;\n        // this._jflow = undefined;\n        this._belongs = undefined;\n        this[ishitKey] = false; \n\n        /** @member {number}      - 边的宽度 默认是 0 */\n        this.borderWidth =      configs.borderWidth || 0;\n        /** @member {string}     - 边框颜色 默认 transparent */\n        this.borderColor =      configs.borderColor || 'transparent';\n        /** @member {string}     - 填充颜色 默认 transparent */\n        this.backgroundColor =  configs.backgroundColor || 'transparent';\n        /** @member {string}     - 阴影颜色 空就不显示阴影 */\n        this.shadowColor =      configs.shadowColor;\n        /** @member {string}     - 阴影扩散范围 默认 5 */\n        this.shadowBlur  =      configs.shadowBlur || 5;\n        /** @member {string}     - 阴影偏移 X */\n        this.shadowOffsetX =    configs.shadowOffsetX || 0;\n        /** @member {string}     - 阴影偏移 Y */\n        this.shadowOffsetY =    configs.shadowOffsetY || 0;\n        /** @member {number}     - 透明度 */\n        this.opacity  =         configs.opacity || 1\n\n        this._boundingrect = [0,0,0,0];\n    }\n    /**\n     * @member {boolean} - 当前单元选中状态\n     */\n    get _isTargeting() {\n        return this === (this._jflow._target.instance || this._jflow._target.link);\n    }\n    /**\n     * @member {boolean} - 当前单元移动状态\n     */\n    get _isMoving() {\n        return this === this._jflow._getMovingTarget() && this._jflow._target.status.movingState; // 移动了之后才能被当做移动状态\n    }\n    /**\n     * @member {boolean}  - 当前单元碰撞检测状态\n     */\n    get _isHit() {\n        return this[ishitKey];\n    }\n    /**\n     * @member {JFlow}  - canvas上 jflow 实体\n     */\n    get _jflow() {\n        return this._belongs.uniqueName === 'jflow' ? this._belongs : this._belongs._jflow;\n    }\n\n    set _isHit(ishit) {\n        if(this[ishitKey] !== ishit) {\n            /**\n             * 鼠标移入事件\n             *\n             * @event Instance#mouseenter\n             * @type {object}\n             * @property {Instance} instance      - 移入的对象 \n             */\n            /**\n             * 鼠标移出事件\n             *\n             * @event Instance#mouseleave\n             * @type {object}\n             * @property {Instance} instance      - 移入的对象 \n             */\n            this.dispatchEvent(new CustomEvent(ishit ? 'mouseenter': 'mouseleave' , {\n                detail: {\n                    instance: this,\n                    jflow: this._jflow\n                }\n            }));\n        }\n        this[ishitKey] = ishit; // validation could be checked here such as only allowing non numerical values\n    }\n\n    get isInViewBox() {\n        return this[isInViewBox];\n    }\n\n    set _isInViewBox(val) {\n        const oldval = this[isInViewBox];\n        if(val !== oldval) {\n            if(val) {\n                this.onEnterViewbox();\n            } else {\n                this.onLeaveViewbox();\n            } \n        }    \n        this[isInViewBox] = val;\n    }\n\n    /**\n     * 当节点离开可视区域的回调\n     */\n    onEnterViewbox() {\n        return;\n    }\n\n    /**\n     * 当节点离开可视区域的回调\n     */\n    onLeaveViewbox() {\n        return;\n    }\n\n    /**\n     * 改变当前配置\n     * @param {Configs} configs - The string containing two comma-separated numbers.\n     */\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k]\n            }\n        })\n    }\n    /**\n     * 绘制单元\n     * @param {Context2d} ctx \n     */\n    render(ctx) {\n        throw 'require render implement'\n    }\n    /**\n     * 判断当前单元是否被命中\n     * @param {number[]} point \n     * @return {Boolean}\n     */\n    isHit(point) {\n        throw 'require isHit implement'\n    }\n    /**\n     * 计算当前的最大外接矩形的\n     * @return {number[]} [leftx, lefty, rightx, righty]\n     */\n    getBoundingRect() {\n        throw 'require getBoundingRect implement'\n    }\n    calculateIntersection() {\n        throw 'require calculateIntersection implement'\n    }\n    /**\n     * 计算当前连线接入点的位置\n     * @return {Object} intersection 交叉点\n     * @return {number} intersection[DIRECTION.TOP] 上\n     * @return {number} intersection[DIRECTION.BOTTOM] 下\n     * @return {number} intersection[DIRECTION.LEFT] 上\n     * @return {number} intersection[DIRECTION.RIGHT] 右\n     */\n    getIntersectionsInFourDimension() {\n        throw 'require getIntersectionsInFourDimension implement'\n    }\n\n\n    /**\n     * 获取当前所在层级的坐标\n     * @return {Number[]} 坐标\n     */\n    getCenter() {\n        return this.anchor;\n    }\n    /**\n     * 获取宽高\n     * @return {Object} demension 宽高\n     * @return {number} demension.width 宽\n     * @return {number} demension.height 高\n     */\n    getBoundingDimension() {\n        const rect = instance.getBoundingRect();\n        let min_y = Infinity;\n        let max_y = -Infinity;\n        let min_x = Infinity;\n        let max_x = -Infinity;\n        rect.forEach(point => {\n            max_y = Math.max(max_y, point[1]);\n            min_y = Math.min(min_y, point[1]);\n            max_x = Math.max(max_x, point[0]);\n            min_x = Math.min(min_x, point[0]);\n        });\n        return {\n            height: max_y - min_y,\n            width: max_x - min_x,\n        }\n    }\n    /**\n     * 冒泡事件\n     * @param {JFlowEvent} customEvent 自定义事件\n     */\n    bubbleEvent(customEvent){\n        customEvent.detail.currentTarget = this;\n        this.dispatchEvent(customEvent);\n        if(customEvent.detail.bubbles){\n            if(this._belongs.bubbleEvent) {\n                this._belongs.bubbleEvent(customEvent);\n            } else {\n                this._belongs.dispatchEvent(customEvent); \n            }\n            \n        }\n    }\n    /**\n     * 反算回页面的像素坐标\n     * @param {Number[]} point\n     * @return {Number[]} 世界坐标\n     */\n    calculateToRealWorld(point) {\n        if(this._belongs && this._belongs.calculateToRealWorld) {\n            return this._belongs.calculateToRealWorld(point);\n        } else {\n            return point;\n        }\n    }\n\n    calculateToRealWorldWithScalar(length){\n        return this._jflow.scale * length;\n    }\n\n    /**\n     * 从当前布局中删除虚拟布局节点\n     */\n    // removeFromLayoutSource() {\n    //     if(this._layoutNode) {\n    //         this._layoutNode.remove();\n    //     }\n    // }\n\n    recalculateUp() {\n        if(this.belongs) {\n            this.belongs.recalculateUp();\n        }\n    }\n\n    destroy() {\n        // this._belongs = undefined;\n        // this.removeEventListener();\n    }\n}\n\nexport default Instance;","import Instance from './instance';\nimport { doOverlap } from '../utils/functions';\n\n/**\n * 绝对定位 配置， 绝对定位不受布局影响，相对于当前组来定位\n * @typedef {object} Node~AbsolutePosition \n * @property {number} top       - 上距离\n * @property {number} bottom    - 下距离\n * @property {number} right     - 右距离\n * @property {number} left      - 左距离\n */\n/**\n * Node 配置\n * @typedef {Instance~Configs} Node~Configs \n * @property {number[]} anchor - 坐标\n * @property {Node~AbsolutePosition} absolutePosition - 绝对定位位置\n */\n/**\n * 节点基类\n * @constructor Node\n * @extends Instance\n * @param {Node~Configs} configs - 节点配置\n */\nclass Node extends Instance {\n    constructor(configs = {}) {\n        super(configs);\n        this._rawConfigs = configs;\n        // for layout\n        /** @member {number[]} */\n        this.anchor =           configs.anchor || [0, 0];\n        /** @member {Node~AbsolutePosition} */\n        this.absolutePosition = configs.absolutePosition;\n    }\n\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k]\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n    }\n    setAnchorX(x) {\n        this.anchor[0] = x;\n    }\n    setAnchorY(y) {\n        this.anchor[1] = y;\n    }\n    setAnchor(x, y) {\n        this.anchor[0] = x;\n        this.anchor[1] = y;\n    }\n\n    beforeRender() {\n        return doOverlap(this._belongs._getViewBox(), this.getBoundingRect())\n    }\n\n    /**\n     * 克隆当前节点.\n     * @return {Node} 当前节点的副本\n     */\n    clone() {\n        const C = this.constructor;\n        const t = new C(this._rawConfigs);\n        t.visible = this.visible;\n        return t;\n    }\n}\n\nexport default Node;","import Node from './node';\nimport { DIRECTION } from '../utils/constance';\n\nclass GhostNode extends Node {\n    constructor(configs) {\n        super(configs);\n    }\n\n    render(ctx) {}\n\n    isHit(point) {\n        return false;\n    }\n    calculateIntersection(point) {\n        return this.anchor;\n    }\n\n    getBoundingRect() {\n        const [x2, y2] = this.anchor;\n        return [x2, y2, x2, y2]\n    }\n\n    getBoundingDimension() {\n        return {\n            width: 0, height: 0\n        }\n    }\n\n    getIntersectionsInFourDimension() {\n        const [x2, y2] = this.anchor;\n        return {\n            [DIRECTION.RIGHT]:  [x2+1, y2],\n            [DIRECTION.LEFT]:   [x2-1, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+1],\n            [DIRECTION.TOP]:    [x2, y2-1],\n        }\n    }\n}\n\nexport default GhostNode;","function getMapObject() {\n    return {\n        layoutNode: undefined,\n        jflowNode: undefined,\n        jflowlinks: [],\n        jflowFromLinks: [],\n        jflowToLinks: [],\n    }\n}\nclass NodeWeakMap {\n    constructor() {\n        this._map = new WeakMap();\n    }\n\n    get(source) {\n        return this._map.get(source);\n    }\n\n    set(source) {\n        const obj = getMapObject();\n        this._map.set(source, obj);\n        return obj;\n    }\n\n    has(source) {\n        return this._map.has(source);\n    }\n\n    delete(source) {\n        this._map.delete(source);\n    }\n\n    clear() {\n        this._map.clear();\n    }\n}\n\nexport const NodeWeakMapMixin = {\n    initNodeWeakMap() {\n        this.source_Layout_Render_NodeMap = new NodeWeakMap();\n    },\n    getRenderNodeBySource(source) {\n        const mapping = this.source_Layout_Render_NodeMap.get(source);\n        if(mapping) {\n            return mapping.jflowNode;\n        }\n        return undefined;\n    },  \n    getLayoutNodeBySource(source) {\n        const mapping = this.source_Layout_Render_NodeMap.get(source);\n        if(mapping) {\n            return mapping.layoutNode;\n        }\n        return undefined;\n    },\n    getSourceRenderMeta(source) {\n        const map = this.source_Layout_Render_NodeMap;\n        return map.get(source)\n    },\n    _getMap(source) {\n        const map = this.source_Layout_Render_NodeMap;\n        let obj;\n        if(map.has(source)) {\n            obj = map.get(source);\n        } else {\n            obj = map.set(source);\n        }\n        return obj\n    },\n    setLayoutNodeBySource(source, layoutNode) {\n        let obj = this._getMap(source);\n        obj.layoutNode = layoutNode;\n    },\n    setRenderNodeBySource(source, instance) {\n        let obj = this._getMap(source);\n        obj.jflowNode = instance;\n    },\n    addLinkNodeBySource(sourceFrom, sourceTo, link) {\n        let obj = this._getMap(sourceFrom);\n        obj.jflowFromLinks.push(link);\n\n        obj = this._getMap(sourceTo);\n        obj.jflowToLinks.push(link);\n    },\n    removeLinkNodeBySource(sourceFrom, sourceTo, link) {\n        let obj = this._getMap(sourceFrom);\n        let idx = obj.jflowFromLinks.findIndex(l => l === link);\n        if(idx !== -1) {\n            obj.jflowFromLinks.splice(idx, 1);\n        }\n\n        obj = this._getMap(sourceTo);\n        idx = obj.jflowToLinks.findIndex(l => l === link);\n        if(idx !== -1) {\n            obj.jflowToLinks.splice(idx, 1);\n        }\n    }\n}\n\nexport default NodeWeakMap;\n\n","/**\n * 绘图栈\n * @extends Array\n */\nclass InstanceStack extends Array {\n    constructor() {\n        super();\n        this._currentHit = null;\n    }\n    /**\n     * 绘制当前栈\n     * @param {Context2d} ctx - canvas context2d\n     */\n    render(ctx, condition) {\n        let movingTarget;\n        this.forEach(instance => {\n            if(instance._isMoving) {\n                movingTarget = instance;\n                return;\n            }\n            if(instance.visible && (!condition || condition(instance))) {\n                if(instance.beforeRender) {\n                    if(!instance.beforeRender(ctx)){\n                        return;\n                    }\n                }\n                ctx.save();\n                instance.render(ctx);\n                ctx.restore();\n            }\n        });\n        if(movingTarget) {\n            ctx.save();\n            // if(movingTarget.reflow && !movingTarget._reflowed) {\n            //     movingTarget.reflow();\n            //     movingTarget._reflowed = true;\n            // }\n            movingTarget.render(ctx);\n            ctx.restore();\n        }\n    }\n\n    resetHitStatus() {\n        this._currentHit = null;\n        this.forEach(i => {\n            if(i._stack) {\n                i._stack.resetHitStatus();\n            }\n            i._isHit = false;\n        })\n    }\n\n    /**\n     * 碰撞对象过滤条件\n     * @name InstanceStack~InstanceFilter\n     * @function\n     * @param {Instance} instance - 当前对象\n    */\n    /**\n     * 碰撞检测\n     * @param {number[]} point - 碰撞点\n     * @param {InstanceStack~InstanceFilter} condition - 碰撞对象过滤条件\n     * @return {Instance}\n     */\n    checkHit(point, condition, currentConstraint){\n        let i = this.length - 1;\n        while(i >= 0) {\n            const instance = this[i];\n            \n            if(instance.visible && !instance.ignoreHit) {\n                if(condition && condition(instance)) {\n                    i--\n                    continue;\n                }\n                if(currentConstraint && !currentConstraint(instance)) {\n                    i--\n                    continue\n                }\n                const ishit = instance.isHit(point, condition);\n                \n                if(ishit) {\n                    if(this._currentHit !== instance) {\n                        if(this._currentHit) {\n                            this._currentHit._isHit = false;\n                        }\n                        instance._isHit = true;\n                        this._currentHit = instance;\n                    }\n                    if(typeof ishit !== 'boolean') {\n                        return ishit;\n                    }\n                    return instance;\n                } else {\n                    instance._isHit = false;\n                }\n                \n            }\n            i--\n        }\n        this._currentHit = null;\n        return null;\n    }\n    /**\n     * 获取当前层栈的最小外接矩形\n     * @return {number[][]} - 外接矩形坐标\n     */\n    getBoundingRectPoints() {\n        const points = [];\n        this.forEach(instance => {\n            if(instance.visible && !instance.absolutePosition) {\n                const rect = instance.getBoundingRect()\n                points.push([rect[0], rect[1]]);\n                points.push([rect[2], rect[3]]);\n            }\n        });\n        return points;\n    }\n\n    /**\n     * 获取当前层栈的锚点矩形\n     * @return {number[][]} - 锚点矩形坐标\n     */\n    getAnchorRectPoints() {\n        const points = [];\n        this.forEach(instance => {\n            if(instance.visible && !instance.absolutePosition) {\n                points.push(instance.anchor);\n            }\n        });\n        return points;\n    }\n}\n\nexport default InstanceStack;\n","import InstanceStack from './stack';\n// import { setUniqueId, getUniqueId } from '../utils/functions';\n/**\n * 对象栈 mixin 用于方便控制节点栈和连线栈\n *\n * @mixin\n */\nconst StackMixin = {\n    /** @property {Node[]}          - 对象数组 */\n    instances: [],\n    /** @property {BaseLink[]}      - 连线数组 */\n    links: [],\n    /** @property {InstanceStack}       - 对象栈 */\n    _stack: null,\n    /** @property {InstanceStack}       - 连线栈 */\n    _linkStack: null,\n    /**\n     * 初始化对象栈\n     * @param {JflowConfigs} configs - 配置\n     */\n    initStack({ data }) {\n        this._stack = new InstanceStack();\n        this._linkStack = new InstanceStack();\n        if(!data) return;\n        this.instances = data.instances;\n        this.links = data.links;\n        this.instances.forEach(i => { \n            this._stack.push(i);\n            i._belongs = this;\n        })\n        this.links.forEach((link) => {\n            this._linkStack.push(link);\n            link._belongs = this;\n        });\n    },\n    /**\n     * 加入节点对象\n     * @param {Node} instance - 节点对象\n     */\n    addToStack(instance) {\n        instance._belongs = this;\n        this._stack.push(instance);\n        // this.recalculate()\n    },\n    /**\n     * 替换对象\n     * @param {Instance} target - 被替换的对象\n     * @param {Instance} instance - 替换对象\n     */\n    replaceFromStack(target, instance) {\n        const index = this._stack.findIndex(i => i === target);\n        this._stack.splice(index, 1, instance);\n        target._belongs = null;\n        instance._belongs = this;\n        // this.recalculate()\n    },\n    /**\n     * 加入连线对象\n     * @param {BaseLink} instance - 连线对象\n     */\n    addToLinkStack(link) {\n        link._belongs = this;\n        this._linkStack.push(link);\n    },\n    /**\n     * 删除节点对象\n     * @param {Node} target - 节点对象\n     */\n    removeFromStack(target) {\n        // this.removeLinkOnInstance(target);\n        const index = this._stack.findIndex(i => i === target);\n        if(index !== -1) {\n            this._stack.splice(index, 1);\n        }\n        // this.recalculate()\n    },\n    /**\n     * 删除连线对象\n     * @param {Node} target - 连线对象\n     */\n    removeFromLinkStack(target) {\n        const index = this._linkStack.findIndex(i => i === target);\n        if(index !== -1) {\n            this._linkStack.splice(index, 1);\n        }\n    },\n   \n    emptyLink() {\n        this._linkStack = new InstanceStack();\n    },\n    /**\n     * 重置当前栈中对象的位置\n     */\n    resetChildrenPosition() {\n        this._stack.forEach(i => {\n            i.anchor = [0,0]\n        });\n    },\n\n    addInstanceToLink(targetLink, instance) {\n        this.addToStack(instance);\n        const { from, to } = targetLink;\n        const index = this._linkStack.findIndex(l => l === targetLink);\n        const _constuctor = targetLink.__proto__.constructor;\n        const l1 = new _constuctor({\n            from, \n            to: instance,\n        });\n        l1._belongs = this;\n        const l2 = new _constuctor({\n            from: instance, \n            to,\n        });\n        l2._belongs = this;\n\n        this._linkStack.splice(index, 1, l1, l2);\n    },\n    \n    /**\n     * 循环当前栈中节点\n     * @property {stackIteratorCallback} 循环访问栈中每个节点\n     */\n    interateNodeStack(callback) {\n        this._stack.forEach(instance => {\n            callback(instance);\n        })\n    }   \n    /**\n    * 循环访问栈中每个节点\n    * @callback stackIteratorCallback\n    * @param {Node} instance 栈中节点\n    */\n}\n\nexport default StackMixin;","/**\n * Layout mixin 配置\n * @typedef {Object} LayoutMixin~LayoutConfigs\n * @property {Layout} layout             - 布局对象 \n */\n/**\n * 布局 mixin 用于注册和方便控制布局\n *\n * @mixin\n */\nconst LayoutMixin = {\n    /** @property {Layout}      - 布局对象 */\n    _layout: null,\n    /**\n     * 初始化布局\n     * @param {LayoutMixin~LayoutConfigs} configs - 配置\n     */\n    initLayout(configs) {\n        this._layout = configs.layout;\n    },\n    /**\n     * 从当前层出发，向上层递归重排\n     */\n    recalculateUp() {\n        let dirty = true;\n        if(this.getBoundingDimension) {\n            const { width: wold, height: hold } = this.getBoundingDimension();\n            if(this.resetChildrenPosition) {\n                this.resetChildrenPosition();\n            }\n            if(this._getBoundingGroupRect){\n                this._getBoundingGroupRect();\n            }\n            this.reflow();\n            if(this._getBoundingGroupRect){\n                this._getBoundingGroupRect();\n            }\n            const { width: wnow, height: hnow } = this.getBoundingDimension();\n            dirty = (wold !== wnow || hold !== hnow)\n        } else {\n            this.reflow();\n        }\n        if(this._belongs && dirty) {\n            this._belongs.recalculateUp();\n        }\n    },\n    /**\n     * 重新计算布局，相当于浏览器里面重排，并重算当前布局下的最小外接矩形\n     */\n    recalculate() {\n        this.reflow();\n        if(this._getBoundingGroupRect){\n            this._getBoundingGroupRect();\n        }\n    },\n    /**\n     * 布局静态检查\n     * @param {Instance} instance - 检查单元\n     * @return {Boolean} - 检查结果 \n     */\n    staticCheck(instance) {\n        if(this._layout) {\n            return this._layout.staticCheck(instance, this);\n        }\n        return false;\n    },\n    /**\n     * 重新计算布局，相当于浏览器里面重排\n     */\n    reflow() {\n        if(this._layout) {\n            this._layout.reflow(this);\n        }\n    },\n}\n\nexport default LayoutMixin;","\nexport default {\n    initAnime() {\n        this.anime_queue = [];\n        this.__animeClock__ = undefined;\n        // this.animeclock = undefined;\n        // this.frameRendered = false;\n    },\n    // setAnimeClock(time) {\n    //     if(time !== this.animeclock) {\n    //         this.frameRendered = false;\n    //         this.animeclock = time;\n    //     }\n    // },\n\n    // hasAnimeAndFrameRendered() {\n    //     return this.anime_queue.length && this.frameRendered;\n    // },\n\n    // setFrameRendered() {\n    //     if(this.anime_queue.length) {\n    //         this.frameRendered = true;\n    //     }\n    // },\n\n    requestJFlowAnime(frameCallBack) {\n        const meta = this.enqueueAnime(frameCallBack);\n        this._runAnime();\n        return meta;\n    },\n\n    enqueueAnime(callback) {\n        const animeMeta = {\n            start: undefined,\n            callback,\n            cancel: () => {\n                this._cancelAnime(animeMeta);\n                this._render();\n            }\n        }\n        this.anime_queue.push(animeMeta);\n        return animeMeta;\n    },\n\n    _cancelAnime(meta) {\n        const idx = this.anime_queue.findIndex(m => m === meta);\n        ~idx && this.anime_queue.splice(idx, 1);\n        \n    },\n\n    runAnime() {\n        this._runAnime();\n        // requestAnimationFrame(this._runAnime.bind(this));\n    },\n    _runAnime() {\n        if (this.anime_queue.length) {\n            requestAnimationFrame(() => {\n                this.scheduleRender();\n                this._runAnime();\n            })  \n            // requestAnimationFrame(this._runAnime.bind(this))\n        }\n    },\n\n    runAnimeFrame() {\n        this.anime_queue.forEach(meta => {\n            const timestamp = Date.now();\n            if(!meta.start) {\n                meta.start = timestamp;\n            }\n            const elapsed = timestamp - meta.start;\n            meta.callback(elapsed);\n        });\n    }\n}","import { createCanvas } from '../utils/canvas';\nexport default {\n    // 传入一个别的 context2d 来绘制\n    captureMap(wrapper, {\n        padding = 0,\n        placement = 'normal',\n    }) {\n\n        this._getBoundingGroupRect();\n        const { \n            width: p_width, \n            height: p_height, \n            x: p_x, \n            y: p_y \n        } = this.bounding_box;\n        let miniMap = this.miniMap;\n        if(!miniMap) {\n            this.miniMap = createCanvas(wrapper);\n            const {\n                width, height,\n                raw_width,\n                raw_height,\n            } = this.miniMap;\n            this.addEventListener('zoompan', () => {\n                this._renderMap && this._renderMap();\n            })\n            let pressDown = false;\n            this.miniMap.canvas.addEventListener('pointerdown', (event) => {\n                let { offsetX, offsetY, deltaX, deltaY } = event\n                pressDown = true;\n                this._onMoveMap && this._onMoveMap(offsetX, offsetY)  \n            })\n            this.miniMap.canvas.addEventListener('pointermove', (event) => {\n                let { offsetX, offsetY, deltaX, deltaY } = event\n                if(pressDown) {\n                    this._onMoveMap && this._onMoveMap(offsetX, offsetY)\n                }\n                if(offsetY < 5 || offsetX < 5 || offsetX > width-5 || offsetY > height-5) {\n                    pressDown = false;\n                }\n            })\n            this.miniMap.canvas.addEventListener('pointerup', () => {\n                pressDown = false;\n            })\n\n            const caheCanvas = document.createElement('canvas');\n            caheCanvas.width = raw_width;\n            caheCanvas.height = raw_height;\n            this.cacheMinimapCtx = caheCanvas.getContext('2d');\n        }\n        const { \n            width,\n            height,\n            raw_width,\n            raw_height,\n            left,\n            top,\n            scale,\n            ctx\n        } = this.miniMap\n        const pad2 = padding * 2;\n        const pad = padding;\n        const r1 = (width - pad2) / p_width;\n        const r2 = (height - pad2) / p_height;\n        const r = Math.min(r1, r2);\n        \n        let m_x = 0;\n        let m_y = 0;\n\n        if(placement === 'center') {\n            m_y = (height - p_height * r) / 2 - p_y * r;\n            m_x = (width - p_width * r) / 2 - p_x * r;\n        } else {\n            if(r1 < r2) {\n                m_y = (height - p_height * r) / 2 - p_y * r;\n                m_x = pad;\n            } else {\n                m_x = (width - p_width * r) / 2 - p_x * r;\n                m_y = pad;\n            }\n        }\n        const cachectx = this.cacheMinimapCtx;\n        cachectx.setTransform();\n        cachectx.clearRect(0, 0, raw_width, raw_height);\n        cachectx.scale(scale, scale);\n        cachectx.transform(r, 0, 0, r, m_x, m_y);\n        // ctx.fillStyle = 'red';\n        // ctx.arc( 30, 30, 100, 0, 2*Math.PI);\n        // ctx.fill()\n        // debugger\n        const br = [0,0,0,0]\n        if(this.NodeRenderTop) {\n            this._linkStack.render(cachectx, (link) => { link.isInViewBox(br); return true; });\n            // this._linkStack.render(cachectx);\n            this._stack.render(cachectx);\n        } else {\n            this._stack.render(cachectx);\n            this._linkStack.render(cachectx, (link) => { link.isInViewBox(br); return true; });\n        }\n        const _cacheMapImageData = cachectx.getImageData(0, 0,raw_width, raw_height);\n        this._renderMap = () => {\n            ctx.save();\n            ctx.setTransform();\n            ctx.clearRect(0, 0, raw_width, raw_height);\n            // if(!i) {\n            ctx.scale(scale, scale);\n            ctx.putImageData(_cacheMapImageData, 0, 0);\n            ctx.transform(r, 0, 0, r, m_x, m_y);\n            const [x, y, t, d] = this._getViewBox();\n            ctx.beginPath();\n            ctx.rect(x, y,  t-x, d-y);\n            ctx.setTransform();\n            ctx.rect(0, 0, raw_width, raw_height);\n            ctx.clip(\"evenodd\");\n            \n            ctx.fillStyle = 'rgba(0,0,0,0.4)';\n            ctx.fillRect(0, 0, raw_width, raw_height);\n            ctx.restore();\n            // }\n        }\n        this._renderMap();\n\n        this._onMoveMap = (offsetX, offsetY) => {\n            const [x, y, t, d] = this._getViewBox();\n            // const w = t-x;\n            const a = (t-x)/2 + x;\n            const b = (d-y)/2 + y;\n            \n            const p = [a * r + m_x, b * r + m_y]\n            this._recalculatePosition((p[0] - offsetX)/ r * this.scale, (p[1] - offsetY)/ r * this.scale);\n            this._render();\n            this._renderMap();\n        }\n        // this._render(ctx);\n    }\n\n\n}","export class ScrollBar {\n    constructor(dir, configs = {}) {\n        this.anchor = [0,0];\n        this.width = configs.barWidth || 4;\n        this.height = configs.barWidth || 4;  \n        this.barMarginX = 0;\n        this.barMarginY = 0\n        this.dir = dir;\n        this.plainColor = configs.plainColor || 'rgba(0, 0, 0, 0.15)';\n        this.focusColor = configs.focusColor || 'rgba(0, 0, 0, 0.25)';\n        this.isFocus = false;\n    }\n    render(ctx) {\n        const [x, y] = this.anchor;\n        ctx.save();\n        ctx.beginPath();\n        if(this.dir === 'x') {\n            const radius = this.height / 2;\n            const cy = y + radius;\n            const by = y + this.height;\n            const rc = x + this.width - this.barMarginX*2 - radius;\n            const lc = x + this.barMarginX + radius\n            ctx.moveTo(lc, by);\n            ctx.arc(lc, cy, radius, Math.PI/2, Math.PI/2*3);\n            ctx.lineTo(rc, y);\n            ctx.arc(rc, cy, radius,  -Math.PI/2, Math.PI/2);\n            ctx.closePath();\n  \n        } else {\n            const radius = this.width / 2;\n            const tc = y + this.barMarginY + radius;\n            const bc = y + this.height - this.barMarginY*2 - radius\n            const cx = x + radius;\n            const rx = x + this.width;\n            ctx.moveTo(x, tc);\n            ctx.arc(cx, tc, radius, -Math.PI, 0);\n            ctx.lineTo(rx, bc);\n            ctx.arc(cx, bc, radius, 0, Math.PI);\n            ctx.closePath();\n            \n        }\n                //   ctx.rect(\n                // x + this.barMarginX,\n                // y + this.barMarginY,\n                // this.width - this.barMarginX*2,\n                // this.height - this.barMarginY*2);\n\n        ctx.fillStyle = this.isFocus ? this.focusColor : this.plainColor;\n        ctx.fill();\n        ctx.restore();\n    }\n    isHit(point) {\n        const anchor = this.anchor;\n        const w = this.width;\n        const h = this.height;\n        return point[0] > anchor[0] - 5\n            && point[0] < anchor[0] + w + 5\n            && point[1] > anchor[1] - 5\n            && point[1] < anchor[1] + h + 5;\n    }\n}\nexport default {\n    initScrollBar(configs = {}) {\n        const {\n            barColor,\n            barFocusColor,\n            barMarginX,\n            barMarginY,\n            barWidth,\n        } = configs;\n        this._scrollbarEnable = true;\n        this._scrollbarX = new ScrollBar('x', {\n            plainColor: barColor,\n            focusColor: barFocusColor,\n            barWidth,\n        });\n        this._scrollbarX.barMarginX = barMarginX || 5;\n        \n        this._scrollbarY = new ScrollBar('y', {\n            plainColor: barColor,\n            focusColor: barFocusColor,\n            barWidth\n        });\n        this._scrollbarY.barMarginY = barMarginY || 5;\n\n        this._scrollBarStatus = {\n            dragging: false,\n            target: null,\n            xscale: undefined,\n            yscale: undefined,\n\n            barInitX: 0,\n            barInitY: 0,\n        }\n        \n        this.addEventListener('zoompan', () => {\n            this.scrollBarOnPanAndZoom();\n        })\n        \n        this.scrollBarOnPanAndZoom();\n\n        this.canvas.addEventListener('pointerdown', e => {\n            const { offsetX, offsetY, clientX, clientY } = e;\n            this.onScrollbarPressStart(offsetX, offsetY, clientX, clientY)\n        })\n    },\n    checkScrollDragging() {\n        return this._scrollBarStatus && this._scrollBarStatus.dragging;\n    },\n    onScrollbarPressStart(offsetX, offsetY, clientX, clientY) {\n        const xhit = this._scrollbarX.isHit([offsetX, offsetY]);\n        if(xhit) {\n            Object.assign(this._scrollBarStatus, {\n                dragging: true,\n                target: this._scrollbarX,\n                barStartX: this._scrollbarX.anchor[0],\n                barInitX: clientX,\n            });\n        }\n        const yhit = this._scrollbarY.isHit([offsetX, offsetY]);\n        if(yhit) {\n            Object.assign(this._scrollBarStatus, {\n                dragging: true,\n                target: this._scrollbarY,\n                barStartY: this._scrollbarY.anchor[1],\n                barInitY: clientY,\n            });\n        }\n        const f = (e => {\n            const { offsetX, offsetY, clientX, clientY } = e;\n            this.onDraggingScrollbar(offsetX, offsetY, clientX, clientY)\n        }).bind(this);\n        \n        document.addEventListener('pointermove', f);\n        const t = (e => {\n            Object.assign(this._scrollBarStatus, {\n                dragging: false,\n                target: null,\n                x: undefined,\n                y: undefined,\n            });\n            document.removeEventListener('pointermove', f);\n            document.removeEventListener('pointerup', t);\n            this.canvas.removeEventListener('pointerup', t);\n        }).bind(this);\n        this.canvas.addEventListener('pointerup', t, {\n            once: true\n        })\n        document.addEventListener('pointerup', t, {\n            once: true\n        })\n    },\n    onDraggingScrollbar(offsetX, offsetY, clientX, clientY) {\n        if(this._scrollbarEnable && this._scrollBarStatus.dragging) {\n            const {\n                target,\n                barInitX,\n                barStartX,\n                barInitY,\n                barStartY,\n                xscale,\n                yscale,\n                scollbarHeight,\n                scollbarWidth,\n                realR,\n                realL,\n                realT,\n                realB,\n            } = this._scrollBarStatus;\n            const { actual_width, actual_height } = this.canvasMeta;\n            const { \n                x: p_x, \n                y: p_y \n            } = this.bounding_box;\n            // console.log(target.dir, realT, realB)\n            if(target.dir === 'x') {\n                const deltaX = clientX - barInitX;\n                const xnew = barStartX + deltaX;\n                const q = target.anchor[0] = Math.max(Math.min(xnew, actual_width - scollbarWidth), 0);\n                const ratioInX = q / actual_width;\n                // const y = (realB - (realB - realT) * ratioInY) * this.scale\n                const ratioX = (realR - realL) * ratioInX + realL\n                const x = (p_x - ratioX) * this.scale\n                Object.assign(this.position, {\n                    offsetX: x - p_x * this.scale,\n                    x,\n                });\n            }\n\n            if(target.dir === 'y') {      \n                const deltaY = clientY - barInitY;\n                const ynew = barStartY + deltaY;\n                const q = target.anchor[1] = Math.max(Math.min(ynew, actual_height - scollbarHeight), 0);;\n                const ratioInY = q / actual_height;\n                // const y = (realB - (realB - realT) * ratioInY) * this.scale\n                const ratioY = (realB - realT) * ratioInY + realT\n                const y = (p_y - ratioY) * this.scale\n                Object.assign(this.position, {\n                    offsetY: y - p_y * this.scale,\n                    y,\n                });\n            }\n            this.scheduleRender()\n            return true;\n        }\n        return false;\n    },\n    checkScrollBarHover(offsetX, offsetY) {\n        if(this._scrollbarEnable) {\n            const xhit = this._scrollbarX.isHit([offsetX, offsetY]);\n            if(xhit) {\n                // this._scrollBarStatus.hoverTarget = this._scrollbarX;\n                if(!this._scrollbarX.isFocus) {\n                    this._scrollbarX.isFocus = true;\n                    this.scheduleRender();\n                }\n                this.canvas.style.cursor = 'default';\n                return true;\n            }\n            const yhit = this._scrollbarY.isHit([offsetX, offsetY]);\n            if(yhit) {\n                // this._scrollBarStatus.hoverTarget = this._scrollbarY;\n                if(!this._scrollbarY.isFocus) {\n                    this._scrollbarY.isFocus = true;\n                    this.scheduleRender();\n                }\n                this.canvas.style.cursor = 'default';\n                return true;\n            }\n        }\n        return false;\n    },\n    resetScrollBarHover() {\n        if(this._scrollbarEnable) {\n            if(this._scrollbarY.isFocus || this._scrollbarX.isFocus) {\n                this._scrollbarY.isFocus = false;\n                this._scrollbarX.isFocus = false;\n                this.scheduleRender();\n            }\n        }\n    },\n    _getScrollViewBoundingbox() {\n        const padding = 120;\n        const { \n            width: p_width, \n            height: p_height, \n            x: p_x, \n            y: p_y \n        } = this.bounding_box;\n        const p = padding;\n        const p2 = padding * 2;\n        return {\n            width: p_width + p2,\n            height: p_height + p2,\n            x: p_x - p,\n            y: p_y - p\n        }\n    },\n    scrollBarOnPanAndZoom() {\n        if(!this._scrollbarEnable || this._scrollBarStatus.dragging) {\n            return;\n        }\n        const { \n            width: p_width, \n            height: p_height, \n            x: p_x, \n            y: p_y \n        } = this._getScrollViewBoundingbox();\n        \n        let [x, y, r, b] = this._getViewBox();\n        const realR = Math.max(r, p_x + p_width);\n        const realL = Math.min(x, p_x);\n        const realT = Math.min(y, p_y);\n        const realB = Math.max(b, p_y + p_height);\n        const vw = r - x;\n        const vh = b - y;\n        const { actual_width, actual_height } = this.canvasMeta;\n        const xscale = vw / (realR - realL)\n        if(xscale < 1)  {\n            const scollbarWidth = actual_width * xscale;\n            const anchorX = (x - realL) * xscale * this.scale;\n            this._scrollbarX.anchor = [anchorX, actual_height - 10];\n            this._scrollbarX.width = scollbarWidth;\n            this._scrollBarStatus.scollbarWidth = scollbarWidth;\n        }\n        \n        const yscale = vh / (realB - realT);\n        if(yscale < 1)  {\n            const scollbarHeight = actual_height * yscale;\n            const anchorY = (y - realT) * yscale * this.scale;\n            this._scrollbarY.anchor = [actual_width - 10, anchorY];\n            this._scrollbarY.height = scollbarHeight;\n            this._scrollBarStatus.scollbarHeight = scollbarHeight;\n        }\n\n        Object.assign(this._scrollBarStatus, {\n            yscale,\n            xscale,\n            realR,\n            realL,\n            realT,\n            realB,\n        })\n        \n    },\n    resetScollBarStatus() {\n        if(this._scrollbarEnable) {\n            Object.assign(this._scrollBarStatus, {\n                dragging: false,\n                target: null,\n                x: undefined,\n                y: undefined,\n            });\n        }\n    },\n    renderScrollBar(ctx) {\n        if(this._scrollbarEnable) {\n            ctx.setTransform();\n            ctx.scale(this.dpr, this.dpr);\n            const {\n                xscale,\n                yscale\n            } = this._scrollBarStatus;\n            if(xscale < 1)  {\n                this._scrollbarX.render(ctx);\n            }\n            if(yscale < 1)  {\n                this._scrollbarY.render(ctx);\n            }\n        }\n    }\n}","export default {\n    initSchedule() {\n        this.__clock__ = undefined;\n    },\n    scheduleRender(callback) {\n        requestAnimationFrame((timestamp) => {\n            const isFirstTime = this.__clock__ !== timestamp\n            if(isFirstTime) {\n                this.__render();\n            }\n            if(callback) {\n                callback(timestamp);\n            }\n            this.__clock__ = timestamp;\n        })\n    }\n}","/**\n * JFlow 抛出事件\n * @extends CustomEvent\n * @property {Event}  originEvent      - 原始事件\n * @property {Instance} target         - 事件触发对象\n * @property {JFlow} jflow             - JFlow 对象\n * @property {boolean} bubbles         - 冒泡标识\n */\nclass JFlowEvent extends CustomEvent{\n    constructor(event, configs = {}) {\n        const detail = {\n            ...configs,\n            originEvent: configs.event,\n            target: configs.target,\n            jflow: configs.jflow,\n            bubbles: configs.bubbles || false,    \n        }\n        super(event, {\n            detail\n        });\n    }\n}\n\nexport default JFlowEvent;","/**\n * 事件处理函数\n * @name EventAdapter~Handler\n * @function\n * @param {Event} event - 原生事件\n * @param {JFlow} jflow - 当前jflow 对象\n */\n\n/**\n * EventAdapter 对象 plugin 配置\n * @typedef {Object} EventAdapter~pluginDef\n * @property {Object} canvas - canvas 相关的事件\n * @property {EventAdapter~Handler} canvas.eventName - 注册 canvas 上的事件处理\n * @property {Object} document - document 相关的事件\n * @property {EventAdapter~Handler} document.eventName - 注册 document 上的事件处理\n */\n\nfunction getDefaultPlugin() {\n    let _mouseStatus = {\n        // x: undefined,\n        // y: undefined,\n        // enableClick: false,\n        pointerDown: false,\n        dirty: false,\n    }\n    return {\n        canvas: {\n            wheel: function (event, jflow) {\n                event.preventDefault();\n                let { offsetX, offsetY, deltaX, deltaY } = event\n                if(event.ctrlKey) { \n                    deltaY = -deltaY;\n                    jflow.zoomHandler(offsetX, offsetY, deltaX, deltaY, event);\n                } else {\n                    jflow.panHandler(-deltaX, -deltaY, event);\n                }\n            },\n            pointerdown: function (event, jflow) {\n                const { offsetX, offsetY, deltaY, button } = event\n                if(button !== 0) return;\n                _mouseStatus.pointerDown = true;\n                \n                jflow.pressStartHandler(offsetX, offsetY, event);\n            },\n            pointermove: function (event, jflow) {\n                const { offsetX, offsetY } = event\n                if(_mouseStatus.pointerDown) {\n                    _mouseStatus.dirty = true;\n                }\n                jflow.pressMoveHandler(offsetX, offsetY, event);\n            },\n            pointerup: function (event, jflow) {\n                event.preventDefault();\n                // event.stopPropagation(); ALWAYS ENABLE PROPAGATION \n                const { offsetX, offsetY, button } = event\n                if(button !== 0) return;\n                if(_mouseStatus.pointerDown && _mouseStatus.dirty) {\n                    _mouseStatus.pointerDown = false;\n                    _mouseStatus.dirty = false;\n                    jflow.pressUpHanlder(false, event);\n                }\n            },\n            contextmenu: function (event, jflow) {\n                event.preventDefault();\n                event.stopPropagation();\n                const { offsetX, offsetY } = event;\n                jflow.contextMenuHanlder(offsetX, offsetY, event);\n            },\n            dblclick: function (event, jflow) {\n                event.preventDefault();\n                event.stopPropagation();\n                const { offsetX, offsetY } = event;\n                jflow.dblclickHandler(offsetX, offsetY, event);\n            },\n            click: function(event, jflow) {\n                event.preventDefault();\n                event.stopPropagation();\n                const { offsetX, offsetY } = event;\n                if(!_mouseStatus.dirty) {\n                    _mouseStatus.pointerDown = false;\n                    _mouseStatus.dirty = false;\n                    jflow.clickHanlder(offsetX, offsetY, event);\n                }\n                \n            }\n        },\n        document: {\n            pointerup: function(event, jflow) {\n                jflow.pressUpHanlder(true, event);\n            }\n        }\n    }\n}\n\n/** \n * EventAdapter 对象\n * EventAdapter 通过 plugin 的形式实现多种交互方式的映射\n * @constructor EventAdapter\n */\nclass EventAdapter {\n    constructor(plugin = {}) {\n        this.plugin = getDefaultPlugin();\n        this.use(plugin);\n        this.canvasHandlers = [];\n        this.documentHandlers = [];\n    }\n    use(plugin = {}) {\n        const { canvas: ca, document: docObj } = plugin;\n        if(ca) {\n            for(let eventName in ca){\n                if (ca.hasOwnProperty(eventName)) {\n                    this.plugin.canvas[eventName] = ca[eventName];\n                }\n            }\n        }\n        if(docObj) {\n            for(let eventName in docObj){\n                if (docObj.hasOwnProperty(eventName)) {\n                    this.plugin.document[eventName] = docObj[eventName];\n                }\n            }\n        }\n    }\n\n    apply(jflow) {\n        const { canvas: ca, document: docObj } = this.plugin;\n        const canvas = jflow.canvas;\n        for(let eventName in ca){\n            const handler = ca[eventName];\n            function handlerWrapperd (e) {\n                handler(e, jflow);\n            }\n            canvas.addEventListener(eventName, handlerWrapperd)\n            this.canvasHandlers.push({\n                eventName,\n                handlerWrapperd\n            });\n        }\n        for(let eventName in docObj){\n            let handler;\n            let options = {}\n            if(typeof docObj[eventName] === 'function') {\n                handler = docObj[eventName]\n            } else {\n                handler = docObj[eventName].handler;\n                Object.assign(options, docObj[eventName].options);\n            }\n                \n            function handlerWrapperd (e) {\n                handler(e, jflow);\n            }\n            document.addEventListener(eventName, handlerWrapperd, options)\n            this.documentHandlers.push({\n                eventName,\n                handlerWrapperd,\n                options\n            });\n        }\n    }\n\n    unload(jflow) {\n        const canvas = jflow.canvas;\n        this.canvasHandlers.forEach(({ eventName, handlerWrapperd }) => {\n            canvas.removeEventListener(eventName, handlerWrapperd);\n        });\n        this.documentHandlers.forEach(({ eventName, handlerWrapperd, options }) => {\n            console.log('unload', eventName)\n            document.removeEventListener(eventName, handlerWrapperd, options);\n        })\n    }\n}\n\nexport default EventAdapter;\n","import Node from './node';\nimport StackMixin from './stackMixin';\nimport LayoutMixin from './layoutMixin';\nimport { bounding_box } from '../utils/functions';\nimport { DIRECTION } from '../utils/constance';\nconst GroupMixin = {\n    ...StackMixin,\n    ...LayoutMixin,\n    _setPadding(configs) {\n        this.padding = {\n            top: configs.paddingTop || configs.padding || 0,\n            right: configs.paddingRight || configs.padding || 0,\n            bottom: configs.paddingBottom || configs.padding || 0,\n            left: configs.paddingLeft || configs.padding || 0,\n        };\n    },\n    _setMargin(configs)  {\n        this.margin = {\n            top: configs.marginTop || configs.margin || 0,\n            right: configs.marginRight || configs.margin || 0,\n            bottom: configs.marginBottom || configs.margin || 0,\n            left: configs.marginLeft || configs.margin || 0,\n        };\n    },\n    _getCenter() {\n        const anchor = this.anchor;\n        const padding = this.padding;\n        const margin = this.margin;\n        const mx = (margin.left - margin.right)/2;\n        const my = (margin.top - margin.bottom)/2;\n        const centerX = (padding.left - padding.right)/2 + mx;\n        const centerY = (padding.top - padding.bottom)/2 + my;\n        this._shape.anchor = [anchor[0] + mx, anchor[1] + my];\n        return [anchor[0] + centerX, anchor[1] + centerY];\n    },\n    setAnchorX(x) {\n        this.anchor[0] = x;\n        this._getCenter(); \n    },\n    setAnchorY(y) {\n        this.anchor[1] = y;\n        this._getCenter(); \n    },\n    setAnchor(x, y) {\n        this.anchor[0] = x;\n        this.anchor[1] = y;\n        this._getCenter(); \n    },\n    _calculatePointBack(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this._getCenter(); \n        const p = [gx - cx, gy - cy]\n        return p\n    },\n    _calculatePointBackWithPoint(a, b, arr, idx1, idx2) {\n        const anchor = this.anchor;\n        const padding = this.padding;\n        const margin = this.margin;\n        arr[idx1] = a - ( anchor[0] + (padding.left - padding.right)/2 + (margin.left - margin.right)/2 );\n        arr[idx2] = b - ( anchor[1] + (padding.top - padding.bottom)/2 + (margin.top - margin.bottom)/2 );\n    },\n    /**\n     * 反算回 canvas 顶层坐标\n     * @param {Number[]} point\n     * @return {Number[]} 世界坐标\n     */\n    calculateToCoordination(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this._getCenter(); \n        // const p = [cx + anchor[0] - spanH, cy + anchor[1] - spanV];\n        const p = [gx + cx, gy + cy]\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            return this._belongs.calculateToCoordination(p);\n        } else {\n            return p;\n        }\n    },\n    /**\n     * 反算回页面的像素坐标，重载 {@link Instance#calculateToRealWorld}\n     * @param {Number[]} point\n     * @return {Number[]} 世界坐标\n     */\n    calculateToRealWorld(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this._getCenter(); \n        const p = [gx + cx, gy + cy]\n        if(this._belongs && this._belongs.calculateToRealWorld) {\n            return this._belongs.calculateToRealWorld(p);\n        }\n    },\n    clone() {\n        const C = this.constructor;\n        const configs = Object.assign({}, this._rawConfigs, {\n            layout: this._layout && this._layout.clone(),\n        })\n        const t = new C(configs);\n        this.interateNodeStack((instance) => {\n            t.addToStack(instance.clone());\n        })\n        t.recalculate();\n        t.visible = this.visible;\n        return t;\n    },\n    getBoundingDimension() {\n        return {\n            width: this.width,\n            height: this.height,\n        }\n    },\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    },\n    getIntersectionsInFourDimension() {\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n        return {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n            [DIRECTION.SELF]:   [x2+w*0.618, y2+h*0.618]\n        }\n    },\n    calculateIntersection(point) {\n        const [x1, y1] = point;\n        const [x2, y2] = this.anchor;\n        const w = this.width/2;\n        const h = this.height/2;\n        const vecx = x2 - x1;\n        const vecy = y2 - y1;\n        const theta1 = h/w;\n        const theta2 = Math.abs(vecy/vecx);\n        const dirx = x1 > x2;\n        const diry = y1 > y2;\n        let x, y;\n        if(theta2 < theta1) {\n            x = x2 + (dirx?w:-w);\n            y = w * (diry?theta2:-theta2) + y2;\n        } else {\n            y = y2 + (diry?h:-h);\n            x = h / (dirx?theta2:-theta2) + x2;\n        }\n        return [x, y];\n    },\n    onEnterViewbox() {\n        this.interateNodeStack((instance) => {\n            instance.onEnterViewbox();\n        })\n    },\n    onLeaveViewbox() {\n        this.interateNodeStack((instance) => {\n            instance.onLeaveViewbox();\n        })\n    },\n    destroy() {\n        this._shape.destroy();\n        this.interateNodeStack((instance) => {\n            instance.destroy();\n        })\n    }, \n}\n\nfunction defaultShift(width, height) {\n    return [width, height];\n}\n\n/**\n * 根据paddingbox宽高来计算shapeshiftbox的宽高\n * @function shapeShift\n * @param {number} width            - paddingBox宽\n * @param {number} height           - paddingBox高\n * @return {number[]}\n */\n\n/**\n * 组工厂函数，用于通过JFlow 绘图节点来创建不同的组\n * @global \n * @function GroupFactory\n * @param {Node} jflowNodeConstructor - 绘图节点构造器\n * @param {object} options            - 配置项\n * @param {shapeShift} options.shapeShift - shift层适配方法\n * @return {Group} - 绘图节点构造器\n */\nfunction GroupFactory(jflowNodeConstructor, options = {}) {\n    const shapeShift = typeof options.shapeShift === 'function' ? options.shapeShift : defaultShift;\n\n    /**\n     * Group 配置\n     * @typedef {Object} GroupTemplate~GroupConfigs\n     * @property {number} width             - 设定宽度\n     * @property {number} minWidth          - 最小宽度\n     * @property {number} height            - 设定高度\n     * @property {number} padding          - 内边距\n     * @property {number} paddingTop          - 内上边距\n     * @property {number} paddingRight         - 内右边距\n     * @property {number} paddingBottom        - 内下边距\n     * @property {number} paddingLeft          - 内左边距\n     * @property {number} margin            - 外边距\n     * @property {number} marginTop          - 外上边距\n     * @property {number} marginRight         - 外右边距\n     * @property {number} marginBottom        - 外下边距\n     * @property {number} marginLeft          - 外左边距\n     * @property {boolean} lock            - 布局锁定状态 默认 true\n     */\n    class t extends Node {\n        /**\n        * @constructs GroupTemplate\n        * @param {GroupTemplate~GroupConfigs} configs - 组配置\n        * @mixes LayoutMixin\n        * @mixes StackMixin \n        */\n        constructor(configs) {\n            super(configs);\n            this.initStack(configs);\n            this.initLayout(configs);\n            /** @member {Node}      - 壳绘图单元 */\n            this._shape = new jflowNodeConstructor(configs);\n            this._shape.anchor = [0, 0];\n            this._shape._belongs = this;\n            this._setPadding(configs);\n            this._setMargin(configs);  \n            /** @member {Number}      - 设定宽度 */\n            this.definedWidth =     configs.width;\n            /** @member {Number}      - 最小宽度 */\n            this.minWidth =         configs.minWidth;\n            /** @member {Number}      - 设定的高度 */\n            this.definedHeight =    configs.height;\n            /** @member {Boolean}      - 组内元素是否锁定， 默认true */\n            this.lock =             configs.lock ?? true ;\n            this.display =          configs.display || 'default';\n            /** @member {Boolean}      - 组本身是否进入形状判定范围 */\n            this.transparent =      configs.transparent ?? false;\n            this._getBoundingGroupRect();\n            this.reflow();\n            this._getBoundingGroupRect();  \n            this._cacheViewBox = [];\n        }\n    }\n    Object.assign(t.prototype, GroupMixin);\n    Object.assign(t.prototype, { \n        reflow() {\n            GroupMixin.reflow.call(this);\n            const margin = this.margin;\n            const [shapeWidth, shapeHeight] = shapeShift(\n                    this.width - margin.left - margin.right,\n                    this.height - margin.top - margin.bottom, this._shape);\n            this._shape.width = shapeWidth;\n            this._shape.height = shapeHeight;\n        },\n        setConfig(configs) {\n            this._shape.setConfig(configs);\n            this._setPadding(configs);\n            this._setMargin(configs);  \n            if('opacity' in configs) {\n                this.opacity = configs.opacity\n            }\n            \n            if(configs.layout && this._layout !== configs.layout) {\n                this._layout = configs.layout;\n            }\n        },\n        _getBoundingGroupRect() {\n            const points = this._stack.getBoundingRectPoints();\n            // content box \n            const bbox = bounding_box(points);\n\n             // padding box \n            const padding = this.padding;\n            const minWidth = this.minWidth// - padding.left - padding.right;\n            const definedWidth = this.definedWidth// - padding.left - padding.right;\n            const w = bbox.width + padding.left + padding.right;\n            const h = bbox.height + padding.top + padding.bottom;\n            const paddingWidth = minWidth ? Math.max(minWidth, w) : definedWidth || w;\n            const paddingHeight = this.definedHeight || h;\n            this._paddingWidth = paddingWidth;\n            this._paddingHeight = paddingHeight;\n\n            // shapeBox\n            const [shapeWidth, shapeHeight] = shapeShift(paddingWidth, paddingHeight, this._shape)\n            this._shape.width = shapeWidth;\n            this._shape.height = shapeHeight;\n            // marginBox\n            const margin = this.margin;\n            this.width = shapeWidth + margin.left + margin.right;\n            this.height = shapeHeight + margin.top + margin.bottom;\n        },\n\n        _getViewBox() {\n            const belongs_vbox = this._belongs.getCacheViewBox();\n            const cacheViewBox = this._cacheViewBox;\n            \n            this._calculatePointBackWithPoint(belongs_vbox[0], belongs_vbox[1], cacheViewBox, 0, 1);\n            this._calculatePointBackWithPoint(belongs_vbox[2], belongs_vbox[3], cacheViewBox, 2, 3);\n            return this._cacheViewBox;\n        },\n        getCacheViewBox() {\n            return this._cacheViewBox;\n        },\n\n        // beforeRender() {\n        //     return doOverlap(this._belongs.getCacheViewBox(), this._boundingrect)\n        // },\n        \n        render(ctx) {\n            ctx.save();\n            if(this._isMoving){\n                ctx.globalAlpha = 0.6\n            } else if(this.opacity !== 1) {\n                ctx.globalAlpha = this.opacity;\n            }\n            const [cx, cy] = this._getCenter(); \n            this._shape.render(ctx);\n            ctx.translate(cx, cy);\n            this._stack.render(ctx);\n            // this._linkStack.render(ctx);    \n            ctx.translate(-cx, -cy);\n            ctx.restore();\n\n            // ctx.save();\n            // ctx.beginPath();\n            // ctx.arc(cx, cy, 5, 0, Math.PI*2);\n            // ctx.fillStyle = 'rgb(0,0,0)'\n            // ctx.fill();\n            // ctx.restore();\n        },\n        isHit(point, condition) {\n            const p = this._calculatePointBack(point);\n            this._currentp = p; // 暂存，为了后续计算别的位置\n            const target = this._stack.checkHit(p, condition);\n            if(target) return target;\n            if(!this.transparent) {\n                return this._shape.isHit(point);\n            }\n            return false;\n        },    \n        /* renderCache(ctx) {\n            const rect = this.getBoundingRect();\n            const [a, b] = this._belongs.calculateToRealWorld([rect[0], rect[1]]);\n            const [c, d] = this._belongs.calculateToRealWorld([rect[2], rect[3]]);\n            ctx.putImageData(this._cached, a, b, 0, 0, c-a, d-b)\n        },\n        cache(ctx) {\n            const rect = this.getBoundingRect();\n            const [a, b] = this._belongs.calculateToRealWorld([rect[0], rect[1]]);\n            const [c, d] = this._belongs.calculateToRealWorld([rect[2], rect[3]]);\n            console.log(a, b, c-a ,d-b);\n            this._cached = ctx.getImageData(a, b, c-a, d-b)\n        }  */  \n    });\n    return t\n}\n\nexport default GroupFactory;\n\n","import Node from '../node';\nimport { DIRECTION } from '../../utils/constance';\n/**\n * 圆形单元 配置\n * @typedef {Node~Configs} Point~PointConfigs\n * @property {number} radius  - 半径\n */\n/**\n * 圆形节点\n * @constructor Point\n * @extends Node\n * @param {Point~PointConfigs} configs - 配置\n */\nclass Point extends Node {\n    constructor(configs) {\n        super(configs);\n        this.type =             'Point';\n        /** @member {Number}      - 半径 */\n        this.radius =           configs.radius || 10;\n        this._doCache();\n    }\n\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k];\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n        this._doCache();\n    }\n    _doCache() {\n        this.width = this.radius * 2;\n        this.height = this.radius * 2;\n    }\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        ctx.beginPath();\n        ctx.arc(this.anchor[0], this.anchor[1], this.radius, 0, 2 * Math.PI);\n        ctx.fillStyle = this.backgroundColor;\n        ctx.fill();\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n            ctx.stroke();\n        }\n        // if(this._isTargeting) {\n        //     this.renderFocus(ctx);\n        // }\n        ctx.restore();\n    }\n\n    isHit(point) {\n        const anchor = this.anchor;\n        return Math.pow(point[0] - anchor[0], 2) + Math.pow(point[1] - anchor[1], 2) < this.radius * this.radius\n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const r = this.radius;\n        const ltx = anchor[0] - r;\n        const lty = anchor[1] - r;\n        const rbx = anchor[0] + r;\n        const rby = anchor[1] + r;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n\n    calculateIntersection(point) {\n        const [x1, y1] = point;\n        const [x2, y2] = this.anchor;\n        const vecx = x2 - x1;\n        const vecy = y2 - y1;\n        const dist = Math.sqrt(vecx * vecx + vecy * vecy);\n\n        const ratio = this.radius / dist;\n        return [x2 - ratio * vecx, y2 - ratio * vecy];\n    }\n\n    getIntersectionsInFourDimension() {\n        const [x2, y2] = this.anchor;\n        const r = this.radius;\n        return {\n            [DIRECTION.RIGHT]:  [x2 + r, y2],\n            [DIRECTION.LEFT]:   [x2 - r, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+r],\n            [DIRECTION.TOP]:    [x2, y2-r],\n        }\n    }\n\n    calculateIntersectionInFourDimension(point, end) {\n        const [x1, y1] = point;\n        const [x2, y2] = this.anchor;\n        const r = this.radius;\n        const vecx = x2 - x1;\n        const vecy = y2 - y1;\n        const allIntersections = {\n            [DIRECTION.RIGHT]:  [x2 + r, y2],\n            [DIRECTION.LEFT]:   [x2 - r, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+r],\n            [DIRECTION.TOP]:    [x2, y2-r],\n        }\n        // console.log(Math.abs(vecx) > Math.abs(vecy), vecx, r)\n        // if() {\n        //     return {\n        //         p: [x2 + (vecx<0?r:-r), y2],\n        //         dir: vecx<0 ? DIRECTION.RIGHT : DIRECTION.LEFT,\n        //     }\n        // } else {\n        //     return {\n        //         p: [x2, y2+(vecy<0?r:-r)],\n        //         dir: vecy<0 ? DIRECTION.BOTTOM : DIRECTION.TOP,\n        //     }\n        // }\n        let interDir = (Math.abs(vecy) > Math.abs(vecx)\n            ? (vecy < 0 ? DIRECTION.BOTTOM : DIRECTION.TOP)\n            : (vecx < 0 ? DIRECTION.RIGHT : DIRECTION.LEFT));\n\n        // interDir = this.checkLinked(interDir, end);\n        return {\n            p: allIntersections[interDir],\n            dir: interDir,\n        }\n    }\n\n    getBoundingDimension() {\n        return {\n            width: this.width,\n            height: this.height\n        }\n    }\n\n}\n\nexport default Point;","import Node from '../node';\nimport { DIRECTION, oppositeDirection } from '../../utils/constance';\n/**\n * @typedef Rectangle~border\n * @type {object}\n * @property {number} borderColor      - 边框宽度, 默认 0\n * @property {number} borderWidth      - 边框颜色, 默认 transparent\n */\n/**\n * @typedef Rectangle~borders\n * @type {object}\n * @property {Rectangle~border} top      - 上边框\n * @property {Rectangle~border} right      - 右边框\n * @property {Rectangle~border} bottom      - 下边框\n * @property {Rectangle~border} left      - 左边框\n */\n\n/**\n * 矩形单元 配置\n * @typedef {Node~Configs} Rectangle~RectangleConfigs\n * @property {number} width - 宽\n * @property {number} height - 高\n * @property {number} borderRadius - 圆角矩形半径\n * @property {string} borderColor - 边框颜色, 默认 transparent\n * @property {string} borderWidth - 边框宽度, 默认 0\n * @property {Rectangle~borders} border      - 边框设置\n */\n/**\n * 矩形单元\n * @constructor Rectangle\n * @extends Node\n * @param {Rectangle~RectangleConfigs} configs\n */\nclass Rectangle extends Node {\n    constructor(configs = {}) {\n        super(configs);\n        this.type =             'Rectangle';\n         /** @member {Number}      - 宽 */\n        this.width =            configs.width || 10;\n         /** @member {Number}      - 高 */\n        this.height =           configs.height || 10;\n         /** @member {Number}      - 圆角矩形半径 */\n        this.borderRadius =     configs.borderRadius || 0;\n        this._setBorder(configs);\n    }\n\n    _setBorder(configs){\n        /** @member {Rectangle~borders}      - 边框设置，优先级高于 borderWidth，borderColor */\n        this.border = {\n            top: {\n                color: configs.border?.top?.borderColor || configs.borderColor || 'transparent',\n                width: configs.border?.top?.borderWidth || configs.borderWidth || 0,\n                enable: configs.border?.top?.borderWidth,\n            },\n            right: {\n                color: configs.border?.right?.borderColor || configs.borderColor || 'transparent',\n                width: configs.border?.right?.borderWidth || configs.borderWidth || 0,\n                enable: configs.border?.right?.borderWidth,\n            },\n            bottom: {\n                color: configs.border?.bottom?.borderColor || configs.borderColor || 'transparent',\n                width: configs.border?.bottom?.borderWidth || configs.borderWidth || 0,\n                enable: configs.border?.bottom?.borderWidth,\n            },\n            left: {\n                color: configs.border?.left?.borderColor || configs.borderColor || 'transparent',\n                width: configs.border?.left?.borderWidth || configs.borderWidth || 0,\n                enable: configs.border?.left?.borderWidth,\n            }\n        };\n        this.borderColor = configs.borderColor || 'transparent';\n        this.borderWidth = configs.borderWidth || 0;\n    }\n\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k];\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n        this._setBorder(configs);\n    }\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n\n        const {\n            borderRadius: radius, anchor, width, height\n        } = this;\n        const x = this.anchor[0] - this.width / 2;\n        const y = this.anchor[1] - this.height / 2;\n        const xt = this.anchor[0] + this.width / 2;\n        const yt = this.anchor[1] + this.height / 2;\n        if(this.borderRadius) {\n            ctx.beginPath();\n            ctx.moveTo(x + radius, y);\n            ctx.lineTo(x + width - radius, y);\n            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\n            ctx.lineTo(x + width, y + height - radius);\n            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n            ctx.lineTo(x + radius, y + height);\n            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);\n            ctx.lineTo(x, y + radius);\n            ctx.quadraticCurveTo(x, y, x + radius, y);\n            ctx.closePath(); \n        } else {\n            ctx.beginPath();\n            ctx.rect(this.anchor[0] - this.width / 2, this.anchor[1] - this.height / 2, this.width, this.height);\n        }\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n        }\n        \n        if(this.shadowColor && this.shadowColor !== 'transparent') {\n            ctx.shadowColor = this.shadowColor;\n            const scale = this._jflow.scale;\n            ctx.shadowBlur = this.shadowBlur * scale;\n            ctx.shadowOffsetX = this.shadowOffsetX * scale;\n            ctx.shadowOffsetY = this.shadowOffsetY * scale;\n            let switchPath = new Path2D();\n            if(this.borderRadius) {\n                switchPath.moveTo(x + radius, y);\n                switchPath.lineTo(x + width - radius, y);\n                switchPath.quadraticCurveTo(x + width, y, x + width, y + radius);\n                switchPath.lineTo(x + width, y + height - radius);\n                switchPath.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n                switchPath.lineTo(x + radius, y + height);\n                switchPath.quadraticCurveTo(x, y + height, x, y + height - radius);\n                switchPath.lineTo(x, y + radius);\n                switchPath.quadraticCurveTo(x, y, x + radius, y);\n                switchPath.closePath();\n            } else {\n                switchPath.rect(this.anchor[0] - this.width / 2, this.anchor[1] - this.height / 2, this.width, this.height);\n            }\n            switchPath.rect(x - 10, y - 10, this.width+ 20, this.height+ 20);\n            ctx.save();\n            ctx.clip(switchPath, \"evenodd\");\n            ctx.stroke();\n            ctx.restore();\n        }  \n        ctx.fillStyle = this.backgroundColor;\n        ctx.fill();\n        if(this.borderRadius && this.borderWidth) {\n            ctx.shadowColor = 'transparent'\n            ctx.stroke();\n        }\n        \n        if(this.borderRadius) {\n            if(this.border.top.enable) {\n                const ty = y - this.border.top.width / 2;\n                // console.log(this.border.top.width)\n                ctx.beginPath();\n                let topPath = new Path2D();\n                topPath.moveTo(x, ty + radius);\n                topPath.quadraticCurveTo(x, ty, x + radius, ty);\n                topPath.lineTo(x + width - radius, ty);\n                topPath.quadraticCurveTo(x + width, ty, x + width, ty + radius);\n                topPath.closePath();\n                ctx.clip(topPath);             \n                ctx.save();\n                ctx.shadowColor = 'transparent';\n                ctx.fillStyle = this.border.top.color;\n                ctx.rect(x, ty, this.width, this.border.top.width);\n                ctx.fill();\n                ctx.restore();\n\n                // ctx.stroke();\n                // ctx.save();\n                // ctx.beginPath();\n                // ctx.moveTo(x, ty + radius);\n                // ctx.quadraticCurveTo(x, ty, x + radius, ty);\n                // ctx.lineTo(x + width - radius, ty);\n                // ctx.quadraticCurveTo(x + width, ty, x + width, ty + radius);\n                // ctx.closePath();\n\n                // // ctx.fill();\n                // ctx.clip();\n\n                // ctx.beginPath();\n                // ctx.rect(x, ty, this.width, this.border.top.width);\n                // ctx.fillStyle = this.border.top.color;\n                // ctx.shadowColor = 'transparent';\n                // ctx.fill();\n                // ctx.restore();\n            }\n        } else {\n            if(this.border.top.width) {\n                ctx.beginPath();\n                ctx.moveTo(x, y);\n                ctx.lineTo(xt, y);\n                ctx.strokeStyle = this.border.top.color;\n                ctx.lineWidth = this.border.top.width;\n                ctx.stroke();\n            }\n\n            if(this.border.right.width) {\n                ctx.beginPath();\n                ctx.moveTo(xt, y);\n                ctx.lineTo(xt, yt);\n                ctx.strokeStyle = this.border.right.color;\n                ctx.lineWidth = this.border.right.width;\n                ctx.stroke();\n            }\n\n            if(this.border.bottom.width) {\n                ctx.beginPath();\n                ctx.moveTo(xt, yt);\n                ctx.lineTo(x, yt);\n                ctx.strokeStyle = this.border.bottom.color;\n                ctx.lineWidth = this.border.bottom.width;\n                ctx.stroke();\n            }\n\n            if(this.border.left.width) {\n                ctx.beginPath();\n                ctx.moveTo(x, yt);\n                ctx.lineTo(x, y);\n                ctx.strokeStyle = this.border.left.color;\n                ctx.lineWidth = this.border.left.width;\n                ctx.stroke();\n            }\n        }\n        ctx.restore();\n    }\n\n    isHit(point) {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        return point[0] > anchor[0] - w\n            && point[0] < anchor[0] + w\n            && point[1] > anchor[1] - h\n            && point[1] < anchor[1] + h;\n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n\n    getBoundingDimension() {\n        return {\n            height: this.height,\n            width: this.width,\n        }\n    }\n\n    calculateIntersection(point) {\n        const [x1, y1] = point;\n        const [x2, y2] = this.anchor;\n        const w = this.width/2;\n        const h = this.height/2;\n        const vecx = x2 - x1;\n        const vecy = y2 - y1;\n        const theta1 = h/w;\n        const theta2 = Math.abs(vecy/vecx);\n        const dirx = x1 > x2;\n        const diry = y1 > y2;\n        let x, y;\n        if(theta2 < theta1) {\n            x = x2 + (dirx?w:-w);\n            y = w * (diry?theta2:-theta2) + y2;\n        } else {\n            y = y2 + (diry?h:-h);\n            x = h / (dirx?theta2:-theta2) + x2;\n        }\n        return [x, y];\n    }\n\n    getIntersectionsInFourDimension() {\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n        return {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n        }\n    }\n\n    calculateIntersectionInFourDimension(point, end) {\n        const [x1, y1] = point;\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n        const allIntersections = {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n        }\n        const vecx = x2 - x1;\n        const vecy = y2 - y1;\n        const theta1 = h/w;\n        const theta2 = Math.abs(vecy/vecx);\n        const dirx = x1 > x2;\n        const diry = y1 > y2;\n        let interDir = (theta2 > theta1\n            ? (diry ? DIRECTION.BOTTOM : DIRECTION.TOP)\n            : (dirx ? DIRECTION.RIGHT : DIRECTION.LEFT));\n\n        // if(this._belongs && this._belongs.calculateToCoordination) {\n        //     console.log(JSON.stringify(this._intersections));\n        //     console.log(interDir)\n        // }\n        // interDir = this.checkLinked(interDir, end);\n        // if(this._belongs && this._belongs.calculateToCoordination) {\n        //     console.log(interDir)\n        // }\n\n        // if(!interDir) {\n        //     debugger\n        // }\n        // let endDir = interDir;\n        // if(end === 'to') {\n        //     endDir = oppositeDirection(endDir)\n        // }\n        return {\n            p: allIntersections[interDir],\n            dir: interDir,\n        }\n    }\n}\n\nexport default Rectangle;","import Node from '../node';\nimport { DIRECTION, oppositeDirection } from '../../utils/constance';\n/**\n * 胶囊单元 配置\n * @typedef {Node~Configs} Capsule~CapsuleConfigs\n * @property {number} width  - 内部矩形宽\n * @property {number} height - 内部矩形高\n */\n/**\n * 胶囊单元\n * @constructor Capsule\n * @extends Node\n * @param {Capsule~CapsuleConfigs} configs - 配置\n */\nclass Capsule extends Node {\n    constructor(configs = {}) {\n        super(configs);\n        this.type =             'Capsule';\n        /** @member {Number}      - 内部矩形宽 */\n        this.width =            configs.width || 20;\n        /** @member {Number}      - 内部矩形高 */\n        this.height =           configs.height || 10;\n    }\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        ctx.beginPath();\n        const [x, y] = this.anchor;\n        const hw = this.width/2;\n        const hh = this.height/2;\n        const leftCenter = x - hw + hh;\n        const rightCenter = x + hw - hh;\n        const top = y - hh;\n        const bottom = y + hh;\n\n        ctx.moveTo(leftCenter, top);\n        ctx.lineTo(rightCenter, top);\n        ctx.arc(rightCenter, y, hh, -Math.PI/2, Math.PI/2);\n        ctx.lineTo(leftCenter, bottom);\n        ctx.arc(leftCenter, y, hh, Math.PI/2, Math.PI/2*3);\n\n        ctx.fillStyle = this.backgroundColor;\n        if (this.shadowColor) {\n            ctx.shadowColor = this.shadowColor;\n            ctx.shadowBlur = this.shadowBlur;\n            ctx.shadowOffsetX = this.shadowOffsetX;\n            ctx.shadowOffsetY = this.shadowOffsetY;\n        }\n        ctx.fill();\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n            ctx.stroke();\n        }\n        // ctx.fillStyle = 'rgba(0,0,0,0.3)';\n        // ctx.fillRect(x-hw, y-hh, this.width, this.height)\n\n        ctx.restore();\n    }\n\n    isHit(point) {\n        const anchor = this.anchor;\n        const hw = this.width/2;\n        const hh = this.height/2;\n        const ww =  Math.abs(hw - hh);\n        const leftCenter = anchor[0] - hw + hh;\n        const rightCenter = anchor[0] + hw - hh;\n        const rr = hh * hh;\n        return (point[0] > anchor[0] - ww\n            && point[0] < anchor[0] + ww\n            && point[1] > anchor[1] - hh\n            && point[1] < anchor[1] + hh)\n            || ( Math.pow(point[0] - leftCenter, 2) + Math.pow(point[1] - anchor[1], 2) < rr)\n            || ( Math.pow(point[0] - rightCenter, 2) + Math.pow(point[1] - anchor[1], 2) < rr)\n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n\n    getBoundingDimension() {\n        return {\n            height: this.height,\n            width: this.width,\n        }\n    }\n\n    getIntersectionsInFourDimension() {\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n        return {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n        }\n    }\n}\n\nexport default Capsule;","import Capsule from './capsule';\n/**\n * 垂直胶囊单元\n * @constructor CapsuleVertical\n * @extends Capsule\n * @param {Capsule~CapsuleConfigs} configs - 配置\n */\nclass CapsuleVertical extends Capsule {\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        ctx.beginPath();\n        const [x, y] = this.anchor;\n        const hw = this.width/2;\n        const hh = this.height/2;\n        const topCenter = y - hh + hw;\n        const bottomCenter = y + hh - hw;\n        const left = x - hw;\n        const right = x + hw;\n\n        ctx.moveTo(left, topCenter);\n        ctx.arc(x, topCenter, hw, -Math.PI, 0);\n        ctx.lineTo(right, bottomCenter);\n        ctx.arc(x, bottomCenter, hw, 0, Math.PI);\n        ctx.closePath();\n\n        ctx.fillStyle = this.backgroundColor;\n        if (this.shadowColor) {\n            ctx.shadowColor = this.shadowColor;\n            ctx.shadowBlur = this.shadowBlur;\n            ctx.shadowOffsetX = this.shadowOffsetX;\n            ctx.shadowOffsetY = this.shadowOffsetY;\n        }\n        ctx.fill();\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n            ctx.stroke();\n        }\n        // ctx.fillStyle = 'rgba(0,0,0,0.3)';\n        // ctx.fillRect(x-hw, y-hh, this.width, this.height)\n\n        ctx.restore();\n    }\n\n    isHit(point, condition) {\n        const [x, y] = this.anchor;\n        const hw = this.width/2;\n        const hh = this.height/2;\n        const yy =  Math.abs(hh - hw);\n        const topCenter = y - hh + hw;\n        const bottomCenter = y + hh - hw;\n        const rr = hw * hw;\n        return (point[0] > x - hw\n            && point[0] < x + hw\n            && point[1] > y - yy\n            && point[1] < y + yy)\n            || ( Math.pow(point[0] - x, 2) + Math.pow(point[1] - topCenter, 2) < rr)\n            || ( Math.pow(point[0] - x, 2) + Math.pow(point[1] - bottomCenter, 2) < rr)\n    }\n}\nexport default CapsuleVertical;","import Node from '../node';\nimport { DIRECTION } from '../../utils/constance';\n/**\n * 菱形单元 配置\n * @typedef {Node~Configs} Rhombus~RhombusConfigs\n * @property {number} diagonalsV  - 内十字高度\n * @property {number} diagonalsH  - 内十字宽度\n */\n/**\n * 菱形单元\n * @constructor Rhombus\n * @param {Rhombus~RhombusConfigs} configs - 配置\n * @extends Node\n */\nclass Rhombus extends Node {\n    constructor(configs = {}) {\n        super(configs);\n        this.type =             'Rhombus';\n        /** @member {Number}      - 内十字高度 */\n        this.height =           configs.diagonalsV || 10;\n        /** @member {Number}      - 内十字宽度 */\n        this.width =            configs.diagonalsH || 20;\n    }\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        const w = this.width / 2;\n        const h = this.height / 2;\n        const center = this.anchor;\n        ctx.translate(center[0], center[1])\n        ctx.beginPath();\n        ctx.moveTo(0, -h);\n        ctx.lineTo(w, 0);\n        ctx.lineTo(0, h);\n        ctx.lineTo(-w, 0);\n        ctx.closePath();\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n        }\n\n        \n        if(this.shadowColor) {\n            ctx.shadowColor = this.shadowColor;\n            const scale = this._jflow.scale;\n            ctx.shadowBlur = this.shadowBlur * scale;\n            ctx.shadowOffsetX = this.shadowOffsetX * scale;\n            ctx.shadowOffsetY = this.shadowOffsetY * scale;\n            let switchPath = new Path2D();\n            switchPath.moveTo(0, -h);\n            switchPath.lineTo(w, 0);\n            switchPath.lineTo(0, h);\n            switchPath.lineTo(-w, 0);\n            switchPath.closePath();\n            switchPath.rect(-w - 10,  -h - 10, this.width + 20, this.height+ 20);\n            // switchPath.moveTo(x, y-h);\n            // switchPath.lineTo(x + w, y);\n            // switchPath.lineTo(x, y + h);\n            // switchPath.lineTo(x-w, y);\n            // switchPath.closePath();\n            // switchPath.rect(x - w - 10, y - h - 10, this.width+ 20, this.height+ 20);\n            ctx.save();\n            ctx.clip(switchPath, \"evenodd\");\n            ctx.stroke();\n            ctx.restore();\n        }\n        ctx.fillStyle = this.backgroundColor;\n        ctx.fill();\n        if (this.borderWidth) {\n            ctx.shadowColor = 'transparent'\n            ctx.stroke();\n        }\n       \n        ctx.translate(-center[0], -center[1])\n        ctx.restore();\n    }\n\n    isHit(point) {\n        const v = this.height / 2;\n        const h = this.width / 2;\n        const anchor = this.anchor;\n        const x = Math.abs(point[0] - anchor[0]);\n        const y = Math.abs(point[1] - anchor[1]);\n        return (x / h + y / v) <= 1;\n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height /2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n\n    getBoundingDimension() {\n        return {\n            height: this.height,\n            width: this.width,\n        }\n    }\n\n    getIntersectionsInFourDimension() {\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n\n        return {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n            [DIRECTION.SELF]:   [x2+w*0.618, y2+h*0.618]\n        }\n    }\n}\n\nexport default Rhombus;\n","import Node from '../node';\nimport { DIRECTION, oppositeDirection } from '../../utils/constance';\n// import { makeBezierPoints } from '../../utils/functions';\n/**\n * 钻石形单元 配置\n * @typedef {Node~Configs} Diamond~DiamondConfigs\n * @property {number} width  - 内部矩形宽\n * @property {number} height - 内部矩形高\n * @property {number} side   - 两侧三角形的宽\n */\n/**\n * 钻石形单元\n * @constructor Diamond\n * @param {Diamond~DiamondConfigs} configs - 配置\n * @extends Node\n */\n\nclass Diamond extends Node {\n\n    constructor(configs = {}) {\n        super(configs);\n        this.type =             'Diamond';\n        /** @member {Number}      - 内部矩形宽 */\n        this.width =            configs.width || 20;\n        /** @member {Number}      - 内部矩形高 */\n        this.height =           configs.height || 10;\n        /** @member {Number}      - 两侧三角形的宽 */\n        this.side =             configs.side || 6;\n        this._doCache();\n    }\n\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k];\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n        this._doCache();\n    }\n\n    _doCache() {\n        this.sinSIDE = Math.sin(Math.PI/3) * this.side;\n        this.cosSIDE = Math.cos(Math.PI/3) * this.side;\n    }\n\n    render(ctx) {\n        const [x, y] = this.anchor;\n        const hw = this.width/2;\n        const hh = this.height/2;\n        const xx = hh / 1.732\n        const leftCenter = x - hw + xx;\n        const rightCenter = x + hw - xx;\n        const right = x + hw;\n        const left = x - hw;\n        const top = y - hh;\n        const bottom = y + hh;\n\n        this._cachePoints = [\n            [rightCenter, top],\n            [right, y],\n            [rightCenter, bottom],\n            [leftCenter, bottom],\n            [left, y],\n            [leftCenter, top]\n        ];\n\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        ctx.beginPath();\n        const {\n            side, sinSIDE, cosSIDE\n        } = this;\n        ctx.moveTo(x, top);\n        ctx.lineTo(rightCenter - side, top);\n        ctx.quadraticCurveTo(rightCenter, top, rightCenter + cosSIDE, top + sinSIDE);\n        ctx.lineTo(right - cosSIDE, y - sinSIDE);\n        ctx.quadraticCurveTo(right, y, right - cosSIDE, y + sinSIDE);\n        ctx.lineTo(rightCenter + cosSIDE, bottom - sinSIDE);\n        ctx.quadraticCurveTo(rightCenter, bottom, rightCenter - side, bottom);\n\n        ctx.lineTo(leftCenter + side, bottom);\n        ctx.quadraticCurveTo(leftCenter, bottom, leftCenter - cosSIDE, bottom - sinSIDE);\n        ctx.lineTo(left + cosSIDE, y + sinSIDE);\n        ctx.quadraticCurveTo(left, y, left + cosSIDE, y - sinSIDE);\n        ctx.lineTo(leftCenter - cosSIDE, top + sinSIDE);\n        ctx.quadraticCurveTo(leftCenter, top, leftCenter + side, top);\n\n        ctx.closePath();\n\n        ctx.fillStyle = this.backgroundColor;\n        if (this.shadowColor) {\n            ctx.shadowColor = this.shadowColor;\n            ctx.shadowBlur = this.shadowBlur;\n            ctx.shadowOffsetX = this.shadowOffsetX;\n            ctx.shadowOffsetY = this.shadowOffsetY;\n        }\n        ctx.fill();\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n            ctx.stroke();\n        }\n\n        // if(this._isTargeting) {\n        //     this.renderFocus(ctx);\n        // }\n        // ctx.fillStyle = 'rgba(0,0,0,0.3)';\n        // ctx.fillRect(x-hw, y-hh, this.width, this.height)\n\n        ctx.restore();\n\n\n    }\n\n    isHit(point) {\n        if(!this._cachePoints) return false;\n        const polygon = this._cachePoints;\n        let odd = false;\n        // For each edge (In this case for each point of the polygon and the previous one)\n        for (let i = 0, j = polygon.length - 1; i < polygon.length; i++) {\n            // If a line from the point into infinity crosses this edge\n            if (((polygon[i][1] > point[1]) !== (polygon[j][1] > point[1])) // One point needs to be above, one below our y coordinate\n                // ...and the edge doesn't cross our Y corrdinate before our x coordinate (but between our x coordinate and infinity)\n                && (point[0] < ((polygon[j][0] - polygon[i][0]) * (point[1] - polygon[i][1]) / (polygon[j][1] - polygon[i][1]) + polygon[i][0]))) {\n                // Invert odd\n                odd = !odd;\n            }\n            j = i;\n\n        }\n        return odd;\n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n\n    getBoundingDimension() {\n        return {\n            height: this.height,\n            width: this.width,\n        }\n    }\n\n    getIntersectionsInFourDimension() {\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n        return {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n        }\n    }\n}\n\nexport default Diamond;","import Diamond from './diamond';\nconst backsqrt3 = 1/Math.sqrt(3)\n\n/**\n * 垂直钻石形单元\n * @constructor DiamondVertical\n * @param {Diamond~DiamondConfigs} configs - 配置\n * @extends Diamond\n */\nclass DiamondVertical extends Diamond {\n    constructor(configs) {\n        super(configs)\n    }\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        ctx.beginPath();\n        const [x, y] = this.anchor;\n        const hw = this.width/2;\n        const hh = this.height/2;\n        const yy = hw / 1.732\n\n        const top = y - hh;\n        const bottom = y + hh;\n        const topmiddle = y - hh + yy;\n        const bottommiddle = y + hh - yy;\n        const xleft = x - hw;\n        const xright = x + hw;\n\n        ctx.moveTo(x, top);\n        ctx.lineTo(xright, topmiddle);\n        ctx.lineTo(xright, bottommiddle);\n        ctx.lineTo(x, bottom);\n        ctx.lineTo(xleft, bottommiddle);\n        ctx.lineTo(xleft, topmiddle);\n        ctx.closePath();\n        ctx.fillStyle = this.backgroundColor;\n        if (this.shadowColor) {\n            ctx.shadowColor = this.shadowColor;\n            ctx.shadowBlur = this.shadowBlur;\n            ctx.shadowOffsetX = this.shadowOffsetX;\n            ctx.shadowOffsetY = this.shadowOffsetY;\n        }\n        ctx.fill();\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n            ctx.stroke();\n        }\n\n        ctx.restore();\n        this._cachePoints = [\n            [x, top],\n            [xright, topmiddle],\n            [xright, bottommiddle],\n            [x, bottom],\n            [xleft, bottommiddle],\n            [xleft, topmiddle]\n        ];\n    }\n}\nexport default DiamondVertical;","import Node from '../node';\nimport StackMixin from '../stackMixin';\nimport LayoutMixin from '../layoutMixin';\nimport Rectangle from '../shapes/rectangle';\nimport { bounding_box, doOverlap } from '../../utils/functions';\nimport { DIRECTION } from '../../utils/constance';\nimport { ScrollBar } from '../../scrollbar/scrollbarMixin';\nconst ishitKey = Symbol('ishit');\n\nclass InnerScrollBar extends ScrollBar {\n    constructor(dir, configs = {}) {\n        super(dir, configs);\n        this.visible = false;\n    }\n    render(ctx) {\n        if(this.visible) {\n            super.render(ctx);\n        }\n    }\n\n    setHit(ishit) {\n        if(this[ishitKey] !== ishit) {\n            this.isFocus = ishit\n            this.onHit();\n        }\n        this[ishitKey] = ishit;\n    }\n}\n \nclass ScrollGroup extends Node {\n    constructor(configs) {\n        super(configs);\n        this.type = 'ScrollGroup';\n        this.initStack(configs);\n        this.initLayout(configs);\n        this.initScrollBar(configs);\n        this._shape = new Rectangle(configs);\n        this._shape.anchor = [0, 0];\n        this._shape._belongs = this;\n\n        this.maxWidth = configs.maxWidth || Infinity;\n        this.definedWidth = configs.definedWidth;\n        this.maxHeight = configs.maxHeight || Infinity;\n        this.definedHeight = configs.definedHeight;\n\n        this.lock = configs.lock ?? true ;\n        this._offset = [0, 0];\n\n        this._getBoundingGroupRect();\n        this.reflow();\n        this._getBoundingGroupRect();  \n        this._resetOffset();\n        this._cacheViewBox = []\n\n    }\n\n    initScrollBar(configs) {\n        const {\n            barColor,\n            barFocusColor,\n            barMarginX,\n            barMarginY,\n            barWidth,\n        } = configs;\n        this._scrollbarX = new InnerScrollBar('x', {\n            plainColor: barColor,\n            focusColor: barFocusColor,\n            barWidth,\n        });\n        this._scrollbarY = new InnerScrollBar('y', {\n            plainColor: barColor,\n            focusColor: barFocusColor,\n            barWidth\n        });\n        this._scrollbarX.barMarginX = barMarginX || 1;\n        this._scrollbarY.barMarginY = barMarginY || 1;\n        const _f = () => {\n            this._jflow.scheduleRender();\n        }\n        this._scrollbarX.onHit = _f;\n        this._scrollbarY.onHit = _f;\n\n        this._scrollBarStatus = {\n            dragging: false,\n            target: null,\n\n            barInitX: 0,\n            barInitY: 0,\n            barStartX: 0,\n            barStartY: 0,\n\n            hitScrollX: false,\n            hitScrollY: false,\n        }\n        // // const jflowInstance = this._jflow;\n        // this.addEventListener('instancemousemove', e => {\n        //     if(this._scrollBarStatus.hitScrollX) {\n        //         if(!this._scrollbarX.isFocus) {\n        //             this._scrollbarX.isFocus = true;\n        //             e.detail.jflow.scheduleRender();\n        //         }\n        //         return;\n        //     }\n        //     if(this._scrollbarX.isFocus) {\n        //         this._scrollbarX.isFocus = false;\n        //         e.detail.jflow.scheduleRender();\n        //     }\n        \n        // })\n        this.addEventListener('instancePressStart', e => {\n            if(this._scrollBarStatus.hitScrollX) {\n                e.detail.preventDefault();\n                e.detail.bubbles = false;\n                const clientX = e.detail.event.clientX;\n                Object.assign(this._scrollBarStatus, {\n                    dragging: true,\n                    target: this._scrollbarX,\n                    barStartX: this._scrollbarX.anchor[0],\n                    barInitX: clientX,\n                });\n                this.onScrollbarPressStart();\n            }\n            if(this._scrollBarStatus.hitScrollY) {\n                e.detail.preventDefault();\n                e.detail.bubbles = false;\n                const clientY = e.detail.event.clientY;\n                Object.assign(this._scrollBarStatus, {\n                    dragging: true,\n                    target: this._scrollbarY,\n                    barStartY: this._scrollbarY.anchor[1],\n                    barInitY: clientY,\n                });\n                this.onScrollbarPressStart();\n            }\n        })\n    }\n\n    onScrollbarPressStart() {\n        const jflowInstance = this._jflow;\n        const canvas = jflowInstance.canvas;\n        const f = (e => {\n            const { clientX, clientY } = e;\n            this.onDraggingScrollbar(clientX, clientY)\n        }).bind(this);\n        document.addEventListener('pointermove', f);\n        const t = (e => {\n            Object.assign(this._scrollBarStatus, {\n                dragging: false,\n                target: null,\n                barInitX: 0,\n                barInitY: 0,\n                barStartX: 0,\n                barStartY: 0,\n                hitScrollX: false,\n                hitScrollY: false,\n            });\n            document.removeEventListener('pointermove', f);\n            document.removeEventListener('pointerup', t);\n            canvas.removeEventListener('pointerup', t);\n        }).bind(this);\n        canvas.addEventListener('pointerup', t, {\n            once: true\n        })\n        document.addEventListener('pointerup', t, {\n            once: true\n        })\n    }\n\n    onDraggingScrollbar(clientX, clientY) {\n        if(this._scrollbarX.visible && this._scrollBarStatus.dragging) {\n            const JFLOW = this._jflow;\n            const scale = JFLOW.scale;\n            const {\n                target,\n                barInitX,\n                barStartX,\n                barInitY,\n                barStartY\n            } = this._scrollBarStatus;\n            if(target.dir === 'x') {\n                const _scrollWidth = this._scrollbarX.width;\n                const _outerWidth = this._outerWidth;\n                const deltaX = clientX - barInitX;\n                const xnew = barStartX + deltaX / scale;\n                const q = target.anchor[0] = Math.max(Math.min(xnew, _outerWidth - _scrollWidth), 0);\n                const ratioInX = q / (_outerWidth - _scrollWidth);\n                const s = (this._innerWidth - _outerWidth)/2;\n                this._offset[0] = s - (this._innerWidth - _outerWidth) * ratioInX\n                JFLOW.scheduleRender()\n            }\n\n            if(target.dir === 'y') {\n                const _scrollHeight = this._scrollbarY.height;\n                const _outerHeight = this._outerHeight;\n                const deltaY = clientY - barInitY;\n                const ynew = barStartY + deltaY / scale;\n                const q = target.anchor[1] = Math.max(Math.min(ynew, _outerHeight - _scrollHeight), 0);\n                const ratio = q / (_outerHeight - _scrollHeight);\n                const s = (this._innerHeight - _outerHeight)/2;\n                this._offset[1] = s - (this._innerHeight - _outerHeight) * ratio\n                JFLOW.scheduleRender()\n            }\n        }\n    }\n\n\n    setConfig(configs) {\n        this._shape.setConfig(configs);\n    }\n\n    _getBoundingGroupRect() {\n        const points = this._stack.getBoundingRectPoints();\n        // content box \n        const bbox = bounding_box(points);\n        const w = bbox.width;\n        const h = bbox.height;\n        const outerWidth = this.definedWidth || Math.min(w, this.maxWidth);\n        const outerHeight = this.definedHeight || Math.min(h, this.maxHeight);\n        this._innerWidth = w;\n        this._outerWidth = outerWidth;\n        this._innerHeight = h;\n        this._outerHeight = outerHeight;\n\n        this._shape.width = outerWidth;\n        this._shape.height = outerHeight;\n        this.width = outerWidth;\n        this.height = outerHeight;\n    }\n\n    _calculatePointBack(point) {\n        const [gx, gy] = point;\n        const [tx, ty] = this._offset;\n        const [cx, cy] = this.anchor; \n        const p = [gx - cx - tx, gy - cy - ty]\n        return p\n    }\n\n    _calculatePointBackWithPoint(a, b, arr, idx1, idx2) {\n        const anchor = this.anchor;\n        const offset = this._offset;\n        arr[idx1] = a - anchor[0] - offset[0];\n        arr[idx2] = b - anchor[1] - offset[1];\n    }\n\n    calculateToCoordination(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this.anchor;  \n        const [tx, ty] = this._offset;\n        const p = [gx + cx - tx, gy + cy - ty]\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            return this._belongs.calculateToCoordination(p);\n        } else {\n            return p;\n        }\n    }\n\n    calculateToRealWorld(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this.anchor;  \n        const [tx, ty] = this._offset;\n        const p = [gx + cx - tx, gy + cy - ty]\n        if(this._belongs && this._belongs.calculateToRealWorld) {\n            return this._belongs.calculateToRealWorld(p);\n        }\n    }\n\n    _getViewBox() {\n        const cacheViewBox = this._cacheViewBox;\n        this._calculatePointBackWithPoint(0, 0, cacheViewBox, 0, 1);\n        this._calculatePointBackWithPoint(this.width, this.height, cacheViewBox, 2, 3);\n        return cacheViewBox;\n    }\n\n    getCacheViewBox() {\n        return this._cacheViewBox;\n    }\n\n    _resetOffset() {\n        this._offset = [\n            Math.max((this._innerWidth - this._outerWidth)/2, 0),\n            Math.max((this._innerHeight - this._outerHeight)/2, 0),\n        ];\n        if(this._innerWidth > this._outerWidth) {\n            this._scrollbarX.visible = true;\n            this._scrollbarX.width = this._outerWidth * this._outerWidth / this._innerWidth;\n            this._scrollbarX.anchor = [0, this._outerHeight - 4]\n        } else {\n            this._scrollbarX.visible = false;\n        }\n        if(this._innerHeight > this._outerHeight) {\n            this._scrollbarY.visible = true;\n            this._scrollbarY.height = this._outerHeight * this._outerHeight / this._innerHeight;\n            this._scrollbarY.anchor = [this._outerWidth - 4, 0]\n        } else {\n            this._scrollbarY.visible = false;\n        }\n    }\n\n    render(ctx) {\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        } else if(this.opacity !== 1) {\n            ctx.globalAlpha = this.opacity;\n        }\n        const [cx, cy] = this.anchor; \n        const w = this.width;\n        const h = this.height;\n        const w2 = w/2;\n        const h2 = h/2;\n        // if((this.width * this.height) * this._jflow.scale < 144) {\n        //     ctx.restore();\n        //     return;\n        // }\n        const [tx, ty] = this._offset;\n        ctx.translate(cx, cy);\n        this._shape.render(ctx);\n        ctx.translate(-w2, -h2);\n        if(this._scrollbarX.visible) {\n            this._scrollbarX.render(ctx);\n        }\n        if(this._scrollbarY.visible) {\n            this._scrollbarY.render(ctx);\n        }\n\n        ctx.translate(w2, h2);\n        ctx.save();\n        ctx.beginPath();\n        ctx.rect(-w2, -h2, w, h);\n        ctx.clip();\n        ctx.translate(tx, ty);\n        this._stack.render(ctx);\n        this._linkStack.render(ctx);    \n        ctx.translate(-cx-tx, -cy-ty);\n        ctx.restore();\n    }\n\n    isHit(point, condition) {\n        const [gx, gy] = point;\n        const [cx, cy] = this.anchor; \n        const w = this.width/2;\n        const h = this.height/2;\n        const sp = [gx - cx + w, gy - cy + h]\n        this._scrollBarStatus.hitScrollX = false;\n        this._scrollBarStatus.hitScrollY = false;\n        if(this._scrollbarX.visible) {\n            const xhit = this._scrollbarX.isHit(sp);\n            if(xhit) {\n                this._scrollBarStatus.hitScrollX = true;\n                this._scrollbarX.setHit(true)\n                return true;\n            }\n        }\n        this._scrollbarX.setHit(false)\n\n        if(this._scrollbarY.visible) {\n            const yhit = this._scrollbarY.isHit(sp);\n            if(yhit) {\n                this._scrollBarStatus.hitScrollY = true;\n                this._scrollbarY.setHit(true)\n                return true;\n            }\n        }\n        this._scrollbarY.setHit(false)\n       \n        // const br = this._getViewBox();\n        const isInBound = this._shape.isHit([gx - cx, gy - cy]);\n        if(isInBound) {\n            const [tx, ty] = this._offset;\n            const p = [gx - cx - tx, gy - cy - ty];\n            this._currentp = p; // 暂存，为了后续计算别的位置\n            const target = this._stack.checkHit(p, condition); \n            if(target) return target; \n        } else {\n            this._stack.resetHitStatus();\n        }\n        return false;\n    }\n\n    getBoundingDimension() {\n        return {\n            width: this.width,\n            height: this.height,\n        }\n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n\n    getIntersectionsInFourDimension() {\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n        return {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n            [DIRECTION.SELF]:   [x2+w*0.618, y2+h*0.618]\n        }\n    }\n\n    onEnterViewbox() {\n        this.interateNodeStack((instance) => {\n            instance.onEnterViewbox();\n        })\n    }\n    onLeaveViewbox() {\n        this.interateNodeStack((instance) => {\n            instance.onLeaveViewbox();\n        })\n    }\n    destroy() {\n        this._shape.destroy();\n        this.interateNodeStack((instance) => {\n            instance.destroy();\n        })\n    }\n\n    clone() {\n        const C = this.constructor;\n        const configs = Object.assign({}, this._rawConfigs, {\n            layout: this._layout && this._layout.clone(),\n        })\n        const t = new C(configs);\n        this.interateNodeStack((instance) => {\n            t.addToStack(instance.clone());\n        })\n        t.recalculate();\n        t.visible = this.visible;\n        return t;\n    }\n}\n\nObject.assign(ScrollGroup.prototype, StackMixin);\nObject.assign(ScrollGroup.prototype, LayoutMixin);\nObject.assign(ScrollGroup.prototype, {\n    recalculateUp() {\n        let dirty = true;\n        \n        if(this.getBoundingDimension) {\n            // const { width: wold, height: hold } = this.getBoundingDimension();\n            const wold = this._innerWidth;\n            const hold = this._innerHeight;\n            if(this.resetChildrenPosition) {\n                this.resetChildrenPosition();\n            }\n            if(this._getBoundingGroupRect){\n                this._getBoundingGroupRect();\n            }\n            this.reflow();\n            if(this._getBoundingGroupRect){\n                this._getBoundingGroupRect();\n            }\n            const wnow = this._innerWidth;\n            const hnow = this._innerHeight;\n            // const { width: wnow, height: hnow } = this.getBoundingDimension();\n            dirty = (wold !== wnow || hold !== hnow)\n        } else {\n            this.reflow();\n        }\n        if(this._belongs && dirty) {\n            this._resetOffset();\n            this._belongs.recalculateUp();\n        }\n    },\n\n    recalculate() {\n        const { width: wold, height: hold } = this.getBoundingDimension();\n        this.reflow();\n        if(this._getBoundingGroupRect){\n            this._getBoundingGroupRect();\n        }\n        const { width: wnow, height: hnow } = this.getBoundingDimension();\n        if (wold !== wnow || hold !== hnow) {\n            this._resetOffset();\n        }\n    },\n})\n\n\nexport default ScrollGroup","export default {\n    canvas: {\n        wheel (event, jflow) {\n            event.preventDefault();\n            let { offsetX, offsetY, deltaX, deltaY } = event \n            if(event.ctrlKey) { \n                deltaY = -deltaY;\n            }\n            jflow.zoomHandler(offsetX, offsetY, deltaX, deltaY, event);\n        },\n    }\n}","import Instance from './instance';\n\n/**\n * @typedef {Instance~Configs} BaseLink~Configs\n * @property {Instance} from   - 起始单元\n * @property {Instance} to     - 终止单元\n * @property {String} fromDir  - 起始方向 \n * @property {String} toDir    - 终止方向 \n * @property {String} key      - 连线唯一键值\n * @property {String} backgroundColor    - 线条颜色 \n */\n/**\n * 连线基类\n * @constructor BaseLink\n * @extends Instance\n * @param {BaseLink~Configs} configs - 配置\n */\nclass BaseLink extends Instance{\n    constructor(configs = {}) {\n        super();\n        /** @member {Instance}      - 起始单元 */\n        this.from     = configs.from;\n        /** @member {Instance}      - 终止单元 */\n        this.to       = configs.to;\n        /** @member {DIRECTION}      - 起始方向 */\n        this.fromDir  = configs.fromDir;\n        /** @member {DIRECTION}      - 终止方向 */\n        this.toDir    = configs.toDir;\n        /** @member {number[][]}     - 连线控制点缓存 */\n        this._cachePoints = null;\n        /** @member {string}     - 连线颜色，默认为 #000 */\n        this.backgroundColor = configs.backgroundColor || '#000';\n\n        this.isSelf        = !!configs.isSelf\n    }\n\n    /**\n     * 是否出现在当前视窗内\n     * @param {number[]} viewbox\n     */\n    isInViewBox(viewbox){\n        return true;\n    }\n\n    bringToTop() {\n        const linkStack = this._jflow._linkStack;\n        const index = linkStack.findIndex(l => l === this);\n        linkStack.splice(index, 1);\n        linkStack.push(this);\n        this._jflow._render();\n    }\n\n    \n}\n\nexport default BaseLink;","import Node from '../node';\n\nclass ShadowCache extends Node {\n    constructor(configs) {\n        super(configs);\n        // this.imageData = configs.imageData;\n        this.width = configs.width;\n        this.height = configs.height;\n        this.imageBuffer = document.createElement('canvas');\n        this.imageBuffer.width = this.width + 2;\n        this.imageBuffer.height = this.height + 2;\n        configs.cache(this.imageBuffer.getContext('2d'));\n    }\n\n    render(ctx) {\n        const [cx, cy] = this.anchor;\n        ctx.save();\n        ctx.translate(cx, cy);\n        ctx.beginPath();\n        ctx.drawImage(this.imageBuffer, -this.width/2, -this.height/2);\n        ctx.translate(-cx, -cy);\n        ctx.restore();\n    }\n\n    getBoundingDimension() {\n        return {\n            height: this.height,\n            width: this.width,\n        }\n    }\n\n    recalculate(){}\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n}\n\n\nexport default ShadowCache;","import Rectangle from \"../shapes/rectangle\";\nimport { requestCacheCanvas } from '../../utils/canvas';\nimport JFlowEvent from '../../events'\nimport ShadowCache from '../shapes/shadow-cache';\n\nconst TEXT_ALIGN = {\n    CENTER: 'center',\n    LEFT: 'left',\n    RIGHT: 'right',\n};\n\nclass Text extends Rectangle {\n    constructor(configs) {\n        super(configs);\n        this.type =         'Text';\n        this.content =      configs.content || '';\n        this.fontFamily =       configs.fontFamily || '-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji'\n        this.fontSize =         configs.fontSize || '14px';\n        this.fontWeight =       configs.fontWeight || '';\n        this.textColor =        configs.textColor || 'white';\n        this.placeholderColor = configs.placeholderColor ||  configs.textColor || 'white';\n        this.textAlign =        configs.textAlign || TEXT_ALIGN.CENTER;\n        this.textBaseline =     configs.textBaseline || 'middle';\n        this.lineHeight =       configs.lineHeight ;\n        this.indent =           configs.indent || 0;\n        this.backgroundColor =  configs.backgroundColor;\n        this.editable =         configs.editable;\n        this.definedWidth =     configs.definedWidth;\n        this.minWidth =         configs.minWidth || 0;\n        this.maxWidth =         configs.maxWidth;\n        this.ellipsis =         configs.ellipsis;\n\n        this.placeholder =      configs.placeholder || '';\n        this.emptyWhenInput =   configs.emptyWhenInput || false;\n        \n        this.editting =         false;\n        this.disabled =         configs.disabled;\n\n        this.cursorColor =      configs.cursorColor || '#60CFC4';\n        this.textRangeColor =   configs.textRangeColor || '#4E75EC1A';\n\n        this._status = {\n            editing: false,\n            cursorshow: true,\n            cursoranime: null,\n            lastElapsed: 0,\n            refreshElapsed: false,\n\n            cursorDragging: false,\n            shiftOn: false,\n\n            oldVal: '',\n            inputElement: null,\n        }\n\n        this._cursorOffset = 0;\n\n        this._textRange = {\n            enable: false,\n            rangefrom: null, // offsetfrom\n            rangeTo: null,   // offsetto\n            initialRange: null // offset\n        }\n        if(this.editable) {\n            this._makeFunctional();\n        }\n\n        this.preCalculateText();\n        this.shadowCache();\n        \n    }\n\n    get currentContent() {\n        return this.content || this.placeholder;\n    }\n\n    get isEmpty() {\n        return !this.content;\n    }\n\n    preCalculateText() {\n        requestCacheCanvas((ctx) => {\n            ctx.beginPath();\n            ctx.font = `${this.fontSize} ${this.fontFamily}`;\n            ctx.textAlign = this.textAlign;\n            ctx.textBaseline = this.textBaseline;\n            const t_h = parseInt(this.fontSize);\n            const content = this.currentContent;\n            const {\n                // actualBoundingBoxLeft,\n                // actualBoundingBoxRight,\n                fontBoundingBoxAscent,\n                fontBoundingBoxDescent,\n                width,\n            } = ctx.measureText(content);\n\n            this._textWidth = this.indent + width;\n            if(this.definedWidth) {\n                if(this.ellipsis && (this._textWidth > this.definedWidth)) {\n                    const offset = this._calculateOffset(this.definedWidth - 12);\n                    this.ellipsisContent = content.substring(0, offset) + '...'; \n                } else {\n                    this.ellipsisContent = content;\n                }\n                this.width = this.definedWidth;\n            } else if(this.maxWidth && this.ellipsis) {\n                if(this._textWidth > this.maxWidth) {\n                    const ratio =this.maxWidth / this._textWidth;\n                    const l = Math.floor(content.length * ratio - 3);\n                    this.ellipsisContent = content.substring(0, l) + '...'; \n                }  else {\n                    this.ellipsisContent = content;\n                }\n                this.width = Math.min(this.maxWidth, this._textWidth);\n            } else{ \n                this.width = Math.max(this.minWidth, this._textWidth);\n            }\n            \n            const height = (Math.abs(fontBoundingBoxAscent) + Math.abs(fontBoundingBoxDescent)) || t_h;\n            this._textHeight = height;\n            if(this.lineHeight) {\n                this.height = this.lineHeight;\n            } else {\n                this.height = height;\n            }\n        });\n    }\n\n    shadowCache() {\n        const scale = window.devicePixelRatio;\n        const w = this.width * scale;\n        const h = this.height * scale;\n        const i = this.indent * scale;\n        const size = parseInt(this.fontSize) * scale;\n        this._shadowCache = new ShadowCache({\n            width: w,\n            height: h,\n            cache: (ctx) => {\n                // const [cx, cy] = this.anchor;\n                // ctx.scale(4, 4)\n                ctx.translate(w/2, h/2);\n                const font = `${this.fontWeight} ${size}px ${this.fontFamily}`;\n                ctx.font = font\n                ctx.textAlign = this.textAlign;\n                ctx.textBaseline = this.textBaseline;\n                ctx.fillStyle = this.isEmpty ? this.placeholderColor : this.textColor;\n                let content = this.currentContent;\n                if(this.ellipsisContent) {\n                    content = this.ellipsisContent;\n                }\n                if(content) {\n                    if(this.textAlign === TEXT_ALIGN.LEFT){\n                        const hw = w / 2;\n                        ctx.fillText(content,  -hw + i / 2, 0);\n                    } else if(this.textAlign === TEXT_ALIGN.RIGHT) {\n                        const hw = w / 2;\n                        ctx.fillText(content, hw, 0);\n                    } else {\n                        ctx.fillText(content, i / 2, 0);\n                    }\n                    \n                }\n            }\n        });\n        \n    }\n\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k];\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n        this.preCalculateText();\n        this.shadowCache();\n    }\n\n    click() {\n        if(!this._status.editing) {\n            let flag = true;\n            this.dispatchEvent(new JFlowEvent('edit', {\n                target: this,\n                preventDefault() {\n                    flag = false;\n                }\n            }))  \n            if(!flag) {\n                return;\n            }\n\n            const point = this._belongs._currentp;\n            const jflow = this._jflow; \n            if(point) {\n                this._cursorOffset = this._positionToCursorOffset(point);\n            } else {\n                this._cursorOffset = 0;\n            }\n            \n            const inputElement = createInputElement(\n                this._controlCallback.bind(this),\n                this._defaultCallback.bind(this));\n            const wrapper = jflow.DOMwrapper;\n            wrapper.append(inputElement);  \n            inputElement.focus({ preventScroll: true });      \n            jflow.setFocusInstance(this);\n\n            Object.assign(this._status, {\n                editing: true,\n                oldVal: this.content,\n                inputElement,\n                cursoranime: jflow.requestJFlowAnime((elapsed) => {\n                    const lastElapsed = this._status.lastElapsed;\n                    if(this._status.refreshElapsed) {\n                        this._status.lastElapsed = elapsed;\n                        this._status.refreshElapsed = false;\n                    }\n                    if(elapsed - lastElapsed > 500) {\n                        this._status.cursorshow = !this._status.cursorshow;\n                        this._status.lastElapsed = elapsed;\n                    } \n                })\n            });\n            if(this.emptyWhenInput) {\n                this.content = '';\n            }\n            this.syncShadowInputPosition();\n        }\n    }\n\n    _makeFunctional() {\n        const blurHandler = (event) => {\n            this._status.editing = false;\n            if(this._status.inputElement) {\n                this._status.inputElement.remove();\n            }\n            if(this._belongs) {\n                this._jflow.scheduleRender();\n            } \n        };\n        this.addEventListener('dblclick', (event) => {\n            if(event.currentTarget !== this) {\n                return\n            }\n            if(this._status.editing) {\n                this._selectFullRange();\n            } \n        });\n        this.addEventListener('click', (event) => {\n            if(event.currentTarget !== this) {\n                return\n            }\n            // event.detail.bubbles = false;\n            if(this._status.editing) {\n                const point = this._belongs._currentp;\n                const offset = this._positionToCursorOffset(point);\n                if(this._status.shiftOn) {\n                    const initialRange = this._textRange.initialRange;\n                    Object.assign(this._textRange, {\n                        rangefrom: Math.min(offset, initialRange),\n                        rangeTo: Math.max(offset, initialRange),\n                        enable: true,\n                    });\n                    this._cursorOffset = this._textRange.rangeTo;\n                    this._status.inputElement.focus({ preventScroll: true });\n                    // this._refreshCursor();  \n                } else {\n                    this._cursorOffset = offset\n                    this._status.inputElement.focus({ preventScroll: true });\n                    this._refreshCursor();  \n                    this.syncShadowInputPosition();\n                }\n            } \n            this.click();\n        })\n        this.addEventListener('blur', (event) => {\n            blurHandler(event);\n            this.dispatchEvent(new JFlowEvent('change', {\n                target: this,\n                oldVal: this._status.oldVal,\n                val: this.content,\n            }));\n            this._textRange.enable = false;\n            this._status.cursoranime.cancel()\n            Object.assign(this._status, {\n                editing: false,\n                cursorshow: true,\n                cursoranime: null,\n                lastElapsed: 0,\n                refreshElapsed: false,\n\n                cursorDragging: false,\n                shiftOn: false,\n\n                oldVal: '',\n                inputElement: null,\n            })\n        })\n        this.addEventListener('instancePressStart', (event) => {\n            if(this._status.editing && !this._status.shiftOn) {\n                event.detail.bubbles = false;\n                event.detail.preventDefault();\n                const point = this._belongs._currentp;\n                const c = this._positionToCursorOffset(point);\n\n                this._textRange.initialRange = c;\n                const jflow = event.detail.jflow;\n                let moved = false;\n                const t = (e => {\n                    moved = true;\n                    const { offsetX, offsetY } = e;\n                    const p = jflow._calculatePointBack([offsetX, offsetY]);\n                    jflow._stack.checkHit(p)\n                    const point = this._belongs._currentp;\n                    const c = this._positionToCursorOffset(point);\n                    const initialRange = this._textRange.initialRange;\n                    this._status.editing = false;\n                    Object.assign(this._textRange, {\n                        rangefrom: Math.min(c, initialRange),\n                        rangeTo: Math.max(c, initialRange),\n                        enable: true,\n                    });\n                }).bind(this);\n\n                document.addEventListener('pointermove', t)\n                document.addEventListener('pointerup', (e) => {\n                    document.removeEventListener('pointermove', t);\n                    if(!moved) {\n                        this._textRange.initialRange = null;\n                        return;\n                    }\n                    const rangeTo = this._textRange.rangeTo;\n                    this._cursorOffset = rangeTo;\n                    this._status.editing = true;\n                    this._status.inputElement.focus({ preventScroll: true });   \n                    this._textRange.initialRange = null;\n                }, {\n                    once: true,\n                })\n            }\n        });\n    }\n\n    _positionToCursorOffset(point) {\n        const [x] = point;\n        const w = this.width/2;\n        const [ox] = this.anchor;\n        const offsetX = x - (ox - w);\n        let cursorOffset = 0;\n        if(offsetX >= this._textWidth) {\n            cursorOffset = this.content.length;\n        } else {\n            cursorOffset = this._calculateOffset(offsetX);\n        }\n\n        return cursorOffset;\n    }\n\n    _calculateOffset(offx) {\n        const content = this.content;\n        const maxL = content.length - 1;\n        const contentWidth = this._textWidth;\n        if(contentWidth === 0) {\n            return 0;\n        }\n        const allwidth = contentWidth;\n        let idx = Math.floor(offx / allwidth * maxL) ;\n        requestCacheCanvas((ctx) => {\n            ctx.font = `${this.fontSize} ${this.fontFamily}`;\n            let g1, g2;\n            let lastidx;\n\n            let c = content.substring(0, idx);\n            let c1 = content.substring(idx-1, idx);\n            let c2 = content.substring(idx, idx+1);\n            let w = ctx.measureText(c).width;\n            let w1 = ctx.measureText(c1).width;\n            let w2 = ctx.measureText(c2).width;\n            g1 = w - w1/2;\n            g2 = w + w2/2;\n            \n            do {\n                if(g1 <= offx && g2 >= offx) {\n                    break;\n                }  \n                if(g1 > offx) {\n                    // 左侧少了\n                    const spanw = g2 - offx;\n                    lastidx = idx;\n                    if(spanw < 100) {\n                        idx -= 1;\n                    } else {\n                        idx -= Math.floor(spanw / g2 * lastidx)\n                    }\n                    c = content.substring(idx, lastidx);\n                    w -= ctx.measureText(c).width;\n                } else if(g2 < offx) {\n                    // 右侧少了\n                    const spanw = offx - g1;\n                    lastidx = idx;\n                    if(spanw < 100) {\n                        idx += 1;\n                    } else {\n                        idx += Math.floor(spanw / (allwidth - g1) * (maxL - lastidx))\n                    }\n                    c = content.substring(lastidx, idx);\n                    w += ctx.measureText(c).width;\n                }\n                \n                c1 = content.substring(idx-1, idx);\n                c2 = content.substring(idx, idx+1);\n                w1 = ctx.measureText(c1).width;\n                w2 = ctx.measureText(c2).width;\n                g1 = w - w1/2;\n                g2 = w + w2/2;\n            } while(idx >= 0 && idx <= maxL)\n            \n        });\n        return idx;\n    }\n\n    _refreshCursor() {\n        if(this._status.editing) {\n            Object.assign(this._status, {\n                cursorshow: true,\n                refreshElapsed: true,\n            });\n        }\n        if(this._textRange.enable) {\n            this._textRange.enable = false;\n        }\n    }\n\n    render(ctx) {\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        if(!ctx.disableCache && !this._status.editing && this._jflow.scale * parseInt(this.fontSize) < 8) {\n            const [cx, cy] = this.anchor;\n            // this._shadowCache.render(ctx);\n            ctx.save();\n            ctx.translate(cx, cy);\n            ctx.beginPath();\n            ctx.drawImage(this._shadowCache.imageBuffer, -this.width/2, -this.height/2, this.width, this.height);\n            ctx.translate(-cx, -cy);\n            ctx.restore();\n            return;\n        }\n\n        const font = `${this.fontWeight} ${this.fontSize} ${this.fontFamily}`;\n        if(ctx.font !== font) {\n            ctx.font = font\n        }\n\n        if(ctx.textAlign !== this.textAlign) {\n            ctx.textAlign = this.textAlign;\n        }\n\n        if(ctx.textBaseline !== this.textBaseline) {\n            ctx.textBaseline = this.textBaseline;\n        }\n\n        ctx.fillStyle = this.isEmpty ? this.placeholderColor : this.textColor;\n        let content = this.currentContent;\n        if(this.ellipsisContent) {\n            content = this.ellipsisContent;\n        }\n        if(content) {\n            if(this.textAlign === TEXT_ALIGN.LEFT){\n                const hw = this.width / 2;\n                ctx.fillText(content, this.anchor[0] - hw + this.indent / 2, this.anchor[1]);\n            } else if(this.textAlign === TEXT_ALIGN.RIGHT) {\n                const hw = this.width / 2;\n                ctx.fillText(content, this.anchor[0] + hw, this.anchor[1]);\n            } else {\n                ctx.fillText(content, this.anchor[0] + this.indent / 2, this.anchor[1]);\n            }\n            \n        }\n\n        const hw = this.width/2;\n        const textheight = this._textHeight\n        const [x, y] = this.anchor;\n        const lx = x - hw;\n        const ly = y - textheight/2;\n\n        if(this._status.cursorshow && this._status.editing) {\n            const offset = this._cursorOffset;\n            const c = this.content.substring(0, offset);\n            const cw = lx + ctx.measureText(c).width;\n            const c_len = this._textHeight/2;\n            ctx.beginPath();\n            ctx.moveTo(cw, y - c_len);\n            ctx.lineTo(cw, y + c_len);\n            ctx.lineWidth = 2;\n            ctx.strokeStyle = this.cursorColor;\n            ctx.stroke();\n        }\n\n        if(this._textRange.enable) {\n            const {\n                rangefrom, rangeTo\n            } = this._textRange;\n            const c = this.content.substring(0, rangefrom);\n            const range = this.content.substring(rangefrom, rangeTo)\n            \n            const x = lx + ctx.measureText(c).width;\n            const w = ctx.measureText(range).width;\n            ctx.beginPath();\n            ctx.rect(x, ly, w, textheight);\n            ctx.fillStyle = this.textRangeColor\n            ctx.fill();\n        } \n    }\n\n    _inputControl(op, data) {\n        if(this._textRange.enable) {\n            this._clearTextRange();\n            if(op === 'Backspace') {\n                this.dispatchEvent(new JFlowEvent('input', {\n                    target: this,\n                    oldVal: this._status.oldVal,\n                    val: this.content,\n                }));\n                this.refresh();\n                this.syncShadowInputPosition();\n                return;\n            }\n        }\n        const offset = this._cursorOffset;\n        const content = this.content;\n        let preContent = content.substring(0, offset);\n        let afterContent \n        if(this.cacheIdx) {\n            afterContent = content.substring(this.cacheIdx[1]);\n        } else {\n            afterContent = content.substring(offset);\n        }\n        let stopInputEvent = false;\n        switch(op){\n            case \"Input\":\n                preContent += data;\n                this._cursorOffset += data.length;\n                this.content = preContent + afterContent;\n                break;\n            case \"compositionstart\":\n                this.cacheIdx = [preContent.length, preContent.length];\n                break;\n            case \"compositionupdate\":\n                preContent = preContent.substring(0, this.cacheIdx[0]);\n                preContent += data;\n                this.content = preContent + afterContent;\n\n                this._cursorOffset = this.cacheIdx[0] + data.length;\n                this.cacheIdx[1] = this.cacheIdx[0] + data.length;\n                break;\n            case \"compositionend\":\n                preContent = preContent.substring(0, this.cacheIdx[0]);\n                this._cursorOffset = this.cacheIdx[0] + data.length;\n                this.cacheIdx = null;\n                preContent += data;\n                this.content = preContent + afterContent;\n                break;\n            case \"Enter\":\n                if(this.cacheIdx) {\n                    return;\n                }\n                let defaultAct = true;\n                \n                this.dispatchEvent(new JFlowEvent('enterkeypressed', {\n                    target: this,\n                    handler: (val) => {\n                        defaultAct = val;\n                    },\n                    stopInput() {\n                        stopInputEvent = true;\n                    }\n                }))\n                if(defaultAct) {\n                    this._jflow.blur();\n                }\n         \n                break;\n            case \"Backspace\":\n                preContent = preContent.substring(0, preContent.length - 1);\n                this._cursorOffset = Math.max(0, this._cursorOffset-1);\n                this.content = preContent + afterContent;\n                break;\n            \n        }\n\n        if(!stopInputEvent) {\n            this.dispatchEvent(new JFlowEvent('input', {\n                target: this,\n                oldVal: this._status.oldVal,\n                val: this.content,\n            }));\n    \n        }\n       \n        this.refresh();\n        this.syncShadowInputPosition();\n    }\n\n    refresh() {\n        this.preCalculateText();\n        this._belongs.recalculateUp();\n        this._jflow.scheduleRender();\n    }\n\n    syncShadowInputPosition() {\n        if(this._status.editing) {\n            const hw = this.width/2;\n            const hh = this.height/2;\n            let lx = this.anchor[0] - hw;\n            const offset = this._cursorOffset;\n\n            requestCacheCanvas((ctx) => {\n                ctx.beginPath();\n                ctx.font = `${this.fontSize} ${this.fontFamily}`;\n                const c = this.content.substring(0, offset);\n                lx += ctx.measureText(c).width;\n            });\n            const point = this.calculateToRealWorld([lx, hh]);\n            const canvasMeta = this._jflow.canvasMeta;\n            const px = Math.min(canvasMeta.actual_width - 120, point[0]);\n            this._status.inputElement.style.transform = `translate(${px}px, ${point[1]}px)`\n        }\n    }\n\n    _controlCallback(op, data, e) {\n        if(this._status.editing) {\n            Object.assign(this._status, {\n                cursorshow: true,\n                refreshElapsed: true,\n            });\n        }\n        switch(op){\n            case \"Input\":\n            case \"compositionstart\":\n            case \"compositionupdate\":\n            case \"compositionend\":\n            case \"Enter\":\n            case \"Backspace\":\n                this._inputControl(op, data);\n                break;\n            case \"ArrowLeft\":\n                if(this._textRange.enable) {\n                    this._textRange.enable = false;\n                }\n                this._onArrowLeft();\n                break;\n            case \"ArrowRight\":\n                if(this._textRange.enable) {\n                    this._textRange.enable = false;\n                }\n                this._onArrowRight();\n                break;\n            case \"Shift\":\n                this._onShiftToggle(data)\n                break;\n            case \"CtrlA\":\n                this._selectFullRange();\n                break;\n            case \"COPY\":\n                this._copy(e);\n                break;\n            case \"CUT\":\n                this._cut(e);\n                break;\n            case \"PASTE\":\n                this._paste(e);\n                break;\n        }\n\n    }\n\n    _onArrowLeft() {\n        this._cursorOffset = Math.max(0, this._cursorOffset - 1);\n        this._jflow.scheduleRender();\n        this.syncShadowInputPosition();\n    }\n\n    _onArrowRight() {\n        this._cursorOffset = Math.min(this.content.length, this._cursorOffset + 1);\n        this._jflow.scheduleRender();\n        this.syncShadowInputPosition();\n    }    \n\n    _onShiftToggle(val) {\n        this._status.shiftOn = val;\n        if(val) {\n            this._textRange.initialRange = this._cursorOffset;\n        } else {\n            this._textRange.initialRange = null;\n        }\n    }\n\n    _selectFullRange() {\n        this._textRange = {\n            enable: true,\n            rangefrom: 0,\n            rangeTo: this.content.length\n        }\n        this._cursorOffset = this.content.length;\n    }\n\n    _clearTextRange() {\n        if(this._textRange.enable) {\n            const { rangefrom, rangeTo } = this._textRange;\n            const content = this.content;\n            const preContent = content.substring(0, rangefrom);\n            const afterContent = content.substring(rangeTo);\n            this.content = preContent + afterContent;\n            this._cursorOffset = preContent.length;\n            this._textRange.enable = false;\n        }\n    }\n\n    _getSelection() {\n        if(this._textRange.enable) {\n            const { rangefrom, rangeTo } = this._textRange;\n            const content = this.content;\n            return content.substring(rangefrom, rangeTo);\n        }\n        return null;\n    }\n\n    _copy(event) {\n        const selection = this._getSelection();\n        if(selection) {\n            event.clipboardData.setData(\"text/plain\", selection);\n        }\n    }\n    _cut(event) {\n        const selection = this._getSelection();\n        if(selection) {\n            event.clipboardData.setData(\"text/plain\", selection);\n            this._clearTextRange();\n            this.refresh();\n        }\n    }\n    _paste(event) {\n        let pasteContent = (event.clipboardData || window.clipboardData).getData(\"text\");\n        let flag = false;\n        this.dispatchEvent(new JFlowEvent('paste', {\n            target: this,\n            content: pasteContent,\n            preventDefault() {\n                flag = true;\n            },\n            resolvePasteContent(callback) {\n                pasteContent = callback(pasteContent);\n            }\n        }));\n        if(flag) {\n            return;\n        }\n        this._clearTextRange();\n        const offset = this._cursorOffset;\n        const content = this.content;\n        const preContent = content.substring(0, offset);\n        const afterContent = content.substring(offset);\n        this.content = preContent + pasteContent + afterContent;\n        this._cursorOffset = (preContent + pasteContent).length;\n        this.refresh();\n    }\n    _defaultCallback(op, e) {\n        switch(op){\n            case 'KeyDown': \n                this.dispatchEvent(new JFlowEvent('keydown', {\n                    target: this,\n                    key: e.key,\n                    code: e.code,\n                    rawEvent: e,\n                }));\n                break;\n            case 'KeyUp': \n                this.dispatchEvent(new JFlowEvent('keyup', {\n                    target: this,\n                    key: e.key,\n                    code: e.code,\n                    rawEvent: e,\n                }));\n                break;\n        }\n        \n    }\n\n    destroy() {\n        if(this._jflow._focus.instance === this) {\n            this._jflow.blur();\n        }\n    }\n}       \n\nexport default Text;\n\n\nfunction createInputElement(controlCallback, defaultCallback) {\n    const input = document.createElement('input');\n    input.setAttribute('style',`\n        width: 100px;\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        opacity: 0;\n        z-index: -1;\n        contain: strict;`);\n    input.setAttribute('tabindex', -1);\n    input.setAttribute('aria-hidden', true);\n    input.setAttribute('spellcheck', false);\n    input.setAttribute('autocorrect', 'off');\n\n\n    // let content = configs.content;\n    // let startidx = 0;\n\n    // function renderContent() {\n    //     configs.callback(content)\n    // }\n    let stopInput = false;\n    let status = {\n        ctrlOn: false,\n    }\n\n    input.addEventListener('beforeinput', e => {\n        e.preventDefault();\n        if(e.data) {\n            // content += e.data;\n            // renderContent();\n            if(!stopInput) {\n                controlCallback('Input', e.data);\n            }\n        }\n    })\n\n    input.addEventListener('compositionstart', (e) => {\n        // cache composition start offset\n        // startidx = content.length;\n        controlCallback('compositionstart');\n        stopInput = true;\n    });\n    input.addEventListener('compositionupdate', (e) => {\n        // update content\n        // content = content.substring(0, startidx);\n        // content += e.data;\n        // renderContent();\n        controlCallback('compositionupdate', e.data);\n    });\n    input.addEventListener('compositionend', (e) => {\n        // replace text at start offset\n        // content = content.substring(0, startidx);\n        // startidx = 0;\n        // content += e.data;\n        // renderContent();\n        controlCallback('compositionend', e.data);\n        input.value = '';\n        stopInput = false\n    });\n\n    input.addEventListener('keyup', (event) => {\n        switch(event.key) {\n            case \"Shift\":\n                controlCallback(\"Shift\", false);\n                break;\n            case \"Meta\":\n            case \"Control\":\n                status.ctrlOn = false;\n                break;\n            \n        }\n    });\n\n    input.addEventListener('keydown', (event) => {\n        switch(event.code) {\n            case \"Enter\":\n                // content = content + '\\n';\n                // renderContent();\n                controlCallback('Enter');\n                break;\n            case \"Backspace\":\n                // content = content.substring(0, content.length - 1);\n                // renderContent();\n                controlCallback('Backspace');\n                break;\n            case \"ArrowLeft\":\n                controlCallback(\"ArrowLeft\");\n                break;\n            case \"ArrowRight\":\n                controlCallback(\"ArrowRight\");\n                break;\n            case \"ArrowDown\":\n                controlCallback(\"ArrowDown\");\n                break;\n            case \"ArrowUp\":\n                controlCallback(\"ArrowUp\");\n                break;\n        }\n        switch(event.key) {\n            case \"Shift\":\n                controlCallback(\"Shift\", true);\n                break;\n            case \"Meta\":\n            case \"Control\":\n                status.ctrlOn = true;\n                break;\n            case 'a':\n                if(status.ctrlOn) {\n                    controlCallback('CtrlA');\n                }\n                break;\n        }\n    })\n\n    input.addEventListener('keyup', (event) => {\n        defaultCallback('KeyUp', event);\n    });\n\n    input.addEventListener('keydown', (event) => {\n        defaultCallback('KeyDown', event);\n    });\n\n    input.addEventListener('copy', event => {\n        event.preventDefault();\n        event.stopPropagation();\n        controlCallback('COPY', null, event);\n    });\n\n    input.addEventListener('cut', event => {\n        event.preventDefault();\n        event.stopPropagation();\n        controlCallback('CUT', null, event);\n    });\n\n    input.addEventListener('paste', event => {\n        event.preventDefault();\n        event.stopPropagation();\n        controlCallback('PASTE', null, event);\n    });\n    return input;\n}\n","import Rectangle from './shapes/rectangle';\nimport StackMixin from './stackMixin';\nimport LayoutMixin from './layoutMixin';\nimport { bounding_box } from '../utils/functions';\nimport { DIRECTION } from '../utils/constance';\n\n/**\n * @typedef {Object} Icon~ImageBounding\n * @property {number} width   - 图片宽度\n * @property {number} height   - 图片高度 \n */\n/**\n * 图片单元 配置\n * @typedef {Rectangle~RectangleConfigs} Icon~IconConfigs\n * @property {number} image   - 图片地址\n * @property {number} imageWidth   - 图片宽度\n * @property {number} imageHeight   - 图片高度\n */\n\n/**\n * 图片单元\n * @description 图片单元可以绘制图片，图片加载后会自动重新绘制\n * @constructor Icon\n * @extends Rectangle\n * @param {Icon~IconConfigs} configs - 配置\n */\nclass Icon extends Rectangle {\n    constructor(configs) {\n        super(configs)\n        /** @member {CanvasImageSource}      - 图片 */\n        this.image = configs.image;\n        this.image.onload = () => {\n            this._jflow._render();\n            // requestAnimationFrame(() => {\n                \n            // })\n        }\n        /** @member {Icon~ImageBounding}      - 图片维度 */\n        this.imageBounding = {\n            width: configs.imageWidth || configs.width,\n            height: configs.imageHeight ||  configs.height,\n        }\n    }\n\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k];\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n        if(configs.image && !configs.image.complete) {\n            this.image.onload = () => {\n                this._jflow._render();\n                // requestAnimationFrame(() => {\n                //     this._jflow._render();\n                // })\n            }\n        }\n        this.imageBounding = {\n            width: configs.imageWidth || configs.width || this.imageBounding.width,\n            height: configs.imageHeight ||  configs.height || this.imageBounding.height,\n        }\n    }\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        Rectangle.prototype.render.call(this, ctx);\n        const x = this.anchor[0] - this.width / 2;\n        const y = this.anchor[1] - this.height / 2;\n        if(this.opacity < 1) {\n            ctx.globalAlpha = this.opacity;\n        }\n        if(this.image.complete) {\n            ctx.drawImage(this.image, x, y, this.imageBounding.width, this.imageBounding.height);\n        }\n        ctx.restore();\n    }\n}\nexport default Icon;","import Rectangle from './shapes/rectangle';\n/**\n * @funtion domFactory\n * @param {Element} container - DOM容器\n */\n/**\n * DOM元素容器 配置\n * @typedef {Rectangle~Configs} ShadowDom~RectangleConfigs\n * @property {domFactory} createDocument - 宽\n */\n/**\n * DOM元素容器 内容可贴 DOM 元素，支持缩放平移\n * @constructor ShadowDom\n * @extends Rectangle\n * @param {ShadowDom~RectangleConfigs} configs\n */\nclass ShadowDom extends Rectangle {\n    constructor(configs) {\n        super(configs);\n        this.domFactory = configs.createDocument;\n        this._dom = null;\n    }\n\n    getRealWorldPosition() {\n        const b = this.getBoundingRect();\n        return this.calculateToRealWorld(b.slice(0, 2));\n    }\n\n    render(ctx) {\n        if(!this._dom && this.domFactory) {\n            requestAnimationFrame(() => {\n                if(!this._dom) {\n                    const container = document.createElement('div');\n                    const pos = this.getRealWorldPosition();\n                    const scale = this._jflow.scale;\n                    container.setAttribute('style', `\n                        position: absolute;\n                        width: ${this.width}px;\n                        height: ${this.height}px;\n                        transform-origin: left top;\n                        top: 0;\n                        left: 0;\n                        transform: translate(${pos[0]}px, ${pos[1]}px) scale(${scale});`);\n                    this._dom = container;\n                    this._jflow.DOMwrapper.appendChild(container);\n                    this.domFactory(container);\n                }\n            });\n        } else {\n            const pos = this.getRealWorldPosition();\n            const scale = this._jflow.scale;\n            this._dom.style.transform = `translate(${pos[0]}px, ${pos[1]}px) scale(${scale})`\n        }\n        super.render(ctx)\n    }    \n\n    onEnterViewbox() {\n        if(this._dom) {\n            this._dom.style.display = 'block';\n        }\n    }\n\n    onLeaveViewbox(){\n        if(this._dom) {\n            this._dom.style.display = 'none';\n        }\n    }\n\n    destroy() {\n        \n        if(this._dom) {\n            this._jflow.DOMwrapper.removeChild(this._dom);\n        }\n        super.destroy();\n    }\n}\nexport default ShadowDom;\n","import BaseLink from './base-link';\nimport { distToSegmentSquared,\n    isPolyLineIntersectionRectange,\n    compareBoundingbox,\n    copyBoundingbox\n} from '../utils/functions';\nimport { APPROXIMATE } from '../utils/constance';\n/**\n * @typedef {BaseLink~Configs} Link~Configs\n * @property {Number} approximate   - 点击响应范围\n * @property {Number[]} lineDash    - 虚线数组\n * @property {Boolean} doubleLink   - 双向箭头\n * @property {String} fontFamily    - 连线上的文字字体\n * @property {Number} fontSize      - 连线上的文字大小\n * @property {String} content       - 连线上的文字\n */\n/**\n * 直线\n * @constructor Link\n * @extends BaseLink\n * @param {Link~Configs} configs - 配置\n */\nclass Link extends BaseLink {\n    constructor(configs) {\n        super(configs);\n        this.fontFamily    = configs.fontFamily = '-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji'\n        this.fontSize      = configs.fontSize || '12px';\n        this.content       = configs.content || '';\n        this.lineDash      = configs.lineDash;\n        this.approximate  = configs.approximate || APPROXIMATE;\n\n        this._cacheAngle = undefined;\n        this._cachePoints = [];\n        this._cacheBoundingbox = {\n            from: [],\n            to: []\n        };\n    }\n\n    _calculateAnchorPoints() {\n        const p0 = this.from.calculateIntersection(this.to.getCenter());\n        const p1 = this.to.calculateIntersection(this.from.getCenter());\n        this._cachePoints[0] = p0;\n        this._cachePoints[1] = p1;\n        const dx = p1[0] - p0[0];\n        const dy = p1[1] - p0[1];\n        const angle = Math.atan2(dy, dx);\n        this._cacheAngle = angle;\n    }\n    \n    isInViewBox(br) {\n        const frombox = this.from.getBoundingRect();\n        const tobox = this.to.getBoundingRect();\n        const _box = this._cacheBoundingbox;\n        if(!compareBoundingbox(_box.from, frombox) || compareBoundingbox(_box.to, tobox)) {\n            copyBoundingbox(_box.from, frombox);\n            copyBoundingbox(_box.to, tobox);\n            this._calculateAnchorPoints();\n        }\n        return true;\n    }\n\n    render(ctx) {\n        const [ p0, p1 ] = this._cachePoints;\n        const angle = this._cacheAngle;\n        const dx = p1[0] - p0[0];\n        const dy = p1[1] - p0[1];\n        ctx.fillStyle = ctx.strokeStyle = this.backgroundColor;\n        ctx.beginPath();\n        if(this.content){ \n\n            ctx.textAlign = 'center';\n            ctx.font = `${this.fontSize} ${this.fontFamily}`;\n            ctx.textBaseline = 'middle';\n            const {\n                actualBoundingBoxLeft,\n                actualBoundingBoxRight,\n                fontBoundingBoxAscent,\n                fontBoundingBoxDescent\n            } = ctx.measureText(this.content);\n            const x = dx /2 + p0[0];\n            const y = dy /2 + p0[1];\n            ctx.fillText(this.content, x, y);\n            const width = Math.abs(actualBoundingBoxLeft) + Math.abs(actualBoundingBoxRight) + 20;\n            const height = (Math.abs(fontBoundingBoxAscent) + Math.abs(fontBoundingBoxDescent)) * 1.5;\n            ctx.beginPath();\n            let region = new Path2D();\n            region.rect(x - width/2 , y - height/2, width, height);\n            const rx = Math.min(p1[0], p0[0]) - 10;\n            const ry = Math.min(p1[1], p0[1]) - 10;\n            const rw = Math.abs(dx) + 20;\n            const rh = Math.abs(dy) + 20;\n            region.rect(rx , ry, rw, rh);\n            ctx.clip(region, \"evenodd\");\n        }\n\n\n        ctx.moveTo(p0[0], p0[1]);\n        ctx.lineTo(p1[0], p1[1]);\n        if(this.lineDash) {\n            ctx.save();\n            ctx.setLineDash(this.lineDash);\n        }\n        ctx.stroke();\n        if(this.lineDash) {\n            ctx.restore();\n        }\n\n        ctx.translate(p1[0], p1[1]);\n        ctx.rotate(angle);\n        ctx.moveTo(0, 0);\n        ctx.lineTo(-5, -4);\n        ctx.lineTo(-5, 4);\n        ctx.lineTo(0, 0);\n        ctx.fill();\n        ctx.rotate(-angle);\n        ctx.translate(-p1[0], -p1[1]);\n    }\n\n    isHit(point) {\n        if(!this._cachePoints) return false;\n        const [ start, end ] = this._cachePoints;\n        const dist = distToSegmentSquared(point, start, end)\n        return dist < this.approximate;\n    }\n}\n\nexport default Link;","import BaseLink from './base-link';\nimport { \n    polylinePoints, \n    distToSegmentSquared, \n    makeRadiusFromVector, \n    minIntersectionBetweenNodes,\n    isPolyLineIntersectionRectange,\n} from '../utils/functions';\nimport { APPROXIMATE, DIRECTION } from '../utils/constance';\n// import { dist2, bezierPoint } from '../utils/functions';\nconst PIINRATIO = Math.PI / 180\n/**\n * @typedef {BaseLink~Configs} PolyLink~Configs\n * @property {Number} approximate   - 点击响应范围\n * @property {Number} radius        - 拐角弧度\n * @property {Number} minSpanX      - 起点终点在 x 方向最小的跨度\n * @property {Number} minSpanY      - 起点终点在 y 方向最小的跨度\n * @property {number[]} lineDash    - 虚线数组\n * @property {Boolean} doubleLink   - 双向箭头\n * @property {String} fontFamily    - 连线上的文字字体\n * @property {Number} fontSize      - 连线上的文字大小\n * @property {String} content       - 连线上的文字\n * @property {String} isSelf        - 是否为自连接\n */\n/**\n * 方形折线\n * @constructor PolyLink\n * @extends BaseLink\n * @param {PolyLink~Configs} configs - 配置\n */\nclass PolyLink extends BaseLink {\n     /**\n     * 创建方形折线\n     * @param {PolyLink~Configs} configs - 配置\n     **/\n    constructor(configs) {\n        super(configs);\n        /** @member {Number}   - 点击响应范围 */\n        this.approximate   = configs.approximate || APPROXIMATE;\n        /** @member {Number}   - 拐角弧度 */\n        this.radius        = configs.radius || 0;\n        /** @member {Number}   - 起点终点在 x 方向最小的跨度 */\n        this.minSpanX      = configs.minSpanX || 10;\n        /** @member {Number}   - 起点终点在 y 方向最小的跨度 */\n        this.minSpanY      = configs.minSpanY || 10;\n        /** @member {Number}    - 虚线数组 */\n        this.lineDash      = configs.lineDash;\n        /** @member {Number}    - 双向箭头 */\n        this.doubleLink    = configs.doubleLink;\n        /** @member {Number}    - 连线上的文字字体 */\n        this.fontFamily    = configs.fontFamily = '-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji'\n        /** @member {Number}    - 连线上的文字大小 */\n        this.fontSize      = configs.fontSize || '12px';\n        /** @member {Number}    - 连线上的文字 */\n        this.content       = configs.content || '';\n        /** @member {Number}    - 是否为自连接 */\n        this.isSelf        = !!configs.isSelf\n\n        this.noArrow       = !!configs.noArrow \n        this._cacheAngle = [];\n        this._cachePoints = [];\n        this._cacheBoundingbox = {\n            from: [],\n            to: []\n        };\n    }\n\n    _calculateAnchorPoints() {\n        const dmsfrom = this.from.getIntersectionsInFourDimension();\n        const dmsto = this.to.getIntersectionsInFourDimension();\n        const _cacheAngle = this._cacheAngle;\n        if(this.isSelf){\n            polylinePoints(\n                this._cachePoints,\n                dmsfrom[this.fromDir],\n                dmsto[DIRECTION.SELF],\n                this.fromDir,\n                this.toDir, \n                this.minSpanX, \n                this.minSpanY,\n                true);\n            _cacheAngle[0] = this.fromDir;\n            _cacheAngle[1] = this.toDir;\n        } else if(this.fromDir !== undefined && this.toDir !== undefined) {\n            polylinePoints(\n                this._cachePoints,\n                dmsfrom[this.fromDir],\n                dmsto[this.toDir],\n                this.fromDir,\n                this.toDir, this.minSpanX , this.minSpanY);\n            _cacheAngle[0] = this.fromDir;\n            _cacheAngle[1] = this.toDir;\n        } else {\n            const meta = minIntersectionBetweenNodes(dmsfrom, dmsto);\n            polylinePoints(\n                this._cachePoints,\n                meta.fromP,\n                meta.toP,\n                meta.fromDir,\n                meta.toDir,\n                this.minSpanX , this.minSpanY);\n            _cacheAngle[0] = meta.fromDir;\n            _cacheAngle[1] = meta.toDir;\n        }\n    }\n    \n    isInViewBox(br) {\n        if(this._static) {\n            return true;\n        }\n        this._calculateAnchorPoints();     \n        return isPolyLineIntersectionRectange(this._cachePoints, br);\n    }\n\n    render(ctx) {\n        // this._calculateAnchorPoints();\n        const radius = this.radius;\n        const points = this._cachePoints;\n        const p = points[0];\n        const pEnd = points[points.length - 1];\n        const angleEnd = ((this._cacheAngle[1] + 2) % 4) * 90 * PIINRATIO;\n        ctx.fillStyle = ctx.strokeStyle = this.backgroundColor;\n        if(this.doubleLink) {\n            const beginAngle = ((this._cacheAngle[0] + 2) % 4) * 90 * PIINRATIO;\n            ctx.beginPath();\n            ctx.translate(p[0], p[1]);\n            ctx.rotate(beginAngle);\n            ctx.moveTo(5, 0);\n            ctx.lineTo(0, -4);\n            ctx.lineTo(0, 4);\n            ctx.lineTo(5, 0);\n            ctx.fill();\n            ctx.rotate(-beginAngle);\n            ctx.translate(-p[0], -p[1]);\n        }\n        ctx.beginPath();\n        ctx.moveTo(p[0], p[1]);\n        points.slice(1, points.length - 1).forEach((p, idx) => {\n            if(this.radius) {\n                const pLast = points[idx];\n                const pNext = points[idx+2];\n                const { p1, p2 } = makeRadiusFromVector(pLast, p, pNext, radius);\n                if(p1 && p2){\n                    ctx.lineTo(p1[0], p1[1]);\n                    ctx.quadraticCurveTo(p[0], p[1], p2[0], p2[1]);\n                } else {\n                    ctx.lineTo(p[0], p[1]);\n                }  \n            } else {\n                ctx.lineTo(p[0], p[1]);\n            }\n        });\n        ctx.lineTo(pEnd[0], pEnd[1]);\n\n        if(this.lineDash) {\n            ctx.save();\n            ctx.setLineDash(this.lineDash);\n        }\n        ctx.stroke();\n        if(this.lineDash) {\n            ctx.restore();\n        }\n\n        if(!this.noArrow) {\n            ctx.beginPath();\n            ctx.translate(pEnd[0], pEnd[1]);\n            ctx.rotate(angleEnd);\n            ctx.moveTo(0, 0);\n            ctx.lineTo(-5, -4);\n            ctx.lineTo(-5, 4);\n            ctx.lineTo(0, 0);\n            ctx.fill();\n            ctx.rotate(-angleEnd);\n            ctx.translate(-pEnd[0], -pEnd[1]);\n        }\n        if(this.content) {\n            ctx.beginPath();\n            ctx.font = `${this.fontSize} ${this.fontFamily}`;\n            switch (this.fromDir) {\n                case DIRECTION.BOTTOM:\n                    ctx.textAlign = 'left';\n                    ctx.fillText(this.content, p[0] + 2, p[1] + 10);\n                    break;\n                case DIRECTION.RIGHT:\n                    ctx.textAlign = 'left';\n                    ctx.fillText(this.content, p[0] + 10, p[1] - 2);\n                    break;\n                default:\n                    break;\n            }\n        }\n\n    }\n\n    isHit(point) {\n        if(this._static) {\n            return false;\n        }\n        if(!this._cachePoints) {\n            return false;\n        }\n        const points = this._cachePoints;\n        let lastP = points[0];\n        const remainPoints = points.slice(1)\n        do {\n            const currentP = remainPoints.shift();\n            if(currentP) {\n                const dist = distToSegmentSquared(point, lastP, currentP);\n                if(dist < this.approximate){\n                    return true;\n                }\n            }\n            lastP = currentP;\n        } while(lastP)\n\n        return false\n    }\n\n    cloneStatic() {\n        const t = new PolyLink({});\n        Object.assign(t, {\n            radius: this.radius,\n            _cachePoints: this._cachePoints,\n            _cacheAngle: this._cacheAngle,\n            backgroundColor: this.backgroundColor,\n            doubleLink: this.doubleLink,\n            radius: this.radius,\n            lineDash: this.lineDash,\n            noArrow: this.noArrow,\n            content: this.content,\n            fontSize: this.fontSize,\n            fontFamily: this.fontFamily,\n            fromDir: this.fromDir,\n            _static: true,\n        });\n        return t;\n    }\n}\n\nexport default PolyLink;","import BaseLink from './base-link';\nimport { bezierPoints, distToBezierSegmentSquared, getBezierAngle, minIntersectionBetweenNodes } from '../utils/functions';\nimport { APPROXIMATE, DIRECTION } from '../utils/constance';\nimport { dist2, bezierPoint } from '../utils/functions';\nconst PIINRATIO = Math.PI / 180\n/**\n * @typedef {BaseLink~Configs} BezierLink~Configs\n * @property {Number} approximate   - 点击响应范围\n * @property {Number} minSpanX      - 起点终点在 x 方向最小的跨度\n * @property {Number} minSpanY      - 起点终点在 y 方向最小的跨度\n * @property {Number[]} lineDash    - 虚线数组\n * @property {Boolean} doubleLink   - 双向箭头\n * @property {String} fontFamily    - 连线上的文字字体\n * @property {Number} fontSize      - 连线上的文字大小\n * @property {String} content       - 连线上的文字\n * @property {Boolean} isSelf        - 是否为自连接\n */\n/**\n * 贝塞尔曲线\n * @constructor BezierLink\n * @extends BaseLink\n * @param {BezierLink~Configs} configs - 配置\n */\nclass BezierLink extends BaseLink {\n     /**\n     * 创建贝塞尔曲线.\n     * @param {BezierLink~Configs} configs - 配置\n     **/\n    constructor(configs) {\n        super(configs);\n        /** @member {Number}      - 点击响应范围 */\n        this.approximate   = configs.approximate || APPROXIMATE;\n        /** @member {Number}      - 起点终点在 x 方向最小的跨度 */\n        this.minSpanX      = configs.minSpanX || 0;\n        /** @member {Number}      - 起点终点在 y 方向最小的跨度 */\n        this.minSpanY      = configs.minSpanY || 0;\n        /** @member {Number[]}      - 虚线数组 */\n        this.lineDash      = configs.lineDash;\n        /** @member {Boolean}      - 双向箭头 */\n        this.doubleLink    = configs.doubleLink;\n        /** @member {String}      - 连线上的文字字体 */\n        this.fontFamily    = configs.fontFamily = '-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji'\n        /** @member {Number}      - 连线上的文字大小 */\n        this.fontSize      = configs.fontSize || '12px';\n        /** @member {String}      - 连线上的文字 */\n        this.content       = configs.content || '';\n        /** @member {Boolean}      - 是否为自连接 */\n        this.isSelf        = !!configs.isSelf\n    }\n    \n    // getColor() {\n    //     if(this._isTargeting) {\n    //         return this.hoverStyle;\n    //     }\n    //     return this.defaultStyle;\n    // }\n    \n    // _calculateAnchorPoints() {\n    //     let start;\n    //     let end;\n    //     if(this.fromDir !== undefined) {\n    //         start = {\n    //             dir: this.fromDir,\n    //             p: this.from.getIntersectionsInFourDimension()[this.fromDir],\n    //         }\n    //     } else {\n    //         start = this.from.calculateIntersectionInFourDimension(this.to.getCenter(), 'from');\n    //     }\n    //     if(this.toDir !== undefined) {\n    //         end = {\n    //             dir: this.toDir,\n    //             p: this.to.getIntersectionsInFourDimension()[this.toDir],\n    //         }\n    //     } else {\n    //         end = this.to.calculateIntersectionInFourDimension(this.from.getCenter(), 'to');\n    //     }\n        \n        \n    //     // const start = this.from.calculateIntersectionInFourDimension(this.to.getCenter(), 'from');\n    //     // const end = this.to.calculateIntersectionInFourDimension(this.from.getCenter(), 'to');\n    //     const p1 = start.p;\n    //     const p2 = end.p;\n    //     const points = bezierPoints(p1, p2, start.dir, end.dir, this.anticlock);\n\n    //     this._cachePoints = [...p1, ...points]\n    // }\n\n    _calculateAnchorPoints() {\n        const dmsfrom = this.from.getIntersectionsInFourDimension();\n        const dmsto = this.to.getIntersectionsInFourDimension();\n        if(this.isSelf) {\n            const points = bezierPoints(\n                dmsfrom[this.fromDir],\n                dmsto[DIRECTION.SELF],\n                this.fromDir,\n                DIRECTION.BOTTOM, \n                this.minSpanX, \n                this.minSpanY);\n\n            this._cachePoints = [...dmsfrom[this.fromDir], ...points] \n            this._cacheAngle = [this.fromDir, DIRECTION.BOTTOM]\n        } else if(this.fromDir !== undefined && this.toDir !== undefined) {\n            const points = bezierPoints(\n                dmsfrom[this.fromDir],\n                dmsto[this.toDir],\n                this.fromDir,\n                this.toDir, this.minSpanX , this.minSpanY);\n            this._cachePoints = [...dmsfrom[this.fromDir], ...points] \n            this._cacheAngle = [this.fromDir, this.toDir]\n        } else {\n            const meta = minIntersectionBetweenNodes(dmsfrom, dmsto);\n            const points = bezierPoints(\n                meta.fromP,\n                meta.toP,\n                meta.fromDir,\n                meta.toDir);\n\n            this._cachePoints = [...meta.fromP, ...points];\n            this._cacheAngle = [meta.fromDir, meta.toDir];\n        }\n    }\n\n    render(ctx) {\n        this._calculateAnchorPoints();\n        const points = this._cachePoints;\n        const angle = getBezierAngle.apply(null, [1, ...points])\n        ctx.fillStyle = ctx.strokeStyle = this.backgroundColor;\n        if(this.doubleLink) {\n            const beginAngle = ((this._cacheAngle[0] + 2) % 4) * 90 * PIINRATIO;\n            ctx.beginPath();\n            ctx.translate(points[0], points[1]);\n            ctx.rotate(beginAngle);\n            ctx.moveTo(5, 0);\n            ctx.lineTo(0, -4);\n            ctx.lineTo(0, 4);\n            ctx.lineTo(5, 0);\n            ctx.fill();\n            ctx.rotate(-beginAngle);\n            ctx.translate(-points[0], -points[1]);\n        }\n        ctx.beginPath();\n        ctx.moveTo(points[0], points[1])\n        ctx.bezierCurveTo(...points.slice(2));\n        if(this.lineDash) {\n            ctx.save();\n            ctx.setLineDash(this.lineDash);\n        }\n        ctx.stroke();\n        if(this.lineDash) {\n            ctx.restore();\n        }\n        ctx.beginPath();\n        ctx.translate(points[6], points[7]);\n        ctx.rotate(angle);\n        ctx.moveTo(5, 0);\n        ctx.lineTo(0, -4);\n        ctx.lineTo(0, 4);\n        ctx.lineTo(5, 0);\n        ctx.fill();\n        ctx.rotate(-angle);\n        ctx.translate(-points[6], -points[7]);\n        if(this.content) {\n            ctx.beginPath();\n            const hasFlip = points[0] > points[6];\n            let [x, y, angle] = bezierPoint(0.5, points);\n            ctx.translate(x, y);\n            ctx.rotate(angle);\n            if(hasFlip){\n                ctx.rotate(Math.PI);\n            }\n            ctx.font = `${this.fontSize} ${this.fontFamily}`;\n            ctx.textAlign = 'center';\n            ctx.fillText(this.content, 0, -(parseInt(this.fontSize) || 12)/4);\n            if(hasFlip){\n                ctx.rotate(Math.PI);\n            }\n            ctx.rotate(-angle);\n            ctx.translate(-x, -y);\n        }\n    }\n\n    isHit(point) {\n        if(!this._cachePoints) return false;\n        const points = this._cachePoints;\n        const dist = distToBezierSegmentSquared(point, points)\n        return dist < this.approximate;\n    }\n}\n\nexport default BezierLink;","/**\n * 线性布局配置\n * @typedef {Object} LinearLayout~Configs\n * @property {string} direction     - 排列方向 默认 vertical\n * @property {number} gap           - 边距, 默认是 5\n * @property {string} alignment     - 垂直排列方向对齐方式 默认 center\n * @property {string} justify       - 排列方向对齐方式 默认 center\n */\n/**\n    线性布局\n\n    排列方向\n    direction:\n        + vertical 从上至下排布\n        + horizontal 从左至右排布\n    \n    不重叠，中线对齐\n    只针对当前的 group\n\n    对齐方式\n    alignment: \n        + start 主轴左侧对齐\n        + center 主轴对齐\n        + end   主轴右侧对齐\n    justify: \n        + start 开始时对齐\n        + center 居中对齐\n        + end   末尾对齐\n        + space-between 平均分配空间对齐\n\n * @constructor LinearLayout\n * @implements {Layout}\n * @param {LinearLayout~Configs} configs - 配置\n */\n\nclass LinearLayout {\n    constructor(configs = {}) {\n        /** @member {string}  - 排列方向 默认 vertical */\n        this.direction =     configs.direction || 'vertical';\n        /** @member {number}  - 边距, 默认是 5 */\n        this.gap =           configs.gap ?? 5;\n        /** @member {string}  - 垂直排列方向对齐方式 默认 center */\n        this.alignment =     configs.alignment || 'center';\n        /** @member {string}  - 排列方向对齐方式 默认 center */\n        this.justify =       configs.justify || 'center';\n        // this.widthSetByParent =  configs.width === '100%'\n        this._rawConfigs = configs;\n    }\n\n\n    reflow(group) {\n        const stack = group._stack.filter(instance => instance.visible && !instance.absolutePosition);\n        const absoluteStack = group._stack.filter(instance => instance.visible && instance.absolutePosition)\n        const groupWidth = group.width - group.padding.left - group.padding.right;\n        if(this.direction === 'vertical') {\n            let reduceHeight = 0;\n            let lastInstanceHeight = 0;\n            let maxWidth = 0;\n            let allHeight = 0;\n            const childAll = stack.concat(absoluteStack);\n            childAll.forEach((instance, idx) =>  {\n                if(instance.display === 'block') {\n                    instance.width = 0;\n                    // instance.definedWidth = maxWidth;\n                    instance.resetChildrenPosition();\n                    instance.reflow();\n                    instance._getBoundingGroupRect();\n                }\n            });\n\n            stack.forEach((instance, idx) =>  {\n                \n                const { width, height } = instance.getBoundingDimension();\n                // console.log(height, instance.type);\n                const gap = (idx > 0 ? this.gap : 0);\n                if(instance.display !== 'outstretch') {\n                    maxWidth = Math.max(width, maxWidth);\n                }\n                allHeight += (height + gap);\n                reduceHeight += (height/2 + gap + lastInstanceHeight)\n                lastInstanceHeight = height / 2;\n                instance.anchor = [0, reduceHeight];\n            });\n            childAll.forEach((instance, idx) =>  {\n                if(instance.display === 'block') {\n                    // instance.definedWidth = maxWidth;\n                    instance.resetChildrenPosition();\n                    instance.width = maxWidth;\n                    instance.reflow();\n                    // instance._getBoundingGroupRect();\n                } else if(instance.display === 'outstretch') {\n                    const w = group._belongs.width - group._belongs.padding.left - group._belongs.padding.right;\n                    instance.resetChildrenPosition();\n                    instance.width = Math.max(w, maxWidth);\n                    instance.reflow();\n                }\n            });\n\n            maxWidth = Math.max(groupWidth, maxWidth);\n            \n            allHeight = allHeight/2;\n            if(this.alignment === 'start') {\n                stack.forEach((instance, idx) =>  {\n                    const { width } = instance.getBoundingDimension();\n                    instance.anchor[0] = -(maxWidth - width) / 2;\n                    instance.anchor[1] -= allHeight;\n                    // console.log(maxWidth, width, instance.anchor[0])\n                })\n            }\n            if(this.alignment === 'end') {\n                stack.forEach((instance, idx) =>  {\n                    const { width } = instance.getBoundingDimension();\n                    instance.anchor[0] = (maxWidth - width) / 2;\n                    instance.anchor[1] -= allHeight;\n                })\n            }\n            if(this.alignment === 'center') {\n                stack.forEach((instance, idx) =>  {\n                    const { width } = instance.getBoundingDimension();\n                    instance.anchor[1] -= allHeight;\n                })\n            }\n        } \n        if(this.direction === 'horizontal') {\n            let reduceWidth = 0;\n            let lastInstanceWidth = 0;\n            let maxHeight = 0;\n            let allWidth = 0;\n            let allPureWidth = 0;\n            \n            stack.forEach((instance, idx) =>  {\n                const { width, height } = instance.getBoundingDimension();\n                const gap = (idx > 0 ? this.gap : 0);\n                maxHeight = Math.max(height, maxHeight);\n                allWidth += (width+gap);\n                allPureWidth += width;\n                reduceWidth += (width/2 + gap + lastInstanceWidth)\n                lastInstanceWidth = width / 2;\n                instance.anchor = [reduceWidth, 0]\n            });\n            if(this.justify === 'start') {\n                const withdraw = groupWidth/2;\n                stack.forEach((instance, idx) => {\n                    instance.anchor[0] -= withdraw;\n                });  \n            }\n            if(this.justify === 'end') {\n                const withdraw = groupWidth/2 - allWidth;\n                stack.forEach((instance, idx) => {\n                    instance.anchor[0] += withdraw;\n                });  \n            }\n            if(this.justify === 'center') { \n                const withdraw = allWidth / 2;\n                stack.forEach((instance, idx) => {\n                    instance.anchor[0] -= withdraw;\n                })                \n            }\n            if(this.justify === 'space-between' && stack.length > 1) {\n                \n                const width = Math.max(groupWidth, allWidth);\n                const gapAverage = (width - allWidth) / (stack.length - 1);\n                const withdraw = width/2;\n                stack.forEach((instance, idx) => {\n                    instance.anchor[0] += ((gapAverage * idx) - withdraw);\n                });  \n            }\n            if(this.alignment === 'start') {\n                stack.forEach((instance, idx) => {\n                    const { height } = instance.getBoundingDimension();\n                    instance.anchor[1] = -(maxHeight - height) / 2;\n                })\n            }\n            if(this.alignment === 'end') {\n                stack.forEach((instance, idx) => {\n                    const { height } = instance.getBoundingDimension();\n                    instance.anchor[1] = (maxHeight - height) / 2;\n                })\n            }\n        }\n\n        if(absoluteStack.length) {\n            if(group.display === 'block') {\n                group.getBoundingDimension();\n            } else {\n                group._getBoundingGroupRect();\n            }\n            const WIDTH = group.width /2;\n            const HEIGHT = group.height /2;\n            const shifty = (group.padding.top - group.padding.bottom)/2;\n            const shiftx = (group.padding.left - group.padding.right)/2;\n            absoluteStack.forEach(instance => {\n                instance.anchor = this._resolveAbsoluteAnchor(instance.absolutePosition, instance, WIDTH, HEIGHT, shiftx, shifty);\n            })\n        }\n    }\n\n    _resolveAbsoluteAnchor(config, instance, w, h, shiftx, shifty){\n        const { top, right, bottom, left, centerX, centerY } = config;\n        const { width, height } = instance.getBoundingDimension();\n        const hw = width / 2;\n        const hh = height / 2;\n        let y = 0;\n        let x = 0;\n        if(typeof top === 'number') {\n            y = top + hh - h - shifty;\n        }\n        if(typeof right === 'number') {\n            x = w - right - hw - shiftx;\n        }\n        if(typeof bottom === 'number') {\n            y = h - bottom - hh - shifty;\n        }\n        if(typeof left === 'number') {\n            x = left + hw - w - shiftx;\n        }\n        if(typeof centerX === 'number') {\n            x = centerX;\n        }\n        if(typeof centerY === 'number') {\n            y = centerY;\n        }\n        return [x, y]\n    }\n\n    clone() {\n        return new LinearLayout(this._rawConfigs);\n    }\n}\n\nexport default LinearLayout;","\n// import EventEmitter from '../../utils/EventEmitter';\nimport { DIRECTION } from '../../utils/constance';\nclass BaseNode {\n    constructor(source) {\n        this.source = source;\n        this.id = source.id;\n        this.type = source.type;\n        // this.isDraggable = true;\n        // this.getJflowInstance = undefined;\n        this.level = undefined;\n        this.sequence = undefined;\n        // this.isLocked = false;\n        this.isFree = false;\n        this.parent = undefined;\n        this.idx = undefined;\n        this.parentIterateType = undefined;\n        \n        this.hasEndPoint = false;\n        // source._getAstNode = () => this;\n    }\n\n    reflowPreCalculate(level = 0, sequence = 0, callback) {\n        this.level = level;\n        this.sequence = sequence;\n        this.spanX = 1;\n        this.spanY = 1;\n        if(callback) {\n            callback(level, sequence, this);\n        }\n        return {\n            spanX: this.spanX, \n            spanY: this.spanY, \n            level, sequence,\n        }\n    }\n\n    makeLink(callback) {\n        return this;\n    }\n\n    makeEndpoint() { }\n\n    traverse(callback) {\n        callback(this);\n    }\n\n    getNodes(jflow) {\n        const nodes = [];\n        this.traverse(n => {\n            const renderNode = jflow.getRenderNodeBySource(n.source);\n            if(renderNode)\n                nodes.push(renderNode);\n        })\n        return nodes;\n    }\n\n    linkSource(source) {\n        this.parent.source[this.parentIterateType].splice(this.idx + 1, 0, source);\n    }\n\n    remove() {\n        this.parent.source[this.parentIterateType].splice(this.idx, 1);\n    }\n}\n\nclass Root extends BaseNode {\n    constructor(source) {\n        super(source);\n        this.isroot = true;\n        this.body = (source.body || []).map(mapFunc('body').bind(this));\n        const playgrounditerator = mapFunc('playground').bind(this)\n        this.playground = (source.playground || []).map((s, idx) => {\n            const n = playgrounditerator(s, idx);\n            n.isFree = true;\n            return n;\n        });\n    }\n\n    reflowBodyPreCalculate(level = 0, sequence = 0, callback) {\n        let spanX = 1;\n        let spanY = 1;\n        this.level = level;\n        this.sequence = sequence;\n        if(callback) {\n            callback(level, sequence, this);\n        }\n        this.body.forEach((b) => {\n            const { spanX: sx, spanY: sy } = b.reflowPreCalculate(level + 1, sequence, callback);\n            spanX = Math.max(sx, spanX);\n            spanY += sy;\n            level += sy;\n        });\n\n        this.spanX = spanX;\n        this.spanY = spanY;\n        return {\n            spanX, spanY, level, sequence\n        }\n    }\n\n    reflowPlaygroundPreCalculate(preCallback, callback) {\n        this.playground.forEach(node => {\n            preCallback(node)\n            node.reflowPreCalculate(0, 0, callback)\n        })\n    }\n\n\n    makeLink(callback) {\n        let last;\n        this.body.forEach(b => {\n            if(!last) {\n                last = b;\n                return;\n            }\n            callback({\n                from: last,\n                to: b,\n                part: 'body',\n                fromDir: DIRECTION.BOTTOM,\n                toDir: DIRECTION.TOP,\n            })\n            \n            b = b.makeLink(callback);\n            last = b;\n        });\n\n        this.playground.forEach(n => {\n            n.makeLink(callback);\n        });\n        return this;\n    }\n\n    traverse(callback) {\n        this.body.forEach(n => {\n            n.traverse(callback);\n        });\n\n        this.playground.forEach(n => {\n            n.traverse(callback);\n        })\n    }\n}\n\nclass IfStatement extends BaseNode {\n    constructor(source) {\n        super(source);\n        this.consequent = (source.consequent || []).map(mapFunc('consequent').bind(this));\n        this.alternate = (source.alternate || []).map(mapFunc('alternate').bind(this));\n        this.isLocked = true;\n        this.hasEndPoint = true;\n    }\n    \n    reflowPreCalculate(level = 0, sequence = 0, callback) {\n        let spanX = 1;\n        let spanY = 1;\n        this.level = level;\n        this.sequence = sequence;\n        if(callback) {\n            callback(level, sequence, this);\n        }\n        let c_spanX = 1;\n        let c_spanY = 0;\n        let a_spanX = 0;\n        let a_spanY = 0;\n        this.consequent.forEach((c, idx) => {   \n            const { spanX: sx, spanY: sy } = c.reflowPreCalculate(level + 1, sequence, callback);\n            c_spanX = Math.max(c_spanX, sx);\n            c_spanY += sy;\n            level += sy;\n        });\n        const nextSequeence = sequence + c_spanX;\n        level = this.level;\n        this.alternate.forEach((a, idx) => {\n            const { spanX: sx, spanY: sy } = a.reflowPreCalculate(level + 1, nextSequeence, callback);\n            a_spanX = Math.max(a_spanX, sx);\n            a_spanY += sy;\n            level += sy;\n        });\n        spanX = Math.max(1, c_spanX + a_spanX);\n        spanY += Math.max(c_spanY, a_spanY);\n        level = this.level + spanY - 1;\n        const { spanY: sy } = this.Endpoint.reflowPreCalculate(level + 1, sequence, callback);\n        spanY += sy;\n        this.spanX = spanX;\n        this.spanY = spanY;\n        return {\n            spanX, spanY, level, sequence\n        }\n    }\n\n    makeLink(callback) {\n        let lastc = this;\n        this.consequent.forEach(c => {\n            callback({\n                from: lastc,\n                to: c,\n                part: 'consequent',\n                fromDir: DIRECTION.BOTTOM,\n                toDir: DIRECTION.TOP,\n            });\n\n            c = c.makeLink(callback)\n            lastc = c;\n        })\n\n        callback({\n            from: lastc,\n            to: this.Endpoint,\n            fromDir: DIRECTION.BOTTOM,\n            toDir: DIRECTION.TOP,\n            part: 'consequent',\n        });\n\n        let lasta = this;\n        this.alternate.forEach(a => {\n            callback({\n                from: lasta,\n                to: a,\n                fromDir: lasta === this ? DIRECTION.RIGHT : DIRECTION.BOTTOM,\n                toDir: DIRECTION.TOP,\n                part: 'alternate',\n            })\n            a = a.makeLink(callback)\n            lasta = a;\n        });\n        callback({\n            from: lasta,\n            to: this.Endpoint,\n            fromDir: lasta === this ? DIRECTION.RIGHT : DIRECTION.BOTTOM,\n            toDir: DIRECTION.RIGHT,\n            part: 'alternate',\n        });\n\n        return this.Endpoint;\n    }\n\n    // makeEndpoint() {\n    //     const fakeSource = {\n    //         type: 'endpoint',\n    //         id: `${this.id}-endpoint`,\n    //     };\n    //     this.Endpoint = makeAST(fakeSource);\n    //     this.Endpoint.parent = this.parent;\n    //     this.Endpoint.idx = this.idx;\n    //     this.Endpoint.parentIterateType = this.parentIterateType;\n    //     return fakeSource;     \n    // }\n\n    traverse(callback) {\n        callback(this);\n        this.consequent.forEach(n => {\n            n.traverse(callback);\n        });\n        this.alternate.forEach(n => {\n            n.traverse(callback);\n        });\n        console.log(this.Endpoint)\n        callback(this.Endpoint);\n    }\n\n    linkSource(source, linkMeta) {\n        this.source[linkMeta.part].unshift(source);\n    }\n}\n\nclass SwitchStatement extends BaseNode {\n    constructor(source) {\n        super(source);\n        this.cases = (source.cases || []).map(mapFunc('case').bind(this))\n        if(this.cases.length) {\n            this.cases[this.cases.length - 1].lastCase = true;\n        }\n        this.isLocked = true;\n        this.hasEndPoint = true;\n    }\n\n    reflowPreCalculate(level = 0, sequence = 0, callback) {\n        let spanX = 1;\n        let spanY = 1;\n        this.level = level;\n        this.sequence = sequence;\n        if(callback) {\n            callback(level, sequence, this);\n        }\n\n        let c_spanX = 1;\n        let c_spanY = 0;\n        if(this.cases.length) {\n            const consequent = this.cases[this.cases.length - 1].consequent;\n            level = this.level;\n            consequent.forEach(cc => {\n                const { spanX: sx, spanY: sy } = cc.reflowPreCalculate(level + 1, sequence, callback);\n                c_spanX = Math.max(c_spanX, sx);\n                c_spanY += sy;\n                level += sy;\n            });\n        }\n        \n        \n        let s_spanX = c_spanX;\n        let s_spanY = 0;\n        this.cases.forEach((c, idx) => {\n            const nextSequeence = sequence + s_spanX;\n            let a_spanX = 0;\n            let a_spanY = 0;\n            level = this.level;\n            c.alternate.forEach(ca => {\n                const { spanX: sx, spanY: sy } = ca.reflowPreCalculate(level + 1, nextSequeence, callback);\n                a_spanX = Math.max(a_spanX, sx);\n                a_spanY += sy;\n                level += sy;\n            });\n            s_spanX += a_spanX;\n            s_spanY = Math.max(s_spanY, a_spanY);\n        });\n       \n        \n        spanX = Math.max(1, s_spanX);\n        spanY = Math.max(c_spanY, s_spanY);\n        level = this.level + spanY;\n        const { spanY: sy } = this.Endpoint.reflowPreCalculate(level + 1, sequence, callback);\n        spanY += sy;\n        spanY += 1 // 要算上自己\n        this.spanX = spanX;\n        this.spanY = spanY;\n        return {\n            spanX, spanY, level, sequence\n        }       \n    }\n\n    makeLink(callback) {\n        let lastc = this;\n        if(this.cases.length) {\n            const consequent = this.cases[this.cases.length - 1].consequent;\n            consequent.forEach((c, idx) => {\n                callback({\n                    from: lastc,\n                    to: c,\n                    fromDir: DIRECTION.BOTTOM,\n                    toDir: DIRECTION.TOP,\n                    part: 'consequent',\n                });\n                lastc = c.makeLink(callback)\n            });\n        }\n        console.log(lastc)\n        callback({\n            from: lastc,\n            to: this.Endpoint,\n            fromDir: DIRECTION.BOTTOM,\n            toDir: DIRECTION.TOP,\n            part: 'consequent',\n        });\n\n        this.cases.forEach((c, idx) => {\n            let lasta = c;\n            c.alternate.forEach(a => {\n                callback({\n                    from: lasta,\n                    to: a,\n                    fromDir: lasta === c ? DIRECTION.RIGHT : DIRECTION.BOTTOM,\n                    toDir: DIRECTION.TOP,\n                    part: 'alternate',\n                });\n                lasta = a.makeLink(callback)\n            })\n            \n            callback({\n                from: lasta,\n                to: this.Endpoint,\n                fromDir: lasta === c ? DIRECTION.RIGHT : DIRECTION.BOTTOM,\n                toDir: DIRECTION.RIGHT,\n                part: 'alternate',\n                minSpanX: 32 * (idx + 1),\n            });\n        });\n\n        return this.Endpoint;\n    }\n\n    // makeEndpoint() {\n    //     this.Endpoint = makeAST({\n    //         type: 'endpoint',\n    //         id: `${this.id}-endpoint`,\n    //     });\n    //     this.Endpoint.parent = this.parent;\n    //     this.Endpoint.parentIterateType = this.parentIterateType;     \n    //     this.Endpoint.idx = this.idx;\n    // }\n\n    traverse(callback) {\n        callback(this);\n        this.cases.forEach(n => {\n            n.traverse(callback);\n        });\n        callback(this.Endpoint);\n    }\n\n    getNodes(jflow) {\n        const nodes = [];\n        this.traverse(n => {\n            if(n.type === 'SwitchCase') return\n            const renderNode = jflow.getRenderNodeBySource(n.source);\n            if(renderNode)\n                nodes.push(renderNode);\n        })\n        return nodes;\n    }\n\n    linkSource(source, linkMeta) {\n        const cases = this.source.cases;\n        const consequent = cases[cases.length - 1].consequent;\n        consequent.unshift(source);\n    }\n}\n\nclass ForEachStatement extends BaseNode {\n    \n}\n\nclass WhileStatement extends BaseNode {\n    constructor(source) {\n        super(source);\n        this.body = (source.body || []).map(mapFunc('body').bind(this));\n        this.isLocked = true\n    }\n\n    reflowPreCalculate(level = 0, sequence = 0, callback) {\n        let spanX = 1;\n        let spanY = 1;\n        this.level = level;\n        this.sequence = sequence;\n        if(callback) {\n            callback(level, sequence, this);\n        }\n        const nextSequeence = sequence + 1;\n        // level--;\n        this.body.forEach((b) => {\n            const { spanX: sx, spanY: sy } = b.reflowPreCalculate(level + 1, nextSequeence, callback);\n            spanX = Math.max(sx, spanX);\n            spanY += sy;\n            level += sy;\n        });\n\n        this.spanX = spanX + 1;\n        this.spanY = spanY;\n        return {\n            spanX, spanY, level, sequence\n        }\n    }\n\n    makeLink(callback) {\n        let last = this;\n        // const lastIdx = this.body.length - 1;\n        this.body.forEach((b, idx) => {\n            callback({\n                from: last,\n                to: b,\n                part: 'body',\n                fromDir: last === this ? DIRECTION.RIGHT: DIRECTION.BOTTOM,\n                toDir: DIRECTION.TOP,\n            })\n            \n            b = b.makeLink(callback);\n            last = b;\n        });\n        callback({\n            from: last,\n            to: this,\n            part: 'body',\n            fromDir: last === this ? DIRECTION.RIGHT : DIRECTION.BOTTOM,\n            anticlock: last === this,\n            toDir: DIRECTION.BOTTOM,\n            isSelf: true,\n            minSpanX: 20,\n            minSpanY: 20,\n        });\n        return this;\n    }\n\n    traverse(callback) {\n        callback(this);\n        this.body.forEach(n => {\n            n.traverse(callback);\n        });\n    }\n\n    linkSource(source, linkMeta) {\n        this.source[linkMeta.part].unshift(source);\n    }\n}\n\nclass SwitchCase extends BaseNode {\n    constructor(source) {\n        super(source);\n        this.consequent = (source.consequent || []).map(mapFunc('consequent').bind(this));\n        this.alternate = (source.alternate || []).map(mapFunc('alternate').bind(this));\n        this.lastCase = false;\n    }\n\n    reflowPreCalculate(level = 0, sequence = 0, callback) {\n        let spanX = 1;\n        let spanY = 1;\n        this.level = level;\n        this.sequence = sequence;\n        if(callback) {\n            callback(level, sequence, this);\n        }\n        \n        let c_spanX = 0;\n        let c_spanY = 0;\n        let a_spanX = 0;\n        let a_spanY = 0;\n        if(this.lastCase) {\n            this.consequent.forEach((c, idx) => {\n                const { spanX: sx, spanY: sy } = c.reflowPreCalculate(level + 1, sequence, callback);\n                c_spanX = Math.max(c_spanX, sx);\n                c_spanY += sy;\n                level += sy;\n            });\n        }\n        \n        const nextSequeence = sequence + Math.max(c_spanX, 1);\n        level = this.level;\n        this.alternate.forEach((a, idx) => {\n            const { spanX: sx, spanY: sy } = a.reflowPreCalculate(level + 1, nextSequeence, callback);\n            a_spanX = Math.max(a_spanX, sx);\n            a_spanY += sy;\n            level += sy;\n        });\n        spanX = Math.max(1, c_spanX + a_spanX);\n        spanY += Math.max(c_spanY, a_spanY);\n\n        this.spanX = spanX;\n        this.spanY = spanY;\n        return {\n            spanX, spanY, level, sequence\n        }       \n    }\n\n    traverse(callback) {\n        callback(this);\n        this.consequent.forEach(n => {\n            n.traverse(callback);\n        });\n        this.alternate.forEach(n => {\n            n.traverse(callback);\n        });\n    }\n\n    linkSource(source, linkMeta) {\n        this.source[linkMeta.part].unshift(source);\n    }\n\n    // makeLink()\n}\n \nconst TYPE_MAPPING = {\n    IfStatement,\n    SwitchStatement,\n    SwitchCase,\n    ForEachStatement,\n    WhileStatement,\n    Root,\n    other: BaseNode,\n}\n\nfunction mapFunc(type)  {\n    return function(n, idx) {\n        const p = makeAST(n);\n        p.parent = this;\n        p.idx = idx;\n        p.parentIterateType = type;\n\n        // 重要！！！ weakMap 功能需要 endPoint source 保持一致\n        if(p.hasEndPoint) {\n            if(!n.__endpoint__) {\n                n.__endpoint__ = {\n                    type: 'endpoint',\n                    id: `${p.id}-endpoint`,\n                };\n            }\n            const e = makeAST(n.__endpoint__);\n            e.parent = this;\n            e.idx = idx;\n            e.parentIterateType = type;\n            p.Endpoint = e;\n        }\n        return p;\n    }\n}\nfunction makeAST(source) {\n    const type = source.type;\n    const Constructor = TYPE_MAPPING[type] || TYPE_MAPPING.other;\n    const node = new Constructor(source);\n    return node;\n}\nexport { \n    makeAST,\n}\n\n","import JFlowEvent from '../events'; \nimport { DIRECTION } from '../utils/constance';\nimport { makeAST } from './low-code-types/baseNode';\n\nfunction sqr(x) {\n    return x * x;\n}\nfunction dist2(v, w) {\n    return sqr(v[0] - w[0]) + sqr(v[1] - w[1]);\n}\n\n/**\n * @typedef {Object} LowcodeLayout~Configs\n * @property {number} linkLength - 最小连线长度\n * @property {number} gap       - 列间隙\n * @property {boolean} treeItemDraggable - 树上的是否可以拖动\n * @property {Object} ast       - 语法树\n */\n\n/**\n    lowcode layout\n\n    type: \n        + IfStatement,\n        + SwitchStatement,\n        + SwitchCase,\n        + ForEachStatement,\n        + WhileStatement,\n        + Root,\n        + other,\n    \n    * @implements {Layout}\n    * @param {LowcodeLayout~Configs} - 配置\n    \n */\nclass LowcodeLayout {\n    constructor(configs) {\n        /** @member {number}      - 最小连线长度 */\n        this.linkLength = configs.linkLength || 18;\n        /** @member {number}      - 列间隙 */\n        this.gap = configs.gap || 30;\n        /** @member {boolean}      - 树上的是否可以拖动 */\n        this.treeItemDraggable = configs.treeItemDraggable ?? true;\n        this.reOrder(configs.ast);\n        /** @member {boolean}      - true 需要检查元素拖动 */\n        this.static = true;\n    }\n    /**\n     * 从 ast 计算布局\n     * @param {AstNode} ast - ASL 树\n     */\n    reOrder(ast) {\n        this.ast = ast;\n        this.flowStack = [];\n        this.flowLinkStack = [];\n\n        this.root = makeAST(this.ast)// new AstNode(this.ast, this.flowStack, true);\n        this.root.traverse((node) => {\n            if(node.parentIterateType !== 'playground') {\n                node.isDraggable = this.treeItemDraggable\n            }\n            this.flowStack.push({\n                type: node.type,\n                source: node.source,\n                layoutNode: node,\n            });\n        });\n\n        const layoutMapping = {\n            vertical: {},\n            horizontal: {},\n        };\n        const playgroundLayoutMapping = {}\n        this.root.reflowBodyPreCalculate(0, 0, (level, sequence, node) => {\n            if(!node.isroot) {\n                if(!layoutMapping.vertical[level]){\n                    layoutMapping.vertical[level] = {};\n                }\n                layoutMapping.vertical[level][sequence] = node;\n                \n                if(!layoutMapping.horizontal[sequence]){\n                    layoutMapping.horizontal[sequence] = {};\n                }\n                layoutMapping.horizontal[sequence][level] = node;\n            }\n        });\n\n        let currentTopNodeId;\n        this.root.reflowPlaygroundPreCalculate(\n            (topNode) => {\n                currentTopNodeId = topNode.id;\n                playgroundLayoutMapping[topNode.id] = {\n                    vertical: {},\n                    horizontal: {},\n                    node: topNode,\n                }\n            },\n            (level, sequence, node) => {\n                const layoutMapping = playgroundLayoutMapping[currentTopNodeId];\n                if(!layoutMapping.vertical[level]){\n                    layoutMapping.vertical[level] = {};\n                }\n                layoutMapping.vertical[level][sequence] = node;\n                \n                if(!layoutMapping.horizontal[sequence]){\n                    layoutMapping.horizontal[sequence] = {};\n                }\n                layoutMapping.horizontal[sequence][level] = node;\n            })\n\n        this.layoutMapping = layoutMapping;\n        this.playgroundLayoutMapping = playgroundLayoutMapping;\n        this.root.makeLink((configs) => {\n            this.flowLinkStack.push(configs)\n        })\n    }\n\n    staticCheck(instance, jflow) {\n\n        if(instance._layoutNode && instance._layoutNode.isFree) {\n            return false;\n        }\n        const finded = jflow._linkStack.find(l => l.from === instance || l.to === instance);\n        if(!finded) {\n            return false;\n        }\n        const nowAnchor = instance.anchor.slice();\n        jflow.reflow();\n        if(jflow._linkStack.length < 2) return;\n        const currentAnchor = instance.anchor;\n        const d = dist2(nowAnchor, currentAnchor);\n        if(d > 1000) {\n            instance.dispatchEvent(new JFlowEvent('outOfFlow', {\n                anchor: nowAnchor,\n                instance,\n                jflow,\n                point: nowAnchor,\n            }))\n            return true;\n        }\n        return false;\n    }\n\n    reflowByMapping(jflow, layoutMapping, x = 0, y = 0) {\n        const linkLength = this.linkLength;\n        const gap = this.gap;\n        const {\n            vertical: verticalMapping,\n            horizontal: horizontalMapping,\n        } = layoutMapping;\n\n        let reduceWidth = x;\n        Object.keys(horizontalMapping).forEach((columnNumber, idx) => {\n            const column = horizontalMapping[columnNumber];\n            let rowWidth = 0;\n            const rows = Object.keys(column)\n            rows.forEach(rowNumber => {\n                const ast = column[rowNumber];\n                const instance = jflow.getRenderNodeBySource(ast.source) // ast.getJflowInstance();\n                const { width } = instance.getBoundingDimension();\n                rowWidth = Math.max(width, rowWidth);\n            });\n            reduceWidth += idx === 0 ? 0: rowWidth/2\n            rows.forEach(rowNumber => {\n                const ast = column[rowNumber];\n                const instance = jflow.getRenderNodeBySource(ast.source);\n                instance.anchor[0] = reduceWidth;\n            });\n            reduceWidth += (rowWidth/2 + gap) ;\n        });\n\n        let reduceHeight = y;\n        // console.log(verticalMapping)\n        Object.keys(verticalMapping).forEach((rowNumber, idx) => {\n            const row = verticalMapping[rowNumber];\n            let rowHeight = 0;\n            const columns = Object.keys(row)\n            columns.forEach(columnNumber => {\n                const ast = row[columnNumber];\n                const instance = jflow.getRenderNodeBySource(ast.source);\n                const { height, width } = instance.getBoundingDimension();\n                rowHeight = Math.max(height, rowHeight);\n            });\n            reduceHeight += idx === 0 ? 0 : rowHeight/2;\n            columns.forEach(columnNumber => {\n                const ast = row[columnNumber];\n                const instance = jflow.getRenderNodeBySource(ast.source);\n                instance.anchor[1] = reduceHeight;\n            });\n            reduceHeight += (rowHeight/2 + linkLength) ;\n        });\n        \n    }\n\n    findLayoutNode(configs) {\n        const finded = this.flowStack.find(node => node.configs === configs);\n        if(finded) {\n            return finded.layoutMeta;\n        }\n        return null;\n    }\n\n    reflow(jflow){\n        this.reflowByMapping(jflow, this.layoutMapping);\n        Object.values(this.playgroundLayoutMapping).forEach(mapping => {\n            // const node = mapping.node.getJflowInstance();\n            const node = jflow.getRenderNodeBySource(mapping.node.source)\n            this.reflowByMapping(jflow, mapping, node.anchor[0], node.anchor[1]);\n        })\n    }\n}\n\nexport default LowcodeLayout;","import { DIRECTION } from '../../utils/constance';\nfunction getRelationShip(p1, p2) {\n    if(p1.type === 'Array' && p2.type !== 'Array') {\n        return '多对一'\n    }\n    if(p2.type === 'Array' && p1.type !== 'Array') {\n        return '一对多'\n    }\n    if(p1.type === 'Array' && p2.type === 'Array') {\n        return '多对多'\n    }\n    if(p1.type !== 'Array' && p2.type !== 'Array') {\n        return '一对一'\n    }\n}\n/**\n    ER property Node\n    * @implements {LayoutNode}\n */\nclass ERProperty {\n    constructor(source, node, isNavigation) {\n        /** @member {String}      - 布局节点类型 */\n        this.type = 'ERProperty';\n        /** @member {Object}      - 数据源 */\n        this.source = source;\n        this.node = node;\n        this.ref = source.ref;\n        this.type = source.type;\n        this.association = source.association;\n        /** @member {String}      - 唯一标识 */\n        this.id = isNavigation ? `${node.id}-${source.name}-navigation` : `${node.id}-${source.name}`\n        this._selfLink = false;\n        this.parentPropertyRef = undefined;\n        /** @member {LayoutNode~getJflowInstance}      - 获取jflow对象 */\n        this.getJflowInstance = undefined;\n        this.doubleRef = undefined;\n    }\n}\n/**\n ER Node\n * @implements {LayoutNode}\n * @param {Object} source\n */\nclass ERNode { \n    constructor(source) {\n        /** @member {String}      - 布局节点类型 */\n        this.type = 'ERNode';\n        /** @member {Object}      - 数据源 */\n        this.source = source;\n        /** @member {String}      - 唯一标识 */\n        this.id = source.name;\n        /** @member {Boolean}      - true, 可拖动 */\n        this.isDraggable = true;\n        /** @member {LayoutNode~getJflowInstance}      - 获取jflow对象 */\n        this.getJflowInstance = undefined;\n        // this.adjacencyList = []\n        this.propertyList = source.propertyList.map(p => new ERProperty(p, this));\n        this.navigationPropertyList = source.navigationPropertyList.map(p => new ERProperty(p, this, true))\n        this.idProperty = this.propertyList.find(p => p.source.name === 'id');\n        // this.VertexNameProperty = this.propertyList.find(p => p.source.type === 'VertexName');\n    }\n\n    _traverseProperty(nodeMap) {\n        this.propertyList.forEach(property => {\n            const idRef = property.source.idRef; // 决定链接的对象\n            const isParentRef = property.source.isParentRef; // 决定连接的性质\n            if(idRef && property.source.type !== 'Array' && nodeMap[idRef]) {\n                const parentRef = nodeMap[idRef];\n                if (property.source.isParentRef) {\n                    this.parentRef = parentRef;\n                }\n                if (parentRef === this) {\n                    property._selfLink = true;\n                }\n                property.parentPropertyRef = parentRef.idProperty;\n            }\n        });\n        this.navigationPropertyList.forEach(property => {\n            const objectRef = property.source.objectRef;\n            if(objectRef && nodeMap[objectRef]) {\n                const node = nodeMap[objectRef];\n                const targetProperty = node.navigationPropertyList.find(n => n.source.objectRef === this.id)\n                if (node === this) {\n                    property._selfLink = true;\n                }\n                property.doubleRef = targetProperty;\n            }\n        })\n        \n    }\n\n    traverse(callback) {\n        callback(this);\n        this.propertyList.forEach(property => {\n            if(property.ref instanceof ERNode) {\n                callback(property);\n            }\n        })\n    }\n\n    makeLink(callback) {\n        this.propertyList.forEach(property => {\n            if(property.parentPropertyRef instanceof ERProperty) {\n                const toProperty = property.parentPropertyRef;\n                if(property._selfLink) {\n                    callback({\n                        from: property.id,\n                        to: toProperty.id,\n                        part: 'property',\n                        fromDir: DIRECTION.LEFT,\n                        toDir: DIRECTION.LEFT,\n                        content: property.association,\n                        minSpanX: 80,\n                        meta: {\n                            from: property,\n                            to: toProperty,\n                        }\n                    });\n                } else {\n                    callback({\n                        from: property.id,\n                        to: toProperty.id,\n                        part: 'property',\n                        content: property.association,\n                        meta: {\n                            from: property,\n                            to: toProperty,\n                        }\n                    });\n                }\n            }\n        });\n\n        \n        this.navigationPropertyList.forEach(property => {\n            if(property.doubleRef instanceof ERProperty) {\n                const toProperty = property.doubleRef;\n                if(property._selfLink) {\n                    callback({\n                        from: property.id,\n                        to: toProperty.id,\n                        part: 'property',\n                        fromDir: DIRECTION.LEFT,\n                        toDir: DIRECTION.TOP,\n                        lineDash: [10, 5],\n                        doubleLink: true,\n                        content: property.association,\n                        minSpanX: 80,\n                        minSpanY: 80,\n                        meta: {\n                            from: property,\n                            to: toProperty,\n                        }\n                    });\n                } else {\n                    callback({\n                        from: property.id,\n                        to: toProperty.id,\n                        part: 'property',\n                        lineDash: [10, 5],\n                        doubleLink: true,\n                        content: property.association,\n                        meta: {\n                            from: property,\n                            to: toProperty,\n                            isObjectRef: true,\n                        }\n                    });\n                }\n            }\n        })\n    }\n}\n\nfunction makeER(source) {\n    const nodeMap = {};\n    const nodes = source.map(s => {\n        const node = new ERNode(s);\n        nodeMap[s.name] = node\n        return node;\n    });\n    nodes.forEach(node => {\n        node._traverseProperty(nodeMap);\n    });\n    return nodes;\n}\nexport { \n    makeER,\n}","\nimport { makeER } from './er-node';\n/**\n * ER source\n * @typedef {Object} ERLayout~sourceConfigs\n * @property {string} type - node\n * @property {string} id - 唯一标识\n * @property {Object[]} properties - 描述\n */\n/**\n * ER布局数据源配置\n * @typedef {Object} ERLayout~Configs\n * @property {ERLayout~sourceConfigs[]} entityRelationship - 关系\n */\n/**\n    ER layout\n\n    Entity Relationship Structure\n    tree = [\n        {\n            type: 'node',\n            id: 'uniqueID',\n            properties: [\n                {\n                    name: 'xxxx',\n                    ref: someUniqueId,\n                    description: 'xxxxxx',\n                },\n                ...\n            ]\n        },\n        ...\n    ]\n    \n    * @implements {Layout}\n */\n\nclass ERLayout {\n    constructor(configs) {\n        /** @member {boolean}      - false 不需要布局变化检查 */\n        this.static = false;\n        /** @member {Layout~NodeMeta[]}      - 布局节点单元数组 */\n        this.flowStack = [];\n        /** @member {Layout~LinkMeta[]}      - 布局连线单元数组 */\n        this.flowLinkStack = [];\n        /** @member {LayoutNode[]}      - 布局节点数组 */\n        this.erNodes = [];\n        this.reOrder(configs.entityRelationship);\n    }\n    /**\n     * 从 tree 计算布局\n     * @param {AstNode} tree - ER 树\n     */\n    reOrder(er) {\n        this.er = er;\n        this.flowStack = [];\n        this.flowLinkStack = [];\n        const nodes = makeER(this.er);\n        const idMap = [];\n        nodes.forEach(node => {\n            node.traverse((n) => {\n                this.flowStack.push({\n                    type: n.type,\n                    configs: n.source,\n                    layoutMeta: n,\n                })\n            });\n            node.makeLink(configs => {\n                const {\n                    from: property,\n                    to: toProperty,\n                    meta,\n                } = configs;\n                if(meta.isObjectRef) {\n                    const id1 = `${property}-${toProperty}`;\n                    const id2 = `${toProperty}-${property}`;\n                    \n                    const fromMeta = meta.from;\n                    if(idMap.includes(id1) || idMap.includes(id2)) {\n                        return;\n                    }\n                    if(!fromMeta.source.isParentRef) {  \n                        idMap.push(id1);\n                        idMap.push(id2);\n                        this.flowLinkStack.push(configs)\n                    }\n                } else {\n                    this.flowLinkStack.push(configs)\n                }\n               \n            })\n        });\n        this.erNodes = nodes;\n    }\n\n    staticCheck(instance, jflow) {\n        return false;\n    }\n\n    reflow(jflow){\n        const links = this.flowLinkStack;\n        const nodes = this.erNodes;\n        let x = 0;\n        const lineMapping = {};\n        const size = 1000;\n        function computeNodeAnchor(node, recorded = []) {\n            let relativeAnchor = [0, 0];\n            \n            \n            if (node.parentRef) {\n                if(recorded.includes(node.parentRef)) {\n                    // debugger;\n                    return [\n                        relativeAnchor[0] - (size/2) + node.source.diagramWeight * size,\n                        relativeAnchor[1]\n                    ];\n                }\n                recorded.push(node.parentRef);\n                \n                relativeAnchor = computeNodeAnchor(node.parentRef, recorded);\n                return [\n                    relativeAnchor[0] - (size/2) + node.source.diagramWeight * size,\n                    relativeAnchor[1] + 600,\n                ];\n            } else {\n                return relativeAnchor;\n            }\n        }\n        this.erNodes.forEach(node => {\n            const instance = node.getJflowInstance();\n            const [nx, ny] = computeNodeAnchor(node);\n            if(!lineMapping[ny]) {\n                lineMapping[ny] = [];\n            }\n            lineMapping[ny].push(node);\n            instance.anchor = [nx + lineMapping[ny].length * 500, ny];\n            x+=300\n        });\n        // debugger\n        // // Kahn’s Algorithm\n        // // Calcuate the incoming degree of each vertex\n        // const vertices = nodes.slice();\n        // debugger\n        // const inDegree = {};\n        // vertices.forEach(v => {\n        //     v.adjacencyList.forEach(p => {\n        //         const name = p.name;\n        //         inDegree[name] = inDegree[name] + 1 || 1;\n        //     })\n            \n        // })\n        // console.log(inDegree)\n        // debugger\n\n        // // Create a queue which stores the vertex without dependencies\n        // const queue = vertices.filter((v) => !inDegree[v.name]);\n        // console.log(queue)\n        // debugger\n        // const topNums = {};\n        // let index = 0;\n        // while (queue.length) {\n        //     const v = queue.shift();\n        //     topNums[v.name] = index++;\n        //     v.adjacencyList.forEach(neighbor => {\n        //         const name = neighbor.name;\n        //         inDegree[name]--;\n        //         if (inDegree[name] === 0) {\n        //             queue.push(neighbor);\n        //         }\n        //     });\n        // }\n        // if (index !== vertices.length) {\n        //     console.log(\"Detect a cycle\");\n        // }\n        // console.log(topNums);\n    }\n}\n\nexport default ERLayout;","\nexport const EDITOR_EVENTS = {\n    INPUT: 'input',\n    CONTROL_CMD: 'control'\n}\n\nexport const KEYBOARD_INPUT = {\n    INPUT: 'input',\n    COMPOSITION_START: 'compositionstart',\n    COMPOSITION_UPDATE: 'compositionupdate',\n    COMPOSITION_END: 'compositionend',\n    ENTER: 'enter',\n    DELETE: 'delete',\n    BACKSPACE: 'backspace',\n}\n\nexport const KEYBOARD_COMMANDS = {\n    ARROW_LEFT: 'arrowLeft',\n    ARROW_RIGHT: 'arrowRight',\n    ARROW_UP: 'arrowUp',\n    ARROW_DOWN: 'arrowDown',\n    UNDO: 'undo',\n    REDO: 'redo',\n    SHIFT_DOWN: 'shift_down',\n    SHIFT_UP: 'shift_up',\n    CTRLA: 'ctrla',\n    CTRLC: 'ctrlc',\n    CTRLV: 'ctrlv',\n    CTRLX: 'ctrlx',\n}\n\nexport const MOUSE_COMMANDS = {\n    START_EDIT: 'startedit',\n    EDIT_CLICK: 'editclick',\n    SHIFT_ON_CLICK: 'shiftonclick',\n    DOUBLE_CLICK: 'doubleclick'\n}\n\n\nexport const OPERRATION = {\n    PLAININPUT: 'plaininput',\n    SPACEINPUT: 'spaceinput',\n    RETURNINPUT: 'returninput',\n    CARETMOVEMENT: 'caretmovement',\n    DELETE_IN_LINE: 'deleteinline',\n    DELETE_IN_EDITAREA: 'deleteineditarea',\n    ENSURE_DELETE: 'ensuredelete',\n    SELECTION_DELETE: 'selectiondelete',\n    SELECTION_INPUT: 'selectioninput',\n    COMPOSITE_INSERT: 'compositeinsert'\n}\n","import { KEYBOARD_COMMANDS, KEYBOARD_INPUT, EDITOR_EVENTS } from './constants';\n\nclass ShadowInput extends EventTarget{\n    _inputElement = null;\n\n    constructor(wrapper) {\n        super();\n        this._inputElement = createInputElement(this.controlCallback.bind(this));\n        wrapper.append(this._inputElement);\n        this._inputElement.focus();\n    }\n    controlCallback(kind, data) {\n        switch(kind) {\n            case KEYBOARD_INPUT.INPUT:\n            case KEYBOARD_INPUT.COMPOSITION_START:\n            case KEYBOARD_INPUT.COMPOSITION_UPDATE:\n            case KEYBOARD_INPUT.COMPOSITION_END:\n            case KEYBOARD_INPUT.ENTER:\n            case KEYBOARD_INPUT.BACKSPACE:\n            case KEYBOARD_INPUT.DELETE:\n                this.dispatchEvent(new CustomEvent(EDITOR_EVENTS.INPUT, {\n                    detail: {\n                        kind,\n                        data,\n                    }\n                }))\n            break;\n\n            case KEYBOARD_COMMANDS.ARROW_LEFT:\n            case KEYBOARD_COMMANDS.ARROW_RIGHT:\n            case KEYBOARD_COMMANDS.ARROW_UP:\n            case KEYBOARD_COMMANDS.ARROW_DOWN:\n            case KEYBOARD_COMMANDS.CTRLA:\n            case KEYBOARD_COMMANDS.SHIFT_DOWN:\n            case KEYBOARD_COMMANDS.SHIFT_UP:\n            case KEYBOARD_COMMANDS.UNDO:\n            case KEYBOARD_COMMANDS.REDO:\n                this.dispatchEvent(new CustomEvent(EDITOR_EVENTS.CONTROL_CMD, {\n                    detail: {\n                        kind,\n                    }\n                }))\n            break;\n\n        }\n    }\n\n    focus() {\n        this._inputElement.focus({ preventScroll: true });  \n    }\n\n    syncPosition(x, y) {\n        this._inputElement.style.transform = `translate(${x}px, ${y}px)`\n    }\n\n    destroy() {\n        this._inputElement.remove();\n    }\n}\n\nexport default ShadowInput;\n\nfunction createInputElement(controlCallback) {\n    const input = document.createElement('input');\n    input.setAttribute('style',`\n        width: 100px;\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        opacity: 0;\n        z-index: -1;\n        contain: strict;`);\n    input.setAttribute('tabindex', -1);\n    input.setAttribute('aria-hidden', true);\n    input.setAttribute('spellcheck', false);\n    input.setAttribute('autocorrect', 'off');\n\n    let stopInput = false;\n    let status = {\n        ctrlOn: false,\n        shiftOn: false,\n    }\n\n    input.addEventListener('beforeinput', e => {\n        e.preventDefault();\n        if(e.data) {\n            // content += e.data;\n            // renderContent();\n            if(!stopInput) {\n                controlCallback(KEYBOARD_INPUT.INPUT, e.data);\n            }\n        }\n    })\n\n    input.addEventListener('compositionstart', (e) => {\n        controlCallback(KEYBOARD_INPUT.COMPOSITION_START);\n        stopInput = true;\n    });\n    input.addEventListener('compositionupdate', (e) => {\n        controlCallback(KEYBOARD_INPUT.COMPOSITION_UPDATE, e.data);\n    });\n    input.addEventListener('compositionend', (e) => {\n        controlCallback(KEYBOARD_INPUT.COMPOSITION_END, e.data);\n        input.value = '';\n        stopInput = false\n    });\n\n    input.addEventListener('keyup', (event) => {\n        if(stopInput) {\n            return;\n        }\n        switch(event.key) {\n            case \"Shift\":\n                controlCallback(KEYBOARD_COMMANDS.SHIFT_UP);\n                status.shiftOn = false;\n                break;\n            case \"Meta\":\n            case \"Control\":\n                status.ctrlOn = false;\n                break;\n            \n        }\n    })\n\n    input.addEventListener('keydown', (event) => {\n        if(stopInput) {\n            return;\n        }\n        switch(event.code) {\n            case \"Enter\":\n                controlCallback(KEYBOARD_INPUT.ENTER);\n                break;\n            case \"Backspace\":\n                controlCallback(KEYBOARD_INPUT.BACKSPACE);\n                break;\n            case \"Delete\":\n                controlCallback(KEYBOARD_INPUT.DELETE);\n                break;\n            case \"ArrowLeft\":\n                controlCallback(KEYBOARD_COMMANDS.ARROW_LEFT);\n                break;\n            case \"ArrowRight\":\n                controlCallback(KEYBOARD_COMMANDS.ARROW_RIGHT);\n                break;\n            case \"ArrowDown\":\n                controlCallback(KEYBOARD_COMMANDS.ARROW_DOWN);\n                break;\n            case \"ArrowUp\":\n                controlCallback(KEYBOARD_COMMANDS.ARROW_UP);\n                break;\n        }\n        switch(event.key) {\n            case \"Shift\":\n                controlCallback(KEYBOARD_COMMANDS.SHIFT_DOWN);\n                status.shiftOn = true;\n                break;\n            case \"Meta\":\n            case \"Control\":\n                status.ctrlOn = true;\n                break;\n            case 'a':\n                if(status.ctrlOn) {\n                    controlCallback(KEYBOARD_COMMANDS.CTRLA);\n                }\n                break;\n            case 'c':\n                if(status.ctrlOn) {\n                    controlCallback(KEYBOARD_COMMANDS.CTRLC);\n                }\n                break; \n            case 'v':\n                if(status.ctrlOn) {\n                    controlCallback(KEYBOARD_COMMANDS.CTRLV);\n                }\n                break;   \n            case 'x':\n                if(status.ctrlOn) {\n                    controlCallback(KEYBOARD_COMMANDS.CTRLX);\n                }\n                break;\n            case 'y':\n                if(status.ctrlOn) {\n                    event.preventDefault();\n                    controlCallback(KEYBOARD_COMMANDS.REDO);\n                }\n                break;\n            case 'z':\n                if((status.ctrlOn && status.shiftOn)) {\n                    controlCallback(KEYBOARD_COMMANDS.REDO);\n                } else if(status.ctrlOn) {\n                    controlCallback(KEYBOARD_COMMANDS.UNDO);\n                }\n                break;\n        }   \n    })\n    return input;\n}","class Caret { \n    _row = 0;\n    _column = [0,0];\n\n    _status = {\n        show: true,\n        anime: null,\n        lastElapsed: 0,\n        refreshElapsed: false,\n    }\n\n    setRow(row) {\n        this._row = row;\n    }\n    setColumn(columnoridx, column) {\n        if(column !== undefined) {\n            this._column[columnoridx] = column;\n        } else {\n            this._column = columnoridx;\n        }\n    }\n\n    getRow() {\n        return this._row;\n    }\n\n    getColumn(idx) {\n        if(idx !== undefined) {\n            return this._column[idx];\n        }\n        return this._column;\n    }\n\n    animate(jflow) {\n        this._status.anime = jflow.requestJFlowAnime((elapsed) => {\n            const lastElapsed = this._status.lastElapsed;\n            if(this._status.refreshElapsed) {\n                this._status.lastElapsed = elapsed;\n                this._status.refreshElapsed = false;\n            }\n            if(elapsed - lastElapsed > 500) {\n                this._status.show = !this._status.show;\n                this._status.lastElapsed = elapsed;\n            } \n        });\n    }\n\n    cancelAnimate() {\n        this._status.anime.cancel()\n        Object.assign(this._status, {\n            show: true,\n            anime: null,\n            lastElapsed: 0,\n        })\n    }\n\n    isShow() {\n        return this._status.show;\n    }\n\n    refresh() {\n        Object.assign(this._status, {\n            show: true,\n            refreshElapsed: true,\n        });\n    }\n\n    toRange() {\n        return [this._row, ...this._column];\n    }\n\n    fromRange(range) {\n        this._row = range[0];\n        this._column = range.slice(1);\n    }\n}\n\nexport default Caret;","import { calculateOffsetByWidth } from '../utils'\nexport class Area {\n    _lines = []; \n\n    get(idx) {\n        return this._lines[idx];\n    }\n\n    getLineAbove(offsetY) {\n        let row = 0;\n        const lines = this._lines;\n        while(row < lines.length) {\n            if(lines[row].reduceHeight > offsetY) {\n                break;\n            }\n            row ++;\n        }\n        return Math.min(row, lines.length - 1);\n    }\n\n    truncate(configs) {\n        const l = Line.create(configs);\n        this._lines = [l];\n        return l;\n    }\n\n    push(line) {\n        this._lines.push(line);\n    }\n\n    forEach(callback) {\n        this._lines.forEach(callback);\n    }\n\n    length() {\n        return this._lines.length;\n    }\n}\n\nexport class Line {\n    width = 0;\n    anchorY = 0;\n    height = 0;\n    reduceHeight = 0;\n    _elements = []\n\n    static create(configs) {\n        const l = new Line(configs);\n        return l;\n    }\n\n    constructor(configs = {}) {\n        Object.assign(this, configs);\n    }\n\n    _elements = [];\n\n    get(idx) {\n        return this._elements[idx];\n    }\n    length() {\n        return this._elements.length;\n    }\n\n    insert(idx, elem) {\n        this._elements.splice(idx, 0, elem)\n    }\n    push(elem) {\n        this._elements.push(elem);\n    }\n    tail() {\n        return this._elements[this._elements.length-1];\n    }\n    copy() {\n        return this._elements.slice();\n    }\n\n    getColumnNearest(offsetX, elementSpace, fontSize, fontFamily) {\n        const elements = this._elements;\n        if(offsetX >= this.width) {\n            const c = elements.length - 1;\n            const elem = elements[c];\n            let q = 0;\n            if(elem.type === 'text') {\n                q = elem.source.length;\n            } \n            return [c, q]\n        } else {\n            let elem_idx = 0;\n            let last_c = 0;\n            let _c = 0; \n            let lastel = null;\n            while(elem_idx < elements.length -1) {\n                last_c = _c;\n                const el = elements[elem_idx];\n                if(el.type !== 'text') {\n                    const doubleMargin = (lastel && lastel.type === 'text');\n                    const margin = doubleMargin ? elementSpace*2 : elementSpace;\n                    _c += (el.width + margin);\n                } else {\n                    _c += el.width;\n                }\n                if(_c > offsetX) {\n                    lastel = el\n                    break;\n                }\n                lastel = el\n                \n                elem_idx++;\n                \n            }\n            if(_c <= offsetX) {\n                last_c = _c;\n            }\n            const textmeta = elements[elem_idx];\n            if(textmeta.type === 'text') {\n                const offx = offsetX - last_c;\n                const idx = calculateOffsetByWidth(offx, textmeta, fontSize, fontFamily)\n                return [elem_idx, idx];\n            } else {\n                const offx = offsetX - last_c;\n                if(offx > lastel.width/2){\n                    return [elem_idx+1, 0]\n                } else {\n                    return [elem_idx, 0];\n                }\n               \n            }\n        }\n    }\n\n    forEach(callback) {\n        this._elements.forEach(callback);\n    }\n}\n\nexport class FlattenTextElements {\n    static create(elements) {\n        const _e = new FlattenTextElements();\n        _e.from(elements);\n        return _e;\n    }\n    _textElements = [];\n    _records = [];\n    _caretRecord = null;\n\n    insertBefore(anchor, elem) {\n        const idx = this.findIndex(anchor);\n        this.inersetAt(idx, elem);\n    }\n    insertAfter(anchor, elem) {\n        const idx = this.findIndex(anchor);\n        const next = this.get(idx+1);\n        if(next) {\n            elem.setNeedWrap(anchor.needWrap || anchor.isTail);\n        }\n        this.inersetAt(idx+1, elem);\n    }\n    findIndex(elem) {\n        return this._textElements.findIndex(el => el === elem);\n    }\n    get(idx) {\n        return this._textElements[idx];\n    }\n    from(elements) {\n        this._textElements = elements;\n    }\n    inersetAt(idx, elem) {\n        this.splice(idx, 0, elem)\n    }\n    push(elem) {\n        this.splice(this.length(), 0, elem);\n    }\n    remove(idx) {\n        this.splice(idx, 1);\n    }\n    splice() {\n        const removed = this._textElements.splice(...arguments);\n        this._records.push({\n            op: 'splice',\n            args: arguments,\n            removed,\n        })\n    }\n    copy() {\n        return this._textElements.slice();\n    }\n    isEmpty() {\n        return this._textElements.length === 1 && this._textElements[0].source === '';\n    }\n    forEach(callback) {\n        this._textElements.forEach(callback);\n    }\n    tail() {\n        return this._textElements[this._textElements.length-1];\n    }\n    filter(callback) {\n        return this._textElements.filter(callback);\n    }\n    length() {\n        return this._textElements.length;\n    }\n\n    startRecord() {\n        this._caretRecord = {\n            before: null,\n            after: null,\n        }\n        this._records = [];\n        return this._records;\n    }\n\n    getRecord() {\n        return this._records;\n    }\n\n    recordBeforeCaret(caret) {\n        this._caretRecord.before = caret.toRange();\n    }\n\n    recordAfterCaret(caret) {\n        this._caretRecord.after = caret.toRange();\n    }\n\n    getCaretRecord() {\n        return this._caretRecord;\n    }\n\n    collectRecords() {\n        return this._records;\n    }\n}\n\nexport class TextElement {\n    needWrap = false;\n    width = 0;\n    reduceWidth = 0;\n    height = 0;\n    anchorX = 0;\n    anchorY = 0;\n    dirty = true;\n    isTail = false;\n\n    constructor(type, source) {\n        this.type = type;\n        this.source = source;\n    }\n\n    setSource(source, records) {\n        const lastSource = this.source;\n        this.source = source;\n        this.dirty = true;\n        if(records) {\n            records.push({\n                op: 'setSource',\n                args: [this, source, lastSource],\n            })\n        }\n    }\n\n    setNeedWrap(needWrap, records) {\n        const lastWrap = this.needWrap;\n        this.needWrap = needWrap;\n        if(lastWrap!== needWrap && records) {\n            records.push({\n                op: 'setNeedWrap',\n                args: [this, needWrap, lastWrap],\n            })\n        }\n    }\n\n    shift(offset, step) {\n        if(this.type === 'text') {\n            const content = this.source;\n            const l = content.length;\n            const nextOffset = offset + step;\n            if(nextOffset < 0) {\n                return 'prev';\n            }\n            if(nextOffset > l ){//- ((isTail || this.needWrap) ? 0 : 1)) {\n                return 'next';\n            }\n            return 'self';\n        } else {\n            if(step > 0) {\n                return 'next';\n            } \n            if(step < 0){\n                return 'prev';\n            }\n        }\n    }\n\n    tailOffset() {\n        if(this.type === 'text') {\n            if(this.needWrap || this.isTail){\n                return this.source.length;\n            } else {\n                return Math.max(0, this.source.length - 1);\n            }\n        } else {\n            return 0;\n        }\n    }\n\n    headOffset() {\n        return 0;\n    }\n}","import { requestCacheCanvas } from '../../utils/canvas';\nexport function calculateOffsetByWidth(\n    offx, \n    textmeta,\n    fontSize, fontFamily\n) {\n    const content = textmeta.source;\n    const maxL = content.length - 1;\n    if(textmeta.width === 0) {\n        return 0;\n    }\n    const allwidth = textmeta.width;\n    let idx = Math.floor(offx / allwidth * maxL) ;\n    requestCacheCanvas((ctx) => {\n        ctx.font = `${fontSize} ${fontFamily}`;\n        let g1, g2;\n        let lastidx;\n\n        let c = content.substring(0, idx);\n        let c1 = content.substring(idx-1, idx);\n        let c2 = content.substring(idx, idx+1);\n        let w = ctx.measureText(c).width;\n        let w1 = ctx.measureText(c1).width;\n        let w2 = ctx.measureText(c2).width;\n        g1 = w - w1/2;\n        g2 = w + w2/2;\n        \n        do {\n            if(g1 <= offx && g2 >= offx) {\n                break;\n            }  \n            if(g1 > offx) {\n                // 左侧少了\n                const spanw = g2 - offx;\n                lastidx = idx;\n                if(spanw < 100) {\n                    idx -= 1;\n                } else {\n                    idx -= Math.floor(spanw / g2 * lastidx)\n                }\n                c = content.substring(idx, lastidx);\n                w -= ctx.measureText(c).width;\n            } else if(g2 < offx) {\n                // 右侧少了\n                const spanw = offx - g1;\n                lastidx = idx;\n                if(spanw < 100) {\n                    idx += 1;\n                } else {\n                    idx += Math.floor(spanw / (allwidth - g1) * (maxL - lastidx))\n                }\n                c = content.substring(lastidx, idx);\n                w += ctx.measureText(c).width;\n            }\n            \n            c1 = content.substring(idx-1, idx);\n            c2 = content.substring(idx, idx+1);\n            w1 = ctx.measureText(c1).width;\n            w2 = ctx.measureText(c2).width;\n            g1 = w - w1/2;\n            g2 = w + w2/2;\n        } while(idx >= 0 && idx <= maxL)\n        \n    });\n    return idx;\n}","import { TextElement } from \"../storage\";\nclass Range {\n    _enable = false;\n    _rangeFrom = null; // [row, elem_idx, offset]\n    _rangeTo = null;   // [row, elem_idx, offset]\n    _initialRange = null; \n\n    setInitialRange(initialRange) {\n        this._initialRange = initialRange;\n    }\n\n    getRangeFrom() {\n        return this._rangeFrom;\n    }\n\n    getRangeTo() {\n        return this._rangeTo;\n    }\n\n    isEnable() {\n        return this._enable;\n    }\n\n    enable() {\n        this._enable = true;\n    }\n    disable() {\n        this._enable = false;\n    }\n\n    handleCaret(caret) {\n        const [a, b, c] = this._rangeTo;\n        caret.setRow(a);\n        caret.setColumn([b, c]);\n    }\n\n    setRange(another) {\n        const a = this._initialRange;\n        if(this._compareRange(a, another)) {\n            this._rangeFrom = a;\n            this._rangeTo = another;\n        } else {\n            this._rangeFrom = another;\n            this._rangeTo = a;\n        }\n\n    }\n\n    _compareRange(r1, r2) {\n        if(r1[0] > r2[0]) {\n            return false;\n        }\n        if(r1[0] === r2[0] && r1[1] > r2[1]) {\n            return false;\n        }\n        if(r1[0] === r2[0] && r1[1] === r2[1] && r1[2] > r2[2]) {\n            return false;\n        }\n        return true;\n    }\n\n    delete(editor, records) {\n        if(this._enable) {\n            const area = editor._area;\n            const caret = editor._caret;\n            const rangeFrom = this._rangeFrom;\n            const rangeTo = this._rangeTo;\n            const elemFrom = area.get(rangeFrom[0]).get(rangeFrom[1]);\n            const elemTo = area.get(rangeTo[0]).get(rangeTo[1]);\n            let [row, elem_idx, offset] = rangeFrom;\n            records.push({\n                op: 'range',\n                args: [rangeFrom.slice(), rangeTo.slice()],\n            })\n            if(elemFrom === elemTo) {\n                const c = elemFrom.source;\n                elemFrom.setSource(c.substring(0, rangeFrom[2]) + c.substring(rangeTo[2]), records);\n                elemFrom.dirty = true;\n            } else {\n                const flattenTxtElem = editor._flattenTxtElem\n                let preContent = '';\n                let afterContent = '';\n                let preElement;\n                let afterElement;  \n                const fromIdx = flattenTxtElem.findIndex(elemFrom);\n                const toIdx = flattenTxtElem.findIndex(elemTo);\n                let endTextNeedWrap = false;\n                if(elemFrom.type === 'text') {\n                    preContent = elemFrom.source.substring(0, rangeFrom[2]);\n                } else {\n                    preElement = flattenTxtElem.get(fromIdx-1)\n                }\n                if(elemTo.type === 'text') {\n                    afterContent = elemTo.source.substring(rangeTo[2]);\n                    endTextNeedWrap = elemTo.needWrap;\n                } else {\n                    afterElement = flattenTxtElem.get(toIdx-1);\n                }\n\n                if(preElement) {\n                    flattenTxtElem.splice(fromIdx, toIdx-fromIdx+1);\n                    if(preElement.type === 'text') {\n                        if(preElement.needWrap) {\n                            row -= 1;\n                        } else {\n                            elem_idx -= 1;\n                        }\n                        offset = preElement.source.length;\n                        preElement.setSource(preElement.source + afterContent, records);\n                        preElement.dirty = true;\n                        preElement.setNeedWrap(endTextNeedWrap, records);\n                    } else {\n                        const t = new TextElement('text', preContent + afterContent);\n                        t.setNeedWrap(endTextNeedWrap, records);\n                        flattenTxtElem.splice(fromIdx, 0, t)\n                    }\n                } else {\n                    flattenTxtElem.splice(fromIdx, toIdx-fromIdx);\n                    if(afterElement) {\n                        const t = new TextElement('text', preContent);\n                        flattenTxtElem.splice(fromIdx, 0, t);\n                    } else {\n                        elemTo.setSource(preContent + afterContent, records);\n                        elemTo.dirty = true;\n                    }\n                }\n                \n                if(flattenTxtElem.length() === 0) {\n                    // elem_idx = 0;\n                    flattenTxtElem.push(new TextElement('text', ''));\n                }\n\n            }\n            this.disable();\n            \n            caret.setRow(row);\n            caret.setColumn([elem_idx, offset]);\n        }\n    }\n}\nexport default Range;","\nfunction isSetSourceBatch(x) {\n    return x.length === 1 && x[0].op === 'setSource';\n}\nexport default class UndoRedo {\n    static length = 50;\n    _undo = [];\n    _redo = [];\n    _editor = null;\n\n    write(x, caretRecord) {\n        if(x.length === 0) {\n            return;\n        }\n        if(isSetSourceBatch(x)) {\n            const t = x[0];\n            const lastUndo = this.getLastUndo();\n            if(lastUndo && isSetSourceBatch(lastUndo._batch)) {\n                const q = lastUndo._batch[0];\n                if(q.args[0] === t.args[0]) {\n                    q.args[1] = t.args[1];\n                    lastUndo._caretMetaTo = caretRecord.after;\n                    return;\n                }\n            }\n        }\n        const r = new BatchAction(x);\n        r._caretMetaFrom = caretRecord.before;\n        r._caretMetaTo = caretRecord.after;\n        this._undo.push(r);\n        \n        if(this._undo.length > UndoRedo.length) {\n            this._undo.splice(0, 1);\n        }\n        if(this._redo.length) {\n            this._redo = [];\n        }\n    }\n\n    getLastUndo() {\n        return this._undo[this._undo.length - 1];\n    }\n\n    undo() {\n        const x = this._undo.pop();\n        if(x) {\n            x.undo(this._editor)\n            this._redo.push(x);\n        }\n        return x;\n    }\n\n    redo() {\n        let x = this._redo.pop();\n        while(x && x.SKIP_REDO) {\n            x = this._redo.pop();\n        }\n        if(x) {\n            x.redo(this._editor)\n            this._undo.push(x);\n        }\n        return x;\n    }\n}\n\nclass BatchAction {\n    _batch = [];\n    _caretMetaFrom = null;\n    _caretMetaTo = null;\n    constructor(batch) {\n        this._batch = batch;\n    }\n\n    updateCaretMetaTo(meta) {\n        this._caretMetaTo = meta;\n    }\n\n    undo(editor) {\n        this._batch.slice().reverse().forEach(action => {\n            switch(action.op) {\n                case 'range':\n                    const [rangeFrom, rangeTo] = action.args;\n                    const range = editor._range;\n                    range.setInitialRange(rangeFrom);\n                    range.setRange(rangeTo);\n                    range.enable();\n                    break;\n                case 'setSource':\n                    const [elem, s, ls] = action.args;\n                    elem.source = ls;\n                    elem.dirty = true;\n                    break;\n                case 'setNeedWrap':\n                    const [o, p, q] = action.args;\n                    o.needWrap = q;\n                    o.dirty = true;\n                    break;\n                case 'splice':\n                    const flattenTxtElem = editor._flattenTxtElem;\n                    const [a, b, ...c] = action.args;\n                    const removed = action.removed;\n                    let i = 0\n                    if(c) {\n                        i = c.length\n                    }\n                    flattenTxtElem.splice(a, i, ...removed);\n                    break;\n            }\n        });\n\n        editor._caret.fromRange(this._caretMetaFrom);\n    }\n\n    redo(editor) {\n        this._batch.forEach(action => {\n            switch(action.op) {\n                case 'setSource':\n                    const [elem, s, ls] = action.args;\n                    elem.source = s;\n                    elem.dirty = true;\n                    break;\n                case 'setNeedWrap':\n                    const [o, p, q] = action.args;\n                    o.needWrap = p;\n                    o.dirty = true;\n                    break;\n                case 'splice':\n                    const flattenTxtElem = editor._flattenTxtElem;\n                    flattenTxtElem.splice(...action.args);\n                    break;\n            }\n        })\n        editor._caret.fromRange(this._caretMetaTo);\n    }\n}","class Command {\n    static create(editor) {\n        return new this(editor)\n    }\n\n    constructor(editor) {\n        this._editor = editor;\n    }\n\n    exec() {}\n}\n\nexport default Command;","import Command from './base';\nimport { KEYBOARD_COMMANDS } from '../base/constants';\n\nexport class ArrowLeftCommand extends Command {\n    static name = KEYBOARD_COMMANDS.ARROW_LEFT;\n\n    exec() {\n        const editor = this._editor;\n        editor._range.disable();\n        const flattenTxtElem = editor._flattenTxtElem\n        const caret = editor._caret;\n        const row = caret.getRow();\n        const column = caret.getColumn();\n        const [elemidx, offset] = column;\n        const line = editor._area.get(row);\n        const element = line.get(elemidx);\n        const idx = flattenTxtElem.findIndex(element);\n        const result = element.shift(offset, -1);\n        switch(result) {\n            case 'prev':\n                if(elemidx > 0) {\n                    const el = line.get(elemidx - 1);\n                    caret.setColumn([elemidx - 1, el.tailOffset()])\n                } else if(idx > 0) {\n                    const preRow = row - 1;\n                    const preElemidx = editor._area.get(preRow).length() - 1\n                    const offset = flattenTxtElem.get(idx-1).tailOffset();\n                    caret.setRow(preRow);\n                    caret.setColumn([preElemidx, offset]);\n                }\n                break;\n            case 'self':\n                caret.setColumn(1, offset - 1)\n                break;\n        }\n        caret.refresh();\n        editor.syncShadowInputPosition();\n        editor._jflow._render();\n    }\n}\nexport class ArrowRightCommand extends Command {\n    static name = KEYBOARD_COMMANDS.ARROW_RIGHT;\n\n    exec() {\n        const editor = this._editor;\n        editor._range.disable();\n        const flattenTxtElem = editor._flattenTxtElem\n        const caret = editor._caret;\n        const row = caret.getRow();\n        const column = caret.getColumn();\n        const [elemidx, offset] = column;\n        const line = editor._area.get(row);\n        const element = line.get(elemidx);\n        const idx = flattenTxtElem.findIndex(element);\n        const result = element.shift(offset, 1, idx === flattenTxtElem.length()-1);\n        switch(result) {\n            case 'next':\n                if(elemidx < line.length()-1) {\n                    const el = line.get(elemidx + 1);\n                    if(element.type === 'text' && el.type !== 'text') {\n                        caret.setColumn([elemidx + 2, el.headOffset()])\n                    } else {\n                        caret.setColumn([elemidx + 1, el.headOffset()])\n                    }\n                } else if(idx < flattenTxtElem.length()-1) {\n                    const afterRow = row + 1;\n                    const offset = flattenTxtElem.get(idx + 1).headOffset();\n                    caret.setRow(afterRow);\n                    caret.setColumn([0, offset]);\n                }            \n                break;\n            case 'self':\n                caret.setColumn(1, offset + 1);\n                break;\n        }\n\n        caret.refresh();\n        editor.syncShadowInputPosition();\n        editor._jflow._render();\n    }\n}\nexport class ArrowUpCommand extends Command {\n    static name = KEYBOARD_COMMANDS.ARROW_UP;\n\n    exec() {\n        this._editor._range.disable();\n        const nextRow = this._editor._caret.getRow() - 1;\n        if(nextRow > -1){\n            this._handler(nextRow);\n        }\n    }\n}\nexport class ArrowDownCommand extends Command {\n    static name = KEYBOARD_COMMANDS.ARROW_DOWN;\n\n    exec() {\n        this._editor._range.disable();\n        const nextRow = this._editor._caret.getRow() + 1;\n        if(nextRow < this._editor._area.length()){\n            this._handler(nextRow);\n        }\n    }\n}\nconst _mixin = {\n    _handler(nextRow) {\n        const editor = this._editor;\n        const caret = editor._caret;\n        const row = caret.getRow();\n        const column = caret.getColumn();\n        const [elemidx, offset] = column;\n        const area = editor._area;\n        const line = area.get(row);\n        let currElem = line.get(elemidx);\n        let currElemReduceWidth = currElem.reduceWidth;\n        if(offset > 0) {\n            currElemReduceWidth += editor.measureTextWidth(currElem.source.substring(0, offset))\n        }\n        \n        const nextLine = area.get(nextRow);\n        const nextColumn = nextLine.getColumnNearest(currElemReduceWidth, editor.elementSpace, editor.fontSize, editor.fontFamily)\n        caret.setRow(nextRow);\n        caret.setColumn(nextColumn);\n        \n        caret.refresh();\n        editor.syncShadowInputPosition();\n        editor._jflow._render();\n    }\n}\n\nObject.assign(ArrowUpCommand.prototype, _mixin);\nObject.assign(ArrowDownCommand.prototype, _mixin);","import Command from './base';\nimport { TextElement } from '../storage';\nimport { EDITOR_EVENTS, KEYBOARD_INPUT } from '../base/constants';\nfunction _blandAdjacentElement(elem1, elem2, defaultOffset, records) {\n    if(!elem1) {\n        return [defaultOffset, false];\n    }\n    if(elem1.type === 'text' && elem2.type === 'text') {\n        const offset = elem1.source.length;\n        elem1.setSource(elem1.source + elem2.source, records);\n        elem1.setNeedWrap(elem2.needWrap, records)\n        return [offset, true];\n    }\n    return [defaultOffset, false];\n}\n\nexport class Input extends Command {\n    static name = EDITOR_EVENTS.INPUT;\n\n    cacheIdx = null;\n\n    exec(kind, data) {\n        const editor = this._editor;\n        const range = editor._range;\n        const caret = editor._caret;\n        const flattenTxtElem = editor._flattenTxtElem;\n        const undoredo = editor._undoredo;\n        const records = flattenTxtElem.startRecord();\n        flattenTxtElem.recordBeforeCaret(caret);\n        if(range.isEnable()) {\n            range.delete(editor, records);\n            if(kind === KEYBOARD_INPUT.BACKSPACE || kind === KEYBOARD_INPUT.DELETE) {\n                flattenTxtElem.collectRecords();\n                flattenTxtElem.recordAfterCaret(caret);\n                this._editor.refresh();\n                undoredo.write(records, flattenTxtElem.getCaretRecord());\n                return;\n            }\n        }\n        \n        const row = caret.getRow();\n        let [elem_idx, offset] = caret.getColumn();\n        const area = editor._area;\n        const line = area.get(row);\n        let element = line.get(elem_idx);\n        let preElem = line.get(elem_idx-1);\n        \n        let content = '';\n        if(element.type === 'text') {\n            content = element.source;\n        } else if(preElem?.type ==='text'){\n            content = preElem.source;\n            element = preElem;\n            offset = content.length;\n            caret.setColumn([elem_idx-1, content.length]);\n        } else {\n            const newElement = new TextElement('text', '');\n            flattenTxtElem.insertBefore(element, newElement);\n            element = newElement;\n        }\n\n        let preContent = content.substring(0, offset);\n        let afterContent \n        if(this.cacheIdx) {\n            afterContent = content.substring(this.cacheIdx[1]);\n        } else {\n            afterContent = content.substring(offset);\n        }\n\n        switch(kind){\n            case KEYBOARD_INPUT.INPUT:\n                if(/\\r?\\n/.test(data)) {\n                    let source = data.split(/\\r?\\n/);\n                    source = source.replace(/\\t/, '');\n                    let idx = flattenTxtElem.findIndex(element);\n                    let a = source.shift();\n                    element.setSource(preContent + a, records);\n                    let _row = row + 1;\n                    idx++;\n                    while(source.length > 1) {\n                        const t = new TextElement('text', source.shift());\n                        t.setNeedWrap(true, records);\n                        _row++;\n                        flattenTxtElem.inersetAt(idx, t);\n                        idx++;\n                    }\n                    a = source.shift();\n                    const curElem = flattenTxtElem.get(idx);\n                    if(curElem && curElem.type === 'text') {\n                        curElem.setSource(a + curElem.source, records);\n                    } else {\n                        const t = new TextElement('text', a);\n                        flattenTxtElem.inersetAt(idx, t);\n                    }\n                    caret.setRow(_row);\n                    caret.setColumn([0, a.length])\n                } else {\n                    preContent += data;\n                    caret.setColumn(1, caret.getColumn(1) + data.length);\n                    element.setSource(preContent + afterContent, records);\n                }\n                break;\n            case KEYBOARD_INPUT.COMPOSITION_START:\n                this.cacheIdx = [preContent.length, preContent.length];\n                break;\n            case KEYBOARD_INPUT.COMPOSITION_UPDATE:\n                preContent = preContent.substring(0, this.cacheIdx[0]);\n                preContent += data;\n                element.setSource(preContent + afterContent, records);\n                const _t = this.cacheIdx[0] + data.length;\n                caret.setColumn(1, _t);\n                this.cacheIdx[1] = _t;\n                break;\n            case KEYBOARD_INPUT.COMPOSITION_END:\n                preContent = preContent.substring(0, this.cacheIdx[0]);\n                caret.setColumn(1, this.cacheIdx[0] + data.length);\n                this.cacheIdx = null;\n                preContent += data;\n                element.setSource(preContent + afterContent, records);\n                break;\n            case KEYBOARD_INPUT.ENTER:\n                element.setSource(preContent, records);\n                element.setNeedWrap(true, records);\n                const t = new TextElement('text', afterContent);\n                flattenTxtElem.insertAfter(element, t);\n                caret.setRow(row+1);\n                caret.setColumn([0, 0])\n                break;\n            \n            case KEYBOARD_INPUT.BACKSPACE:\n                const result = element.shift(offset, -1);\n                switch(result) {\n                    case 'prev':\n                        let idx = flattenTxtElem.findIndex(element);\n                        if(elem_idx > 0) {\n                            // 行内\n                            flattenTxtElem.splice(idx-1, 1);\n                            idx -= 1;\n                            // element.setSource(afterContent, records);\n                            // element.dirty = true;\n                            const [offset, deleteop] = _blandAdjacentElement(flattenTxtElem.get(idx-1), element, 0, records);\n                            if(deleteop) {\n                                flattenTxtElem.remove(idx);\n                            }\n                            caret.setColumn([elem_idx - (offset > 0?2:1), offset])\n                            \n                        } else if(idx > 0) {\n                            // 换行了\n                            const preRow = row - 1;\n                            const preElemidx = area.get(preRow).length() - 1;\n                            const [offset, deleteop] = _blandAdjacentElement(flattenTxtElem.get(idx-1), element, 0, records);\n                            if(deleteop) {\n                                flattenTxtElem.remove(idx);\n                            }\n                            caret.setRow(preRow);\n                            caret.setColumn([preElemidx, offset]);\n                        }\n                        break;\n                    case 'self':\n                        preContent = preContent.substring(0, preContent.length - 1);\n                        caret.setColumn(1, caret.getColumn(1)-1)\n                        element.setSource(preContent + afterContent, records);\n                        break;\n                }\n                break;\n            case KEYBOARD_INPUT.DELETE:\n                const shiftresult = element.shift(offset, 1);\n                switch(shiftresult) {\n                    case 'next':\n                        let idx = flattenTxtElem.findIndex(element);\n                        if(elem_idx < line.length()-1) {\n                            // 行内\n                            flattenTxtElem.splice(idx+1, 1);\n                            const nextElem = flattenTxtElem.get(idx+1);\n                            const [offset, deleteop] = _blandAdjacentElement(element, nextElem, element.source.length, records);\n                            if(deleteop) {\n                                flattenTxtElem.remove(idx+1);\n                            }\n                            caret.setColumn([elem_idx, offset])\n                            \n                        } else if(idx < flattenTxtElem.length()-1){\n                            // 换行了\n                            const nextElem = flattenTxtElem.get(idx+1);\n                            const [offset, deleteop] = _blandAdjacentElement(element, nextElem, element.source.length, records);\n                            if(deleteop) {\n                                flattenTxtElem.remove(idx+1);\n                            }\n                            caret.setColumn([elem_idx, offset])\n                        }\n                        break;\n                    case 'self':\n                        afterContent = afterContent.substring(1);\n                        element.setSource(preContent + afterContent, records);\n                        break;\n                }\n                break;\n        }\n\n        flattenTxtElem.collectRecords();\n        flattenTxtElem.recordAfterCaret(caret);\n        undoredo.write(records, flattenTxtElem.getCaretRecord());\n        this._editor.refresh();\n    }\n\n    \n}","import Command from './base';\n\nimport { MOUSE_COMMANDS } from '../base/constants';\nimport JFlowEvent from '../../../events/index';\n\nexport class StartEditCommand extends Command {\n    static name = MOUSE_COMMANDS.START_EDIT;\n\n    exec() {\n        const editor = this._editor;\n        if(!this._startEdit()) {\n            return;\n        }\n        const jflow = editor._jflow;\n        editor.moveCaretByHitPoint();\n        editor.createShadowInput();\n        editor._caret.animate(jflow);\n        editor.syncShadowInputPosition();\n    }\n\n    _startEdit() {\n        let flag = true;\n        const editor = this._editor;\n        editor.dispatchEvent(new JFlowEvent('edit', {\n            target: editor,\n            preventDefault() {\n                flag = false;\n            }\n        })) \n        return flag; \n    }\n}\nexport class EditClickCommand extends Command {\n    static name = MOUSE_COMMANDS.EDIT_CLICK;\n\n    exec() {\n        const editor = this._editor;\n        editor.moveCaretByHitPoint();\n        editor._caret.refresh();\n        editor.syncShadowInputPosition();\n        editor._range.disable();\n    }\n}\n\nexport class DoubleClickCommand extends Command {\n    static name = MOUSE_COMMANDS.DOUBLE_CLICK;\n\n    exec() {\n        const editor = this._editor;\n        editor.moveCaretByHitPoint();\n        const caret = editor._caret;\n        const range = editor._range;\n        const area = editor._area;\n        const row = caret.getRow();\n        const line = area.get(row);\n        const elem_idx = line.length() - 1;\n        range.setInitialRange([row, 0, 0]);\n        range.setRange([\n            row, elem_idx, line.tail().tailOffset()\n        ]);\n        range.handleCaret(caret);\n        range.enable();\n        editor.syncShadowInputPosition();\n    }\n}\n","import Command from './base';\nimport { KEYBOARD_COMMANDS, MOUSE_COMMANDS } from '../base/constants';\n\nexport class ShiftUpCommand extends Command {\n    static name = KEYBOARD_COMMANDS.SHIFT_UP;\n    exec() {\n        const range = this._editor._range;\n        range.setInitialRange(null);\n        this._editor.toggleShift(false)\n    }\n}\n\nexport class ShiftDownCommand extends Command {\n    static name = KEYBOARD_COMMANDS.SHIFT_DOWN;\n    \n    exec() {\n        const range = this._editor._range;\n        const caret = this._editor._caret;\n        range.setInitialRange(caret.toRange());\n        this._editor.toggleShift(true)\n    }\n}\n\nexport class ShiftOnClickCommand extends Command {\n    static name = MOUSE_COMMANDS.SHIFT_ON_CLICK;\n\n    exec() {\n        const editor = this._editor;\n        editor.moveCaretByHitPoint();\n        const caret = this._editor._caret;\n        const range = this._editor._range;\n        range.setRange(caret.toRange());\n        range.enable();\n        range.handleCaret(caret);\n        caret.refresh();\n        editor.syncShadowInputPosition();\n    }\n}","import Command from './base';\nimport { KEYBOARD_COMMANDS } from '../base/constants';\n\nexport class CtrlACommand extends Command {\n    static name = KEYBOARD_COMMANDS.CTRLA;\n    exec() {\n        const editor = this._editor;\n        const caret = editor._caret;\n        const range = editor._range;\n        const area = editor._area;\n        const row = area.length() - 1;\n        const line = area.get(row);\n        const elem_idx = line.length() - 1;\n        range.setInitialRange([0, 0, 0]);\n        range.setRange([\n            row, elem_idx, line.tail().tailOffset()\n        ]);\n        range.handleCaret(caret);\n        range.enable();\n        editor.syncShadowInputPosition();\n    }\n}\n","import Command from './base';\nimport { KEYBOARD_COMMANDS } from '../base/constants';\n\nexport class UndoCommand extends Command {\n    static name = KEYBOARD_COMMANDS.UNDO;\n    exec() {\n        this._editor._range.disable()\n        this._editor._undoredo.undo();\n        this._editor.refresh();\n\n    }\n}\n\nexport class RedoCommand extends Command {\n    static name = KEYBOARD_COMMANDS.REDO;\n    exec() {\n        this._editor._range.disable()\n        this._editor._undoredo.redo();\n        this._editor.refresh();\n    }\n}","import Node from '../node';\nimport StackMixin from '../stackMixin';\nimport LayoutMixin from '../layoutMixin';\nimport JFlowEvent from '../../events/index';\nimport { requestCacheCanvas } from '../../utils/canvas';\nimport ShadowCache from '../shapes/shadow-cache';\nimport ShadowInput from './base/shadow-input';\n\nimport Caret from './base/caret';\nimport Range from './base/range';\nimport UndoRedo from './undoredo';\nimport {\n    Area,\n    FlattenTextElements,\n    Line,\n    TextElement\n} from './storage';\n\nimport { \n    Input,\n    ArrowLeftCommand,\n    ArrowRightCommand,\n    ArrowUpCommand,\n    ArrowDownCommand,\n    StartEditCommand,\n    ShiftDownCommand,\n    ShiftUpCommand,\n    ShiftOnClickCommand,\n    EditClickCommand,\n    CtrlACommand,\n    DoubleClickCommand,\n    // ReturnCommand,\n    // DeleteCommand,\n    UndoCommand,\n    RedoCommand,\n} from './command'\nimport { EDITOR_EVENTS, KEYBOARD_COMMANDS, MOUSE_COMMANDS } from './base/constants';\n\nclass TextGroup extends Node {\n\n    get currentLineHeight() {\n        return this.lineHeight || parseInt(this.fontSize);\n    }\n\n    constructor(configs) {\n        super(configs);\n        this.initStack(configs);\n        this.initLayout(configs);\n\n        this._undoredo = new UndoRedo();\n        this._undoredo._editor = this;\n        this._caret = new Caret();\n        this._range = new Range();\n        this._shadowInput = undefined;\n\n        this.textColor = configs.textColor || 'transparent';\n        this.fontFamily = configs.fontFamily || '-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji'\n        this.fontSize = configs.fontSize || '28px';\n        this.fontWeight = configs.fontWeight || '';\n        this.elementSpace = configs.elementSpace || 5;\n        this.lineSpace = configs.lineSpace || 5;\n        this.placeholder = configs.placeholder || '请输入';\n        this.placeholderColor = configs.placeholderColor || '#eee';\n        this.cursorColor = configs.cursorColor || '#60CFC4';\n        this.textRangeColor = configs.textRangeColor || '#4E75EC1A';\n        this.minWidth = configs.minWidth || 0;\n\n        \n        this.resolver = () => {\n            const elements = configs.resolver();\n            if(elements.length === 0 || elements[elements.length-1].type !== 'text') {\n                elements.push(new TextElement('text', ''))\n            }\n            return elements;\n        }\n\n        // this._lines = [];\n        this._area = new Area();\n        this._flattenTxtElem = FlattenTextElements.create(this.resolver()); \n        this._status = {\n            editing: false,\n            dragover: false,\n\n        }\n\n        this.commands = new Map();\n        this.registCommand(StartEditCommand);\n        this.registCommand(EditClickCommand);\n        this.registCommand(ShiftUpCommand);\n        this.registCommand(ShiftDownCommand);\n        this.registCommand(ShiftOnClickCommand);\n        this.registCommand(Input);\n        this.registCommand(ArrowLeftCommand);\n        this.registCommand(ArrowRightCommand);\n        this.registCommand(ArrowUpCommand);\n        this.registCommand(ArrowDownCommand);\n        this.registCommand(CtrlACommand);\n        this.registCommand(DoubleClickCommand);\n        // this.registCommand(ReturnCommand);\n        // this.registCommand(DeleteCommand);\n        this.registCommand(UndoCommand);\n        this.registCommand(RedoCommand);\n        this._makeFunctional();\n\n        this._cacheViewBox = [];\n    }\n\n    registCommand(cmd) {\n        if(!this.commands.has(cmd.name)) {\n            this.commands.set(cmd.name, cmd.create(this));\n        }\n    }\n\n    _makeFunctional() {\n        this.addEventListener('dblclick', (event) => {\n            if(event.currentTarget !== this) {\n                return\n            }\n            event.detail.bubbles = false;\n            if(this._status.editing) {\n                this.execCommand(MOUSE_COMMANDS.DOUBLE_CLICK)\n            } \n        });\n        this.addEventListener('click', (event) => {\n            if(event.currentTarget !== this) {\n                return\n            }\n            event.detail.bubbles = false;\n            let commnd;\n            if(this._status.editing) {\n                if(this._status.shiftOn) {\n                    commnd = MOUSE_COMMANDS.SHIFT_ON_CLICK\n                } else {\n                    commnd = MOUSE_COMMANDS.EDIT_CLICK\n                }\n            } else {\n                commnd = MOUSE_COMMANDS.START_EDIT\n            }\n            this.execCommand(commnd)\n        });\n\n        this.addEventListener('blur', (event) => {\n            this._status.editing = false;\n            if(this._shadowInput) {\n                this._shadowInput.destroy();\n            }\n            if(this._belongs) {\n                this._jflow._render();\n            } \n\n            this.dispatchEvent(new JFlowEvent('change', {\n                target: this,\n                textElements: this._flattenTxtElem.copy(),\n            }));\n\n            this._range.disable();\n            this._caret.cancelAnimate();\n        });\n\n        this.addEventListener('instancePressStart', (event) => {\n            if(this._status.editing && !this._status.shiftOn) {\n                event.detail.bubbles = false;\n                event.detail.preventDefault();\n                // event.detail.jflow.setMovingTargets(null);\n                const point = this._currentp;\n                const c = this._positionToCursorOffset(point);\n                // this._cursor = c;\n                const range = this._range;\n                range.setInitialRange([c.row, ...c.column]);\n                const jflow = event.detail.jflow;\n                let moved = false;\n                const t = (e => {\n                    this._status.editing = false;\n                    moved = true;\n                    const { offsetX, offsetY } = e;\n                    const p = jflow._calculatePointBack([offsetX, offsetY]);\n                    jflow._stack.checkHit(p)\n                    const point = this._currentp;\n                    const c = this._positionToCursorOffset(point);\n                    // this._cursor = c;\n                    range.setRange([c.row, ...c.column]);\n                    range.enable();\n                }).bind(this);\n\n                document.addEventListener('pointermove', t)\n                document.addEventListener('pointerup', (e) => {\n                    document.removeEventListener('pointermove', t);\n                    range.setInitialRange(null);\n                    if(!moved) {\n                        return;\n                    }\n                    range.handleCaret(this._caret)\n                    this._status.editing = true;\n                    this._shadowInput.focus();   \n                }, {\n                    once: true,\n                })\n            }\n        });\n\n        this.addEventListener('dragenter', () => {\n            this.moveCaretByHitPoint();\n            this._status.dragover = true;\n        });\n        this.addEventListener('dragover', () => {\n            this.moveCaretByHitPoint();\n        });\n        this.addEventListener('dragleave', () => {\n            this._status.dragover = false;\n        });\n\n        const onDrop = ((event) => {\n            if(!this._status.dragover) {\n                return;\n            }\n            event.detail.bubbles = false;\n            this._status.dragover = false;\n            const caret = this._caret;\n            const row = caret.getRow();\n            const column = caret.getColumn();\n            const line = this._area.get(row);\n            let [elemidx, offset] = column;\n            const element = line.get(elemidx);\n            const preElem = line.get(elemidx-1);\n            let flattenTxtElem = this._flattenTxtElem;\n            \n            let idx = flattenTxtElem.findIndex(element)\n            if(element.type !== 'text' && preElem?.type ==='text') {\n                offset = preElem.source.length;\n                idx = flattenTxtElem.findIndex(preElem)   \n            }\n\n            const lastLength = flattenTxtElem.length()\n            this.dispatchEvent(new JFlowEvent('insert', {\n                ...event.detail,\n                type: event.type,\n                textElements: flattenTxtElem.copy(),\n                idx, offset,\n            }));\n            // after insert\n            flattenTxtElem = this._flattenTxtElem;\n            if(this._status.editing) {\n                if(flattenTxtElem.length() > lastLength) {\n                    caret.setColumn([\n                        elemidx + flattenTxtElem.length() - lastLength,\n                        0\n                    ])\n                }\n                this._shadowInput.focus(); \n            }\n            if(this._status.editing) {\n                this._caret.refresh();\n            }\n            this.syncShadowInputPosition();\n            this._range.disable();\n        }).bind(this)\n        this.addEventListener('pressEnd', onDrop)\n        this.addEventListener('drop', onDrop);\n    }\n\n    toggleShift(val) {\n        this._status.shiftOn = val;\n    }\n\n    execCommand(kind) {\n        const cmd = this.commands.get(kind);\n        cmd.exec();\n    }\n\n    createShadowInput() {\n        const jflow = this._jflow;\n        this._shadowInput = new ShadowInput(jflow.DOMwrapper);\n        this._shadowInput.addEventListener(EDITOR_EVENTS.CONTROL_CMD, e => {\n            const kind = e.detail.kind;\n            this.execCommand(kind)\n        });\n\n        this._shadowInput.addEventListener(EDITOR_EVENTS.INPUT, e => {\n            const kind = e.detail.kind;\n            const data = e.detail.data;\n            const cmd = this.commands.get(EDITOR_EVENTS.INPUT);\n            cmd.exec(kind, data);\n        });\n        this._status.editing = true;\n        jflow.setFocusInstance(this);\n    }\n\n    moveCaretByHitPoint() {\n        const point = this._currentp;\n        const caret = this._caret;\n        const { row, column } = this._positionToCursorOffset(point);\n        caret.setRow(row);\n        caret.setColumn(column);\n    }\n\n    refresh() {\n        this.recalculateUp();\n        this.syncShadowInputPosition();\n        this._jflow._render();\n    }\n\n    refreshTextElements() {\n        this._flattenTxtElem = FlattenTextElements.create(this.resolver()); \n    }\n\n    _positionToCursorOffset(point) {\n        const [x, y] = point;\n        // const [x0, y0] = this.anchor;\n        const area = this._area;\n        const w = this.width/2;\n        const h = this.height/2;\n        const offsetX = x + w;\n        const offsetY = y + h;\n        const row = area.getLineAbove(offsetY)\n        const currLine = area.get(row);\n        const column = currLine.getColumnNearest(offsetX, this.elementSpace, this.fontSize, this.fontFamily);\n        return {\n            row, \n            column,\n        }\n    }\n\n    _caretToPosition() {\n        const row = this._caret.getRow();\n        const column = this._caret.getColumn();\n        const line = this._area.get(row);\n        const [elemidx, offset] = column;\n        const meta = line.get(elemidx);\n        const idx = this._flattenTxtElem.findIndex(meta);\n        const preElem = this._flattenTxtElem.get(idx-1);\n        let cw;\n        let c_len = this.currentLineHeight/2;\n        if(meta.type === 'text') {\n            const c = meta.source.substring(0, offset);\n            requestCacheCanvas((ctx) => {\n                ctx.beginPath();\n                ctx.font = `${this.fontSize} ${this.fontFamily}`;\n                cw = meta.anchorX - meta.width/2 + ctx.measureText(c).width\n            })\n        } else {\n            cw = meta.anchorX - meta.width/2\n            c_len = Math.max(c_len, meta.height/2);\n        }\n        if(offset === 0 && preElem && preElem.type !== 'text') {\n            c_len = Math.max(c_len, preElem.height/2);\n        }\n        return [cw, c_len, line.anchorY, preElem, meta]\n    }\n\n    syncShadowInputPosition() {\n        if(this._status.editing) {\n            const [cw, c_len, anchorY] = this._caretToPosition();\n            const point = this.calculateToRealWorld([cw, anchorY + c_len]);\n            const canvasMeta = this._jflow.canvasMeta;\n            const px = Math.min(canvasMeta.actual_width - 120, point[0]);\n            // return [px, point[1]];\n            this._shadowInput.syncPosition(px, point[1]);\n            this._shadowInput.focus();\n        }\n    }\n\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        } else if(this.opacity !== 1) {\n            ctx.globalAlpha = this.opacity;\n        }\n        const [cx, cy] = this.anchor;\n        const jflow = this._jflow;\n        const area = this._area;\n        ctx.translate(cx, cy);\n        // ctx.beginPath();\n        // ctx.rect(-width/2, -height/2, width, height);\n        // ctx.stroke();\n        const flattenTxtElem = this._flattenTxtElem;\n        if(flattenTxtElem.isEmpty()) {\n            ctx.beginPath();\n            ctx.font = `${this.fontWeight} ${this.fontSize} ${this.fontFamily}`;\n            ctx.textAlign = 'center';\n            ctx.textBaseline = 'middle';\n            ctx.fillStyle = this.placeholderColor;\n            ctx.fillText(this.placeholder, 0, 0);\n\n            this._randerCursor(ctx);\n\n            ctx.translate(-cx, -cy);\n            ctx.restore();\n            return;\n        }\n\n        ctx.beginPath();\n        ctx.font = `${this.fontWeight} ${this.fontSize} ${this.fontFamily}`;\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillStyle = this.textColor;\n        area.forEach(line => {\n            line.forEach(el => {\n                if(el.type === 'text') {\n                    ctx.fillText(el.source, el.anchorX, el.anchorY)\n                } \n            })\n        })\n        flattenTxtElem.forEach(elem => {\n            if(elem.type !== 'text') {\n                const instance = jflow.getRenderNodeBySource(elem.source);\n                if(instance.visible) {\n                    ctx.save();\n                    instance.render(ctx);\n                    ctx.restore();\n                }\n            }\n        })\n\n        this._randerCursor(ctx);\n        this._renderRange(ctx);\n        ctx.translate(-cx, -cy);\n        ctx.restore();\n    }\n\n    _randerCursor(ctx) {\n        if(this._caret.isShow() && (this._status.editing || this._status.dragover)) {\n            const [cw, c_len, anchorY] = this._caretToPosition();\n            ctx.beginPath();\n            ctx.moveTo(cw, anchorY - c_len);\n            ctx.lineTo(cw, anchorY + c_len);\n            ctx.lineWidth = 2;\n            ctx.strokeStyle = this.cursorColor;\n            ctx.stroke();\n        }\n    }\n\n    _renderRange(ctx) {\n        const range = this._range;\n        if(range.isEnable()) {\n            const area = this._area;\n            const textRangeColor = this.textRangeColor;\n            const blockheight = this.height;\n            const blockwidth = this.width;\n            const lineSpace = this.lineSpace;\n            const [r_f, idx_f, offset_f] = range.getRangeFrom();\n            const [r_t, idx_t, offset_t] = range.getRangeTo();\n            if(r_f === r_t) {\n                if(idx_f === idx_t && offset_f == offset_t) {\n                    return;\n                }\n                const line = area.get(r_f);\n                let space = (r_f === area.length()-1 ? 0 : lineSpace);\n                const lty = line.reduceHeight - space - line.height - blockheight/2;\n                const height = line.height;\n                const x1 = this._measureElementOffsetX(line.get(idx_f), offset_f, ctx);\n                const x2 = this._measureElementOffsetX(line.get(idx_t), offset_t, ctx);\n                ctx.beginPath();\n                ctx.rect(x1, lty , x2 - x1, height);\n                ctx.fillStyle = textRangeColor\n                ctx.fill();\n            } else {\n                let _r = r_f;\n                let beginning = true;\n                while(_r <= r_t) {\n                    const line = area.get(_r);\n                    let space = (_r === area.length()-1 ? 0 : lineSpace);\n                    const lty = line.reduceHeight - space - line.height - blockheight/2;\n                    const height = line.height;\n    \n                    if(beginning) {\n                        const elem = line.get(idx_f);\n                        const x = this._measureElementOffsetX(elem, offset_f, ctx);\n                        const lastElem = line.tail();\n                        const t = lastElem.anchorX + lastElem.width/2;\n    \n                        ctx.beginPath();\n                        ctx.rect(x, lty, t - x, height);\n                        ctx.fillStyle = textRangeColor\n                        ctx.fill();\n                    } else if(_r === r_t){\n                        const elem = line.get(idx_t);\n                        const x = this._measureElementOffsetX(elem, offset_t, ctx);\n                        ctx.beginPath();\n                        ctx.rect(-blockwidth/2, lty , elem.reduceWidth + (x - elem.anchorX + elem.width/2), height);\n                        ctx.fillStyle = textRangeColor\n                        ctx.fill();\n                    } else {\n                        ctx.beginPath();\n                        ctx.rect(-blockwidth/2, lty, line.width, height);\n                        ctx.fillStyle = textRangeColor\n                        ctx.fill();\n                    }\n                    \n                    beginning = false;\n                    _r++;\n                }\n            }\n        }\n    }\n\n    _measureElementOffsetX(element, offset, ctx) {\n        if(element.type !== 'text' || offset === 0){\n            return element.anchorX - element.width/2;\n        }\n        return element.anchorX - element.width/2 + ctx.measureText(element.source.substring(0, offset)).width;\n    }\n\n    measureTextWidth(content) {\n        let t;\n        requestCacheCanvas((ctx) => {\n            ctx.font = `${this.fontSize} ${this.fontFamily}`;\n            t = ctx.measureText(content).width;\n        });\n        return t;\n    }\n\n    getBoundingDimension() {\n        return {\n            width: this.width,\n            height: this.height,\n        } \n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n\n    _getViewBox() {\n        const belongs_vbox = this._belongs.getCacheViewBox();\n        const cacheViewBox = this._cacheViewBox;\n        \n        this._calculatePointBackWithPoint(belongs_vbox[0], belongs_vbox[1], cacheViewBox, 0, 1);\n        this._calculatePointBackWithPoint(belongs_vbox[2], belongs_vbox[3], cacheViewBox, 2, 3);\n        return this._cacheViewBox;\n    }\n    \n    getCacheViewBox() {\n        return this._cacheViewBox;\n    }\n\n    calculateToCoordination(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this.anchor;\n        // const p = [cx + anchor[0] - spanH, cy + anchor[1] - spanV];\n        const p = [gx + cx, gy + cy]\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            return this._belongs.calculateToCoordination(p);\n        } else {\n            return p;\n        }\n    }\n\n    calculateToRealWorld(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this.anchor;\n        const p = [gx + cx, gy + cy]\n        if(this._belongs && this._belongs.calculateToRealWorld) {\n            return this._belongs.calculateToRealWorld(p);\n        }\n    }\n\n    _calculatePointBack(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this.anchor;\n        const p = [gx - cx, gy - cy]\n        return p\n    }\n\n    _calculatePointBackWithPoint(a, b, arr, idx1, idx2) {\n        arr[idx1] = a - this.anchor[0];\n        arr[idx2] = b - this.anchor[1];\n    }\n\n    isHit(point, condition) {\n        const p = this._calculatePointBack(point);\n        const jflow = this._jflow;\n        this._currentp = p; // 暂存，为了后续计算别的位置\n        let validInstance = [];\n        const flattenTxtElem = this._flattenTxtElem;\n        flattenTxtElem.forEach(elem => {\n            if(elem.type !== 'text') {\n                const instance = jflow.getRenderNodeBySource(elem.source);\n                if(instance.visible) {\n                    validInstance.push(instance);\n                }\n            }\n        })\n        const target = this._stack.checkHit(p, condition, (i) => validInstance.includes(i));\n        \n        if(target) return target;\n\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        return point[0] > anchor[0] - w\n            && point[0] < anchor[0] + w\n            && point[1] > anchor[1] - h\n            && point[1] < anchor[1] + h;\n    }\n\n    clone() {\n        const t = new ShadowCache({\n            width: this.width,\n            height: this.height,\n            cache: (ctx) => {\n                const [cx, cy] = this.anchor;\n                ctx.translate(-cx + this.width/2, -cy + this.height/2);\n                this.render(ctx);\n            }\n        })\n\n        return t;\n    }\n\n    destroy() {\n        if(this._jflow._focus.instance === this) {\n            this._jflow.blur();\n        }\n    }\n}\n\nObject.assign(TextGroup.prototype, StackMixin);\nObject.assign(TextGroup.prototype, LayoutMixin);\nObject.assign(TextGroup.prototype, {\n        // 屏蔽这两个方法，只根据reflow重算\n    _getBoundingGroupRect() {},\n    resetChildrenPosition() {},\n    reflow() {\n        let lineHeight = this.currentLineHeight;\n        const flattenTxtElem = this._flattenTxtElem;\n        const area = this._area;\n        if(flattenTxtElem.isEmpty()) {\n            let width = 0;\n            const t = flattenTxtElem.get(0);\n            requestCacheCanvas((ctx) => {\n                ctx.font = `${this.fontSize} ${this.fontFamily}`;\n                width = ctx.measureText(this.placeholder).width;\n            });\n            const line = area.truncate({\n                height: lineHeight,\n                reduceHeight: lineHeight,\n            });\n            line.insert(0, t);\n            Object.assign(t, {\n                anchorX: -width/2,\n                height: lineHeight,\n                isTail: true,\n            })\n            this.width = width;\n            this.height = lineHeight;\n            return;\n        }\n        const jflow = this._jflow;\n        requestCacheCanvas((ctx) => {\n            ctx.font = `${this.fontSize} ${this.fontFamily}`;\n            flattenTxtElem.forEach(element => {\n                if(element.type === 'text' && element.dirty) {\n                    element.width = ctx.measureText(element.source).width;\n                    element.dirty = false;\n                }\n            });\n        });\n        const nextArea = new Area();\n        nextArea.truncate({\n            height: lineHeight,\n        });\n        let line = nextArea.get(0);\n        let allHeight = 0;\n        let allWidth = 0;\n        let lastElem = null;\n        const lineSpace = this.lineSpace;\n        const elementSpace = this.elementSpace;\n        flattenTxtElem.forEach(element => {\n            line.push(element);\n            element.reduceWidth = line.width;\n            if(element.type === 'text') {\n                element.height = lineHeight;\n                line.width += element.width;\n                if(element.needWrap){\n                    allHeight += (line.height + lineSpace);\n                    line.reduceHeight = allHeight;\n                    allWidth = Math.max(line.width, allWidth);\n                    line = Line.create({\n                        height: lineHeight,\n                    });\n                    nextArea.push(line);\n                }\n            } else {\n                const node = jflow.getRenderNodeBySource(element.source);\n                element.height = node.height;\n                line.height = Math.max(line.height, node.height);\n                const margin = (!lastElem || lastElem.type === 'text') ? elementSpace*2 : elementSpace;\n                line.width += node.width+margin;\n            }\n            lastElem = element;\n        });\n\n        flattenTxtElem.tail().isTail = true;\n        allHeight += line.height\n        line.reduceHeight = allHeight;\n        allWidth = Math.max(this.minWidth, Math.max(line.width, allWidth));\n        \n        const hh = allHeight/2;\n        const hw = allWidth/2;\n        let ty = -hh;\n        let lastReduceY = 0;\n\n        nextArea.forEach(l => {\n            const { height, reduceHeight } = l;\n            const anchorY = ty + lastReduceY + height / 2;\n            l.anchorY = anchorY;\n            let reduceX = -hw;\n            let lastel = null;\n            l.forEach(el => {\n                if(el.type === 'text') {\n                    el.anchorY = anchorY;\n                    el.anchorX = reduceX + el.width/2;\n                    reduceX += el.width;\n                } else {\n                    const renderNode = jflow.getRenderNodeBySource(el.source);\n                    const doubleMargin = (!lastel || lastel.type === 'text');\n                    const margin = doubleMargin ? elementSpace*2 : elementSpace;\n                    el.width = renderNode.width;\n                    el.anchorY = anchorY;\n                    el.anchorX = reduceX + el.width/2 + (doubleMargin ? margin/2 : 0);\n                    renderNode.anchor = [el.anchorX, el.anchorY];\n                    reduceX += (el.width + margin);\n                }\n                lastel = el;\n            })\n            lastReduceY = reduceHeight;\n        });\n        this._area = nextArea;\n        this.width = allWidth;\n        this.height = allHeight;\n    }\n})\nexport default TextGroup;\n","import Rectangle from './shapes/rectangle';\nimport { DIRECTION } from '../utils/constance';\nimport { requestCacheCanvas } from '../utils/canvas';\nimport JFlowEvent from '../events';\nfunction createInputElement() {\n    const input = document.createElement('span');\n    input.setAttribute('contenteditable', true);\n    input.setAttribute('class', 'jfloweditablespan')\n    input.setAttribute('style',`\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        background-image:none;\n        background-color:transparent;\n        -webkit-box-shadow: none;\n        -moz-box-shadow: none;\n        box-shadow: none;`);\n    return input;\n}\n\nexport function createInputTextStyle() {\n    const css = `.jfloweditablespan[contenteditable=true]:empty:before{\n        content: attr(placeholder);\n        opacity: 0.5;\n        pointer-events: none;\n        display: block; \n      }`;\n    const head = document.head || document.getElementsByTagName('head')[0];\n    const style = document.createElement('style');\n\n    head.appendChild(style);\n    style.type = 'text/css';\n    if (style.styleSheet){\n        // This is required for IE8 and below.\n        style.styleSheet.cssText = css;\n    } else {\n        style.appendChild(document.createTextNode(css));\n    }\n}\n/**\n * 文字对齐方式\n * @readonly\n * @enum {string}\n */\nconst TEXT_ALIGN = {\n    CENTER: 'center',\n    LEFT: 'left',\n    RIGHT: 'right',\n};\n/**\n * 文字单元 配置\n * @typedef {Rectangle~RectangleConfigs} Text~TextConfigs\n * @property {String} fontFamily    - 字体\n * @property {Number} fontSize      - 字号\n * @property {String} content       - 内容\n * @property {String} textColor     - 字体颜色\n * @property {TEXT_ALIGN} textAlign     - 文字对齐方式\n * @property {String} backgroundColor     - 背景颜色\n * @property {number} lineHeight    - 行高\n * @property {number} indent        - 缩进\n * @property {Boolean} editable      - 是否可编辑\n * @property {number} minWidth      - 最小宽度\n * @property {string} placeholder   - 占位文字\n * @property {Boolean} emptyWhenInput - 输入状态时是否清空input框\n */\n/**\n * 文字对象\n * @description 可以绘制文字\n * @constructor Text\n * @extends Rectangle\n * @param {Text~TextConfigs} configs - 配置\n */\nclass Text extends Rectangle {\n    constructor(configs) {\n        super(configs);\n        this.type =             'Text';\n        /** @member {String}      - 内容 */\n        this.content =          configs.content || '';\n        /** @member {String}      - 字体 */\n        this.fontFamily =       configs.fontFamily || '-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji'\n        /** @member {String}      - 字号 */\n        this.fontSize =         configs.fontSize || '28px';\n        /** @member {String}      - 字体 */\n        this.fontWeight =       configs.fontWeight || '';\n        /** @member {String}      - 字体颜色 */\n        this.textColor =        configs.textColor || 'white';\n        this.placeholderColor = configs.placeholderColor ||  configs.textColor || 'white';\n        /** @member {String}      - 文字对齐方式 */\n        this.textAlign =        configs.textAlign || TEXT_ALIGN.CENTER;\n        /** @member {String}      - 文字基线方式 */\n        this.textBaseline =     configs.textBaseline || 'middle';\n        /** @member {Number}      - 行高 */\n        this.lineHeight =       configs.lineHeight ;\n        /** @member {Number}      - 缩进 */\n        this.indent =           configs.indent || 0;\n        this.backgroundColor =  configs.backgroundColor;\n        /** @member {Boolean}      - 是否可编辑 */\n        this.editable =         configs.editable;\n        // this.acceptPatten =     configs.acceptPatten;\n        /** @member {number}      - 最小宽度 */\n        this.minWidth =         configs.minWidth || 0;\n        this.maxWidth =         configs.maxWidth;\n        this.ellipsis =         configs.ellipsis;\n\n        this.placeholder =          configs.placeholder || '';\n        this.emptyWhenInput =       configs.emptyWhenInput || false;\n        this.editting =  false;\n        this.disabled =        configs.disabled;\n        this.textBuffer = document.createElement('canvas');\n        requestCacheCanvas((ctx) => {\n            this.renderShadowText(ctx);\n            this.cacheText();\n        });\n        this._makeEditable();\n    }\n\n    get currentContent() {\n        return this.content || this.placeholder;\n    }\n\n    get isEmpty() {\n        return !this.content;\n    }\n\n    cacheText() {\n        const scale = 4;\n        const textBuffer = this.textBuffer;\n        const { fontSize:fs, fontFamily, fontWeight } = this;\n        let content = this.currentContent;\n        if(this.ellipsisContent) {\n            content = this.ellipsisContent;\n        }\n        if(!content) {\n            this.cacheTextBounding = null;\n            return;\n        }\n        const fontSize = parseInt(fs);\n        const w = this._textWidth * scale;\n        const h = fontSize * scale;\n        textBuffer.width = w;\n        textBuffer.height = h\n        const ctx = textBuffer.getContext('2d');\n        ctx.clearRect(-1000, -1000, 10000, 10000);\n        ctx.fillStyle = this.textColor;\n        ctx.font = `${fontWeight} ${h}px ${fontFamily}`;\n        ctx.textBaseline = 'middle';\n        ctx.fillText(content, 0, h/2);\n        this.cacheTextBounding = [0, 0, w, h];\n    }\n    _renderCache(ctx) {\n        if(!this.cacheTextBounding) {\n            return;\n        }\n        const [a, b, c, d] = this.cacheTextBounding;\n        const w = this._textWidth;\n        const h = parseInt(this.fontSize);\n        if(this.textAlign === TEXT_ALIGN.LEFT){\n            const hw = this.width / 2;\n            ctx.drawImage(this.textBuffer, \n                a, b, c, d,\n                this.anchor[0] - hw + this.indent / 2, this.anchor[1] - h/2, w, h);\n        } else if(this.textAlign === TEXT_ALIGN.RIGHT) {\n            const hw = this.width / 2;\n            const tx = this._textWidth;\n            ctx.drawImage(this.textBuffer, \n                a, b, c, d,\n                this.anchor[0] + hw - tx, this.anchor[1] - h/2, w, h);\n        } else {\n            const tx = this._textWidth / 2;\n            ctx.drawImage(this.textBuffer, \n                a, b, c, d,\n                this.anchor[0] - tx + this.indent / 2, this.anchor[1] - h/2, w, h);\n        }\n        \n    }\n\n    /**\n     * 编辑态\n     */\n    _makeEditable() {\n        if(this.editable) {\n            this.addEventListener('click', (event) => {\n                event.detail.bubbles = false;\n                this.click();\n            })\n        }\n    }\n\n    calculateInputElementPos() {\n        let x;\n        const hw = this.width / 2;\n        const _height = this.height * 1.15;\n        if(this.textAlign === TEXT_ALIGN.LEFT){\n            x = this.anchor[0] - hw + this.indent / 2;\n        } else if(this.textAlign === TEXT_ALIGN.RIGHT) {\n            x = this.anchor[0] + hw;\n        } else {\n            x = this.anchor[0] + this.indent / 2;\n        }\n\n        const p = [ x, this.anchor[1]-_height/2 ];\n\n        return this.calculateToRealWorld(p)\n    }\n\n    click() {\n        if(this.disabled || !this.editable) {\n            return;\n        }\n       \n        const _height = this.height * 1.15;\n        const size = this.calculateToRealWorldWithScalar(_height);\n        const fontSize = +/(\\d+)/.exec(this.fontSize)[1];\n\n        const [offsetX, offsetY] = this.calculateInputElementPos();\n        let inputElement = createInputElement();\n        const jflow = this._jflow;\n        const wrapper = jflow.DOMwrapper;\n        let oldVal = this.content;\n        let textColor = this.textColor;\n        inputElement.setAttribute('placeholder', this.placeholder);\n        inputElement.style.margin = 0;\n        inputElement.style.padding = 0;\n        inputElement.style.transform =`translate(${offsetX}px, ${offsetY}px)`;\n        \n        // inputElement.style.width = this.calculateToRealWorldWithScalar(this.width) + 'px';\n        inputElement.style.height =  size+ 'px';\n        inputElement.style.fontFamily = this.fontFamily;\n        wrapper.style.fontSize = `${fontSize * jflow.scale}px`;\n        // inputElement.style.letterSpacing = jflow.scale;\n        inputElement.style.fontSize = `${fontSize * jflow.scale}px`;\n        inputElement.style.lineHeight = `${this.lineHeight * jflow.scale}px`;\n        inputElement.style.textIndent = `${this.indent * jflow.scale}px`;\n        inputElement.innerText = this.emptyWhenInput ? '' : this.content;\n        inputElement.style.color = this.textColor;\n        inputElement.style.whiteSpace = 'nowrap';\n        inputElement.style.outline = \"none\";\n        inputElement.style.paddingRight = '1em';\n        inputElement.style.letterSpacing = `${(1.414 + 0.181) / (1 + Math.pow(jflow.scale / 1.81, -3.56) ) - 0.181}px`;\n        inputElement.setAttribute('placeholder', this.placeholder);\n\n        // inputElement.addEventListener(\"focus\",  (e) => {\n        //     // e.preventDefault();\n        //     // this.content = '';\n            \n            \n        // });\n        let blurHandler = () => {\n            this.editting = false;\n            this.dispatchEvent(new JFlowEvent('blur', {\n                target: this,\n            }))\n            const val = inputElement.innerText;\n            /**\n                * 文字改变事件\n                * @event Text#change\n                * @type {object}\n                * @property {Text} target           - 当前文字对象\n                * @property {String} oldVal         - 原始文字\n                * @property {String} val            - 当前文字\n                */\n            this.dispatchEvent(new JFlowEvent('change', {\n                target: this,\n                oldVal,\n                val,\n            }))\n            this.textColor = textColor;\n            if(this._belongs.recalculateUp) {\n                this._belongs.recalculateUp()\n            }\n            // this.content = oldVal;\n            jflow._render();\n            jflow.removeEventListener('zoompan', blurHandler)\n            inputElement.removeEventListener('focusout', blurHandler)\n            inputElement.removeEventListener('keypress', keyUpHandler)\n            wrapper.removeChild(inputElement);\n            inputElement = null;\n            blurHandler = null;\n            this.inputElement = null;\n        };\n        jflow.addEventListener('zoompan', blurHandler);\n        inputElement.addEventListener('focusout', blurHandler);\n        const keyUpHandler = (e) => {\n            if (e.key === 'Enter' || e.keyCode === 13) {\n                e.preventDefault();\n                let defaultAct = true;\n                this.dispatchEvent(new JFlowEvent('enterkeypressed', {\n                    target: this,\n                    handler: (val) => {\n                        defaultAct = val;\n                    },\n                }))\n                if(defaultAct){\n                    inputElement.removeEventListener('keypress', keyUpHandler)\n                    blurHandler();\n                }\n            }\n        };\n        inputElement.addEventListener('keypress', keyUpHandler)\n        inputElement.addEventListener('input', (e) => {\n            // let changed = false;\n            const val = inputElement.innerText;\n            this.dispatchEvent(new JFlowEvent('input', {\n                target: this,\n                oldVal,\n                val,\n                // handler(val) {\n                //     oldVal = val;\n                //     inputElement.innerText = val;\n                //     changed = true;\n                // }\n            }));\n            requestCacheCanvas((ctx) => {\n                this.content = inputElement.innerText;\n                this.renderShadowText(ctx);\n            });\n            if(this._belongs.recalculateUp) {\n                this._belongs.recalculateUp()\n            }\n            const [offsetX, offsetY] = this.calculateInputElementPos();\n            inputElement.style.transform =`translate(${offsetX}px, ${offsetY}px)`;\n            \n            this._jflow.scheduleRender();\n            // inputElement.style.width = e.target.value.length + \"em\";\n            // if(!changed) {\n            //     oldVal = inputElement.innerText;\n            // }\n        })\n        this.textColor = 'transparent'\n        this.editting = true;\n        jflow._render();\n        wrapper.append(inputElement);\n        inputElement.focus({\n            preventScroll: true\n        });\n        if(inputElement.firstChild) {\n            const range = document.createRange()\n            const sel = window.getSelection()\n            \n            range.setStart(inputElement.firstChild, inputElement.innerText.length)\n            range.collapse(true)\n            \n            sel.removeAllRanges()\n            sel.addRange(range)\n        }\n        \n        this.inputElement = inputElement;\n        inputElement._jflowInstance = this;\n    }\n\n    renderShadowText(ctx) {\n        ctx.beginPath();\n        ctx.font = `${this.fontSize} ${this.fontFamily}`;\n        ctx.textAlign = this.textAlign;\n        ctx.textBaseline = this.textBaseline;\n        ctx.fillStyle = this.textColor;\n        const t_h = parseInt(this.fontSize);\n        const content = this.currentContent;\n        const {\n            // actualBoundingBoxLeft,\n            // actualBoundingBoxRight,\n            fontBoundingBoxAscent,\n            fontBoundingBoxDescent,\n            width,\n        } = ctx.measureText(content);\n        this._textWidth = this.indent + width;\n        if(this.maxWidth && this.ellipsis) {\n            if(this._textWidth > this.maxWidth) {\n                const ratio =this.maxWidth / this._textWidth;\n                const l = Math.floor(content.length * ratio - 3);\n                this.ellipsisContent = content.substring(0, l) + '...'; \n            }  else {\n                this.ellipsisContent = content;\n            }\n            this.width = this.maxWidth;\n        } else{ \n            this.width = Math.max(this.minWidth, this._textWidth);\n        }\n        \n        const height = (Math.abs(fontBoundingBoxAscent) + Math.abs(fontBoundingBoxDescent)) || t_h;\n        if(this.lineHeight) {\n            this.height = this.lineHeight;\n        } else {\n            this.height = height;\n        }\n\n    }\n\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                // if(this.editting && k === 'content') {\n                //     return;\n                // }\n                this[k] = configs[k];\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n        requestCacheCanvas((ctx) => {\n            this.renderShadowText(ctx);\n            this.cacheText();\n        });\n    }\n\n    render(ctx) {\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        if(this.editting) {\n            return;\n        }\n        if(!ctx.disableCache && this._jflow.scale * parseInt(this.fontSize) < 8) {\n            this._renderCache(ctx);\n            return;\n        }\n        ctx.beginPath();\n        \n        ctx.font = `${this.fontWeight} ${this.fontSize} ${this.fontFamily}`;\n        ctx.textAlign = this.textAlign;\n        ctx.textBaseline = this.textBaseline;\n        ctx.fillStyle = this.isEmpty ? this.placeholderColor : this.textColor;\n        let content = this.currentContent;\n        if(this.ellipsisContent) {\n            content = this.ellipsisContent;\n        }\n        if(content) {\n            if(this.textAlign === TEXT_ALIGN.LEFT){\n                const hw = this.width / 2;\n                ctx.fillText(content, this.anchor[0] - hw + this.indent / 2, this.anchor[1]);\n            } else if(this.textAlign === TEXT_ALIGN.RIGHT) {\n                const hw = this.width / 2;\n                ctx.fillText(content, this.anchor[0] + hw, this.anchor[1]);\n            } else {\n                ctx.fillText(content, this.anchor[0] + this.indent / 2, this.anchor[1]);\n            }\n        }\n    }\n}\n\nexport default Text;","import { createCanvas, resizeCanvas, listenOnDevicePixelRatio } from '../utils/canvas';\nimport { bounding_box, doOverlap, debounce } from '../utils/functions';\nimport { JFLOW_MODE } from '../utils/constance';\nimport GhostNode from '../instance/ghostNode';\nimport { NodeWeakMapMixin } from '../instance/nodeWeakMap';\nimport StackMixin from '../instance/stackMixin';\nimport LayoutMixin from '../instance/layoutMixin';\nimport MessageMixin from '../instance/messageMixin';\nimport AnimeMixin from '../anime/animeMixin';\nimport MiniMapMixin from '../miniMap/minimap-mixin';\nimport ScrollBarMixin from '../scrollbar/scrollbarMixin';\nimport ScheduleMixin from './schedule';\n// import { setUniqueId, getUniqueId } from '../utils/functions';\nimport JFlowEvent from '../events';\n\nimport EventAdapter from '../events/adapter';\n\nimport GroupFactory from '../instance/groupFactory';\nimport Point from '../instance/shapes/point';\nimport Rectangle from '../instance/shapes/rectangle';\nimport Capsule from '../instance/shapes/capsule';\nimport CapsuleVertical from '../instance/shapes/capsule-vertical';\nimport Rhombus from '../instance/shapes/rhombus';\nimport Diamond from '../instance/shapes/diamond';\nimport DiamondVertical from '../instance/shapes/diamond-vertical';\nimport { createInputTextStyle } from '../instance/text';\ncreateInputTextStyle();\n/**\n * @funtion setInitialPosition\n * @param {Number} RealboxX - 内容映射到canvas上的 X\n * @param {Number} RealboxY - 内容映射到canvas上的 Y \n * @param {Number} RealboxW - 内容映射到canvas上的宽度\n * @param {Number} RealboxH - 内容映射到canvas上的高度 \n * @param {Number} CanvasWidth  - 视窗宽度\n * @param {Number} CanvasHeight  - 视窗高度\n * @return {Object} - 初始位置 { x, y }\n */\n\n/**\n * @funtion linkGen\n * @param {Node} from - 出发绘图节点\n * @param {Node} to - 临时节点，当前鼠标指的地方\n * @return {BaseeLink} - 连线对象\n */\n\n\n/** \n * @class Group\n * @classdesc 矩形组单元 由 {@link GroupFactory} 通过 {@link Rectangle} 生成\n * @groupfrom Rectangle\n * @augments GroupTemplate\n * @augments Rectangle\n * @param {(Rectangle~RectangleConfigs|GroupTemplate~GroupConfigs)} configs - 配置\n */\nexport const Group = GroupFactory(Rectangle);\n/** \n * @class CapsuleGroup\n * @classdesc 胶囊组单元 由 {@link GroupFactory} 通过 {@link Capsule} 生成\n * @groupfrom Capsule\n * @augments GroupTemplate\n * @augments Capsule\n * @param {(Capsule~CapsuleConfigs|GroupTemplate~GroupConfigs)} configs - 配置\n */\nexport const CapsuleGroup = GroupFactory(Capsule);\n/** \n * @class RhombusGroup\n * @classdesc 菱形组单元 由 {@link GroupFactory} 通过 {@link Rhombus} 生成\n * @augments GroupTemplate\n * @augments Rhombus\n * @groupfrom Rhombus\n * @param {(Rhombus~RhombusConfigs|GroupTemplate~GroupConfigs)} configs - 配置\n */\nexport const RhombusGroup = GroupFactory(Rhombus);\n/** \n * @class DiamondGroup\n * @classdesc 钻石形组单元 由 {@link GroupFactory} 通过 {@link Diamond} 生成\n * @groupfrom Diamond\n * @augments GroupTemplate\n * @augments Diamond\n * @param {(Diamond~DiamondConfigs|GroupTemplate~GroupConfigs)} configs - 配置\n */\nexport const DiamondGroup = GroupFactory(Diamond, {\n    shapeShift(width, height) {\n        return [width + height * 0.28865, height]\n    }\n});\n/** \n * @class DiamondVerticalGroup\n * @classdesc 垂直钻石形组单元 由 {@link GroupFactory} 通过 {@link DiamondVertical} 生成\n * @groupfrom DiamondVertical\n * @augments GroupTemplate\n * @augments DiamondVertical\n * @param {(Diamond~DiamondConfigs|GroupTemplate~GroupConfigs)} configs - 配置\n */\nexport const DiamondVerticalGroup = GroupFactory(DiamondVertical, {\n    shapeShift(width, height) {\n        return [width, height + width * 0.5773]\n    }\n});\n/** \n * @class CapsuleVerticalGroup\n * @classdesc 垂直钻石形组单元 由 {@link GroupFactory} 通过 {@link CapsuleVertical} 生成\n * @groupfrom CapsuleVertical\n * @augments GroupTemplate\n * @augments CapsuleVertical\n * @param {(Capsule~CapsuleConfigs|GroupTemplate~GroupConfigs)} configs - 配置\n */\nexport const CapsuleVerticalGroup = GroupFactory(CapsuleVertical);\n\nexport const PointGroup = GroupFactory(Point, {\n    shapeShift(width, height, p) {\n        const r = Math.ceil(Math.sqrt(width * width + height * height) / 2);\n        p.radius = r;\n        const w = r * 2;\n        return [w, w];\n    }\n});\n\nexport { default as ScrollGroup } from '../instance/groups/scroll-group'; \n/**\n * @typedef JFlow~JFlowConfigs\n * @type {object}\n * @property {Boolean} allowDrop      - 是否允许 dragdrop\n * @property {Number} maxZoom         - 最大缩放\n * @property {Number} minZoom         - 最小缩放\n * @property {number} initialZoom     - 初始缩放比\n * @property {EventAdapter~pluginDef} eventAdapter\n */\n\n/**\n * @typedef {JFlow~JFlowConfigs | LayoutMixin~LayoutConfigs} JFlow~JFlowLayoutConfigs\n */\n/** \n * JFlow 对象\n * JFlow 是 canvas 上面封装的一个顶层对象，具有处理事件和绘制的功能\n * @constructor JFlow\n * @param {JFlow~JFlowLayoutConfigs} configs - 配置项\n * @mixes LayoutMixin\n * @mixes StackMixin\n * @mixes MessageMixin\n */\nclass JFlow extends EventTarget{\n    constructor(configs) {\n        super();\n        this.uniqueName = 'jflow';\n        /**\n         * @member {EventAdapter} eventAdapter    - eventAdapter 对象\n         **/\n        this.eventAdapter = new EventAdapter(configs.eventAdapter);\n        this.initNodeWeakMap();\n        this.initAnime();\n        this.initStack(configs);\n        this.initLayout(configs);\n        /** @member {Context2d}     - Context2d 对象 */\n        this.ctx = null;\n        /** @member {Element}       - canvas 元素 */\n        this.canvas = null;\n        /** @member {number}       - 设备DPR */\n        this.dpr = 1;\n        /** @member {number}       - 内边距 */\n        this.padding = 20;\n        this.position = null;\n        /** @member {number}     - 缩放 */\n\t\tthis.scale = null;\n        /** @member {number}     - 初始缩放 */\n        this.initialZoom = configs.initialZoom;\n        /** @member {setInitialPosition} - 初始位置计算 */\n        this.initialPosition = configs.setInitialPosition;\n        /** @member {number}     - 最大缩放 */\n        this.maxZoom = configs.maxZoom || 3;\n        /** @member {number}     - 最小缩放 */\n        this.minZoom = configs.minZoom || .5;\n        \n        this.NodeRenderTop = !!configs.NodeRenderTop\n\n        this.worldMargin = configs.worldMargin;\n\n        this.draggingbehavior = Object.assign({\n            panInBorder: {\n                enable: true,\n                padding: 20,\n                deltamovement: 8,\n                allowMovingTargetInPan: true,\n            },\n        }, configs.draggingbehavior || {});\n        this.scrollBarBehavior = Object.assign({\n            enable: true,\n        }, configs.scrollBarBehavior || {})\n\t\t// this.initScale = 1;\n\t\t// this.initPosition = null\n\t\tthis.offeset = null;\n        this._lastState = {\n            x: null,\n            y: null,\n            dragging: false,\n            processing: false\n        };\n        this._lastDragState = {\n            target: null,\n            targetLink: null,\n            processing: false,\n        }\n\n        this._target = {\n            instance: null,\n            link: null,\n            moving: null,\n            isInstanceDirty: false, \n            isLinkDirty: false, \n            // isMovingDirty: false, \n            cache: {\n                stack: null,\n                belongs: null,\n                point: null,\n            },\n            meta: {\n                x: undefined,\n                y: undefined,\n                initialX: undefined,\n                initialY: undefined, \n            },\n            status: {\n                dragovering: false,\n                dragging: false,\n                processing: false,\n                movingState: false,\n            }\n        }\n\n        this._focus = {\n            instance: null,\n        }\n\n        this._dragOverTarget = null;\n        // this.lock = configs.lock;\n\n        this.allowDrop = configs.allowDrop;\n        // 临时绘制的对象\n        this._tempNode = null;\n        this._tempLink = null;\n\n        this.mode = JFLOW_MODE.DEFAULT;\n\n        this._allowMovingTarget = true;\n\n        this.canvasMeta = {}\n\n        this._cacheViewBox = []\n\n        // this._allowZoom = true;\n    }\n\n    // allowZoom() {\n    //     this._allowZoom = true;\n    // }\n\n    // abandonZoom() {\n    //     this._allowZoom = false;\n    // }\n    /**\n     * 设置当前拖动的 JFlow 对象\n     * @param {Object[]} targets - 具有 anchor 属性的对象\n     */\n    setMovingTargets(targets) {\n        Object.assign(this._target, {\n            moving: targets,       \n        })\n    }\n\n    /**\n     * 设置当前拖动的 JFlow 对象\n     * @param {Instance} instance - JFlow 对象\n     */\n    setTempDraggingInstance(instance) {\n        instance._belongs = this;\n        this._tempNode = instance;\n        Object.assign(this._target, {\n            moving: [this._tempNode],\n            dragging: true,\n        })\n    }\n\n    /**\n     * 取消当前拖动的 JFlow 对象\n     * @return {number[]} point - JFlow 坐标\n     */\n    removeTempDraggingInstance() {\n        if(this._tempNode) {\n            // this.removeFromStack(this._tempNode);\n            const anchor = this._tempNode.anchor;\n            this._tempNode = null;\n            return anchor;\n        }\n    }\n    /**\n     * 关闭默认对象拖动效果\n     */\n    preventDefaultDragging() {\n        this._allowMovingTarget = false;\n    }\n    /**\n     * 开启默认对象拖动效果\n     */\n    allowDefaultDragging() {\n        this._allowMovingTarget = true;\n    }\n    /**\n     * 在 Document 元素上初始化实例\n     * @param {Element} dom \n     */\n    $mount(dom) {\n        const { \n            canvas, \n            ctx, \n            scale: dpr, \n            width: c_width, \n            height: c_height, \n            raw_width,\n            raw_height,\n            left, top \n        } = createCanvas(dom);\n        this.reflow();\n        this.ctx = ctx //new CanvasContext2d(ctx, dpr);\n        this.DOMwrapper = dom;\n        this.canvas = canvas;\n        this.canvas.setAttribute('data-jflow', true);\n        this.canvas.$jflow = this;\n        this.canvasMeta = {\n            width: raw_width,\n            height: raw_height,\n            actual_width: c_width,\n            actual_height: c_height\n        }\n        this.dpr = dpr;\n        \n        this._getBoundingGroupRect();\n\n        const padding = this.padding;\n        const { width: p_width, height: p_height, x: p_x, y: p_y } = this.bounding_box;\n        const contentBox = {\n            x: padding,\n            y: padding,\n            width: c_width - padding * 2,\n            height: c_height - padding * 2,\n        }\n        const position = { x: 0, y: 0, offsetX: 0, offsetY: 0 };\n        const w_ratio = contentBox.width / p_width;\n        const h_ratio = contentBox.height / p_height;\n        const align = w_ratio <= h_ratio ? 'x' : 'y';\n        let scaleRatio;\n        if(this.initialZoom) {\n            scaleRatio = this.initialZoom;\n        } else {\n            scaleRatio = Math.min(w_ratio, h_ratio);\n        }\n       \n        this.scale = scaleRatio;\n        if(scaleRatio > this.maxZoom) {\n            this.maxZoom = scaleRatio;\n        }\n        if(scaleRatio < this.minZoom) {\n            this.minZoom = scaleRatio;\n        }\n        const realboxX = p_x * scaleRatio;\n        const realboxY = p_y * scaleRatio;\n        const realboxW = contentBox.width;\n        const realboxH = contentBox.height;\n        if(this.initialPosition) {\n            const { x, y } = this.initialPosition(realboxX, realboxY, realboxW, realboxH, contentBox.x, contentBox.y, c_width, c_height, p_x, p_y, p_width, p_height);\n            position.x = x;\n            position.y = y;\n        } else {\n            position.x = align === 'x' ? contentBox.x : (realboxW - p_width * scaleRatio) / 2 + padding\n            position.y = align === 'y' ? contentBox.y : (realboxH - p_height * scaleRatio) / 2 + padding\n        }\n        \n        position.offsetX = position.x - realboxX;\n        position.offsetY = position.y - realboxY;\n        this.position = position;\n        this._readyToRender = true;\n        if(this.scrollBarBehavior.enable) {\n            this.initScrollBar(this.scrollBarBehavior);\n        }\n        // this.initSchedule();\n        // this.scheduleRender(() => {\n        //     this._createEventHandler();\n        // });\n        this.__render();\n        this._createEventHandler();\n        \n        listenOnDevicePixelRatio((dpr) => {\n            this.dpr = dpr;\n            // this.ctx.setDPR(dpr)\n            this.resizeCanvas();\n            this.scheduleRender();\n        }, (handler) => {\n            this.destroyDprListener = handler;\n        });\n        \n    }\n\n    /**\n     * 设置Jflow进入连线模式\n     * @param {Object} source - 当前连线的出发原始数据\n     * @param {linkGen} linkGen - 生成连线单元的方法\n     */\n    setLinkingMode(source, linkGen, isTail) {\n        const renderNode = this.getRenderNodeBySource(source)\n        this._tempNode = new GhostNode();\n        if(isTail) {\n            this._tempLink = linkGen({\n                from: this._tempNode,\n                to: renderNode,\n            })\n        } else {\n            this._tempLink = linkGen({\n                from: renderNode,\n                to: this._tempNode,\n            })\n        }\n        \n        this.sendMessage({\n            instance: source\n        });\n        this.mode = JFLOW_MODE.LINKING;\n    }\n\n    isInLinkingMode() {\n        return this.mode === JFLOW_MODE.LINKING;\n    }\n\n    /**\n     * 连线模式下，设置当前临时连线的属性\n     * @param {BaseLink~Configs} configs - 当前连线的出发原始数据\n     */\n    setLinkingLink(configs) {\n        if(this.mode === JFLOW_MODE.LINKING) {\n            this._tempLink.setConfig(configs);\n        }\n    }\n    /**\n     * 连线模式下，重连回临时鼠标节点\n     */\n    resetLinkingLink() {\n        if(this.mode === JFLOW_MODE.LINKING) {\n            this._tempLink.setConfig({\n                to: this._tempNode\n            })\n        }\n    }\n\n    clearTemp() {\n        if(this._tempNode) {\n            this._tempNode.destroy();\n            this._tempNode = null;\n        }\n        if(this._tempLink) {\n            this._tempLink.destroy();\n            this._tempLink = null;\n        }\n        this._render();\n    }\n\n    preventClearTemp() {\n        this._preventClearTemp = true;\n    }\n\n    /**\n     * 外层容器大小变化后，调用此方法可以改变当前canvas的状态\n     */\n    resizeCanvas() {\n        if(this.canvas && this.DOMwrapper) {\n            const {\n                width: c_width, \n                height: c_height, \n                raw_width,\n                raw_height,\n            } = resizeCanvas(this.canvas, this.DOMwrapper);\n            this.canvasMeta = {\n                width: raw_width,\n                height: raw_height,\n                actual_width: c_width,\n                actual_height: c_height\n            }\n        }\n    }\n\n    setFocusInstance(node) {\n        this._focus.instance = node;\n    }\n\n    /**\n     * 移动画布到以目标绘图节点为中心的位置上\n     * @param {Node} node - 绘图节点\n     */\n    focusOn(node) {\n        const center = this._calculatePointBack([\n            this.canvasMeta.actual_width/2,\n            this.canvasMeta.actual_height/2\n        ]);\n        let offset = node.anchor;\n        if(node._belongs.calculateToCoordination) {\n            offset = node._belongs.calculateToCoordination(offset);\n        }\n\n        const deltaX = (center[0] - offset[0]) * this.scale;\n        const deltaY = (center[1] - offset[1]) * this.scale;\n        \n\n        this._recalculatePosition(deltaX, deltaY)\n        this._render();\n    }\n    \n    _getBoundingGroupRect() {\n        const points = this._stack.getBoundingRectPoints();\n        if(this.bounding_box) {\n            this.bounding_box = bounding_box(points);\n            const {\n                x: nowx,\n                y: nowy,\n            } = this.bounding_box;\n            const scale = this.scale;\n            this.position.x = this.position.offsetX + nowx * scale;\n            this.position.y = this.position.offsetY + nowy * scale;\n        } else {\n            this.bounding_box = bounding_box(points);\n        }\n    }\n\n    _createEventHandler() { \n        const canvas = this.canvas;\n        let destroyListener;\n        this.eventAdapter.apply(this);\n        const destroyPlainEventListener = () => {\n            this.eventAdapter.unload(this);\n            this.destroyDprListener();\n        }\n        destroyListener = destroyPlainEventListener;\n\n        if(this.allowDrop) {\n            const dragoverHandler = this._onDragover.bind(this);\n            const dropHandler = this._onDrop.bind(this);\n            const dragleaveHanlder = this._onDragLeave.bind(this);\n            canvas.addEventListener('dragstart', (e) => {\n                e.preventDefault()\n            })\n            canvas.addEventListener('dragover', dragoverHandler);\n            canvas.addEventListener('drop', dropHandler);\n            canvas.addEventListener('dragleave', dragleaveHanlder);\n            destroyListener = () => {\n                destroyPlainEventListener();\n                canvas.removeEventListener('dragover', dragoverHandler);\n                canvas.removeEventListener('drop', dropHandler);\n                canvas.removeEventListener('dragleave', dragleaveHanlder);\n            }\n        } \n        this.destroy = destroyListener;\n    }\n\n    _targetLockOn(offsetPoint, event) {\n        let point = this._calculatePointBack(offsetPoint);\n        const topLayerPoint = point;\n        this._currentp = point;\n        let stack = this._stack;\n        const br = this._getViewBox();\n        const target = stack.checkHit(\n            point, \n            // 应用于所有\n            (instance) => {\n                return (this._target.status.dragging \n                    && (instance === this._getMovingTarget()))\n            },\n            // 仅对于本层过滤\n            (instance) => {\n                return doOverlap(br, instance.getBoundingRect())\n            });\n        let linkStack = this._linkStack;\n        let belongs = this;\n        /*\n        if(target) {\n            linkStack = target._belongs._linkStack;\n            point = target._belongs._currentp;\n            stack = target._belongs._stack;\n            belongs = target._belongs\n        }*/\n        // 暂时设定只有顶层有连线\n        let targetLink;\n        if(!target || target._belongs === this) {\n            targetLink = linkStack.checkHit(point, (link) => {\n                if(!this._target.status.dragging) {\n                    return false;\n                }\n                const movingtarget = this._getMovingTarget();\n                return link.from === movingtarget || link.to === movingtarget;\n            });\n        }\n        if(!targetLink) {\n            targetLink = linkStack.checkHit(point, (link) => {\n                return !link.ON_TOP;\n            });\n        }\n        \n        Object.assign(this._target, {\n            instance: target,\n            link: targetLink, \n            isInstanceDirty: target === this._target.instance,\n            isLinkDirty: targetLink === this._target.link,\n        });\n        Object.assign(this._target.cache, {\n            stack,\n            belongs,\n            point,\n            topLayerPoint,\n        })\n        Object.assign(this._target.meta, {\n            x: offsetPoint[0],\n            y: offsetPoint[1],\n        });\n     \n        if(event === 'pressStart' && !this._target.status.dragging && !this._target.status.dragovering) {\n            let movingtarget = target;\n            while (movingtarget && movingtarget._belongs.lock && movingtarget !== this) {\n                movingtarget = movingtarget._belongs;\n            }\n            this.setMovingTargets(movingtarget && [ movingtarget ])\n            if(movingtarget) {\n                /**\n                 * \n                 * 开始拖拽时，拖拽对象设置之前\n                 * @event Node#afterResolveMovingTarget\n                 * @type {object}\n                 * @property {Event} event           - 原始事件 \n                 * @property {JFlow} jflow           - 当前JFlow对象 \n                 * @property {Node} target           - 目标节点\n                 */\n                target.bubbleEvent(new JFlowEvent('afterResolveMovingTarget', {\n                    event,\n                    target: movingtarget,\n                    jflow: this,\n                    bubbles: true,\n                }))\n            }\n        }\n        \n        if(['pressStart', 'click', 'dblclick', 'contextclick'].includes(event)) {\n            if(this._focus.instance && this._focus.instance !== target) {\n                this._focus.instance.dispatchEvent(new JFlowEvent('blur', {\n                    relatedTarget: target,\n                }));\n                this._focus.instance = null;\n            }   \n        }\n        return this._target;\n    }\n\n    blur() {\n        if(this._focus.instance) {\n            this._focus.instance.dispatchEvent(new JFlowEvent('blur', {\n                relatedTarget: null,\n            }));\n            this._focus.instance = null;\n        }  \n    }\n\n    _getMovingTarget() {\n        return this._target.moving && this._target.moving[0];\n    }\n\n    _processDragOver(instance, event) {\n        if(this._dragOverTarget !== instance) {\n            const target = this.readMessage()?.instance;\n            this._dragCurrentData = target;\n            const { point } = this._target.cache;\n            // console.log('_processDragOver', this._dragOverTarget)\n            if(this._dragOverTarget) {\n                const oldIns = this._dragOverTarget;\n                /**\n                * dragleave 退出事件\n                * @event Instance#dragleave\n                * @type {object}\n                * @property {Event} event           - 原始事件 \n                * @property {Object} instance       - dragleave的对象 \n                * @property {target} target         - drag 携带的对象（特指从外面拖进canvas的对象） \n                */\n                oldIns.dispatchEvent(new JFlowEvent('dragleave', {\n                    event,\n                    instance: oldIns,\n                    target,\n                    jflow: this,\n                    point,\n                }));\n            }\n            if(instance) {\n                /**\n                * dragenter 进入事件\n                * @event Instance#dragenter\n                * @type {object}\n                * @property {Event} event           - 原始事件 \n                * @property {Object} instance       - dragenter的对象 \n                * @property {target} target         - drag 携带的对象（特指从外面拖进canvas的对象） \n                */\n                instance.dispatchEvent(new JFlowEvent('dragenter', {\n                    event,\n                    instance,\n                    target,\n                    jflow: this,\n                    point\n                }));\n            }\n            this._dragOverTarget = instance;\n        } else if(this._dragOverTarget){\n            /**\n            * dragover 进入事件\n            * @event Instance#dragover\n            * @type {object}\n            * @property {Event} event           - 原始事件 \n            * @property {Object} instance       - dragover的对象 \n            * @property {target} target         - drag 携带的对象（特指从外面拖进canvas的对象） \n            */\n            this._dragOverTarget.dispatchEvent(new JFlowEvent('dragover', {\n                event,\n                instance,\n                jflow: this,\n                target: this._dragCurrentData,\n            }));\n        }\n\n        this._processPanInBorder();\n    }\n\n    _processPanInBorder() {\n        if(this.draggingbehavior?.panInBorder?.enable) {\n            if(!this.draggingbehavior.panInBorder.timer) {\n                this.draggingbehavior.panInBorder.timer = Date.now();\n            }\n            if(Date.now() - this.draggingbehavior.panInBorder.timer > 500) {\n                const [x, y, w, h] = this._cacheViewBox;\n                const [px, py] = this._currentp;\n                const {\n                    padding,\n                    deltamovement\n                } = this.draggingbehavior.panInBorder;\n                let deltaX = 0;\n                let deltaY = 0;\n                if(px < x + padding) {\n                    deltaX = deltamovement;\n                } \n                if(px > w - padding) {\n                    deltaX = -deltamovement;\n                } \n                if(py < y + padding) {\n                    deltaY = deltamovement;\n                } \n                if(py > h - padding) {\n                    deltaY = -deltamovement;\n                } \n                if(this.__processOverAnime) {\n                    this.__processOverAnime.cancel();\n                }\n                if(deltaX || deltaY) {\n                    this.__processOverAnime = this.requestJFlowAnime(() => {\n                        this.panHandler(deltaX, deltaY);\n                    }) \n                } else {\n                    this.draggingbehavior.panInBorder.timer = null;\n                }\n            }\n        }\n    }\n\n    _onDragover(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if(this._lastDragState.processing) return;\n        this._lastDragState.processing = true;\n        const { offsetX, offsetY } = event\n        Object.assign(this._target.status, {\n            dragovering: true,\n        })\n        this._targetLockOn([offsetX, offsetY])\n        const instance = this._target.instance || this._target.link;\n        this._processDragOver(instance, event);\n        if(this._target.isLinkDirty || this._target.isInstanceDirty) {\n            Promise.resolve().then(() => {\n                this._render();    \n                this._target.isLinkDirty = false; \n                this._target.isInstanceDirty = false;\n                this._lastDragState.processing = false;\n            })\n        } else {\n            this._lastDragState.processing = false;\n        } \n    }\n\n    _cancelPanInBorder() {\n        if(this.__processOverAnime) {\n            this.__processOverAnime.cancel();\n        }\n        if(this.draggingbehavior?.panInBorder) {\n            this.draggingbehavior.panInBorder.timer = null;\n        }\n    }\n\n    _onDragLeave() {\n        this._cancelPanInBorder();\n    }\n\n    _onDrop(event) {\n        this._cancelPanInBorder();\n        const payload = this.consumeMessage();\n        const instance = payload?.instance;\n        if(this._dragOverTarget) {\n            const oldIns = this._dragOverTarget;\n            oldIns.dispatchEvent(new JFlowEvent('dragoverend', {\n                event,\n                instance: oldIns,\n            }));\n            this._dragOverTarget = null;\n        }\n        const {\n            link,\n            instance: target,\n        } = this._target;\n        const {\n            point, belongs\n        } = this._target.cache;\n        if(link) {   \n            /**\n             * 丢在线上事件\n             *\n             * @event BaseLink#drop\n             * @type {object}\n             * @property {Event} event           - 原始事件 \n             * @property {Object} instance       - 拖动的对象 \n             * @property {BaseLink} link         - 目标连线 \n             * @property {JFlow} jflow           - 当前JFlow对象 \n             * @property {Group|JFlow} belongs   - 连线所在的绘图栈的对象\n             * @property {number[]} point        - 已经计算到绘图栈对应坐标系下的坐标\n             */\n            // instance.anchor = point;\n            link.dispatchEvent(new JFlowEvent('drop', {\n                event,\n                instance,\n                link,\n                jflow: this,\n                belongs,\n                point\n            }))\n        } else if(target) {\n            /**\n             * 丢在节点上事件\n             *\n             * @event Node#drop\n             * @type {object}\n             * @property {Event} event           - 原始事件 \n             * @property {Object} instance       - 拖动的对象 \n             * @property {JFlow} jflow           - 当前JFlow对象 \n             * @property {Node} target           - 目标节点\n             * @property {number[]} point        - 已经计算到绘图栈对应坐标系下的坐标\n             */\n            target.bubbleEvent(new JFlowEvent('drop', {\n                event,\n                instance,\n                jflow: this,\n                target,\n                point,\n                bubbles: true,\n            }));\n        } else {\n            /**\n            * 丢在主图上事件\n            *\n            * @event JFlow#drop\n            * @type {object}\n            * @property {Event} event           - 原始事件 \n            * @property {Object} instance       - 拖动的对象 \n            * @property {JFlow} jflow           - 当前JFlow对象 \n            * @property {number[]} point        - 已经计算到绘图栈对应坐标系下的坐标\n            */\n            this.dispatchEvent(new JFlowEvent('drop', {\n                event,\n                instance,\n                jflow: this,\n                target,\n                point,\n            }))\n        }\n        requestAnimationFrame(() => {\n            this.cancelDrop();\n        })\n    }\n    cancelDrop() {\n        this._target.instance = null;\n        this._target.link = null;\n        Object.assign(this._target.status, {\n            dragovering: false,\n        })\n    }\n    \n    /**\n     * 缩放操作处理函数\n     * @param {Number} offsetX - 事件对象与canvas的内填充边（padding edge）在 X 轴方向上的偏移量。\n     * @param {Number} offsetY - 事件对象与canvas的内填充边（padding edge）在 Y 轴方向上的偏移量。 \n     * @param {Number} deltaX  - 水平滚动量\n     * @param {Number} deltaY  - 垂直滚动量\n     * @param {Number} event - 原生事件\n     */\n    zoomHandler(offsetX, offsetY, deltaX, deltaY, event) {\n        // if(!this._allowZoom) return;\n        if(this._zooming) return;\n        this._zooming = true;\n        const { width: p_width, height: p_height, x, y } = this.bounding_box;\n        const { actual_width: cw, actual_height: ch } = this.canvasMeta;\n        let minZoom = this.minZoom;\n        if(this.worldMargin) {\n            const m = this.worldMargin;\n            const maxWidth = p_width + m * 2;\n            const maxHeight = p_height + m * 2;\n            minZoom = Math.max(minZoom, Math.max(cw / maxWidth, ch / maxHeight));\n        }\n        let newScale = this.scale;\n        const amount = deltaY > 0 ? 1.05 : 1 / 1.05;\n        newScale *= amount;\n        newScale = Math.min(this.maxZoom, Math.max(minZoom, newScale))\n        // console.log(newScale);\n        // if (this.maxZoom && newScale > this.maxZoom){\n        //     // could just return but then won't stop exactly at maxZoom\n        //     newScale = this.maxZoom;\n        // }\n\n        // if(this.minZoom && newScale < this.minZoom) {\n        //     newScale = this.minZoom;\n        // }\n\n        var deltaScale    = newScale - this.scale;\n        var currentWidth  = p_width * this.scale;\n        var currentHeight = p_height * this.scale;\n        var deltaWidth    = p_width * deltaScale;\n        var deltaHeight   = p_height * deltaScale;\n\n        var tX = offsetX - this.position.x;\n        var tY = offsetY - this.position.y;\n        var pX = -tX / currentWidth;\n        var pY = -tY / currentHeight;\n\n        this.scale = newScale;\n        this._recalculatePosition(pX * deltaWidth, pY * deltaHeight);\n        \n        // this.position.x += pX * deltaWidth;\n        // this.position.y += pY * deltaHeight;\n        // this.position.offsetX = this.position.x - x * newScale;\n        // this.position.offsetY = this.position.y - y * newScale;\n        this.dispatchEvent(new JFlowEvent('zoompan', {\n             deltaX: 0, deltaY: 0\n        }));\n        // this.setAnimeClock()\n        this.scheduleRender(() => {\n            this._zooming = false;\n        })\n        // requestAnimationFrame((timestamp) => {\n        //     this.setAnimeClock(timestamp);\n        //     this._render();\n        //     this._zooming = false;\n        // })\n    }\n    /**\n     * 平移画布操作处理函数\n     * @param {Number} deltaX  - 水平滚动量\n     * @param {Number} deltaY  - 垂直滚动量\n     * @param {Number} event - 原生事件\n     */\n    panHandler(deltaX, deltaY, event) {\n        if(this._panning) return;\n        this._panning = true;\n        const {\n            dragging,\n        } = this._target.status;\n        if(dragging) {\n            const movingtarget = this._target.moving;\n            if(movingtarget) {\n                if(this.draggingbehavior.panInBorder.allowMovingTargetInPan) {\n                    movingtarget.forEach(t => {\n                        t.anchor[0] += -deltaX / this.scale;\n                        t.anchor[1] += -deltaY / this.scale;\n                    })\n                }\n            }\n        }\n\n        this._recalculatePosition(deltaX, deltaY);\n        /**\n         * 缩放平移事件\n         *\n         * @event JFlow#zoompan\n        */\n        this.dispatchEvent(new JFlowEvent('zoompan', {\n            deltaX,\n            deltaY\n        }));\n        this.scheduleRender(() => {\n            this._panning = false;\n        })\n        // requestAnimationFrame((timestamp) => {\n        //     this.setAnimeClock(timestamp);\n        //     this._render();\n        //     this._panning = false;\n        // })\n    }\n    /**\n     * 开始按压处理函数\n     * @param {Number} offsetX - 事件对象与canvas的内填充边（padding edge）在 X 轴方向上的偏移量。\n     * @param {Number} offsetY - 事件对象与canvas的内填充边（padding edge）在 Y 轴方向上的偏移量。 \n     * @param {Number} event - 原生事件\n     */\n    pressStartHandler(offsetX, offsetY, event) {\n        if(this.checkScrollDragging()) {\n            return;\n        }\n        Object.assign(this._target.meta, {\n            initialX: offsetX,\n            initialY: offsetY,\n        })\n        const {\n            link,\n            instance\n        } = this._targetLockOn([offsetX, offsetY], 'pressStart');\n        // 后续只支持 click 动作\n        if(this.mode === JFLOW_MODE.LINKING) return;\n        Object.assign(this._target.status, {\n            dragging: true,\n            processing: false,\n        });\n        if(this._target.moving) {\n            const moving = this._getMovingTarget();\n            /**\n             * 开始拖动组的事件（特指lock的顶层组）\n             *\n             * @event Node#pressStart\n             * @type {object}\n             * @property {Event} event           - 原始事件 \n             * @property {Node} instance       - 拖动的对象 \n             * @property {JFlow} jflow           - 当前JFlow对象 \n             */\n            moving.dispatchEvent(new JFlowEvent('pressStart', {\n                event,\n                instance: moving,\n                jflow: this,\n            }))\n        }\n        const t = this._resolveLockOnTarget(link, instance)\n        if(t) {\n            /**\n             * 开始拖动对象事件（就是目标对象的拖动事件，事件支持冒泡）\n             *\n             * @event Node#instancePressStart\n             * @type {object}\n             * @property {Event} event           - 原始事件 \n             * @property {Node} instance     - 拖动的对象 \n             * @property {JFlow} jflow           - 当前JFlow对象 \n             * @property {Boolean} bubbles       - 冒泡\n             */\n            // const t = this._target.instance;\n            t.bubbleEvent(new JFlowEvent('instancePressStart', {\n                event,\n                target: t,\n                jflow: this,\n                bubbles: true,\n                preventDefault: () => {\n                    this._preventPressSequeence = true;\n                    this._clearTarget();\n                    document.addEventListener('pointerup', e => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        this._preventPressSequeence = false;\n                    }, { once: true });\n                }\n            }))\n        }\n        if(!this._preventPressSequeence) {\n            this.dispatchEvent(new JFlowEvent('jflowPressStart', {\n                event,\n                jflow: this,\n            }));\n        }\n    }\n    /**\n     * 按压中处理函数\n     * @param {Number} offsetX - 事件对象与canvas的内填充边（padding edge）在 X 轴方向上的偏移量。\n     * @param {Number} offsetY - 事件对象与canvas的内填充边（padding edge）在 Y 轴方向上的偏移量。 \n     * @param {Number} event - 原生事件\n     */\n    pressMoveHandler(offsetX, offsetY, event) {\n        if(this._preventPressSequeence) {\n            return;\n        }\n        if(this.checkScrollDragging()) {\n            return;\n        }\n        const {\n            dragging, processing\n        } = this._target.status;\n        const { x, y } = this._target.meta;\n        // this.canvas.style.cursor = 'default';\n        if(!dragging) {\n            if(this.checkScrollBarHover(offsetX, offsetY)) {\n                return;\n            } else {\n                this.resetScrollBarHover();\n            }\n            \n        }\n\n        if(!dragging && !processing) {\n            const {\n                link,\n                instance\n            } = this._targetLockOn([offsetX, offsetY]);\n            const t = this._resolveLockOnTarget(link, instance);\n            if(t) {\n                \n                /**\n                * instance mousemove 原生事件，仅在无拖拽时触发\n                *\n                * @event Node#instancemousemove\n                * @type {object}\n                * @property {Event} event           - 原始事件\n                * @property {Node} instance           - 原始事件\n                * @property {JFlow} jflow           - 当前JFlow对象 \n                */\n                // instance.dispatchEvent(new JFlowEvent('instancemousemove', {\n                //     event,\n                //     instance,\n                //     jflow: this,\n                // }))\n                t.bubbleEvent(new JFlowEvent('instancemousemove', {\n                    event,\n                    instance: t,\n                    jflow: this,\n                    bubbles: true\n                }));\n            } else {\n                this.dispatchEvent(new JFlowEvent('instancemousemove', {\n                    event,\n                    instance: null,\n                    jflow: this,\n                }));\n            }\n            \n\n            if(this.mode === JFLOW_MODE.LINKING) {\n                // if(instance) {\n                //     instance.bubbleEvent(new JFlowEvent('linking', {\n                //         event,\n                //         target: instance,\n                //         jflow: this,\n                //         bubbles: true,\n                //         callback: (p) => {\n                //             this._currentp = p;\n                //         }\n                //     }))\n                // }\n                \n\n                this._tempNode.anchor = this._currentp;\n                \n                this.scheduleRender(() => {\n                    this._target.isLinkDirty = false; \n                    this._target.isInstanceDirty = false;\n                    this._target.status.processing = false;\n                })\n                this._processPanInBorder();\n                // requestAnimationFrame((timestamp) => {\n                //     this.setAnimeClock(timestamp);\n                //     this._render();\n                //     this._target.isLinkDirty = false; \n                //     this._target.isInstanceDirty = false;\n                //     this._target.status.processing = false;\n                // })\n                return;\n            }\n        }\n\n        \n        /**\n         * canvas mousemove 原生事件\n         *\n         * @event JFlow#canvasmousemove\n         * @type {object}\n         * @property {Event} event           - 原始事件\n         * @property {JFlow} jflow           - 当前JFlow对象 \n         */\n        this.dispatchEvent(new JFlowEvent('canvasmousemove', {\n            event,\n            jflow: this,\n        }))\n\n        \n        \n        if(!dragging) return;\n        // this.canvas.style.cursor = 'grabbing';\n        if(processing) return;\n        \n        const movingtarget = this._target.moving;// this._tempNode ? [this._tempNode] : this._target.moving;\n        this._target.status.movingState = true\n        this._target.status.processing = true;\n        const deltaX = offsetX - x;\n        const deltaY = offsetY - y;\n        if(movingtarget) {\n            if(this._allowMovingTarget) {\n                movingtarget.forEach(t => {\n                    t.anchor[0] += deltaX / this.scale;\n                    t.anchor[1] += deltaY / this.scale;\n                })\n            }\n        } else {\n            this._recalculatePosition(deltaX, deltaY);    \n            this.dispatchEvent(new JFlowEvent('zoompan', {\n                deltaX, deltaY\n            }));\n        }\n        const { instance, link } = this._targetLockOn([offsetX, offsetY]);\n\n        this._processDragOver(instance || link, event);\n        \n        this.scheduleRender(() => {\n            this._target.isLinkDirty = false; \n            this._target.isInstanceDirty = false;\n            this._target.status.processing = false;\n        })\n        // requestAnimationFrame((timestamp) => {\n        //     this._render();\n        //     this._target.isLinkDirty = false; \n        //     this._target.isInstanceDirty = false;\n        //     this._target.status.processing = false;\n        // })\n    }\n    /**\n     * 按压结束处理函数\n     * @param {Boolean} isDocument - 是否为 document 触发\n     * @param {Number} event - 原生事件\n     */\n    pressUpHanlder(isDocument, event) {\n        if(this._preventPressSequeence) {\n            return;\n        }\n        \n        if(this.__processOverAnime) {\n            this.__processOverAnime.cancel();\n        }\n        this._cancelPanInBorder();\n        // this.resetScollBarStatus();\n        const meta = this._target.meta;\n        if(this.mode === JFLOW_MODE.LINKING) {\n            const t = this._target.instance;\n            const payload = this.consumeMessage();\n            // console.log(payload)\n            let _preventDefault = false;\n            const preventDefault = () => {\n                _preventDefault = true;\n            } \n            if(t) {\n                /**\n                 * canvas mousemove 原生事件\n                 *\n                 * @event Node#link\n                 * @type {object}\n                 * @property {Event} event           - 原始事件\n                 * @property {Node} target           - 原始事件\n                 * @property {object} payload        - 传入的消息\n                 * @property {JFlow} jflow           - 当前JFlow对象       - 当前JFlow对象 \n                 */\n                t.bubbleEvent(new JFlowEvent('link', {\n                    event,\n                    target: t,\n                    jflow: this,\n                    payload,\n                    bubbles: true,\n                    link: this._tempLink,\n                    preventDefault,\n                }))        \n            } else {\n                const { offsetX, offsetY } = event\n                this.dispatchEvent(new JFlowEvent('link', {\n                    event,\n                    jflow: this,\n                    payload,\n                    anchor: this._calculatePointBack([offsetX, offsetY]),\n                    link: this._tempLink,\n                    preventDefault\n                }));\n            }\n            if(_preventDefault) {\n                return;\n            }\n            this._clearTarget();\n            if(!this._preventClearTemp) {\n                if(this._tempNode) {\n                    this._tempNode.destroy();\n                    this._tempNode = null;\n                }\n                if(this._tempLink) {\n                    this._tempLink.destroy();\n                    this._tempLink = null;\n                }\n            }\n            this._preventClearTemp = false\n            this.mode = JFLOW_MODE.DEFAULT;\n            this._render();\n            return;\n        }\n        \n        if(this._target.moving) {\n            let checkresult = false;\n            if(this._layout.static) {\n                checkresult = this.staticCheck(this._getMovingTarget());\n            }\n            if(!checkresult && this._target.link) {\n                \n                const {\n                    point, belongs\n                } = this._target.cache;\n                const link = this._target.link;\n                const instance = this._getMovingTarget();\n                /**\n                 * 拖动到线上事件\n                 *\n                 * @event BaseLink#drop\n                 * @type {object}\n                 * @property {Event} event           - 原始事件 \n                 * @property {Object} instance     - 拖动的对象 \n                 * @property {BaseLink} link         - 目标连线 \n                 * @property {JFlow} jflow           - 当前JFlow对象 \n                 * @property {Group|JFlow} belongs   - 连线所在的绘图栈的对象\n                 */\n                link.dispatchEvent(new JFlowEvent('drop', {\n                    event,\n                    instance,\n                    link,\n                    jflow: this,\n                    belongs,\n                }));\n                this._target.link = null;\n                this._target.instance = null;\n            }\n            if(this._target.moving) {\n                if(this._target.instance) {\n                    /**\n                     * 拖动后放置到 Instance 上的事件，由被拖动到的对象触发\n                     *\n                     * @event Node#pressEnd\n                     * @type {object}\n                     * @property {Event} event           - 原始事件 \n                     * @property {Node} instance         - 拖动的对象 \n                     * @property {JFlow} jflow           - 当前JFlow对象 \n                     * @property {Instance} target       - 拖动到的对象\n                     * @property {boolean} bubbles       - 冒泡\n                     */\n                    //  console.log('pressEnd', this._target.instance)\n                    this._target.instance.bubbleEvent(new JFlowEvent('pressEnd', {\n                        event,\n                        instance: this._getMovingTarget(),\n                        jflow: this,\n                        target: this._target.instance,\n                        bubbles: true\n                    }));\n                } else {\n                    /**\n                     * 拖动后放置到主图上的事件\n                     *\n                     * @event JFlow#pressEnd\n                     * @type {object}\n                     * @property {Event} event           - 原始事件 \n                     * @property {Instance} instance       - 拖动的对象 \n                     * @property {JFlow} jflow           - 当前JFlow对象 \n                     */\n                    this.dispatchEvent(new JFlowEvent('pressEnd', {\n                        event,\n                        instance: this._getMovingTarget(),\n                        jflow: this,\n                    }))\n                }\n            }\n            this._target.moving = null;\n            this.removeTempDraggingInstance()\n            // this._target.isMovingDirty = false;\n            this._render();\n        }\n        this._clearTarget();\n    }\n     /**\n     * 菜单弹出处理函数\n     * @param {Number} offsetX - 事件对象与canvas的内填充边（padding edge）在 X 轴方向上的偏移量。\n     * @param {Number} offsetY - 事件对象与canvas的内填充边（padding edge）在 Y 轴方向上的偏移量。 \n     * @param {Number} event - 原生事件\n     */\n    clickHanlder(offsetX, offsetY, event) {\n        const {\n            link,\n            instance,\n            meta\n        } = this._targetLockOn([offsetX, offsetY], 'click');\n        if(Math.abs(meta.initialX - meta.x) < 1\n            && Math.abs(meta.initialY - meta.y) < 1) { \n                if(event.target !== this.canvas){\n                    this._clearTarget();\n                    Object.assign(this._target.meta, {\n                        initialX: undefined,\n                        initialY: undefined, \n                    });\n                    return;\n                }\n                const { topLayerPoint } = this._target.cache\n                const t = this._resolveLockOnTarget(link, instance);\n                if(t) {\n                    const target = t;\n                    /**\n                     * 点击事件（冒泡）\n                     *\n                     * @event Instance#contextclick\n                     * @type {object}\n                     * @property {Event} event           - 原始事件 \n                     * @property {Instance} target       - 右键对象 \n                     * @property {JFlow} jflow           - 当前JFlow对象\n                     * @property {number[]} topLayerPoint  - jflow坐标系上的位置\n                     * @property {Boolean} bubbles       - 冒泡\n                     */\n                    target.bubbleEvent(new JFlowEvent('click', {\n                        event,\n                        jflow: this,\n                        target,\n                        topLayerPoint,\n                        bubbles: true\n                    }));\n                } else {\n                    /**\n                     * 点击事件\n                     *\n                     * @event JFlow#contextclick\n                     * @type {object}\n                     * @property {Event} event           - 原始事件 \n                     * @property {JFlow} jflow           - 当前JFlow对象\n                     * @property {number[]} topLayerPoint  - jflow坐标系上的位置\n                     */\n                    this.dispatchEvent(new JFlowEvent('click', {\n                        event,\n                        jflow: this,\n                        topLayerPoint,\n                    }));\n                }\n                this._clearTarget();\n                Object.assign(this._target.meta, {\n                    initialX: undefined,\n                    initialY: undefined, \n                });\n            }\n    }\n    /**\n     * 菜单弹出处理函数\n     * @param {Number} offsetX - 事件对象与canvas的内填充边（padding edge）在 X 轴方向上的偏移量。\n     * @param {Number} offsetY - 事件对象与canvas的内填充边（padding edge）在 Y 轴方向上的偏移量。 \n     * @param {Number} event - 原生事件\n     */\n    contextMenuHanlder(offsetX, offsetY, event) {\n        const {\n            link,\n            instance\n        } = this._targetLockOn([offsetX, offsetY], 'contextclick');\n        const { topLayerPoint } = this._target.cache\n        const t = this._resolveLockOnTarget(link, instance);\n        if(t) {\n            const target = t;\n            /**\n             * 右键事件（冒泡）\n             *\n             * @event Instance#contextclick\n             * @type {object}\n             * @property {Event} event           - 原始事件 \n             * @property {Instance} target       - 右键对象 \n             * @property {JFlow} jflow           - 当前JFlow对象\n             * @property {number[]} topLayerPoint  - jflow坐标系上的位置\n             * @property {Boolean} bubbles       - 冒泡\n             */\n            target.bubbleEvent(new JFlowEvent('contextclick', {\n                event,\n                jflow: this,\n                target,\n                topLayerPoint,\n                bubbles: true\n            }));\n        } else {\n            /**\n             * 右键事件\n             *\n             * @event JFlow#contextclick\n             * @type {object}\n             * @property {Event} event           - 原始事件 \n             * @property {JFlow} jflow           - 当前JFlow对象\n             * @property {number[]} topLayerPoint  - jflow坐标系上的位置\n             */\n            this.dispatchEvent(new JFlowEvent('contextclick', {\n                event,\n                jflow: this,\n                topLayerPoint,\n            }));\n        }\n    }\n\n    dblclickHandler(offsetX, offsetY, event) {\n        const {\n            link,\n            instance\n        } = this._targetLockOn([offsetX, offsetY], 'dblclick');\n        const { topLayerPoint } = this._target.cache\n        const t = this._resolveLockOnTarget(link, instance);\n        if(t) {\n            const target = t;\n            /**\n             * 右键事件\n             *\n             * @event Instance#dblclick\n             * @type {object}\n             * @property {Event} event           - 原始事件 \n             * @property {Instance} target       - 右键对象 \n             * @property {JFlow} jflow           - 当前JFlow对象\n             * @property {number[]} topLayerPoint  - jflow坐标系上的位置\n             * @property {Boolean} bubbles       - 冒泡\n             */\n            target.bubbleEvent(new JFlowEvent('dblclick', {\n                event,\n                jflow: this,\n                target,\n                topLayerPoint,\n                bubbles: true\n            }));\n        } else {\n            this.dispatchEvent(new JFlowEvent('dblclick', {\n                event,\n                jflow: this,\n                topLayerPoint,\n            }));\n        }\n    }\n\n    /*_onZoom(event) {\n        event.preventDefault();\n        let { offsetX, offsetY, deltaX, deltaY } = event\n        if(event.ctrlKey) { \n            deltaY = -deltaY;\n            this.zoomHandler(offsetX, offsetY, deltaX, deltaY);\n        } else {\n            this.panHandler(-deltaX, -deltaY);\n        }\n    }\n\n    _onPressStart(event) { \n        const { offsetX, offsetY, deltaY, button } = event\n        if(button !== 0) return;\n        this.pressStartHandler(offsetX, offsetY);\n    }\n\n    _onPressMove(event) {\n        const { offsetX, offsetY } = event\n        this.pressMoveHandler(offsetX, offsetY);\n    }\n\n    _onPressUp(event, isDocument) {\n        event.preventDefault();\n        event.stopPropagation();\n        const { button } = event\n        if(button !== 0) return;\n        this.pressUpHanlder(isDocument)\n    }\n\n    _onPressUpDocument(event) {\n        this._onPressUp(event, true);\n    }\n\n    _onContextMenu(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        const { offsetX, offsetY } = event;\n        this.contextMenuHanlder(offsetX, offsetY);\n    }*/\n    _resolveLockOnTarget(link, instance) {\n        return link?.ON_TOP ? link : (instance || link);\n    }\n\n    _clearTarget(){\n        Object.assign(this._target.meta, {\n            x: undefined,\n            y: undefined,\n            // initialX: undefined,\n            // initialY: undefined, \n        })\n        Object.assign(this._target.status, {\n            dragging: false,\n            processing: false,\n            movingState: false,\n        });\n        Object.assign(this._target, {\n            instance: null,\n            link: null,\n            moving: null,\n        });\n    }\n\n    _recalculatePosition(deltaX, deltaY, scale) {\n        const { x, y, width, height } = this.bounding_box;\n        const { actual_width: cw, actual_height: ch } = this.canvasMeta;\n        if(scale === undefined) {\n            scale = this.scale;\n        }\n        \n\n        if(this.worldMargin) {\n            // console.log(scale)\n            const m = this.worldMargin;\n            const bx1 = (x + width + m)*scale - cw;\n            const bx2 = (x - m)*scale;\n            // console.log(bx1, bx2)\n            const sx = x * scale;\n            const px = this.position.x + deltaX;\n            const cx = px - sx;\n            this.position.offsetX = Math.min(Math.max(-bx1, cx), -bx2);\n            // console.log(this.position.offsetX)\n            // this.position.offsetX = Math.max(Math.min(-bx2, cx), -bx1);\n            this.position.x = this.position.offsetX + sx;\n            // console.log(this.position.x, deltaX)\n            // console.log(this.position.offsetX)\n\n            const by1 = (y + height + m)*scale - ch;\n            const by2 = (y - m)*scale;\n            // console.log(by1, by2)\n            const sy = y * scale;\n            const py = this.position.y + deltaY;\n            const cy = py - sy;\n            this.position.offsetY = Math.min(Math.max(-by1, cy), -by2);\n            // this.position.offsetY = Math.max(Math.min(-by2, cy), -by1);\n            this.position.y = this.position.offsetY + sy;\n        } else {\n            this.position.x += deltaX;\n            this.position.y += deltaY; \n            this.position.offsetX = this.position.x - x * scale;\n            this.position.offsetY = this.position.y - y * scale;\n        }\n        \n    }\n\n    calculateToRealWorld(p) {\n        const scale = this.scale;\n        const position = this.position;\n        return [p[0] * scale + position.offsetX, p[1] * scale + position.offsetY]\n    }\n\n    _calculatePointBack(p) {\n        const scale = this.scale;\n        const position = this.position;\n        return [(p[0] - position.offsetX)/scale, (p[1] - position.offsetY) / scale];\n    }\n\n    _calculatePointBackWithPoint(a, b, arr, idx1, idx2) {\n        const scale = this.scale;\n        const position = this.position;\n        arr[idx1] = (a - position.offsetX) / scale;\n        arr[idx2] = (b - position.offsetY) / scale\n    }\n\n    _calculateDistance(l) {\n        return this.scale * l;\n    }\n\n    _resetTransform() {\n        const { width: c_width, height: c_height } = this.canvasMeta;\n        const position = this.position;\n        const scale = this.scale;\n        const ctx = this.ctx;\n        ctx.setTransform();\n        ctx.clearRect(0, 0, c_width, c_height);\n        ctx.scale(this.dpr, this.dpr);\n        ctx.transform(scale, 0, 0, scale, position.offsetX, position.offsetY);\n        // ctx._ctx.setTransform();\n        // ctx._ctx.clearRect(0, 0, c_width, c_height);\n        // ctx._ctx.scale(this.dpr, this.dpr);\n        // ctx.transform(scale, position.offsetX, position.offsetY);\n    }\n\n    resetTransform(ctx) {\n        const position = this.position;\n        const scale = this.scale;\n        ctx.setTransform();\n        ctx.scale(this.dpr, this.dpr);\n        ctx.transform(scale, 0, 0, scale, position.offsetX, position.offsetY);\n    }\n\n    _getViewBox() {\n        // const cacheViewBox = [\n        //     ...this._calculatePointBack([0,0]),\n        //     ...this._calculatePointBack([this.canvasMeta.actual_width,this.canvasMeta.actual_height]),\n        // ];\n        const cacheViewBox = this._cacheViewBox;\n        this._calculatePointBackWithPoint(0,0, cacheViewBox, 0, 1);\n        this._calculatePointBackWithPoint(\n            this.canvasMeta.actual_width,\n            this.canvasMeta.actual_height, \n            cacheViewBox, 2, 3);\n        return cacheViewBox;\n    }\n\n    setNodeToTopLayer(node) {\n        const index = this._stack.findIndex(n => n === node);\n        if(index !== -1) {\n            const [renderNode] = this._stack.splice(index, 1);\n            this._stack.push(renderNode);\n        }\n    }\n\n    getCacheViewBox() {\n        return this._cacheViewBox;\n    }\n\n    \n    _render() {\n        this.scheduleRender();\n    }\n\n     /**\n     * 绘制画布\n     */\n    __render() {\n        if(!this._readyToRender) return;\n        // if(this.hasAnimeAndFrameRendered()) return;\n        this.runAnimeFrame();\n        this._resetTransform();\n        const ctx = this.ctx;\n        this.dispatchEvent(new JFlowEvent('beforeJflowRender', {\n            ctx\n        }));\n        const br = this._getViewBox();\n\n        if(this.NodeRenderTop) {\n            this._linkStack.render(ctx, (link) => !link.ON_TOP && link.isInViewBox(br));\n            this._stack.render(ctx, (instance) => {\n                const result = doOverlap(br, instance.getBoundingRect());\n                instance._isInViewBox = result;\n                return result;\n            });\n            this._linkStack.render(ctx, (link) => link.ON_TOP && link.isInViewBox(br));\n        } else {\n            this._stack.render(ctx, (instance) => {\n                const result = doOverlap(br, instance.getBoundingRect());\n                // console.log(instance._layoutNode.type, result)\n                instance._isInViewBox = result;\n                return result;\n            });\n            this._linkStack.render(ctx, (link) => link.isInViewBox(br));\n        }\n        // ctx.save();\n        // for(let i =0;i<2000;i++) {\n        //     ctx.beginPath();\n        //     ctx.fillStyle = `rgb(${parseInt(Math.random()*255)},${parseInt(Math.random()*255)},${parseInt(Math.random()*255)})`\n        //     ctx.fillRect(\n        //         Math.random()*250, \n        //         Math.random()*240, \n        //         Math.random()*200, \n        //         Math.random()*300)\n        // }\n        \n        // ctx.restore();\n\n        if(this._tempNode) {\n            ctx.save();\n            this._tempNode.render(ctx)\n            ctx.restore();\n        }\n        if(this._tempLink) {\n            ctx.save();\n            this._tempLink.isInViewBox(br)\n            this._tempLink.render(ctx)\n            ctx.restore();\n        }\n\n        this.dispatchEvent(new JFlowEvent('afterJflowRender', {\n            ctx\n        }));\n        this.renderScrollBar(ctx);\n        // this.setFrameRendered();\n    }\n}\nObject.assign(JFlow.prototype, MessageMixin);\nObject.assign(JFlow.prototype, StackMixin);\nObject.assign(JFlow.prototype, LayoutMixin);\nObject.assign(JFlow.prototype, NodeWeakMapMixin);\nObject.assign(JFlow.prototype, AnimeMixin);\nObject.assign(JFlow.prototype, MiniMapMixin);\nObject.assign(JFlow.prototype, ScheduleMixin);\nObject.assign(JFlow.prototype, ScrollBarMixin);\n\nexport default JFlow;\nexport { JFLOW_MODE } from '../utils/constance';\nexport { default as JFlowEvent } from '../events';\nexport { default as commonEventAdapter } from '../events/commonAdapter';\nexport { default as Instance } from '../instance/instance';\nexport { default as Node } from '../instance/node';\nexport { default as BaseLink } from '../instance/base-link';\nexport { default as Point } from '../instance/shapes/point';\nexport { default as Rectangle } from '../instance/shapes/rectangle';\n// export { default as Group } from '../instance/shapes/rectangle-group';\nexport { default as Capsule } from '../instance/shapes/capsule';\nexport { default as CapsuleVertical } from '../instance/shapes/capsule-vertical';\n// export { default as CapsuleGroup } from '../instance/shapes/capsule-group';\n// export { default as CapsuleVerticalGroup } from '../instance/shapes/capsule-vertical-group';\nexport { default as Diamond } from '../instance/shapes/diamond';\n// export { default as DiamondGroup } from '../instance/shapes/diamond-group';\n// export { default as DiamondVerticalGroup } from '../instance/shapes/diamond-vertical-group';\nexport { default as Rhombus } from '../instance/shapes/rhombus';\n// export { default as RhombusGroup } from '../instance/shapes/rhombus-group';\nexport { default as Text } from '../instance/elements/text';\nexport { default as Icon } from '../instance/image';\nexport { default as ShadowDom } from '../instance/shadowDom';\nexport { default as GroupFactory } from '../instance/groupFactory';\nexport { default as Link } from '../instance/link';\nexport { default as PolyLink } from '../instance/poly-link';\nexport { default as BezierLink } from '../instance/bezier-link';\nexport { default as LinearLayout} from '../layout/linear-layout';\n// export { default as TreeLayout } from '../ler-layouta;yout/tree-layout';\nexport { default as Lowcodelayout } from '../layout/low-code-layout';\nexport { default as ERLayout } from '../layout/er-layout/er-layout';\n// export { default as Orange } from '../instance/nodeWrapper/orange/orange'\n// export { default as TextEditor } from '../instance/text-editor';\n// export { default as TextGroup} from '../instance/text-group';\nexport { default as TextGroup} from '../instance/text-group/text-group';\nexport { TextElement } from '../instance/text-group/storage';\n// export { JFlowPath2D } from '../utils/path-2d';","/**\n * 消息 mixin 用于给Jflow传递消息\n *\n * @mixin\n */\nconst MessageMixin = {\n    _message: null,\n    /**\n     * 发送消息\n     * @param {Object} msg - 消息体\n     */\n    sendMessage(msg) {\n        this._message = msg;\n    },\n    /**\n     * 接收消息\n     * @return {Object} msg - 消息体\n     */\n    consumeMessage() {\n        const msg = this._message;\n        this._message = null;\n        return msg;\n    },\n    readMessage() {\n        return this._message;\n    }\n}\n\nexport default MessageMixin;","const packageJson = require('../package.json');\nimport { default as JFlow } from './core/flow'; \nexport default JFlow;\nexport * from './core/flow';\n// export { default as JFlowVuePlugin, JFlowLinkGroup } from './vue-plugin/JFlowPlugin.js';\nwindow.$jflow_version = packageJson.version;\n// console.log(`jflow version@${packageJson.version}`)"],"names":["createCanvas","wrapper","canvas","document","createElement","ctx","getContext","_wrapper$getBoundingC","getBoundingClientRect","width","height","left","top","style","userSelect","scale","window","devicePixelRatio","Math","floor","position","overflow","append","raw_width","raw_height","caheCanvas","caheCanvasctx","requestCacheCanvas","render","clearRect","save","restore","listenOnDevicePixelRatio","callback","destroyHandler","target","matchMedia","concat","onChange","console","log","removeEventListener","once","addEventListener","abs","cos","sin","acos","atan2","sqrt","pow","crt","v","pi","PI","tau","quart","nMax","Number","MAX_SAFE_INTEGER","nMin","MIN_SAFE_INTEGER","ZERO","x","y","z","utils","Tvalues","Cvalues","arcfn","t","derivativeFn","d","l","compute","points","_3d","order","length","mt","p","ret","a","b","c","mt2","t2","dCpts","JSON","parse","stringify","i","splice","computeWithRatios","ratios","r","f1","f2","f3","f4","derive","dpoints","list","dpt","j","push","between","m","M","approximately","precision","len","sum","map","ds","de","ts","te","lerp","v1","v2","undefined","pointToString","s","pointsToString","join","copy","obj","angle","o","dx1","dy1","dx2","dy2","round","pos","indexOf","parseFloat","substring","dist","p1","p2","dx","dy","closest","LUT","point","mpos","mdist","forEach","idx","abcratio","n","bottom","projectionratio","lli8","x1","y1","x2","y2","x3","y3","x4","y4","lli4","p3","p4","lli","makeline","Bezier","findbbox","sections","mx","my","MX","MY","bbox","min","max","mid","size","shapeintersections","s1","bbox1","s2","bbox2","curveIntersectionThreshold","bboxoverlap","intersections","a1","startcap","forward","back","endcap","a2","l1","virtual","l2","iss","intersects","c1","c2","makeshape","bpl","fpl","start","end","shape","getminmax","curve","get","align","line","tx","ty","roots","aligned","reduce","m1","m2","filter","pa","pb","pc","q","q2","discriminant","u1","mp3","phi","t1","sd","droots","curvature","d1","d2","kOnly","num","dnm","adk","dk","k","dd","qdsum","pk","nk","inflections","slice","v3","trm","sq","b1","b2","dims","dim","expandbox","_bbox","pairiteration","c1b","c2b","threshold","_t1","_t2","cc1","split","cc2","pairs","right","pair","results","getccenter","dx1p","dy1p","dx2p","dy2p","mx1","my1","mx2","my2","mx1n","my1n","mx2n","my2n","arc","_","e","numberSort","PolyBezier","constructor","curves","this","valueOf","toString","addCurve","offset","coords","args","Array","from","arguments","coordlen","newargs","higher","Error","step","dimlen","_linear","some","_lut","update","static","abc","getABC","A","S","B","E","C","selen","lx","ly","bx1","by1","bx2","by2","e1","e2","nc1","nc2","getUtils","toSVG","last","setRatios","verify","print","coordDigest","_print","computedirection","clockwise","derivative","bind","u","um","getLUT","steps","on","error","lut","hits","project","ft","raise","np","pim","dderivative","normal","__normal3","__normal2","r1","r2","q1","R","hull","_p","pt","result","span","extrema","mfn","sort","values","overlaps","lbbox","tbbox","nv","simple","n1","n2","segment","pass1","pass2","distanceFn","ov","rc","outline","d3","d4","reduced","fcurves","bcurves","alen","tlen","graduated","linearDistanceFunction","slen","reverse","fs","fe","bs","be","ls","le","segments","outlineshapes","shapes","lineIntersects","curveintersects","selfintersects","arcs","errorThreshold","_iterate","_error","np1","ref","circles","safety","t_s","t_e","np2","np3","prev_arc","done","curr_good","prev_good","t_m","prev_e","interval","DIRECTION","RIGHT","BOTTOM","LEFT","TOP","SELF","JFLOW_MODE","DEFAULT","LINKING","bounding_box","min_x","Infinity","min_y","max_x","max_y","item","sqr","dist2","w","distToSegmentSquared","minIntersectionBetweenNodes","dmsfrom","dmsto","meta","fromDir","fromP","toDir","toP","distMin","Object","keys","df","pf","dt","assign","_resolveControlPoint","dir","spanx","spany","bezierPoints","start_dir","end_dir","minSpanX","minSpanY","cp1","cp2","arrowspan","includes","isVerticalEnd","endX","endY","_toConsumableArray","getBezierAngle","sx","sy","cp1x","cp1y","cp2x","cp2y","ex","ey","polylinePoints","isSelf","dirSpan","isVerticalStart","yp","xp","pmiddle","unshift","minusVec","absVec","vec","scaleVec","doOverlap","rec1","rec2","compareBoundingbox","copyBoundingbox","ishitKey","Symbol","isInViewBox","Instance","_EventTarget","_inherits","_super","_createSuper","_this","configs","_classCallCheck","call","_assertThisInitialized","visible","_belongs","borderWidth","borderColor","backgroundColor","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","opacity","_boundingrect","_createClass","key","_jflow","_target","instance","link","_getMovingTarget","status","movingState","set","ishit","dispatchEvent","CustomEvent","detail","jflow","uniqueName","val","onEnterViewbox","onLeaveViewbox","value","_this2","anchor","rect","getBoundingRect","customEvent","currentTarget","bubbles","bubbleEvent","calculateToRealWorld","belongs","recalculateUp","_wrapNativeSuper","EventTarget","Node","_Instance","_rawConfigs","absolutePosition","_getViewBox","GhostNode","_Node","_this$anchor","_slicedToArray","_ref","_this$anchor2","_defineProperty","NodeWeakMap","_map","WeakMap","source","layoutNode","jflowNode","jflowlinks","jflowFromLinks","jflowToLinks","has","clear","NodeWeakMapMixin","initNodeWeakMap","source_Layout_Render_NodeMap","getRenderNodeBySource","mapping","getLayoutNodeBySource","getSourceRenderMeta","_getMap","setLayoutNodeBySource","setRenderNodeBySource","addLinkNodeBySource","sourceFrom","sourceTo","removeLinkNodeBySource","findIndex","InstanceStack","_Array","_currentHit","condition","movingTarget","_isMoving","beforeRender","_stack","resetHitStatus","_isHit","currentConstraint","ignoreHit","isHit","StackMixin","instances","links","_linkStack","initStack","data","addToStack","replaceFromStack","index","addToLinkStack","removeFromStack","removeFromLinkStack","emptyLink","resetChildrenPosition","addInstanceToLink","targetLink","to","_constuctor","__proto__","interateNodeStack","LayoutMixin","_layout","initLayout","layout","dirty","getBoundingDimension","_this$getBoundingDime","wold","hold","_getBoundingGroupRect","reflow","_this$getBoundingDime2","wnow","hnow","recalculate","staticCheck","AnimeMixin","initAnime","anime_queue","__animeClock__","requestJFlowAnime","frameCallBack","enqueueAnime","_runAnime","animeMeta","cancel","_cancelAnime","_render","runAnime","requestAnimationFrame","scheduleRender","runAnimeFrame","timestamp","Date","now","elapsed","MiniMapMixin","captureMap","_ref$padding","padding","_ref$placement","placement","_this$bounding_box","p_width","p_height","p_x","p_y","miniMap","_this$miniMap","_renderMap","pressDown","event","offsetX","offsetY","deltaX","deltaY","_onMoveMap","cacheMinimapCtx","_this$miniMap2","pad2","pad","m_x","m_y","cachectx","setTransform","transform","br","NodeRenderTop","_cacheMapImageData","getImageData","putImageData","_this$_getViewBox2","beginPath","clip","fillStyle","fillRect","_this$_getViewBox4","_recalculatePosition","ScrollBar","barWidth","barMarginX","barMarginY","plainColor","focusColor","isFocus","radius","cy","by","lc","moveTo","lineTo","closePath","tc","bc","cx","rx","fill","h","ScrollBarMixin","initScrollBar","barColor","barFocusColor","_scrollbarEnable","_scrollbarX","_scrollbarY","_scrollBarStatus","dragging","xscale","yscale","barInitX","barInitY","scrollBarOnPanAndZoom","clientX","clientY","onScrollbarPressStart","checkScrollDragging","barStartX","barStartY","f","onDraggingScrollbar","_this$_scrollBarStatu","scollbarHeight","scollbarWidth","realR","realL","realT","realB","_this$canvasMeta","canvasMeta","actual_width","actual_height","xnew","ynew","checkScrollBarHover","cursor","resetScrollBarHover","_getScrollViewBoundingbox","_this$bounding_box2","_this$_getScrollViewB","vw","vh","_this$canvasMeta2","anchorX","anchorY","resetScollBarStatus","renderScrollBar","dpr","_this$_scrollBarStatu2","ScheduleMixin","initSchedule","__clock__","__render","JFlowEvent","_CustomEvent","_objectSpread","originEvent","getDefaultPlugin","_mouseStatus","pointerDown","wheel","preventDefault","ctrlKey","zoomHandler","panHandler","pointerdown","button","pressStartHandler","pointermove","pressMoveHandler","pointerup","pressUpHanlder","contextmenu","stopPropagation","contextMenuHanlder","dblclick","dblclickHandler","click","clickHanlder","EventAdapter","plugin","use","canvasHandlers","documentHandlers","ca","docObj","eventName","hasOwnProperty","_this$plugin","_loop","handler","handlerWrapperd","_loop2","options","_ref2","GroupMixin","_setPadding","paddingTop","paddingRight","paddingBottom","paddingLeft","_setMargin","margin","marginTop","marginRight","marginBottom","marginLeft","_getCenter","centerX","centerY","_shape","setAnchorX","setAnchorY","setAnchor","_calculatePointBack","_point","gx","gy","_this$_getCenter2","_calculatePointBackWithPoint","arr","idx1","idx2","calculateToCoordination","_point2","_this$_getCenter4","_point3","_this$_getCenter6","clone","ltx","lty","rbx","rby","getIntersectionsInFourDimension","_p2","calculateIntersection","_point4","vecx","vecy","theta1","theta2","dirx","diry","destroy","defaultShift","GroupFactory","jflowNodeConstructor","shapeShift","_configs$lock","_configs$transparent","definedWidth","minWidth","definedHeight","lock","display","transparent","_cacheViewBox","prototype","_shapeShift2","shapeWidth","shapeHeight","setConfig","getBoundingRectPoints","paddingWidth","paddingHeight","_paddingWidth","_paddingHeight","_shapeShift4","belongs_vbox","getCacheViewBox","cacheViewBox","globalAlpha","_this$_getCenter8","translate","_currentp","checkHit","Point","type","_doCache","lineWidth","strokeStyle","stroke","ratio","_allIntersections","_this$anchor3","allIntersections","interDir","Rectangle","borderRadius","_setBorder","_configs$border","_configs$border2","_configs$border3","_configs$border4","_configs$border5","_configs$border6","_configs$border7","_configs$border8","_configs$border9","_configs$border10","_configs$border11","_configs$border12","border","color","enable","xt","yt","quadraticCurveTo","switchPath","Path2D","topPath","_p4","Capsule","hw","hh","leftCenter","rightCenter","ww","rr","CapsuleVertical","_Capsule","apply","topCenter","bottomCenter","yy","Rhombus","diagonalsV","diagonalsH","center","Diamond","side","sinSIDE","cosSIDE","xx","_cachePoints","polygon","odd","DiamondVertical","_Diamond","topmiddle","bottommiddle","xleft","xright","InnerScrollBar","_ScrollBar","_get","_getPrototypeOf","onHit","ScrollGroup","_super2","maxWidth","maxHeight","_offset","_resetOffset","_this3","_f","hitScrollX","hitScrollY","_this4","JFLOW","_scrollWidth","_outerWidth","ratioInX","_innerWidth","_scrollHeight","_outerHeight","_innerHeight","outerWidth","outerHeight","_this$_offset","_this$_offset2","_this$_offset3","_this$anchor4","w2","h2","_this$_offset4","_this$anchor5","sp","setHit","_this$_offset5","BaseLink","viewbox","linkStack","ShadowCache","imageBuffer","cache","drawImage","TEXT_ALIGN","Text","_Rectangle","content","fontFamily","fontSize","fontWeight","textColor","placeholderColor","textAlign","textBaseline","lineHeight","indent","editable","ellipsis","placeholder","emptyWhenInput","editting","disabled","cursorColor","textRangeColor","_status","editing","cursorshow","cursoranime","lastElapsed","refreshElapsed","cursorDragging","shiftOn","oldVal","inputElement","_cursorOffset","_textRange","rangefrom","rangeTo","initialRange","_makeFunctional","preCalculateText","shadowCache","font","t_h","parseInt","currentContent","_ctx$measureText","measureText","fontBoundingBoxAscent","fontBoundingBoxDescent","_textWidth","_calculateOffset","ellipsisContent","_textHeight","_shadowCache","isEmpty","fillText","_this5","flag","_positionToCursorOffset","controlCallback","defaultCallback","input","setAttribute","stopInput","ctrlOn","code","createInputElement","_controlCallback","_defaultCallback","DOMwrapper","focus","preventScroll","setFocusInstance","syncShadowInputPosition","_this6","_selectFullRange","_refreshCursor","remove","moved","offx","_this7","maxL","contentWidth","allwidth","g1","g2","lastidx","w1","spanw","disableCache","textheight","cw","c_len","_this$_textRange","range","op","_clearTextRange","refresh","afterContent","preContent","cacheIdx","stopInputEvent","defaultAct","blur","_this8","px","_inputControl","_onArrowLeft","_onArrowRight","_onShiftToggle","_copy","_cut","_paste","_this$_textRange2","_this$_textRange3","selection","_getSelection","clipboardData","setData","pasteContent","getData","resolvePasteContent","rawEvent","_focus","Icon","image","onload","imageBounding","imageWidth","imageHeight","complete","ShadowDom","domFactory","createDocument","_dom","container","getRealWorldPosition","appendChild","removeChild","Link","_BaseLink","lineDash","approximate","_cacheAngle","_cacheBoundingbox","p0","getCenter","frombox","tobox","_box","_calculateAnchorPoints","_this$_cachePoints","actualBoundingBoxLeft","actualBoundingBoxRight","region","ry","rw","rh","setLineDash","rotate","_this$_cachePoints2","PIINRATIO","PolyLink","doubleLink","noArrow","_static","polyline","_rect","l0","r0","cp","isPolyLineIntersectionRectange","pEnd","angleEnd","beginAngle","_makeRadiusFromVector","pbefore","pnext","vec1","vec2","absVec1","absVec2","makeRadiusFromVector","lastP","remainPoints","currentP","shift","_Object$assign","BezierLink","bezierCurveTo","hasFlip","_bezierPoint","P","bezierPoint","_bezierPoint2","_construct","distToBezierSegmentSquared","LinearLayout","_configs$gap","direction","gap","alignment","justify","group","stack","absoluteStack","groupWidth","reduceHeight","lastInstanceHeight","allHeight","childAll","_instance$getBounding","reduceWidth","lastInstanceWidth","allWidth","_instance$getBounding5","withdraw","gapAverage","WIDTH","HEIGHT","shifty","shiftx","_resolveAbsoluteAnchor","config","_instance$getBounding8","BaseNode","id","level","sequence","isFree","parent","parentIterateType","hasEndPoint","spanX","spanY","nodes","traverse","renderNode","Root","_BaseNode","isroot","body","mapFunc","playgrounditerator","playground","_b$reflowPreCalculate","reflowPreCalculate","preCallback","node","part","makeLink","IfStatement","_BaseNode2","consequent","alternate","isLocked","c_spanX","c_spanY","a_spanX","a_spanY","_c$reflowPreCalculate","nextSequeence","_a$reflowPreCalculate","_this$Endpoint$reflow","Endpoint","lastc","lasta","linkMeta","SwitchStatement","_BaseNode3","_super3","cases","lastCase","cc","_cc$reflowPreCalculat","s_spanX","s_spanY","_ca$reflowPreCalculat","_this$Endpoint$reflow2","ForEachStatement","_BaseNode4","_super4","WhileStatement","_BaseNode5","_super5","_b$reflowPreCalculate2","anticlock","SwitchCase","_BaseNode6","_super6","_this9","_c$reflowPreCalculate2","_a$reflowPreCalculate2","TYPE_MAPPING","other","makeAST","__endpoint__","LowcodeLayout","_configs$treeItemDrag","linkLength","treeItemDraggable","reOrder","ast","flowStack","flowLinkStack","root","isDraggable","currentTopNodeId","layoutMapping","vertical","horizontal","playgroundLayoutMapping","reflowBodyPreCalculate","reflowPlaygroundPreCalculate","topNode","_layoutNode","find","nowAnchor","currentAnchor","verticalMapping","horizontalMapping","columnNumber","column","rowWidth","rows","rowNumber","row","rowHeight","columns","_instance$getBounding2","finded","layoutMeta","reflowByMapping","ERProperty","isNavigation","association","name","_selfLink","parentPropertyRef","getJflowInstance","doubleRef","ERNode","propertyList","navigationPropertyList","idProperty","nodeMap","property","idRef","isParentRef","parentRef","objectRef","targetProperty","toProperty","isObjectRef","ERLayout","erNodes","entityRelationship","er","_traverseProperty","makeER","idMap","id1","id2","fromMeta","lineMapping","computeNodeAnchor","recorded","relativeAnchor","diagramWeight","_computeNodeAnchor2","nx","ny","EDITOR_EVENTS","KEYBOARD_INPUT","KEYBOARD_COMMANDS","MOUSE_COMMANDS","ShadowInput","_inputElement","kind","Caret","show","anime","_row","columnoridx","_column","Area","_lines","lines","Line","create","_elements","elem","elementSpace","elements","elem_idx","last_c","_c","lastel","el","textmeta","calculateOffsetByWidth","FlattenTextElements","inersetAt","setNeedWrap","needWrap","isTail","_textElements","_this$_textElements","removed","_records","_caretRecord","before","after","caret","toRange","_e","TextElement","records","lastSource","lastWrap","nextOffset","Range","_initialRange","_rangeFrom","_rangeTo","_enable","_this$_rangeTo","setRow","setColumn","another","_compareRange","editor","area","_area","_caret","rangeFrom","elemFrom","elemTo","setSource","preElement","afterElement","flattenTxtElem","_flattenTxtElem","fromIdx","toIdx","endTextNeedWrap","disable","isSetSourceBatch","UndoRedo","caretRecord","lastUndo","getLastUndo","_batch","_caretMetaTo","BatchAction","_caretMetaFrom","_undo","_redo","pop","undo","_editor","SKIP_REDO","redo","batch","action","_action$args","_range","setInitialRange","setRange","_action$args2","_action$args3","_action$args4","fromRange","_action$args5","_action$args6","Command","ArrowLeftCommand","_Command","getRow","getColumn","elemidx","element","tailOffset","preRow","preElemidx","ArrowRightCommand","_Command2","_column2","headOffset","afterRow","ArrowUpCommand","_Command3","nextRow","_handler","ArrowDownCommand","_Command4","_mixin","_column3","currElem","currElemReduceWidth","measureTextWidth","nextColumn","getColumnNearest","_blandAdjacentElement","elem1","elem2","defaultOffset","Input","_len","_key","undoredo","_undoredo","startRecord","recordBeforeCaret","isEnable","collectRecords","recordAfterCaret","write","getCaretRecord","_caret$getColumn2","preElem","newElement","insertBefore","test","replace","curElem","_t","insertAfter","_blandAdjacentElement3","_blandAdjacentElement5","_blandAdjacentElement7","_blandAdjacentElement9","StartEditCommand","_startEdit","moveCaretByHitPoint","createShadowInput","animate","EditClickCommand","DoubleClickCommand","tail","handleCaret","ShiftUpCommand","toggleShift","ShiftDownCommand","ShiftOnClickCommand","CtrlACommand","UndoCommand","RedoCommand","TextGroup","css","head","_shadowInput","lineSpace","resolver","dragover","commands","Map","registCommand","cmd","execCommand","commnd","textElements","cancelAnimate","onDrop","lastLength","exec","_this$_positionToCurs","getLineAbove","currentLineHeight","_this$_caretToPositio2","_caretToPosition","syncPosition","_randerCursor","_renderRange","isShow","_this$_caretToPositio4","blockheight","blockwidth","_range$getRangeFrom2","getRangeFrom","r_f","idx_f","offset_f","_range$getRangeTo2","getRangeTo","r_t","idx_t","offset_t","space","_measureElementOffsetX","_r","beginning","lastElem","validInstance","_this6$anchor","truncate","insert","nextArea","lastReduceY","reduceX","doubleMargin","getElementsByTagName","styleSheet","cssText","createTextNode","Group","CapsuleGroup","RhombusGroup","DiamondGroup","DiamondVerticalGroup","CapsuleVerticalGroup","PointGroup","ceil","JFlow","eventAdapter","initialZoom","initialPosition","setInitialPosition","maxZoom","minZoom","worldMargin","draggingbehavior","panInBorder","deltamovement","allowMovingTargetInPan","scrollBarBehavior","offeset","_lastState","processing","_lastDragState","moving","isInstanceDirty","isLinkDirty","initialX","initialY","dragovering","_dragOverTarget","allowDrop","_tempNode","_tempLink","mode","_allowMovingTarget","targets","dom","_createCanvas","c_width","c_height","$jflow","scaleRatio","contentBox","w_ratio","h_ratio","realboxX","realboxY","realboxW","realboxH","_this$initialPosition","_readyToRender","_createEventHandler","resizeCanvas","destroyDprListener","linkGen","sendMessage","_preventClearTemp","_resizeCanvas2","_wrapper$getBoundingC2","nowx","nowy","destroyListener","destroyPlainEventListener","unload","dragoverHandler","_onDragover","dropHandler","_onDrop","dragleaveHanlder","_onDragLeave","offsetPoint","topLayerPoint","movingtarget","ON_TOP","setMovingTargets","relatedTarget","_this$readMessage","readMessage","_dragCurrentData","oldIns","_processPanInBorder","_this$draggingbehavio","timer","_this$_cacheViewBox","_this$_currentp","py","_this$draggingbehavio2","__processOverAnime","_targetLockOn","_processDragOver","Promise","resolve","then","_this$draggingbehavio3","_cancelPanInBorder","payload","consumeMessage","_this$_target","_this$_target$cache","cancelDrop","_zooming","_this$bounding_box3","ch","newScale","deltaScale","currentWidth","currentHeight","deltaWidth","deltaHeight","pX","pY","_panning","_this10","_this$_targetLockOn","_resolveLockOnTarget","_preventPressSequeence","_clearTarget","_this11","_this$_target$status","_this$_target$meta","_this$_targetLockOn2","_this$_targetLockOn3","isDocument","_preventDefault","checkresult","_this$_target$cache2","removeTempDraggingInstance","_this$_targetLockOn4","_this$_targetLockOn5","_this$_targetLockOn6","_this$bounding_box4","_this$canvasMeta3","_resetTransform","_isInViewBox","_message","msg","packageJson","require","$jflow_version","version"],"mappings":"yuKAkBO,SAASA,EAAaC,GACzB,IAAMC,EAASC,SAASC,cAAc,UAChCC,EAAMH,EAAOI,WAAW,MAC9BC,EAAqCN,EAAQO,wBAArCC,EAAKF,EAALE,MAAOC,EAAMH,EAANG,OAAQC,EAAIJ,EAAJI,KAAMC,EAAGL,EAAHK,IAC7BV,EAAOW,MAAMJ,MAAQA,EAAQ,KAC7BP,EAAOW,MAAMH,OAASA,EAAS,KAC/BR,EAAOW,MAAMC,WAAa,OAC1B,IAAMC,EAAQC,OAAOC,iBASrB,OARAf,EAAOO,MAAQS,KAAKC,MAAMV,EAAQM,GAClCb,EAAOQ,OAASQ,KAAKC,MAAMT,EAASK,GAEjCd,IACCA,EAAQY,MAAMO,SAAW,WACzBnB,EAAQY,MAAMQ,SAAW,SACzBpB,EAAQqB,OAAOpB,IAEZ,CACHA,OAAAA,EACAO,MAAAA,EACAC,OAAAA,EACAa,UAAWrB,EAAOO,MAClBe,WAAYtB,EAAOQ,OACnBC,KAAAA,EACAC,IAAAA,EACAP,IAAAA,EACAU,MAAAA,GAmBR,IAAMU,EAAatB,SAASC,cAAc,UAC1CqB,EAAWhB,MAAQ,EACnBgB,EAAWf,OAAS,EACpB,IAAMgB,EAAgBD,EAAWnB,WAAW,MACtCS,EAAQC,OAAOC,iBAOd,SAASU,EAAmBC,GAC/BF,EAAcG,UAAU,EAAE,EAAE,EAAE,GAC9BH,EAAcI,OACdF,EAAOF,GACPA,EAAcK,UACdL,EAAcG,UAAU,EAAE,EAAE,EAAE,GAG3B,SAASG,EAAyBC,EAAUC,GAC/C,IAAMC,EAASC,WAAUC,gBAAAA,OACLrB,OAAOC,iBAAgB,UAE3C,SAASqB,IACPC,QAAQC,IAAI,6BAA+BxB,OAAOC,kBAClDgB,EAASjB,OAAOC,kBAChBe,EAAyBC,EAAUC,GAErCA,GAAe,WACXK,QAAQC,IAAI,yCACZL,EAAOM,oBAAoB,SAAUH,EAAU,CAAEI,MAAM,OAE3DP,EAAOQ,iBAAiB,SAAUL,EAAU,CAAEI,MAAM,IA3BxDhB,EAAcX,MAAMA,EAAOA,GChE3B,UAAQ6B,EAAGC,IAAEA,EAAGC,IAAEA,EAAKC,KAAAA,EAAIC,MAAEA,OAAOC,EAAIC,IAAEA,GAAQhC,KAGlD,SAASiC,EAAIC,GACX,OAAOA,EAAI,GAAKF,GAAKE,EAAG,EAAI,GAAKF,EAAIE,EAAG,EAAI,GAI9C,MAAMC,EAAKnC,KAAKoC,GACdC,EAAM,EAAIF,EACVG,EAAQH,EAAK,EAIbI,EAAOC,OAAOC,kBAAoB,iBAClCC,EAAOF,OAAOG,mBAAqB,iBAEnCC,EAAO,CAAEC,EAAG,EAAGC,EAAG,EAAGC,EAAG,GAGpBC,EAAQ,CAEZC,QAAS,EACN,mBACD,oBACC,kBACD,mBACC,kBACD,mBACC,kBACD,mBACC,kBACD,mBACC,kBACD,mBACC,kBACD,mBACC,iBACD,kBACC,kBACD,mBACC,kBACD,mBACC,kBACD,mBACC,kBACD,mBAIFC,QAAS,CACP,mBACA,mBACA,kBACA,kBACA,mBACA,mBACA,kBACA,kBACA,mBACA,mBACA,mBACA,mBACA,mBACA,mBACA,kBACA,kBACA,mBACA,mBACA,mBACA,mBACA,oBACA,oBACA,kBACA,mBAGFC,MAAO,SAAUC,EAAGC,GAClB,MAAMC,EAAID,EAAaD,GACvB,IAAIG,EAAID,EAAET,EAAIS,EAAET,EAAIS,EAAER,EAAIQ,EAAER,EAI5B,YAHmB,IAARQ,EAAEP,IACXQ,GAAKD,EAAEP,EAAIO,EAAEP,GAERhB,EAAKwB,IAGdC,QAAS,SAAUJ,EAAGK,EAAQC,GAE5B,GAAU,IAANN,EAEF,OADAK,EAAO,GAAGL,EAAI,EACPK,EAAO,GAGhB,MAAME,EAAQF,EAAOG,OAAS,EAE9B,GAAU,IAANR,EAEF,OADAK,EAAOE,GAAOP,EAAI,EACXK,EAAOE,GAGhB,MAAME,EAAK,EAAIT,EACf,IAAIU,EAAIL,EAGR,GAAc,IAAVE,EAEF,OADAF,EAAO,GAAGL,EAAIA,EACPK,EAAO,GAIhB,GAAc,IAAVE,EAAa,CACf,MAAMI,EAAM,CACVlB,EAAGgB,EAAKC,EAAE,GAAGjB,EAAIO,EAAIU,EAAE,GAAGjB,EAC1BC,EAAGe,EAAKC,EAAE,GAAGhB,EAAIM,EAAIU,EAAE,GAAGhB,EAC1BM,EAAGA,GAKL,OAHIM,IACFK,EAAIhB,EAAIc,EAAKC,EAAE,GAAGf,EAAIK,EAAIU,EAAE,GAAGf,GAE1BgB,EAIT,GAAIJ,EAAQ,EAAG,CACb,IAEEK,EACAC,EACAC,EAJEC,EAAMN,EAAKA,EACbO,EAAKhB,EAAIA,EAITE,EAAI,EACQ,IAAVK,GACFG,EAAI,CAACA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIlB,GACvBoB,EAAIG,EACJF,EAAIJ,EAAKT,EAAI,EACbc,EAAIE,GACe,IAAVT,IACTK,EAAIG,EAAMN,EACVI,EAAIE,EAAMf,EAAI,EACdc,EAAIL,EAAKO,EAAK,EACdd,EAAIF,EAAIgB,GAEV,MAAML,EAAM,CACVlB,EAAGmB,EAAIF,EAAE,GAAGjB,EAAIoB,EAAIH,EAAE,GAAGjB,EAAIqB,EAAIJ,EAAE,GAAGjB,EAAIS,EAAIQ,EAAE,GAAGjB,EACnDC,EAAGkB,EAAIF,EAAE,GAAGhB,EAAImB,EAAIH,EAAE,GAAGhB,EAAIoB,EAAIJ,EAAE,GAAGhB,EAAIQ,EAAIQ,EAAE,GAAGhB,EACnDM,EAAGA,GAKL,OAHIM,IACFK,EAAIhB,EAAIiB,EAAIF,EAAE,GAAGf,EAAIkB,EAAIH,EAAE,GAAGf,EAAImB,EAAIJ,EAAE,GAAGf,EAAIO,EAAIQ,EAAE,GAAGf,GAEnDgB,EAIT,MAAMM,EAAQC,KAAKC,MAAMD,KAAKE,UAAUf,IACxC,KAAOY,EAAMT,OAAS,GAAG,CACvB,IAAK,IAAIa,EAAI,EAAGA,EAAIJ,EAAMT,OAAS,EAAGa,IACpCJ,EAAMI,GAAK,CACT5B,EAAGwB,EAAMI,GAAG5B,GAAKwB,EAAMI,EAAI,GAAG5B,EAAIwB,EAAMI,GAAG5B,GAAKO,EAChDN,EAAGuB,EAAMI,GAAG3B,GAAKuB,EAAMI,EAAI,GAAG3B,EAAIuB,EAAMI,GAAG3B,GAAKM,QAExB,IAAfiB,EAAMI,GAAG1B,IAClBsB,EAAMI,GAAKJ,EAAMI,GAAG1B,GAAKsB,EAAMI,EAAI,GAAG1B,EAAIsB,EAAMI,GAAG1B,GAAKK,GAG5DiB,EAAMK,OAAOL,EAAMT,OAAS,EAAG,GAGjC,OADAS,EAAM,GAAGjB,EAAIA,EACNiB,EAAM,IAGfM,kBAAmB,SAAUvB,EAAGK,EAAQmB,EAAQlB,GAC9C,MAAMG,EAAK,EAAIT,EACbyB,EAAID,EACJd,EAAIL,EAEN,IAIEH,EAJEwB,EAAKD,EAAE,GACTE,EAAKF,EAAE,GACPG,EAAKH,EAAE,GACPI,EAAKJ,EAAE,GAOT,OAHAC,GAAMjB,EACNkB,GAAM3B,EAEW,IAAbU,EAAEF,QACJN,EAAIwB,EAAKC,EACF,CACLlC,GAAIiC,EAAKhB,EAAE,GAAGjB,EAAIkC,EAAKjB,EAAE,GAAGjB,GAAKS,EACjCR,GAAIgC,EAAKhB,EAAE,GAAGhB,EAAIiC,EAAKjB,EAAE,GAAGhB,GAAKQ,EACjCP,IAAIW,IAAeoB,EAAKhB,EAAE,GAAGf,EAAIgC,EAAKjB,EAAE,GAAGf,GAAKO,EAChDF,EAAGA,KAKP0B,GAAMjB,EACNkB,GAAM,EAAIlB,EACVmB,GAAM5B,EAAIA,EAEO,IAAbU,EAAEF,QACJN,EAAIwB,EAAKC,EAAKC,EACP,CACLnC,GAAIiC,EAAKhB,EAAE,GAAGjB,EAAIkC,EAAKjB,EAAE,GAAGjB,EAAImC,EAAKlB,EAAE,GAAGjB,GAAKS,EAC/CR,GAAIgC,EAAKhB,EAAE,GAAGhB,EAAIiC,EAAKjB,EAAE,GAAGhB,EAAIkC,EAAKlB,EAAE,GAAGhB,GAAKQ,EAC/CP,IAAIW,IAAeoB,EAAKhB,EAAE,GAAGf,EAAIgC,EAAKjB,EAAE,GAAGf,EAAIiC,EAAKlB,EAAE,GAAGf,GAAKO,EAC9DF,EAAGA,KAKP0B,GAAMjB,EACNkB,GAAM,IAAMlB,EACZmB,GAAM,EAAInB,EACVoB,GAAM7B,EAAIA,EAAIA,EAEG,IAAbU,EAAEF,QACJN,EAAIwB,EAAKC,EAAKC,EAAKC,EACZ,CACLpC,GAAIiC,EAAKhB,EAAE,GAAGjB,EAAIkC,EAAKjB,EAAE,GAAGjB,EAAImC,EAAKlB,EAAE,GAAGjB,EAAIoC,EAAKnB,EAAE,GAAGjB,GAAKS,EAC7DR,GAAIgC,EAAKhB,EAAE,GAAGhB,EAAIiC,EAAKjB,EAAE,GAAGhB,EAAIkC,EAAKlB,EAAE,GAAGhB,EAAImC,EAAKnB,EAAE,GAAGhB,GAAKQ,EAC7DP,IAAIW,IAECoB,EAAKhB,EAAE,GAAGf,EAAIgC,EAAKjB,EAAE,GAAGf,EAAIiC,EAAKlB,EAAE,GAAGf,EAAIkC,EAAKnB,EAAE,GAAGf,GAAKO,EAC9DF,EAAGA,SARP,KAaF8B,OAAQ,SAAUzB,EAAQC,GACxB,MAAMyB,EAAU,GAChB,IAAK,IAAIrB,EAAIL,EAAQH,EAAIQ,EAAEF,OAAQM,EAAIZ,EAAI,EAAGA,EAAI,EAAGA,IAAKY,IAAK,CAC7D,MAAMkB,EAAO,GACb,IAAK,IAAWC,EAAPC,EAAI,EAAQA,EAAIpB,EAAGoB,IAC1BD,EAAM,CACJxC,EAAGqB,GAAKJ,EAAEwB,EAAI,GAAGzC,EAAIiB,EAAEwB,GAAGzC,GAC1BC,EAAGoB,GAAKJ,EAAEwB,EAAI,GAAGxC,EAAIgB,EAAEwB,GAAGxC,IAExBY,IACF2B,EAAItC,EAAImB,GAAKJ,EAAEwB,EAAI,GAAGvC,EAAIe,EAAEwB,GAAGvC,IAEjCqC,EAAKG,KAAKF,GAEZF,EAAQI,KAAKH,GACbtB,EAAIsB,EAEN,OAAOD,GAGTK,QAAS,SAAUtD,EAAGuD,EAAGC,GACvB,OACGD,GAAKvD,GAAKA,GAAKwD,GAChB1C,EAAM2C,cAAczD,EAAGuD,IACvBzC,EAAM2C,cAAczD,EAAGwD,IAI3BC,cAAe,SAAU3B,EAAGC,EAAG2B,GAC7B,OAAOlE,EAAIsC,EAAIC,KAAO2B,GAtPd,OAyPVhC,OAAQ,SAAUP,GAChB,MACEwC,EAAM7C,EAAMC,QAAQW,OAEtB,IAAIkC,EAAM,EAEV,IAAK,IAAW1C,EAAPqB,EAAI,EAAMA,EAAIoB,EAAKpB,IAC1BrB,EANQ,GAMAJ,EAAMC,QAAQwB,GANd,GAORqB,GAAO9C,EAAME,QAAQuB,GAAKzB,EAAMG,MAAMC,EAAGC,GAE3C,MATU,GASCyC,GAGbC,IAAK,SAAU7D,EAAG8D,EAAIC,EAAIC,EAAIC,GAK5B,OAAOD,GAHAC,EAAKD,KACLhE,EAAI8D,IAFAC,EAAKD,KAOlBI,KAAM,SAAUvB,EAAGwB,EAAIC,GACrB,MAAMvC,EAAM,CACVlB,EAAGwD,EAAGxD,EAAIgC,GAAKyB,EAAGzD,EAAIwD,EAAGxD,GACzBC,EAAGuD,EAAGvD,EAAI+B,GAAKyB,EAAGxD,EAAIuD,EAAGvD,IAK3B,YAHayD,IAATF,EAAGtD,QAA4BwD,IAATD,EAAGvD,IAC3BgB,EAAIhB,EAAIsD,EAAGtD,EAAI8B,GAAKyB,EAAGvD,EAAIsD,EAAGtD,IAEzBgB,GAGTyC,cAAe,SAAU1C,GACvB,IAAI2C,EAAI3C,EAAEjB,EAAI,IAAMiB,EAAEhB,EAItB,YAHmB,IAARgB,EAAEf,IACX0D,GAAK,IAAM3C,EAAEf,GAER0D,GAGTC,eAAgB,SAAUjD,GACxB,MAAO,IAAMA,EAAOsC,IAAI/C,EAAMwD,eAAeG,KAAK,MAAQ,KAG5DC,KAAM,SAAUC,GACd,OAAOvC,KAAKC,MAAMD,KAAKE,UAAUqC,KAGnCC,MAAO,SAAUC,EAAGV,EAAIC,GACtB,MAAMU,EAAMX,EAAGxD,EAAIkE,EAAElE,EACnBoE,EAAMZ,EAAGvD,EAAIiE,EAAEjE,EACfoE,EAAMZ,EAAGzD,EAAIkE,EAAElE,EACfsE,EAAMb,EAAGxD,EAAIiE,EAAEjE,EAGjB,OAAOhB,EAFGkF,EAAMG,EAAMF,EAAMC,EACpBF,EAAME,EAAMD,EAAME,IAK5BC,MAAO,SAAUlF,EAAGoB,GAClB,MAAMmD,EAAI,GAAKvE,EACTmF,EAAMZ,EAAEa,QAAQ,KACtB,OAAOC,WAAWd,EAAEe,UAAU,EAAGH,EAAM,EAAI/D,KAG7CmE,KAAM,SAAUC,EAAIC,GAClB,MAAMC,EAAKF,EAAG7E,EAAI8E,EAAG9E,EACnBgF,EAAKH,EAAG5E,EAAI6E,EAAG7E,EACjB,OAAOf,EAAK6F,EAAKA,EAAKC,EAAKA,IAG7BC,QAAS,SAAUC,EAAKC,GACtB,IACEC,EACA3E,EAFE4E,EAAQlG,EAAI,EAAG,IAUnB,OAPA+F,EAAII,SAAQ,SAAUrE,EAAGsE,GACvB9E,EAAIN,EAAMyE,KAAKO,EAAOlE,GAClBR,EAAI4E,IACNA,EAAQ5E,EACR2E,EAAOG,MAGJ,CAAEF,MAAOA,EAAOD,KAAMA,IAG/BI,SAAU,SAAUjF,EAAGkF,GAErB,GAAU,IAANA,GAAiB,IAANA,EACb,OAAO,EAET,QAAiB,IAANlF,EACTA,EAAI,QACC,GAAU,IAANA,GAAiB,IAANA,EACpB,OAAOA,EAET,MAAMmF,EAASvG,EAAIoB,EAAGkF,GAAKtG,EAAI,EAAIoB,EAAGkF,GAEtC,OAAO5G,GADC6G,EAAS,GACAA,IAGnBC,gBAAiB,SAAUpF,EAAGkF,GAE5B,GAAU,IAANA,GAAiB,IAANA,EACb,OAAO,EAET,QAAiB,IAANlF,EACTA,EAAI,QACC,GAAU,IAANA,GAAiB,IAANA,EACpB,OAAOA,EAET,MAAM1D,EAAMsC,EAAI,EAAIoB,EAAGkF,GAEvB,OAAO5I,GADIsC,EAAIoB,EAAGkF,GAAK5I,IAIzB+I,KAAM,SAAUC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GAC1C,MAGE3F,GAAKoF,EAAKE,IAAOG,EAAKE,IAAON,EAAKE,IAAOC,EAAKE,GAChD,OAAS,GAAL1F,GAGG,CAAET,IANJ6F,EAAKG,EAAKF,EAAKC,IAAOE,EAAKE,IAAON,EAAKE,IAAOE,EAAKG,EAAKF,EAAKC,IAMjD1F,EAAGR,IALZ4F,EAAKG,EAAKF,EAAKC,IAAOG,EAAKE,IAAON,EAAKE,IAAOC,EAAKG,EAAKF,EAAKC,IAKzC1F,IAG9B4F,KAAM,SAAUxB,EAAIC,EAAIwB,EAAIC,GAC1B,MAAMV,EAAKhB,EAAG7E,EACZ8F,EAAKjB,EAAG5E,EACR8F,EAAKjB,EAAG9E,EACRgG,EAAKlB,EAAG7E,EACRgG,EAAKK,EAAGtG,EACRkG,EAAKI,EAAGrG,EACRkG,EAAKI,EAAGvG,EACRoG,EAAKG,EAAGtG,EACV,OAAOE,EAAMyF,KAAKC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,IAGhDI,IAAK,SAAUhD,EAAIC,GACjB,OAAOtD,EAAMkG,KAAK7C,EAAIA,EAAGnC,EAAGoC,EAAIA,EAAGpC,IAGrCoF,SAAU,SAAU5B,EAAIC,GACtB,MAAMe,EAAKhB,EAAG7E,EACZ8F,EAAKjB,EAAG5E,EACR8F,EAAKjB,EAAG9E,EACRgG,EAAKlB,EAAG7E,EACR8E,GAAMgB,EAAKF,GAAM,EACjBb,GAAMgB,EAAKF,GAAM,EACnB,OAAO,IAAIY,GACTb,EACAC,EACAD,EAAKd,EACLe,EAAKd,EACLa,EAAK,EAAId,EACTe,EAAK,EAAId,EACTe,EACAC,IAIJW,SAAU,SAAUC,GAClB,IAAIC,EAAKnH,EACPoH,EAAKpH,EACLqH,EAAKlH,EACLmH,EAAKnH,EAQP,OAPA+G,EAAStB,SAAQ,SAAU1B,GACzB,MAAMqD,EAAOrD,EAAEqD,OACXJ,EAAKI,EAAKjH,EAAEkH,MAAKL,EAAKI,EAAKjH,EAAEkH,KAC7BJ,EAAKG,EAAKhH,EAAEiH,MAAKJ,EAAKG,EAAKhH,EAAEiH,KAC7BH,EAAKE,EAAKjH,EAAEmH,MAAKJ,EAAKE,EAAKjH,EAAEmH,KAC7BH,EAAKC,EAAKhH,EAAEkH,MAAKH,EAAKC,EAAKhH,EAAEkH,QAE5B,CACLnH,EAAG,CAAEkH,IAAKL,EAAIO,KAAMP,EAAKE,GAAM,EAAGI,IAAKJ,EAAIM,KAAMN,EAAKF,GACtD5G,EAAG,CAAEiH,IAAKJ,EAAIM,KAAMN,EAAKE,GAAM,EAAGG,IAAKH,EAAIK,KAAML,EAAKF,KAI1DQ,mBAAoB,SAClBC,EACAC,EACAC,EACAC,EACAC,GAEA,IAAKxH,EAAMyH,YAAYJ,EAAOE,GAAQ,MAAO,GAC7C,MAAMG,EAAgB,GAChBC,EAAK,CAACP,EAAGQ,SAAUR,EAAGS,QAAST,EAAGU,KAAMV,EAAGW,QAC3CC,EAAK,CAACV,EAAGM,SAAUN,EAAGO,QAASP,EAAGQ,KAAMR,EAAGS,QAejD,OAdAJ,EAAGxC,SAAQ,SAAU8C,GACfA,EAAGC,SACPF,EAAG7C,SAAQ,SAAUgD,GACnB,GAAIA,EAAGD,QAAS,OAChB,MAAME,EAAMH,EAAGI,WAAWF,EAAIX,GAC1BY,EAAIxH,OAAS,IACfwH,EAAIE,GAAKL,EACTG,EAAIG,GAAKJ,EACTC,EAAIhB,GAAKA,EACTgB,EAAId,GAAKA,EACTI,EAAcnF,KAAK6F,UAIlBV,GAGTc,UAAW,SAAUX,EAASC,EAAMN,GAClC,MAAMiB,EAAMX,EAAKrH,OAAOG,OAClB8H,EAAMb,EAAQpH,OAAOG,OACrB+H,EAAQ3I,EAAMsG,SAASwB,EAAKrH,OAAOgI,EAAM,GAAIZ,EAAQpH,OAAO,IAC5DmI,EAAM5I,EAAMsG,SAASuB,EAAQpH,OAAOiI,EAAM,GAAIZ,EAAKrH,OAAO,IAC1DoI,EAAQ,CACZjB,SAAUe,EACVd,QAASA,EACTC,KAAMA,EACNC,OAAQa,EACR9B,KAAM9G,EAAMwG,SAAS,CAACmC,EAAOd,EAASC,EAAMc,IAE9CC,cAAsB,SAAUvB,GAC9B,OAAOtH,EAAMmH,mBACX0B,EACAA,EAAM/B,KACNQ,EACAA,EAAGR,KACHU,KAGJ,OAAOqB,GAGTC,UAAW,SAAUC,EAAOzI,EAAG8B,GAC7B,IAAKA,EAAM,MAAO,CAAE2E,IAAK,EAAGC,IAAK,GACjC,IAEE5G,EACAc,EAHE6F,EAAMxH,EACRyH,EAAMtH,GAGiB,IAArB0C,EAAKkC,QAAQ,KACflC,EAAO,CAAC,GAAGjE,OAAOiE,KAEK,IAArBA,EAAKkC,QAAQ,IACflC,EAAKG,KAAK,GAEZ,IAAK,IAAId,EAAI,EAAGoB,EAAMT,EAAKxB,OAAQa,EAAIoB,EAAKpB,IAC1CrB,EAAIgC,EAAKX,GACTP,EAAI6H,EAAMC,IAAI5I,GACVc,EAAEZ,GAAKyG,IACTA,EAAM7F,EAAEZ,IAENY,EAAEZ,GAAK0G,IACTA,EAAM9F,EAAEZ,IAGZ,MAAO,CAAEyG,IAAKA,EAAKE,KAAMF,EAAMC,GAAO,EAAGA,IAAKA,EAAKE,KAAMF,EAAMD,IAGjEkC,MAAO,SAAUxI,EAAQyI,GACvB,MAAMC,EAAKD,EAAKxE,GAAG7E,EACjBuJ,EAAKF,EAAKxE,GAAG5E,EACbkB,GAAKlC,EAAMoK,EAAKvE,GAAG7E,EAAIsJ,EAAIF,EAAKvE,GAAG9E,EAAIsJ,GAOzC,OAAO1I,EAAOsC,KANR,SAAU7D,GACZ,MAAO,CACLW,GAAIX,EAAEW,EAAIsJ,GAAMxK,EAAIqC,IAAM9B,EAAEY,EAAIsJ,GAAMxK,EAAIoC,GAC1ClB,GAAIZ,EAAEW,EAAIsJ,GAAMvK,EAAIoC,IAAM9B,EAAEY,EAAIsJ,GAAMzK,EAAIqC,QAMlDqI,MAAO,SAAU5I,EAAQyI,GACvBA,EAAOA,GAAQ,CAAExE,GAAI,CAAE7E,EAAG,EAAGC,EAAG,GAAK6E,GAAI,CAAE9E,EAAG,EAAGC,EAAG,IAEpD,MAAMa,EAAQF,EAAOG,OAAS,EACxB0I,EAAUtJ,EAAMiJ,MAAMxI,EAAQyI,GAC9BK,EAAS,SAAUnJ,GACvB,OAAO,GAAKA,GAAKA,GAAK,GAGxB,GAAc,IAAVO,EAAa,CACf,MAAMK,EAAIsI,EAAQ,GAAGxJ,EACnBmB,EAAIqI,EAAQ,GAAGxJ,EACfoB,EAAIoI,EAAQ,GAAGxJ,EACfQ,EAAIU,EAAI,EAAIC,EAAIC,EAClB,GAAU,IAANZ,EAAS,CACX,MAAMkJ,GAAMzK,EAAKkC,EAAIA,EAAID,EAAIE,GAC3BuI,GAAMzI,EAAIC,EAGZ,MAAO,GAFEuI,EAAKC,GAAMnJ,KACVkJ,EAAKC,GAAMnJ,GACLoJ,OAAOH,GAClB,OAAItI,IAAMC,GAAW,IAANZ,EACb,EAAE,EAAIW,EAAIC,IAAM,EAAID,EAAI,EAAIC,IAAIwI,OAAOH,GAEzC,GAIT,MAAMI,EAAKL,EAAQ,GAAGxJ,EACpB8J,EAAKN,EAAQ,GAAGxJ,EAChB+J,EAAKP,EAAQ,GAAGxJ,EAGlB,IAAIQ,EAAU,EAAIsJ,EAATD,EAAc,EAAIE,EAFpBP,EAAQ,GAAGxJ,EAGhBkB,EAAI,EAAI2I,EAAK,EAAIC,EAAK,EAAIC,EAC1B5I,GAAK,EAAI0I,EAAK,EAAIC,EAClB1I,EAAIyI,EAEN,GAAI3J,EAAM2C,cAAcrC,EAAG,GAAI,CAE7B,GAAIN,EAAM2C,cAAc3B,EAAG,GAEzB,OAAIhB,EAAM2C,cAAc1B,EAAG,GAElB,GAGF,EAAEC,EAAID,GAAGyI,OAAOH,GAGzB,MAAMO,EAAI/K,EAAKkC,EAAIA,EAAI,EAAID,EAAIE,GAC7B8G,EAAK,EAAIhH,EACX,MAAO,EAAE8I,EAAI7I,GAAK+G,IAAM/G,EAAI6I,GAAK9B,GAAI0B,OAAOH,GAK9CvI,GAAKV,EACLW,GAAKX,EACLY,GAAKZ,EAEL,MAAMQ,GAAK,EAAIG,EAAID,EAAIA,GAAK,EAC1BmF,EAAKrF,EAAI,EACTgJ,GAAK,EAAI9I,EAAIA,EAAIA,EAAI,EAAIA,EAAIC,EAAI,GAAKC,GAAK,GAC3C6I,EAAKD,EAAI,EACTE,EAAeD,EAAKA,EAAK5D,EAAKA,EAAKA,EAErC,IAAI8D,EAAI5G,EAAIqC,EAAIE,EAAIE,EACpB,GAAIkE,EAAe,EAAG,CACpB,MAAME,GAAOpJ,EAAI,EAEfe,EAAI9C,EADGmL,EAAMA,EAAMA,GAEnB9J,GAAK0J,GAAK,EAAIjI,GAEdsI,EAAMtL,EADGuB,GAAK,GAAK,EAAIA,EAAI,EAAI,EAAIA,GAGnCgK,EAAK,EADEnL,EAAI4C,GAKb,OAHA6D,EAAK0E,EAAKzL,EAAIwL,EAAM,GAAKnJ,EAAI,EAC7B4E,EAAKwE,EAAKzL,GAAKwL,EAAM9K,GAAO,GAAK2B,EAAI,EACrC8E,EAAKsE,EAAKzL,GAAKwL,EAAM,EAAI9K,GAAO,GAAK2B,EAAI,EAClC,CAAC0E,EAAIE,EAAIE,GAAI4D,OAAOH,GACtB,GAAqB,IAAjBS,EAIT,OAHAC,EAAKF,EAAK,EAAI9K,GAAK8K,IAAO9K,EAAI8K,GAC9BrE,EAAK,EAAIuE,EAAKjJ,EAAI,EAClB4E,GAAMqE,EAAKjJ,EAAI,EACR,CAAC0E,EAAIE,GAAI8D,OAAOH,GAClB,CACL,MAAMc,EAAKtL,EAAKiL,GAGhB,OAFAC,EAAKhL,GAAK8K,EAAKM,GACfhH,EAAKpE,EAAI8K,EAAKM,GACP,CAACJ,EAAK5G,EAAKrC,EAAI,GAAG0I,OAAOH,KAIpCe,OAAQ,SAAUxJ,GAEhB,GAAiB,IAAbA,EAAEF,OAAc,CAClB,MAAMI,EAAIF,EAAE,GACVG,EAAIH,EAAE,GACNI,EAAIJ,EAAE,GACNR,EAAIU,EAAI,EAAIC,EAAIC,EAClB,GAAU,IAANZ,EAAS,CACX,MAAMkJ,GAAMzK,EAAKkC,EAAIA,EAAID,EAAIE,GAC3BuI,GAAMzI,EAAIC,EAGZ,MAAO,GAFEuI,EAAKC,GAAMnJ,KACVkJ,EAAKC,GAAMnJ,GAEhB,OAAIW,IAAMC,GAAW,IAANZ,EACb,EAAE,EAAIW,EAAIC,IAAM,GAAKD,EAAIC,KAE3B,GAIT,GAAiB,IAAbJ,EAAEF,OAAc,CAClB,MAAMI,EAAIF,EAAE,GACVG,EAAIH,EAAE,GACR,OAAIE,IAAMC,EACD,CAACD,GAAKA,EAAIC,IAEZ,GAGT,MAAO,IAGTsJ,UAAW,SAAUnK,EAAGoK,EAAIC,EAAI/J,EAAKgK,GACnC,IAAIC,EACFC,EACAC,EACAC,EACAC,EAAI,EACJlJ,EAAI,EAkBN,MAAMvB,EAAIN,EAAMQ,QAAQJ,EAAGoK,GACrBQ,EAAKhL,EAAMQ,QAAQJ,EAAGqK,GACtBQ,EAAQ3K,EAAET,EAAIS,EAAET,EAAIS,EAAER,EAAIQ,EAAER,EAclC,GAZIY,GACFiK,EAAM5L,EACJC,EAAIsB,EAAER,EAAIkL,EAAGjL,EAAIiL,EAAGlL,EAAIQ,EAAEP,EAAG,GAC3Bf,EAAIsB,EAAEP,EAAIiL,EAAGnL,EAAImL,EAAGjL,EAAIO,EAAET,EAAG,GAC7Bb,EAAIsB,EAAET,EAAImL,EAAGlL,EAAIkL,EAAGnL,EAAIS,EAAER,EAAG,IAEjC8K,EAAM5L,EAAIiM,EAAQ3K,EAAEP,EAAIO,EAAEP,EAAG,OAE7B4K,EAAMrK,EAAET,EAAImL,EAAGlL,EAAIQ,EAAER,EAAIkL,EAAGnL,EAC5B+K,EAAM5L,EAAIiM,EAAO,MAGP,IAARN,GAAqB,IAARC,EACf,MAAO,CAAEG,EAAG,EAAGlJ,EAAG,GAUpB,GAPAkJ,EAAIJ,EAAMC,EACV/I,EAAI+I,EAAMD,GAMLD,EAAO,CAGV,MAAMQ,EAAKlL,EAAMuK,UAAUnK,EAAI,KAAOoK,EAAIC,EAAI/J,GAAK,GAAMqK,EACnDI,EAAKnL,EAAMuK,UAAUnK,EAAI,KAAOoK,EAAIC,EAAI/J,GAAK,GAAMqK,EACzDD,GAAMK,EAAKJ,GAAKA,EAAIG,IAAO,EAC3BL,GAAOnM,EAAIyM,EAAKJ,GAAKrM,EAAIqM,EAAIG,IAAO,EAGtC,MAAO,CAAEH,EAAGA,EAAGlJ,EAAGA,EAAGiJ,GAAIA,EAAID,IAAKA,IAGpCO,YAAa,SAAU3K,GACrB,GAAIA,EAAOG,OAAS,EAAG,MAAO,GAI9B,MAAME,EAAId,EAAMiJ,MAAMxI,EAAQ,CAAEiE,GAAIjE,EAAO,GAAIkE,GAAIlE,EAAO4K,OAAO,GAAG,KAClErK,EAAIF,EAAE,GAAGjB,EAAIiB,EAAE,GAAGhB,EAClBmB,EAAIH,EAAE,GAAGjB,EAAIiB,EAAE,GAAGhB,EAClBoB,EAAIJ,EAAE,GAAGjB,EAAIiB,EAAE,GAAGhB,EAElBuD,EAAK,KAAO,EAAIrC,EAAI,EAAIC,EAAI,EAAIC,EAD5BJ,EAAE,GAAGjB,EAAIiB,EAAE,GAAGhB,GAElBwD,EAAK,IAAM,EAAItC,EAAIC,EAAI,EAAIC,GAC3BoK,EAAK,IAAMpK,EAAIF,GAEjB,GAAIhB,EAAM2C,cAAcU,EAAI,GAAI,CAC9B,IAAKrD,EAAM2C,cAAcW,EAAI,GAAI,CAC/B,IAAIlD,GAAKkL,EAAKhI,EACd,GAAI,GAAKlD,GAAKA,GAAK,EAAG,MAAO,CAACA,GAEhC,MAAO,GAGT,MAAMmL,EAAMjI,EAAKA,EAAK,EAAID,EAAKiI,EAC7BE,EAAKxO,KAAK+B,KAAKwM,GACfd,EAAK,EAAIpH,EAEX,OAAIrD,EAAM2C,cAAc8H,EAAI,GAAW,GAEhC,EAAEe,EAAKlI,GAAMmH,IAAMnH,EAAKkI,GAAMf,GAAIf,QAAO,SAAU7H,GACxD,OAAO,GAAKA,GAAKA,GAAK,MAI1B4F,YAAa,SAAUgE,EAAIC,GACzB,MAAMC,EAAO,CAAC,IAAK,KACjB9I,EAAM8I,EAAK/K,OAEb,IAAK,IAAWgL,EAAKrL,EAAGH,EAAGE,EAAlBmB,EAAI,EAAiBA,EAAIoB,EAAKpB,IAKrC,GAJAmK,EAAMD,EAAKlK,GACXlB,EAAIkL,EAAGG,GAAK3E,IACZ7G,EAAIsL,EAAGE,GAAK3E,IACZ3G,GAAKmL,EAAGG,GAAK1E,KAAOwE,EAAGE,GAAK1E,MAAQ,EAChCxI,EAAI6B,EAAIH,IAAME,EAAG,OAAO,EAE9B,OAAO,GAGTuL,UAAW,SAAU/E,EAAMgF,GACrBA,EAAMjM,EAAEkH,IAAMD,EAAKjH,EAAEkH,MACvBD,EAAKjH,EAAEkH,IAAM+E,EAAMjM,EAAEkH,KAEnB+E,EAAMhM,EAAEiH,IAAMD,EAAKhH,EAAEiH,MACvBD,EAAKhH,EAAEiH,IAAM+E,EAAMhM,EAAEiH,KAEnB+E,EAAM/L,GAAK+L,EAAM/L,EAAEgH,IAAMD,EAAK/G,EAAEgH,MAClCD,EAAK/G,EAAEgH,IAAM+E,EAAM/L,EAAEgH,KAEnB+E,EAAMjM,EAAEmH,IAAMF,EAAKjH,EAAEmH,MACvBF,EAAKjH,EAAEmH,IAAM8E,EAAMjM,EAAEmH,KAEnB8E,EAAMhM,EAAEkH,IAAMF,EAAKhH,EAAEkH,MACvBF,EAAKhH,EAAEkH,IAAM8E,EAAMhM,EAAEkH,KAEnB8E,EAAM/L,GAAK+L,EAAM/L,EAAEiH,IAAMF,EAAK/G,EAAEiH,MAClCF,EAAK/G,EAAEiH,IAAM8E,EAAM/L,EAAEiH,KAEvBF,EAAKjH,EAAEoH,KAAOH,EAAKjH,EAAEkH,IAAMD,EAAKjH,EAAEmH,KAAO,EACzCF,EAAKhH,EAAEmH,KAAOH,EAAKhH,EAAEiH,IAAMD,EAAKhH,EAAEkH,KAAO,EACrCF,EAAK/G,IACP+G,EAAK/G,EAAEkH,KAAOH,EAAK/G,EAAEgH,IAAMD,EAAK/G,EAAEiH,KAAO,GAE3CF,EAAKjH,EAAEqH,KAAOJ,EAAKjH,EAAEmH,IAAMF,EAAKjH,EAAEkH,IAClCD,EAAKhH,EAAEoH,KAAOJ,EAAKhH,EAAEkH,IAAMF,EAAKhH,EAAEiH,IAC9BD,EAAK/G,IACP+G,EAAK/G,EAAEmH,KAAOJ,EAAK/G,EAAEiH,IAAMF,EAAK/G,EAAEgH,MAItCgF,cAAe,SAAUzD,EAAIC,EAAIf,GAC/B,MAAMwE,EAAM1D,EAAGxB,OACbmF,EAAM1D,EAAGzB,OACTjF,EAAI,IACJqK,EAAY1E,GAA8B,GAE5C,GACEwE,EAAInM,EAAEqH,KAAO8E,EAAIlM,EAAEoH,KAAOgF,GAC1BD,EAAIpM,EAAEqH,KAAO+E,EAAInM,EAAEoH,KAAOgF,EAE1B,MAAO,EACFrK,GAAKyG,EAAG6D,IAAM7D,EAAG8D,KAAQ,EAAK,GAAKvK,EACpC,KACGA,GAAK0G,EAAG4D,IAAM5D,EAAG6D,KAAQ,EAAK,GAAKvK,GAI5C,IAAIwK,EAAM/D,EAAGgE,MAAM,IACjBC,EAAMhE,EAAG+D,MAAM,IACfE,EAAQ,CACN,CAAE/P,KAAM4P,EAAI5P,KAAMgQ,MAAOF,EAAI9P,MAC7B,CAAEA,KAAM4P,EAAI5P,KAAMgQ,MAAOF,EAAIE,OAC7B,CAAEhQ,KAAM4P,EAAII,MAAOA,MAAOF,EAAIE,OAC9B,CAAEhQ,KAAM4P,EAAII,MAAOA,MAAOF,EAAI9P,OAGlC+P,EAAQA,EAAM9C,QAAO,SAAUgD,GAC7B,OAAO1M,EAAMyH,YAAYiF,EAAKjQ,KAAKqK,OAAQ4F,EAAKD,MAAM3F,WAGxD,IAAI6F,EAAU,GAEd,OAAqB,IAAjBH,EAAM5L,SAEV4L,EAAMrH,SAAQ,SAAUuH,GACtBC,EAAUA,EAAQxO,OAChB6B,EAAM+L,cAAcW,EAAKjQ,KAAMiQ,EAAKD,MAAOP,OAI/CS,EAAUA,EAAQjD,QAAO,SAAUxK,EAAGuC,GACpC,OAAOkL,EAAQrI,QAAQpF,KAAOuC,MATDkL,GAejCC,WAAY,SAAUlI,EAAIC,EAAIwB,GAC5B,MAAMnC,EAAMW,EAAG9E,EAAI6E,EAAG7E,EACpBoE,EAAMU,EAAG7E,EAAI4E,EAAG5E,EAChBoE,EAAMiC,EAAGtG,EAAI8E,EAAG9E,EAChBsE,EAAMgC,EAAGrG,EAAI6E,EAAG7E,EAChB+M,EAAO7I,EAAMrF,EAAIW,GAAS2E,EAAMrF,EAAIU,GACpCwN,EAAO9I,EAAMpF,EAAIU,GAAS2E,EAAMtF,EAAIW,GACpCyN,EAAO7I,EAAMvF,EAAIW,GAAS6E,EAAMvF,EAAIU,GACpC0N,EAAO9I,EAAMtF,EAAIU,GAAS6E,EAAMxF,EAAIW,GAEpC2N,GAAOvI,EAAG7E,EAAI8E,EAAG9E,GAAK,EACtBqN,GAAOxI,EAAG5E,EAAI6E,EAAG7E,GAAK,EACtBqN,GAAOxI,EAAG9E,EAAIsG,EAAGtG,GAAK,EACtBuN,GAAOzI,EAAG7E,EAAIqG,EAAGrG,GAAK,EAEtBuN,EAAOJ,EAAMJ,EACbS,EAAOJ,EAAMJ,EACbS,EAAOJ,EAAMJ,EACbS,EAAOJ,EAAMJ,EAEbS,EAAMzN,EAAMyF,KAAKwH,EAAKC,EAAKG,EAAMC,EAAMH,EAAKC,EAAKG,EAAMC,GACvD3L,EAAI7B,EAAMyE,KAAKgJ,EAAK/I,GAGtB,IAGEgJ,EAHEjK,EAAI3E,EAAM4F,EAAG5E,EAAI2N,EAAI3N,EAAG4E,EAAG7E,EAAI4N,EAAI5N,GACrC4C,EAAI3D,EAAM6F,EAAG7E,EAAI2N,EAAI3N,EAAG6E,EAAG9E,EAAI4N,EAAI5N,GACnC8N,EAAI7O,EAAMqH,EAAGrG,EAAI2N,EAAI3N,EAAGqG,EAAGtG,EAAI4N,EAAI5N,GAgCrC,OA5BI4D,EAAIkK,IAIFlK,EAAIhB,GAAKA,EAAIkL,KACflK,GAAKpE,GAEHoE,EAAIkK,IACND,EAAIC,EACJA,EAAIlK,EACJA,EAAIiK,IAMFC,EAAIlL,GAAKA,EAAIgB,GACfiK,EAAIC,EACJA,EAAIlK,EACJA,EAAIiK,GAEJC,GAAKtO,EAIToO,EAAIhK,EAAIA,EACRgK,EAAIE,EAAIA,EACRF,EAAI5L,EAAIA,EACD4L,GAGTG,WAAY,SAAU5M,EAAGC,GACvB,OAAOD,EAAIC,ICt4Bf,MAAM4M,EACJC,YAAYC,GACVC,KAAKD,OAAS,GACdC,KAAKtN,KAAM,EACLqN,IACJC,KAAKD,OAASA,EACdC,KAAKtN,IAAMsN,KAAKD,OAAO,GAAGrN,KAI9BuN,UACE,OAAOD,KAAKE,WAGdA,WACE,MACE,IACAF,KAAKD,OACFhL,KAAI,SAAUgG,GACb,OAAO/I,EAAM0D,eAAeqF,EAAMtI,WAEnCkD,KAAK,MACR,IAIJwK,SAASpF,GACPiF,KAAKD,OAAOxL,KAAKwG,GACjBiF,KAAKtN,IAAMsN,KAAKtN,KAAOqI,EAAMrI,IAG/BE,SACE,OAAOoN,KAAKD,OACThL,KAAI,SAAU7D,GACb,OAAOA,EAAE0B,YAEV2I,QAAO,SAAUvI,EAAGC,GACnB,OAAOD,EAAIC,KAIjB8H,MAAM3D,GACJ,OAAO4I,KAAKD,OAAO3I,GAGrB0B,OACE,MAAM5F,EAAI8M,KAAKD,OAEf,IADA,IAAIjH,EAAO5F,EAAE,GAAG4F,OACPrF,EAAI,EAAGA,EAAIP,EAAEN,OAAQa,IAC5BzB,EAAM6L,UAAU/E,EAAM5F,EAAEO,GAAGqF,QAE7B,OAAOA,EAGTsH,OAAO9N,GACL,MAAM8N,EAAS,GAIf,OAHAJ,KAAKD,OAAO5I,SAAQ,SAAUjG,GAC5BkP,EAAO7L,QAAQrD,EAAEkP,OAAO9N,OAEnB,IAAIuN,EAAWO,ICrD1B,MAAM1P,IAAEA,EAAGqI,IAAEA,EAAGC,IAAEA,EAAGrI,IAAEA,EAAGC,IAAEA,EAAGC,KAAEA,GAAIE,KAAEA,IAAS/B,KAC1CmC,GAAKnC,KAAKoC,GAShB,MAAMmH,GACJuH,YAAYO,GACV,IAAIC,EACFD,GAAUA,EAAOlJ,QAAUkJ,EAASE,MAAMC,KAAKC,WAAWpD,QACxDqD,GAAW,EAEf,GAAuB,iBAAZJ,EAAK,GAAiB,CAC/BI,EAAWJ,EAAK1N,OAChB,MAAM+N,EAAU,GAChBL,EAAKnJ,SAAQ,SAAUH,GACrB,CAAC,IAAK,IAAK,KAAKG,SAAQ,SAAU7E,QACR,IAAb0E,EAAM1E,IACfqO,EAAQpM,KAAKyC,EAAM1E,UAIzBgO,EAAOK,EAGT,IAAIC,GAAS,EACb,MAAM/L,EAAMyL,EAAK1N,OAEjB,GAAI8N,GACF,GAAIA,EAAW,EAAG,CAChB,GAAyB,IAArBD,UAAU7N,OACZ,MAAM,IAAIiO,MACR,wEAGJD,GAAS,QAGX,GAAY,IAAR/L,GAAqB,IAARA,GAAqB,IAARA,GAAqB,KAARA,GAChB,IAArB4L,UAAU7N,OACZ,MAAM,IAAIiO,MACR,wEAMR,MAAMnO,EAAOsN,KAAKtN,KACdkO,IAAmB,IAAR/L,GAAqB,KAARA,IACzBwL,GAAUA,EAAO,SAA6B,IAAhBA,EAAO,GAAGtO,EAErCU,EAAUuN,KAAKvN,OAAS,GAC9B,IAAK,IAAI2E,EAAM,EAAG0J,EAAOpO,EAAM,EAAI,EAAG0E,EAAMvC,EAAKuC,GAAO0J,EAAM,CAC5D,IAAI9J,EAAQ,CACVnF,EAAGyO,EAAKlJ,GACRtF,EAAGwO,EAAKlJ,EAAM,IAEZ1E,IACFsE,EAAMjF,EAAIuO,EAAKlJ,EAAM,IAEvB3E,EAAO8B,KAAKyC,GAEd,MAAMrE,EAASqN,KAAKrN,MAAQF,EAAOG,OAAS,EAEtC+K,EAAQqC,KAAKrC,KAAO,CAAC,IAAK,KAC5BjL,GAAKiL,EAAKpJ,KAAK,KACnByL,KAAKe,OAASpD,EAAK/K,OAEnB,MAAM0I,EAAUtJ,EAAMiJ,MAAMxI,EAAQ,CAAEiE,GAAIjE,EAAO,GAAIkE,GAAIlE,EAAOE,KAChEqN,KAAKgB,SAAW1F,EAAQ2F,MAAMnO,GAAMpC,EAAIoC,EAAEhB,GAAK,OAE/CkO,KAAKkB,KAAO,GAEZlB,KAAK7B,IAAM,EACX6B,KAAK5B,IAAM,EACX4B,KAAKmB,SAGPC,2BAA2B1K,EAAIC,EAAIwB,EAAI/F,GAKrC,QAJiB,IAANA,IACTA,EAAI,IAGI,IAANA,EACF,OAAO,IAAImG,GAAO5B,EAAIA,EAAIwB,GAE5B,GAAU,IAAN/F,EACF,OAAO,IAAImG,GAAO7B,EAAIC,EAAIA,GAG5B,MAAM0K,EAAM9I,GAAO+I,OAAO,EAAG5K,EAAIC,EAAIwB,EAAI/F,GACzC,OAAO,IAAImG,GAAO7B,EAAI2K,EAAIE,EAAGpJ,GAG/BiJ,uBAAuBI,EAAGC,EAAGC,EAAGtP,EAAGoK,QAChB,IAANpK,IACTA,EAAI,IAEN,MAAMiP,EAAM9I,GAAO+I,OAAO,EAAGE,EAAGC,EAAGC,EAAGtP,QACpB,IAAPoK,IACTA,EAAKxK,EAAMyE,KAAKgL,EAAGJ,EAAIM,IAEzB,MAAMlF,EAAMD,GAAM,EAAIpK,GAAMA,EAEtBwP,EAAQ5P,EAAMyE,KAAK+K,EAAGE,GAC1BG,GAAMH,EAAE7P,EAAI2P,EAAE3P,GAAK+P,EACnBE,GAAMJ,EAAE5P,EAAI0P,EAAE1P,GAAK8P,EACnBG,EAAMvF,EAAKqF,EACXG,EAAMxF,EAAKsF,EACXG,EAAMxF,EAAKoF,EACXK,EAAMzF,EAAKqF,EAEPK,EAAUV,EAAE5P,EAAIkQ,EAAhBI,EAAwBV,EAAE3P,EAAIkQ,EAClCI,EAAUX,EAAE5P,EAAIoQ,EAAhBG,EAAwBX,EAAE3P,EAAIoQ,EAC9BX,EAAIF,EAAIE,EACRlM,EAAUkM,EAAE1P,GAAKsQ,EAAOZ,EAAE1P,IAAM,EAAIO,GAApCiD,EAA2CkM,EAAEzP,GAAKqQ,EAAOZ,EAAEzP,IAAM,EAAIM,GACrEkD,EAAUiM,EAAE1P,GAAKuQ,EAAOb,EAAE1P,GAAKO,EAA/BkD,EAAqCiM,EAAEzP,GAAKsQ,EAAOb,EAAEzP,GAAKM,EAC1DiQ,EAAM,CAAExQ,EAAG2P,EAAE3P,GAAKwD,EAAOmM,EAAE3P,GAAKO,EAAGN,EAAG0P,EAAE1P,GAAKuD,EAAOmM,EAAE1P,GAAKM,GAC3DkQ,EAAM,CACJzQ,EAAG6P,EAAE7P,GAAKyD,EAAOoM,EAAE7P,IAAM,EAAIO,GAC7BN,EAAG4P,EAAE5P,GAAKwD,EAAOoM,EAAE5P,IAAM,EAAIM,IAGjC,OAAO,IAAImG,GAAOiJ,EAAGa,EAAKC,EAAKZ,GAGjCN,kBACE,OAAOpP,EAGTuQ,WACE,OAAOhK,GAAOgK,WAGL1C,wBACT,OAAOA,EAGTI,UACE,OAAOD,KAAKE,WAGdA,WACE,OAAOlO,EAAM0D,eAAesK,KAAKvN,QAGnC+P,QACE,GAAIxC,KAAKtN,IAAK,OAAO,EACrB,MAAMI,EAAIkN,KAAKvN,OAGbgD,EAAI,CAAC,IAFD3C,EAAE,GAAGjB,EACLiB,EAAE,GAAGhB,EACsB,IAAfkO,KAAKrN,MAAc,IAAM,KAC3C,IAAK,IAAIc,EAAI,EAAGgP,EAAO3P,EAAEF,OAAQa,EAAIgP,EAAMhP,IACzCgC,EAAElB,KAAKzB,EAAEW,GAAG5B,GACZ4D,EAAElB,KAAKzB,EAAEW,GAAG3B,GAEd,OAAO2D,EAAEE,KAAK,KAGhB+M,UAAU9O,GACR,GAAIA,EAAOhB,SAAWoN,KAAKvN,OAAOG,OAChC,MAAM,IAAIiO,MAAM,oCAElBb,KAAKpM,OAASA,EACdoM,KAAKkB,KAAO,GAGdyB,SACE,MAAMC,EAAQ5C,KAAK6C,cACfD,IAAU5C,KAAK8C,SACjB9C,KAAK8C,OAASF,EACd5C,KAAKmB,UAIT0B,cACE,OAAO7C,KAAKvN,OACTsC,KAAI,SAAU7B,EAAGmD,GAChB,MAAO,GAAKA,EAAMnD,EAAErB,EAAIqB,EAAEpB,GAAKoB,EAAEnB,EAAImB,EAAEnB,EAAI,MAE5C4D,KAAK,IAGVwL,SAEEnB,KAAKkB,KAAO,GACZlB,KAAK7L,QAAUnC,EAAMkC,OAAO8L,KAAKvN,OAAQuN,KAAKtN,KAC9CsN,KAAK+C,mBAGPA,mBACE,MAAMtQ,EAASuN,KAAKvN,OACdqD,EAAQ9D,EAAM8D,MAAMrD,EAAO,GAAIA,EAAOuN,KAAKrN,OAAQF,EAAO,IAChEuN,KAAKgD,UAAYlN,EAAQ,EAG3BlD,SACE,OAAOZ,EAAMY,OAAOoN,KAAKiD,WAAWC,KAAKlD,OAG3CoB,cAAczO,EAAQ,EAAG6O,EAAGC,EAAGC,EAAGtP,EAAI,IACpC,MAAM+Q,EAAInR,EAAMwF,gBAAgBpF,EAAGO,GACjCyQ,EAAK,EAAID,EACTxB,EAAI,CACF9P,EAAGsR,EAAI3B,EAAE3P,EAAIuR,EAAK1B,EAAE7P,EACpBC,EAAGqR,EAAI3B,EAAE1P,EAAIsR,EAAK1B,EAAE5P,GAEtB2D,EAAIzD,EAAMqF,SAASjF,EAAGO,GAKxB,MAAO,CAAE4O,EAJH,CACF1P,EAAG4P,EAAE5P,GAAK4P,EAAE5P,EAAI8P,EAAE9P,GAAK4D,EACvB3D,EAAG2P,EAAE3P,GAAK2P,EAAE3P,EAAI6P,EAAE7P,GAAK2D,GAEfgM,EAAAA,EAAGE,EAAAA,EAAGH,EAAAA,EAAGE,EAAAA,GAGvBJ,OAAOlP,EAAGqP,GACRA,EAAIA,GAAKzB,KAAKhF,IAAI5I,GAClB,IAAIoP,EAAIxB,KAAKvN,OAAO,GAChBiP,EAAI1B,KAAKvN,OAAOuN,KAAKrN,OACzB,OAAO4F,GAAO+I,OAAOtB,KAAKrN,MAAO6O,EAAGC,EAAGC,EAAGtP,GAG5CiR,OAAOC,GAGL,GAFAtD,KAAK2C,SACLW,EAAQA,GAAS,IACbtD,KAAKkB,KAAKtO,SAAW0Q,EACvB,OAAOtD,KAAKkB,KAEdlB,KAAKkB,KAAO,GAGZoC,IACA,IAAK,IAAWxQ,EAAGV,EAAVqB,EAAI,EAASA,EAAI6P,EAAO7P,IAC/BrB,EAAIqB,GAAK6P,EAAQ,GACjBxQ,EAAIkN,KAAKxN,QAAQJ,GACjBU,EAAEV,EAAIA,EACN4N,KAAKkB,KAAK3M,KAAKzB,GAEjB,OAAOkN,KAAKkB,KAGdqC,GAAGvM,EAAOwM,GACRA,EAAQA,GAAS,EACjB,MAAMC,EAAMzD,KAAKqD,SACfK,EAAO,GACT,IAAK,IAAWxQ,EAAPO,EAAI,EAAMrB,EAAI,EAAGqB,EAAIgQ,EAAI7Q,OAAQa,IACxCP,EAAIuQ,EAAIhQ,GACJzB,EAAMyE,KAAKvD,EAAG8D,GAASwM,IACzBE,EAAKnP,KAAKrB,GACVd,GAAKqB,EAAIgQ,EAAI7Q,QAGjB,QAAK8Q,EAAK9Q,SACFR,GAAKsR,EAAK9Q,QAGpB+Q,QAAQ3M,GAEN,MAAMD,EAAMiJ,KAAKqD,SACf9Q,EAAIwE,EAAInE,OAAS,EACjBkE,EAAU9E,EAAM8E,QAAQC,EAAKC,GAC7BC,EAAOH,EAAQG,KACfmF,GAAMnF,EAAO,GAAK1E,EAClBa,GAAM6D,EAAO,GAAK1E,EAClBuO,EAAO,GAAMvO,EAGf,IAGEO,EAEOR,EALL4E,EAAQJ,EAAQI,MAClB9E,EAAIgK,EACJwH,EAAKxR,EAGP,IADA8E,GAAS,EACG9E,EAAIgB,EAAK0N,EAAM1O,GAAK0O,EAC9BhO,EAAIkN,KAAKxN,QAAQJ,GACjBE,EAAIN,EAAMyE,KAAKO,EAAOlE,GAClBR,EAAI4E,IACNA,EAAQ5E,EACRsR,EAAKxR,GAOT,OAJAwR,EAAKA,EAAK,EAAI,EAAIA,EAAK,EAAI,EAAIA,EAC/B9Q,EAAIkN,KAAKxN,QAAQoR,GACjB9Q,EAAEV,EAAIwR,EACN9Q,EAAER,EAAI4E,EACCpE,EAGTkI,IAAI5I,GACF,OAAO4N,KAAKxN,QAAQJ,GAGtB4E,MAAMI,GACJ,OAAO4I,KAAKvN,OAAO2E,GAGrB5E,QAAQJ,GACN,OAAI4N,KAAKpM,OACA5B,EAAM2B,kBAAkBvB,EAAG4N,KAAKvN,OAAQuN,KAAKpM,OAAQoM,KAAKtN,KAE5DV,EAAMQ,QAAQJ,EAAG4N,KAAKvN,OAAQuN,KAAKtN,IAAKsN,KAAKpM,QAGtDiQ,QACE,MAAM/Q,EAAIkN,KAAKvN,OACbqR,EAAK,CAAChR,EAAE,IACRiK,EAAIjK,EAAEF,OACR,IAAK,IAAWzB,EAAI4S,EAAXtQ,EAAI,EAAYA,EAAIsJ,EAAGtJ,IAC9BtC,EAAK2B,EAAEW,GACPsQ,EAAMjR,EAAEW,EAAI,GACZqQ,EAAGrQ,GAAK,CACN5B,GAAKkL,EAAItJ,GAAKsJ,EAAK5L,EAAGU,EAAK4B,EAAIsJ,EAAKgH,EAAIlS,EACxCC,GAAKiL,EAAItJ,GAAKsJ,EAAK5L,EAAGW,EAAK2B,EAAIsJ,EAAKgH,EAAIjS,GAI5C,OADAgS,EAAG/G,GAAKjK,EAAEiK,EAAI,GACP,IAAIxE,GAAOuL,GAGpBb,WAAW7Q,GACT,OAAOJ,EAAMQ,QAAQJ,EAAG4N,KAAK7L,QAAQ,GAAI6L,KAAKtN,KAGhDsR,YAAY5R,GACV,OAAOJ,EAAMQ,QAAQJ,EAAG4N,KAAK7L,QAAQ,GAAI6L,KAAKtN,KAGhDuI,QACE,IAAInI,EAAIkN,KAAKvN,OACb,OAAO,IAAI8F,GAAOvG,EAAMiJ,MAAMnI,EAAG,CAAE4D,GAAI5D,EAAE,GAAI6D,GAAI7D,EAAEA,EAAEF,OAAS,MAGhE2J,UAAUnK,GACR,OAAOJ,EAAMuK,UAAUnK,EAAG4N,KAAK7L,QAAQ,GAAI6L,KAAK7L,QAAQ,GAAI6L,KAAKtN,KAGnE0K,cACE,OAAOpL,EAAMoL,YAAY4C,KAAKvN,QAGhCwR,OAAO7R,GACL,OAAO4N,KAAKtN,IAAMsN,KAAKkE,UAAU9R,GAAK4N,KAAKmE,UAAU/R,GAGvD+R,UAAU/R,GACR,MAAME,EAAI0N,KAAKiD,WAAW7Q,GACpB0J,EAAI/K,GAAKuB,EAAET,EAAIS,EAAET,EAAIS,EAAER,EAAIQ,EAAER,GACnC,MAAO,CAAED,GAAIS,EAAER,EAAIgK,EAAGhK,EAAGQ,EAAET,EAAIiK,GAGjCoI,UAAU9R,GAER,MAAMgS,EAAKpE,KAAKiD,WAAW7Q,GACzBiS,EAAKrE,KAAKiD,WAAW7Q,EAAI,KACzBkS,EAAKvT,GAAKqT,EAAGvS,EAAIuS,EAAGvS,EAAIuS,EAAGtS,EAAIsS,EAAGtS,EAAIsS,EAAGrS,EAAIqS,EAAGrS,GAChDgK,EAAKhL,GAAKsT,EAAGxS,EAAIwS,EAAGxS,EAAIwS,EAAGvS,EAAIuS,EAAGvS,EAAIuS,EAAGtS,EAAIsS,EAAGtS,GAClDqS,EAAGvS,GAAKyS,EACRF,EAAGtS,GAAKwS,EACRF,EAAGrS,GAAKuS,EACRD,EAAGxS,GAAKkK,EACRsI,EAAGvS,GAAKiK,EACRsI,EAAGtS,GAAKgK,EAER,MAAM7I,EAAI,CACRrB,EAAGwS,EAAGvS,EAAIsS,EAAGrS,EAAIsS,EAAGtS,EAAIqS,EAAGtS,EAC3BA,EAAGuS,EAAGtS,EAAIqS,EAAGvS,EAAIwS,EAAGxS,EAAIuS,EAAGrS,EAC3BA,EAAGsS,EAAGxS,EAAIuS,EAAGtS,EAAIuS,EAAGvS,EAAIsS,EAAGvS,GAEvB4C,EAAI1D,GAAKmC,EAAErB,EAAIqB,EAAErB,EAAIqB,EAAEpB,EAAIoB,EAAEpB,EAAIoB,EAAEnB,EAAImB,EAAEnB,GAC/CmB,EAAErB,GAAK4C,EACPvB,EAAEpB,GAAK2C,EACPvB,EAAEnB,GAAK0C,EAEP,MAAM8P,EAAI,CACRrR,EAAErB,EAAIqB,EAAErB,EACRqB,EAAErB,EAAIqB,EAAEpB,EAAIoB,EAAEnB,EACdmB,EAAErB,EAAIqB,EAAEnB,EAAImB,EAAEpB,EACdoB,EAAErB,EAAIqB,EAAEpB,EAAIoB,EAAEnB,EACdmB,EAAEpB,EAAIoB,EAAEpB,EACRoB,EAAEpB,EAAIoB,EAAEnB,EAAImB,EAAErB,EACdqB,EAAErB,EAAIqB,EAAEnB,EAAImB,EAAEpB,EACdoB,EAAEpB,EAAIoB,EAAEnB,EAAImB,EAAErB,EACdqB,EAAEnB,EAAImB,EAAEnB,GAQV,MALU,CACRF,EAAG0S,EAAE,GAAKH,EAAGvS,EAAI0S,EAAE,GAAKH,EAAGtS,EAAIyS,EAAE,GAAKH,EAAGrS,EACzCD,EAAGyS,EAAE,GAAKH,EAAGvS,EAAI0S,EAAE,GAAKH,EAAGtS,EAAIyS,EAAE,GAAKH,EAAGrS,EACzCA,EAAGwS,EAAE,GAAKH,EAAGvS,EAAI0S,EAAE,GAAKH,EAAGtS,EAAIyS,EAAE,GAAKH,EAAGrS,GAK7CyS,KAAKpS,GACH,IAAIU,EAAIkN,KAAKvN,OACXgS,EAAK,GACL3I,EAAI,GACJ1E,EAAM,EAQR,IAPA0E,EAAE1E,KAAStE,EAAE,GACbgJ,EAAE1E,KAAStE,EAAE,GACbgJ,EAAE1E,KAAStE,EAAE,GACM,IAAfkN,KAAKrN,QACPmJ,EAAE1E,KAAStE,EAAE,IAGRA,EAAEF,OAAS,GAAG,CACnB6R,EAAK,GACL,IAAK,IAAWC,EAAPjR,EAAI,EAAOlB,EAAIO,EAAEF,OAAS,EAAGa,EAAIlB,EAAGkB,IAC3CiR,EAAK1S,EAAMoD,KAAKhD,EAAGU,EAAEW,GAAIX,EAAEW,EAAI,IAC/BqI,EAAE1E,KAASsN,EACXD,EAAGlQ,KAAKmQ,GAEV5R,EAAI2R,EAEN,OAAO3I,EAGTwC,MAAMlC,EAAIhJ,GAER,GAAW,IAAPgJ,GAAchJ,EAChB,OAAO4M,KAAK1B,MAAMlL,GAAI3E,KAExB,GAAW,IAAP2E,EACF,OAAO4M,KAAK1B,MAAMlC,GAAIqC,MAIxB,MAAM3C,EAAIkE,KAAKwE,KAAKpI,GACduI,EAAS,CACblW,KACiB,IAAfuR,KAAKrN,MACD,IAAI4F,GAAO,CAACuD,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAC1B,IAAIvD,GAAO,CAACuD,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,KACtC2C,MACiB,IAAfuB,KAAKrN,MACD,IAAI4F,GAAO,CAACuD,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAC1B,IAAIvD,GAAO,CAACuD,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,KACtC8I,KAAM9I,GAUR,OANA6I,EAAOlW,KAAK0P,IAAMnM,EAAM+C,IAAI,EAAG,EAAG,EAAGiL,KAAK7B,IAAK6B,KAAK5B,KACpDuG,EAAOlW,KAAK2P,IAAMpM,EAAM+C,IAAIqH,EAAI,EAAG,EAAG4D,KAAK7B,IAAK6B,KAAK5B,KACrDuG,EAAOlG,MAAMN,IAAMnM,EAAM+C,IAAIqH,EAAI,EAAG,EAAG4D,KAAK7B,IAAK6B,KAAK5B,KACtDuG,EAAOlG,MAAML,IAAMpM,EAAM+C,IAAI,EAAG,EAAG,EAAGiL,KAAK7B,IAAK6B,KAAK5B,KAGhDhL,GAKLA,EAAKpB,EAAM+C,IAAI3B,EAAIgJ,EAAI,EAAG,EAAG,GACtBuI,EAAOlG,MAAMH,MAAMlL,GAAI3E,MALrBkW,EAQXE,UACE,MAAMF,EAAS,GACf,IAAItJ,EAAQ,GAwBZ,OAtBA2E,KAAKrC,KAAKxG,QACR,SAAUyG,GACR,IAAIkH,EAAM,SAAU5T,GAClB,OAAOA,EAAE0M,IAEP9K,EAAIkN,KAAK7L,QAAQ,GAAGY,IAAI+P,GAC5BH,EAAO/G,GAAO5L,EAAMsK,OAAOxJ,GACR,IAAfkN,KAAKrN,QACPG,EAAIkN,KAAK7L,QAAQ,GAAGY,IAAI+P,GACxBH,EAAO/G,GAAO+G,EAAO/G,GAAKzN,OAAO6B,EAAMsK,OAAOxJ,KAEhD6R,EAAO/G,GAAO+G,EAAO/G,GAAKlC,QAAO,SAAUtJ,GACzC,OAAOA,GAAK,GAAKA,GAAK,KAExBiJ,EAAQA,EAAMlL,OAAOwU,EAAO/G,GAAKmH,KAAK/S,EAAM4N,cAC5CsD,KAAKlD,OAGT2E,EAAOK,OAAS3J,EAAM0J,KAAK/S,EAAM4N,YAAYlE,QAAO,SAAUxK,EAAGkG,GAC/D,OAAOiE,EAAM/E,QAAQpF,KAAOkG,KAGvBuN,EAGT7L,OACE,MAAM+L,EAAU7E,KAAK6E,UACnBF,EAAS,GAMX,OALA3E,KAAKrC,KAAKxG,QACR,SAAU7E,GACRqS,EAAOrS,GAAKN,EAAM8I,UAAUkF,KAAM1N,EAAGuS,EAAQvS,KAC7C4Q,KAAKlD,OAEF2E,EAGTM,SAASlK,GACP,MAAMmK,EAAQlF,KAAKlH,OACjBqM,EAAQpK,EAAMjC,OAChB,OAAO9G,EAAMyH,YAAYyL,EAAOC,GAGlC/E,OAAOhO,EAAGE,GACR,QAAiB,IAANA,EAAmB,CAC5B,MAAMY,EAAI8M,KAAKhF,IAAI5I,GACjBkF,EAAI0I,KAAKiE,OAAO7R,GACZW,EAAM,CACVG,EAAGA,EACHoE,EAAGA,EACHzF,EAAGqB,EAAErB,EAAIyF,EAAEzF,EAAIS,EACfR,EAAGoB,EAAEpB,EAAIwF,EAAExF,EAAIQ,GAKjB,OAHI0N,KAAKtN,MACPK,EAAIhB,EAAImB,EAAEnB,EAAIuF,EAAEvF,EAAIO,GAEfS,EAET,GAAIiN,KAAKgB,QAAS,CAChB,MAAMoE,EAAKpF,KAAKiE,OAAO,GACrB5D,EAASL,KAAKvN,OAAOsC,KAAI,SAAUjC,GACjC,MAAMC,EAAM,CACVlB,EAAGiB,EAAEjB,EAAIO,EAAIgT,EAAGvT,EAChBC,EAAGgB,EAAEhB,EAAIM,EAAIgT,EAAGtT,GAKlB,OAHIgB,EAAEf,GAAKqT,EAAGrT,IACZgB,EAAIhB,EAAIe,EAAEf,EAAIK,EAAIgT,EAAGrT,GAEhBgB,KAEX,MAAO,CAAC,IAAIwF,GAAO8H,IAErB,OAAOL,KAAKzE,SAASxG,KAAI,SAAUU,GACjC,OAAIA,EAAEuL,QACGvL,EAAE2K,OAAOhO,GAAG,GAEdqD,EAAE5G,MAAMuD,MAInBiT,SACE,GAAmB,IAAfrF,KAAKrN,MAAa,CACpB,MAAMgH,EAAK3H,EAAM8D,MAAMkK,KAAKvN,OAAO,GAAIuN,KAAKvN,OAAO,GAAIuN,KAAKvN,OAAO,IAC7DuH,EAAKhI,EAAM8D,MAAMkK,KAAKvN,OAAO,GAAIuN,KAAKvN,OAAO,GAAIuN,KAAKvN,OAAO,IACnE,GAAKkH,EAAK,GAAKK,EAAK,GAAOL,EAAK,GAAKK,EAAK,EAAI,OAAO,EAEvD,MAAMsL,EAAKtF,KAAKiE,OAAO,GACjBsB,EAAKvF,KAAKiE,OAAO,GACvB,IAAIxO,EAAI6P,EAAGzT,EAAI0T,EAAG1T,EAAIyT,EAAGxT,EAAIyT,EAAGzT,EAIhC,OAHIkO,KAAKtN,MACP+C,GAAK6P,EAAGvT,EAAIwT,EAAGxT,GAEVrB,EAAIG,GAAK4E,IAAMtE,GAAK,EAG7BoK,SAEE,IAAI9H,EAIF+R,EAHApJ,EAAK,EACLhJ,EAAK,EACL0N,EAAO,IAEP2E,EAAQ,GACRC,EAAQ,GAENb,EAAU7E,KAAK6E,UAAUG,OAQ7B,KAP4B,IAAxBH,EAAQvO,QAAQ,KAClBuO,EAAU,CAAC,GAAG1U,OAAO0U,KAEK,IAAxBA,EAAQvO,QAAQ,IAClBuO,EAAQtQ,KAAK,GAGV6H,EAAKyI,EAAQ,GAAIpR,EAAI,EAAGA,EAAIoR,EAAQjS,OAAQa,IAC/CL,EAAKyR,EAAQpR,GACb+R,EAAUxF,KAAK1B,MAAMlC,EAAIhJ,GACzBoS,EAAQrH,IAAM/B,EACdoJ,EAAQpH,IAAMhL,EACdqS,EAAMlR,KAAKiR,GACXpJ,EAAKhJ,EAgCP,OA5BAqS,EAAMtO,SAAQ,SAAUT,GAGtB,IAFA0F,EAAK,EACLhJ,EAAK,EACEA,GAAM,GACX,IAAKA,EAAKgJ,EAAK0E,EAAM1N,GAAM,KAAUA,GAAM0N,EAEzC,GADA0E,EAAU9O,EAAG4H,MAAMlC,EAAIhJ,IAClBoS,EAAQH,SAAU,CAErB,GADAjS,GAAM0N,EACFpQ,EAAI0L,EAAKhJ,GAAM0N,EAEjB,MAAO,GAET0E,EAAU9O,EAAG4H,MAAMlC,EAAIhJ,GACvBoS,EAAQrH,IAAMnM,EAAM+C,IAAIqH,EAAI,EAAG,EAAG1F,EAAGyH,IAAKzH,EAAG0H,KAC7CoH,EAAQpH,IAAMpM,EAAM+C,IAAI3B,EAAI,EAAG,EAAGsD,EAAGyH,IAAKzH,EAAG0H,KAC7CsH,EAAMnR,KAAKiR,GACXpJ,EAAKhJ,EACL,MAIFgJ,EAAK,IACPoJ,EAAU9O,EAAG4H,MAAMlC,EAAI,GACvBoJ,EAAQrH,IAAMnM,EAAM+C,IAAIqH,EAAI,EAAG,EAAG1F,EAAGyH,IAAKzH,EAAG0H,KAC7CoH,EAAQpH,IAAM1H,EAAG0H,IACjBsH,EAAMnR,KAAKiR,OAGRE,EAGT7W,MAAMyD,GACJ,MAAMK,EAAQqN,KAAKrN,MACnB,IAAIgT,GAAa,EAIjB,GAHiB,mBAANrT,IACTqT,EAAarT,GAEXqT,GAAwB,IAAVhT,EAChB,OAAOqN,KAAK6D,QAAQhV,MAAM8W,GAI5B,MAAM3C,EAAYhD,KAAKgD,UACjBoB,EAAKuB,EAAaA,EAAW,GAAKrT,EAClC+R,EAAKsB,EAAaA,EAAW,GAAKrT,EAClCpB,EAAI,CAAC8O,KAAKI,OAAO,EAAG,IAAKJ,KAAKI,OAAO,EAAG,KACxC3N,EAASuN,KAAKvN,OACdqR,EAAK,GACL/N,EAAI/D,EAAMkG,KAAKhH,EAAE,GAAIA,EAAE,GAAGgC,EAAGhC,EAAE,GAAIA,EAAE,GAAGgC,GAE9C,IAAK6C,EACH,MAAM,IAAI8K,MAAM,mDAWlB,MANA,CAAC,EAAG,GAAG1J,SAAQ,SAAU/E,GACvB,MAAMU,EAAKgR,EAAG1R,EAAIO,GAASX,EAAM4D,KAAKnD,EAAOL,EAAIO,IACjDG,EAAEjB,IAAMO,EAAIiS,EAAKD,GAAMlT,EAAEkB,GAAGkF,EAAEzF,EAC9BiB,EAAEhB,IAAMM,EAAIiS,EAAKD,GAAMlT,EAAEkB,GAAGkF,EAAExF,KAG3B6T,GAeL,CAAC,EAAG,GAAGxO,SAAQ,SAAU/E,GACvB,GAAc,IAAVO,IAAiBP,EAArB,CACA,IAAIU,EAAIL,EAAOL,EAAI,GACfwT,EAAK,CACP/T,EAAGiB,EAAEjB,EAAIkE,EAAElE,EACXC,EAAGgB,EAAEhB,EAAIiE,EAAEjE,GAET+T,EAAKF,EAAaA,GAAYvT,EAAI,GAAKO,GAASL,EAChDqT,IAAe3C,IAAW6C,GAAMA,GACpC,IAAIpR,EAAI1D,GAAK6U,EAAG/T,EAAI+T,EAAG/T,EAAI+T,EAAG9T,EAAI8T,EAAG9T,GACrC8T,EAAG/T,GAAK4C,EACRmR,EAAG9T,GAAK2C,EACRqP,EAAG1R,EAAI,GAAK,CACVP,EAAGiB,EAAEjB,EAAIgU,EAAKD,EAAG/T,EACjBC,EAAGgB,EAAEhB,EAAI+T,EAAKD,EAAG9T,OAGd,IAAIyG,GAAOuL,KA7BhB,CAAC,EAAG,GAAG3M,SAAS/E,IACd,GAAc,IAAVO,GAAiBP,EAAG,OACxB,MAAMU,EAAIgR,EAAG1R,EAAIO,GACXL,EAAI0N,KAAKiD,WAAW7Q,GACpBuE,EAAK,CAAE9E,EAAGiB,EAAEjB,EAAIS,EAAET,EAAGC,EAAGgB,EAAEhB,EAAIQ,EAAER,GACtCgS,EAAG1R,EAAI,GAAKJ,EAAMkG,KAAKpF,EAAG6D,EAAIZ,EAAGtD,EAAOL,EAAI,OAEvC,IAAImG,GAAOuL,IAyBtBgC,QAAQtJ,EAAIC,EAAIsJ,EAAIC,GAClBvJ,OAAmB,IAAPA,EAAqBD,EAAKC,EACtC,MAAMwJ,EAAUjG,KAAKzE,SACnB1G,EAAMoR,EAAQrT,OACdsT,EAAU,GAEZ,IACEpT,EADEqT,EAAU,GAEZC,EAAO,EACPC,EAAOrG,KAAKpN,SAEd,MAAM0T,OAA0B,IAAPP,QAAoC,IAAPC,EAEtD,SAASO,EAAuB9Q,EAAGkK,EAAG0G,EAAMD,EAAMI,GAChD,OAAO,SAAUtV,GACf,MAAM4C,EAAKsS,EAAOC,EAChBtS,GAAMqS,EAAOI,GAAQH,EACrB/T,EAAIqN,EAAIlK,EACV,OAAOzD,EAAM+C,IAAI7D,EAAG,EAAG,EAAGuE,EAAI3B,EAAKxB,EAAGmD,EAAI1B,EAAKzB,IAKnD2T,EAAQ9O,SAAQ,SAAUqO,GACxB,MAAMgB,EAAOhB,EAAQ5S,SACjB0T,GACFJ,EAAQ3R,KACNiR,EAAQ3W,MAAM0X,EAAuB/J,EAAIuJ,EAAIM,EAAMD,EAAMI,KAE3DL,EAAQ5R,KACNiR,EAAQ3W,MAAM0X,GAAwB9J,GAAKuJ,EAAIK,EAAMD,EAAMI,OAG7DN,EAAQ3R,KAAKiR,EAAQ3W,MAAM2N,IAC3B2J,EAAQ5R,KAAKiR,EAAQ3W,OAAO4N,KAE9B2J,GAAQI,KAIVL,EAAUA,EACPpR,KAAI,SAAUU,GAOb,OANA3C,EAAI2C,EAAEhD,OACFK,EAAE,GACJ2C,EAAEhD,OAAS,CAACK,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,IAEhC2C,EAAEhD,OAAS,CAACK,EAAE,GAAIA,EAAE,GAAIA,EAAE,IAErB2C,KAERgR,UAGE,MAACC,EAAKR,EAAQ,GAAGzT,OAAO,GAC3BkU,EAAKT,EAAQrR,EAAM,GAAGpC,OAAOyT,EAAQrR,EAAM,GAAGpC,OAAOG,OAAS,GAC9DgU,EAAKT,EAAQtR,EAAM,GAAGpC,OAAO0T,EAAQtR,EAAM,GAAGpC,OAAOG,OAAS,GAC9DiU,EAAKV,EAAQ,GAAG1T,OAAO,GACvBqU,EAAK9U,EAAMsG,SAASsO,EAAIF,GACxBK,EAAK/U,EAAMsG,SAASqO,EAAIE,GACxBG,EAAW,CAACF,GAAI3W,OAAO+V,GAAS/V,OAAO,CAAC4W,IAAK5W,OAAOgW,GAGtD,OAFSa,EAASpU,OAEX,IAAIiN,EAAWmH,GAGxBC,cAAczK,EAAIC,EAAIjD,GACpBiD,EAAKA,GAAMD,EACX,MAAMsJ,EAAU9F,KAAK8F,QAAQtJ,EAAIC,GAAIsD,OAC/BmH,EAAS,GACf,IAAK,IAAIzT,EAAI,EAAGoB,EAAMiR,EAAQlT,OAAQa,EAAIoB,EAAM,EAAGpB,IAAK,CACtD,MAAMoH,EAAQ7I,EAAMwI,UAClBsL,EAAQrS,GACRqS,EAAQjR,EAAMpB,GACd+F,GAEFqB,EAAMjB,SAASM,QAAUzG,EAAI,EAC7BoH,EAAMd,OAAOG,QAAUzG,EAAIoB,EAAM,EAAI,EACrCqS,EAAO3S,KAAKsG,GAEd,OAAOqM,EAGT7M,WAAWU,EAAOvB,GAChB,OAAKuB,EACDA,EAAMrE,IAAMqE,EAAMpE,GACbqJ,KAAKmH,eAAepM,IAEzBA,aAAiBxC,KACnBwC,EAAQA,EAAMQ,UAETyE,KAAKoH,gBACVpH,KAAKzE,SACLR,EACAvB,IAViBwG,KAAKqH,eAAe7N,GAczC2N,eAAejM,GACb,MAAMxC,EAAKK,EAAImC,EAAKxE,GAAG7E,EAAGqJ,EAAKvE,GAAG9E,GAChC8G,EAAKI,EAAImC,EAAKxE,GAAG5E,EAAGoJ,EAAKvE,GAAG7E,GAC5B8G,EAAKI,EAAIkC,EAAKxE,GAAG7E,EAAGqJ,EAAKvE,GAAG9E,GAC5BgH,EAAKG,EAAIkC,EAAKxE,GAAG5E,EAAGoJ,EAAKvE,GAAG7E,GAC9B,OAAOE,EAAMqJ,MAAM2E,KAAKvN,OAAQyI,GAAMQ,QAAQtJ,IAC5C,IAAIU,EAAIkN,KAAKhF,IAAI5I,GACjB,OAAOJ,EAAMwC,QAAQ1B,EAAEjB,EAAG6G,EAAIE,IAAO5G,EAAMwC,QAAQ1B,EAAEhB,EAAG6G,EAAIE,MAIhEwO,eAAe7N,GAKb,MAAMyM,EAAUjG,KAAKzE,SACnB1G,EAAMoR,EAAQrT,OAAS,EACvB+L,EAAU,GAEZ,IAAK,IAAWgG,EAAQlW,EAAMgQ,EAArBhL,EAAI,EAAwBA,EAAIoB,EAAKpB,IAC5ChF,EAAOwX,EAAQ5I,MAAM5J,EAAGA,EAAI,GAC5BgL,EAAQwH,EAAQ5I,MAAM5J,EAAI,GAC1BkR,EAAS3E,KAAKoH,gBAAgB3Y,EAAMgQ,EAAOjF,GAC3CmF,EAAQpK,QAAQoQ,GAElB,OAAOhG,EAGTyI,gBAAgB9M,EAAIC,EAAIf,GACtB,MAAMgF,EAAQ,GAEdlE,EAAGnD,SAAQ,SAAU5E,GACnBgI,EAAGpD,SAAQ,SAAUtD,GACftB,EAAE0S,SAASpR,IACb2K,EAAMjK,KAAK,CAAE9F,KAAM8D,EAAGkM,MAAO5K,UAKnC,IAAI6F,EAAgB,GAWpB,OAVA8E,EAAMrH,SAAQ,SAAUuH,GACtB,MAAMiG,EAAS3S,EAAM+L,cACnBW,EAAKjQ,KACLiQ,EAAKD,MACLjF,GAEEmL,EAAO/R,OAAS,IAClB8G,EAAgBA,EAAcvJ,OAAOwU,OAGlCjL,EAGT4N,KAAKC,GAEH,OADAA,EAAiBA,GAAkB,GAC5BvH,KAAKwH,SAASD,EAAgB,IAGvCE,OAAO5L,EAAI6L,EAAKjS,EAAGkK,GACjB,MAAM7D,GAAK6D,EAAIlK,GAAK,EAClB6E,EAAK0F,KAAKhF,IAAIvF,EAAIqG,GAClBvB,EAAKyF,KAAKhF,IAAI2E,EAAI7D,GAClB6L,EAAM3V,EAAMyE,KAAKoF,EAAI6L,GACrBlL,EAAKxK,EAAMyE,KAAKoF,EAAIvB,GACpBmC,EAAKzK,EAAMyE,KAAKoF,EAAItB,GACtB,OAAO7J,EAAI8L,EAAKmL,GAAOjX,EAAI+L,EAAKkL,GAGlCH,SAASD,EAAgBK,GACvB,IAEEC,EAFEC,EAAM,EACRC,EAAM,EAGR,EAAG,CACDF,EAAS,EAGTE,EAAM,EAGN,IACEC,EACAC,EACAxI,EACAyI,EAKAC,EATET,EAAM1H,KAAKhF,IAAI8M,GAOfM,GAAY,EACdC,GAAY,EAIVC,EAAMP,EACRQ,EAAS,EAIX,EAAG,CAwBD,GAvBAF,EAAYD,EACZF,EAAWzI,EACX6I,GAAOR,EAAMC,GAAO,EAGpBC,EAAMhI,KAAKhF,IAAIsN,GACfL,EAAMjI,KAAKhF,IAAI+M,GAEftI,EAAMzN,EAAM4M,WAAW8I,EAAKM,EAAKC,GAGjCxI,EAAI+I,SAAW,CACb7N,MAAOmN,EACPlN,IAAKmN,GAIPK,EADYpI,KAAKyH,OAAOhI,EAAKiI,EAAKI,EAAKC,IAClBR,EAErBY,EAAOE,IAAcD,EAChBD,IAAMI,EAASR,GAGhBK,EAAW,CAEb,GAAIL,GAAO,EAAG,CAMZ,GAJAtI,EAAI+I,SAAS5N,IAAM2N,EAAS,EAC5BL,EAAWzI,EAGPsI,EAAM,EAAG,CACX,IAAIzV,EAAI,CACNT,EAAG4N,EAAI5N,EAAI4N,EAAI5L,EAAIlD,EAAI8O,EAAIE,GAC3B7N,EAAG2N,EAAI3N,EAAI2N,EAAI5L,EAAIjD,EAAI6O,EAAIE,IAE7BF,EAAIE,GAAK3N,EAAM8D,MAAM,CAAEjE,EAAG4N,EAAI5N,EAAGC,EAAG2N,EAAI3N,GAAKQ,EAAG0N,KAAKhF,IAAI,IAE3D,MAGF+M,IAAaA,EAAMD,GAAO,OAG1BC,EAAMO,SAEAH,GAAQN,IAAW,KAE7B,GAAIA,GAAU,IACZ,MAKFK,EAAWA,GAAsBzI,EACjCmI,EAAQrT,KAAK2T,GACbJ,EAAMS,QACCR,EAAM,GACf,OAAOH,GC/6BJ,IAAMa,GAAY,CAErBC,MAAO,EAEPC,OAAQ,EAERC,KAAM,EAENC,IAAK,EAELC,KAAM,KAcGC,GAAa,CACtBC,QAAS,UACTC,QAAS,WCrBN,SAASC,GAAazW,GACzB,GAAqB,IAAlBA,EAAOG,OACN,MAAO,CACHrE,MAAO,EACPC,OAAQ,EACRqD,EAAG,EACHC,EAAG,GAGX,IAAIqX,EAAQC,EAAAA,EACRC,EAAQD,EAAAA,EACRE,GAASF,EAAAA,EACTG,GAASH,EAAAA,EACb,IAAI,IAAIhS,KAAO3E,EAAQ,CACnB,IAAM+W,EAAO/W,EAAO2E,GACjBoS,EAAK,GAAKL,IACTA,EAAQK,EAAK,IAGbA,EAAK,GAAKF,IACVA,EAAQE,EAAK,IAGbA,EAAK,GAAKH,IACVA,EAAQG,EAAK,IAGbA,EAAK,GAAKD,IACVA,EAAQC,EAAK,IAGrB,MAAO,CAEHjb,MAAOS,KAAKgK,IAAIsQ,EAAQH,EAAO,IAC/B3a,OAAQQ,KAAKgK,IAAIuQ,EAAQF,EAAO,IAChCxX,EAAGsX,EACHrX,EAAGuX,GAIX,SAASI,GAAI5X,GACT,OAAOA,EAAIA,EAER,SAAS6X,GAAMxY,EAAGyY,GACrB,OAAOF,GAAIvY,EAAE,GAAKyY,EAAE,IAAMF,GAAIvY,EAAE,GAAKyY,EAAE,IAMpC,SAASC,GAAqB9W,EAAG5B,EAAGyY,GACvC,IAAMxP,EAAKuP,GAAMxY,EAAGyY,GACpB,GAAW,IAAPxP,EAAU,OAAOuP,GAAM5W,EAAG5B,GAC9B,IAAIkB,IAAMU,EAAE,GAAK5B,EAAE,KAAOyY,EAAE,GAAKzY,EAAE,KAAO4B,EAAE,GAAK5B,EAAE,KAAOyY,EAAE,GAAKzY,EAAE,KAAOiJ,EAE1E,OADA/H,EAAIpD,KAAKgK,IAAI,EAAGhK,KAAK+J,IAAI,EAAG3G,IACrBsX,GAAM5W,EAAG,CAAE5B,EAAE,GAAKkB,GAAKuX,EAAE,GAAKzY,EAAE,IAAKA,EAAE,GAAKkB,GAAKuX,EAAE,GAAKzY,EAAE,MAG9D,SAAS2Y,GAA4BC,EAASC,GACjD,IAAMC,EAAO,CACTC,QAAS,KACTC,MAAO,KACPC,MAAO,KACPC,IAAK,KACLC,QAASjB,EAAAA,GAwBb,OAtBAkB,OAAOC,KAAKT,GAAS3S,SAAQ,SAAAqT,GACzB,IAAKA,IAAQ/B,GAAUK,KAAvB,CAGA,IAAI2B,EAAKX,EAAQU,GACjBF,OAAOC,KAAKR,GAAO5S,SAAQ,SAAAuT,GACvB,IAAKA,IAAQjC,GAAUK,KAAvB,CAGA,IAAIpE,EAAKqF,EAAMW,GACTjU,EAAOiT,GAAMe,EAAI/F,GACpBjO,EAAOuT,EAAKK,SACXC,OAAOK,OAAOX,EAAM,CAChBK,QAAS5T,EACTwT,SAAUO,EACVN,MAAOO,EACPN,OAAQO,EACRN,IAAK1F,YAKdsF,EAmCX,SAASY,GAAqB9X,EAAG+X,EAAKC,EAAOC,GACzC,OAAGF,IAAQpC,GAAUI,IACV,CAAC/V,EAAE,GAAIA,EAAE,GAAGiY,GAEpBF,IAAQpC,GAAUE,OACV,CAAC7V,EAAE,GAAIA,EAAE,GAAGiY,GAEpBF,IAAQpC,GAAUG,KACV,CAAC9V,EAAE,GAAGgY,EAAOhY,EAAE,IAEvB+X,IAAQpC,GAAUC,MACV,CAAC5V,EAAE,GAAGgY,EAAOhY,EAAE,SAD1B,EAKG,SAASkY,GAAatU,EAAIC,GAAoF,IAAhFsU,EAASxK,UAAA7N,OAAA6N,QAAAlL,IAAAkL,UAAAlL,GAAAkL,UAAGgI,GAAAA,GAAUI,IAAKqC,EAAOzK,UAAA7N,OAAA6N,QAAAlL,IAAAkL,UAAAlL,GAAAkL,UAAGgI,GAAAA,GAAUI,IAAKsC,EAAQ1K,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EAAG2K,EAAQ3K,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EACxGqK,EAAQ9b,KAAKgK,IAAIhK,KAAK0B,KAAKgG,EAAG,GAAKC,EAAG,IAAI,GAAIwU,GAC9CJ,EAAQ/b,KAAKgK,IAAIhK,KAAK0B,KAAKgG,EAAG,GAAKC,EAAG,IAAI,GAAIyU,GAC9CC,EAAMT,GAAqBlU,EAAIuU,EAAWH,EAAOC,GACjDO,EAAMV,GAAqBjU,EAAIuU,EAASJ,EAAOC,GAC/CQ,EAAY,CAAC9C,GAAUI,IAAKJ,GAAUG,MAAM4C,SAASN,IAAY,EAAI,EACrEO,EAAgB,CAAChD,GAAUI,IAAKJ,GAAUE,QAAQ6C,SAASN,GAC3DQ,EAAOD,EAAgB9U,EAAG,GAAKA,EAAG,GAAK4U,EACvCI,EAAOF,EAAgB9U,EAAG,GAAK4U,EAAY5U,EAAG,GACpD,MAAA,GAAAxG,OAAAyb,EACOP,GAAGO,EACHN,GAAG,CACNI,EAAMC,IA6BP,SAASE,GAAezZ,EAAG0Z,EAAIC,EAAIC,EAAMC,EAAMC,EAAMC,EAAMC,EAAIC,GACpE,IAAIzV,EAAK5H,KAAKgC,IAAI,EAAEoB,EAAG,IAAI4Z,EAAKF,GAAM,EAAE1Z,GAAG,EAAEA,IAAI8Z,EAAKF,GAAQ5Z,EAAIA,GAAKga,EAAKF,GACxErV,EAAK7H,KAAKgC,IAAI,EAAEoB,EAAG,IAAI6Z,EAAKF,GAAM,EAAE3Z,GAAG,EAAEA,IAAI+Z,EAAKF,GAAQ7Z,EAAIA,GAAKia,EAAKF,GAC5E,OAAQnd,KAAK8B,MAAM8F,EAAIC,GAAM,GAAI7H,KAAKoC,GAsBjC,SAASkb,GAAe7Z,EAAQiE,EAAIC,GAA8F,IAA1FsU,EAASxK,UAAA7N,OAAA6N,QAAAlL,IAAAkL,UAAAlL,GAAAkL,UAAGgI,GAAAA,GAAUI,IAAKqC,EAAOzK,UAAA7N,OAAA6N,QAAAlL,IAAAkL,UAAAlL,GAAAkL,UAAGgI,GAAAA,GAAUI,IAAKsC,EAAQ1K,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GAAI2K,EAAQ3K,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GAAI8L,EAAM9L,UAAA7N,OAAA6N,EAAAA,kBAAAlL,EAC7HiX,EAAUxd,KAAK0B,IAAIua,EAAYC,GAG/BuB,EAAmBxB,IAAcxC,GAAUI,KAAOoC,IAAcxC,GAAUE,OAEhF,OADAlW,EAAOG,OAAS,EACR4Z,GACJ,KAAK,EAED,GAAGvB,IAAcxC,GAAUI,IAAK,CAC5B,IAAM/W,EAAI9C,KAAK+J,IAAIrC,EAAG,GAAIC,EAAG,IACvB+V,EAAK5a,EAAIsZ,EACf3Y,EAAO8B,KAAK,CAACmC,EAAG,GAAIgW,IACpBja,EAAO8B,KAAK,CAACoC,EAAG,GAAI+V,IAExB,GAAGzB,IAAcxC,GAAUE,OAAQ,CAC/B,IAAM7W,EAAI9C,KAAKgK,IAAItC,EAAG,GAAIC,EAAG,IACvB+V,EAAK5a,EAAIsZ,EACf3Y,EAAO8B,KAAK,CAACmC,EAAG,GAAIgW,IACpBja,EAAO8B,KAAK,CAACoC,EAAG,GAAI+V,IAExB,GAAGzB,IAAcxC,GAAUG,KAAM,CAC7B,IAAM/W,EAAI7C,KAAK+J,IAAIrC,EAAG,GAAIC,EAAG,IACvBgW,EAAK9a,EAAIsZ,EACf1Y,EAAO8B,KAAK,CAACoY,EAAIjW,EAAG,KACpBjE,EAAO8B,KAAK,CAACoY,EAAIhW,EAAG,KAExB,GAAGsU,IAAcxC,GAAUC,MAAO,CAC9B,IAAM7W,EAAI7C,KAAKgK,IAAItC,EAAG,GAAIC,EAAG,IACvBgW,EAAK9a,EAAIsZ,EACf1Y,EAAO8B,KAAK,CAACoY,EAAIjW,EAAG,KACpBjE,EAAO8B,KAAK,CAACoY,EAAIhW,EAAG,KAExB,MACJ,KAAK,EACL,KAAK,EACD,GAAG4V,EACKE,GAKAha,EAAO8B,KAAK,CAACmC,EAAG,GAAIA,EAAG,GAAK0U,IAC5B3Y,EAAO8B,KAAK,CAACoC,EAAG,GAAKwU,EAAUzU,EAAG,GAAK0U,IACvC3Y,EAAO8B,KAAK,CAACoC,EAAG,GAAKwU,EAAUxU,EAAG,OANlClE,EAAO8B,KAAK,CAACmC,EAAG,GAAKyU,EAAUzU,EAAG,KAClCjE,EAAO8B,KAAK,CAACmC,EAAG,GAAKyU,EAAUxU,EAAG,GAAKyU,IACvC3Y,EAAO8B,KAAK,CAACoC,EAAG,GAAIA,EAAG,GAAKyU,SAM7B,CACH,IAAMpU,EAAQyV,EAAkB,CAAC/V,EAAG,GAAIC,EAAG,IAAK,CAACA,EAAG,GAAID,EAAG,IAC3DjE,EAAO8B,KAAKyC,GAEhB,MACJ,KAAK,EACD,IAAM4V,EAAU,EACXlW,EAAG,GAAKC,EAAG,IAAI,EAAIA,EAAG,IACtBD,EAAG,GAAKC,EAAG,IAAI,EAAIA,EAAG,IAExB8V,GACCha,EAAO8B,KAAK,CAACmC,EAAG,GAAIkW,EAAQ,KAC5Bna,EAAO8B,KAAK,CAACoC,EAAG,GAAIiW,EAAQ,OAE5Bna,EAAO8B,KAAK,CAACqY,EAAQ,GAAIlW,EAAG,KAC5BjE,EAAO8B,KAAK,CAACqY,EAAQ,GAAIjW,EAAG,MAMxClE,EAAOoa,QAAQnW,GACfjE,EAAO8B,KAAKoC,GAGhB,SAASmW,GAASpW,EAAIC,GAClB,MAAO,CAACD,EAAG,GAAKC,EAAG,GAAID,EAAG,GAAKC,EAAG,IAGtC,SAASoW,GAAOC,GACZ,OAAOhe,KAAK+B,KAAKic,EAAI,GAAKA,EAAI,GAAKA,EAAI,GAAKA,EAAI,IAGpD,SAASC,GAASD,EAAKne,GACnB,MAAO,CAACme,EAAI,GAAKne,EAAOme,EAAI,GAAKne,GAsB9B,SAASqe,GAAUC,EAAMC,GAC5B,OAAID,EAAK,IAAMA,EAAK,IAAMA,EAAK,IAAMA,EAAK,IACtCC,EAAK,IAAMA,EAAK,IAAMA,EAAK,IAAMA,EAAK,MAKjCD,EAAK,IAAMC,EAAK,IACbD,EAAK,IAAMC,EAAK,IAChBD,EAAK,IAAMC,EAAK,IAChBD,EAAK,IAAMC,EAAK,IAqCzB,SAASC,GAAmBra,EAAGC,GAClC,OAAOD,EAAE,KAAOC,EAAE,IAAMD,EAAE,KAAOC,EAAE,IAAMD,EAAE,KAAOC,EAAE,IAAMD,EAAE,KAAOC,EAAE,GAElE,SAASqa,GAAgBta,EAAGC,GAC/BD,EAAE,GAAKC,EAAE,GACTD,EAAE,GAAKC,EAAE,GACTD,EAAE,GAAKC,EAAE,GACTD,EAAE,GAAKC,EAAE,GC/Wb,IAAMsa,GAAWC,OAAO,SAClBC,GAAcD,OAAO,eAmBrBE,YAAQC,GAAAC,EAAAF,EAAAC,GAAA,IAAAE,EAAAC,EAAAJ,GACV,SAAAA,IAA0B,IAAAK,EAAdC,EAAOvN,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GA4Ba,OA5BXwN,OAAAP,GACpBK,EAAAF,EAAAK,KAAAlO,MACAsK,OAAOK,OAAMwD,EAAAJ,GAAOC,GAIpBD,EAAKK,SAAU,EAEfL,EAAKM,cAAW9Y,EAChBwY,EAAKR,KAAY,EAGjBQ,EAAKO,YAAmBN,EAAQM,aAAe,EAE/CP,EAAKQ,YAAmBP,EAAQO,aAAe,cAE/CR,EAAKS,gBAAmBR,EAAQQ,iBAAmB,cAEnDT,EAAKU,YAAmBT,EAAQS,YAEhCV,EAAKW,WAAmBV,EAAQU,YAAc,EAE9CX,EAAKY,cAAmBX,EAAQW,eAAiB,EAEjDZ,EAAKa,cAAmBZ,EAAQY,eAAiB,EAEjDb,EAAKc,QAAmBb,EAAQa,SAAW,EAE3Cd,EAAKe,cAAgB,CAAC,EAAE,EAAE,EAAE,GAAGf,EAqNlC,OAnNDgB,EAAArB,EAAA,CAAA,CAAAsB,IAAA,eAAAhU,IAGA,WACI,OAAOgF,QAAUA,KAAKiP,OAAOC,QAAQC,UAAYnP,KAAKiP,OAAOC,QAAQE,QAEzE,CAAAJ,IAAA,YAAAhU,IAGA,WACI,OAAOgF,OAASA,KAAKiP,OAAOI,oBAAsBrP,KAAKiP,OAAOC,QAAQI,OAAOC,cAEjF,CAAAP,IAAA,SAAAhU,IAGA,WACI,OAAOgF,KAAKuN,KAEhBiC,IAOA,SAAWC,GACJzP,KAAKuN,MAAckC,GAelBzP,KAAK0P,cAAc,IAAIC,YAAYF,EAAQ,aAAc,aAAe,CACpEG,OAAQ,CACJT,SAAUnP,KACV6P,MAAO7P,KAAKiP,WAIxBjP,KAAKuN,IAAYkC,IACpB,CAAAT,IAAA,SAAAhU,IA5BD,WACI,MAAoC,UAA7BgF,KAAKqO,SAASyB,WAAyB9P,KAAKqO,SAAWrO,KAAKqO,SAASY,SAC/E,CAAAD,IAAA,cAAAhU,IA4BD,WACI,OAAOgF,KAAKyN,MACf,CAAAuB,IAAA,eAAAQ,IAED,SAAiBO,GAEVA,IADY/P,KAAKyN,MAEbsC,EACC/P,KAAKgQ,iBAELhQ,KAAKiQ,kBAGbjQ,KAAKyN,IAAesC,IAGxB,CAAAf,IAAA,iBAAAkB,MAGA,cAIA,CAAAlB,IAAA,iBAAAkB,MAGA,cAIA,CAAAlB,IAAA,YAAAkB,MAIA,SAAUlC,GAAS,IAAAmC,EAAAnQ,KACfsK,OAAOC,KAAKyD,GAAS7W,SAAQ,SAAA4F,QACPxH,IAAfyY,EAAQjR,IAAmC,OAAfiR,EAAQjR,KACnCoT,EAAKpT,GAAKiR,EAAQjR,SAI9B,CAAAiS,IAAA,SAAAkB,MAIA,SAAO/hB,GACH,KAAM,6BAEV,CAAA6gB,IAAA,QAAAkB,MAKA,SAAMlZ,GACF,KAAM,4BAEV,CAAAgY,IAAA,kBAAAkB,MAIA,WACI,KAAM,sCACT,CAAAlB,IAAA,wBAAAkB,MACD,WACI,KAAM,4CAEV,CAAAlB,IAAA,kCAAAkB,MAQA,WACI,KAAM,sDAIV,CAAAlB,IAAA,YAAAkB,MAIA,WACI,OAAOlQ,KAAKoQ,SAEhB,CAAApB,IAAA,uBAAAkB,MAMA,WACI,IAAMG,EAAOlB,SAASmB,kBAClBjH,EAAQD,EAAAA,EACRG,GAASH,EAAAA,EACTD,EAAQC,EAAAA,EACRE,GAASF,EAAAA,EAOb,OANAiH,EAAKlZ,SAAQ,SAAAH,GACTuS,EAAQva,KAAKgK,IAAIuQ,EAAOvS,EAAM,IAC9BqS,EAAQra,KAAK+J,IAAIsQ,EAAOrS,EAAM,IAC9BsS,EAAQta,KAAKgK,IAAIsQ,EAAOtS,EAAM,IAC9BmS,EAAQna,KAAK+J,IAAIoQ,EAAOnS,EAAM,OAE3B,CACHxI,OAAQ+a,EAAQF,EAChB9a,MAAO+a,EAAQH,KAGvB,CAAA6F,IAAA,cAAAkB,MAIA,SAAYK,GACRA,EAAYX,OAAOY,cAAgBxQ,KACnCA,KAAK0P,cAAca,GAChBA,EAAYX,OAAOa,UACfzQ,KAAKqO,SAASqC,YACb1Q,KAAKqO,SAASqC,YAAYH,GAE1BvQ,KAAKqO,SAASqB,cAAca,MAKxC,CAAAvB,IAAA,uBAAAkB,MAKA,SAAqBlZ,GACjB,OAAGgJ,KAAKqO,UAAYrO,KAAKqO,SAASsC,qBACvB3Q,KAAKqO,SAASsC,qBAAqB3Z,GAEnCA,IAEd,CAAAgY,IAAA,iCAAAkB,MAED,SAA+Btd,GAC3B,OAAOoN,KAAKiP,OAAOpgB,MAAQ+D,IAU/B,CAAAoc,IAAA,gBAAAkB,MAEA,WACOlQ,KAAK4Q,SACJ5Q,KAAK4Q,QAAQC,kBAEpB,CAAA7B,IAAA,UAAAkB,MAED,gBAGCxC,GAAAoD,EAlPkBC,cCAjBC,YAAIC,GAAArD,EAAAoD,EAAAC,GAAA,IAAApD,EAAAC,EAAAkD,GACN,SAAAA,IAA0B,IAAAjD,EAAdC,EAAOvN,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GAO+B,OAP7BwN,OAAA+C,IACpBjD,EAAAF,EAAAK,UAAMF,IACDkD,YAAclD,EAGnBD,EAAKqC,OAAmBpC,EAAQoC,QAAU,CAAC,EAAG,GAE9CrC,EAAKoD,iBAAmBnD,EAAQmD,iBAAiBpD,EAmCpD,OAlCAgB,EAAAiC,EAAA,CAAA,CAAAhC,IAAA,YAAAkB,MAED,SAAUlC,GAAS,IAAAmC,EAAAnQ,KACfsK,OAAOC,KAAKyD,GAAS7W,SAAQ,SAAA4F,QACPxH,IAAfyY,EAAQjR,IAAmC,OAAfiR,EAAQjR,KACnCoT,EAAKpT,GAAKiR,EAAQjR,GAClBoT,EAAKe,YAAYnU,GAAKiR,EAAQjR,SAGzC,CAAAiS,IAAA,aAAAkB,MACD,SAAWre,GACPmO,KAAKoQ,OAAO,GAAKve,IACpB,CAAAmd,IAAA,aAAAkB,MACD,SAAWpe,GACPkO,KAAKoQ,OAAO,GAAKte,IACpB,CAAAkd,IAAA,YAAAkB,MACD,SAAUre,EAAGC,GACTkO,KAAKoQ,OAAO,GAAKve,EACjBmO,KAAKoQ,OAAO,GAAKte,IACpB,CAAAkd,IAAA,eAAAkB,MAED,WACI,OAAOhD,GAAUlN,KAAKqO,SAAS+C,cAAepR,KAAKsQ,qBAGvD,CAAAtB,IAAA,QAAAkB,MAIA,WACI,IACM9d,EAAI,IAAIuP,EADJ3B,KAAKF,aACCE,KAAKkR,aAErB,OADA9e,EAAEgc,QAAUpO,KAAKoO,QACVhc,MACV4e,GA3CctD,ICpBb2D,YAASC,GAAA1D,EAAAyD,EAAAC,GAAA,IAAAzD,EAAAC,EAAAuD,GACX,SAAAA,EAAYrD,GAAS,OAAAC,OAAAoD,GAAAxD,EAAAK,KAAAlO,KACXgO,GA+BT,OA9BAe,EAAAsC,EAAA,CAAA,CAAArC,IAAA,SAAAkB,MAED,SAAO/hB,MAAO,CAAA6gB,IAAA,QAAAkB,MAEd,SAAMlZ,GACF,OAAO,IACV,CAAAgY,IAAA,wBAAAkB,MACD,SAAsBlZ,GAClB,OAAOgJ,KAAKoQ,SACf,CAAApB,IAAA,kBAAAkB,MAED,WACI,IAAAqB,EAAAC,EAAiBxR,KAAKoQ,OAAM,GAArBxY,EAAE2Z,EAAA,GAAE1Z,EAAE0Z,EAAA,GACb,MAAO,CAAC3Z,EAAIC,EAAID,EAAIC,KACvB,CAAAmX,IAAA,uBAAAkB,MAED,WACI,MAAO,CACH3hB,MAAO,EAAGC,OAAQ,KAEzB,CAAAwgB,IAAA,kCAAAkB,MAED,WAAkC,IAAAuB,EAC9BC,EAAAF,EAAiBxR,KAAKoQ,OAAM,GAArBxY,EAAE8Z,EAAA,GAAE7Z,EAAE6Z,EAAA,GACb,OAAAC,EAAAF,EAAA,GACKhJ,GAAUC,MAAS,CAAC9Q,EAAG,EAAGC,IAAG8Z,EAAAF,EAC7BhJ,GAAUG,KAAS,CAAChR,EAAG,EAAGC,IAAG8Z,EAAAF,EAC7BhJ,GAAUE,OAAS,CAAC/Q,EAAIC,EAAG,IAAE8Z,EAAAF,EAC7BhJ,GAAUI,IAAS,CAACjR,EAAIC,EAAG,IAAE4Z,MAErCJ,GAjCmBL,ICKvB,IACKY,GAAW,WACb,SAAAA,IAAc3D,OAAA2D,GACV5R,KAAK6R,KAAO,IAAIC,QAuBnB,OAtBA/C,EAAA6C,EAAA,CAAA,CAAA5C,IAAA,MAAAkB,MAED,SAAI6B,GACA,OAAO/R,KAAK6R,KAAK7W,IAAI+W,KACxB,CAAA/C,IAAA,MAAAkB,MAED,SAAI6B,GACA,IAAMlc,EAlBH,CACHmc,gBAAYzc,EACZ0c,eAAW1c,EACX2c,WAAY,GACZC,eAAgB,GAChBC,aAAc,IAed,OADApS,KAAK6R,KAAKrC,IAAIuC,EAAQlc,GACfA,IACV,CAAAmZ,IAAA,MAAAkB,MAED,SAAI6B,GACA,OAAO/R,KAAK6R,KAAKQ,IAAIN,KACxB,CAAA/C,IAAA,SAAAkB,MAED,SAAO6B,GACH/R,KAAK6R,KAAW,OAACE,KACpB,CAAA/C,IAAA,QAAAkB,MAED,WACIlQ,KAAK6R,KAAKS,YACbV,EAzBY,GA4BJW,GAAmB,CAC5BC,gBAAe,WACXxS,KAAKyS,6BAA+B,IAAIb,IAE5Cc,sBAAqB,SAACX,GAClB,IAAMY,EAAU3S,KAAKyS,6BAA6BzX,IAAI+W,GACtD,GAAGY,EACC,OAAOA,EAAQV,WAIvBW,sBAAqB,SAACb,GAClB,IAAMY,EAAU3S,KAAKyS,6BAA6BzX,IAAI+W,GACtD,GAAGY,EACC,OAAOA,EAAQX,YAIvBa,oBAAmB,SAACd,GAEhB,OADY/R,KAAKyS,6BACNzX,IAAI+W,IAEnBe,QAAO,SAACf,GACJ,IAAMhd,EAAMiL,KAAKyS,6BAOjB,OALG1d,EAAIsd,IAAIN,GACDhd,EAAIiG,IAAI+W,GAERhd,EAAIya,IAAIuC,IAItBgB,sBAAqBA,SAAChB,EAAQC,GAChBhS,KAAK8S,QAAQf,GACnBC,WAAaA,GAErBgB,sBAAqBA,SAACjB,EAAQ5C,GAChBnP,KAAK8S,QAAQf,GACnBE,UAAY9C,GAEpB8D,6BAAoBC,EAAYC,EAAU/D,GACtC,IAAIvZ,EAAMmK,KAAK8S,QAAQI,GACvBrd,EAAIsc,eAAe5d,KAAK6a,IAExBvZ,EAAMmK,KAAK8S,QAAQK,IACff,aAAa7d,KAAK6a,IAE1BgE,gCAAuBF,EAAYC,EAAU/D,GACzC,IAAIvZ,EAAMmK,KAAK8S,QAAQI,GACnB9b,EAAMvB,EAAIsc,eAAekB,WAAU,SAAA9gB,GAAC,OAAIA,IAAM6c,MACtC,IAAThY,GACCvB,EAAIsc,eAAeze,OAAO0D,EAAK,IAKvB,KADZA,GADAvB,EAAMmK,KAAK8S,QAAQK,IACTf,aAAaiB,WAAU,SAAA9gB,GAAC,OAAIA,IAAM6c,OAExCvZ,EAAIuc,aAAa1e,OAAO0D,EAAK,KC1FnCkc,YAAaC,GAAA3F,EAAA0F,EAAAC,GAAA,IAAA1F,EAAAC,EAAAwF,GACf,SAAAA,IAAc,IAAAvF,EAEc,OAFdE,OAAAqF,IACVvF,EAAAF,EAAAK,KAAAlO,OACKwT,YAAc,KAAKzF,EA2H3B,OAzHDgB,EAAAuE,EAAA,CAAA,CAAAtE,IAAA,SAAAkB,MAIA,SAAO/hB,EAAKslB,GACR,IAAIC,EACJ1T,KAAK7I,SAAQ,SAAAgY,GACT,GAAGA,EAASwE,UACRD,EAAevE,OAGnB,GAAGA,EAASf,WAAaqF,GAAaA,EAAUtE,IAAY,CACxD,GAAGA,EAASyE,eACJzE,EAASyE,aAAazlB,GACtB,OAGRA,EAAIyB,OACJuf,EAASzf,OAAOvB,GAChBA,EAAI0B,cAGT6jB,IACCvlB,EAAIyB,OAKJ8jB,EAAahkB,OAAOvB,GACpBA,EAAI0B,aAEX,CAAAmf,IAAA,iBAAAkB,MAED,WACIlQ,KAAKwT,YAAc,KACnBxT,KAAK7I,SAAQ,SAAA1D,GACNA,EAAEogB,QACDpgB,EAAEogB,OAAOC,iBAEbrgB,EAAEsgB,QAAS,OAUnB,CAAA/E,IAAA,WAAAkB,MAMA,SAASlZ,EAAOyc,EAAWO,GAEvB,IADA,IAAIvgB,EAAIuM,KAAKpN,OAAS,EAChBa,GAAK,GAAG,CACV,IAAM0b,EAAWnP,KAAKvM,GAEtB,GAAG0b,EAASf,UAAYe,EAAS8E,UAAW,CACxC,GAAGR,GAAaA,EAAUtE,GAAW,CACjC1b,IACA,SAEJ,GAAGugB,IAAsBA,EAAkB7E,GAAW,CAClD1b,IACA,SAEJ,IAAMgc,EAAQN,EAAS+E,MAAMld,EAAOyc,GAEpC,GAAGhE,EAQC,OAPGzP,KAAKwT,cAAgBrE,IACjBnP,KAAKwT,cACJxT,KAAKwT,YAAYO,QAAS,GAE9B5E,EAAS4E,QAAS,EAClB/T,KAAKwT,YAAcrE,GAEH,kBAAVM,EACCA,EAEJN,EAEPA,EAAS4E,QAAS,EAI1BtgB,IAGJ,OADAuM,KAAKwT,YAAc,KACZ,OAEX,CAAAxE,IAAA,wBAAAkB,MAIA,WACI,IAAMzd,EAAS,GAQf,OAPAuN,KAAK7I,SAAQ,SAAAgY,GACT,GAAGA,EAASf,UAAYe,EAASgC,iBAAkB,CAC/C,IAAMd,EAAOlB,EAASmB,kBACtB7d,EAAO8B,KAAK,CAAC8b,EAAK,GAAIA,EAAK,KAC3B5d,EAAO8B,KAAK,CAAC8b,EAAK,GAAIA,EAAK,SAG5B5d,IAGX,CAAAuc,IAAA,sBAAAkB,MAIA,WACI,IAAMzd,EAAS,GAMf,OALAuN,KAAK7I,SAAQ,SAAAgY,GACNA,EAASf,UAAYe,EAASgC,kBAC7B1e,EAAO8B,KAAK4a,EAASiB,WAGtB3d,MACV6gB,GAAAxC,EA9HuBvQ,QCGtB4T,GAAa,CAEfC,UAAW,GAEXC,MAAO,GAEPR,OAAQ,KAERS,WAAY,KAKZC,UAAS,SAAA9C,GAAW,IAAA1D,EAAA/N,KAARwU,EAAI/C,EAAJ+C,KACRxU,KAAK6T,OAAS,IAAIP,GAClBtT,KAAKsU,WAAa,IAAIhB,GAClBkB,IACJxU,KAAKoU,UAAYI,EAAKJ,UACtBpU,KAAKqU,MAAQG,EAAKH,MAClBrU,KAAKoU,UAAUjd,SAAQ,SAAA1D,GACnBsa,EAAK8F,OAAOtf,KAAKd,GACjBA,EAAE4a,SAAWN,KAEjB/N,KAAKqU,MAAMld,SAAQ,SAACiY,GAChBrB,EAAKuG,WAAW/f,KAAK6a,GACrBA,EAAKf,SAAWN,OAOxB0G,WAAU,SAACtF,GACPA,EAASd,SAAWrO,KACpBA,KAAK6T,OAAOtf,KAAK4a,IAQrBuF,iBAAgBA,SAACzkB,EAAQkf,GACrB,IAAMwF,EAAQ3U,KAAK6T,OAAOR,WAAU,SAAA5f,GAAC,OAAIA,IAAMxD,KAC/C+P,KAAK6T,OAAOngB,OAAOihB,EAAO,EAAGxF,GAC7Blf,EAAOoe,SAAW,KAClBc,EAASd,SAAWrO,MAOxB4U,eAAc,SAACxF,GACXA,EAAKf,SAAWrO,KAChBA,KAAKsU,WAAW/f,KAAK6a,IAMzByF,gBAAe,SAAC5kB,GAEZ,IAAM0kB,EAAQ3U,KAAK6T,OAAOR,WAAU,SAAA5f,GAAC,OAAIA,IAAMxD,MACjC,IAAX0kB,GACC3U,KAAK6T,OAAOngB,OAAOihB,EAAO,IAQlCG,oBAAmB,SAAC7kB,GAChB,IAAM0kB,EAAQ3U,KAAKsU,WAAWjB,WAAU,SAAA5f,GAAC,OAAIA,IAAMxD,MACrC,IAAX0kB,GACC3U,KAAKsU,WAAW5gB,OAAOihB,EAAO,IAItCI,UAAS,WACL/U,KAAKsU,WAAa,IAAIhB,IAK1B0B,sBAAqB,WACjBhV,KAAK6T,OAAO1c,SAAQ,SAAA1D,GAChBA,EAAE2c,OAAS,CAAC,EAAE,OAItB6E,kBAAiBA,SAACC,EAAY/F,GAC1BnP,KAAKyU,WAAWtF,GAChB,IAAQ3O,EAAa0U,EAAb1U,KAAM2U,EAAOD,EAAPC,GACRR,EAAQ3U,KAAKsU,WAAWjB,WAAU,SAAA9gB,GAAC,OAAIA,IAAM2iB,KAC7CE,EAAcF,EAAWG,UAAUvV,YACnC7F,EAAK,IAAImb,EAAY,CACvB5U,KAAAA,EACA2U,GAAIhG,IAERlV,EAAGoU,SAAWrO,KACd,IAAM7F,EAAK,IAAIib,EAAY,CACvB5U,KAAM2O,EACNgG,GAAAA,IAEJhb,EAAGkU,SAAWrO,KAEdA,KAAKsU,WAAW5gB,OAAOihB,EAAO,EAAG1a,EAAIE,IAOzCmb,kBAAiB,SAACvlB,GACdiQ,KAAK6T,OAAO1c,SAAQ,SAAAgY,GAChBpf,EAASof,QClHfoG,GAAc,CAEhBC,QAAS,KAKTC,WAAU,SAACzH,GACPhO,KAAKwV,QAAUxH,EAAQ0H,QAK3B7E,cAAa,WACT,IAAI8E,GAAQ,EACZ,GAAG3V,KAAK4V,qBAAsB,CAC1B,IAAAC,EAAsC7V,KAAK4V,uBAA5BE,EAAID,EAAXtnB,MAAqBwnB,EAAIF,EAAZrnB,OAClBwR,KAAKgV,uBACJhV,KAAKgV,wBAENhV,KAAKgW,uBACJhW,KAAKgW,wBAEThW,KAAKiW,SACFjW,KAAKgW,uBACJhW,KAAKgW,wBAET,IAAAE,EAAsClW,KAAK4V,uBAA5BO,EAAID,EAAX3nB,MAAqB6nB,EAAIF,EAAZ1nB,OACrBmnB,EAASG,IAASK,GAAQJ,IAASK,OAEnCpW,KAAKiW,SAENjW,KAAKqO,UAAYsH,GAChB3V,KAAKqO,SAASwC,iBAMtBwF,YAAW,WACPrW,KAAKiW,SACFjW,KAAKgW,uBACJhW,KAAKgW,yBAQbM,YAAW,SAACnH,GACR,QAAGnP,KAAKwV,SACGxV,KAAKwV,QAAQc,YAAYnH,EAAUnP,OAOlDiW,OAAM,WACCjW,KAAKwV,SACJxV,KAAKwV,QAAQS,OAAOjW,QCtEjBuW,GAAA,CACXC,UAAS,WACLxW,KAAKyW,YAAc,GACnBzW,KAAK0W,oBAAiBnhB,GAqB1BohB,kBAAiB,SAACC,GACd,IAAM5M,EAAOhK,KAAK6W,aAAaD,GAE/B,OADA5W,KAAK8W,YACE9M,GAGX6M,aAAY,SAAC9mB,GAAU,IAAAge,EAAA/N,KACb+W,EAAY,CACdpc,WAAOpF,EACPxF,SAAAA,EACAinB,OAAQ,WACJjJ,EAAKkJ,aAAaF,GAClBhJ,EAAKmJ,YAIb,OADAlX,KAAKyW,YAAYliB,KAAKwiB,GACfA,GAGXE,aAAY,SAACjN,GACT,IAAM5S,EAAM4I,KAAKyW,YAAYpD,WAAU,SAAA5e,GAAC,OAAIA,IAAMuV,MACjD5S,GAAO4I,KAAKyW,YAAY/iB,OAAO0D,EAAK,IAIzC+f,SAAQ,WACJnX,KAAK8W,aAGTA,UAAS,WAAG,IAAA3G,EAAAnQ,KACJA,KAAKyW,YAAY7jB,QACjBwkB,uBAAsB,WAClBjH,EAAKkH,iBACLlH,EAAK2G,gBAMjBQ,cAAa,WACTtX,KAAKyW,YAAYtf,SAAQ,SAAA6S,GACrB,IAAMuN,EAAYC,KAAKC,MACnBzN,EAAKrP,QACLqP,EAAKrP,MAAQ4c,GAEjB,IAAMG,EAAUH,EAAYvN,EAAKrP,MACjCqP,EAAKja,SAAS2nB,QCtEXC,GAAA,CAEXC,WAAUA,SAAC7pB,EAAO0jB,GAGf,IAAA1D,EAAA/N,KAAA6X,EAAApG,EAFCqG,QAAAA,OAAU,IAAHD,EAAG,EAACA,EAAAE,EAAAtG,EACXuG,UAAAA,OAAY,IAAHD,EAAG,SAAQA,EAGpB/X,KAAKgW,wBACL,IAAAiC,EAKIjY,KAAKkJ,aAJEgP,EAAOD,EAAd1pB,MACQ4pB,EAAQF,EAAhBzpB,OACG4pB,EAAGH,EAANpmB,EACGwmB,EAAGJ,EAANnmB,EAGJ,IADckO,KAAKsY,QACN,CACTtY,KAAKsY,QAAUxqB,EAAaC,GAC5B,IAAAwqB,EAIIvY,KAAKsY,QAHL/pB,EAAKgqB,EAALhqB,MAAOC,EAAM+pB,EAAN/pB,OACPa,EAASkpB,EAATlpB,UACAC,EAAUipB,EAAVjpB,WAEJ0Q,KAAKvP,iBAAiB,WAAW,WAC7Bsd,EAAKyK,YAAczK,EAAKyK,gBAE5B,IAAIC,GAAY,EAChBzY,KAAKsY,QAAQtqB,OAAOyC,iBAAiB,eAAe,SAACioB,GACjD,IAAMC,EAAqCD,EAArCC,QAASC,EAA4BF,EAA5BE,QAA4BF,EAAnBG,OAAmBH,EAAXI,OAChCL,GAAY,EACZ1K,EAAKgL,YAAchL,EAAKgL,WAAWJ,EAASC,MAEhD5Y,KAAKsY,QAAQtqB,OAAOyC,iBAAiB,eAAe,SAACioB,GACjD,IAAMC,EAAqCD,EAArCC,QAASC,EAA4BF,EAA5BE,QAA4BF,EAAnBG,OAAmBH,EAAXI,OAC7BL,GACC1K,EAAKgL,YAAchL,EAAKgL,WAAWJ,EAASC,IAE7CA,EAAU,GAAKD,EAAU,GAAKA,EAAUpqB,EAAM,GAAKqqB,EAAUpqB,EAAO,KACnEiqB,GAAY,MAGpBzY,KAAKsY,QAAQtqB,OAAOyC,iBAAiB,aAAa,WAC9CgoB,GAAY,KAGhB,IAAMlpB,EAAatB,SAASC,cAAc,UAC1CqB,EAAWhB,MAAQc,EACnBE,EAAWf,OAASc,EACpB0Q,KAAKgZ,gBAAkBzpB,EAAWnB,WAAW,MAEjD,IAAA6qB,EASIjZ,KAAKsY,QARL/pB,EAAK0qB,EAAL1qB,MACAC,EAAMyqB,EAANzqB,OACAa,EAAS4pB,EAAT5pB,UACAC,EAAU2pB,EAAV3pB,WACI2pB,EAAJxqB,KACGwqB,EAAHvqB,QACAG,EAAKoqB,EAALpqB,MACAV,EAAG8qB,EAAH9qB,IAEE+qB,EAAiB,EAAVpB,EACPqB,EAAMrB,EACN1T,GAAM7V,EAAQ2qB,GAAQhB,EACtB7T,GAAM7V,EAAS0qB,GAAQf,EACvBtkB,EAAI7E,KAAK+J,IAAIqL,EAAIC,GAEnB+U,EAAM,EACNC,EAAM,EAEO,WAAdrB,GACCqB,GAAO7qB,EAAS2pB,EAAWtkB,GAAK,EAAIwkB,EAAMxkB,EAC1CulB,GAAO7qB,EAAQ2pB,EAAUrkB,GAAK,EAAIukB,EAAMvkB,GAErCuQ,EAAKC,GACJgV,GAAO7qB,EAAS2pB,EAAWtkB,GAAK,EAAIwkB,EAAMxkB,EAC1CulB,EAAMD,IAENC,GAAO7qB,EAAQ2pB,EAAUrkB,GAAK,EAAIukB,EAAMvkB,EACxCwlB,EAAMF,GAGd,IAAMG,EAAWtZ,KAAKgZ,gBACtBM,EAASC,eACTD,EAAS3pB,UAAU,EAAG,EAAGN,EAAWC,GACpCgqB,EAASzqB,MAAMA,EAAOA,GACtByqB,EAASE,UAAU3lB,EAAG,EAAG,EAAGA,EAAGulB,EAAKC,GAKpC,IAAMI,EAAK,CAAC,EAAE,EAAE,EAAE,GACfzZ,KAAK0Z,eACJ1Z,KAAKsU,WAAW5kB,OAAO4pB,GAAU,SAAClK,GAAiC,OAAtBA,EAAK3B,YAAYgM,IAAY,KAE1EzZ,KAAK6T,OAAOnkB,OAAO4pB,KAEnBtZ,KAAK6T,OAAOnkB,OAAO4pB,GACnBtZ,KAAKsU,WAAW5kB,OAAO4pB,GAAU,SAAClK,GAAiC,OAAtBA,EAAK3B,YAAYgM,IAAY,MAE9E,IAAME,EAAqBL,EAASM,aAAa,EAAG,EAAEvqB,EAAWC,GACjE0Q,KAAKwY,WAAa,WACdrqB,EAAIyB,OACJzB,EAAIorB,eACJprB,EAAIwB,UAAU,EAAG,EAAGN,EAAWC,GAE/BnB,EAAIU,MAAMA,EAAOA,GACjBV,EAAI0rB,aAAaF,EAAoB,EAAG,GACxCxrB,EAAIqrB,UAAU3lB,EAAG,EAAG,EAAGA,EAAGulB,EAAKC,GAC/B,IAAuCS,EAAAtI,EAAlBzD,EAAKqD,cAAa,GAAhCvf,EAACioB,EAAA,GAAEhoB,EAACgoB,EAAA,GAAE1nB,EAAC0nB,EAAA,GAAExnB,EAACwnB,EAAA,GACjB3rB,EAAI4rB,YACJ5rB,EAAIkiB,KAAKxe,EAAGC,EAAIM,EAAEP,EAAGS,EAAER,GACvB3D,EAAIorB,eACJprB,EAAIkiB,KAAK,EAAG,EAAGhhB,EAAWC,GAC1BnB,EAAI6rB,KAAK,WAET7rB,EAAI8rB,UAAY,kBAChB9rB,EAAI+rB,SAAS,EAAG,EAAG7qB,EAAWC,GAC9BnB,EAAI0B,WAGRmQ,KAAKwY,aAELxY,KAAK+Y,WAAa,SAACJ,EAASC,GACxB,IAAuCuB,EAAA3I,EAAlBzD,EAAKqD,cAAa,GAAhCvf,EAACsoB,EAAA,GAAEroB,EAACqoB,EAAA,GAAE/nB,EAAC+nB,EAAA,GAAE7nB,EAAC6nB,EAAA,GAKXrnB,EAAI,GAHCV,EAAEP,GAAG,EAAIA,GAGLgC,EAAIulB,IAFR9mB,EAAER,GAAG,EAAIA,GAEQ+B,EAAIwlB,GAChCtL,EAAKqM,sBAAsBtnB,EAAE,GAAK6lB,GAAU9kB,EAAIka,EAAKlf,OAAQiE,EAAE,GAAK8lB,GAAU/kB,EAAIka,EAAKlf,OACvFkf,EAAKmJ,UACLnJ,EAAKyK,gBCnIJ6B,GAAS,WAClB,SAAAA,EAAYxP,GAAmB,IAAdmD,EAAOvN,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GAAEwN,OAAAoM,GACzBra,KAAKoQ,OAAS,CAAC,EAAE,GACjBpQ,KAAKzR,MAAQyf,EAAQsM,UAAY,EACjCta,KAAKxR,OAASwf,EAAQsM,UAAY,EAClCta,KAAKua,WAAa,EAClBva,KAAKwa,WAAa,EAClBxa,KAAK6K,IAAMA,EACX7K,KAAKya,WAAazM,EAAQyM,YAAc,sBACxCza,KAAK0a,WAAa1M,EAAQ0M,YAAc,sBACxC1a,KAAK2a,SAAU,EAiDlB,OAhDA5L,EAAAsL,EAAA,CAAA,CAAArL,IAAA,SAAAkB,MACD,SAAO/hB,GACH,IAAAojB,EAAAC,EAAexR,KAAKoQ,OAAM,GAAnBve,EAAC0f,EAAA,GAAEzf,EAACyf,EAAA,GAGX,GAFApjB,EAAIyB,OACJzB,EAAI4rB,YACY,MAAb/Z,KAAK6K,IAAa,CACjB,IAAM+P,EAAS5a,KAAKxR,OAAS,EACvBqsB,EAAK/oB,EAAI8oB,EACTE,EAAKhpB,EAAIkO,KAAKxR,OACdqX,EAAKhU,EAAImO,KAAKzR,MAAwB,EAAhByR,KAAKua,WAAeK,EAC1CG,EAAKlpB,EAAImO,KAAKua,WAAaK,EACjCzsB,EAAI6sB,OAAOD,EAAID,GACf3sB,EAAIsR,IAAIsb,EAAIF,EAAID,EAAQ5rB,KAAKoC,GAAG,EAAGpC,KAAKoC,GAAG,EAAE,GAC7CjD,EAAI8sB,OAAOpV,EAAI/T,GACf3D,EAAIsR,IAAIoG,EAAIgV,EAAID,GAAU5rB,KAAKoC,GAAG,EAAGpC,KAAKoC,GAAG,GAC7CjD,EAAI+sB,gBAED,CACH,IAAMN,EAAS5a,KAAKzR,MAAQ,EACtB4sB,EAAKrpB,EAAIkO,KAAKwa,WAAaI,EAC3BQ,EAAKtpB,EAAIkO,KAAKxR,OAAyB,EAAhBwR,KAAKwa,WAAeI,EAC3CS,EAAKxpB,EAAI+oB,EACTU,EAAKzpB,EAAImO,KAAKzR,MACpBJ,EAAI6sB,OAAOnpB,EAAGspB,GACdhtB,EAAIsR,IAAI4b,EAAIF,EAAIP,GAAS5rB,KAAKoC,GAAI,GAClCjD,EAAI8sB,OAAOK,EAAIF,GACfjtB,EAAIsR,IAAI4b,EAAID,EAAIR,EAAQ,EAAG5rB,KAAKoC,IAChCjD,EAAI+sB,YASR/sB,EAAI8rB,UAAYja,KAAK2a,QAAU3a,KAAK0a,WAAa1a,KAAKya,WACtDtsB,EAAIotB,OACJptB,EAAI0B,YACP,CAAAmf,IAAA,QAAAkB,MACD,SAAMlZ,GACF,IAAMoZ,EAASpQ,KAAKoQ,OACdzG,EAAI3J,KAAKzR,MACTitB,EAAIxb,KAAKxR,OACf,OAAOwI,EAAM,GAAKoZ,EAAO,GAAK,GACvBpZ,EAAM,GAAKoZ,EAAO,GAAKzG,EAAI,GAC3B3S,EAAM,GAAKoZ,EAAO,GAAK,GACvBpZ,EAAM,GAAKoZ,EAAO,GAAKoL,EAAI,MACrCnB,EA3DiB,GA6DPoB,GAAA,CACXC,cAAa,WAAe,IAAA3N,EAAA/N,KAAdgO,EAAOvN,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GAEhBkb,EAKA3N,EALA2N,SACAC,EAIA5N,EAJA4N,cACArB,EAGAvM,EAHAuM,WACAC,EAEAxM,EAFAwM,WACAF,EACAtM,EADAsM,SAEJta,KAAK6b,kBAAmB,EACxB7b,KAAK8b,YAAc,IAAIzB,GAAU,IAAK,CAClCI,WAAYkB,EACZjB,WAAYkB,EACZtB,SAAAA,IAEJta,KAAK8b,YAAYvB,WAAaA,GAAc,EAE5Cva,KAAK+b,YAAc,IAAI1B,GAAU,IAAK,CAClCI,WAAYkB,EACZjB,WAAYkB,EACZtB,SAAAA,IAEJta,KAAK+b,YAAYvB,WAAaA,GAAc,EAE5Cxa,KAAKgc,iBAAmB,CACpBC,UAAU,EACVhsB,OAAQ,KACRisB,YAAQ3mB,EACR4mB,YAAQ5mB,EAER6mB,SAAU,EACVC,SAAU,GAGdrc,KAAKvP,iBAAiB,WAAW,WAC7Bsd,EAAKuO,2BAGTtc,KAAKsc,wBAELtc,KAAKhS,OAAOyC,iBAAiB,eAAe,SAAAkP,GACxC,IAAQgZ,EAAuChZ,EAAvCgZ,QAASC,EAA8BjZ,EAA9BiZ,QAAS2D,EAAqB5c,EAArB4c,QAASC,EAAY7c,EAAZ6c,QACnCzO,EAAK0O,sBAAsB9D,EAASC,EAAS2D,EAASC,OAG9DE,oBAAmB,WACf,OAAO1c,KAAKgc,kBAAoBhc,KAAKgc,iBAAiBC,UAE1DQ,sBAAqB,SAAC9D,EAASC,EAAS2D,EAASC,GAAS,IAAArM,EAAAnQ,KACzCA,KAAK8b,YAAY5H,MAAM,CAACyE,EAASC,KAE1CtO,OAAOK,OAAO3K,KAAKgc,iBAAkB,CACjCC,UAAU,EACVhsB,OAAQ+P,KAAK8b,YACba,UAAW3c,KAAK8b,YAAY1L,OAAO,GACnCgM,SAAUG,IAGLvc,KAAK+b,YAAY7H,MAAM,CAACyE,EAASC,KAE1CtO,OAAOK,OAAO3K,KAAKgc,iBAAkB,CACjCC,UAAU,EACVhsB,OAAQ+P,KAAK+b,YACba,UAAW5c,KAAK+b,YAAY3L,OAAO,GACnCiM,SAAUG,IAGlB,IAAMK,EAAK,SAAAld,GACP,IAAQgZ,EAAuChZ,EAAvCgZ,QAASC,EAA8BjZ,EAA9BiZ,QAAS2D,EAAqB5c,EAArB4c,QAASC,EAAY7c,EAAZ6c,QACnCrM,EAAK2M,oBAAoBnE,EAASC,EAAS2D,EAASC,IACrDtZ,KAAKlD,MAER/R,SAASwC,iBAAiB,cAAeosB,GACzC,IAAMzqB,EAAK,SAAAuN,GACP2K,OAAOK,OAAOwF,EAAK6L,iBAAkB,CACjCC,UAAU,EACVhsB,OAAQ,KACR4B,OAAG0D,EACHzD,OAAGyD,IAEPtH,SAASsC,oBAAoB,cAAessB,GAC5C5uB,SAASsC,oBAAoB,YAAa6B,GAC1C+d,EAAKniB,OAAOuC,oBAAoB,YAAa6B,IAC9C8Q,KAAKlD,MACRA,KAAKhS,OAAOyC,iBAAiB,YAAa2B,EAAG,CACzC5B,MAAM,IAEVvC,SAASwC,iBAAiB,YAAa2B,EAAG,CACtC5B,MAAM,KAGdssB,oBAAmB,SAACnE,EAASC,EAAS2D,EAASC,GAC3C,GAAGxc,KAAK6b,kBAAoB7b,KAAKgc,iBAAiBC,SAAU,CACxD,IAAAc,EAcI/c,KAAKgc,iBAbL/rB,EAAM8sB,EAAN9sB,OACAmsB,EAAQW,EAARX,SACAO,EAASI,EAATJ,UACAN,EAAQU,EAARV,SACAO,EAASG,EAATH,UACMG,EAANb,OACMa,EAANZ,WACAa,EAAcD,EAAdC,eACAC,EAAaF,EAAbE,cACAC,EAAKH,EAALG,MACAC,EAAKJ,EAALI,MACAC,EAAKL,EAALK,MACAC,EAAKN,EAALM,MAEJC,EAAwCtd,KAAKud,WAArCC,EAAYF,EAAZE,aAAcC,EAAaH,EAAbG,cACtBxF,EAGIjY,KAAKkJ,aAFFkP,EAAGH,EAANpmB,EACGwmB,EAAGJ,EAANnmB,EAGJ,GAAkB,MAAf7B,EAAO4a,IAAa,CACnB,IACM6S,EAAOf,GADEJ,EAAUH,GAMnBvqB,GAAKumB,IADK8E,EAAQC,KAHdltB,EAAOmgB,OAAO,GAAKphB,KAAKgK,IAAIhK,KAAK+J,IAAI2kB,EAAMF,EAAeP,GAAgB,IAC/DO,GAEuBL,IACjBnd,KAAKnR,MAChCyb,OAAOK,OAAO3K,KAAK9Q,SAAU,CACzBypB,QAAS9mB,EAAIumB,EAAMpY,KAAKnR,MACxBgD,EAAAA,IAIR,GAAkB,MAAf5B,EAAO4a,IAAa,CACnB,IACM8S,EAAOf,GADEJ,EAAUH,GAMnBvqB,GAAKumB,IADKgF,EAAQD,KAHdntB,EAAOmgB,OAAO,GAAKphB,KAAKgK,IAAIhK,KAAK+J,IAAI4kB,EAAMF,EAAgBT,GAAiB,IACjES,GAEuBL,IACjBpd,KAAKnR,MAChCyb,OAAOK,OAAO3K,KAAK9Q,SAAU,CACzB0pB,QAAS9mB,EAAIumB,EAAMrY,KAAKnR,MACxBiD,EAAAA,IAIR,OADAkO,KAAKqX,kBACE,EAEX,OAAO,GAEXuG,oBAAmBA,SAACjF,EAASC,GACzB,GAAG5Y,KAAK6b,iBAAkB,CAEtB,GADa7b,KAAK8b,YAAY5H,MAAM,CAACyE,EAASC,IAQ1C,OALI5Y,KAAK8b,YAAYnB,UACjB3a,KAAK8b,YAAYnB,SAAU,EAC3B3a,KAAKqX,kBAETrX,KAAKhS,OAAOW,MAAMkvB,OAAS,WACpB,EAGX,GADa7d,KAAK+b,YAAY7H,MAAM,CAACyE,EAASC,IAQ1C,OALI5Y,KAAK+b,YAAYpB,UACjB3a,KAAK+b,YAAYpB,SAAU,EAC3B3a,KAAKqX,kBAETrX,KAAKhS,OAAOW,MAAMkvB,OAAS,WACpB,EAGf,OAAO,GAEXC,oBAAmB,WACZ9d,KAAK6b,mBACD7b,KAAK+b,YAAYpB,SAAW3a,KAAK8b,YAAYnB,WAC5C3a,KAAK+b,YAAYpB,SAAU,EAC3B3a,KAAK8b,YAAYnB,SAAU,EAC3B3a,KAAKqX,mBAIjB0G,0BAAyB,WACrB,IACAC,EAKIhe,KAAKkJ,aAGT,MAAO,CACH3a,MARcyvB,EAAdzvB,MAMOupB,IAGPtpB,OARgBwvB,EAAhBxvB,OAKOspB,IAIPjmB,EARMmsB,EAANnsB,EAJY,IAaZC,EARMksB,EAANlsB,EALY,MAgBpBwqB,sBAAqB,WACjB,GAAItc,KAAK6b,mBAAoB7b,KAAKgc,iBAAiBC,SAAnD,CAGA,IAAAgC,EAKIje,KAAK+d,4BAJE7F,EAAO+F,EAAd1vB,MACQ4pB,EAAQ8F,EAAhBzvB,OACG4pB,EAAG6F,EAANpsB,EACGwmB,EAAG4F,EAANnsB,EAGiCgoB,EAAAtI,EAAlBxR,KAAKoR,cAAa,GAAhCvf,EAACioB,EAAA,GAAEhoB,EAACgoB,EAAA,GAAEjmB,EAACimB,EAAA,GAAE7mB,EAAC6mB,EAAA,GACToD,EAAQluB,KAAKgK,IAAInF,EAAGukB,EAAMF,GAC1BiF,EAAQnuB,KAAK+J,IAAIlH,EAAGumB,GACpBgF,EAAQpuB,KAAK+J,IAAIjH,EAAGumB,GACpBgF,EAAQruB,KAAKgK,IAAI/F,EAAGolB,EAAMF,GAC1B+F,EAAKrqB,EAAIhC,EACTssB,EAAKlrB,EAAInB,EACfssB,EAAwCpe,KAAKud,WAArCC,EAAYY,EAAZZ,aAAcC,EAAaW,EAAbX,cAChBvB,EAASgC,GAAMhB,EAAQC,GAC7B,GAAGjB,EAAS,EAAI,CACZ,IAAMe,EAAgBO,EAAetB,EAC/BmC,GAAWxsB,EAAIsrB,GAASjB,EAASlc,KAAKnR,MAC5CmR,KAAK8b,YAAY1L,OAAS,CAACiO,EAASZ,EAAgB,IACpDzd,KAAK8b,YAAYvtB,MAAQ0uB,EACzBjd,KAAKgc,iBAAiBiB,cAAgBA,EAG1C,IAAMd,EAASgC,GAAMd,EAAQD,GAC7B,GAAGjB,EAAS,EAAI,CACZ,IAAMa,EAAiBS,EAAgBtB,EACjCmC,GAAWxsB,EAAIsrB,GAASjB,EAASnc,KAAKnR,MAC5CmR,KAAK+b,YAAY3L,OAAS,CAACoN,EAAe,GAAIc,GAC9Cte,KAAK+b,YAAYvtB,OAASwuB,EAC1Bhd,KAAKgc,iBAAiBgB,eAAiBA,EAG3C1S,OAAOK,OAAO3K,KAAKgc,iBAAkB,CACjCG,OAAAA,EACAD,OAAAA,EACAgB,MAAAA,EACAC,MAAAA,EACAC,MAAAA,EACAC,MAAAA,MAIRkB,oBAAmB,WACZve,KAAK6b,kBACJvR,OAAOK,OAAO3K,KAAKgc,iBAAkB,CACjCC,UAAU,EACVhsB,OAAQ,KACR4B,OAAG0D,EACHzD,OAAGyD,KAIfipB,gBAAe,SAACrwB,GACZ,GAAG6R,KAAK6b,iBAAkB,CACtB1tB,EAAIorB,eACJprB,EAAIU,MAAMmR,KAAKye,IAAKze,KAAKye,KACzB,IAAAC,EAGI1e,KAAKgc,iBAFLE,EAAMwC,EAANxC,OACAC,EAAMuC,EAANvC,OAEDD,EAAS,GACRlc,KAAK8b,YAAYpsB,OAAOvB,GAEzBguB,EAAS,GACRnc,KAAK+b,YAAYrsB,OAAOvB,MCvUzBwwB,GAAA,CACXC,aAAY,WACR5e,KAAK6e,eAAYtpB,GAErB8hB,eAAc,SAACtnB,GAAU,IAAAge,EAAA/N,KACrBoX,uBAAsB,SAACG,GACCxJ,EAAK8Q,YAActH,GAEnCxJ,EAAK+Q,WAEN/uB,GACCA,EAASwnB,GAEbxJ,EAAK8Q,UAAYtH,OCLvBwH,YAAUC,GAAApR,EAAAmR,EAAAC,GAAA,IAAAnR,EAAAC,EAAAiR,GACZ,SAAAA,EAAYrG,GAAqB,IAAd1K,EAAOvN,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GAAEwN,OAAA8Q,GAC3B,IAAMnP,EAAMqP,EAAAA,KACLjR,GAAO,GAAA,CACVkR,YAAalR,EAAQ0K,MACrBzoB,OAAQ+d,EAAQ/d,OAChB4f,MAAO7B,EAAQ6B,MACfY,QAASzC,EAAQyC,UAAW,IAC/B,OAAA5C,EAAAK,KAAAlO,KACK0Y,EAAO,CACT9I,OAAAA,IAEP,OAAAb,EAAAgQ,IAAAjO,EAZoBnB,cCSzB,SAASwP,KACL,IAAIC,EAAe,CAIfC,aAAa,EACb1J,OAAO,GAEX,MAAO,CACH3nB,OAAQ,CACJsxB,MAAO,SAAU5G,EAAO7I,GACpB6I,EAAM6G,iBACN,IAAM5G,EAAqCD,EAArCC,QAASC,EAA4BF,EAA5BE,QAASC,EAAmBH,EAAnBG,OAAQC,EAAWJ,EAAXI,OAC7BJ,EAAM8G,SACL1G,GAAUA,EACVjJ,EAAM4P,YAAY9G,EAASC,EAASC,EAAQC,EAAQJ,IAEpD7I,EAAM6P,YAAY7G,GAASC,EAAQJ,IAG3CiH,YAAa,SAAUjH,EAAO7I,GAC1B,IAAQ8I,EAAqCD,EAArCC,QAASC,EAA4BF,EAA5BE,QAA4BF,EAAnBI,OACZ,IAD+BJ,EAAXkH,SAElCR,EAAaC,aAAc,EAE3BxP,EAAMgQ,kBAAkBlH,EAASC,EAASF,KAE9CoH,YAAa,SAAUpH,EAAO7I,GAC1B,IAAQ8I,EAAqBD,EAArBC,QAASC,EAAYF,EAAZE,QACdwG,EAAaC,cACZD,EAAazJ,OAAQ,GAEzB9F,EAAMkQ,iBAAiBpH,EAASC,EAASF,IAE7CsH,UAAW,SAAUtH,EAAO7I,GACxB6I,EAAM6G,iBAE+B7G,EAA7BC,QAA6BD,EAApBE,QACH,IADuBF,EAAXkH,QAEvBR,EAAaC,aAAeD,EAAazJ,QACxCyJ,EAAaC,aAAc,EAC3BD,EAAazJ,OAAQ,EACrB9F,EAAMoQ,gBAAe,EAAOvH,KAGpCwH,YAAa,SAAUxH,EAAO7I,GAC1B6I,EAAM6G,iBACN7G,EAAMyH,kBACN,IAAQxH,EAAqBD,EAArBC,QAASC,EAAYF,EAAZE,QACjB/I,EAAMuQ,mBAAmBzH,EAASC,EAASF,IAE/C2H,SAAU,SAAU3H,EAAO7I,GACvB6I,EAAM6G,iBACN7G,EAAMyH,kBACN,IAAQxH,EAAqBD,EAArBC,QAASC,EAAYF,EAAZE,QACjB/I,EAAMyQ,gBAAgB3H,EAASC,EAASF,IAE5C6H,MAAO,SAAS7H,EAAO7I,GACnB6I,EAAM6G,iBACN7G,EAAMyH,kBACN,IAAQxH,EAAqBD,EAArBC,QAASC,EAAYF,EAAZE,QACbwG,EAAazJ,QACbyJ,EAAaC,aAAc,EAC3BD,EAAazJ,OAAQ,EACrB9F,EAAM2Q,aAAa7H,EAASC,EAASF,MAKjDzqB,SAAU,CACN+xB,UAAW,SAAStH,EAAO7I,GACvBA,EAAMoQ,gBAAe,EAAMvH,MAM3C,IAKM+H,GAAY,WACd,SAAAA,IAAyB,IAAbC,EAAMjgB,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GAAEwN,OAAAwS,GACnBzgB,KAAK0gB,OAASvB,KACdnf,KAAK2gB,IAAID,GACT1gB,KAAK4gB,eAAiB,GACtB5gB,KAAK6gB,iBAAmB,GAiE3B,OAhEA9R,EAAA0R,EAAA,CAAA,CAAAzR,IAAA,MAAAkB,MACD,WAAiB,IAAbwQ,EAAMjgB,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GACOqgB,EAAyBJ,EAAjC1yB,OAAsB+yB,EAAWL,EAArBzyB,SACpB,GAAG6yB,EACC,IAAI,IAAIE,KAAaF,EACbA,EAAGG,eAAeD,KAClBhhB,KAAK0gB,OAAO1yB,OAAOgzB,GAAaF,EAAGE,IAI/C,GAAGD,EACC,IAAI,IAAIC,KAAaD,EACbA,EAAOE,eAAeD,KACtBhhB,KAAK0gB,OAAOzyB,SAAS+yB,GAAaD,EAAOC,MAIxD,CAAAhS,IAAA,QAAAkB,MAED,SAAML,GAAO,IAAA9B,EAAA/N,KACTkhB,EAAyClhB,KAAK0gB,OAA9BI,EAAEI,EAAVlzB,OAAsB+yB,EAAMG,EAAhBjzB,SACdD,EAAS6hB,EAAM7hB,OAAOmzB,EAAAA,WAExB,IAAMC,EAAUN,EAAGE,GACnB,SAASK,EAAiB1hB,GACtByhB,EAAQzhB,EAAGkQ,GAEf7hB,EAAOyC,iBAAiBuwB,EAAWK,GACnCtT,EAAK6S,eAAersB,KAAK,CACrBysB,UAAAA,EACAK,gBAAAA,KARR,IAAI,IAAIL,KAAaF,EAAEK,IAUtB,IAAAG,EAAAA,WAEG,IAAIF,EACAG,EAAU,GAQd,SAASF,EAAiB1hB,GACtByhB,EAAQzhB,EAAGkQ,GARiB,mBAAtBkR,EAAOC,GACbI,EAAUL,EAAOC,IAEjBI,EAAUL,EAAOC,GAAWI,QAC5B9W,OAAOK,OAAO4W,EAASR,EAAOC,GAAWO,UAM7CtzB,SAASwC,iBAAiBuwB,EAAWK,EAAiBE,GACtDxT,EAAK8S,iBAAiBtsB,KAAK,CACvBysB,UAAAA,EACAK,gBAAAA,EACAE,QAAAA,KAjBR,IAAI,IAAIP,KAAaD,EAAMO,MAoB9B,CAAAtS,IAAA,SAAAkB,MAED,SAAOL,GACH,IAAM7hB,EAAS6hB,EAAM7hB,OACrBgS,KAAK4gB,eAAezpB,SAAQ,SAAAsa,GAAoC,IAAjCuP,EAASvP,EAATuP,UAAWK,EAAe5P,EAAf4P,gBACtCrzB,EAAOuC,oBAAoBywB,EAAWK,MAE1CrhB,KAAK6gB,iBAAiB1pB,SAAQ,SAAAqqB,GAA6C,IAA1CR,EAASQ,EAATR,UAAWK,EAAeG,EAAfH,gBAAiBE,EAAOC,EAAPD,QACzDlxB,QAAQC,IAAI,SAAU0wB,GACtB/yB,SAASsC,oBAAoBywB,EAAWK,EAAiBE,UAEhEd,EAtEa,GC9FZgB,GAAUxC,EAAAA,EAAAA,EAAA,GACT9K,IACAoB,IAAW,GAAA,CACdmM,YAAW,SAAC1T,GACRhO,KAAK8X,QAAU,CACXppB,IAAKsf,EAAQ2T,YAAc3T,EAAQ8J,SAAW,EAC9CrZ,MAAOuP,EAAQ4T,cAAgB5T,EAAQ8J,SAAW,EAClDvgB,OAAQyW,EAAQ6T,eAAiB7T,EAAQ8J,SAAW,EACpDrpB,KAAMuf,EAAQ8T,aAAe9T,EAAQ8J,SAAW,IAGxDiK,WAAU,SAAC/T,GACPhO,KAAKgiB,OAAS,CACVtzB,IAAKsf,EAAQiU,WAAajU,EAAQgU,QAAU,EAC5CvjB,MAAOuP,EAAQkU,aAAelU,EAAQgU,QAAU,EAChDzqB,OAAQyW,EAAQmU,cAAgBnU,EAAQgU,QAAU,EAClDvzB,KAAMuf,EAAQoU,YAAcpU,EAAQgU,QAAU,IAGtDK,WAAU,WACN,IAAMjS,EAASpQ,KAAKoQ,OACd0H,EAAU9X,KAAK8X,QACfkK,EAAShiB,KAAKgiB,OACdtpB,GAAMspB,EAAOvzB,KAAOuzB,EAAOvjB,OAAO,EAClC9F,GAAMqpB,EAAOtzB,IAAMszB,EAAOzqB,QAAQ,EAClC+qB,GAAWxK,EAAQrpB,KAAOqpB,EAAQrZ,OAAO,EAAI/F,EAC7C6pB,GAAWzK,EAAQppB,IAAMopB,EAAQvgB,QAAQ,EAAIoB,EAEnD,OADAqH,KAAKwiB,OAAOpS,OAAS,CAACA,EAAO,GAAK1X,EAAI0X,EAAO,GAAKzX,GAC3C,CAACyX,EAAO,GAAKkS,EAASlS,EAAO,GAAKmS,IAE7CE,WAAU,SAAC5wB,GACPmO,KAAKoQ,OAAO,GAAKve,EACjBmO,KAAKqiB,cAETK,WAAU,SAAC5wB,GACPkO,KAAKoQ,OAAO,GAAKte,EACjBkO,KAAKqiB,cAETM,UAASA,SAAC9wB,EAAGC,GACTkO,KAAKoQ,OAAO,GAAKve,EACjBmO,KAAKoQ,OAAO,GAAKte,EACjBkO,KAAKqiB,cAETO,oBAAmB,SAAC5rB,GAChB,IAAA6rB,EAAArR,EAAiBxa,EAAK,GAAf8rB,EAAED,EAAA,GAAEE,EAAEF,EAAA,GACqBG,EAAAxR,EAAjBxR,KAAKqiB,aAAY,GAElC,MADU,CAACS,EADFE,EAAA,GACWD,EADPC,EAAA,KAIjBC,6BAA4B,SAACjwB,EAAGC,EAAGiwB,EAAKC,EAAMC,GAC1C,IAAMhT,EAASpQ,KAAKoQ,OACd0H,EAAU9X,KAAK8X,QACfkK,EAAShiB,KAAKgiB,OACpBkB,EAAIC,GAAQnwB,GAAMod,EAAO,IAAM0H,EAAQrpB,KAAOqpB,EAAQrZ,OAAO,GAAKujB,EAAOvzB,KAAOuzB,EAAOvjB,OAAO,GAC9FykB,EAAIE,GAAQnwB,GAAMmd,EAAO,IAAM0H,EAAQppB,IAAMopB,EAAQvgB,QAAQ,GAAKyqB,EAAOtzB,IAAMszB,EAAOzqB,QAAQ,IAOlG8rB,wBAAuB,SAACrsB,GACpB,IAAAssB,EAAA9R,EAAiBxa,EAAK,GAAf8rB,EAAEQ,EAAA,GAAEP,EAAEO,EAAA,GACqBC,EAAA/R,EAAjBxR,KAAKqiB,aAAY,GAE5BvvB,EAAI,CAACgwB,EAFFS,EAAA,GAEWR,EAFPQ,EAAA,IAGb,OAAGvjB,KAAKqO,UAAYrO,KAAKqO,SAASgV,wBACvBrjB,KAAKqO,SAASgV,wBAAwBvwB,GAEtCA,GAQf6d,qBAAoB,SAAC3Z,GACjB,IAAAwsB,EAAAhS,EAAiBxa,EAAK,GAAf8rB,EAAEU,EAAA,GAAET,EAAES,EAAA,GACqBC,EAAAjS,EAAjBxR,KAAKqiB,aAAY,GAC5BvvB,EAAI,CAACgwB,EADFW,EAAA,GACWV,EADPU,EAAA,IAEb,GAAGzjB,KAAKqO,UAAYrO,KAAKqO,SAASsC,qBAC9B,OAAO3Q,KAAKqO,SAASsC,qBAAqB7d,IAGlD4wB,MAAK,WACD,IAIMtxB,EAAI,IAAIuP,EAJJ3B,KAAKF,aACCwK,OAAOK,OAAO,GAAI3K,KAAKkR,YAAa,CAChDwE,OAAQ1V,KAAKwV,SAAWxV,KAAKwV,QAAQkO,WAQzC,OALA1jB,KAAKsV,mBAAkB,SAACnG,GACpB/c,EAAEqiB,WAAWtF,EAASuU,YAE1BtxB,EAAEikB,cACFjkB,EAAEgc,QAAUpO,KAAKoO,QACVhc,GAEXwjB,qBAAoB,WAChB,MAAO,CACHrnB,MAAOyR,KAAKzR,MACZC,OAAQwR,KAAKxR,SAGrB8hB,gBAAe,WACX,IAAMF,EAASpQ,KAAKoQ,OACdzG,EAAI3J,KAAKzR,MAAO,EAChBitB,EAAIxb,KAAKxR,OAAO,EAChBm1B,EAAMvT,EAAO,GAAKzG,EAClBia,EAAMxT,EAAO,GAAKoL,EAClBqI,EAAMzT,EAAO,GAAKzG,EAClBma,EAAM1T,EAAO,GAAKoL,EAClB/B,EAAKzZ,KAAK8O,cAKhB,OAJA2K,EAAG,GAAKkK,EACRlK,EAAG,GAAKmK,EACRnK,EAAG,GAAKoK,EACRpK,EAAG,GAAKqK,EACDrK,GAEXsK,gCAA+B,WAAG,IAAAtS,EAC1B9a,EAAKqJ,KAAKoQ,OACXpQ,KAAKqO,UAAYrO,KAAKqO,SAASgV,0BAC9B1sB,EAAKqJ,KAAKqO,SAASgV,wBAAwB1sB,IAG/C,IAAmBqtB,EAAAxS,EAAF7a,EAAE,GAAZiB,EAAEosB,EAAA,GAAEnsB,EAAEmsB,EAAA,GACPra,EAAI3J,KAAKzR,MAAM,EACfitB,EAAIxb,KAAKxR,OAAO,EACtB,OAAAmjB,EAAAF,EAAAE,GACKlJ,GAAUC,MAAS,CAAC9Q,EAAG+R,EAAG9R,IAAG8Z,EAAAF,EAC7BhJ,GAAUG,KAAS,CAAChR,EAAG+R,EAAG9R,IAAG8Z,EAAAF,EAC7BhJ,GAAUE,OAAS,CAAC/Q,EAAIC,EAAG2jB,IAAE7J,EAAAF,EAC7BhJ,GAAUI,IAAS,CAACjR,EAAIC,EAAG2jB,IAAE7J,EAAAF,EAC7BhJ,GAAUK,KAAS,CAAClR,EAAK,KAAF+R,EAAS9R,EAAK,KAAF2jB,IAAQ/J,GAGpDwS,sBAAqB,SAACjtB,GAClB,IAUInF,EAAGC,EAVPoyB,EAAA1S,EAAiBxa,EAAK,GAAfU,EAAEwsB,EAAA,GAAEvsB,EAAEusB,EAAA,GACb3S,EAAAC,EAAiBxR,KAAKoQ,OAAM,GAArBxY,EAAE2Z,EAAA,GAAE1Z,EAAE0Z,EAAA,GACP5H,EAAI3J,KAAKzR,MAAM,EACfitB,EAAIxb,KAAKxR,OAAO,EAChB21B,EAAOvsB,EAAKF,EACZ0sB,EAAOvsB,EAAKF,EACZ0sB,EAAS7I,EAAE7R,EACX2a,EAASt1B,KAAK0B,IAAI0zB,EAAKD,GACvBI,EAAO7sB,EAAKE,EACZ4sB,EAAO7sB,EAAKE,EASlB,OAPGysB,EAASD,GACRxyB,EAAI+F,GAAM2sB,EAAK5a,GAAGA,GAClB7X,EAAI6X,GAAK6a,EAAKF,GAAQA,GAAUzsB,IAEhC/F,EAAI+F,GAAM2sB,EAAKhJ,GAAGA,GAClB3pB,EAAI2pB,GAAK+I,EAAKD,GAAQA,GAAU1sB,GAE7B,CAAC/F,EAAGC,IAEfke,eAAc,WACVhQ,KAAKsV,mBAAkB,SAACnG,GACpBA,EAASa,qBAGjBC,eAAc,WACVjQ,KAAKsV,mBAAkB,SAACnG,GACpBA,EAASc,qBAGjBwU,QAAO,WACHzkB,KAAKwiB,OAAOiC,UACZzkB,KAAKsV,mBAAkB,SAACnG,GACpBA,EAASsV,gBAKrB,SAASC,GAAan2B,EAAOC,GACzB,MAAO,CAACD,EAAOC,GAoBnB,SAASm2B,GAAaC,GAAoC,IAAdrD,EAAO9gB,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GAC5CokB,EAA2C,mBAAvBtD,EAAQsD,WAA4BtD,EAAQsD,WAAaH,GAoB7EtyB,WAACkf,GAAA1D,EAAAxb,EAAAkf,GAAA,IAAAzD,EAAAC,EAAA1b,GAOH,SAAAA,EAAY4b,GAAS,IAAA8W,EAAAC,EAAAhX,EAwBO,OAxBPE,OAAA7b,IACjB2b,EAAAF,EAAAK,UAAMF,IACDuG,UAAUvG,GACfD,EAAK0H,WAAWzH,GAEhBD,EAAKyU,OAAS,IAAIoC,EAAqB5W,GACvCD,EAAKyU,OAAOpS,OAAS,CAAC,EAAG,GACzBrC,EAAKyU,OAAOnU,SAAQF,EAAAJ,GACpBA,EAAK2T,YAAY1T,GACjBD,EAAKgU,WAAW/T,GAEhBD,EAAKiX,aAAmBhX,EAAQzf,MAEhCwf,EAAKkX,SAAmBjX,EAAQiX,SAEhClX,EAAKmX,cAAmBlX,EAAQxf,OAEhCuf,EAAKoX,KAA+BL,QAA3BA,EAAe9W,EAAQmX,YAAIL,IAAAA,GAAAA,EACpC/W,EAAKqX,QAAmBpX,EAAQoX,SAAW,UAE3CrX,EAAKsX,YAAsCN,QAA3BA,EAAQ/W,EAAQqX,mBAAWN,IAAAA,GAAAA,EAC3ChX,EAAKiI,wBACLjI,EAAKkI,SACLlI,EAAKiI,wBACLjI,EAAKuX,cAAgB,GAAGvX,EAC3B,OAAAgB,EAAA3c,IAhCW4e,IAiJhB,OA/GA1G,OAAOK,OAAOvY,EAAEmzB,UAAW9D,IAC3BnX,OAAOK,OAAOvY,EAAEmzB,UAAW,CACvBtP,OAAM,WACFwL,GAAWxL,OAAO/H,KAAKlO,MACvB,IAAMgiB,EAAShiB,KAAKgiB,OAG0CwD,EAAAhU,EAF5BqT,EAC1B7kB,KAAKzR,MAAQyzB,EAAOvzB,KAAOuzB,EAAOvjB,MAClCuB,KAAKxR,OAASwzB,EAAOtzB,IAAMszB,EAAOzqB,OAAQyI,KAAKwiB,QAAO,GAFvDiD,EAAUD,EAAA,GAAEE,EAAWF,EAAA,GAG9BxlB,KAAKwiB,OAAOj0B,MAAQk3B,EACpBzlB,KAAKwiB,OAAOh0B,OAASk3B,GAEzBC,UAAS,SAAC3X,GACNhO,KAAKwiB,OAAOmD,UAAU3X,GACtBhO,KAAK0hB,YAAY1T,GACjBhO,KAAK+hB,WAAW/T,GACb,YAAaA,IACZhO,KAAK6O,QAAUb,EAAQa,SAGxBb,EAAQ0H,QAAU1V,KAAKwV,UAAYxH,EAAQ0H,SAC1C1V,KAAKwV,QAAUxH,EAAQ0H,SAG/BM,sBAAqB,WACjB,IAEMld,EAAOoQ,GAFElJ,KAAK6T,OAAO+R,yBAKrB9N,EAAU9X,KAAK8X,QACfmN,EAAWjlB,KAAKilB,SAChBD,EAAehlB,KAAKglB,aACpBrb,EAAI7Q,EAAKvK,MAAQupB,EAAQrpB,KAAOqpB,EAAQrZ,MACxC+c,EAAI1iB,EAAKtK,OAASspB,EAAQppB,IAAMopB,EAAQvgB,OACxCsuB,EAAeZ,EAAWj2B,KAAKgK,IAAIisB,EAAUtb,GAAKqb,GAAgBrb,EAClEmc,EAAgB9lB,KAAKklB,eAAiB1J,EAC5Cxb,KAAK+lB,cAAgBF,EACrB7lB,KAAKgmB,eAAiBF,EAGtB,IAAsFG,EAAAzU,EAApDqT,EAAWgB,EAAcC,EAAe9lB,KAAKwiB,QAAO,GAA/EiD,EAAUQ,EAAA,GAAEP,EAAWO,EAAA,GAC9BjmB,KAAKwiB,OAAOj0B,MAAQk3B,EACpBzlB,KAAKwiB,OAAOh0B,OAASk3B,EAErB,IAAM1D,EAAShiB,KAAKgiB,OACpBhiB,KAAKzR,MAAQk3B,EAAazD,EAAOvzB,KAAOuzB,EAAOvjB,MAC/CuB,KAAKxR,OAASk3B,EAAc1D,EAAOtzB,IAAMszB,EAAOzqB,QAGpD6Z,YAAW,WACP,IAAM8U,EAAelmB,KAAKqO,SAAS8X,kBAC7BC,EAAepmB,KAAKslB,cAI1B,OAFAtlB,KAAKijB,6BAA6BiD,EAAa,GAAIA,EAAa,GAAIE,EAAc,EAAG,GACrFpmB,KAAKijB,6BAA6BiD,EAAa,GAAIA,EAAa,GAAIE,EAAc,EAAG,GAC9EpmB,KAAKslB,eAEhBa,gBAAe,WACX,OAAOnmB,KAAKslB,eAOhB51B,OAAM,SAACvB,GACHA,EAAIyB,OACDoQ,KAAK2T,UACJxlB,EAAIk4B,YAAc,GACK,IAAjBrmB,KAAK6O,UACX1gB,EAAIk4B,YAAcrmB,KAAK6O,SAE3B,IAAkCyX,EAAA9U,EAAjBxR,KAAKqiB,aAAY,GAA3BhH,EAAEiL,EAAA,GAAEzL,EAAEyL,EAAA,GACbtmB,KAAKwiB,OAAO9yB,OAAOvB,GACnBA,EAAIo4B,UAAUlL,EAAIR,GAClB7a,KAAK6T,OAAOnkB,OAAOvB,GAEnBA,EAAIo4B,WAAWlL,GAAKR,GACpB1sB,EAAI0B,WASRqkB,MAAKA,SAACld,EAAOyc,GACT,IAAM3gB,EAAIkN,KAAK4iB,oBAAoB5rB,GACnCgJ,KAAKwmB,UAAY1zB,EACjB,IAAM7C,EAAS+P,KAAK6T,OAAO4S,SAAS3zB,EAAG2gB,GACvC,OAAGxjB,IACC+P,KAAKqlB,aACErlB,KAAKwiB,OAAOtO,MAAMld,MAkB9B5E,EClWLs0B,IAAAA,YAAKpV,GAAA1D,EAAA8Y,EAAApV,GAAA,IAAAzD,EAAAC,EAAA4Y,GACP,SAAAA,EAAY1Y,GAAS,IAAAD,EAKD,OALCE,OAAAyY,IACjB3Y,EAAAF,EAAAK,UAAMF,IACD2Y,KAAmB,QAExB5Y,EAAK6M,OAAmB5M,EAAQ4M,QAAU,GAC1C7M,EAAK6Y,WAAW7Y,EAuHnB,OAtHAgB,EAAA2X,EAAA,CAAA,CAAA1X,IAAA,YAAAkB,MAED,SAAUlC,GAAS,IAAAmC,EAAAnQ,KACfsK,OAAOC,KAAKyD,GAAS7W,SAAQ,SAAA4F,QACPxH,IAAfyY,EAAQjR,IAAmC,OAAfiR,EAAQjR,KACnCoT,EAAKpT,GAAKiR,EAAQjR,GAClBoT,EAAKe,YAAYnU,GAAKiR,EAAQjR,OAGtCiD,KAAK4mB,aACR,CAAA5X,IAAA,WAAAkB,MACD,WACIlQ,KAAKzR,MAAsB,EAAdyR,KAAK4a,OAClB5a,KAAKxR,OAAuB,EAAdwR,KAAK4a,SACtB,CAAA5L,IAAA,SAAAkB,MAED,SAAO/hB,GACHA,EAAIyB,OACDoQ,KAAK2T,YACJxlB,EAAIk4B,YAAc,IAEtBl4B,EAAI4rB,YACJ5rB,EAAIsR,IAAIO,KAAKoQ,OAAO,GAAIpQ,KAAKoQ,OAAO,GAAIpQ,KAAK4a,OAAQ,EAAG,EAAI5rB,KAAKoC,IACjEjD,EAAI8rB,UAAYja,KAAKwO,gBACrBrgB,EAAIotB,OACDvb,KAAKsO,cACJngB,EAAI04B,UAAY7mB,KAAKsO,YACrBngB,EAAI24B,YAAc9mB,KAAKuO,YACvBpgB,EAAI44B,UAKR54B,EAAI0B,YACP,CAAAmf,IAAA,QAAAkB,MAED,SAAMlZ,GACF,IAAMoZ,EAASpQ,KAAKoQ,OACpB,OAAOphB,KAAKgC,IAAIgG,EAAM,GAAKoZ,EAAO,GAAI,GAAKphB,KAAKgC,IAAIgG,EAAM,GAAKoZ,EAAO,GAAI,GAAKpQ,KAAK4a,OAAS5a,KAAK4a,SACrG,CAAA5L,IAAA,kBAAAkB,MAED,WACI,IAAME,EAASpQ,KAAKoQ,OACdvc,EAAImM,KAAK4a,OACT+I,EAAMvT,EAAO,GAAKvc,EAClB+vB,EAAMxT,EAAO,GAAKvc,EAClBgwB,EAAMzT,EAAO,GAAKvc,EAClBiwB,EAAM1T,EAAO,GAAKvc,EAClB4lB,EAAKzZ,KAAK8O,cAKhB,OAJA2K,EAAG,GAAKkK,EACRlK,EAAG,GAAKmK,EACRnK,EAAG,GAAKoK,EACRpK,EAAG,GAAKqK,EACDrK,IACV,CAAAzK,IAAA,wBAAAkB,MAED,SAAsBlZ,GAClB,IAAA6rB,EAAArR,EAAiBxa,EAAK,GAAfU,EAAEmrB,EAAA,GAAElrB,EAAEkrB,EAAA,GACbtR,EAAAC,EAAiBxR,KAAKoQ,OAAM,GAArBxY,EAAE2Z,EAAA,GAAE1Z,EAAE0Z,EAAA,GACP4S,EAAOvsB,EAAKF,EACZ0sB,EAAOvsB,EAAKF,EACZlB,EAAOzH,KAAK+B,KAAKozB,EAAOA,EAAOC,EAAOA,GAEtC4C,EAAQhnB,KAAK4a,OAASnkB,EAC5B,MAAO,CAACmB,EAAKovB,EAAQ7C,EAAMtsB,EAAKmvB,EAAQ5C,KAC3C,CAAApV,IAAA,kCAAAkB,MAED,WAAkC,IAAAuB,EAC9BC,EAAAF,EAAiBxR,KAAKoQ,OAAM,GAArBxY,EAAE8Z,EAAA,GAAE7Z,EAAE6Z,EAAA,GACP7d,EAAImM,KAAK4a,OACf,OAAAjJ,EAAAF,EAAA,GACKhJ,GAAUC,MAAS,CAAC9Q,EAAK/D,EAAGgE,IAAG8Z,EAAAF,EAC/BhJ,GAAUG,KAAS,CAAChR,EAAK/D,EAAGgE,IAAG8Z,EAAAF,EAC/BhJ,GAAUE,OAAS,CAAC/Q,EAAIC,EAAGhE,IAAE8d,EAAAF,EAC7BhJ,GAAUI,IAAS,CAACjR,EAAIC,EAAGhE,IAAE4d,IAErC,CAAAzC,IAAA,uCAAAkB,MAED,SAAqClZ,EAAO4D,GAAK,IAAAqsB,EAC7C3D,EAAA9R,EAAiBxa,EAAK,GAAfU,EAAE4rB,EAAA,GAAE3rB,EAAE2rB,EAAA,GACb4D,EAAA1V,EAAiBxR,KAAKoQ,OAAM,GAArBxY,EAAEsvB,EAAA,GAAErvB,EAAEqvB,EAAA,GACPrzB,EAAImM,KAAK4a,OACTuJ,EAAOvsB,EAAKF,EACZ0sB,EAAOvsB,EAAKF,EACZwvB,GAAgBxV,EAAAsV,EAAA,GACjBxe,GAAUC,MAAS,CAAC9Q,EAAK/D,EAAGgE,IAAG8Z,EAAAsV,EAC/Bxe,GAAUG,KAAS,CAAChR,EAAK/D,EAAGgE,IAAG8Z,EAAAsV,EAC/Bxe,GAAUE,OAAS,CAAC/Q,EAAIC,EAAGhE,IAAE8d,EAAAsV,EAC7Bxe,GAAUI,IAAS,CAACjR,EAAIC,EAAGhE,IAAEozB,GAc9BG,EAAYp4B,KAAK0B,IAAI0zB,GAAQp1B,KAAK0B,IAAIyzB,GACnCC,EAAO,EAAI3b,GAAUE,OAASF,GAAUI,IACxCsb,EAAO,EAAI1b,GAAUC,MAAQD,GAAUG,KAG9C,MAAO,CACH9V,EAAGq0B,EAAiBC,GACpBvc,IAAKuc,KAEZ,CAAApY,IAAA,uBAAAkB,MAED,WACI,MAAO,CACH3hB,MAAOyR,KAAKzR,MACZC,OAAQwR,KAAKxR,YAEpBk4B,GA7He1V,ICoBdqW,YAAS/V,GAAA1D,EAAAyZ,EAAA/V,GAAA,IAAAzD,EAAAC,EAAAuZ,GACX,SAAAA,IAA0B,IAAAtZ,EAAdC,EAAOvN,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GASO,OATLwN,OAAAoZ,IACpBtZ,EAAAF,EAAAK,UAAMF,IACD2Y,KAAmB,YAExB5Y,EAAKxf,MAAmByf,EAAQzf,OAAS,GAEzCwf,EAAKvf,OAAmBwf,EAAQxf,QAAU,GAE1Cuf,EAAKuZ,aAAmBtZ,EAAQsZ,cAAgB,EAChDvZ,EAAKwZ,WAAWvZ,GAASD,EAiT5B,OAhTAgB,EAAAsY,EAAA,CAAA,CAAArY,IAAA,aAAAkB,MAED,SAAWlC,GAAQ,IAAAwZ,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAEfnoB,KAAKooB,OAAS,CACV15B,IAAK,CACD25B,OAAqBb,QAAdA,EAAAxZ,EAAQoa,cAAMZ,IAAAA,GAAK,QAALA,EAAdA,EAAgB94B,WAAG,IAAA84B,OAAA,EAAnBA,EAAqBjZ,cAAeP,EAAQO,aAAe,cAClEhgB,OAAqBk5B,QAAdA,EAAAzZ,EAAQoa,cAAMX,IAAAA,GAAK,QAALA,EAAdA,EAAgB/4B,WAAG,IAAA+4B,OAAA,EAAnBA,EAAqBnZ,cAAeN,EAAQM,aAAe,EAClEga,eAAMZ,EAAE1Z,EAAQoa,cAAM,IAAAV,WAAAA,EAAdA,EAAgBh5B,WAAG,IAAAg5B,OAAA,EAAnBA,EAAqBpZ,aAEjC7P,MAAO,CACH4pB,OAAqBV,QAAdA,EAAA3Z,EAAQoa,cAAMT,IAAAA,GAAO,QAAPA,EAAdA,EAAgBlpB,aAAK,IAAAkpB,OAAA,EAArBA,EAAuBpZ,cAAeP,EAAQO,aAAe,cACpEhgB,OAAqBq5B,QAAdA,EAAA5Z,EAAQoa,cAAMR,IAAAA,GAAO,QAAPA,EAAdA,EAAgBnpB,aAAK,IAAAmpB,OAAA,EAArBA,EAAuBtZ,cAAeN,EAAQM,aAAe,EACpEga,eAAMT,EAAE7Z,EAAQoa,cAAM,IAAAP,WAAAA,EAAdA,EAAgBppB,aAAK,IAAAopB,OAAA,EAArBA,EAAuBvZ,aAEnC/W,OAAQ,CACJ8wB,OAAqBP,QAAdA,EAAA9Z,EAAQoa,cAAMN,IAAAA,GAAQ,QAARA,EAAdA,EAAgBvwB,cAAM,IAAAuwB,OAAA,EAAtBA,EAAwBvZ,cAAeP,EAAQO,aAAe,cACrEhgB,OAAqBw5B,QAAdA,EAAA/Z,EAAQoa,cAAML,IAAAA,GAAQ,QAARA,EAAdA,EAAgBxwB,cAAM,IAAAwwB,OAAA,EAAtBA,EAAwBzZ,cAAeN,EAAQM,aAAe,EACrEga,eAAMN,EAAEha,EAAQoa,cAAM,IAAAJ,WAAAA,EAAdA,EAAgBzwB,cAAM,IAAAywB,OAAA,EAAtBA,EAAwB1Z,aAEpC7f,KAAM,CACF45B,OAAqBJ,QAAdA,EAAAja,EAAQoa,cAAMH,IAAAA,GAAM,QAANA,EAAdA,EAAgBx5B,YAAI,IAAAw5B,OAAA,EAApBA,EAAsB1Z,cAAeP,EAAQO,aAAe,cACnEhgB,OAAqB25B,QAAdA,EAAAla,EAAQoa,cAAMF,IAAAA,GAAM,QAANA,EAAdA,EAAgBz5B,YAAI,IAAAy5B,OAAA,EAApBA,EAAsB5Z,cAAeN,EAAQM,aAAe,EACnEga,eAAMH,EAAEna,EAAQoa,cAAM,IAAAD,WAAAA,EAAdA,EAAgB15B,YAAI,IAAA05B,OAAA,EAApBA,EAAsB7Z,cAGtCtO,KAAKuO,YAAcP,EAAQO,aAAe,cAC1CvO,KAAKsO,YAAcN,EAAQM,aAAe,IAC7C,CAAAU,IAAA,YAAAkB,MAED,SAAUlC,GAAS,IAAAmC,EAAAnQ,KACfsK,OAAOC,KAAKyD,GAAS7W,SAAQ,SAAA4F,QACPxH,IAAfyY,EAAQjR,IAAmC,OAAfiR,EAAQjR,KACnCoT,EAAKpT,GAAKiR,EAAQjR,GAClBoT,EAAKe,YAAYnU,GAAKiR,EAAQjR,OAGtCiD,KAAKunB,WAAWvZ,KACnB,CAAAgB,IAAA,SAAAkB,MAED,SAAO/hB,GACHA,EAAIyB,OACDoQ,KAAK2T,YACJxlB,EAAIk4B,YAAc,IAGtB,IACkBzL,EACd5a,KADAsnB,aACAtnB,KADsBoQ,WAAQ7hB,EAC9ByR,KAD8BzR,MAAOC,EACrCwR,KADqCxR,OAEnCqD,EAAImO,KAAKoQ,OAAO,GAAKpQ,KAAKzR,MAAQ,EAClCuD,EAAIkO,KAAKoQ,OAAO,GAAKpQ,KAAKxR,OAAS,EACnC+5B,EAAKvoB,KAAKoQ,OAAO,GAAKpQ,KAAKzR,MAAQ,EACnCi6B,EAAKxoB,KAAKoQ,OAAO,GAAKpQ,KAAKxR,OAAS,EAsB1C,GArBGwR,KAAKsnB,cACJn5B,EAAI4rB,YACJ5rB,EAAI6sB,OAAOnpB,EAAI+oB,EAAQ9oB,GACvB3D,EAAI8sB,OAAOppB,EAAItD,EAAQqsB,EAAQ9oB,GAC/B3D,EAAIs6B,iBAAiB52B,EAAItD,EAAOuD,EAAGD,EAAItD,EAAOuD,EAAI8oB,GAClDzsB,EAAI8sB,OAAOppB,EAAItD,EAAOuD,EAAItD,EAASosB,GACnCzsB,EAAIs6B,iBAAiB52B,EAAItD,EAAOuD,EAAItD,EAAQqD,EAAItD,EAAQqsB,EAAQ9oB,EAAItD,GACpEL,EAAI8sB,OAAOppB,EAAI+oB,EAAQ9oB,EAAItD,GAC3BL,EAAIs6B,iBAAiB52B,EAAGC,EAAItD,EAAQqD,EAAGC,EAAItD,EAASosB,GACpDzsB,EAAI8sB,OAAOppB,EAAGC,EAAI8oB,GAClBzsB,EAAIs6B,iBAAiB52B,EAAGC,EAAGD,EAAI+oB,EAAQ9oB,GACvC3D,EAAI+sB,cAEJ/sB,EAAI4rB,YACJ5rB,EAAIkiB,KAAKrQ,KAAKoQ,OAAO,GAAKpQ,KAAKzR,MAAQ,EAAGyR,KAAKoQ,OAAO,GAAKpQ,KAAKxR,OAAS,EAAGwR,KAAKzR,MAAOyR,KAAKxR,SAE9FwR,KAAKsO,cACJngB,EAAI04B,UAAY7mB,KAAKsO,YACrBngB,EAAI24B,YAAc9mB,KAAKuO,aAGxBvO,KAAKyO,aAAoC,gBAArBzO,KAAKyO,YAA+B,CACvDtgB,EAAIsgB,YAAczO,KAAKyO,YACvB,IAAM5f,EAAQmR,KAAKiP,OAAOpgB,MAC1BV,EAAIugB,WAAa1O,KAAK0O,WAAa7f,EACnCV,EAAIwgB,cAAgB3O,KAAK2O,cAAgB9f,EACzCV,EAAIygB,cAAgB5O,KAAK4O,cAAgB/f,EACzC,IAAI65B,EAAa,IAAIC,OAClB3oB,KAAKsnB,cACJoB,EAAW1N,OAAOnpB,EAAI+oB,EAAQ9oB,GAC9B42B,EAAWzN,OAAOppB,EAAItD,EAAQqsB,EAAQ9oB,GACtC42B,EAAWD,iBAAiB52B,EAAItD,EAAOuD,EAAGD,EAAItD,EAAOuD,EAAI8oB,GACzD8N,EAAWzN,OAAOppB,EAAItD,EAAOuD,EAAItD,EAASosB,GAC1C8N,EAAWD,iBAAiB52B,EAAItD,EAAOuD,EAAItD,EAAQqD,EAAItD,EAAQqsB,EAAQ9oB,EAAItD,GAC3Ek6B,EAAWzN,OAAOppB,EAAI+oB,EAAQ9oB,EAAItD,GAClCk6B,EAAWD,iBAAiB52B,EAAGC,EAAItD,EAAQqD,EAAGC,EAAItD,EAASosB,GAC3D8N,EAAWzN,OAAOppB,EAAGC,EAAI8oB,GACzB8N,EAAWD,iBAAiB52B,EAAGC,EAAGD,EAAI+oB,EAAQ9oB,GAC9C42B,EAAWxN,aAEXwN,EAAWrY,KAAKrQ,KAAKoQ,OAAO,GAAKpQ,KAAKzR,MAAQ,EAAGyR,KAAKoQ,OAAO,GAAKpQ,KAAKxR,OAAS,EAAGwR,KAAKzR,MAAOyR,KAAKxR,QAExGk6B,EAAWrY,KAAKxe,EAAI,GAAIC,EAAI,GAAIkO,KAAKzR,MAAO,GAAIyR,KAAKxR,OAAQ,IAC7DL,EAAIyB,OACJzB,EAAI6rB,KAAK0O,EAAY,WACrBv6B,EAAI44B,SACJ54B,EAAI0B,UASR,GAPA1B,EAAI8rB,UAAYja,KAAKwO,gBACrBrgB,EAAIotB,OACDvb,KAAKsnB,cAAgBtnB,KAAKsO,cACzBngB,EAAIsgB,YAAc,cAClBtgB,EAAI44B,UAGL/mB,KAAKsnB,cACJ,GAAGtnB,KAAKooB,OAAO15B,IAAI45B,OAAQ,CACvB,IAAMltB,EAAKtJ,EAAIkO,KAAKooB,OAAO15B,IAAIH,MAAQ,EAEvCJ,EAAI4rB,YACJ,IAAI6O,EAAU,IAAID,OAClBC,EAAQ5N,OAAOnpB,EAAGuJ,EAAKwf,GACvBgO,EAAQH,iBAAiB52B,EAAGuJ,EAAIvJ,EAAI+oB,EAAQxf,GAC5CwtB,EAAQ3N,OAAOppB,EAAItD,EAAQqsB,EAAQxf,GACnCwtB,EAAQH,iBAAiB52B,EAAItD,EAAO6M,EAAIvJ,EAAItD,EAAO6M,EAAKwf,GACxDgO,EAAQ1N,YACR/sB,EAAI6rB,KAAK4O,GACTz6B,EAAIyB,OACJzB,EAAIsgB,YAAc,cAClBtgB,EAAI8rB,UAAYja,KAAKooB,OAAO15B,IAAI25B,MAChCl6B,EAAIkiB,KAAKxe,EAAGuJ,EAAI4E,KAAKzR,MAAOyR,KAAKooB,OAAO15B,IAAIH,OAC5CJ,EAAIotB,OACJptB,EAAI0B,gBAsBLmQ,KAAKooB,OAAO15B,IAAIH,QACfJ,EAAI4rB,YACJ5rB,EAAI6sB,OAAOnpB,EAAGC,GACd3D,EAAI8sB,OAAOsN,EAAIz2B,GACf3D,EAAI24B,YAAc9mB,KAAKooB,OAAO15B,IAAI25B,MAClCl6B,EAAI04B,UAAY7mB,KAAKooB,OAAO15B,IAAIH,MAChCJ,EAAI44B,UAGL/mB,KAAKooB,OAAO3pB,MAAMlQ,QACjBJ,EAAI4rB,YACJ5rB,EAAI6sB,OAAOuN,EAAIz2B,GACf3D,EAAI8sB,OAAOsN,EAAIC,GACfr6B,EAAI24B,YAAc9mB,KAAKooB,OAAO3pB,MAAM4pB,MACpCl6B,EAAI04B,UAAY7mB,KAAKooB,OAAO3pB,MAAMlQ,MAClCJ,EAAI44B,UAGL/mB,KAAKooB,OAAO7wB,OAAOhJ,QAClBJ,EAAI4rB,YACJ5rB,EAAI6sB,OAAOuN,EAAIC,GACfr6B,EAAI8sB,OAAOppB,EAAG22B,GACdr6B,EAAI24B,YAAc9mB,KAAKooB,OAAO7wB,OAAO8wB,MACrCl6B,EAAI04B,UAAY7mB,KAAKooB,OAAO7wB,OAAOhJ,MACnCJ,EAAI44B,UAGL/mB,KAAKooB,OAAO35B,KAAKF,QAChBJ,EAAI4rB,YACJ5rB,EAAI6sB,OAAOnpB,EAAG22B,GACdr6B,EAAI8sB,OAAOppB,EAAGC,GACd3D,EAAI24B,YAAc9mB,KAAKooB,OAAO35B,KAAK45B,MACnCl6B,EAAI04B,UAAY7mB,KAAKooB,OAAO35B,KAAKF,MACjCJ,EAAI44B,UAGZ54B,EAAI0B,YACP,CAAAmf,IAAA,QAAAkB,MAED,SAAMlZ,GACF,IAAMoZ,EAASpQ,KAAKoQ,OACdzG,EAAI3J,KAAKzR,MAAO,EAChBitB,EAAIxb,KAAKxR,OAAO,EACtB,OAAOwI,EAAM,GAAKoZ,EAAO,GAAKzG,GACvB3S,EAAM,GAAKoZ,EAAO,GAAKzG,GACvB3S,EAAM,GAAKoZ,EAAO,GAAKoL,GACvBxkB,EAAM,GAAKoZ,EAAO,GAAKoL,IACjC,CAAAxM,IAAA,kBAAAkB,MAED,WACI,IAAME,EAASpQ,KAAKoQ,OACdzG,EAAI3J,KAAKzR,MAAO,EAChBitB,EAAIxb,KAAKxR,OAAO,EAChBm1B,EAAMvT,EAAO,GAAKzG,EAClBia,EAAMxT,EAAO,GAAKoL,EAClBqI,EAAMzT,EAAO,GAAKzG,EAClBma,EAAM1T,EAAO,GAAKoL,EAClB/B,EAAKzZ,KAAK8O,cAKhB,OAJA2K,EAAG,GAAKkK,EACRlK,EAAG,GAAKmK,EACRnK,EAAG,GAAKoK,EACRpK,EAAG,GAAKqK,EACDrK,IACV,CAAAzK,IAAA,uBAAAkB,MAED,WACI,MAAO,CACH1hB,OAAQwR,KAAKxR,OACbD,MAAOyR,KAAKzR,SAEnB,CAAAygB,IAAA,wBAAAkB,MAED,SAAsBlZ,GAClB,IAUInF,EAAGC,EAVP+wB,EAAArR,EAAiBxa,EAAK,GAAfU,EAAEmrB,EAAA,GAAElrB,EAAEkrB,EAAA,GACbtR,EAAAC,EAAiBxR,KAAKoQ,OAAM,GAArBxY,EAAE2Z,EAAA,GAAE1Z,EAAE0Z,EAAA,GACP5H,EAAI3J,KAAKzR,MAAM,EACfitB,EAAIxb,KAAKxR,OAAO,EAChB21B,EAAOvsB,EAAKF,EACZ0sB,EAAOvsB,EAAKF,EACZ0sB,EAAS7I,EAAE7R,EACX2a,EAASt1B,KAAK0B,IAAI0zB,EAAKD,GACvBI,EAAO7sB,EAAKE,EACZ4sB,EAAO7sB,EAAKE,EASlB,OAPGysB,EAASD,GACRxyB,EAAI+F,GAAM2sB,EAAK5a,GAAGA,GAClB7X,EAAI6X,GAAK6a,EAAKF,GAAQA,GAAUzsB,IAEhC/F,EAAI+F,GAAM2sB,EAAKhJ,GAAGA,GAClB3pB,EAAI2pB,GAAK+I,EAAKD,GAAQA,GAAU1sB,GAE7B,CAAC/F,EAAGC,KACd,CAAAkd,IAAA,kCAAAkB,MAED,WAAkC,IAAAuB,EAC1B9a,EAAKqJ,KAAKoQ,OACXpQ,KAAKqO,UAAYrO,KAAKqO,SAASgV,0BAC9B1sB,EAAKqJ,KAAKqO,SAASgV,wBAAwB1sB,IAG/C,IAAmBqtB,EAAAxS,EAAF7a,EAAE,GAAZiB,EAAEosB,EAAA,GAAEnsB,EAAEmsB,EAAA,GACPra,EAAI3J,KAAKzR,MAAM,EACfitB,EAAIxb,KAAKxR,OAAO,EACtB,OAAAmjB,EAAAF,EAAA,GACKhJ,GAAUC,MAAS,CAAC9Q,EAAG+R,EAAG9R,IAAG8Z,EAAAF,EAC7BhJ,GAAUG,KAAS,CAAChR,EAAG+R,EAAG9R,IAAG8Z,EAAAF,EAC7BhJ,GAAUE,OAAS,CAAC/Q,EAAIC,EAAG2jB,IAAE7J,EAAAF,EAC7BhJ,GAAUI,IAAS,CAACjR,EAAIC,EAAG2jB,IAAE/J,IAErC,CAAAzC,IAAA,uCAAAkB,MAED,SAAqClZ,EAAO4D,GAAK,IAAAqsB,EAC7C3D,EAAA9R,EAAiBxa,EAAK,GAAfU,EAAE4rB,EAAA,GAAE3rB,EAAE2rB,EAAA,GACT3sB,EAAKqJ,KAAKoQ,OACXpQ,KAAKqO,UAAYrO,KAAKqO,SAASgV,0BAC9B1sB,EAAKqJ,KAAKqO,SAASgV,wBAAwB1sB,IAG/C,IAAmBkyB,EAAArX,EAAF7a,EAAE,GAAZiB,EAAEixB,EAAA,GAAEhxB,EAAEgxB,EAAA,GACPlf,EAAI3J,KAAKzR,MAAM,EACfitB,EAAIxb,KAAKxR,OAAO,EAChB24B,GAAgBxV,EAAAsV,EAAA,GACjBxe,GAAUC,MAAS,CAAC9Q,EAAG+R,EAAG9R,IAAG8Z,EAAAsV,EAC7Bxe,GAAUG,KAAS,CAAChR,EAAG+R,EAAG9R,IAAG8Z,EAAAsV,EAC7Bxe,GAAUE,OAAS,CAAC/Q,EAAIC,EAAG2jB,IAAE7J,EAAAsV,EAC7Bxe,GAAUI,IAAS,CAACjR,EAAIC,EAAG2jB,IAAEyL,GAE5B9C,EAAOvsB,EAAKF,EACZ0sB,EAAOvsB,EAAKF,EACZ0sB,EAAS7I,EAAE7R,EAEX4a,EAAO7sB,EAAKE,EAEdwvB,EAHWp4B,KAAK0B,IAAI0zB,EAAKD,GAGJE,EADZ1sB,EAAKE,EAEJ4Q,GAAUE,OAASF,GAAUI,IACpC0b,EAAO9b,GAAUC,MAAQD,GAAUG,KAkB1C,MAAO,CACH9V,EAAGq0B,EAAiBC,GACpBvc,IAAKuc,OAEZC,GA3TmBrW,ICnBlB8X,YAAOxX,GAAA1D,EAAAkb,EAAAxX,GAAA,IAAAzD,EAAAC,EAAAgb,GACT,SAAAA,IAA0B,IAAA/a,EAAdC,EAAOvN,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GAM2B,OANzBwN,OAAA6a,IACpB/a,EAAAF,EAAAK,UAAMF,IACD2Y,KAAmB,UAExB5Y,EAAKxf,MAAmByf,EAAQzf,OAAS,GAEzCwf,EAAKvf,OAAmBwf,EAAQxf,QAAU,GAAGuf,EAgGhD,OA/FAgB,EAAA+Z,EAAA,CAAA,CAAA9Z,IAAA,SAAAkB,MAED,SAAO/hB,GACHA,EAAIyB,OACDoQ,KAAK2T,YACJxlB,EAAIk4B,YAAc,IAEtBl4B,EAAI4rB,YACJ,IAAAxI,EAAAC,EAAexR,KAAKoQ,OAAM,GAAnBve,EAAC0f,EAAA,GAAEzf,EAACyf,EAAA,GACLwX,EAAK/oB,KAAKzR,MAAM,EAChBy6B,EAAKhpB,KAAKxR,OAAO,EACjBy6B,EAAap3B,EAAIk3B,EAAKC,EACtBE,EAAcr3B,EAAIk3B,EAAKC,EACvBt6B,EAAMoD,EAAIk3B,EACVzxB,EAASzF,EAAIk3B,EAEnB76B,EAAI6sB,OAAOiO,EAAYv6B,GACvBP,EAAI8sB,OAAOiO,EAAax6B,GACxBP,EAAIsR,IAAIypB,EAAap3B,EAAGk3B,GAAKh6B,KAAKoC,GAAG,EAAGpC,KAAKoC,GAAG,GAChDjD,EAAI8sB,OAAOgO,EAAY1xB,GACvBpJ,EAAIsR,IAAIwpB,EAAYn3B,EAAGk3B,EAAIh6B,KAAKoC,GAAG,EAAGpC,KAAKoC,GAAG,EAAE,GAEhDjD,EAAI8rB,UAAYja,KAAKwO,gBACjBxO,KAAKyO,cACLtgB,EAAIsgB,YAAczO,KAAKyO,YACvBtgB,EAAIugB,WAAa1O,KAAK0O,WACtBvgB,EAAIwgB,cAAgB3O,KAAK2O,cACzBxgB,EAAIygB,cAAgB5O,KAAK4O,eAE7BzgB,EAAIotB,OACDvb,KAAKsO,cACJngB,EAAI04B,UAAY7mB,KAAKsO,YACrBngB,EAAI24B,YAAc9mB,KAAKuO,YACvBpgB,EAAI44B,UAKR54B,EAAI0B,YACP,CAAAmf,IAAA,QAAAkB,MAED,SAAMlZ,GACF,IAAMoZ,EAASpQ,KAAKoQ,OACd2Y,EAAK/oB,KAAKzR,MAAM,EAChBy6B,EAAKhpB,KAAKxR,OAAO,EACjB26B,EAAMn6B,KAAK0B,IAAIq4B,EAAKC,GACpBC,EAAa7Y,EAAO,GAAK2Y,EAAKC,EAC9BE,EAAc9Y,EAAO,GAAK2Y,EAAKC,EAC/BI,EAAKJ,EAAKA,EAChB,OAAQhyB,EAAM,GAAKoZ,EAAO,GAAK+Y,GACxBnyB,EAAM,GAAKoZ,EAAO,GAAK+Y,GACvBnyB,EAAM,GAAKoZ,EAAO,GAAK4Y,GACvBhyB,EAAM,GAAKoZ,EAAO,GAAK4Y,GACrBh6B,KAAKgC,IAAIgG,EAAM,GAAKiyB,EAAY,GAAKj6B,KAAKgC,IAAIgG,EAAM,GAAKoZ,EAAO,GAAI,GAAKgZ,GACzEp6B,KAAKgC,IAAIgG,EAAM,GAAKkyB,EAAa,GAAKl6B,KAAKgC,IAAIgG,EAAM,GAAKoZ,EAAO,GAAI,GAAKgZ,IACtF,CAAApa,IAAA,kBAAAkB,MAED,WACI,IAAME,EAASpQ,KAAKoQ,OACdzG,EAAI3J,KAAKzR,MAAO,EAChBitB,EAAIxb,KAAKxR,OAAO,EAChBm1B,EAAMvT,EAAO,GAAKzG,EAClBia,EAAMxT,EAAO,GAAKoL,EAClBqI,EAAMzT,EAAO,GAAKzG,EAClBma,EAAM1T,EAAO,GAAKoL,EAClB/B,EAAKzZ,KAAK8O,cAKhB,OAJA2K,EAAG,GAAKkK,EACRlK,EAAG,GAAKmK,EACRnK,EAAG,GAAKoK,EACRpK,EAAG,GAAKqK,EACDrK,IACV,CAAAzK,IAAA,uBAAAkB,MAED,WACI,MAAO,CACH1hB,OAAQwR,KAAKxR,OACbD,MAAOyR,KAAKzR,SAEnB,CAAAygB,IAAA,kCAAAkB,MAED,WAAkC,IAAAuB,EAC1B9a,EAAKqJ,KAAKoQ,OACXpQ,KAAKqO,UAAYrO,KAAKqO,SAASgV,0BAC9B1sB,EAAKqJ,KAAKqO,SAASgV,wBAAwB1sB,IAG/C,IAAmBqtB,EAAAxS,EAAF7a,EAAE,GAAZiB,EAAEosB,EAAA,GAAEnsB,EAAEmsB,EAAA,GACPra,EAAI3J,KAAKzR,MAAM,EACfitB,EAAIxb,KAAKxR,OAAO,EACtB,OAAAmjB,EAAAF,EAAA,GACKhJ,GAAUC,MAAS,CAAC9Q,EAAG+R,EAAG9R,IAAG8Z,EAAAF,EAC7BhJ,GAAUG,KAAS,CAAChR,EAAG+R,EAAG9R,IAAG8Z,EAAAF,EAC7BhJ,GAAUE,OAAS,CAAC/Q,EAAIC,EAAG2jB,IAAE7J,EAAAF,EAC7BhJ,GAAUI,IAAS,CAACjR,EAAIC,EAAG2jB,IAAE/J,MAErCqX,GAvGiB9X,ICPhBqY,YAAeC,GAAA1b,EAAAyb,EAAAC,GAAA,IAAAzb,EAAAC,EAAAub,GAAA,SAAAA,IAAA,OAAApb,OAAAob,GAAAxb,EAAA0b,MAAAvpB,KAAAS,WAsDhB,OAtDgBsO,EAAAsa,EAAA,CAAA,CAAAra,IAAA,SAAAkB,MACjB,SAAO/hB,GACHA,EAAIyB,OACDoQ,KAAK2T,YACJxlB,EAAIk4B,YAAc,IAEtBl4B,EAAI4rB,YACJ,IAAAxI,EAAAC,EAAexR,KAAKoQ,OAAM,GAAnBve,EAAC0f,EAAA,GAAEzf,EAACyf,EAAA,GACLwX,EAAK/oB,KAAKzR,MAAM,EAChBy6B,EAAKhpB,KAAKxR,OAAO,EACjBg7B,EAAY13B,EAAIk3B,EAAKD,EACrBU,EAAe33B,EAAIk3B,EAAKD,EACxBt6B,EAAOoD,EAAIk3B,EACXtqB,EAAQ5M,EAAIk3B,EAElB56B,EAAI6sB,OAAOvsB,EAAM+6B,GACjBr7B,EAAIsR,IAAI5N,EAAG23B,EAAWT,GAAK/5B,KAAKoC,GAAI,GACpCjD,EAAI8sB,OAAOxc,EAAOgrB,GAClBt7B,EAAIsR,IAAI5N,EAAG43B,EAAcV,EAAI,EAAG/5B,KAAKoC,IACrCjD,EAAI+sB,YAEJ/sB,EAAI8rB,UAAYja,KAAKwO,gBACjBxO,KAAKyO,cACLtgB,EAAIsgB,YAAczO,KAAKyO,YACvBtgB,EAAIugB,WAAa1O,KAAK0O,WACtBvgB,EAAIwgB,cAAgB3O,KAAK2O,cACzBxgB,EAAIygB,cAAgB5O,KAAK4O,eAE7BzgB,EAAIotB,OACDvb,KAAKsO,cACJngB,EAAI04B,UAAY7mB,KAAKsO,YACrBngB,EAAI24B,YAAc9mB,KAAKuO,YACvBpgB,EAAI44B,UAKR54B,EAAI0B,YACP,CAAAmf,IAAA,QAAAkB,MAED,SAAMlZ,EAAOyc,GACT,IAAA/B,EAAAF,EAAexR,KAAKoQ,OAAM,GAAnBve,EAAC6f,EAAA,GAAE5f,EAAC4f,EAAA,GACLqX,EAAK/oB,KAAKzR,MAAM,EAChBy6B,EAAKhpB,KAAKxR,OAAO,EACjBk7B,EAAM16B,KAAK0B,IAAIs4B,EAAKD,GACpBS,EAAY13B,EAAIk3B,EAAKD,EACrBU,EAAe33B,EAAIk3B,EAAKD,EACxBK,EAAKL,EAAKA,EAChB,OAAQ/xB,EAAM,GAAKnF,EAAIk3B,GAChB/xB,EAAM,GAAKnF,EAAIk3B,GACf/xB,EAAM,GAAKlF,EAAI43B,GACf1yB,EAAM,GAAKlF,EAAI43B,GACb16B,KAAKgC,IAAIgG,EAAM,GAAKnF,EAAG,GAAK7C,KAAKgC,IAAIgG,EAAM,GAAKwyB,EAAW,GAAKJ,GAChEp6B,KAAKgC,IAAIgG,EAAM,GAAKnF,EAAG,GAAK7C,KAAKgC,IAAIgG,EAAM,GAAKyyB,EAAc,GAAKL,MAC/EC,GAtDyBP,ICOxBa,YAAOrY,GAAA1D,EAAA+b,EAAArY,GAAA,IAAAzD,EAAAC,EAAA6b,GACT,SAAAA,IAA0B,IAAA5b,EAAdC,EAAOvN,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GAM+B,OAN7BwN,OAAA0b,IACpB5b,EAAAF,EAAAK,UAAMF,IACD2Y,KAAmB,UAExB5Y,EAAKvf,OAAmBwf,EAAQ4b,YAAc,GAE9C7b,EAAKxf,MAAmByf,EAAQ6b,YAAc,GAAG9b,EA4GpD,OA3GAgB,EAAA4a,EAAA,CAAA,CAAA3a,IAAA,SAAAkB,MAED,SAAO/hB,GACHA,EAAIyB,OACDoQ,KAAK2T,YACJxlB,EAAIk4B,YAAc,IAEtB,IAAM1c,EAAI3J,KAAKzR,MAAQ,EACjBitB,EAAIxb,KAAKxR,OAAS,EAClBs7B,EAAS9pB,KAAKoQ,OAcpB,GAbAjiB,EAAIo4B,UAAUuD,EAAO,GAAIA,EAAO,IAChC37B,EAAI4rB,YACJ5rB,EAAI6sB,OAAO,GAAIQ,GACfrtB,EAAI8sB,OAAOtR,EAAG,GACdxb,EAAI8sB,OAAO,EAAGO,GACdrtB,EAAI8sB,QAAQtR,EAAG,GACfxb,EAAI+sB,YACDlb,KAAKsO,cACJngB,EAAI04B,UAAY7mB,KAAKsO,YACrBngB,EAAI24B,YAAc9mB,KAAKuO,aAIxBvO,KAAKyO,YAAa,CACjBtgB,EAAIsgB,YAAczO,KAAKyO,YACvB,IAAM5f,EAAQmR,KAAKiP,OAAOpgB,MAC1BV,EAAIugB,WAAa1O,KAAK0O,WAAa7f,EACnCV,EAAIwgB,cAAgB3O,KAAK2O,cAAgB9f,EACzCV,EAAIygB,cAAgB5O,KAAK4O,cAAgB/f,EACzC,IAAI65B,EAAa,IAAIC,OACrBD,EAAW1N,OAAO,GAAIQ,GACtBkN,EAAWzN,OAAOtR,EAAG,GACrB+e,EAAWzN,OAAO,EAAGO,GACrBkN,EAAWzN,QAAQtR,EAAG,GACtB+e,EAAWxN,YACXwN,EAAWrY,MAAM1G,EAAI,IAAM6R,EAAI,GAAIxb,KAAKzR,MAAQ,GAAIyR,KAAKxR,OAAQ,IAOjEL,EAAIyB,OACJzB,EAAI6rB,KAAK0O,EAAY,WACrBv6B,EAAI44B,SACJ54B,EAAI0B,UAER1B,EAAI8rB,UAAYja,KAAKwO,gBACrBrgB,EAAIotB,OACAvb,KAAKsO,cACLngB,EAAIsgB,YAAc,cAClBtgB,EAAI44B,UAGR54B,EAAIo4B,WAAWuD,EAAO,IAAKA,EAAO,IAClC37B,EAAI0B,YACP,CAAAmf,IAAA,QAAAkB,MAED,SAAMlZ,GACF,IAAM9F,EAAI8O,KAAKxR,OAAS,EAClBgtB,EAAIxb,KAAKzR,MAAQ,EACjB6hB,EAASpQ,KAAKoQ,OAGpB,OAFUphB,KAAK0B,IAAIsG,EAAM,GAAKoZ,EAAO,IAEzBoL,EADFxsB,KAAK0B,IAAIsG,EAAM,GAAKoZ,EAAO,IACjBlf,GAAM,IAC7B,CAAA8d,IAAA,kBAAAkB,MAED,WACI,IAAME,EAASpQ,KAAKoQ,OACdzG,EAAI3J,KAAKzR,MAAO,EAChBitB,EAAIxb,KAAKxR,OAAQ,EACjBm1B,EAAMvT,EAAO,GAAKzG,EAClBia,EAAMxT,EAAO,GAAKoL,EAClBqI,EAAMzT,EAAO,GAAKzG,EAClBma,EAAM1T,EAAO,GAAKoL,EAClB/B,EAAKzZ,KAAK8O,cAKhB,OAJA2K,EAAG,GAAKkK,EACRlK,EAAG,GAAKmK,EACRnK,EAAG,GAAKoK,EACRpK,EAAG,GAAKqK,EACDrK,IACV,CAAAzK,IAAA,uBAAAkB,MAED,WACI,MAAO,CACH1hB,OAAQwR,KAAKxR,OACbD,MAAOyR,KAAKzR,SAEnB,CAAAygB,IAAA,kCAAAkB,MAED,WAAkC,IAAAuB,EAC1B9a,EAAKqJ,KAAKoQ,OACXpQ,KAAKqO,UAAYrO,KAAKqO,SAASgV,0BAC9B1sB,EAAKqJ,KAAKqO,SAASgV,wBAAwB1sB,IAG/C,IAAmBqtB,EAAAxS,EAAF7a,EAAE,GAAZiB,EAAEosB,EAAA,GAAEnsB,EAAEmsB,EAAA,GACPra,EAAI3J,KAAKzR,MAAM,EACfitB,EAAIxb,KAAKxR,OAAO,EAEtB,OAAAmjB,EAAAF,EAAAE,GACKlJ,GAAUC,MAAS,CAAC9Q,EAAG+R,EAAG9R,IAAG8Z,EAAAF,EAC7BhJ,GAAUG,KAAS,CAAChR,EAAG+R,EAAG9R,IAAG8Z,EAAAF,EAC7BhJ,GAAUE,OAAS,CAAC/Q,EAAIC,EAAG2jB,IAAE7J,EAAAF,EAC7BhJ,GAAUI,IAAS,CAACjR,EAAIC,EAAG2jB,IAAE7J,EAAAF,EAC7BhJ,GAAUK,KAAS,CAAClR,EAAK,KAAF+R,EAAS9R,EAAK,KAAF2jB,IAAQ/J,MAEnDkY,GAnHiB3Y,ICGhB+Y,YAAOzY,GAAA1D,EAAAmc,EAAAzY,GAAA,IAAAzD,EAAAC,EAAAic,GAET,SAAAA,IAA0B,IAAAhc,EAAdC,EAAOvN,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GASF,OATIwN,OAAA8b,IACpBhc,EAAAF,EAAAK,UAAMF,IACD2Y,KAAmB,UAExB5Y,EAAKxf,MAAmByf,EAAQzf,OAAS,GAEzCwf,EAAKvf,OAAmBwf,EAAQxf,QAAU,GAE1Cuf,EAAKic,KAAmBhc,EAAQgc,MAAQ,EACxCjc,EAAK6Y,WAAW7Y,EAkJnB,OAjJAgB,EAAAgb,EAAA,CAAA,CAAA/a,IAAA,YAAAkB,MAED,SAAUlC,GAAS,IAAAmC,EAAAnQ,KACfsK,OAAOC,KAAKyD,GAAS7W,SAAQ,SAAA4F,QACPxH,IAAfyY,EAAQjR,IAAmC,OAAfiR,EAAQjR,KACnCoT,EAAKpT,GAAKiR,EAAQjR,GAClBoT,EAAKe,YAAYnU,GAAKiR,EAAQjR,OAGtCiD,KAAK4mB,aACR,CAAA5X,IAAA,WAAAkB,MAED,WACIlQ,KAAKiqB,QAAUj7B,KAAK4B,IAAI5B,KAAKoC,GAAG,GAAK4O,KAAKgqB,KAC1ChqB,KAAKkqB,QAAUl7B,KAAK2B,IAAI3B,KAAKoC,GAAG,GAAK4O,KAAKgqB,OAC7C,CAAAhb,IAAA,SAAAkB,MAED,SAAO/hB,GACH,IAAAojB,EAAAC,EAAexR,KAAKoQ,OAAM,GAAnBve,EAAC0f,EAAA,GAAEzf,EAACyf,EAAA,GACLwX,EAAK/oB,KAAKzR,MAAM,EAChBy6B,EAAKhpB,KAAKxR,OAAO,EACjB27B,EAAKnB,EAAK,MACVC,EAAap3B,EAAIk3B,EAAKoB,EACtBjB,EAAcr3B,EAAIk3B,EAAKoB,EACvB1rB,EAAQ5M,EAAIk3B,EACZt6B,EAAOoD,EAAIk3B,EACXr6B,EAAMoD,EAAIk3B,EACVzxB,EAASzF,EAAIk3B,EAEnBhpB,KAAKoqB,aAAe,CAChB,CAAClB,EAAax6B,GACd,CAAC+P,EAAO3M,GACR,CAACo3B,EAAa3xB,GACd,CAAC0xB,EAAY1xB,GACb,CAAC9I,EAAMqD,GACP,CAACm3B,EAAYv6B,IAGjBP,EAAIyB,OACDoQ,KAAK2T,YACJxlB,EAAIk4B,YAAc,IAEtBl4B,EAAI4rB,YACJ,IACIiQ,EACAhqB,KADAgqB,KAAMC,EACNjqB,KADMiqB,QAASC,EACflqB,KADekqB,QAEnB/7B,EAAI6sB,OAAOnpB,EAAGnD,GACdP,EAAI8sB,OAAOiO,EAAcc,EAAMt7B,GAC/BP,EAAIs6B,iBAAiBS,EAAax6B,EAAKw6B,EAAcgB,EAASx7B,EAAMu7B,GACpE97B,EAAI8sB,OAAOxc,EAAQyrB,EAASp4B,EAAIm4B,GAChC97B,EAAIs6B,iBAAiBhqB,EAAO3M,EAAG2M,EAAQyrB,EAASp4B,EAAIm4B,GACpD97B,EAAI8sB,OAAOiO,EAAcgB,EAAS3yB,EAAS0yB,GAC3C97B,EAAIs6B,iBAAiBS,EAAa3xB,EAAQ2xB,EAAcc,EAAMzyB,GAE9DpJ,EAAI8sB,OAAOgO,EAAae,EAAMzyB,GAC9BpJ,EAAIs6B,iBAAiBQ,EAAY1xB,EAAQ0xB,EAAaiB,EAAS3yB,EAAS0yB,GACxE97B,EAAI8sB,OAAOxsB,EAAOy7B,EAASp4B,EAAIm4B,GAC/B97B,EAAIs6B,iBAAiBh6B,EAAMqD,EAAGrD,EAAOy7B,EAASp4B,EAAIm4B,GAClD97B,EAAI8sB,OAAOgO,EAAaiB,EAASx7B,EAAMu7B,GACvC97B,EAAIs6B,iBAAiBQ,EAAYv6B,EAAKu6B,EAAae,EAAMt7B,GAEzDP,EAAI+sB,YAEJ/sB,EAAI8rB,UAAYja,KAAKwO,gBACjBxO,KAAKyO,cACLtgB,EAAIsgB,YAAczO,KAAKyO,YACvBtgB,EAAIugB,WAAa1O,KAAK0O,WACtBvgB,EAAIwgB,cAAgB3O,KAAK2O,cACzBxgB,EAAIygB,cAAgB5O,KAAK4O,eAE7BzgB,EAAIotB,OACDvb,KAAKsO,cACJngB,EAAI04B,UAAY7mB,KAAKsO,YACrBngB,EAAI24B,YAAc9mB,KAAKuO,YACvBpgB,EAAI44B,UASR54B,EAAI0B,YAGP,CAAAmf,IAAA,QAAAkB,MAED,SAAMlZ,GACF,IAAIgJ,KAAKoqB,aAAc,OAAO,EAI9B,IAHA,IAAMC,EAAUrqB,KAAKoqB,aACjBE,GAAM,EAED72B,EAAI,EAAGa,EAAI+1B,EAAQz3B,OAAS,EAAGa,EAAI42B,EAAQz3B,OAAQa,IAElD42B,EAAQ52B,GAAG,GAAKuD,EAAM,IAASqzB,EAAQ/1B,GAAG,GAAK0C,EAAM,IAEnDA,EAAM,IAAOqzB,EAAQ/1B,GAAG,GAAK+1B,EAAQ52B,GAAG,KAAOuD,EAAM,GAAKqzB,EAAQ52B,GAAG,KAAO42B,EAAQ/1B,GAAG,GAAK+1B,EAAQ52B,GAAG,IAAM42B,EAAQ52B,GAAG,KAE5H62B,GAAOA,GAEXh2B,EAAIb,EAGR,OAAO62B,IACV,CAAAtb,IAAA,kBAAAkB,MAED,WACI,IAAME,EAASpQ,KAAKoQ,OACdzG,EAAI3J,KAAKzR,MAAO,EAChBitB,EAAIxb,KAAKxR,OAAO,EAChBm1B,EAAMvT,EAAO,GAAKzG,EAClBia,EAAMxT,EAAO,GAAKoL,EAClBqI,EAAMzT,EAAO,GAAKzG,EAClBma,EAAM1T,EAAO,GAAKoL,EAClB/B,EAAKzZ,KAAK8O,cAKhB,OAJA2K,EAAG,GAAKkK,EACRlK,EAAG,GAAKmK,EACRnK,EAAG,GAAKoK,EACRpK,EAAG,GAAKqK,EACDrK,IACV,CAAAzK,IAAA,uBAAAkB,MAED,WACI,MAAO,CACH1hB,OAAQwR,KAAKxR,OACbD,MAAOyR,KAAKzR,SAEnB,CAAAygB,IAAA,kCAAAkB,MAED,WAAkC,IAAAuB,EAC1B9a,EAAKqJ,KAAKoQ,OACXpQ,KAAKqO,UAAYrO,KAAKqO,SAASgV,0BAC9B1sB,EAAKqJ,KAAKqO,SAASgV,wBAAwB1sB,IAG/C,IAAmBqtB,EAAAxS,EAAF7a,EAAE,GAAZiB,EAAEosB,EAAA,GAAEnsB,EAAEmsB,EAAA,GACPra,EAAI3J,KAAKzR,MAAM,EACfitB,EAAIxb,KAAKxR,OAAO,EACtB,OAAAmjB,EAAAF,EAAA,GACKhJ,GAAUC,MAAS,CAAC9Q,EAAG+R,EAAG9R,IAAG8Z,EAAAF,EAC7BhJ,GAAUG,KAAS,CAAChR,EAAG+R,EAAG9R,IAAG8Z,EAAAF,EAC7BhJ,GAAUE,OAAS,CAAC/Q,EAAIC,EAAG2jB,IAAE7J,EAAAF,EAC7BhJ,GAAUI,IAAS,CAACjR,EAAIC,EAAG2jB,IAAE/J,MAErCsY,GA7JiB/Y,ICRhBuZ,YAAeC,GAAA5c,EAAA2c,EAAAC,GAAA,IAAA3c,EAAAC,EAAAyc,GACjB,SAAAA,EAAYvc,GAAS,OAAAC,OAAAsc,GAAA1c,EAAAK,KAAAlO,KACXgO,GAmDT,OAlDAe,EAAAwb,EAAA,CAAA,CAAAvb,IAAA,SAAAkB,MAED,SAAO/hB,GACHA,EAAIyB,OACDoQ,KAAK2T,YACJxlB,EAAIk4B,YAAc,IAEtBl4B,EAAI4rB,YACJ,IAAAxI,EAAAC,EAAexR,KAAKoQ,OAAM,GAAnBve,EAAC0f,EAAA,GAAEzf,EAACyf,EAAA,GACLwX,EAAK/oB,KAAKzR,MAAM,EAChBy6B,EAAKhpB,KAAKxR,OAAO,EACjBk7B,EAAKX,EAAK,MAEVr6B,EAAMoD,EAAIk3B,EACVzxB,EAASzF,EAAIk3B,EACbyB,EAAY34B,EAAIk3B,EAAKU,EACrBgB,EAAe54B,EAAIk3B,EAAKU,EACxBiB,EAAQ94B,EAAIk3B,EACZ6B,EAAS/4B,EAAIk3B,EAEnB56B,EAAI6sB,OAAOnpB,EAAGnD,GACdP,EAAI8sB,OAAO2P,EAAQH,GACnBt8B,EAAI8sB,OAAO2P,EAAQF,GACnBv8B,EAAI8sB,OAAOppB,EAAG0F,GACdpJ,EAAI8sB,OAAO0P,EAAOD,GAClBv8B,EAAI8sB,OAAO0P,EAAOF,GAClBt8B,EAAI+sB,YACJ/sB,EAAI8rB,UAAYja,KAAKwO,gBACjBxO,KAAKyO,cACLtgB,EAAIsgB,YAAczO,KAAKyO,YACvBtgB,EAAIugB,WAAa1O,KAAK0O,WACtBvgB,EAAIwgB,cAAgB3O,KAAK2O,cACzBxgB,EAAIygB,cAAgB5O,KAAK4O,eAE7BzgB,EAAIotB,OACDvb,KAAKsO,cACJngB,EAAI04B,UAAY7mB,KAAKsO,YACrBngB,EAAI24B,YAAc9mB,KAAKuO,YACvBpgB,EAAI44B,UAGR54B,EAAI0B,UACJmQ,KAAKoqB,aAAe,CAChB,CAACv4B,EAAGnD,GACJ,CAACk8B,EAAQH,GACT,CAACG,EAAQF,GACT,CAAC74B,EAAG0F,GACJ,CAACozB,EAAOD,GACR,CAACC,EAAOF,QAEfF,GArDyBR,ICF9B,IAAMxc,GAAWC,OAAO,SAElBqd,YAAcC,GAAAld,EAAAid,EAAAC,GAAA,IAAAjd,EAAAC,EAAA+c,GAChB,SAAAA,EAAYhgB,GAAmB,IAAAkD,EAAdC,EAAOvN,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GAEF,OAFIwN,OAAA4c,IACzB9c,EAAAF,EAAAK,KAAMrD,KAAAA,EAAKmD,IACNI,SAAU,EAAML,EAcxB,OAbAgB,EAAA8b,EAAA,CAAA,CAAA7b,IAAA,SAAAkB,MACD,SAAO/hB,GACA6R,KAAKoO,SACJ2c,EAAAC,EAAAH,EAAAtF,WAAA,SAAAvlB,MAAAkO,KAAAlO,KAAa7R,KAEpB,CAAA6gB,IAAA,SAAAkB,MAED,SAAOT,GACAzP,KAAKuN,MAAckC,IAClBzP,KAAK2a,QAAUlL,EACfzP,KAAKirB,SAETjrB,KAAKuN,IAAYkC,MACpBob,GAjBwBxQ,IAoBvB6Q,YAAW5Z,GAAA1D,EAAAsd,EAAA5Z,GAAA,IAAA6Z,EAAArd,EAAAod,GACb,SAAAA,EAAYld,GAAS,IAAA8W,EAAA3U,EAsBM,OAtBNlC,OAAAid,IACjB/a,EAAAgb,EAAAjd,UAAMF,IACD2Y,KAAO,cACZxW,EAAKoE,UAAUvG,GACfmC,EAAKsF,WAAWzH,GAChBmC,EAAKuL,cAAc1N,GACnBmC,EAAKqS,OAAS,IAAI6E,GAAUrZ,GAC5BmC,EAAKqS,OAAOpS,OAAS,CAAC,EAAG,GACzBD,EAAKqS,OAAOnU,SAAQF,EAAAgC,GAEpBA,EAAKib,SAAWpd,EAAQod,UAAYhiB,EAAAA,EACpC+G,EAAK6U,aAAehX,EAAQgX,aAC5B7U,EAAKkb,UAAYrd,EAAQqd,WAAajiB,EAAAA,EACtC+G,EAAK+U,cAAgBlX,EAAQkX,cAE7B/U,EAAKgV,KAAmBL,QAAfA,EAAG9W,EAAQmX,YAAIL,IAAAA,GAAAA,EACxB3U,EAAKmb,QAAU,CAAC,EAAG,GAEnBnb,EAAK6F,wBACL7F,EAAK8F,SACL9F,EAAK6F,wBACL7F,EAAKob,eACLpb,EAAKmV,cAAgB,GAAEnV,EA4Y1B,OA1YApB,EAAAmc,EAAA,CAAA,CAAAlc,IAAA,gBAAAkB,MAED,SAAclC,GAAS,IAAAwd,EAAAxrB,KAEf2b,EAKA3N,EALA2N,SACAC,EAIA5N,EAJA4N,cACArB,EAGAvM,EAHAuM,WACAC,EAEAxM,EAFAwM,WACAF,EACAtM,EADAsM,SAEJta,KAAK8b,YAAc,IAAI+O,GAAe,IAAK,CACvCpQ,WAAYkB,EACZjB,WAAYkB,EACZtB,SAAAA,IAEJta,KAAK+b,YAAc,IAAI8O,GAAe,IAAK,CACvCpQ,WAAYkB,EACZjB,WAAYkB,EACZtB,SAAAA,IAEJta,KAAK8b,YAAYvB,WAAaA,GAAc,EAC5Cva,KAAK+b,YAAYvB,WAAaA,GAAc,EAC5C,IAAMiR,EAAK,WACPD,EAAKvc,OAAOoI,kBAEhBrX,KAAK8b,YAAYmP,MAAQQ,EACzBzrB,KAAK+b,YAAYkP,MAAQQ,EAEzBzrB,KAAKgc,iBAAmB,CACpBC,UAAU,EACVhsB,OAAQ,KAERmsB,SAAU,EACVC,SAAU,EACVM,UAAW,EACXC,UAAW,EAEX8O,YAAY,EACZC,YAAY,GAiBhB3rB,KAAKvP,iBAAiB,sBAAsB,SAAAkP,GACxC,GAAG6rB,EAAKxP,iBAAiB0P,WAAY,CACjC/rB,EAAEiQ,OAAO2P,iBACT5f,EAAEiQ,OAAOa,SAAU,EACnB,IAAM8L,EAAU5c,EAAEiQ,OAAO8I,MAAM6D,QAC/BjS,OAAOK,OAAO6gB,EAAKxP,iBAAkB,CACjCC,UAAU,EACVhsB,OAAQu7B,EAAK1P,YACba,UAAW6O,EAAK1P,YAAY1L,OAAO,GACnCgM,SAAUG,IAEdiP,EAAK/O,wBAET,GAAG+O,EAAKxP,iBAAiB2P,WAAY,CACjChsB,EAAEiQ,OAAO2P,iBACT5f,EAAEiQ,OAAOa,SAAU,EACnB,IAAM+L,EAAU7c,EAAEiQ,OAAO8I,MAAM8D,QAC/BlS,OAAOK,OAAO6gB,EAAKxP,iBAAkB,CACjCC,UAAU,EACVhsB,OAAQu7B,EAAKzP,YACba,UAAW4O,EAAKzP,YAAY3L,OAAO,GACnCiM,SAAUG,IAEdgP,EAAK/O,8BAGhB,CAAAzN,IAAA,wBAAAkB,MAED,WAAwB,IAAA0b,EAAA5rB,KAEdhS,EADgBgS,KAAKiP,OACEjhB,OACvB6uB,EAAK,SAAAld,GACP,IAAQ4c,EAAqB5c,EAArB4c,QAASC,EAAY7c,EAAZ6c,QACjBoP,EAAK9O,oBAAoBP,EAASC,IACnCtZ,KAAKlD,MACR/R,SAASwC,iBAAiB,cAAeosB,GACzC,IAAMzqB,EAAK,SAAAuN,GACP2K,OAAOK,OAAOihB,EAAK5P,iBAAkB,CACjCC,UAAU,EACVhsB,OAAQ,KACRmsB,SAAU,EACVC,SAAU,EACVM,UAAW,EACXC,UAAW,EACX8O,YAAY,EACZC,YAAY,IAEhB19B,SAASsC,oBAAoB,cAAessB,GAC5C5uB,SAASsC,oBAAoB,YAAa6B,GAC1CpE,EAAOuC,oBAAoB,YAAa6B,IACzC8Q,KAAKlD,MACRhS,EAAOyC,iBAAiB,YAAa2B,EAAG,CACpC5B,MAAM,IAEVvC,SAASwC,iBAAiB,YAAa2B,EAAG,CACtC5B,MAAM,MAEb,CAAAwe,IAAA,sBAAAkB,MAED,SAAoBqM,EAASC,GACzB,GAAGxc,KAAK8b,YAAY1N,SAAWpO,KAAKgc,iBAAiBC,SAAU,CAC3D,IAAM4P,EAAQ7rB,KAAKiP,OACbpgB,EAAQg9B,EAAMh9B,MACpBkuB,EAMI/c,KAAKgc,iBALL/rB,EAAM8sB,EAAN9sB,OACAmsB,EAAQW,EAARX,SACAO,EAASI,EAATJ,UACAN,EAAQU,EAARV,SACAO,EAASG,EAATH,UAEJ,GAAkB,MAAf3sB,EAAO4a,IAAa,CACnB,IAAMihB,EAAe9rB,KAAK8b,YAAYvtB,MAChCw9B,EAAc/rB,KAAK+rB,YAEnBrO,EAAOf,GADEJ,EAAUH,GACSvtB,EAE5Bm9B,GADI/7B,EAAOmgB,OAAO,GAAKphB,KAAKgK,IAAIhK,KAAK+J,IAAI2kB,EAAMqO,EAAcD,GAAe,KAC5DC,EAAcD,GAC9Br2B,GAAKuK,KAAKisB,YAAcF,GAAa,EAC3C/rB,KAAKsrB,QAAQ,GAAK71B,GAAKuK,KAAKisB,YAAcF,GAAeC,EACzDH,EAAMxU,iBAGV,GAAkB,MAAfpnB,EAAO4a,IAAa,CACnB,IAAMqhB,EAAgBlsB,KAAK+b,YAAYvtB,OACjC29B,EAAensB,KAAKmsB,aAEpBxO,EAAOf,GADEJ,EAAUH,GACSxtB,EAE5Bm4B,GADI/2B,EAAOmgB,OAAO,GAAKphB,KAAKgK,IAAIhK,KAAK+J,IAAI4kB,EAAMwO,EAAeD,GAAgB,KACjEC,EAAeD,GAC5Bz2B,GAAKuK,KAAKosB,aAAeD,GAAc,EAC7CnsB,KAAKsrB,QAAQ,GAAK71B,GAAKuK,KAAKosB,aAAeD,GAAgBnF,EAC3D6E,EAAMxU,qBAGjB,CAAArI,IAAA,YAAAkB,MAGD,SAAUlC,GACNhO,KAAKwiB,OAAOmD,UAAU3X,KACzB,CAAAgB,IAAA,wBAAAkB,MAED,WACI,IAEMpX,EAAOoQ,GAFElJ,KAAK6T,OAAO+R,yBAGrBjc,EAAI7Q,EAAKvK,MACTitB,EAAI1iB,EAAKtK,OACT69B,EAAarsB,KAAKglB,cAAgBh2B,KAAK+J,IAAI4Q,EAAG3J,KAAKorB,UACnDkB,EAActsB,KAAKklB,eAAiBl2B,KAAK+J,IAAIyiB,EAAGxb,KAAKqrB,WAC3DrrB,KAAKisB,YAActiB,EACnB3J,KAAK+rB,YAAcM,EACnBrsB,KAAKosB,aAAe5Q,EACpBxb,KAAKmsB,aAAeG,EAEpBtsB,KAAKwiB,OAAOj0B,MAAQ89B,EACpBrsB,KAAKwiB,OAAOh0B,OAAS89B,EACrBtsB,KAAKzR,MAAQ89B,EACbrsB,KAAKxR,OAAS89B,IACjB,CAAAtd,IAAA,sBAAAkB,MAED,SAAoBlZ,GAChB,IAAA6rB,EAAArR,EAAiBxa,EAAK,GAAf8rB,EAAED,EAAA,GAAEE,EAAEF,EAAA,GACb0J,EAAA/a,EAAiBxR,KAAKsrB,QAAO,GAAtBnwB,EAAEoxB,EAAA,GAAEnxB,EAAEmxB,EAAA,GACbhb,EAAAC,EAAiBxR,KAAKoQ,OAAM,GAE5B,MADU,CAAC0S,EADFvR,EAAA,GACYpW,EAAI4nB,EADZxR,EAAA,GACsBnW,KAEtC,CAAA4T,IAAA,+BAAAkB,MAED,SAA6Bld,EAAGC,EAAGiwB,EAAKC,EAAMC,GAC1C,IAAMhT,EAASpQ,KAAKoQ,OACdhQ,EAASJ,KAAKsrB,QACpBpI,EAAIC,GAAQnwB,EAAIod,EAAO,GAAKhQ,EAAO,GACnC8iB,EAAIE,GAAQnwB,EAAImd,EAAO,GAAKhQ,EAAO,KACtC,CAAA4O,IAAA,0BAAAkB,MAED,SAAwBlZ,GACpB,IAAAssB,EAAA9R,EAAiBxa,EAAK,GAAf8rB,EAAEQ,EAAA,GAAEP,EAAEO,EAAA,GACb5R,EAAAF,EAAiBxR,KAAKoQ,OAAM,GAArBiL,EAAE3J,EAAA,GAAEmJ,EAAEnJ,EAAA,GACb8a,EAAAhb,EAAiBxR,KAAKsrB,QAAO,GACvBx4B,EAAI,CAACgwB,EAAKzH,EADPmR,EAAA,GACgBzJ,EAAKlI,EADjB2R,EAAA,IAEb,OAAGxsB,KAAKqO,UAAYrO,KAAKqO,SAASgV,wBACvBrjB,KAAKqO,SAASgV,wBAAwBvwB,GAEtCA,IAEd,CAAAkc,IAAA,uBAAAkB,MAED,SAAqBlZ,GACjB,IAAAwsB,EAAAhS,EAAiBxa,EAAK,GAAf8rB,EAAEU,EAAA,GAAET,EAAES,EAAA,GACb0D,EAAA1V,EAAiBxR,KAAKoQ,OAAM,GAArBiL,EAAE6L,EAAA,GAAErM,EAAEqM,EAAA,GACbuF,EAAAjb,EAAiBxR,KAAKsrB,QAAO,GACvBx4B,EAAI,CAACgwB,EAAKzH,EADPoR,EAAA,GACgB1J,EAAKlI,EADjB4R,EAAA,IAEb,GAAGzsB,KAAKqO,UAAYrO,KAAKqO,SAASsC,qBAC9B,OAAO3Q,KAAKqO,SAASsC,qBAAqB7d,KAEjD,CAAAkc,IAAA,cAAAkB,MAED,WACI,IAAMkW,EAAepmB,KAAKslB,cAG1B,OAFAtlB,KAAKijB,6BAA6B,EAAG,EAAGmD,EAAc,EAAG,GACzDpmB,KAAKijB,6BAA6BjjB,KAAKzR,MAAOyR,KAAKxR,OAAQ43B,EAAc,EAAG,GACrEA,IACV,CAAApX,IAAA,kBAAAkB,MAED,WACI,OAAOlQ,KAAKslB,gBACf,CAAAtW,IAAA,eAAAkB,MAED,WACIlQ,KAAKsrB,QAAU,CACXt8B,KAAKgK,KAAKgH,KAAKisB,YAAcjsB,KAAK+rB,aAAa,EAAG,GAClD/8B,KAAKgK,KAAKgH,KAAKosB,aAAepsB,KAAKmsB,cAAc,EAAG,IAErDnsB,KAAKisB,YAAcjsB,KAAK+rB,aACvB/rB,KAAK8b,YAAY1N,SAAU,EAC3BpO,KAAK8b,YAAYvtB,MAAQyR,KAAK+rB,YAAc/rB,KAAK+rB,YAAc/rB,KAAKisB,YACpEjsB,KAAK8b,YAAY1L,OAAS,CAAC,EAAGpQ,KAAKmsB,aAAe,IAElDnsB,KAAK8b,YAAY1N,SAAU,EAE5BpO,KAAKosB,aAAepsB,KAAKmsB,cACxBnsB,KAAK+b,YAAY3N,SAAU,EAC3BpO,KAAK+b,YAAYvtB,OAASwR,KAAKmsB,aAAensB,KAAKmsB,aAAensB,KAAKosB,aACvEpsB,KAAK+b,YAAY3L,OAAS,CAACpQ,KAAK+rB,YAAc,EAAG,IAEjD/rB,KAAK+b,YAAY3N,SAAU,IAElC,CAAAY,IAAA,SAAAkB,MAED,SAAO/hB,GACA6R,KAAK2T,UACJxlB,EAAIk4B,YAAc,GACK,IAAjBrmB,KAAK6O,UACX1gB,EAAIk4B,YAAcrmB,KAAK6O,SAE3B,IAAA6d,EAAAlb,EAAiBxR,KAAKoQ,OAAM,GAArBiL,EAAEqR,EAAA,GAAE7R,EAAE6R,EAAA,GACP/iB,EAAI3J,KAAKzR,MACTitB,EAAIxb,KAAKxR,OACTm+B,EAAKhjB,EAAE,EACPijB,EAAKpR,EAAE,EAKbqR,EAAArb,EAAiBxR,KAAKsrB,QAAO,GAAtBnwB,EAAE0xB,EAAA,GAAEzxB,EAAEyxB,EAAA,GACb1+B,EAAIo4B,UAAUlL,EAAIR,GAClB7a,KAAKwiB,OAAO9yB,OAAOvB,GACnBA,EAAIo4B,WAAWoG,GAAKC,GACjB5sB,KAAK8b,YAAY1N,SAChBpO,KAAK8b,YAAYpsB,OAAOvB,GAEzB6R,KAAK+b,YAAY3N,SAChBpO,KAAK+b,YAAYrsB,OAAOvB,GAG5BA,EAAIo4B,UAAUoG,EAAIC,GAClBz+B,EAAIyB,OACJzB,EAAI4rB,YACJ5rB,EAAIkiB,MAAMsc,GAAKC,EAAIjjB,EAAG6R,GACtBrtB,EAAI6rB,OACJ7rB,EAAIo4B,UAAUprB,EAAIC,GAClB4E,KAAK6T,OAAOnkB,OAAOvB,GACnB6R,KAAKsU,WAAW5kB,OAAOvB,GACvBA,EAAIo4B,WAAWlL,EAAGlgB,GAAK0f,EAAGzf,GAC1BjN,EAAI0B,YACP,CAAAmf,IAAA,QAAAkB,MAED,SAAMlZ,EAAOyc,GACT,IAAAyQ,EAAA1S,EAAiBxa,EAAK,GAAf8rB,EAAEoB,EAAA,GAAEnB,EAAEmB,EAAA,GACb4I,EAAAtb,EAAiBxR,KAAKoQ,OAAM,GAArBiL,EAAEyR,EAAA,GAAEjS,EAAEiS,EAAA,GAGPC,EAAK,CAACjK,EAAKzH,EAFPrb,KAAKzR,MAAM,EAEIw0B,EAAKlI,EADpB7a,KAAKxR,OAAO,GAItB,IAFAwR,KAAKgc,iBAAiB0P,YAAa,EACnC1rB,KAAKgc,iBAAiB2P,YAAa,EAChC3rB,KAAK8b,YAAY1N,UACHpO,KAAK8b,YAAY5H,MAAM6Y,GAIhC,OAFA/sB,KAAKgc,iBAAiB0P,YAAa,EACnC1rB,KAAK8b,YAAYkR,QAAO,IACjB,EAKf,IAFAhtB,KAAK8b,YAAYkR,QAAO,GAErBhtB,KAAK+b,YAAY3N,UACHpO,KAAK+b,YAAY7H,MAAM6Y,GAIhC,OAFA/sB,KAAKgc,iBAAiB2P,YAAa,EACnC3rB,KAAK+b,YAAYiR,QAAO,IACjB,EAOf,GAJAhtB,KAAK+b,YAAYiR,QAAO,GAGNhtB,KAAKwiB,OAAOtO,MAAM,CAAC4O,EAAKzH,EAAI0H,EAAKlI,IACrC,CACV,IAAAoS,EAAAzb,EAAiBxR,KAAKsrB,QAAO,GACvBx4B,EAAI,CAACgwB,EAAKzH,EADP4R,EAAA,GACgBlK,EAAKlI,EADjBoS,EAAA,IAEbjtB,KAAKwmB,UAAY1zB,EACjB,IAAM7C,EAAS+P,KAAK6T,OAAO4S,SAAS3zB,EAAG2gB,GACvC,GAAGxjB,EAAQ,OAAOA,OAElB+P,KAAK6T,OAAOC,iBAEhB,OAAO,IACV,CAAA9E,IAAA,uBAAAkB,MAED,WACI,MAAO,CACH3hB,MAAOyR,KAAKzR,MACZC,OAAQwR,KAAKxR,UAEpB,CAAAwgB,IAAA,kBAAAkB,MAED,WACI,IAAME,EAASpQ,KAAKoQ,OACdzG,EAAI3J,KAAKzR,MAAO,EAChBitB,EAAIxb,KAAKxR,OAAO,EAChBm1B,EAAMvT,EAAO,GAAKzG,EAClBia,EAAMxT,EAAO,GAAKoL,EAClBqI,EAAMzT,EAAO,GAAKzG,EAClBma,EAAM1T,EAAO,GAAKoL,EAClB/B,EAAKzZ,KAAK8O,cAKhB,OAJA2K,EAAG,GAAKkK,EACRlK,EAAG,GAAKmK,EACRnK,EAAG,GAAKoK,EACRpK,EAAG,GAAKqK,EACDrK,IACV,CAAAzK,IAAA,kCAAAkB,MAED,WAAkC,IAAAuB,EAC1B9a,EAAKqJ,KAAKoQ,OACXpQ,KAAKqO,UAAYrO,KAAKqO,SAASgV,0BAC9B1sB,EAAKqJ,KAAKqO,SAASgV,wBAAwB1sB,IAG/C,IAAmBqtB,EAAAxS,EAAF7a,EAAE,GAAZiB,EAAEosB,EAAA,GAAEnsB,EAAEmsB,EAAA,GACPra,EAAI3J,KAAKzR,MAAM,EACfitB,EAAIxb,KAAKxR,OAAO,EACtB,OAAAmjB,EAAAF,EAAAE,GACKlJ,GAAUC,MAAS,CAAC9Q,EAAG+R,EAAG9R,IAAG8Z,EAAAF,EAC7BhJ,GAAUG,KAAS,CAAChR,EAAG+R,EAAG9R,IAAG8Z,EAAAF,EAC7BhJ,GAAUE,OAAS,CAAC/Q,EAAIC,EAAG2jB,IAAE7J,EAAAF,EAC7BhJ,GAAUI,IAAS,CAACjR,EAAIC,EAAG2jB,IAAE7J,EAAAF,EAC7BhJ,GAAUK,KAAS,CAAClR,EAAK,KAAF+R,EAAS9R,EAAK,KAAF2jB,IAAQ/J,IAEnD,CAAAzC,IAAA,iBAAAkB,MAED,WACIlQ,KAAKsV,mBAAkB,SAACnG,GACpBA,EAASa,sBAEhB,CAAAhB,IAAA,iBAAAkB,MACD,WACIlQ,KAAKsV,mBAAkB,SAACnG,GACpBA,EAASc,sBAEhB,CAAAjB,IAAA,UAAAkB,MACD,WACIlQ,KAAKwiB,OAAOiC,UACZzkB,KAAKsV,mBAAkB,SAACnG,GACpBA,EAASsV,eAEhB,CAAAzV,IAAA,QAAAkB,MAED,WACI,IAIM9d,EAAI,IAAIuP,EAJJ3B,KAAKF,aACCwK,OAAOK,OAAO,GAAI3K,KAAKkR,YAAa,CAChDwE,OAAQ1V,KAAKwV,SAAWxV,KAAKwV,QAAQkO,WAQzC,OALA1jB,KAAKsV,mBAAkB,SAACnG,GACpB/c,EAAEqiB,WAAWtF,EAASuU,YAE1BtxB,EAAEikB,cACFjkB,EAAEgc,QAAUpO,KAAKoO,QACVhc,MACV84B,GAnaqBla,IAsa1B1G,OAAOK,OAAOugB,GAAY3F,UAAWpR,IACrC7J,OAAOK,OAAOugB,GAAY3F,UAAWhQ,IACrCjL,OAAOK,OAAOugB,GAAY3F,UAAW,CACjC1U,cAAa,WACT,IAAI8E,GAAQ,EAEZ,GAAG3V,KAAK4V,qBAAsB,CAE1B,IAAME,EAAO9V,KAAKisB,YACZlW,EAAO/V,KAAKosB,aACfpsB,KAAKgV,uBACJhV,KAAKgV,wBAENhV,KAAKgW,uBACJhW,KAAKgW,wBAEThW,KAAKiW,SACFjW,KAAKgW,uBACJhW,KAAKgW,wBAET,IAAMG,EAAOnW,KAAKisB,YACZ7V,EAAOpW,KAAKosB,aAElBzW,EAASG,IAASK,GAAQJ,IAASK,OAEnCpW,KAAKiW,SAENjW,KAAKqO,UAAYsH,IAChB3V,KAAKurB,eACLvrB,KAAKqO,SAASwC,kBAItBwF,YAAW,WACP,IAAAR,EAAsC7V,KAAK4V,uBAA5BE,EAAID,EAAXtnB,MAAqBwnB,EAAIF,EAAZrnB,OACrBwR,KAAKiW,SACFjW,KAAKgW,uBACJhW,KAAKgW,wBAET,IAAAE,EAAsClW,KAAK4V,uBAA5BO,EAAID,EAAX3nB,MAAqB6nB,EAAIF,EAAZ1nB,OACjBsnB,IAASK,GAAQJ,IAASK,GAC1BpW,KAAKurB,kBC5eF,ICiBT2B,YAAQjc,GAAArD,EAAAsf,EAAAjc,GAAA,IAAApD,EAAAC,EAAAof,GACV,SAAAA,IAA0B,IAAAnf,EAAdC,EAAOvN,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GAemB,OAfjBwN,OAAAif,IACpBnf,EAAAF,EAAAK,KAAAlO,OAEKQ,KAAWwN,EAAQxN,KAExBuN,EAAKoH,GAAWnH,EAAQmH,GAExBpH,EAAK9D,QAAW+D,EAAQ/D,QAExB8D,EAAK5D,MAAW6D,EAAQ7D,MAExB4D,EAAKqc,aAAe,KAEpBrc,EAAKS,gBAAkBR,EAAQQ,iBAAmB,OAElDT,EAAKxB,SAAkByB,EAAQzB,OAAMwB,EAiBxC,OAdDgB,EAAAme,EAAA,CAAA,CAAAle,IAAA,cAAAkB,MAIA,SAAYid,GACR,OAAO,IACV,CAAAne,IAAA,aAAAkB,MAED,WAAa,IAAAC,EAAAnQ,KACHotB,EAAYptB,KAAKiP,OAAOqF,WACxBK,EAAQyY,EAAU/Z,WAAU,SAAA9gB,GAAC,OAAIA,IAAM4d,KAC7Cid,EAAU15B,OAAOihB,EAAO,GACxByY,EAAU74B,KAAKyL,MACfA,KAAKiP,OAAOiI,cACfgW,GAjCkBxf,ICfjB2f,YAAW/b,GAAA1D,EAAAyf,EAAA/b,GAAA,IAAAzD,EAAAC,EAAAuf,GACb,SAAAA,EAAYrf,GAAS,IAAAD,EAQgC,OARhCE,OAAAof,IACjBtf,EAAAF,EAAAK,UAAMF,IAEDzf,MAAQyf,EAAQzf,MACrBwf,EAAKvf,OAASwf,EAAQxf,OACtBuf,EAAKuf,YAAcr/B,SAASC,cAAc,UAC1C6f,EAAKuf,YAAY/+B,MAAQwf,EAAKxf,MAAQ,EACtCwf,EAAKuf,YAAY9+B,OAASuf,EAAKvf,OAAS,EACxCwf,EAAQuf,MAAMxf,EAAKuf,YAAYl/B,WAAW,OAAO2f,EAmCpD,OAlCAgB,EAAAse,EAAA,CAAA,CAAAre,IAAA,SAAAkB,MAED,SAAO/hB,GACH,IAAAojB,EAAAC,EAAiBxR,KAAKoQ,OAAM,GAArBiL,EAAE9J,EAAA,GAAEsJ,EAAEtJ,EAAA,GACbpjB,EAAIyB,OACJzB,EAAIo4B,UAAUlL,EAAIR,GAClB1sB,EAAI4rB,YACJ5rB,EAAIq/B,UAAUxtB,KAAKstB,aAActtB,KAAKzR,MAAM,GAAIyR,KAAKxR,OAAO,GAC5DL,EAAIo4B,WAAWlL,GAAKR,GACpB1sB,EAAI0B,YACP,CAAAmf,IAAA,uBAAAkB,MAED,WACI,MAAO,CACH1hB,OAAQwR,KAAKxR,OACbD,MAAOyR,KAAKzR,SAEnB,CAAAygB,IAAA,cAAAkB,MAED,cAAe,CAAAlB,IAAA,kBAAAkB,MACf,WACI,IAAME,EAASpQ,KAAKoQ,OACdzG,EAAI3J,KAAKzR,MAAO,EAChBitB,EAAIxb,KAAKxR,OAAO,EAChBm1B,EAAMvT,EAAO,GAAKzG,EAClBia,EAAMxT,EAAO,GAAKoL,EAClBqI,EAAMzT,EAAO,GAAKzG,EAClBma,EAAM1T,EAAO,GAAKoL,EAClB/B,EAAKzZ,KAAK8O,cAKhB,OAJA2K,EAAG,GAAKkK,EACRlK,EAAG,GAAKmK,EACRnK,EAAG,GAAKoK,EACRpK,EAAG,GAAKqK,EACDrK,MACV4T,GA5CqBrc,ICGpByc,GACM,SADNA,GAEI,OAFJA,GAGK,QAGLC,YAAIC,GAAA/f,EAAA8f,EAAAC,GAAA,IAAA9f,EAAAC,EAAA4f,GACN,SAAAA,EAAY1f,GAAS,IAAAD,EAwDE,OAxDFE,OAAAyf,IACjB3f,EAAAF,EAAAK,UAAMF,IACD2Y,KAAe,OACpB5Y,EAAK6f,QAAe5f,EAAQ4f,SAAW,GACvC7f,EAAK8f,WAAmB7f,EAAQ6f,YAAc,6NAC9C9f,EAAK+f,SAAmB9f,EAAQ8f,UAAY,OAC5C/f,EAAKggB,WAAmB/f,EAAQ+f,YAAc,GAC9ChgB,EAAKigB,UAAmBhgB,EAAQggB,WAAa,QAC7CjgB,EAAKkgB,iBAAmBjgB,EAAQigB,kBAAqBjgB,EAAQggB,WAAa,QAC1EjgB,EAAKmgB,UAAmBlgB,EAAQkgB,WAAaT,GAC7C1f,EAAKogB,aAAmBngB,EAAQmgB,cAAgB,SAChDpgB,EAAKqgB,WAAmBpgB,EAAQogB,WAChCrgB,EAAKsgB,OAAmBrgB,EAAQqgB,QAAU,EAC1CtgB,EAAKS,gBAAmBR,EAAQQ,gBAChCT,EAAKugB,SAAmBtgB,EAAQsgB,SAChCvgB,EAAKiX,aAAmBhX,EAAQgX,aAChCjX,EAAKkX,SAAmBjX,EAAQiX,UAAY,EAC5ClX,EAAKqd,SAAmBpd,EAAQod,SAChCrd,EAAKwgB,SAAmBvgB,EAAQugB,SAEhCxgB,EAAKygB,YAAmBxgB,EAAQwgB,aAAe,GAC/CzgB,EAAK0gB,eAAmBzgB,EAAQygB,iBAAkB,EAElD1gB,EAAK2gB,UAAmB,EACxB3gB,EAAK4gB,SAAmB3gB,EAAQ2gB,SAEhC5gB,EAAK6gB,YAAmB5gB,EAAQ4gB,aAAe,UAC/C7gB,EAAK8gB,eAAmB7gB,EAAQ6gB,gBAAkB,YAElD9gB,EAAK+gB,QAAU,CACXC,SAAS,EACTC,YAAY,EACZC,YAAa,KACbC,YAAa,EACbC,gBAAgB,EAEhBC,gBAAgB,EAChBC,SAAS,EAETC,OAAQ,GACRC,aAAc,MAGlBxhB,EAAKyhB,cAAgB,EAErBzhB,EAAK0hB,WAAa,CACdnH,QAAQ,EACRoH,UAAW,KACXC,QAAS,KACTC,aAAc,MAEf7hB,EAAKugB,UACJvgB,EAAK8hB,kBAGT9hB,EAAK+hB,mBACL/hB,EAAKgiB,cAAchiB,EAqtBtB,OAntBAgB,EAAA2e,EAAA,CAAA,CAAA1e,IAAA,iBAAAhU,IAED,WACI,OAAOgF,KAAK4tB,SAAW5tB,KAAKwuB,cAC/B,CAAAxf,IAAA,UAAAhU,IAED,WACI,OAAQgF,KAAK4tB,UAChB,CAAA5e,IAAA,mBAAAkB,MAED,WAAmB,IAAAC,EAAAnQ,KACfvQ,GAAmB,SAACtB,GAChBA,EAAI4rB,YACJ5rB,EAAI6hC,KAAI7/B,GAAAA,OAAMggB,EAAK2d,SAAQ,KAAA39B,OAAIggB,EAAK0d,YACpC1/B,EAAI+/B,UAAY/d,EAAK+d,UACrB//B,EAAIggC,aAAehe,EAAKge,aACxB,IAAM8B,EAAMC,SAAS/f,EAAK2d,UACpBF,EAAUzd,EAAKggB,eACrBC,EAMIjiC,EAAIkiC,YAAYzC,GAHhB0C,EAAqBF,EAArBE,sBACAC,EAAsBH,EAAtBG,uBACAhiC,EAAK6hC,EAAL7hC,MAIJ,GADA4hB,EAAKqgB,WAAargB,EAAKke,OAAS9/B,EAC7B4hB,EAAK6U,aAAc,CAClB,GAAG7U,EAAKoe,UAAape,EAAKqgB,WAAargB,EAAK6U,aAAe,CACvD,IAAM5kB,EAAS+P,EAAKsgB,iBAAiBtgB,EAAK6U,aAAe,IACzD7U,EAAKugB,gBAAkB9C,EAAQp3B,UAAU,EAAG4J,GAAU,WAEtD+P,EAAKugB,gBAAkB9C,EAE3Bzd,EAAK5hB,MAAQ4hB,EAAK6U,kBACf,GAAG7U,EAAKib,UAAYjb,EAAKoe,SAAU,CACtC,GAAGpe,EAAKqgB,WAAargB,EAAKib,SAAU,CAChC,IAAMpE,EAAO7W,EAAKib,SAAWjb,EAAKqgB,WAC5Bj+B,EAAIvD,KAAKC,MAAM2+B,EAAQh7B,OAASo0B,EAAQ,GAC9C7W,EAAKugB,gBAAkB9C,EAAQp3B,UAAU,EAAGjE,GAAK,WAEjD4d,EAAKugB,gBAAkB9C,EAE3Bzd,EAAK5hB,MAAQS,KAAK+J,IAAIoX,EAAKib,SAAUjb,EAAKqgB,iBAE1CrgB,EAAK5hB,MAAQS,KAAKgK,IAAImX,EAAK8U,SAAU9U,EAAKqgB,YAG9C,IAAMhiC,EAAUQ,KAAK0B,IAAI4/B,GAAyBthC,KAAK0B,IAAI6/B,IAA4BN,EACvF9f,EAAKwgB,YAAcniC,EAChB2hB,EAAKie,WACJje,EAAK3hB,OAAS2hB,EAAKie,WAEnBje,EAAK3hB,OAASA,OAGzB,CAAAwgB,IAAA,cAAAkB,MAED,WAAc,IAAAsb,EAAAxrB,KACJnR,EAAQC,OAAOC,iBACf4a,EAAI3J,KAAKzR,MAAQM,EACjB2sB,EAAIxb,KAAKxR,OAASK,EAClB4E,EAAIuM,KAAKquB,OAASx/B,EAClBqK,EAAOg3B,SAASlwB,KAAK8tB,UAAYj/B,EACvCmR,KAAK4wB,aAAe,IAAIvD,GAAY,CAChC9+B,MAAOob,EACPnb,OAAQgtB,EACR+R,MAAO,SAACp/B,GAGJA,EAAIo4B,UAAU5c,EAAE,EAAG6R,EAAE,GACrB,IAAMwU,EAAI7/B,GAAAA,OAAMq7B,EAAKuC,WAAU,KAAA59B,OAAI+I,EAAI/I,OAAAA,OAAMq7B,EAAKqC,YAClD1/B,EAAI6hC,KAAOA,EACX7hC,EAAI+/B,UAAY1C,EAAK0C,UACrB//B,EAAIggC,aAAe3C,EAAK2C,aACxBhgC,EAAI8rB,UAAYuR,EAAKqF,QAAUrF,EAAKyC,iBAAmBzC,EAAKwC,UAC5D,IAAIJ,EAAUpC,EAAK2E,eAInB,GAHG3E,EAAKkF,kBACJ9C,EAAUpC,EAAKkF,iBAEhB9C,EACC,GAAGpC,EAAK0C,YAAcT,GAAgB,CAClC,IAAM1E,EAAKpf,EAAI,EACfxb,EAAI2iC,SAASlD,EAAgBn6B,EAAI,EAATs1B,EAAY,QACjC,GAAGyC,EAAK0C,YAAcT,GAAkB,CAC3C,IAAM1E,EAAKpf,EAAI,EACfxb,EAAI2iC,SAASlD,EAAS7E,EAAI,QAE1B56B,EAAI2iC,SAASlD,EAASn6B,EAAI,EAAG,QAOhD,CAAAub,IAAA,YAAAkB,MAED,SAAUlC,GAAS,IAAA4d,EAAA5rB,KACfsK,OAAOC,KAAKyD,GAAS7W,SAAQ,SAAA4F,QACPxH,IAAfyY,EAAQjR,IAAmC,OAAfiR,EAAQjR,KACnC6uB,EAAK7uB,GAAKiR,EAAQjR,GAClB6uB,EAAK1a,YAAYnU,GAAKiR,EAAQjR,OAGtCiD,KAAK8vB,mBACL9vB,KAAK+vB,gBACR,CAAA/gB,IAAA,QAAAkB,MAED,WAAQ,IAAA6gB,EAAA/wB,KACJ,IAAIA,KAAK8uB,QAAQC,QAAS,CACtB,IAAIiC,GAAO,EAOX,GANAhxB,KAAK0P,cAAc,IAAIqP,GAAW,OAAQ,CACtC9uB,OAAQ+P,KACRuf,eAAc,WACVyR,GAAO,OAGXA,EACA,OAGJ,IAAMh6B,EAAQgJ,KAAKqO,SAASmY,UACtB3W,EAAQ7P,KAAKiP,OAEfjP,KAAKwvB,cADNx4B,EACsBgJ,KAAKixB,wBAAwBj6B,GAE7B,EAGzB,IAAMu4B,EAwlBlB,SAA4B2B,EAAiBC,GACzC,IAAMC,EAAQnjC,SAASC,cAAc,SACrCkjC,EAAMC,aAAa,8LASnBD,EAAMC,aAAa,YAAa,GAChCD,EAAMC,aAAa,eAAe,GAClCD,EAAMC,aAAa,cAAc,GACjCD,EAAMC,aAAa,cAAe,OASlC,IAAIC,GAAY,EACZhiB,EAAS,CACTiiB,QAAQ,GAqHZ,OAlHAH,EAAM3gC,iBAAiB,eAAe,SAAAkP,GAClCA,EAAE4f,iBACC5f,EAAE6U,OAGG8c,GACAJ,EAAgB,QAASvxB,EAAE6U,UAKvC4c,EAAM3gC,iBAAiB,oBAAoB,SAACkP,GAGxCuxB,EAAgB,oBAChBI,GAAY,KAEhBF,EAAM3gC,iBAAiB,qBAAqB,SAACkP,GAKzCuxB,EAAgB,oBAAqBvxB,EAAE6U,SAE3C4c,EAAM3gC,iBAAiB,kBAAkB,SAACkP,GAMtCuxB,EAAgB,iBAAkBvxB,EAAE6U,MACpC4c,EAAMlhB,MAAQ,GACdohB,GAAY,KAGhBF,EAAM3gC,iBAAiB,SAAS,SAACioB,GAC7B,OAAOA,EAAM1J,KACT,IAAK,QACDkiB,EAAgB,SAAS,GACzB,MACJ,IAAK,OACL,IAAK,UACD5hB,EAAOiiB,QAAS,MAM5BH,EAAM3gC,iBAAiB,WAAW,SAACioB,GAC/B,OAAOA,EAAM8Y,MACT,IAAK,QAGDN,EAAgB,SAChB,MACJ,IAAK,YAGDA,EAAgB,aAChB,MACJ,IAAK,YACDA,EAAgB,aAChB,MACJ,IAAK,aACDA,EAAgB,cAChB,MACJ,IAAK,YACDA,EAAgB,aAChB,MACJ,IAAK,UACDA,EAAgB,WAGxB,OAAOxY,EAAM1J,KACT,IAAK,QACDkiB,EAAgB,SAAS,GACzB,MACJ,IAAK,OACL,IAAK,UACD5hB,EAAOiiB,QAAS,EAChB,MACJ,IAAK,IACEjiB,EAAOiiB,QACNL,EAAgB,aAMhCE,EAAM3gC,iBAAiB,SAAS,SAACioB,GAC7ByY,EAAgB,QAASzY,MAG7B0Y,EAAM3gC,iBAAiB,WAAW,SAACioB,GAC/ByY,EAAgB,UAAWzY,MAG/B0Y,EAAM3gC,iBAAiB,QAAQ,SAAAioB,GAC3BA,EAAM6G,iBACN7G,EAAMyH,kBACN+Q,EAAgB,OAAQ,KAAMxY,MAGlC0Y,EAAM3gC,iBAAiB,OAAO,SAAAioB,GAC1BA,EAAM6G,iBACN7G,EAAMyH,kBACN+Q,EAAgB,MAAO,KAAMxY,MAGjC0Y,EAAM3gC,iBAAiB,SAAS,SAAAioB,GAC5BA,EAAM6G,iBACN7G,EAAMyH,kBACN+Q,EAAgB,QAAS,KAAMxY,MAE5B0Y,EAtuBsBK,CACjBzxB,KAAK0xB,iBAAiBxuB,KAAKlD,MAC3BA,KAAK2xB,iBAAiBzuB,KAAKlD,OACf6P,EAAM+hB,WACdxiC,OAAOmgC,GACfA,EAAasC,MAAM,CAAEC,eAAe,IACpCjiB,EAAMkiB,iBAAiB/xB,MAEvBsK,OAAOK,OAAO3K,KAAK8uB,QAAS,CACxBC,SAAS,EACTO,OAAQtvB,KAAK4tB,QACb2B,aAAAA,EACAN,YAAapf,EAAM8G,mBAAkB,SAACe,GAClC,IAAMwX,EAAc6B,EAAKjC,QAAQI,YAC9B6B,EAAKjC,QAAQK,iBACZ4B,EAAKjC,QAAQI,YAAcxX,EAC3BqZ,EAAKjC,QAAQK,gBAAiB,GAE/BzX,EAAUwX,EAAc,MACvB6B,EAAKjC,QAAQE,YAAc+B,EAAKjC,QAAQE,WACxC+B,EAAKjC,QAAQI,YAAcxX,QAIpC1X,KAAKyuB,iBACJzuB,KAAK4tB,QAAU,IAEnB5tB,KAAKgyB,6BAEZ,CAAAhjB,IAAA,kBAAAkB,MAED,WAAkB,IAAA+hB,EAAAjyB,KAUdA,KAAKvP,iBAAiB,YAAY,SAACioB,GAC5BA,EAAMlI,gBAAkByhB,GAGxBA,EAAKnD,QAAQC,SACZkD,EAAKC,sBAGblyB,KAAKvP,iBAAiB,SAAS,SAACioB,GAC5B,GAAGA,EAAMlI,gBAAkByhB,EAA3B,CAIA,GAAGA,EAAKnD,QAAQC,QAAS,CACrB,IAAM/3B,EAAQi7B,EAAK5jB,SAASmY,UACtBpmB,EAAS6xB,EAAKhB,wBAAwBj6B,GAC5C,GAAGi7B,EAAKnD,QAAQO,QAAS,CACrB,IAAMO,EAAeqC,EAAKxC,WAAWG,aACrCtlB,OAAOK,OAAOsnB,EAAKxC,WAAY,CAC3BC,UAAW1gC,KAAK+J,IAAIqH,EAAQwvB,GAC5BD,QAAS3gC,KAAKgK,IAAIoH,EAAQwvB,GAC1BtH,QAAQ,IAEZ2J,EAAKzC,cAAgByC,EAAKxC,WAAWE,QACrCsC,EAAKnD,QAAQS,aAAasC,MAAM,CAAEC,eAAe,SAGjDG,EAAKzC,cAAgBpvB,EACrB6xB,EAAKnD,QAAQS,aAAasC,MAAM,CAAEC,eAAe,IACjDG,EAAKE,iBACLF,EAAKD,0BAGbC,EAAK1R,YAETvgB,KAAKvP,iBAAiB,QAAQ,SAACioB,GA3C3BuZ,EAAKnD,QAAQC,SAAU,EACpBkD,EAAKnD,QAAQS,cACZ0C,EAAKnD,QAAQS,aAAa6C,SAE3BH,EAAK5jB,UACJ4jB,EAAKhjB,OAAOoI,iBAwChB4a,EAAKviB,cAAc,IAAIqP,GAAW,SAAU,CACxC9uB,OAAQgiC,EACR3C,OAAQ2C,EAAKnD,QAAQQ,OACrBvf,IAAKkiB,EAAKrE,WAEdqE,EAAKxC,WAAWnH,QAAS,EACzB2J,EAAKnD,QAAQG,YAAYjY,SACzB1M,OAAOK,OAAOsnB,EAAKnD,QAAS,CACxBC,SAAS,EACTC,YAAY,EACZC,YAAa,KACbC,YAAa,EACbC,gBAAgB,EAEhBC,gBAAgB,EAChBC,SAAS,EAETC,OAAQ,GACRC,aAAc,UAGtBvvB,KAAKvP,iBAAiB,sBAAsB,SAACioB,GACzC,GAAGuZ,EAAKnD,QAAQC,UAAYkD,EAAKnD,QAAQO,QAAS,CAC9C3W,EAAM9I,OAAOa,SAAU,EACvBiI,EAAM9I,OAAO2P,iBACb,IAAMvoB,EAAQi7B,EAAK5jB,SAASmY,UACtBtzB,EAAI++B,EAAKhB,wBAAwBj6B,GAEvCi7B,EAAKxC,WAAWG,aAAe18B,EAC/B,IAAM2c,EAAQ6I,EAAM9I,OAAOC,MACvBwiB,GAAQ,EACNjgC,EAAK,SAAAuN,GACP0yB,GAAQ,EACR,IAAQ1Z,EAAqBhZ,EAArBgZ,QAASC,EAAYjZ,EAAZiZ,QACX9lB,EAAI+c,EAAM+S,oBAAoB,CAACjK,EAASC,IAC9C/I,EAAMgE,OAAO4S,SAAS3zB,GACtB,IAAMkE,EAAQi7B,EAAK5jB,SAASmY,UACtBtzB,EAAI++B,EAAKhB,wBAAwBj6B,GACjC44B,EAAeqC,EAAKxC,WAAWG,aACrCqC,EAAKnD,QAAQC,SAAU,EACvBzkB,OAAOK,OAAOsnB,EAAKxC,WAAY,CAC3BC,UAAW1gC,KAAK+J,IAAI7F,EAAG08B,GACvBD,QAAS3gC,KAAKgK,IAAI9F,EAAG08B,GACrBtH,QAAQ,KAEbplB,KAAK+uB,GAERhkC,SAASwC,iBAAiB,cAAe2B,GACzCnE,SAASwC,iBAAiB,aAAa,SAACkP,GAEpC,GADA1R,SAASsC,oBAAoB,cAAe6B,GACxCigC,EAAJ,CAIA,IAAM1C,EAAUsC,EAAKxC,WAAWE,QAChCsC,EAAKzC,cAAgBG,EACrBsC,EAAKnD,QAAQC,SAAU,EACvBkD,EAAKnD,QAAQS,aAAasC,MAAM,CAAEC,eAAe,IACjDG,EAAKxC,WAAWG,aAAe,UAP3BqC,EAAKxC,WAAWG,aAAe,OAQpC,CACCp/B,MAAM,UAIrB,CAAAwe,IAAA,0BAAAkB,MAED,SAAwBlZ,GACpB,IAAOnF,EAAP2f,EAAYxa,EAAK,GAAT,GACF2S,EAAI3J,KAAKzR,MAAM,EAEfoqB,EAAU9mB,GADhB2f,EAAaxR,KAAKoQ,OAAM,GAAf,GACiBzG,GAQ1B,OANGgP,GAAW3Y,KAAKwwB,WACAxwB,KAAK4tB,QAAQh7B,OAEboN,KAAKywB,iBAAiB9X,KAI5C,CAAA3J,IAAA,mBAAAkB,MAED,SAAiBoiB,GAAM,IAAAC,EAAAvyB,KACb4tB,EAAU5tB,KAAK4tB,QACf4E,EAAO5E,EAAQh7B,OAAS,EACxB6/B,EAAezyB,KAAKwwB,WAC1B,GAAoB,IAAjBiC,EACC,OAAO,EAEX,IAAMC,EAAWD,EACbr7B,EAAMpI,KAAKC,MAAMqjC,EAAOI,EAAWF,GAoDvC,OAnDA/iC,GAAmB,SAACtB,GAEhB,IAAIwkC,EAAIC,EACJC,EAFJ1kC,EAAI6hC,KAAI7/B,GAAAA,OAAMoiC,EAAKzE,SAAQ,KAAA39B,OAAIoiC,EAAK1E,YAIpC,IAAI36B,EAAI06B,EAAQp3B,UAAU,EAAGY,GACzBkD,EAAKszB,EAAQp3B,UAAUY,EAAI,EAAGA,GAC9BmD,EAAKqzB,EAAQp3B,UAAUY,EAAKA,EAAI,GAChCuS,EAAIxb,EAAIkiC,YAAYn9B,GAAG3E,MACvBukC,EAAK3kC,EAAIkiC,YAAY/1B,GAAI/L,MACzBo+B,EAAKx+B,EAAIkiC,YAAY91B,GAAIhM,MAC7BokC,EAAKhpB,EAAImpB,EAAG,EACZF,EAAKjpB,EAAIgjB,EAAG,EAEZ,EAAG,CACC,GAAGgG,GAAML,GAAQM,GAAMN,EACnB,MAEJ,GAAGK,EAAKL,EAAM,CAEV,IAAMS,EAAQH,EAAKN,EACnBO,EAAUz7B,EAENA,GADD27B,EAAQ,IACA,EAEA/jC,KAAKC,MAAM8jC,EAAQH,EAAKC,GAEnC3/B,EAAI06B,EAAQp3B,UAAUY,EAAKy7B,GAC3BlpB,GAAKxb,EAAIkiC,YAAYn9B,GAAG3E,WACrB,GAAGqkC,EAAKN,EAAM,CAEjB,IAAMS,EAAQT,EAAOK,EACrBE,EAAUz7B,EAENA,GADD27B,EAAQ,IACA,EAEA/jC,KAAKC,MAAM8jC,GAASL,EAAWC,IAAOH,EAAOK,IAExD3/B,EAAI06B,EAAQp3B,UAAUq8B,EAASz7B,GAC/BuS,GAAKxb,EAAIkiC,YAAYn9B,GAAG3E,MAG5B+L,EAAKszB,EAAQp3B,UAAUY,EAAI,EAAGA,GAC9BmD,EAAKqzB,EAAQp3B,UAAUY,EAAKA,EAAI,GAGhCu7B,EAAKhpB,GAFLmpB,EAAK3kC,EAAIkiC,YAAY/1B,GAAI/L,OAEb,EACZqkC,EAAKjpB,GAFLgjB,EAAKx+B,EAAIkiC,YAAY91B,GAAIhM,OAEb,QACR6I,GAAO,GAAKA,GAAOo7B,MAGxBp7B,IACV,CAAA4X,IAAA,iBAAAkB,MAED,WACOlQ,KAAK8uB,QAAQC,SACZzkB,OAAOK,OAAO3K,KAAK8uB,QAAS,CACxBE,YAAY,EACZG,gBAAgB,IAGrBnvB,KAAKyvB,WAAWnH,SACftoB,KAAKyvB,WAAWnH,QAAS,KAEhC,CAAAtZ,IAAA,SAAAkB,MAED,SAAO/hB,GAIH,GAHG6R,KAAK2T,YACJxlB,EAAIk4B,YAAc,KAElBl4B,EAAI6kC,eAAiBhzB,KAAK8uB,QAAQC,SAAW/uB,KAAKiP,OAAOpgB,MAAQqhC,SAASlwB,KAAK8tB,UAAY,EAAG,CAC9F,IAAApc,EAAAF,EAAiBxR,KAAKoQ,OAAM,GAArBiL,EAAE3J,EAAA,GAAEmJ,EAAEnJ,EAAA,GAQb,OANAvjB,EAAIyB,OACJzB,EAAIo4B,UAAUlL,EAAIR,GAClB1sB,EAAI4rB,YACJ5rB,EAAIq/B,UAAUxtB,KAAK4wB,aAAatD,aAActtB,KAAKzR,MAAM,GAAIyR,KAAKxR,OAAO,EAAGwR,KAAKzR,MAAOyR,KAAKxR,QAC7FL,EAAIo4B,WAAWlL,GAAKR,QACpB1sB,EAAI0B,UAIR,IAAMmgC,EAAI7/B,GAAAA,OAAM6P,KAAK+tB,WAAU59B,KAAAA,OAAI6P,KAAK8tB,SAAQ39B,KAAAA,OAAI6P,KAAK6tB,YACtD1/B,EAAI6hC,OAASA,IACZ7hC,EAAI6hC,KAAOA,GAGZ7hC,EAAI+/B,YAAcluB,KAAKkuB,YACtB//B,EAAI+/B,UAAYluB,KAAKkuB,WAGtB//B,EAAIggC,eAAiBnuB,KAAKmuB,eACzBhgC,EAAIggC,aAAenuB,KAAKmuB,cAG5BhgC,EAAI8rB,UAAYja,KAAK6wB,QAAU7wB,KAAKiuB,iBAAmBjuB,KAAKguB,UAC5D,IAAIJ,EAAU5tB,KAAKmwB,eAInB,GAHGnwB,KAAK0wB,kBACJ9C,EAAU5tB,KAAK0wB,iBAEhB9C,EACC,GAAG5tB,KAAKkuB,YAAcT,GAAgB,CAClC,IAAM1E,EAAK/oB,KAAKzR,MAAQ,EACxBJ,EAAI2iC,SAASlD,EAAS5tB,KAAKoQ,OAAO,GAAK2Y,EAAK/oB,KAAKquB,OAAS,EAAGruB,KAAKoQ,OAAO,SACtE,GAAGpQ,KAAKkuB,YAAcT,GAAkB,CAC3C,IAAM1E,EAAK/oB,KAAKzR,MAAQ,EACxBJ,EAAI2iC,SAASlD,EAAS5tB,KAAKoQ,OAAO,GAAK2Y,EAAI/oB,KAAKoQ,OAAO,SAEvDjiB,EAAI2iC,SAASlD,EAAS5tB,KAAKoQ,OAAO,GAAKpQ,KAAKquB,OAAS,EAAGruB,KAAKoQ,OAAO,IAK5E,IAAM2Y,EAAK/oB,KAAKzR,MAAM,EAChB0kC,EAAajzB,KAAK2wB,YACxBzJ,EAAA1V,EAAexR,KAAKoQ,OAAM,GAAnBve,EAACq1B,EAAA,GAAEp1B,EAACo1B,EAAA,GACLrlB,EAAKhQ,EAAIk3B,EACTjnB,EAAKhQ,EAAImhC,EAAW,EAE1B,GAAGjzB,KAAK8uB,QAAQE,YAAchvB,KAAK8uB,QAAQC,QAAS,CAChD,IAAM3uB,EAASJ,KAAKwvB,cACdt8B,EAAI8M,KAAK4tB,QAAQp3B,UAAU,EAAG4J,GAC9B8yB,EAAKrxB,EAAK1T,EAAIkiC,YAAYn9B,GAAG3E,MAC7B4kC,EAAQnzB,KAAK2wB,YAAY,EAC/BxiC,EAAI4rB,YACJ5rB,EAAI6sB,OAAOkY,EAAIphC,EAAIqhC,GACnBhlC,EAAI8sB,OAAOiY,EAAIphC,EAAIqhC,GACnBhlC,EAAI04B,UAAY,EAChB14B,EAAI24B,YAAc9mB,KAAK4uB,YACvBzgC,EAAI44B,SAGR,GAAG/mB,KAAKyvB,WAAWnH,OAAQ,CACvB,IAAA8K,EAEIpzB,KAAKyvB,WADLC,EAAS0D,EAAT1D,UAAWC,EAAOyD,EAAPzD,QAETz8B,EAAI8M,KAAK4tB,QAAQp3B,UAAU,EAAGk5B,GAC9B2D,EAAQrzB,KAAK4tB,QAAQp3B,UAAUk5B,EAAWC,GAE1C99B,EAAIgQ,EAAK1T,EAAIkiC,YAAYn9B,GAAG3E,MAC5Bob,EAAIxb,EAAIkiC,YAAYgD,GAAO9kC,MACjCJ,EAAI4rB,YACJ5rB,EAAIkiB,KAAKxe,EAAGiQ,EAAI6H,EAAGspB,GACnB9kC,EAAI8rB,UAAYja,KAAK6uB,eACrB1gC,EAAIotB,UAEX,CAAAvM,IAAA,gBAAAkB,MAED,SAAcojB,EAAI9e,GACd,GAAGxU,KAAKyvB,WAAWnH,SACftoB,KAAKuzB,kBACK,cAAPD,GAQC,OAPAtzB,KAAK0P,cAAc,IAAIqP,GAAW,QAAS,CACvC9uB,OAAQ+P,KACRsvB,OAAQtvB,KAAK8uB,QAAQQ,OACrBvf,IAAK/P,KAAK4tB,WAEd5tB,KAAKwzB,eACLxzB,KAAKgyB,0BAIb,IAGIyB,EAHErzB,EAASJ,KAAKwvB,cACd5B,EAAU5tB,KAAK4tB,QACjB8F,EAAa9F,EAAQp3B,UAAU,EAAG4J,GAGlCqzB,EADDzzB,KAAK2zB,SACW/F,EAAQp3B,UAAUwJ,KAAK2zB,SAAS,IAEhC/F,EAAQp3B,UAAU4J,GAErC,IAAIwzB,GAAiB,EACrB,OAAON,GACH,IAAK,QACDI,GAAclf,EACdxU,KAAKwvB,eAAiBhb,EAAK5hB,OAC3BoN,KAAK4tB,QAAU8F,EAAaD,EAC5B,MACJ,IAAK,mBACDzzB,KAAK2zB,SAAW,CAACD,EAAW9gC,OAAQ8gC,EAAW9gC,QAC/C,MACJ,IAAK,oBACD8gC,EAAaA,EAAWl9B,UAAU,EAAGwJ,KAAK2zB,SAAS,IACnDD,GAAclf,EACdxU,KAAK4tB,QAAU8F,EAAaD,EAE5BzzB,KAAKwvB,cAAgBxvB,KAAK2zB,SAAS,GAAKnf,EAAK5hB,OAC7CoN,KAAK2zB,SAAS,GAAK3zB,KAAK2zB,SAAS,GAAKnf,EAAK5hB,OAC3C,MACJ,IAAK,iBACD8gC,EAAaA,EAAWl9B,UAAU,EAAGwJ,KAAK2zB,SAAS,IACnD3zB,KAAKwvB,cAAgBxvB,KAAK2zB,SAAS,GAAKnf,EAAK5hB,OAC7CoN,KAAK2zB,SAAW,KAChBD,GAAclf,EACdxU,KAAK4tB,QAAU8F,EAAaD,EAC5B,MACJ,IAAK,QACD,GAAGzzB,KAAK2zB,SACJ,OAEJ,IAAIE,GAAa,EAEjB7zB,KAAK0P,cAAc,IAAIqP,GAAW,kBAAmB,CACjD9uB,OAAQ+P,KACRohB,QAAS,SAACrR,GACN8jB,EAAa9jB,GAEjBuhB,UAAS,WACLsC,GAAiB,MAGtBC,GACC7zB,KAAKiP,OAAO6kB,OAGhB,MACJ,IAAK,YACDJ,EAAaA,EAAWl9B,UAAU,EAAGk9B,EAAW9gC,OAAS,GACzDoN,KAAKwvB,cAAgBxgC,KAAKgK,IAAI,EAAGgH,KAAKwvB,cAAc,GACpDxvB,KAAK4tB,QAAU8F,EAAaD,EAKhCG,GACA5zB,KAAK0P,cAAc,IAAIqP,GAAW,QAAS,CACvC9uB,OAAQ+P,KACRsvB,OAAQtvB,KAAK8uB,QAAQQ,OACrBvf,IAAK/P,KAAK4tB,WAKlB5tB,KAAKwzB,UACLxzB,KAAKgyB,4BACR,CAAAhjB,IAAA,UAAAkB,MAED,WACIlQ,KAAK8vB,mBACL9vB,KAAKqO,SAASwC,gBACd7Q,KAAKiP,OAAOoI,mBACf,CAAArI,IAAA,0BAAAkB,MAED,WAA0B,IAAA6jB,EAAA/zB,KACtB,GAAGA,KAAK8uB,QAAQC,QAAS,CACrB,IAAMhG,EAAK/oB,KAAKzR,MAAM,EAChBy6B,EAAKhpB,KAAKxR,OAAO,EACnBqT,EAAK7B,KAAKoQ,OAAO,GAAK2Y,EACpB3oB,EAASJ,KAAKwvB,cAEpB//B,GAAmB,SAACtB,GAChBA,EAAI4rB,YACJ5rB,EAAI6hC,KAAI7/B,GAAAA,OAAM4jC,EAAKjG,SAAQ,KAAA39B,OAAI4jC,EAAKlG,YACpC,IAAM36B,EAAI6gC,EAAKnG,QAAQp3B,UAAU,EAAG4J,GACpCyB,GAAM1T,EAAIkiC,YAAYn9B,GAAG3E,SAE7B,IAAMyI,EAAQgJ,KAAK2Q,qBAAqB,CAAC9O,EAAImnB,IACvCzL,EAAavd,KAAKiP,OAAOsO,WACzByW,EAAKhlC,KAAK+J,IAAIwkB,EAAWC,aAAe,IAAKxmB,EAAM,IACzDgJ,KAAK8uB,QAAQS,aAAa5gC,MAAM6qB,UAAS,aAAArpB,OAAgB6jC,UAAE7jC,OAAO6G,EAAM,GAAO,UAEtF,CAAAgY,IAAA,mBAAAkB,MAED,SAAiBojB,EAAI9e,EAAM7U,GAOvB,OANGK,KAAK8uB,QAAQC,SACZzkB,OAAOK,OAAO3K,KAAK8uB,QAAS,CACxBE,YAAY,EACZG,gBAAgB,IAGjBmE,GACH,IAAK,QACL,IAAK,mBACL,IAAK,oBACL,IAAK,iBACL,IAAK,QACL,IAAK,YACDtzB,KAAKi0B,cAAcX,EAAI9e,GACvB,MACJ,IAAK,YACExU,KAAKyvB,WAAWnH,SACftoB,KAAKyvB,WAAWnH,QAAS,GAE7BtoB,KAAKk0B,eACL,MACJ,IAAK,aACEl0B,KAAKyvB,WAAWnH,SACftoB,KAAKyvB,WAAWnH,QAAS,GAE7BtoB,KAAKm0B,gBACL,MACJ,IAAK,QACDn0B,KAAKo0B,eAAe5f,GACpB,MACJ,IAAK,QACDxU,KAAKkyB,mBACL,MACJ,IAAK,OACDlyB,KAAKq0B,MAAM10B,GACX,MACJ,IAAK,MACDK,KAAKs0B,KAAK30B,GACV,MACJ,IAAK,QACDK,KAAKu0B,OAAO50B,MAIvB,CAAAqP,IAAA,eAAAkB,MAED,WACIlQ,KAAKwvB,cAAgBxgC,KAAKgK,IAAI,EAAGgH,KAAKwvB,cAAgB,GACtDxvB,KAAKiP,OAAOoI,iBACZrX,KAAKgyB,4BACR,CAAAhjB,IAAA,gBAAAkB,MAED,WACIlQ,KAAKwvB,cAAgBxgC,KAAK+J,IAAIiH,KAAK4tB,QAAQh7B,OAAQoN,KAAKwvB,cAAgB,GACxExvB,KAAKiP,OAAOoI,iBACZrX,KAAKgyB,4BACR,CAAAhjB,IAAA,iBAAAkB,MAED,SAAeH,GACX/P,KAAK8uB,QAAQO,QAAUtf,EAEnB/P,KAAKyvB,WAAWG,aADjB7f,EACgC/P,KAAKwvB,cAEL,OAEtC,CAAAxgB,IAAA,mBAAAkB,MAED,WACIlQ,KAAKyvB,WAAa,CACdnH,QAAQ,EACRoH,UAAW,EACXC,QAAS3vB,KAAK4tB,QAAQh7B,QAE1BoN,KAAKwvB,cAAgBxvB,KAAK4tB,QAAQh7B,SACrC,CAAAoc,IAAA,kBAAAkB,MAED,WACI,GAAGlQ,KAAKyvB,WAAWnH,OAAQ,CACvB,IAAAkM,EAA+Bx0B,KAAKyvB,WAA5BC,EAAS8E,EAAT9E,UAAWC,EAAO6E,EAAP7E,QACb/B,EAAU5tB,KAAK4tB,QACf8F,EAAa9F,EAAQp3B,UAAU,EAAGk5B,GAClC+D,EAAe7F,EAAQp3B,UAAUm5B,GACvC3vB,KAAK4tB,QAAU8F,EAAaD,EAC5BzzB,KAAKwvB,cAAgBkE,EAAW9gC,OAChCoN,KAAKyvB,WAAWnH,QAAS,KAEhC,CAAAtZ,IAAA,gBAAAkB,MAED,WACI,GAAGlQ,KAAKyvB,WAAWnH,OAAQ,CACvB,IAAAmM,EAA+Bz0B,KAAKyvB,WAA5BC,EAAS+E,EAAT/E,UAAWC,EAAO8E,EAAP9E,QAEnB,OADgB3vB,KAAK4tB,QACNp3B,UAAUk5B,EAAWC,GAExC,OAAO,OACV,CAAA3gB,IAAA,QAAAkB,MAED,SAAMwI,GACF,IAAMgc,EAAY10B,KAAK20B,gBACpBD,GACChc,EAAMkc,cAAcC,QAAQ,aAAcH,KAEjD,CAAA1lB,IAAA,OAAAkB,MACD,SAAKwI,GACD,IAAMgc,EAAY10B,KAAK20B,gBACpBD,IACChc,EAAMkc,cAAcC,QAAQ,aAAcH,GAC1C10B,KAAKuzB,kBACLvzB,KAAKwzB,aAEZ,CAAAxkB,IAAA,SAAAkB,MACD,SAAOwI,GACH,IAAIoc,GAAgBpc,EAAMkc,eAAiB9lC,OAAO8lC,eAAeG,QAAQ,QACrE/D,GAAO,EAWX,GAVAhxB,KAAK0P,cAAc,IAAIqP,GAAW,QAAS,CACvC9uB,OAAQ+P,KACR4tB,QAASkH,EACTvV,eAAc,WACVyR,GAAO,GAEXgE,oBAAmB,SAACjlC,GAChB+kC,EAAe/kC,EAAS+kC,QAG7B9D,EAAH,CAGAhxB,KAAKuzB,kBACL,IAAMnzB,EAASJ,KAAKwvB,cACd5B,EAAU5tB,KAAK4tB,QACf8F,EAAa9F,EAAQp3B,UAAU,EAAG4J,GAClCqzB,EAAe7F,EAAQp3B,UAAU4J,GACvCJ,KAAK4tB,QAAU8F,EAAaoB,EAAerB,EAC3CzzB,KAAKwvB,eAAiBkE,EAAaoB,GAAcliC,OACjDoN,KAAKwzB,aACR,CAAAxkB,IAAA,mBAAAkB,MACD,SAAiBojB,EAAI3zB,GACjB,OAAO2zB,GACH,IAAK,UACDtzB,KAAK0P,cAAc,IAAIqP,GAAW,UAAW,CACzC9uB,OAAQ+P,KACRgP,IAAKrP,EAAEqP,IACPwiB,KAAM7xB,EAAE6xB,KACRyD,SAAUt1B,KAEd,MACJ,IAAK,QACDK,KAAK0P,cAAc,IAAIqP,GAAW,QAAS,CACvC9uB,OAAQ+P,KACRgP,IAAKrP,EAAEqP,IACPwiB,KAAM7xB,EAAE6xB,KACRyD,SAAUt1B,QAKzB,CAAAqP,IAAA,UAAAkB,MAED,WACOlQ,KAAKiP,OAAOimB,OAAO/lB,WAAanP,MAC/BA,KAAKiP,OAAO6kB,WAEnBpG,GA9wBcrG,ICeb8N,IAAAA,YAAIxH,GAAA/f,EAAAunB,EAAAxH,GAAA,IAAA9f,EAAAC,EAAAqnB,GACN,SAAAA,EAAYnnB,GAAS,IAAAD,EAchB,OAdgBE,OAAAknB,IACjBpnB,EAAAF,EAAAK,UAAMF,IAEDonB,MAAQpnB,EAAQonB,MACrBrnB,EAAKqnB,MAAMC,OAAS,WAChBtnB,EAAKkB,OAAOiI,WAMhBnJ,EAAKunB,cAAgB,CACjB/mC,MAAOyf,EAAQunB,YAAcvnB,EAAQzf,MACrCC,OAAQwf,EAAQwnB,aAAgBxnB,EAAQxf,QAC3Cuf,EAuCJ,OAtCAgB,EAAAomB,EAAA,CAAA,CAAAnmB,IAAA,YAAAkB,MAED,SAAUlC,GAAS,IAAAmC,EAAAnQ,KACfsK,OAAOC,KAAKyD,GAAS7W,SAAQ,SAAA4F,QACPxH,IAAfyY,EAAQjR,IAAmC,OAAfiR,EAAQjR,KACnCoT,EAAKpT,GAAKiR,EAAQjR,GAClBoT,EAAKe,YAAYnU,GAAKiR,EAAQjR,OAGnCiR,EAAQonB,QAAUpnB,EAAQonB,MAAMK,WAC/Bz1B,KAAKo1B,MAAMC,OAAS,WAChBllB,EAAKlB,OAAOiI,YAMpBlX,KAAKs1B,cAAgB,CACjB/mC,MAAOyf,EAAQunB,YAAcvnB,EAAQzf,OAASyR,KAAKs1B,cAAc/mC,MACjEC,OAAQwf,EAAQwnB,aAAgBxnB,EAAQxf,QAAUwR,KAAKs1B,cAAc9mC,UAE5E,CAAAwgB,IAAA,SAAAkB,MAED,SAAO/hB,GACHA,EAAIyB,OACDoQ,KAAK2T,YACJxlB,EAAIk4B,YAAc,IAEtBgB,GAAU9B,UAAU71B,OAAOwe,KAAKlO,KAAM7R,GACtC,IAAM0D,EAAImO,KAAKoQ,OAAO,GAAKpQ,KAAKzR,MAAQ,EAClCuD,EAAIkO,KAAKoQ,OAAO,GAAKpQ,KAAKxR,OAAS,EACtCwR,KAAK6O,QAAU,IACd1gB,EAAIk4B,YAAcrmB,KAAK6O,SAExB7O,KAAKo1B,MAAMK,UACVtnC,EAAIq/B,UAAUxtB,KAAKo1B,MAAOvjC,EAAGC,EAAGkO,KAAKs1B,cAAc/mC,MAAOyR,KAAKs1B,cAAc9mC,QAEjFL,EAAI0B,cACPslC,GAtDc9N,ICVbqO,YAAS/H,GAAA/f,EAAA8nB,EAAA/H,GAAA,IAAA9f,EAAAC,EAAA4nB,GACX,SAAAA,EAAY1nB,GAAS,IAAAD,EAGA,OAHAE,OAAAynB,IACjB3nB,EAAAF,EAAAK,UAAMF,IACD2nB,WAAa3nB,EAAQ4nB,eAC1B7nB,EAAK8nB,KAAO,KAAK9nB,EAsDpB,OArDAgB,EAAA2mB,EAAA,CAAA,CAAA1mB,IAAA,uBAAAkB,MAED,WACI,IAAMjd,EAAI+M,KAAKsQ,kBACf,OAAOtQ,KAAK2Q,qBAAqB1d,EAAEoK,MAAM,EAAG,MAC/C,CAAA2R,IAAA,SAAAkB,MAED,SAAO/hB,GAAK,IAAAgiB,EAAAnQ,KACR,IAAIA,KAAK61B,MAAQ71B,KAAK21B,WAClBve,uBAAsB,WAClB,IAAIjH,EAAK0lB,KAAM,CACX,IAAMC,EAAY7nC,SAASC,cAAc,OACnCmI,EAAM8Z,EAAK4lB,uBACXlnC,EAAQshB,EAAKlB,OAAOpgB,MAC1BinC,EAAUzE,aAAa,yFAAOlhC,OAEjBggB,EAAK5hB,MAAK4B,yCAAAA,OACTggB,EAAK3hB,OAAM,8KAAA2B,OAIEkG,EAAI,GAAE,QAAAlG,OAAOkG,EAAI,GAAElG,cAAAA,OAAatB,SAC3DshB,EAAK0lB,KAAOC,EACZ3lB,EAAKlB,OAAO2iB,WAAWoE,YAAYF,GACnC3lB,EAAKwlB,WAAWG,WAGrB,CACH,IAAMz/B,EAAM2J,KAAK+1B,uBACXlnC,EAAQmR,KAAKiP,OAAOpgB,MAC1BmR,KAAK61B,KAAKlnC,MAAM6qB,UAASrpB,aAAAA,OAAgBkG,EAAI,GAAElG,QAAAA,OAAOkG,EAAI,GAAElG,cAAAA,OAAatB,EAAQ,KAErFk8B,EAAAC,EAAA0K,EAAAnQ,WAAA,SAAAvlB,MAAAkO,KAAAlO,KAAa7R,KAChB,CAAA6gB,IAAA,iBAAAkB,MAED,WACOlQ,KAAK61B,OACJ71B,KAAK61B,KAAKlnC,MAAMy2B,QAAU,WAEjC,CAAApW,IAAA,iBAAAkB,MAED,WACOlQ,KAAK61B,OACJ71B,KAAK61B,KAAKlnC,MAAMy2B,QAAU,UAEjC,CAAApW,IAAA,UAAAkB,MAED,WAEOlQ,KAAK61B,MACJ71B,KAAKiP,OAAO2iB,WAAWqE,YAAYj2B,KAAK61B,MAE5C9K,EAAAC,EAAA0K,EAAAnQ,2BAAArX,KAAAlO,UACH01B,GA1DmBrO,ICMlB6O,YAAIC,GAAAvoB,EAAAsoB,EAAAC,GAAA,IAAAtoB,EAAAC,EAAAooB,GACN,SAAAA,EAAYloB,GAAS,IAAAD,EAaf,OAbeE,OAAAioB,IACjBnoB,EAAAF,EAAAK,UAAMF,IACD6f,WAAgB7f,EAAQ6f,WAAa,6NAC1C9f,EAAK+f,SAAgB9f,EAAQ8f,UAAY,OACzC/f,EAAK6f,QAAgB5f,EAAQ4f,SAAW,GACxC7f,EAAKqoB,SAAgBpoB,EAAQooB,SAC7BroB,EAAKsoB,YAAeroB,EAAQqoB,a9BFT,E8BInBtoB,EAAKuoB,iBAAc/gC,EACnBwY,EAAKqc,aAAe,GACpBrc,EAAKwoB,kBAAoB,CACrB/1B,KAAM,GACN2U,GAAI,IACNpH,EAwFL,OAvFAgB,EAAAmnB,EAAA,CAAA,CAAAlnB,IAAA,yBAAAkB,MAED,WACI,IAAMsmB,EAAKx2B,KAAKQ,KAAKyjB,sBAAsBjkB,KAAKmV,GAAGshB,aAC7C//B,EAAKsJ,KAAKmV,GAAG8O,sBAAsBjkB,KAAKQ,KAAKi2B,aACnDz2B,KAAKoqB,aAAa,GAAKoM,EACvBx2B,KAAKoqB,aAAa,GAAK1zB,EACvB,IAAME,EAAKF,EAAG,GAAK8/B,EAAG,GAChB3/B,EAAKH,EAAG,GAAK8/B,EAAG,GAChB1gC,EAAQ9G,KAAK8B,MAAM+F,EAAID,GAC7BoJ,KAAKs2B,YAAcxgC,IACtB,CAAAkZ,IAAA,cAAAkB,MAED,SAAYuJ,GACR,IAAMid,EAAU12B,KAAKQ,KAAK8P,kBACpBqmB,EAAQ32B,KAAKmV,GAAG7E,kBAChBsmB,EAAO52B,KAAKu2B,kBAMlB,OALIlpB,GAAmBupB,EAAKp2B,KAAMk2B,KAAYrpB,GAAmBupB,EAAKzhB,GAAIwhB,KACtErpB,GAAgBspB,EAAKp2B,KAAMk2B,GAC3BppB,GAAgBspB,EAAKzhB,GAAIwhB,GACzB32B,KAAK62B,2BAEF,IACV,CAAA7nB,IAAA,SAAAkB,MAED,SAAO/hB,GACH,IAAA2oC,EAAAtlB,EAAmBxR,KAAKoqB,aAAY,GAA5BoM,EAAEM,EAAA,GAAEpgC,EAAEogC,EAAA,GACRhhC,EAAQkK,KAAKs2B,YACb1/B,EAAKF,EAAG,GAAK8/B,EAAG,GAChB3/B,EAAKH,EAAG,GAAK8/B,EAAG,GAGtB,GAFAroC,EAAI8rB,UAAY9rB,EAAI24B,YAAc9mB,KAAKwO,gBACvCrgB,EAAI4rB,YACD/Z,KAAK4tB,QAAQ,CAEZz/B,EAAI+/B,UAAY,SAChB//B,EAAI6hC,KAAI7/B,GAAAA,OAAM6P,KAAK8tB,SAAQ,KAAA39B,OAAI6P,KAAK6tB,YACpC1/B,EAAIggC,aAAe,SACnB,IAAAiC,EAKIjiC,EAAIkiC,YAAYrwB,KAAK4tB,SAJrBmJ,EAAqB3G,EAArB2G,sBACAC,EAAsB5G,EAAtB4G,uBACA1G,EAAqBF,EAArBE,sBACAC,EAAsBH,EAAtBG,uBAEE1+B,EAAI+E,EAAI,EAAI4/B,EAAG,GACf1kC,EAAI+E,EAAI,EAAI2/B,EAAG,GACrBroC,EAAI2iC,SAAS9wB,KAAK4tB,QAAS/7B,EAAGC,GAC9B,IAAMvD,EAAQS,KAAK0B,IAAIqmC,GAAyB/nC,KAAK0B,IAAIsmC,GAA0B,GAC7ExoC,EAAgF,KAAtEQ,KAAK0B,IAAI4/B,GAAyBthC,KAAK0B,IAAI6/B,IAC3DpiC,EAAI4rB,YACJ,IAAIkd,EAAS,IAAItO,OACjBsO,EAAO5mB,KAAKxe,EAAItD,EAAM,EAAIuD,EAAItD,EAAO,EAAGD,EAAOC,GAC/C,IAAM8sB,EAAKtsB,KAAK+J,IAAIrC,EAAG,GAAI8/B,EAAG,IAAM,GAC9BU,EAAKloC,KAAK+J,IAAIrC,EAAG,GAAI8/B,EAAG,IAAM,GAC9BW,EAAKnoC,KAAK0B,IAAIkG,GAAM,GACpBwgC,EAAKpoC,KAAK0B,IAAImG,GAAM,GAC1BogC,EAAO5mB,KAAKiL,EAAK4b,EAAIC,EAAIC,GACzBjpC,EAAI6rB,KAAKid,EAAQ,WAIrB9oC,EAAI6sB,OAAOwb,EAAG,GAAIA,EAAG,IACrBroC,EAAI8sB,OAAOvkB,EAAG,GAAIA,EAAG,IAClBsJ,KAAKo2B,WACJjoC,EAAIyB,OACJzB,EAAIkpC,YAAYr3B,KAAKo2B,WAEzBjoC,EAAI44B,SACD/mB,KAAKo2B,UACJjoC,EAAI0B,UAGR1B,EAAIo4B,UAAU7vB,EAAG,GAAIA,EAAG,IACxBvI,EAAImpC,OAAOxhC,GACX3H,EAAI6sB,OAAO,EAAG,GACd7sB,EAAI8sB,QAAQ,GAAI,GAChB9sB,EAAI8sB,QAAQ,EAAG,GACf9sB,EAAI8sB,OAAO,EAAG,GACd9sB,EAAIotB,OACJptB,EAAImpC,QAAQxhC,GACZ3H,EAAIo4B,WAAW7vB,EAAG,IAAKA,EAAG,MAC7B,CAAAsY,IAAA,QAAAkB,MAED,SAAMlZ,GACF,IAAIgJ,KAAKoqB,aAAc,OAAO,EAC9B,IAAAmN,EAAA/lB,EAAuBxR,KAAKoqB,aAAY,GAExC,OADaxgB,GAAqB5S,EADrBugC,EAAA,GAAKA,EAAA,IAEJv3B,KAAKq2B,gBACtBH,GAtGchJ,ICZbsK,GAAYxoC,KAAKoC,GAAK,IAoBtBqmC,YAAQtB,GAAAvoB,EAAA6pB,EAAAtB,GAAA,IAAAtoB,EAAAC,EAAA2pB,GAKV,SAAAA,EAAYzpB,GAAS,IAAAD,EA6Bf,OA7BeE,OAAAwpB,IACjB1pB,EAAAF,EAAAK,UAAMF,IAEDqoB,YAAgBroB,EAAQqoB,a/BXV,E+BanBtoB,EAAK6M,OAAgB5M,EAAQ4M,QAAU,EAEvC7M,EAAK5C,SAAgB6C,EAAQ7C,UAAY,GAEzC4C,EAAK3C,SAAgB4C,EAAQ5C,UAAY,GAEzC2C,EAAKqoB,SAAgBpoB,EAAQooB,SAE7BroB,EAAK2pB,WAAgB1pB,EAAQ0pB,WAE7B3pB,EAAK8f,WAAgB7f,EAAQ6f,WAAa,6NAE1C9f,EAAK+f,SAAgB9f,EAAQ8f,UAAY,OAEzC/f,EAAK6f,QAAgB5f,EAAQ4f,SAAW,GAExC7f,EAAKxB,SAAkByB,EAAQzB,OAE/BwB,EAAK4pB,UAAkB3pB,EAAQ2pB,QAC/B5pB,EAAKuoB,YAAc,GACnBvoB,EAAKqc,aAAe,GACpBrc,EAAKwoB,kBAAoB,CACrB/1B,KAAM,GACN2U,GAAI,IACNpH,EA4KL,OA3KAgB,EAAA0oB,EAAA,CAAA,CAAAzoB,IAAA,yBAAAkB,MAED,WACI,IAAMpG,EAAU9J,KAAKQ,KAAKujB,kCACpBha,EAAQ/J,KAAKmV,GAAG4O,kCAChBuS,EAAct2B,KAAKs2B,YACzB,GAAGt2B,KAAKuM,OACJD,GACItM,KAAKoqB,aACLtgB,EAAQ9J,KAAKiK,SACbF,EAAMtB,GAAUK,MAChB9I,KAAKiK,QACLjK,KAAKmK,MACLnK,KAAKmL,SACLnL,KAAKoL,UACL,GACJkrB,EAAY,GAAKt2B,KAAKiK,QACtBqsB,EAAY,GAAKt2B,KAAKmK,WACnB,QAAoB5U,IAAjByK,KAAKiK,cAAwC1U,IAAfyK,KAAKmK,MACzCmC,GACItM,KAAKoqB,aACLtgB,EAAQ9J,KAAKiK,SACbF,EAAM/J,KAAKmK,OACXnK,KAAKiK,QACLjK,KAAKmK,MAAOnK,KAAKmL,SAAWnL,KAAKoL,UACrCkrB,EAAY,GAAKt2B,KAAKiK,QACtBqsB,EAAY,GAAKt2B,KAAKmK,UACnB,CACH,IAAMH,EAAOH,GAA4BC,EAASC,GAClDuC,GACItM,KAAKoqB,aACLpgB,EAAKE,MACLF,EAAKI,IACLJ,EAAKC,QACLD,EAAKG,MACLnK,KAAKmL,SAAWnL,KAAKoL,UACzBkrB,EAAY,GAAKtsB,EAAKC,QACtBqsB,EAAY,GAAKtsB,EAAKG,SAE7B,CAAA6E,IAAA,cAAAkB,MAED,SAAYuJ,GACR,QAAGzZ,KAAK43B,UAGR53B,KAAK62B,yB9B2NN,SAAwCgB,EAAUxnB,GAKrD,IAJA,IAAIvd,EAAI+kC,EAAS,GACbtlC,EAAIslC,EAASjlC,OACba,EAAI,EACRqkC,EAAAtmB,EAAyBnB,EAAI,GAAtB0nB,EAAED,EAAA,GAAE79B,EAAE69B,EAAA,GAAEE,EAAEF,EAAA,GAAE1zB,EAAE0zB,EAAA,GACdrkC,EAAIlB,GAAG,CACV,IAAM0lC,EAAKJ,EAASpkC,GACpB,GAAGX,EAAE,KAAOmlC,EAAG,IAEX,GAAGnlC,EAAE,GAAKklC,GAAMllC,EAAE,GAAKilC,KACbjlC,EAAE,GAAKsR,GAAM6zB,EAAG,GAAK7zB,GAAQtR,EAAE,GAAKmH,GAAMg+B,EAAG,GAAKh+B,GACpD,OAAO,OAIf,GAAGnH,EAAE,GAAKsR,GAAMtR,EAAE,GAAKmH,KACbnH,EAAE,GAAKklC,GAAMC,EAAG,GAAKD,GAAQllC,EAAE,GAAKilC,GAAME,EAAG,GAAKF,GACpD,OAAO,EAGnBjlC,EAAImlC,EACJxkC,IAEJ,OAAO,E8BjPIykC,CAA+Bl4B,KAAKoqB,aAAc3Q,MAC5D,CAAAzK,IAAA,SAAAkB,MAED,SAAO/hB,GAAK,IAAAgiB,EAAAnQ,KAEF4a,EAAS5a,KAAK4a,OACdnoB,EAASuN,KAAKoqB,aACdt3B,EAAIL,EAAO,GACX0lC,EAAO1lC,EAAOA,EAAOG,OAAS,GAC9BwlC,GAAap4B,KAAKs2B,YAAY,GAAK,GAAK,EAAK,GAAKkB,GAExD,GADArpC,EAAI8rB,UAAY9rB,EAAI24B,YAAc9mB,KAAKwO,gBACpCxO,KAAK03B,WAAY,CAChB,IAAMW,GAAer4B,KAAKs2B,YAAY,GAAK,GAAK,EAAK,GAAKkB,GAC1DrpC,EAAI4rB,YACJ5rB,EAAIo4B,UAAUzzB,EAAE,GAAIA,EAAE,IACtB3E,EAAImpC,OAAOe,GACXlqC,EAAI6sB,OAAO,EAAG,GACd7sB,EAAI8sB,OAAO,GAAI,GACf9sB,EAAI8sB,OAAO,EAAG,GACd9sB,EAAI8sB,OAAO,EAAG,GACd9sB,EAAIotB,OACJptB,EAAImpC,QAAQe,GACZlqC,EAAIo4B,WAAWzzB,EAAE,IAAKA,EAAE,IA0C5B,GAxCA3E,EAAI4rB,YACJ5rB,EAAI6sB,OAAOloB,EAAE,GAAIA,EAAE,IACnBL,EAAO4K,MAAM,EAAG5K,EAAOG,OAAS,GAAGuE,SAAQ,SAACrE,EAAGsE,GAC3C,GAAG+Y,EAAKyK,OAAQ,CACZ,IAEA0d,E9B4JT,SAA8BC,EAASzlC,EAAG0lC,EAAO5d,GACpD,IAAM6d,EAAO3rB,GAASha,EAAGylC,GACnBG,EAAO5rB,GAASha,EAAG0lC,GACnBG,EAAU5rB,GAAO0rB,GACjBG,EAAU7rB,GAAO2rB,GACvB,IAAIC,IAAYC,EACZ,MAAO,CACHliC,GAAI,KACJC,GAAI,MAGZ,IAAMyN,EAAK6I,GAASwrB,EAAM7d,EAAO+d,GAC3Bt0B,EAAK4I,GAASyrB,EAAM9d,EAAOge,GACjC,MAAO,CACHliC,GAAIoW,GAASha,EAAGsR,GAChBzN,GAAImW,GAASha,EAAGuR,I8B3KWw0B,CAFLpmC,EAAO2E,GAE0BtE,EADjCL,EAAO2E,EAAI,GACgCwjB,GAAjDlkB,EAAE4hC,EAAF5hC,GAAIC,EAAE2hC,EAAF3hC,GACTD,GAAMC,GACLxI,EAAI8sB,OAAOvkB,EAAG,GAAIA,EAAG,IACrBvI,EAAIs6B,iBAAiB31B,EAAE,GAAIA,EAAE,GAAI6D,EAAG,GAAIA,EAAG,KAE3CxI,EAAI8sB,OAAOnoB,EAAE,GAAIA,EAAE,SAGvB3E,EAAI8sB,OAAOnoB,EAAE,GAAIA,EAAE,OAG3B3E,EAAI8sB,OAAOkd,EAAK,GAAIA,EAAK,IAEtBn4B,KAAKo2B,WACJjoC,EAAIyB,OACJzB,EAAIkpC,YAAYr3B,KAAKo2B,WAEzBjoC,EAAI44B,SACD/mB,KAAKo2B,UACJjoC,EAAI0B,UAGJmQ,KAAK23B,UACLxpC,EAAI4rB,YACJ5rB,EAAIo4B,UAAU4R,EAAK,GAAIA,EAAK,IAC5BhqC,EAAImpC,OAAOc,GACXjqC,EAAI6sB,OAAO,EAAG,GACd7sB,EAAI8sB,QAAQ,GAAI,GAChB9sB,EAAI8sB,QAAQ,EAAG,GACf9sB,EAAI8sB,OAAO,EAAG,GACd9sB,EAAIotB,OACJptB,EAAImpC,QAAQc,GACZjqC,EAAIo4B,WAAW4R,EAAK,IAAKA,EAAK,KAE/Bn4B,KAAK4tB,QAGJ,OAFAz/B,EAAI4rB,YACJ5rB,EAAI6hC,KAAI7/B,GAAAA,OAAM6P,KAAK8tB,SAAQ,KAAA39B,OAAI6P,KAAK6tB,YAC5B7tB,KAAKiK,SACT,KAAKxB,GAAUE,OACXxa,EAAI+/B,UAAY,OAChB//B,EAAI2iC,SAAS9wB,KAAK4tB,QAAS96B,EAAE,GAAK,EAAGA,EAAE,GAAK,IAC5C,MACJ,KAAK2V,GAAUC,MACXva,EAAI+/B,UAAY,OAChB//B,EAAI2iC,SAAS9wB,KAAK4tB,QAAS96B,EAAE,GAAK,GAAIA,EAAE,GAAK,MAO5D,CAAAkc,IAAA,QAAAkB,MAED,SAAMlZ,GACF,GAAGgJ,KAAK43B,QACJ,OAAO,EAEX,IAAI53B,KAAKoqB,aACL,OAAO,EAEX,IAAM33B,EAASuN,KAAKoqB,aAChB0O,EAAQrmC,EAAO,GACbsmC,EAAetmC,EAAO4K,MAAM,GAClC,EAAG,CACC,IAAM27B,EAAWD,EAAaE,QAC9B,GAAGD,EAEC,GADapvB,GAAqB5S,EAAO8hC,EAAOE,GACtCh5B,KAAKq2B,YACX,OAAO,EAGfyC,EAAQE,QACJF,GAER,OAAO,IACV,CAAA9pB,IAAA,cAAAkB,MAED,WAAc,IAAAgpB,EACJ9mC,EAAI,IAAIqlC,EAAS,IAgBvB,OAfAntB,OAAOK,OAAOvY,GAKiBuf,EALhBunB,EAAA,CACXte,OAAQ5a,KAAK4a,OACbwP,aAAcpqB,KAAKoqB,aACnBkM,YAAat2B,KAAKs2B,YAClB9nB,gBAAiBxO,KAAKwO,gBACtBkpB,WAAY13B,KAAK03B,YAAU,SACnB13B,KAAK4a,QAAMjJ,EAAAunB,EAAA,WACTl5B,KAAKo2B,UAAQzkB,EAAAunB,EACd,UAAAl5B,KAAK23B,SAAOhmB,EAAAunB,EACZ,UAAAl5B,KAAK4tB,SAAOjc,EAAAunB,EAAA,WACXl5B,KAAK8tB,UAAQnc,EAAAunB,EAAA,aACXl5B,KAAK6tB,YAAUlc,EAAAunB,EAClB,UAAAl5B,KAAKiK,SAAO0H,EAAAunB,EACZ,WAAA,GAAIA,IAEV9mC,MACVqlC,GA9MkBvK,IC1BjBsK,GAAYxoC,KAAKoC,GAAK,IAmBtB+nC,YAAUhD,GAAAvoB,EAAAurB,EAAAhD,GAAA,IAAAtoB,EAAAC,EAAAqrB,GAKZ,SAAAA,EAAYnrB,GAAS,IAAAD,EAmBoB,OAnBpBE,OAAAkrB,IACjBprB,EAAAF,EAAAK,UAAMF,IAEDqoB,YAAgBroB,EAAQqoB,ahCJV,EgCMnBtoB,EAAK5C,SAAgB6C,EAAQ7C,UAAY,EAEzC4C,EAAK3C,SAAgB4C,EAAQ5C,UAAY,EAEzC2C,EAAKqoB,SAAgBpoB,EAAQooB,SAE7BroB,EAAK2pB,WAAgB1pB,EAAQ0pB,WAE7B3pB,EAAK8f,WAAgB7f,EAAQ6f,WAAa,6NAE1C9f,EAAK+f,SAAgB9f,EAAQ8f,UAAY,OAEzC/f,EAAK6f,QAAgB5f,EAAQ4f,SAAW,GAExC7f,EAAKxB,SAAkByB,EAAQzB,OAAMwB,EA2IxC,OArGDgB,EAAAoqB,EAAA,CAAA,CAAAnqB,IAAA,yBAAAkB,MAEA,WACI,IAAMpG,EAAU9J,KAAKQ,KAAKujB,kCACpBha,EAAQ/J,KAAKmV,GAAG4O,kCACtB,GAAG/jB,KAAKuM,OAAQ,CACZ,IAAM9Z,EAASuY,GACXlB,EAAQ9J,KAAKiK,SACbF,EAAMtB,GAAUK,MAChB9I,KAAKiK,QACLxB,GAAUE,OACV3I,KAAKmL,SACLnL,KAAKoL,UAETpL,KAAKoqB,aAAY,GAAAj6B,OAAAyb,EAAO9B,EAAQ9J,KAAKiK,UAAQ2B,EAAKnZ,IAClDuN,KAAKs2B,YAAc,CAACt2B,KAAKiK,QAASxB,GAAUE,aACzC,QAAoBpT,IAAjByK,KAAKiK,cAAwC1U,IAAfyK,KAAKmK,MAAqB,CAC9D,IAAM1X,EAASuY,GACXlB,EAAQ9J,KAAKiK,SACbF,EAAM/J,KAAKmK,OACXnK,KAAKiK,QACLjK,KAAKmK,MAAOnK,KAAKmL,SAAWnL,KAAKoL,UACrCpL,KAAKoqB,aAAY,GAAAj6B,OAAAyb,EAAO9B,EAAQ9J,KAAKiK,UAAQ2B,EAAKnZ,IAClDuN,KAAKs2B,YAAc,CAACt2B,KAAKiK,QAASjK,KAAKmK,WACpC,CACH,IAAMH,EAAOH,GAA4BC,EAASC,GAC5CtX,EAASuY,GACXhB,EAAKE,MACLF,EAAKI,IACLJ,EAAKC,QACLD,EAAKG,OAETnK,KAAKoqB,aAAYj6B,GAAAA,OAAAyb,EAAO5B,EAAKE,OAAK0B,EAAKnZ,IACvCuN,KAAKs2B,YAAc,CAACtsB,EAAKC,QAASD,EAAKG,UAE9C,CAAA6E,IAAA,SAAAkB,MAED,SAAO/hB,GACH6R,KAAK62B,yBACL,IAAMpkC,EAASuN,KAAKoqB,aACdt0B,EAAQ+V,GAAe0d,MAAM,KAAI,CAAG,GAACp5B,OAAAyb,EAAKnZ,KAEhD,GADAtE,EAAI8rB,UAAY9rB,EAAI24B,YAAc9mB,KAAKwO,gBACpCxO,KAAK03B,WAAY,CAChB,IAAMW,GAAer4B,KAAKs2B,YAAY,GAAK,GAAK,EAAK,GAAKkB,GAC1DrpC,EAAI4rB,YACJ5rB,EAAIo4B,UAAU9zB,EAAO,GAAIA,EAAO,IAChCtE,EAAImpC,OAAOe,GACXlqC,EAAI6sB,OAAO,EAAG,GACd7sB,EAAI8sB,OAAO,GAAI,GACf9sB,EAAI8sB,OAAO,EAAG,GACd9sB,EAAI8sB,OAAO,EAAG,GACd9sB,EAAIotB,OACJptB,EAAImpC,QAAQe,GACZlqC,EAAIo4B,WAAW9zB,EAAO,IAAKA,EAAO,IAuBtC,GArBAtE,EAAI4rB,YACJ5rB,EAAI6sB,OAAOvoB,EAAO,GAAIA,EAAO,IAC7BtE,EAAIirC,cAAa7P,MAAjBp7B,EAAGyd,EAAkBnZ,EAAO4K,MAAM,KAC/B2C,KAAKo2B,WACJjoC,EAAIyB,OACJzB,EAAIkpC,YAAYr3B,KAAKo2B,WAEzBjoC,EAAI44B,SACD/mB,KAAKo2B,UACJjoC,EAAI0B,UAER1B,EAAI4rB,YACJ5rB,EAAIo4B,UAAU9zB,EAAO,GAAIA,EAAO,IAChCtE,EAAImpC,OAAOxhC,GACX3H,EAAI6sB,OAAO,EAAG,GACd7sB,EAAI8sB,OAAO,GAAI,GACf9sB,EAAI8sB,OAAO,EAAG,GACd9sB,EAAI8sB,OAAO,EAAG,GACd9sB,EAAIotB,OACJptB,EAAImpC,QAAQxhC,GACZ3H,EAAIo4B,WAAW9zB,EAAO,IAAKA,EAAO,IAC/BuN,KAAK4tB,QAAS,CACbz/B,EAAI4rB,YACJ,IAAMsf,EAAU5mC,EAAO,GAAKA,EAAO,GACnC6mC,E/BDL,SAAqBlnC,EAAGmnC,GAC3B,IAAMz9B,EAAI,EAAE1J,EACNP,EAAIiK,EAAEA,EAAEA,EAAEy9B,EAAE,GAAK,EAAEz9B,EAAEA,EAAE1J,EAAEmnC,EAAE,GAAK,EAAEz9B,EAAE1J,EAAEA,EAAEmnC,EAAE,GAAKnnC,EAAEA,EAAEA,EAAEmnC,EAAE,GACvDznC,EAAIgK,EAAEA,EAAEA,EAAEy9B,EAAE,GAAK,EAAEz9B,EAAEA,EAAE1J,EAAEmnC,EAAE,GAAK,EAAEz9B,EAAE1J,EAAEA,EAAEmnC,EAAE,GAAKnnC,EAAEA,EAAEA,EAAEmnC,EAAE,GACvDp2B,EAAIrH,EAAEA,GAAGy9B,EAAE,GAAGA,EAAE,IAAM,EAAEnnC,EAAE0J,GAAGy9B,EAAE,GAAGA,EAAE,IAAMnnC,EAAEA,GAAGmnC,EAAE,GAAGA,EAAE,IACtDroC,EAAI4K,EAAEA,GAAGy9B,EAAE,GAAGA,EAAE,IAAM,EAAEnnC,EAAE0J,GAAGy9B,EAAE,GAAGA,EAAE,IAAMnnC,EAAEA,GAAGmnC,EAAE,GAAGA,EAAE,IAM5D,MAAO,CAAC1nC,EAAGC,EALC9C,KAAK8B,MAAMI,EAAGiS,I+BLEq2B,CAAY,GAAK/mC,GAAOgnC,EAAAjoB,EAAA8nB,EAAA,GAAvCznC,EAAC4nC,EAAA,GAAE3nC,EAAC2nC,EAAA,GAAE3jC,EAAK2jC,EAAA,GAChBtrC,EAAIo4B,UAAU10B,EAAGC,GACjB3D,EAAImpC,OAAOxhC,GACRujC,GACClrC,EAAImpC,OAAOtoC,KAAKoC,IAEpBjD,EAAI6hC,KAAI7/B,GAAAA,OAAM6P,KAAK8tB,SAAQ,KAAA39B,OAAI6P,KAAK6tB,YACpC1/B,EAAI+/B,UAAY,SAChB//B,EAAI2iC,SAAS9wB,KAAK4tB,QAAS,IAAKsC,SAASlwB,KAAK8tB,WAAa,IAAI,GAC5DuL,GACClrC,EAAImpC,OAAOtoC,KAAKoC,IAEpBjD,EAAImpC,QAAQxhC,GACZ3H,EAAIo4B,WAAW10B,GAAIC,MAE1B,CAAAkd,IAAA,QAAAkB,MAED,SAAMlZ,GACF,IAAIgJ,KAAKoqB,aAAc,OAAO,EAC9B,IACM3zB,E/BHP,SAAoC3D,EAAGL,GAC1C,IAEMuE,EAFC0iC,EAAOnhC,GAAMqT,EAAInZ,IAERkR,QAAQ,CAAE9R,EAAGiB,EAAE,GAAIhB,EAAGgB,EAAE,KAExC,OADU4W,GAAM5W,EAAG,CAAEkE,EAAMnF,EAAGmF,EAAMlF,I+BDnB6nC,CAA2B3iC,EADzBgJ,KAAKoqB,cAEpB,OAAO3zB,EAAOuJ,KAAKq2B,gBACtB8C,GAnKoBjM,ICYnB0M,GAAY,WACd,SAAAA,IAA0B,IAAAC,EAAd7rB,EAAOvN,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GAAEwN,OAAA2rB,GAEpB55B,KAAK85B,UAAgB9rB,EAAQ8rB,WAAa,WAE1C95B,KAAK+5B,IAA2BF,QAAxBA,EAAa7rB,EAAQ+rB,WAAGF,IAAAA,EAAAA,EAAI,EAEpC75B,KAAKg6B,UAAgBhsB,EAAQgsB,WAAa,SAE1Ch6B,KAAKi6B,QAAgBjsB,EAAQisB,SAAW,SAExCj6B,KAAKkR,YAAclD,EAqLtB,OApLAe,EAAA6qB,EAAA,CAAA,CAAA5qB,IAAA,SAAAkB,MAGD,SAAOgqB,GAAO,IAAAnsB,EAAA/N,KACJm6B,EAAQD,EAAMrmB,OAAOnY,QAAO,SAAAyT,GAAQ,OAAIA,EAASf,UAAYe,EAASgC,oBACtEipB,EAAgBF,EAAMrmB,OAAOnY,QAAO,SAAAyT,GAAQ,OAAIA,EAASf,SAAWe,EAASgC,oBAC7EkpB,EAAaH,EAAM3rC,MAAQ2rC,EAAMpiB,QAAQrpB,KAAOyrC,EAAMpiB,QAAQrZ,MACpE,GAAsB,aAAnBuB,KAAK85B,UAA0B,CAC9B,IAAIQ,EAAe,EACfC,EAAqB,EACrBnP,EAAW,EACXoP,EAAY,EACVC,EAAWN,EAAMhqC,OAAOiqC,GAC9BK,EAAStjC,SAAQ,SAACgY,EAAU/X,GACA,UAArB+X,EAASiW,UACRjW,EAAS5gB,MAAQ,EAEjB4gB,EAAS6F,wBACT7F,EAAS8G,SACT9G,EAAS6G,4BAIjBmkB,EAAMhjC,SAAQ,SAACgY,EAAU/X,GAErB,IAAAsjC,EAA0BvrB,EAASyG,uBAA3BrnB,EAAKmsC,EAALnsC,MAAOC,EAAMksC,EAANlsC,OAETurC,EAAO3iC,EAAM,EAAI2W,EAAKgsB,IAAM,EACV,eAArB5qB,EAASiW,UACRgG,EAAWp8B,KAAKgK,IAAIzK,EAAO68B,IAE/BoP,GAAchsC,EAASurC,EACvBO,GAAiB9rC,EAAO,EAAIurC,EAAMQ,EAClCA,EAAqB/rC,EAAS,EAC9B2gB,EAASiB,OAAS,CAAC,EAAGkqB,MAE1BG,EAAStjC,SAAQ,SAACgY,EAAU/X,GACxB,GAAwB,UAArB+X,EAASiW,QAERjW,EAAS6F,wBACT7F,EAAS5gB,MAAQ68B,EACjBjc,EAAS8G,cAEN,GAAwB,eAArB9G,EAASiW,QAA0B,CACzC,IAAMzb,EAAIuwB,EAAM7rB,SAAS9f,MAAQ2rC,EAAM7rB,SAASyJ,QAAQrpB,KAAOyrC,EAAM7rB,SAASyJ,QAAQrZ,MACtF0Q,EAAS6F,wBACT7F,EAAS5gB,MAAQS,KAAKgK,IAAI2Q,EAAGyhB,GAC7Bjc,EAAS8G,aAIjBmV,EAAWp8B,KAAKgK,IAAIqhC,EAAYjP,GAEhCoP,GAAsB,EACA,UAAnBx6B,KAAKg6B,WACJG,EAAMhjC,SAAQ,SAACgY,EAAU/X,GACrB,IAAQ7I,EAAU4gB,EAASyG,uBAAnBrnB,MACR4gB,EAASiB,OAAO,KAAOgb,EAAW78B,GAAS,EAC3C4gB,EAASiB,OAAO,IAAMoqB,KAIR,QAAnBx6B,KAAKg6B,WACJG,EAAMhjC,SAAQ,SAACgY,EAAU/X,GACrB,IAAQ7I,EAAU4gB,EAASyG,uBAAnBrnB,MACR4gB,EAASiB,OAAO,IAAMgb,EAAW78B,GAAS,EAC1C4gB,EAASiB,OAAO,IAAMoqB,KAGR,WAAnBx6B,KAAKg6B,WACJG,EAAMhjC,SAAQ,SAACgY,EAAU/X,GACH+X,EAASyG,uBAAnBrnB,MACR4gB,EAASiB,OAAO,IAAMoqB,KAIlC,GAAsB,eAAnBx6B,KAAK85B,UAA4B,CAChC,IAAIa,EAAc,EACdC,EAAoB,EACpBvP,EAAY,EACZwP,EAAW,EAaf,GAVAV,EAAMhjC,SAAQ,SAACgY,EAAU/X,GACrB,IAAA0jC,EAA0B3rB,EAASyG,uBAA3BrnB,EAAKusC,EAALvsC,MAAOC,EAAMssC,EAANtsC,OACTurC,EAAO3iC,EAAM,EAAI2W,EAAKgsB,IAAM,EAClC1O,EAAYr8B,KAAKgK,IAAIxK,EAAQ68B,GAC7BwP,GAAatsC,EAAMwrC,EAEnBY,GAAgBpsC,EAAM,EAAIwrC,EAAMa,EAChCA,EAAoBrsC,EAAQ,EAC5B4gB,EAASiB,OAAS,CAACuqB,EAAa,MAEhB,UAAjB36B,KAAKi6B,QAAqB,CACzB,IAAMc,EAAWV,EAAW,EAC5BF,EAAMhjC,SAAQ,SAACgY,EAAU/X,GACrB+X,EAASiB,OAAO,IAAM2qB,KAG9B,GAAoB,QAAjB/6B,KAAKi6B,QAAmB,CACvB,IAAMc,EAAWV,EAAW,EAAIQ,EAChCV,EAAMhjC,SAAQ,SAACgY,EAAU/X,GACrB+X,EAASiB,OAAO,IAAM2qB,KAG9B,GAAoB,WAAjB/6B,KAAKi6B,QAAsB,CAC1B,IAAMc,EAAWF,EAAW,EAC5BV,EAAMhjC,SAAQ,SAACgY,EAAU/X,GACrB+X,EAASiB,OAAO,IAAM2qB,KAG9B,GAAoB,kBAAjB/6B,KAAKi6B,SAA+BE,EAAMvnC,OAAS,EAAG,CAErD,IAAMrE,EAAQS,KAAKgK,IAAIqhC,EAAYQ,GAC7BG,GAAczsC,EAAQssC,IAAaV,EAAMvnC,OAAS,GAClDmoC,EAAWxsC,EAAM,EACvB4rC,EAAMhjC,SAAQ,SAACgY,EAAU/X,GACrB+X,EAASiB,OAAO,IAAQ4qB,EAAa5jC,EAAO2jC,KAG9B,UAAnB/6B,KAAKg6B,WACJG,EAAMhjC,SAAQ,SAACgY,EAAU/X,GACrB,IAAQ5I,EAAW2gB,EAASyG,uBAApBpnB,OACR2gB,EAASiB,OAAO,KAAOib,EAAY78B,GAAU,KAG/B,QAAnBwR,KAAKg6B,WACJG,EAAMhjC,SAAQ,SAACgY,EAAU/X,GACrB,IAAQ5I,EAAW2gB,EAASyG,uBAApBpnB,OACR2gB,EAASiB,OAAO,IAAMib,EAAY78B,GAAU,KAKxD,GAAG4rC,EAAcxnC,OAAQ,CACA,UAAlBsnC,EAAM9U,QACL8U,EAAMtkB,uBAENskB,EAAMlkB,wBAEV,IAAMilB,EAAQf,EAAM3rC,MAAO,EACrB2sC,EAAShB,EAAM1rC,OAAQ,EACvB2sC,GAAUjB,EAAMpiB,QAAQppB,IAAMwrC,EAAMpiB,QAAQvgB,QAAQ,EACpD6jC,GAAUlB,EAAMpiB,QAAQrpB,KAAOyrC,EAAMpiB,QAAQrZ,OAAO,EAC1D27B,EAAcjjC,SAAQ,SAAAgY,GAClBA,EAASiB,OAASrC,EAAKstB,uBAAuBlsB,EAASgC,iBAAkBhC,EAAU8rB,EAAOC,EAAQE,EAAQD,SAGrH,CAAAnsB,IAAA,yBAAAkB,MAED,SAAuBorB,EAAQnsB,EAAUxF,EAAG6R,EAAG4f,EAAQD,GACnD,IAAQzsC,EAA+C4sC,EAA/C5sC,IAAK+P,EAA0C68B,EAA1C78B,MAAOlH,EAAmC+jC,EAAnC/jC,OAAQ9I,EAA2B6sC,EAA3B7sC,KAAM6zB,EAAqBgZ,EAArBhZ,QAASC,EAAY+Y,EAAZ/Y,QAC3CgZ,EAA0BpsB,EAASyG,uBAC7BmT,EADOwS,EAALhtC,MACW,EACby6B,EAFeuS,EAAN/sC,OAEK,EAChBsD,EAAI,EACJD,EAAI,EAmBR,MAlBkB,iBAARnD,IACNoD,EAAIpD,EAAMs6B,EAAKxN,EAAI2f,GAEH,iBAAV18B,IACN5M,EAAI8X,EAAIlL,EAAQsqB,EAAKqS,GAEJ,iBAAX7jC,IACNzF,EAAI0pB,EAAIjkB,EAASyxB,EAAKmS,GAEP,iBAAT1sC,IACNoD,EAAIpD,EAAOs6B,EAAKpf,EAAIyxB,GAEF,iBAAZ9Y,IACNzwB,EAAIywB,GAEc,iBAAZC,IACNzwB,EAAIywB,GAED,CAAC1wB,EAAGC,KACd,CAAAkd,IAAA,QAAAkB,MAED,WACI,OAAO,IAAI0pB,EAAa55B,KAAKkR,iBAChC0oB,EAhMa,GChCZ4B,GAAQ,WACV,SAAAA,EAAYzpB,GAAQ9D,OAAAutB,GAChBx7B,KAAK+R,OAASA,EACd/R,KAAKy7B,GAAK1pB,EAAO0pB,GACjBz7B,KAAK2mB,KAAO5U,EAAO4U,KAGnB3mB,KAAK07B,WAAQnmC,EACbyK,KAAK27B,cAAWpmC,EAEhByK,KAAK47B,QAAS,EACd57B,KAAK67B,YAAStmC,EACdyK,KAAK5I,SAAM7B,EACXyK,KAAK87B,uBAAoBvmC,EAEzByK,KAAK+7B,aAAc,EA6CtB,OA3CAhtB,EAAAysB,EAAA,CAAA,CAAAxsB,IAAA,qBAAAkB,MAED,WAAsD,IAAnCwrB,EAAKj7B,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EAAGk7B,EAAQl7B,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EAAG1Q,EAAQ0Q,UAAA7N,OAAA6N,EAAAA,kBAAAlL,EAQhD,OAPAyK,KAAK07B,MAAQA,EACb17B,KAAK27B,SAAWA,EAChB37B,KAAKg8B,MAAQ,EACbh8B,KAAKi8B,MAAQ,EACVlsC,GACCA,EAAS2rC,EAAOC,EAAU37B,MAEvB,CACHg8B,MAAOh8B,KAAKg8B,MACZC,MAAOj8B,KAAKi8B,MACZP,MAAAA,EAAOC,SAAAA,KAEd,CAAA3sB,IAAA,WAAAkB,MAED,SAASngB,GACL,OAAOiQ,OACV,CAAAgP,IAAA,eAAAkB,MAED,cAAkB,CAAAlB,IAAA,WAAAkB,MAElB,SAASngB,GACLA,EAASiQ,QACZ,CAAAgP,IAAA,WAAAkB,MAED,SAASL,GACL,IAAMqsB,EAAQ,GAMd,OALAl8B,KAAKm8B,UAAS,SAAA7kC,GACV,IAAM8kC,EAAavsB,EAAM6C,sBAAsBpb,EAAEya,QAC9CqqB,GACCF,EAAM3nC,KAAK6nC,MAEZF,IACV,CAAAltB,IAAA,aAAAkB,MAED,SAAW6B,GACP/R,KAAK67B,OAAO9pB,OAAO/R,KAAK87B,mBAAmBpoC,OAAOsM,KAAK5I,IAAM,EAAG,EAAG2a,KACtE,CAAA/C,IAAA,SAAAkB,MAED,WACIlQ,KAAK67B,OAAO9pB,OAAO/R,KAAK87B,mBAAmBpoC,OAAOsM,KAAK5I,IAAK,OAC/DokC,EA5DS,GA+DRa,YAAIC,GAAA1uB,EAAAyuB,EAAAC,GAAA,IAAAzuB,EAAAC,EAAAuuB,GACN,SAAAA,EAAYtqB,GAAQ,IAAAhE,EAAAE,OAAAouB,IAChBtuB,EAAAF,EAAAK,UAAM6D,IACDwqB,QAAS,EACdxuB,EAAKyuB,MAAQzqB,EAAOyqB,MAAQ,IAAIznC,IAAI0nC,GAAQ,QAAQv5B,KAAIiL,EAAAJ,KACxD,IAAM2uB,EAAqBD,GAAQ,cAAcv5B,KAAIiL,EAAAJ,IAKlD,OAJHA,EAAK4uB,YAAc5qB,EAAO4qB,YAAc,IAAI5nC,KAAI,SAACU,EAAG2B,GAChD,IAAME,EAAIolC,EAAmBjnC,EAAG2B,GAEhC,OADAE,EAAEskC,QAAS,EACJtkC,KACRyW,EAkEN,OAjEAgB,EAAAstB,EAAA,CAAA,CAAArtB,IAAA,yBAAAkB,MAED,WAA0D,IAAnCwrB,EAAKj7B,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EAAGk7B,EAAQl7B,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EAAG1Q,EAAQ0Q,UAAA7N,OAAA6N,EAAAA,kBAAAlL,EAChDymC,EAAQ,EACRC,EAAQ,EAeZ,OAdAj8B,KAAK07B,MAAQA,EACb17B,KAAK27B,SAAWA,EACb5rC,GACCA,EAAS2rC,EAAOC,EAAU37B,MAE9BA,KAAKw8B,KAAKrlC,SAAQ,SAAClE,GACf,IAAA2pC,EAAiC3pC,EAAE4pC,mBAAmBnB,EAAQ,EAAGC,EAAU5rC,GAA5D+b,EAAE8wB,EAATZ,MAAkBjwB,EAAE6wB,EAATX,MACnBD,EAAQhtC,KAAKgK,IAAI8S,EAAIkwB,GACrBC,GAASlwB,EACT2vB,GAAS3vB,KAGb/L,KAAKg8B,MAAQA,EACbh8B,KAAKi8B,MAAQA,EACN,CACHD,MAAAA,EAAOC,MAAAA,EAAOP,MAAAA,EAAOC,SAAAA,KAE5B,CAAA3sB,IAAA,+BAAAkB,MAED,SAA6B4sB,EAAa/sC,GACtCiQ,KAAK28B,WAAWxlC,SAAQ,SAAA4lC,GACpBD,EAAYC,GACZA,EAAKF,mBAAmB,EAAG,EAAG9sC,QAErC,CAAAif,IAAA,WAAAkB,MAGD,SAASngB,GACL,IAAI0S,EAqBJ,OApBAzC,KAAKw8B,KAAKrlC,SAAQ,SAAAlE,GACVwP,GAIJ1S,EAAS,CACLyQ,KAAMiC,EACN0S,GAAIliB,EACJ+pC,KAAM,OACN/yB,QAASxB,GAAUE,OACnBwB,MAAO1B,GAAUI,MAGrB5V,EAAIA,EAAEgqC,SAASltC,GACf0S,EAAOxP,GAZHwP,EAAOxP,KAef+M,KAAK28B,WAAWxlC,SAAQ,SAAAG,GACpBA,EAAE2lC,SAASltC,MAERiQ,OACV,CAAAgP,IAAA,WAAAkB,MAED,SAASngB,GACLiQ,KAAKw8B,KAAKrlC,SAAQ,SAAAG,GACdA,EAAE6kC,SAASpsC,MAGfiQ,KAAK28B,WAAWxlC,SAAQ,SAAAG,GACpBA,EAAE6kC,SAASpsC,UAElBssC,GA5Ecb,IA+Eb0B,YAAWC,GAAAvvB,EAAAsvB,EAAAC,GAAA,IAAAhS,EAAArd,EAAAovB,GACb,SAAAA,EAAYnrB,GAAQ,IAAA5B,EAKQ,OALRlC,OAAAivB,IAChB/sB,EAAAgb,EAAAjd,UAAM6D,IACDqrB,YAAcrrB,EAAOqrB,YAAc,IAAIroC,IAAI0nC,GAAQ,cAAcv5B,KAAIiL,EAAAgC,KAC1EA,EAAKktB,WAAatrB,EAAOsrB,WAAa,IAAItoC,IAAI0nC,GAAQ,aAAav5B,KAAIiL,EAAAgC,KACvEA,EAAKmtB,UAAW,EAChBntB,EAAK4rB,aAAc,EAAK5rB,EAiH3B,OAhHApB,EAAAmuB,EAAA,CAAA,CAAAluB,IAAA,qBAAAkB,MAED,WAAsD,IAAnCwrB,EAAKj7B,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EAAGk7B,EAAQl7B,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EAAG1Q,EAAQ0Q,UAAA7N,OAAA6N,EAAAA,kBAAAlL,EAC5CymC,EAAQ,EACRC,EAAQ,EACZj8B,KAAK07B,MAAQA,EACb17B,KAAK27B,SAAWA,EACb5rC,GACCA,EAAS2rC,EAAOC,EAAU37B,MAE9B,IAAIu9B,EAAU,EACVC,EAAU,EACVC,EAAU,EACVC,EAAU,EACd19B,KAAKo9B,WAAWjmC,SAAQ,SAACjE,EAAGkE,GACxB,IAAAumC,EAAiCzqC,EAAE2pC,mBAAmBnB,EAAQ,EAAGC,EAAU5rC,GAA5D+b,EAAE6xB,EAAT3B,MAAkBjwB,EAAE4xB,EAAT1B,MACnBsB,EAAUvuC,KAAKgK,IAAIukC,EAASzxB,GAC5B0xB,GAAWzxB,EACX2vB,GAAS3vB,KAEb,IAAM6xB,EAAgBjC,EAAW4B,EACjC7B,EAAQ17B,KAAK07B,MACb17B,KAAKq9B,UAAUlmC,SAAQ,SAACnE,EAAGoE,GACvB,IAAAymC,EAAiC7qC,EAAE6pC,mBAAmBnB,EAAQ,EAAGkC,EAAe7tC,GAAjE+b,EAAE+xB,EAAT7B,MAAkBjwB,EAAE8xB,EAAT5B,MACnBwB,EAAUzuC,KAAKgK,IAAIykC,EAAS3xB,GAC5B4xB,GAAW3xB,EACX2vB,GAAS3vB,KAEbiwB,EAAQhtC,KAAKgK,IAAI,EAAGukC,EAAUE,GAC9BxB,GAASjtC,KAAKgK,IAAIwkC,EAASE,GAC3BhC,EAAQ17B,KAAK07B,MAAQO,EAAQ,EAC7B,IAAA6B,EAAsB99B,KAAK+9B,SAASlB,mBAAmBnB,EAAQ,EAAGC,EAAU5rC,GAA7Dgc,EAAE+xB,EAAT7B,MAIR,OAHAA,GAASlwB,EACT/L,KAAKg8B,MAAQA,EACbh8B,KAAKi8B,MAAQA,EACN,CACHD,MAAAA,EAAOC,MAAAA,EAAOP,MAAAA,EAAOC,SAAAA,KAE5B,CAAA3sB,IAAA,WAAAkB,MAED,SAASngB,GAAU,IAAAy7B,EAAAxrB,KACXg+B,EAAQh+B,KACZA,KAAKo9B,WAAWjmC,SAAQ,SAAAjE,GACpBnD,EAAS,CACLyQ,KAAMw9B,EACN7oB,GAAIjiB,EACJ8pC,KAAM,aACN/yB,QAASxB,GAAUE,OACnBwB,MAAO1B,GAAUI,MAGrB3V,EAAIA,EAAE+pC,SAASltC,GACfiuC,EAAQ9qC,KAGZnD,EAAS,CACLyQ,KAAMw9B,EACN7oB,GAAInV,KAAK+9B,SACT9zB,QAASxB,GAAUE,OACnBwB,MAAO1B,GAAUI,IACjBm0B,KAAM,eAGV,IAAIiB,EAAQj+B,KAoBZ,OAnBAA,KAAKq9B,UAAUlmC,SAAQ,SAAAnE,GACnBjD,EAAS,CACLyQ,KAAMy9B,EACN9oB,GAAIniB,EACJiX,QAASg0B,IAAUzS,EAAO/iB,GAAUC,MAAQD,GAAUE,OACtDwB,MAAO1B,GAAUI,IACjBm0B,KAAM,cAEVhqC,EAAIA,EAAEiqC,SAASltC,GACfkuC,EAAQjrC,KAEZjD,EAAS,CACLyQ,KAAMy9B,EACN9oB,GAAInV,KAAK+9B,SACT9zB,QAASg0B,IAAUj+B,KAAOyI,GAAUC,MAAQD,GAAUE,OACtDwB,MAAO1B,GAAUC,MACjBs0B,KAAM,cAGHh9B,KAAK+9B,WAahB,CAAA/uB,IAAA,WAAAkB,MAEA,SAASngB,GACLA,EAASiQ,MACTA,KAAKo9B,WAAWjmC,SAAQ,SAAAG,GACpBA,EAAE6kC,SAASpsC,MAEfiQ,KAAKq9B,UAAUlmC,SAAQ,SAAAG,GACnBA,EAAE6kC,SAASpsC,MAEfM,QAAQC,IAAI0P,KAAK+9B,UACjBhuC,EAASiQ,KAAK+9B,YACjB,CAAA/uB,IAAA,aAAAkB,MAED,SAAW6B,EAAQmsB,GACfl+B,KAAK+R,OAAOmsB,EAASlB,MAAMnwB,QAAQkF,OACtCmrB,GAvHqB1B,IA0HpB2C,YAAeC,GAAAxwB,EAAAuwB,EAAAC,GAAA,IAAAC,EAAAvwB,EAAAqwB,GACjB,SAAAA,EAAYpsB,GAAQ,IAAA6Z,EAOQ,OAPR3d,OAAAkwB,IAChBvS,EAAAyS,EAAAnwB,UAAM6D,IACDusB,OAASvsB,EAAOusB,OAAS,IAAIvpC,IAAI0nC,GAAQ,QAAQv5B,KAAIiL,EAAAyd,KACvDA,EAAK0S,MAAM1rC,SACVg5B,EAAK0S,MAAM1S,EAAK0S,MAAM1rC,OAAS,GAAG2rC,UAAW,GAEjD3S,EAAK0R,UAAW,EAChB1R,EAAKmQ,aAAc,EAAKnQ,EA4I3B,OA3IA7c,EAAAovB,EAAA,CAAA,CAAAnvB,IAAA,qBAAAkB,MAED,WAAsD,IAAA6gB,EAAA/wB,KAAnC07B,EAAKj7B,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EAAGk7B,EAAQl7B,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EAAG1Q,EAAQ0Q,UAAA7N,OAAA6N,EAAAA,kBAAAlL,EAC5CymC,EAAQ,EACRC,EAAQ,EACZj8B,KAAK07B,MAAQA,EACb17B,KAAK27B,SAAWA,EACb5rC,GACCA,EAAS2rC,EAAOC,EAAU37B,MAG9B,IAAIu9B,EAAU,EACVC,EAAU,EACd,GAAGx9B,KAAKs+B,MAAM1rC,OAAQ,CAClB,IAAMwqC,EAAap9B,KAAKs+B,MAAMt+B,KAAKs+B,MAAM1rC,OAAS,GAAGwqC,WACrD1B,EAAQ17B,KAAK07B,MACb0B,EAAWjmC,SAAQ,SAAAqnC,GACf,IAAAC,EAAiCD,EAAG3B,mBAAmBnB,EAAQ,EAAGC,EAAU5rC,GAA7D+b,EAAE2yB,EAATzC,MAAkBjwB,EAAE0yB,EAATxC,MACnBsB,EAAUvuC,KAAKgK,IAAIukC,EAASzxB,GAC5B0xB,GAAWzxB,EACX2vB,GAAS3vB,KAKjB,IAAI2yB,EAAUnB,EACVoB,EAAU,EACd3+B,KAAKs+B,MAAMnnC,SAAQ,SAACjE,EAAGkE,GACnB,IAAMwmC,EAAgBjC,EAAW+C,EAC7BjB,EAAU,EACVC,EAAU,EACdhC,EAAQ3K,EAAK2K,MACbxoC,EAAEmqC,UAAUlmC,SAAQ,SAAA2pB,GAChB,IAAA8d,EAAiC9d,EAAG+b,mBAAmBnB,EAAQ,EAAGkC,EAAe7tC,GAAlE+b,EAAE8yB,EAAT5C,MAAkBjwB,EAAE6yB,EAAT3C,MACnBwB,EAAUzuC,KAAKgK,IAAIykC,EAAS3xB,GAC5B4xB,GAAW3xB,EACX2vB,GAAS3vB,KAEb2yB,GAAWjB,EACXkB,EAAU3vC,KAAKgK,IAAI2lC,EAASjB,MAIhC1B,EAAQhtC,KAAKgK,IAAI,EAAG0lC,GACpBzC,EAAQjtC,KAAKgK,IAAIwkC,EAASmB,GAC1BjD,EAAQ17B,KAAK07B,MAAQO,EACrB,IAAA4C,EAAsB7+B,KAAK+9B,SAASlB,mBAAmBnB,EAAQ,EAAGC,EAAU5rC,GAA7Dgc,EAAE8yB,EAAT5C,MAKR,OAJAA,GAASlwB,EACTkwB,GAAS,EACTj8B,KAAKg8B,MAAQA,EACbh8B,KAAKi8B,MAAQA,EACN,CACHD,MAAAA,EAAOC,MAAAA,EAAOP,MAAAA,EAAOC,SAAAA,KAE5B,CAAA3sB,IAAA,WAAAkB,MAED,SAASngB,GAAU,IAAAkiC,EAAAjyB,KACXg+B,EAAQh+B,KACTA,KAAKs+B,MAAM1rC,QACSoN,KAAKs+B,MAAMt+B,KAAKs+B,MAAM1rC,OAAS,GAAGwqC,WAC1CjmC,SAAQ,SAACjE,EAAGkE,GACnBrH,EAAS,CACLyQ,KAAMw9B,EACN7oB,GAAIjiB,EACJ+W,QAASxB,GAAUE,OACnBwB,MAAO1B,GAAUI,IACjBm0B,KAAM,eAEVgB,EAAQ9qC,EAAE+pC,SAASltC,MAmC3B,OAhCAM,QAAQC,IAAI0tC,GACZjuC,EAAS,CACLyQ,KAAMw9B,EACN7oB,GAAInV,KAAK+9B,SACT9zB,QAASxB,GAAUE,OACnBwB,MAAO1B,GAAUI,IACjBm0B,KAAM,eAGVh9B,KAAKs+B,MAAMnnC,SAAQ,SAACjE,EAAGkE,GACnB,IAAI6mC,EAAQ/qC,EACZA,EAAEmqC,UAAUlmC,SAAQ,SAAAnE,GAChBjD,EAAS,CACLyQ,KAAMy9B,EACN9oB,GAAIniB,EACJiX,QAASg0B,IAAU/qC,EAAIuV,GAAUC,MAAQD,GAAUE,OACnDwB,MAAO1B,GAAUI,IACjBm0B,KAAM,cAEViB,EAAQjrC,EAAEiqC,SAASltC,MAGvBA,EAAS,CACLyQ,KAAMy9B,EACN9oB,GAAI8c,EAAK8L,SACT9zB,QAASg0B,IAAU/qC,EAAIuV,GAAUC,MAAQD,GAAUE,OACnDwB,MAAO1B,GAAUC,MACjBs0B,KAAM,YACN7xB,SAAU,IAAM/T,EAAM,QAIvB4I,KAAK+9B,WAWhB,CAAA/uB,IAAA,WAAAkB,MAEA,SAASngB,GACLA,EAASiQ,MACTA,KAAKs+B,MAAMnnC,SAAQ,SAAAG,GACfA,EAAE6kC,SAASpsC,MAEfA,EAASiQ,KAAK+9B,YACjB,CAAA/uB,IAAA,WAAAkB,MAED,SAASL,GACL,IAAMqsB,EAAQ,GAOd,OANAl8B,KAAKm8B,UAAS,SAAA7kC,GACV,GAAc,eAAXA,EAAEqvB,KAAL,CACA,IAAMyV,EAAavsB,EAAM6C,sBAAsBpb,EAAEya,QAC9CqqB,GACCF,EAAM3nC,KAAK6nC,OAEZF,IACV,CAAAltB,IAAA,aAAAkB,MAED,SAAW6B,EAAQmsB,GACf,IAAMI,EAAQt+B,KAAK+R,OAAOusB,MACPA,EAAMA,EAAM1rC,OAAS,GAAGwqC,WAChCvwB,QAAQkF,OACtBosB,GApJyB3C,IAuJxBsD,YAAgBC,GAAAnxB,EAAAkxB,EAAAC,GAAA,IAAAC,EAAAlxB,EAAAgxB,GAAA,SAAAA,IAAA,OAAA7wB,OAAA6wB,GAAAE,EAAAzV,MAAAvpB,KAAAS,WAAA,OAAAsO,EAAA+vB,IAAStD,IAIzByD,YAAcC,GAAAtxB,EAAAqxB,EAAAC,GAAA,IAAAC,EAAArxB,EAAAmxB,GAChB,SAAAA,EAAYltB,GAAQ,IAAAwgB,EAGI,OAHJtkB,OAAAgxB,IAChB1M,EAAA4M,EAAAjxB,UAAM6D,IACDyqB,MAAQzqB,EAAOyqB,MAAQ,IAAIznC,IAAI0nC,GAAQ,QAAQv5B,KAAIiL,EAAAokB,KACxDA,EAAK+K,UAAW,EAAI/K,EAiEvB,OAhEAxjB,EAAAkwB,EAAA,CAAA,CAAAjwB,IAAA,qBAAAkB,MAED,WAAsD,IAAnCwrB,EAAKj7B,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EAAGk7B,EAAQl7B,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EAAG1Q,EAAQ0Q,UAAA7N,OAAA6N,EAAAA,kBAAAlL,EAC5CymC,EAAQ,EACRC,EAAQ,EACZj8B,KAAK07B,MAAQA,EACb17B,KAAK27B,SAAWA,EACb5rC,GACCA,EAAS2rC,EAAOC,EAAU37B,MAE9B,IAAM49B,EAAgBjC,EAAW,EAWjC,OATA37B,KAAKw8B,KAAKrlC,SAAQ,SAAClE,GACf,IAAAmsC,EAAiCnsC,EAAE4pC,mBAAmBnB,EAAQ,EAAGkC,EAAe7tC,GAAjE+b,EAAEszB,EAATpD,MAAkBjwB,EAAEqzB,EAATnD,MACnBD,EAAQhtC,KAAKgK,IAAI8S,EAAIkwB,GACrBC,GAASlwB,EACT2vB,GAAS3vB,KAGb/L,KAAKg8B,MAAQA,EAAQ,EACrBh8B,KAAKi8B,MAAQA,EACN,CACHD,MAAAA,EAAOC,MAAAA,EAAOP,MAAAA,EAAOC,SAAAA,KAE5B,CAAA3sB,IAAA,WAAAkB,MAED,SAASngB,GAAU,IAAAgkC,EAAA/zB,KACXyC,EAAOzC,KAyBX,OAvBAA,KAAKw8B,KAAKrlC,SAAQ,SAAClE,EAAGmE,GAClBrH,EAAS,CACLyQ,KAAMiC,EACN0S,GAAIliB,EACJ+pC,KAAM,OACN/yB,QAASxH,IAASsxB,EAAOtrB,GAAUC,MAAOD,GAAUE,OACpDwB,MAAO1B,GAAUI,MAGrB5V,EAAIA,EAAEgqC,SAASltC,GACf0S,EAAOxP,KAEXlD,EAAS,CACLyQ,KAAMiC,EACN0S,GAAInV,KACJg9B,KAAM,OACN/yB,QAASxH,IAASzC,KAAOyI,GAAUC,MAAQD,GAAUE,OACrD02B,UAAW58B,IAASzC,KACpBmK,MAAO1B,GAAUE,OACjB4D,QAAQ,EACRpB,SAAU,GACVC,SAAU,KAEPpL,OACV,CAAAgP,IAAA,WAAAkB,MAED,SAASngB,GACLA,EAASiQ,MACTA,KAAKw8B,KAAKrlC,SAAQ,SAAAG,GACdA,EAAE6kC,SAASpsC,QAElB,CAAAif,IAAA,aAAAkB,MAED,SAAW6B,EAAQmsB,GACfl+B,KAAK+R,OAAOmsB,EAASlB,MAAMnwB,QAAQkF,OACtCktB,GArEwBzD,IAwEvB8D,YAAUC,GAAA3xB,EAAA0xB,EAAAC,GAAA,IAAAC,EAAA1xB,EAAAwxB,GACZ,SAAAA,EAAYvtB,GAAQ,IAAA0tB,EAIM,OAJNxxB,OAAAqxB,IAChBG,EAAAD,EAAAtxB,UAAM6D,IACDqrB,YAAcrrB,EAAOqrB,YAAc,IAAIroC,IAAI0nC,GAAQ,cAAcv5B,KAAIiL,EAAAsxB,KAC1EA,EAAKpC,WAAatrB,EAAOsrB,WAAa,IAAItoC,IAAI0nC,GAAQ,aAAav5B,KAAIiL,EAAAsxB,KACvEA,EAAKlB,UAAW,EAAMkB,EAyD1B,OAxDC1wB,EAAAuwB,EAAA,CAAA,CAAAtwB,IAAA,qBAAAkB,MAED,WAAsD,IAAnCwrB,EAAKj7B,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EAAGk7B,EAAQl7B,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EAAG1Q,EAAQ0Q,UAAA7N,OAAA6N,EAAAA,kBAAAlL,EAC5CymC,EAAQ,EACRC,EAAQ,EACZj8B,KAAK07B,MAAQA,EACb17B,KAAK27B,SAAWA,EACb5rC,GACCA,EAAS2rC,EAAOC,EAAU37B,MAG9B,IAAIu9B,EAAU,EACVC,EAAU,EACVC,EAAU,EACVC,EAAU,EACX19B,KAAKu+B,UACJv+B,KAAKo9B,WAAWjmC,SAAQ,SAACjE,EAAGkE,GACxB,IAAAsoC,EAAiCxsC,EAAE2pC,mBAAmBnB,EAAQ,EAAGC,EAAU5rC,GAA5D+b,EAAE4zB,EAAT1D,MAAkBjwB,EAAE2zB,EAATzD,MACnBsB,EAAUvuC,KAAKgK,IAAIukC,EAASzxB,GAC5B0xB,GAAWzxB,EACX2vB,GAAS3vB,KAIjB,IAAM6xB,EAAgBjC,EAAW3sC,KAAKgK,IAAIukC,EAAS,GAanD,OAZA7B,EAAQ17B,KAAK07B,MACb17B,KAAKq9B,UAAUlmC,SAAQ,SAACnE,EAAGoE,GACvB,IAAAuoC,EAAiC3sC,EAAE6pC,mBAAmBnB,EAAQ,EAAGkC,EAAe7tC,GAAjE+b,EAAE6zB,EAAT3D,MAAkBjwB,EAAE4zB,EAAT1D,MACnBwB,EAAUzuC,KAAKgK,IAAIykC,EAAS3xB,GAC5B4xB,GAAW3xB,EACX2vB,GAAS3vB,KAEbiwB,EAAQhtC,KAAKgK,IAAI,EAAGukC,EAAUE,GAC9BxB,GAASjtC,KAAKgK,IAAIwkC,EAASE,GAE3B19B,KAAKg8B,MAAQA,EACbh8B,KAAKi8B,MAAQA,EACN,CACHD,MAAAA,EAAOC,MAAAA,EAAOP,MAAAA,EAAOC,SAAAA,KAE5B,CAAA3sB,IAAA,WAAAkB,MAED,SAASngB,GACLA,EAASiQ,MACTA,KAAKo9B,WAAWjmC,SAAQ,SAAAG,GACpBA,EAAE6kC,SAASpsC,MAEfiQ,KAAKq9B,UAAUlmC,SAAQ,SAAAG,GACnBA,EAAE6kC,SAASpsC,QAElB,CAAAif,IAAA,aAAAkB,MAED,SAAW6B,EAAQmsB,GACfl+B,KAAK+R,OAAOmsB,EAASlB,MAAMnwB,QAAQkF,OAGvCutB,GA9DqB9D,IAiEnBoE,GAAe,CACjB1C,YAAAA,GACAiB,gBAAAA,GACAmB,WAAAA,GACAR,iBAAAA,GACAG,eAAAA,GACA5C,KAAAA,GACAwD,MAAOrE,IAGX,SAASiB,GAAQ9V,GACb,OAAO,SAASrvB,EAAGF,GACf,IAAMtE,EAAIgtC,GAAQxoC,GAMlB,GALAxE,EAAE+oC,OAAS77B,KACXlN,EAAEsE,IAAMA,EACRtE,EAAEgpC,kBAAoBnV,EAGnB7zB,EAAEipC,YAAa,CACVzkC,EAAEyoC,eACFzoC,EAAEyoC,aAAe,CACbpZ,KAAM,WACN8U,GAAEtrC,GAAAA,OAAK2C,EAAE2oC,GAAE,eAGnB,IAAM97B,EAAImgC,GAAQxoC,EAAEyoC,cACpBpgC,EAAEk8B,OAAS77B,KACXL,EAAEvI,IAAMA,EACRuI,EAAEm8B,kBAAoBnV,EACtB7zB,EAAEirC,SAAWp+B,EAEjB,OAAO7M,GAGf,SAASgtC,GAAQ/tB,GACb,IAAM4U,EAAO5U,EAAO4U,KAGpB,OADa,IADOiZ,GAAajZ,IAASiZ,GAAaC,OAC1B9tB,GChlBjC,SAAStI,GAAI5X,GACT,OAAOA,EAAIA,EA8BTmuC,IAAAA,GAAa,WACf,SAAAA,EAAYhyB,GAAS,IAAAiyB,EAAAhyB,OAAA+xB,GAEjBhgC,KAAKkgC,WAAalyB,EAAQkyB,YAAc,GAExClgC,KAAK+5B,IAAM/rB,EAAQ+rB,KAAO,GAE1B/5B,KAAKmgC,kBAA6CF,QAA5BA,EAAGjyB,EAAQmyB,yBAAiBF,IAAAA,GAAAA,EAClDjgC,KAAKogC,QAAQpyB,EAAQqyB,KAErBrgC,KAAI,QAAU,EAoKjB,OAlKD+O,EAAAixB,EAAA,CAAA,CAAAhxB,IAAA,UAAAkB,MAIA,SAAQmwB,GAAK,IAAAtyB,EAAA/N,KACTA,KAAKqgC,IAAMA,EACXrgC,KAAKsgC,UAAY,GACjBtgC,KAAKugC,cAAgB,GAErBvgC,KAAKwgC,KAAOV,GAAQ9/B,KAAKqgC,KACzBrgC,KAAKwgC,KAAKrE,UAAS,SAACY,GACc,eAA3BA,EAAKjB,oBACJiB,EAAK0D,YAAc1yB,EAAKoyB,mBAE5BpyB,EAAKuyB,UAAU/rC,KAAK,CAChBoyB,KAAMoW,EAAKpW,KACX5U,OAAQgrB,EAAKhrB,OACbC,WAAY+qB,OAIpB,IAmBI2D,EAnBEC,EAAgB,CAClBC,SAAU,GACVC,WAAY,IAEVC,EAA0B,GAChC9gC,KAAKwgC,KAAKO,uBAAuB,EAAG,GAAG,SAACrF,EAAOC,EAAUoB,GACjDA,EAAKR,SACDoE,EAAcC,SAASlF,KACvBiF,EAAcC,SAASlF,GAAS,IAEpCiF,EAAcC,SAASlF,GAAOC,GAAYoB,EAEtC4D,EAAcE,WAAWlF,KACzBgF,EAAcE,WAAWlF,GAAY,IAEzCgF,EAAcE,WAAWlF,GAAUD,GAASqB,MAKpD/8B,KAAKwgC,KAAKQ,8BACN,SAACC,GACGP,EAAmBO,EAAQxF,GAC3BqF,EAAwBG,EAAQxF,IAAM,CAClCmF,SAAU,GACVC,WAAY,GACZ9D,KAAMkE,MAGd,SAACvF,EAAOC,EAAUoB,GACd,IAAM4D,EAAgBG,EAAwBJ,GAC1CC,EAAcC,SAASlF,KACvBiF,EAAcC,SAASlF,GAAS,IAEpCiF,EAAcC,SAASlF,GAAOC,GAAYoB,EAEtC4D,EAAcE,WAAWlF,KACzBgF,EAAcE,WAAWlF,GAAY,IAEzCgF,EAAcE,WAAWlF,GAAUD,GAASqB,KAGpD/8B,KAAK2gC,cAAgBA,EACrB3gC,KAAK8gC,wBAA0BA,EAC/B9gC,KAAKwgC,KAAKvD,UAAS,SAACjvB,GAChBD,EAAKwyB,cAAchsC,KAAKyZ,QAE/B,CAAAgB,IAAA,cAAAkB,MAED,SAAYf,EAAUU,GAElB,GAAGV,EAAS+xB,aAAe/xB,EAAS+xB,YAAYtF,OAC5C,OAAO,EAGX,IADe/rB,EAAMyE,WAAW6sB,MAAK,SAAA5uC,GAAC,OAAIA,EAAEiO,OAAS2O,GAAY5c,EAAE4iB,KAAOhG,KAEtE,OAAO,EAEX,IAAMiyB,EAAYjyB,EAASiB,OAAO/S,QAElC,GADAwS,EAAMoG,WACHpG,EAAMyE,WAAW1hB,OAAS,GAA7B,CACA,IA1HO1B,EAAGyY,EA0HJ03B,EAAgBlyB,EAASiB,OAE/B,OA5HUzG,EA2HiB03B,EA1HxB53B,IADIvY,EA2HSkwC,GA1HP,GAAKz3B,EAAE,IAAMF,GAAIvY,EAAE,GAAKyY,EAAE,KA2H5B,MACHwF,EAASO,cAAc,IAAIqP,GAAW,YAAa,CAC/C3O,OAAQgxB,EACRjyB,SAAAA,EACAU,MAAAA,EACA7Y,MAAOoqC,MAEJ,MAGd,CAAApyB,IAAA,kBAAAkB,MAED,SAAgBL,EAAO8wB,GAA6B,IAAd9uC,EAAC4O,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EAAG3O,EAAC2O,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,EACvCy/B,EAAalgC,KAAKkgC,WAClBnG,EAAM/5B,KAAK+5B,IAEHuH,EAEVX,EAFAC,SACYW,EACZZ,EADAE,WAGAlG,EAAc9oC,EAClByY,OAAOC,KAAKg3B,GAAmBpqC,SAAQ,SAACqqC,EAAcpqC,GAClD,IAAMqqC,EAASF,EAAkBC,GAC7BE,EAAW,EACTC,EAAOr3B,OAAOC,KAAKk3B,GACzBE,EAAKxqC,SAAQ,SAAAyqC,GACT,IAAMvB,EAAMoB,EAAOG,GAEXrzC,EADSshB,EAAM6C,sBAAsB2tB,EAAItuB,QACtB6D,uBAAnBrnB,MACRmzC,EAAW1yC,KAAKgK,IAAIzK,EAAOmzC,MAE/B/G,GAAuB,IAARvjC,EAAY,EAAGsqC,EAAS,EACvCC,EAAKxqC,SAAQ,SAAAyqC,GACT,IAAMvB,EAAMoB,EAAOG,GACF/xB,EAAM6C,sBAAsB2tB,EAAItuB,QACxC3B,OAAO,GAAKuqB,KAEzBA,GAAgB+G,EAAS,EAAI3H,KAGjC,IAAIO,EAAexoC,EAEnBwY,OAAOC,KAAK+2B,GAAiBnqC,SAAQ,SAACyqC,EAAWxqC,GAC7C,IAAMyqC,EAAMP,EAAgBM,GACxBE,EAAY,EACVC,EAAUz3B,OAAOC,KAAKs3B,GAC5BE,EAAQ5qC,SAAQ,SAAAqqC,GACZ,IAAMnB,EAAMwB,EAAIL,GAEhBQ,EADiBnyB,EAAM6C,sBAAsB2tB,EAAItuB,QACd6D,uBAA3BpnB,EAAMwzC,EAANxzC,OAAawzC,EAALzzC,MAChBuzC,EAAY9yC,KAAKgK,IAAIxK,EAAQszC,MAEjCxH,GAAwB,IAARljC,EAAY,EAAI0qC,EAAU,EAC1CC,EAAQ5qC,SAAQ,SAAAqqC,GACZ,IAAMnB,EAAMwB,EAAIL,GACC3xB,EAAM6C,sBAAsB2tB,EAAItuB,QACxC3B,OAAO,GAAKkqB,KAEzBA,GAAiBwH,EAAU,EAAI5B,OAGtC,CAAAlxB,IAAA,iBAAAkB,MAED,SAAelC,GACX,IAAMi0B,EAASjiC,KAAKsgC,UAAUa,MAAK,SAAApE,GAAI,OAAIA,EAAK/uB,UAAYA,KAC5D,OAAGi0B,EACQA,EAAOC,WAEX,OACV,CAAAlzB,IAAA,SAAAkB,MAED,SAAOL,GAAM,IAAAM,EAAAnQ,KACTA,KAAKmiC,gBAAgBtyB,EAAO7P,KAAK2gC,eACjCr2B,OAAOtF,OAAOhF,KAAK8gC,yBAAyB3pC,SAAQ,SAAAwb,GAEhD,IAAMoqB,EAAOltB,EAAM6C,sBAAsBC,EAAQoqB,KAAKhrB,QACtD5B,EAAKgyB,gBAAgBtyB,EAAO8C,EAASoqB,EAAK3sB,OAAO,GAAI2sB,EAAK3sB,OAAO,WAExE4vB,EA9Kc,GChBboC,GAAUrzB,GACZ,SAAAqzB,EAAYrwB,EAAQgrB,EAAMsF,GAAcp0B,OAAAm0B,GAEpCpiC,KAAK2mB,KAAO,aAEZ3mB,KAAK+R,OAASA,EACd/R,KAAK+8B,KAAOA,EACZ/8B,KAAK2H,IAAMoK,EAAOpK,IAClB3H,KAAK2mB,KAAO5U,EAAO4U,KACnB3mB,KAAKsiC,YAAcvwB,EAAOuwB,YAE1BtiC,KAAKy7B,GAAK4G,EAAYlyC,GAAAA,OAAM4sC,EAAKtB,GAAEtrC,KAAAA,OAAI4hB,EAAOwwB,KAAIpyC,eAAAA,GAAAA,OAAmB4sC,EAAKtB,GAAEtrC,KAAAA,OAAI4hB,EAAOwwB,MACvFviC,KAAKwiC,WAAY,EACjBxiC,KAAKyiC,uBAAoBltC,EAEzByK,KAAK0iC,sBAAmBntC,EACxByK,KAAK2iC,eAAYptC,KAQnBqtC,GAAM,WACR,SAAAA,EAAY7wB,GAAQ,IAAAhE,EAAA/N,KAAAiO,OAAA20B,GAEhB5iC,KAAK2mB,KAAO,SAEZ3mB,KAAK+R,OAASA,EAEd/R,KAAKy7B,GAAK1pB,EAAOwwB,KAEjBviC,KAAKygC,aAAc,EAEnBzgC,KAAK0iC,sBAAmBntC,EAExByK,KAAK6iC,aAAe9wB,EAAO8wB,aAAa9tC,KAAI,SAAAjC,GAAC,OAAI,IAAIsvC,GAAWtvC,EAAGib,MACnE/N,KAAK8iC,uBAAyB/wB,EAAO+wB,uBAAuB/tC,KAAI,SAAAjC,GAAC,OAAI,IAAIsvC,GAAWtvC,EAAGib,GAAM,MAC7F/N,KAAK+iC,WAAa/iC,KAAK6iC,aAAa1B,MAAK,SAAAruC,GAAC,MAAsB,OAAlBA,EAAEif,OAAOwwB,QAiH1D,OA/GAxzB,EAAA6zB,EAAA,CAAA,CAAA5zB,IAAA,oBAAAkB,MAED,SAAkB8yB,GAAS,IAAA7yB,EAAAnQ,KACvBA,KAAK6iC,aAAa1rC,SAAQ,SAAA8rC,GACtB,IAAMC,EAAQD,EAASlxB,OAAOmxB,MAE9B,GADoBD,EAASlxB,OAAOoxB,YACjCD,GAAkC,UAAzBD,EAASlxB,OAAO4U,MAAoBqc,EAAQE,GAAQ,CAC5D,IAAME,EAAYJ,EAAQE,GACtBD,EAASlxB,OAAOoxB,cAChBhzB,EAAKizB,UAAYA,GAEjBA,IAAcjzB,IACd8yB,EAAST,WAAY,GAEzBS,EAASR,kBAAoBW,EAAUL,eAG/C/iC,KAAK8iC,uBAAuB3rC,SAAQ,SAAA8rC,GAChC,IAAMI,EAAYJ,EAASlxB,OAAOsxB,UAClC,GAAGA,GAAaL,EAAQK,GAAY,CAChC,IAAMtG,EAAOiG,EAAQK,GACfC,EAAiBvG,EAAK+F,uBAAuB3B,MAAK,SAAA7pC,GAAC,OAAIA,EAAEya,OAAOsxB,YAAclzB,EAAKsrB,MACrFsB,IAAS5sB,IACT8yB,EAAST,WAAY,GAEzBS,EAASN,UAAYW,QAIhC,CAAAt0B,IAAA,WAAAkB,MAED,SAASngB,GACLA,EAASiQ,MACTA,KAAK6iC,aAAa1rC,SAAQ,SAAA8rC,GACnBA,EAASt7B,eAAei7B,GACvB7yC,EAASkzC,QAGpB,CAAAj0B,IAAA,WAAAkB,MAED,SAASngB,GACLiQ,KAAK6iC,aAAa1rC,SAAQ,SAAA8rC,GACtB,GAAGA,EAASR,6BAA6BL,GAAY,CACjD,IAAMmB,EAAaN,EAASR,kBACzBQ,EAAST,UACRzyC,EAAS,CACLyQ,KAAMyiC,EAASxH,GACftmB,GAAIouB,EAAW9H,GACfuB,KAAM,WACN/yB,QAASxB,GAAUG,KACnBuB,MAAO1B,GAAUG,KACjBglB,QAASqV,EAASX,YAClBn3B,SAAU,GACVnB,KAAM,CACFxJ,KAAMyiC,EACN9tB,GAAIouB,KAIZxzC,EAAS,CACLyQ,KAAMyiC,EAASxH,GACftmB,GAAIouB,EAAW9H,GACfuB,KAAM,WACNpP,QAASqV,EAASX,YAClBt4B,KAAM,CACFxJ,KAAMyiC,EACN9tB,GAAIouB,SAQxBvjC,KAAK8iC,uBAAuB3rC,SAAQ,SAAA8rC,GAChC,GAAGA,EAASN,qBAAqBP,GAAY,CACzC,IAAMmB,EAAaN,EAASN,UACzBM,EAAST,UACRzyC,EAAS,CACLyQ,KAAMyiC,EAASxH,GACftmB,GAAIouB,EAAW9H,GACfuB,KAAM,WACN/yB,QAASxB,GAAUG,KACnBuB,MAAO1B,GAAUI,IACjButB,SAAU,CAAC,GAAI,GACfsB,YAAY,EACZ9J,QAASqV,EAASX,YAClBn3B,SAAU,GACVC,SAAU,GACVpB,KAAM,CACFxJ,KAAMyiC,EACN9tB,GAAIouB,KAIZxzC,EAAS,CACLyQ,KAAMyiC,EAASxH,GACftmB,GAAIouB,EAAW9H,GACfuB,KAAM,WACN5G,SAAU,CAAC,GAAI,GACfsB,YAAY,EACZ9J,QAASqV,EAASX,YAClBt4B,KAAM,CACFxJ,KAAMyiC,EACN9tB,GAAIouB,EACJC,aAAa,aAMpCZ,EAhIO,GCNNa,IAAAA,GAAQ,WACV,SAAAA,EAAYz1B,GAASC,OAAAw1B,GAEjBzjC,KAAI,QAAU,EAEdA,KAAKsgC,UAAY,GAEjBtgC,KAAKugC,cAAgB,GAErBvgC,KAAK0jC,QAAU,GACf1jC,KAAKogC,QAAQpyB,EAAQ21B,oBAgIxB,OA9HD50B,EAAA00B,EAAA,CAAA,CAAAz0B,IAAA,UAAAkB,MAIA,SAAQ0zB,GAAI,IAAA71B,EAAA/N,KACRA,KAAK4jC,GAAKA,EACV5jC,KAAKsgC,UAAY,GACjBtgC,KAAKugC,cAAgB,GACrB,IAAMrE,EDqHd,SAAgBnqB,GACZ,IAAMixB,EAAU,GACV9G,EAAQnqB,EAAOhd,KAAI,SAAAU,GACrB,IAAMsnC,EAAO,IAAI6F,GAAOntC,GAExB,OADAutC,EAAQvtC,EAAE8sC,MAAQxF,EACXA,KAKX,OAHAb,EAAM/kC,SAAQ,SAAA4lC,GACVA,EAAK8G,kBAAkBb,MAEpB9G,EC/HW4H,CAAO9jC,KAAK4jC,IACpBG,EAAQ,GACd7H,EAAM/kC,SAAQ,SAAA4lC,GACVA,EAAKZ,UAAS,SAAC7kC,GACXyW,EAAKuyB,UAAU/rC,KAAK,CAChBoyB,KAAMrvB,EAAEqvB,KACR3Y,QAAS1W,EAAEya,OACXmwB,WAAY5qC,OAGpBylC,EAAKE,UAAS,SAAAjvB,GACV,IACUi1B,EAGNj1B,EAHAxN,KACI+iC,EAEJv1B,EAFAmH,GACAnL,EACAgE,EADAhE,KAEJ,GAAGA,EAAKw5B,YAAa,CACjB,IAAMQ,KAAG7zC,OAAM8yC,EAAQ9yC,KAAAA,OAAIozC,GACrBU,KAAG9zC,OAAMozC,EAAUpzC,KAAAA,OAAI8yC,GAEvBiB,EAAWl6B,EAAKxJ,KACtB,GAAGujC,EAAMv4B,SAASw4B,IAAQD,EAAMv4B,SAASy4B,GACrC,OAEAC,EAASnyB,OAAOoxB,cAChBY,EAAMxvC,KAAKyvC,GACXD,EAAMxvC,KAAK0vC,GACXl2B,EAAKwyB,cAAchsC,KAAKyZ,SAG5BD,EAAKwyB,cAAchsC,KAAKyZ,SAKpChO,KAAK0jC,QAAUxH,IAClB,CAAAltB,IAAA,cAAAkB,MAED,SAAYf,EAAUU,GAClB,OAAO,IACV,CAAAb,IAAA,SAAAkB,MAED,SAAOL,GACW7P,KAAKugC,cACLvgC,KAAK0jC,QAEnB,IAAMS,EAAc,GACdjrC,EAAO,IACb,SAASkrC,EAAkBrH,GAAqB,IAAfsH,EAAQ5jC,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GACpC6jC,EAAiB,CAAC,EAAG,GAGzB,OAAIvH,EAAKqG,UACFiB,EAAS74B,SAASuxB,EAAKqG,WAEf,CACHkB,EAAe,GAAMprC,IAAU6jC,EAAKhrB,OAAOwyB,cAAgBrrC,EAC3DorC,EAAe,KAGvBD,EAAS9vC,KAAKwoC,EAAKqG,WAGZ,EADPkB,EAAiBF,EAAkBrH,EAAKqG,UAAWiB,IAEhC,GAAMnrC,IAAU6jC,EAAKhrB,OAAOwyB,cAAgBrrC,EAC3DorC,EAAe,GAAK,MAGjBA,EAGftkC,KAAK0jC,QAAQvsC,SAAQ,SAAA4lC,GACjB,IAAM5tB,EAAW4tB,EAAK2F,mBACkB8B,EAAAhzB,EAAvB4yB,EAAkBrH,GAAK,GAAjC0H,EAAED,EAAA,GAAEE,EAAEF,EAAA,GACTL,EAAYO,KACZP,EAAYO,GAAM,IAEtBP,EAAYO,GAAInwC,KAAKwoC,GACrB5tB,EAASiB,OAAS,CAACq0B,EAA8B,IAAzBN,EAAYO,GAAI9xC,OAAc8xC,UAwC7DjB,EA1IS,GCpCDkB,GACF,QADEA,GAEI,UAGJC,GACF,QADEA,GAEU,mBAFVA,GAGW,oBAHXA,GAIQ,iBAJRA,GAKF,QALEA,GAMD,SANCA,GAOE,YAGFC,GACG,YADHA,GAEI,aAFJA,GAGC,UAHDA,GAIG,YAJHA,GAKH,OALGA,GAMH,OANGA,GAOG,aAPHA,GAQC,WARDA,GASF,QATEA,GAUF,QAVEA,GAWF,QAXEA,GAYF,QAGEC,GACG,YADHA,GAEG,YAFHA,GAGO,eAHPA,GAIK,cCjCZC,YAAWp3B,GAAAC,EAAAm3B,EAAAp3B,GAAA,IAAAE,EAAAC,EAAAi3B,GAGb,SAAAA,EAAYh3C,GAAS,IAAAggB,EAIU,OAJVE,OAAA82B,GACTpzB,EAAAxD,EAARJ,EAAAF,EAAAK,KAAAlO,uBAHY,MAIZ+N,EAAKi3B,cAuDb,SAA4B9T,GACxB,IAAME,EAAQnjC,SAASC,cAAc,SACrCkjC,EAAMC,aAAa,8LASnBD,EAAMC,aAAa,YAAa,GAChCD,EAAMC,aAAa,eAAe,GAClCD,EAAMC,aAAa,cAAc,GACjCD,EAAMC,aAAa,cAAe,OAElC,IAAIC,GAAY,EACZhiB,EAAS,CACTiiB,QAAQ,EACRlC,SAAS,GAmHb,OAhHA+B,EAAM3gC,iBAAiB,eAAe,SAAAkP,GAClCA,EAAE4f,iBACC5f,EAAE6U,OAGG8c,GACAJ,EAAgB0T,GAAsBjlC,EAAE6U,UAKpD4c,EAAM3gC,iBAAiB,oBAAoB,SAACkP,GACxCuxB,EAAgB0T,IAChBtT,GAAY,KAEhBF,EAAM3gC,iBAAiB,qBAAqB,SAACkP,GACzCuxB,EAAgB0T,GAAmCjlC,EAAE6U,SAEzD4c,EAAM3gC,iBAAiB,kBAAkB,SAACkP,GACtCuxB,EAAgB0T,GAAgCjlC,EAAE6U,MAClD4c,EAAMlhB,MAAQ,GACdohB,GAAY,KAGhBF,EAAM3gC,iBAAiB,SAAS,SAACioB,GAC7B,IAAG4Y,EAGH,OAAO5Y,EAAM1J,KACT,IAAK,QACDkiB,EAAgB2T,IAChBv1B,EAAO+f,SAAU,EACjB,MACJ,IAAK,OACL,IAAK,UACD/f,EAAOiiB,QAAS,MAM5BH,EAAM3gC,iBAAiB,WAAW,SAACioB,GAC/B,IAAG4Y,EAAH,CAGA,OAAO5Y,EAAM8Y,MACT,IAAK,QACDN,EAAgB0T,IAChB,MACJ,IAAK,YACD1T,EAAgB0T,IAChB,MACJ,IAAK,SACD1T,EAAgB0T,IAChB,MACJ,IAAK,YACD1T,EAAgB2T,IAChB,MACJ,IAAK,aACD3T,EAAgB2T,IAChB,MACJ,IAAK,YACD3T,EAAgB2T,IAChB,MACJ,IAAK,UACD3T,EAAgB2T,IAGxB,OAAOnsB,EAAM1J,KACT,IAAK,QACDkiB,EAAgB2T,IAChBv1B,EAAO+f,SAAU,EACjB,MACJ,IAAK,OACL,IAAK,UACD/f,EAAOiiB,QAAS,EAChB,MACJ,IAAK,IACEjiB,EAAOiiB,QACNL,EAAgB2T,IAEpB,MACJ,IAAK,IACEv1B,EAAOiiB,QACNL,EAAgB2T,IAEpB,MACJ,IAAK,IACEv1B,EAAOiiB,QACNL,EAAgB2T,IAEpB,MACJ,IAAK,IACEv1B,EAAOiiB,QACNL,EAAgB2T,IAEpB,MACJ,IAAK,IACEv1B,EAAOiiB,SACN7Y,EAAM6G,iBACN2R,EAAgB2T,KAEpB,MACJ,IAAK,IACGv1B,EAAOiiB,QAAUjiB,EAAO+f,QACxB6B,EAAgB2T,IACVv1B,EAAOiiB,QACbL,EAAgB2T,SAKzBzT,EA7LkBK,CAAmB1jB,EAAKmjB,gBAAgBhuB,KAAIiL,EAAAJ,KACjEhgB,EAAQqB,OAAO2e,EAAKi3B,eACpBj3B,EAAKi3B,cAAcnT,QAAQ9jB,EAgD9B,OA/CAgB,EAAAg2B,EAAA,CAAA,CAAA/1B,IAAA,kBAAAkB,MACD,SAAgB+0B,EAAMzwB,GAClB,OAAOywB,GACH,KAAKL,GACL,KAAKA,GACL,KAAKA,GACL,KAAKA,GACL,KAAKA,GACL,KAAKA,GACL,KAAKA,GACD5kC,KAAK0P,cAAc,IAAIC,YAAYg1B,GAAqB,CACpD/0B,OAAQ,CACJq1B,KAAAA,EACAzwB,KAAAA,MAGZ,MAEA,KAAKqwB,GACL,KAAKA,GACL,KAAKA,GACL,KAAKA,GACL,KAAKA,GACL,KAAKA,GACL,KAAKA,GACL,KAAKA,GACL,KAAKA,GACD7kC,KAAK0P,cAAc,IAAIC,YAAYg1B,GAA2B,CAC1D/0B,OAAQ,CACJq1B,KAAAA,SAMnB,CAAAj2B,IAAA,QAAAkB,MAED,WACIlQ,KAAKglC,cAAcnT,MAAM,CAAEC,eAAe,MAC7C,CAAA9iB,IAAA,eAAAkB,MAED,SAAare,EAAGC,GACZkO,KAAKglC,cAAcr2C,MAAM6qB,UAAS,aAAArpB,OAAgB0B,EAAC,QAAA1B,OAAO2B,EAAM,SACnE,CAAAkd,IAAA,UAAAkB,MAED,WACIlQ,KAAKglC,cAAc5S,aACtB2S,GAAAj0B,EAvDqBC,kBCFpBm0B,GAAK,WAAA,SAAAA,IAAAj3B,OAAAi3B,GAAAvzB,cACA,GAACA,EACE3R,KAAA,UAAA,CAAC,EAAE,IAAE2R,EAEL3R,KAAA,UAAA,CACNmlC,MAAM,EACNC,MAAO,KACPlW,YAAa,EACbC,gBAAgB,IAkEnB,OAjEApgB,EAAAm2B,EAAA,CAAA,CAAAl2B,IAAA,SAAAkB,MAED,SAAO2xB,GACH7hC,KAAKqlC,KAAOxD,IACf,CAAA7yB,IAAA,YAAAkB,MACD,SAAUo1B,EAAa7D,QACLlsC,IAAXksC,EACCzhC,KAAKulC,QAAQD,GAAe7D,EAE5BzhC,KAAKulC,QAAUD,IAEtB,CAAAt2B,IAAA,SAAAkB,MAED,WACI,OAAOlQ,KAAKqlC,OACf,CAAAr2B,IAAA,YAAAkB,MAED,SAAU9Y,GACN,YAAW7B,IAAR6B,EACQ4I,KAAKulC,QAAQnuC,GAEjB4I,KAAKulC,UACf,CAAAv2B,IAAA,UAAAkB,MAED,SAAQL,GAAO,IAAA9B,EAAA/N,KACXA,KAAK8uB,QAAQsW,MAAQv1B,EAAM8G,mBAAkB,SAACe,GAC1C,IAAMwX,EAAcnhB,EAAK+gB,QAAQI,YAC9BnhB,EAAK+gB,QAAQK,iBACZphB,EAAK+gB,QAAQI,YAAcxX,EAC3B3J,EAAK+gB,QAAQK,gBAAiB,GAE/BzX,EAAUwX,EAAc,MACvBnhB,EAAK+gB,QAAQqW,MAAQp3B,EAAK+gB,QAAQqW,KAClCp3B,EAAK+gB,QAAQI,YAAcxX,QAGtC,CAAA1I,IAAA,gBAAAkB,MAED,WACIlQ,KAAK8uB,QAAQsW,MAAMpuB,SACnB1M,OAAOK,OAAO3K,KAAK8uB,QAAS,CACxBqW,MAAM,EACNC,MAAO,KACPlW,YAAa,MAEpB,CAAAlgB,IAAA,SAAAkB,MAED,WACI,OAAOlQ,KAAK8uB,QAAQqW,OACvB,CAAAn2B,IAAA,UAAAkB,MAED,WACI5F,OAAOK,OAAO3K,KAAK8uB,QAAS,CACxBqW,MAAM,EACNhW,gBAAgB,MAEvB,CAAAngB,IAAA,UAAAkB,MAED,WACI,MAAQ,CAAAlQ,KAAKqlC,MAAIl1C,OAAAyb,EAAK5L,KAAKulC,YAC9B,CAAAv2B,IAAA,YAAAkB,MAED,SAAUmjB,GACNrzB,KAAKqlC,KAAOhS,EAAM,GAClBrzB,KAAKulC,QAAUlS,EAAMh2B,MAAM,OAC9B6nC,EA1EM,GCCX,IAAaM,GAAI,WAAA,SAAAA,IAAAv3B,OAAAu3B,GAAA7zB,gBACJ,IAkCR,OAlCU5C,EAAAy2B,EAAA,CAAA,CAAAx2B,IAAA,MAAAkB,MAEX,SAAI9Y,GACA,OAAO4I,KAAKylC,OAAOruC,KACtB,CAAA4X,IAAA,eAAAkB,MAED,SAAa0I,GAGT,IAFA,IAAIipB,EAAM,EACJ6D,EAAQ1lC,KAAKylC,OACb5D,EAAM6D,EAAM9yC,UACX8yC,EAAM7D,GAAKvH,aAAe1hB,IAG7BipB,IAEJ,OAAO7yC,KAAK+J,IAAI8oC,EAAK6D,EAAM9yC,OAAS,KACvC,CAAAoc,IAAA,WAAAkB,MAED,SAASlC,GACL,IAAMzb,EAAIozC,GAAKC,OAAO53B,GAEtB,OADAhO,KAAKylC,OAAS,CAAClzC,GACRA,IACV,CAAAyc,IAAA,OAAAkB,MAED,SAAKhV,GACD8E,KAAKylC,OAAOlxC,KAAK2G,KACpB,CAAA8T,IAAA,UAAAkB,MAED,SAAQngB,GACJiQ,KAAKylC,OAAOtuC,QAAQpH,KACvB,CAAAif,IAAA,SAAAkB,MAED,WACI,OAAOlQ,KAAKylC,OAAO7yC,WACtB4yC,EAnCY,GAsCJG,GAAI,WAYb,SAAAA,IAA0B,IAAd33B,EAAOvN,UAAA7N,OAAA,QAAA2C,IAAAkL,UAAA,GAAAA,UAAA,GAAG,GAAEwN,OAAA03B,GAAAh0B,eAXhB,GAACA,iBACC,GAACA,gBACF,GAACA,sBACK,GAACA,mBACJ,IAAEA,mBAWF,IAHRrH,OAAOK,OAAO3K,KAAMgO,GAHvB,OAIAe,EAAA42B,EAAA,CAAA,CAAA32B,IAAA,MAAAkB,MAID,SAAI9Y,GACA,OAAO4I,KAAK6lC,UAAUzuC,KACzB,CAAA4X,IAAA,SAAAkB,MACD,WACI,OAAOlQ,KAAK6lC,UAAUjzC,SACzB,CAAAoc,IAAA,SAAAkB,MAED,SAAO9Y,EAAK0uC,GACR9lC,KAAK6lC,UAAUnyC,OAAO0D,EAAK,EAAG0uC,KACjC,CAAA92B,IAAA,OAAAkB,MACD,SAAK41B,GACD9lC,KAAK6lC,UAAUtxC,KAAKuxC,KACvB,CAAA92B,IAAA,OAAAkB,MACD,WACI,OAAOlQ,KAAK6lC,UAAU7lC,KAAK6lC,UAAUjzC,OAAO,KAC/C,CAAAoc,IAAA,OAAAkB,MACD,WACI,OAAOlQ,KAAK6lC,UAAUxoC,UACzB,CAAA2R,IAAA,mBAAAkB,MAED,SAAiByI,EAASotB,EAAcjY,EAAUD,GAC9C,IAAMmY,EAAWhmC,KAAK6lC,UACtB,GAAGltB,GAAW3Y,KAAKzR,MAAO,CACtB,IAAM2E,EAAI8yC,EAASpzC,OAAS,EACtBkzC,EAAOE,EAAS9yC,GAClB4I,EAAI,EAIR,MAHiB,SAAdgqC,EAAKnf,OACJ7qB,EAAIgqC,EAAK/zB,OAAOnf,QAEb,CAACM,EAAG4I,GAMX,IAJA,IAAImqC,EAAW,EACXC,EAAS,EACTC,EAAK,EACLC,EAAS,KACPH,EAAWD,EAASpzC,OAAQ,GAAG,CACjCszC,EAASC,EACT,IAAME,EAAKL,EAASC,GACpB,GAAe,SAAZI,EAAG1f,KAAiB,CACnB,IACM3E,EADgBokB,GAA0B,SAAhBA,EAAOzf,KACI,EAAbof,EAAiBA,EAC/CI,GAAOE,EAAG93C,MAAQyzB,OAElBmkB,GAAME,EAAG93C,MAEb,GAAG43C,EAAKxtB,EAAS,CACbytB,EAASC,EACT,MAEJD,EAASC,EAETJ,IAGDE,GAAMxtB,IACLutB,EAASC,GAEb,IAAMG,EAAWN,EAASC,GAC1B,GAAqB,SAAlBK,EAAS3f,KAAiB,CACzB,IACMvvB,ECpHf,SACHk7B,EACAgU,EACAxY,EAAUD,GAEV,IAAMD,EAAU0Y,EAASv0B,OACnBygB,EAAO5E,EAAQh7B,OAAS,EAC9B,GAAsB,IAAnB0zC,EAAS/3C,MACR,OAAO,EAEX,IAAMmkC,EAAW4T,EAAS/3C,MACtB6I,EAAMpI,KAAKC,MAAMqjC,EAAOI,EAAWF,GAoDvC,OAnDA/iC,GAAmB,SAACtB,GAEhB,IAAIwkC,EAAIC,EACJC,EAFJ1kC,EAAI6hC,KAAI,GAAA7/B,OAAM29B,EAAQ39B,KAAAA,OAAI09B,GAI1B,IAAI36B,EAAI06B,EAAQp3B,UAAU,EAAGY,GACzBkD,EAAKszB,EAAQp3B,UAAUY,EAAI,EAAGA,GAC9BmD,EAAKqzB,EAAQp3B,UAAUY,EAAKA,EAAI,GAChCuS,EAAIxb,EAAIkiC,YAAYn9B,GAAG3E,MACvBukC,EAAK3kC,EAAIkiC,YAAY/1B,GAAI/L,MACzBo+B,EAAKx+B,EAAIkiC,YAAY91B,GAAIhM,MAC7BokC,EAAKhpB,EAAImpB,EAAG,EACZF,EAAKjpB,EAAIgjB,EAAG,EAEZ,EAAG,CACC,GAAGgG,GAAML,GAAQM,GAAMN,EACnB,MAEJ,GAAGK,EAAKL,EAAM,CAEV,IAAMS,EAAQH,EAAKN,EACnBO,EAAUz7B,EAENA,GADD27B,EAAQ,IACA,EAEA/jC,KAAKC,MAAM8jC,EAAQH,EAAKC,GAEnC3/B,EAAI06B,EAAQp3B,UAAUY,EAAKy7B,GAC3BlpB,GAAKxb,EAAIkiC,YAAYn9B,GAAG3E,WACrB,GAAGqkC,EAAKN,EAAM,CAEjB,IAAMS,EAAQT,EAAOK,EACrBE,EAAUz7B,EAENA,GADD27B,EAAQ,IACA,EAEA/jC,KAAKC,MAAM8jC,GAASL,EAAWC,IAAOH,EAAOK,IAExD3/B,EAAI06B,EAAQp3B,UAAUq8B,EAASz7B,GAC/BuS,GAAKxb,EAAIkiC,YAAYn9B,GAAG3E,MAG5B+L,EAAKszB,EAAQp3B,UAAUY,EAAI,EAAGA,GAC9BmD,EAAKqzB,EAAQp3B,UAAUY,EAAKA,EAAI,GAGhCu7B,EAAKhpB,GAFLmpB,EAAK3kC,EAAIkiC,YAAY/1B,GAAI/L,OAEb,EACZqkC,EAAKjpB,GAFLgjB,EAAKx+B,EAAIkiC,YAAY91B,GAAIhM,OAEb,QACR6I,GAAO,GAAKA,GAAOo7B,MAGxBp7B,EDqDiBmvC,CADC5tB,EAAUutB,EACkBI,EAAUxY,EAAUD,GAC7D,MAAO,CAACoY,EAAU7uC,GAGlB,OADauhB,EAAUutB,EACbE,EAAO73C,MAAM,EACZ,CAAC03C,EAAS,EAAG,GAEb,CAACA,EAAU,KAKjC,CAAAj3B,IAAA,UAAAkB,MAED,SAAQngB,GACJiQ,KAAK6lC,UAAU1uC,QAAQpH,MAC1B,CAAA,CAAAif,IAAA,SAAAkB,MAvFD,SAAclC,GAEV,OADU,IAAI23B,EAAK33B,OAEtB23B,EAVY,GAiGJa,GAAmB,WAAA,SAAAA,IAAAv4B,OAAAu4B,GAAA70B,uBAMZ,IAAEA,kBACP,IAAEA,sBACE,MAHd,OAGkB5C,EAAAy3B,EAAA,CAAA,CAAAx3B,IAAA,eAAAkB,MAEnB,SAAaE,EAAQ01B,GACjB,IAAM1uC,EAAM4I,KAAKqT,UAAUjD,GAC3BpQ,KAAKymC,UAAUrvC,EAAK0uC,KACvB,CAAA92B,IAAA,cAAAkB,MACD,SAAYE,EAAQ01B,GAChB,IAAM1uC,EAAM4I,KAAKqT,UAAUjD,GACdpQ,KAAKhF,IAAI5D,EAAI,IAEtB0uC,EAAKY,YAAYt2B,EAAOu2B,UAAYv2B,EAAOw2B,QAE/C5mC,KAAKymC,UAAUrvC,EAAI,EAAG0uC,KACzB,CAAA92B,IAAA,YAAAkB,MACD,SAAU41B,GACN,OAAO9lC,KAAK6mC,cAAcxzB,WAAU,SAAAgzB,GAAE,OAAIA,IAAOP,OACpD,CAAA92B,IAAA,MAAAkB,MACD,SAAI9Y,GACA,OAAO4I,KAAK6mC,cAAczvC,KAC7B,CAAA4X,IAAA,OAAAkB,MACD,SAAK81B,GACDhmC,KAAK6mC,cAAgBb,IACxB,CAAAh3B,IAAA,YAAAkB,MACD,SAAU9Y,EAAK0uC,GACX9lC,KAAKtM,OAAO0D,EAAK,EAAG0uC,KACvB,CAAA92B,IAAA,OAAAkB,MACD,SAAK41B,GACD9lC,KAAKtM,OAAOsM,KAAKpN,SAAU,EAAGkzC,KACjC,CAAA92B,IAAA,SAAAkB,MACD,SAAO9Y,GACH4I,KAAKtM,OAAO0D,EAAK,KACpB,CAAA4X,IAAA,SAAAkB,MACD,WAAS,IAAA42B,EACCC,GAAUD,OAAKD,eAAcnzC,OAAM61B,MAAAud,EAAIrmC,WAC7CT,KAAKgnC,SAASzyC,KAAK,CACf++B,GAAI,SACJhzB,KAAMG,UACNsmC,QAAAA,MAEP,CAAA/3B,IAAA,OAAAkB,MACD,WACI,OAAOlQ,KAAK6mC,cAAcxpC,UAC7B,CAAA2R,IAAA,UAAAkB,MACD,WACI,OAAqC,IAA9BlQ,KAAK6mC,cAAcj0C,QAAiD,KAAjCoN,KAAK6mC,cAAc,GAAG90B,SACnE,CAAA/C,IAAA,UAAAkB,MACD,SAAQngB,GACJiQ,KAAK6mC,cAAc1vC,QAAQpH,KAC9B,CAAAif,IAAA,OAAAkB,MACD,WACI,OAAOlQ,KAAK6mC,cAAc7mC,KAAK6mC,cAAcj0C,OAAO,KACvD,CAAAoc,IAAA,SAAAkB,MACD,SAAOngB,GACH,OAAOiQ,KAAK6mC,cAAcnrC,OAAO3L,KACpC,CAAAif,IAAA,SAAAkB,MACD,WACI,OAAOlQ,KAAK6mC,cAAcj0C,SAC7B,CAAAoc,IAAA,cAAAkB,MAED,WAMI,OALAlQ,KAAKinC,aAAe,CAChBC,OAAQ,KACRC,MAAO,MAEXnnC,KAAKgnC,SAAW,GACThnC,KAAKgnC,WACf,CAAAh4B,IAAA,YAAAkB,MAED,WACI,OAAOlQ,KAAKgnC,WACf,CAAAh4B,IAAA,oBAAAkB,MAED,SAAkBk3B,GACdpnC,KAAKinC,aAAaC,OAASE,EAAMC,YACpC,CAAAr4B,IAAA,mBAAAkB,MAED,SAAiBk3B,GACbpnC,KAAKinC,aAAaE,MAAQC,EAAMC,YACnC,CAAAr4B,IAAA,iBAAAkB,MAED,WACI,OAAOlQ,KAAKinC,eACf,CAAAj4B,IAAA,iBAAAkB,MAED,WACI,OAAOlQ,KAAKgnC,YACf,CAAA,CAAAh4B,IAAA,SAAAkB,MA7FD,SAAc81B,GACV,IAAMsB,EAAK,IAAId,EAEf,OADAc,EAAG9mC,KAAKwlC,GACDsB,MACVd,EAL2B,GAiGnBe,GAAW,WAUpB,SAAAA,EAAY5gB,EAAM5U,GAAQ9D,OAAAs5B,GAAA51B,mBATf,GAAKA,eACR,GAACA,qBACK,GAACA,gBACN,GAACA,iBACA,GAACA,iBACD,GAACA,gBACH,GAAIA,iBACH,GAGL3R,KAAK2mB,KAAOA,EACZ3mB,KAAK+R,OAASA,EA8DjB,OA7DAhD,EAAAw4B,EAAA,CAAA,CAAAv4B,IAAA,YAAAkB,MAED,SAAU6B,EAAQy1B,GACd,IAAMC,EAAaznC,KAAK+R,OACxB/R,KAAK+R,OAASA,EACd/R,KAAK2V,OAAQ,EACV6xB,GACCA,EAAQjzC,KAAK,CACT++B,GAAI,YACJhzB,KAAM,CAACN,KAAM+R,EAAQ01B,OAGhC,CAAAz4B,IAAA,cAAAkB,MAED,SAAYy2B,EAAUa,GAClB,IAAME,EAAW1nC,KAAK2mC,SACtB3mC,KAAK2mC,SAAWA,EACbe,IAAYf,GAAYa,GACvBA,EAAQjzC,KAAK,CACT++B,GAAI,cACJhzB,KAAM,CAACN,KAAM2mC,EAAUe,OAGlC,CAAA14B,IAAA,QAAAkB,MAED,SAAM9P,EAAQU,GACV,GAAiB,SAAdd,KAAK2mB,KAAiB,CACrB,IACMp0B,EADUyN,KAAK+R,OACHnf,OACZ+0C,EAAavnC,EAASU,EAC5B,OAAG6mC,EAAa,EACL,OAERA,EAAap1C,EACL,OAEJ,OAEP,OAAGuO,EAAO,EACC,OAERA,EAAO,EACC,YADX,IAIP,CAAAkO,IAAA,aAAAkB,MAED,WACI,MAAiB,SAAdlQ,KAAK2mB,KACD3mB,KAAK2mC,UAAY3mC,KAAK4mC,OACd5mC,KAAK+R,OAAOnf,OAEZ5D,KAAKgK,IAAI,EAAGgH,KAAK+R,OAAOnf,OAAS,GAGrC,IAEd,CAAAoc,IAAA,aAAAkB,MAED,WACI,OAAO,MACVq3B,EA1EmB,GExOlBK,GAAK,WAAA,SAAAA,IAAA35B,OAAA25B,GAAAj2B,kBACG,GAAKA,oBACF,MAAMA,kBACR,MAAQA,uBACH,MAqIf,OArImB5C,EAAA64B,EAAA,CAAA,CAAA54B,IAAA,kBAAAkB,MAEpB,SAAgB0f,GACZ5vB,KAAK6nC,cAAgBjY,IACxB,CAAA5gB,IAAA,eAAAkB,MAED,WACI,OAAOlQ,KAAK8nC,aACf,CAAA94B,IAAA,aAAAkB,MAED,WACI,OAAOlQ,KAAK+nC,WACf,CAAA/4B,IAAA,WAAAkB,MAED,WACI,OAAOlQ,KAAKgoC,UACf,CAAAh5B,IAAA,SAAAkB,MAED,WACIlQ,KAAKgoC,SAAU,IAClB,CAAAh5B,IAAA,UAAAkB,MACD,WACIlQ,KAAKgoC,SAAU,IAClB,CAAAh5B,IAAA,cAAAkB,MAED,SAAYk3B,GACR,IAAAa,EAAAz2B,EAAkBxR,KAAK+nC,SAAQ,GAAxB/0C,EAACi1C,EAAA,GAAEh1C,EAACg1C,EAAA,GAAE/0C,EAAC+0C,EAAA,GACdb,EAAMc,OAAOl1C,GACbo0C,EAAMe,UAAU,CAACl1C,EAAGC,MACvB,CAAA8b,IAAA,WAAAkB,MAED,SAASk4B,GACL,IAAMp1C,EAAIgN,KAAK6nC,cACZ7nC,KAAKqoC,cAAcr1C,EAAGo1C,IACrBpoC,KAAK8nC,WAAa90C,EAClBgN,KAAK+nC,SAAWK,IAEhBpoC,KAAK8nC,WAAaM,EAClBpoC,KAAK+nC,SAAW/0C,KAGvB,CAAAgc,IAAA,gBAAAkB,MAED,SAAc9L,EAAIC,GACd,QAAGD,EAAG,GAAKC,EAAG,QAGXD,EAAG,KAAOC,EAAG,IAAMD,EAAG,GAAKC,EAAG,OAG9BD,EAAG,KAAOC,EAAG,IAAMD,EAAG,KAAOC,EAAG,IAAMD,EAAG,GAAKC,EAAG,OAIvD,CAAA2K,IAAA,SAAAkB,MAED,SAAOo4B,EAAQd,GACX,GAAGxnC,KAAKgoC,QAAS,CACb,IAAMO,EAAOD,EAAOE,MACdpB,EAAQkB,EAAOG,OACfC,EAAY1oC,KAAK8nC,WACjBnY,EAAU3vB,KAAK+nC,SACfY,EAAWJ,EAAKvtC,IAAI0tC,EAAU,IAAI1tC,IAAI0tC,EAAU,IAChDE,EAASL,EAAKvtC,IAAI20B,EAAQ,IAAI30B,IAAI20B,EAAQ,IAChDmY,EAAAt2B,EAA8Bk3B,EAAS,GAAlC7G,EAAGiG,EAAA,GAAE7B,EAAQ6B,EAAA,GAAE1nC,EAAM0nC,EAAA,GAK1B,GAJAN,EAAQjzC,KAAK,CACT++B,GAAI,QACJhzB,KAAM,CAACooC,EAAUrrC,QAASsyB,EAAQtyB,WAEnCsrC,IAAaC,EAAQ,CACpB,IAAM11C,EAAIy1C,EAAS52B,OACnB42B,EAASE,UAAU31C,EAAEsD,UAAU,EAAGkyC,EAAU,IAAMx1C,EAAEsD,UAAUm5B,EAAQ,IAAK6X,GAC3EmB,EAAShzB,OAAQ,MACd,CACH,IAGImzB,EACAC,EAJEC,EAAiBV,EAAOW,gBAC1BvV,EAAa,GACbD,EAAe,GAGbyV,EAAUF,EAAe31B,UAAUs1B,GACnCQ,EAAQH,EAAe31B,UAAUu1B,GACnCQ,GAAkB,EAatB,GAZqB,SAAlBT,EAAShiB,KACR+M,EAAaiV,EAAS52B,OAAOvb,UAAU,EAAGkyC,EAAU,IAEpDI,EAAaE,EAAehuC,IAAIkuC,EAAQ,GAEzB,SAAhBN,EAAOjiB,MACN8M,EAAemV,EAAO72B,OAAOvb,UAAUm5B,EAAQ,IAC/CyZ,EAAkBR,EAAOjC,UAEzBoC,EAAeC,EAAehuC,IAAImuC,EAAM,GAGzCL,EAEC,GADAE,EAAet1C,OAAOw1C,EAASC,EAAMD,EAAQ,GACtB,SAApBJ,EAAWniB,KACPmiB,EAAWnC,SACV9E,GAAO,EAEPoE,GAAY,EAEhB7lC,EAAS0oC,EAAW/2B,OAAOnf,OAC3Bk2C,EAAWD,UAAUC,EAAW/2B,OAAS0hB,EAAc+T,GACvDsB,EAAWnzB,OAAQ,EACnBmzB,EAAWpC,YAAY0C,EAAiB5B,OACrC,CACH,IAAMp1C,EAAI,IAAIm1C,GAAY,OAAQ7T,EAAaD,GAC/CrhC,EAAEs0C,YAAY0C,EAAiB5B,GAC/BwB,EAAet1C,OAAOw1C,EAAS,EAAG92C,QAItC,GADA42C,EAAet1C,OAAOw1C,EAASC,EAAMD,GAClCH,EAAc,CACb,IAAM32C,EAAI,IAAIm1C,GAAY,OAAQ7T,GAClCsV,EAAet1C,OAAOw1C,EAAS,EAAG92C,QAElCw2C,EAAOC,UAAUnV,EAAaD,EAAc+T,GAC5CoB,EAAOjzB,OAAQ,EAIQ,IAA5BqzB,EAAep2C,UAEdo2C,EAAez0C,KAAK,IAAIgzC,GAAY,OAAQ,KAIpDvnC,KAAKqpC,UAELjC,EAAMc,OAAOrG,GACbuF,EAAMe,UAAU,CAAClC,EAAU7lC,SAElCwnC,EAzIM,GCAX,SAAS0B,GAAiBz3C,GACtB,OAAoB,IAAbA,EAAEe,QAA4B,cAAZf,EAAE,GAAGyhC,GACjC,IACoBiW,GAAQ,WAAA,SAAAA,IAAAt7B,OAAAs7B,GAAA53B,eAEjB,IAAEA,eACF,IAAEA,iBACA,MAsDT,OAtDa5C,EAAAw6B,EAAA,CAAA,CAAAv6B,IAAA,QAAAkB,MAEd,SAAMre,EAAG23C,GACL,GAAgB,IAAb33C,EAAEe,OAAL,CAGA,GAAG02C,GAAiBz3C,GAAI,CACpB,IAAMO,EAAIP,EAAE,GACN43C,EAAWzpC,KAAK0pC,cACtB,GAAGD,GAAYH,GAAiBG,EAASE,QAAS,CAC9C,IAAM7tC,EAAI2tC,EAASE,OAAO,GAC1B,GAAG7tC,EAAEwE,KAAK,KAAOlO,EAAEkO,KAAK,GAGpB,OAFAxE,EAAEwE,KAAK,GAAKlO,EAAEkO,KAAK,QACnBmpC,EAASG,aAAeJ,EAAYrC,QAKhD,IAAMtzC,EAAI,IAAIg2C,GAAYh4C,GAC1BgC,EAAEi2C,eAAiBN,EAAYtC,OAC/BrzC,EAAE+1C,aAAeJ,EAAYrC,MAC7BnnC,KAAK+pC,MAAMx1C,KAAKV,GAEbmM,KAAK+pC,MAAMn3C,OAAS22C,EAAS32C,QAC5BoN,KAAK+pC,MAAMr2C,OAAO,EAAG,GAEtBsM,KAAKgqC,MAAMp3C,SACVoN,KAAKgqC,MAAQ,OAEpB,CAAAh7B,IAAA,cAAAkB,MAED,WACI,OAAOlQ,KAAK+pC,MAAM/pC,KAAK+pC,MAAMn3C,OAAS,KACzC,CAAAoc,IAAA,OAAAkB,MAED,WACI,IAAMre,EAAImO,KAAK+pC,MAAME,MAKrB,OAJGp4C,IACCA,EAAEq4C,KAAKlqC,KAAKmqC,SACZnqC,KAAKgqC,MAAMz1C,KAAK1C,IAEbA,IACV,CAAAmd,IAAA,OAAAkB,MAED,WAEI,IADA,IAAIre,EAAImO,KAAKgqC,MAAMC,MACbp4C,GAAKA,EAAEu4C,WACTv4C,EAAImO,KAAKgqC,MAAMC,MAMnB,OAJGp4C,IACCA,EAAEw4C,KAAKrqC,KAAKmqC,SACZnqC,KAAK+pC,MAAMx1C,KAAK1C,IAEbA,MACV03C,EA1DwB,GA0DxB53B,EA1DgB43B,GAAQ,SACT,IADS,IA6DvBM,GAAW,WAIb,SAAAA,EAAYS,GAAOr8B,OAAA47B,GAAAl4B,gBAHV,IAAEA,wBACM,MAAIA,sBACN,MAEX3R,KAAK2pC,OAASW,EA+DjB,OA9DAv7B,EAAA86B,EAAA,CAAA,CAAA76B,IAAA,oBAAAkB,MAED,SAAkBlG,GACdhK,KAAK4pC,aAAe5/B,IACvB,CAAAgF,IAAA,OAAAkB,MAED,SAAKo4B,GACDtoC,KAAK2pC,OAAOtsC,QAAQoJ,UAAUtP,SAAQ,SAAAozC,GAClC,OAAOA,EAAOjX,IACV,IAAK,QACD,IAAAkX,EAAAh5B,EAA6B+4B,EAAOjqC,KAAI,GAAjCooC,EAAS8B,EAAA,GAAE7a,EAAO6a,EAAA,GACnBnX,EAAQiV,EAAOmC,OACrBpX,EAAMqX,gBAAgBhC,GACtBrV,EAAMsX,SAAShb,GACf0D,EAAM/K,SACN,MACJ,IAAK,YACD,IAAAsiB,EAAAp5B,EAAsB+4B,EAAOjqC,KAAI,GAA1BwlC,EAAI8E,EAAA,GAAGA,EAAA,GAAE9jC,IAAAA,EAAE8jC,EAAA,GAClB9E,EAAK/zB,OAASjL,EACdg/B,EAAKnwB,OAAQ,EACb,MACJ,IAAK,cACD,IAAAk1B,EAAAr5B,EAAkB+4B,EAAOjqC,KAAI,GAAtBvK,EAAC80C,EAAA,GAAGA,EAAA,GAAE/uC,IAAAA,EAAC+uC,EAAA,GACd90C,EAAE4wC,SAAW7qC,EACb/F,EAAE4f,OAAQ,EACV,MACJ,IAAK,SACD,IAAMqzB,EAAiBV,EAAOW,gBAC9B6B,MAAqBP,EAAOjqC,uBAArBtN,EAAC83C,EAAA,GAAGA,EAAA,OAAK53C,EAAC43C,EAAAztC,MAAA,GACX0pC,EAAUwD,EAAOxD,QACnBtzC,EAAI,EACLP,IACCO,EAAIP,EAAEN,QAEVo2C,EAAet1C,OAAM61B,MAArByf,EAAsBh2C,CAAAA,EAAGS,GAACtD,OAAAyb,EAAKm7B,cAK3CuB,EAAOG,OAAOsC,UAAU/qC,KAAK8pC,kBAChC,CAAA96B,IAAA,OAAAkB,MAED,SAAKo4B,GACDtoC,KAAK2pC,OAAOxyC,SAAQ,SAAAozC,GAChB,OAAOA,EAAOjX,IACV,IAAK,YACD,IAAA0X,EAAAx5B,EAAsB+4B,EAAOjqC,KAAI,GAA1BwlC,EAAIkF,EAAA,GAAEv1C,EAACu1C,EAAA,GAAIA,EAAA,GAClBlF,EAAK/zB,OAAStc,EACdqwC,EAAKnwB,OAAQ,EACb,MACJ,IAAK,cACD,IAAAs1B,EAAAz5B,EAAkB+4B,EAAOjqC,KAAI,GAAtBvK,EAACk1C,EAAA,GAAEn4C,EAACm4C,EAAA,GAAGA,EAAA,GACdl1C,EAAE4wC,SAAW7zC,EACbiD,EAAE4f,OAAQ,EACV,MACJ,IAAK,SACD,IAAMqzB,EAAiBV,EAAOW,gBAC9BD,EAAet1C,OAAM61B,MAArByf,EAAcp9B,EAAW2+B,EAAOjqC,WAI5CgoC,EAAOG,OAAOsC,UAAU/qC,KAAK4pC,kBAChCC,EApEY,GCjEXqB,GAAO,WAKT,SAAAA,EAAY5C,GAAQr6B,OAAAi9B,GAChBlrC,KAAKmqC,QAAU7B,EAHlB,OAIAv5B,EAAAm8B,EAAA,CAAA,CAAAl8B,IAAA,OAAAkB,MAED,eAAS,CAAA,CAAAlB,IAAA,SAAAkB,MART,SAAco4B,GACV,OAAO,IAAItoC,KAAKsoC,OACnB4C,EAHQ,GCGAC,YAAgBC,GAAAx9B,EAAAu9B,EAAAC,GAAA,IAAAv9B,EAAAC,EAAAq9B,GAAA,SAAAA,IAAA,OAAAl9B,OAAAk9B,GAAAt9B,EAAA0b,MAAAvpB,KAAAS,WAmCxB,OAnCwBsO,EAAAo8B,EAAA,CAAA,CAAAn8B,IAAA,OAAAkB,MAGzB,WACI,IAAMo4B,EAAStoC,KAAKmqC,QACpB7B,EAAOmC,OAAOpB,UACd,IAAML,EAAiBV,EAAOW,gBACxB7B,EAAQkB,EAAOG,OACf5G,EAAMuF,EAAMiE,SAElB9F,EAAA/zB,EADe41B,EAAMkE,YACW,GAAzBC,EAAOhG,EAAA,GAAEnlC,EAAMmlC,EAAA,GAChBrqC,EAAOotC,EAAOE,MAAMxtC,IAAI6mC,GACxB2J,EAAUtwC,EAAKF,IAAIuwC,GACnBn0C,EAAM4xC,EAAe31B,UAAUm4B,GAErC,OADeA,EAAQvS,MAAM74B,GAAS,IAElC,IAAK,OACD,GAAGmrC,EAAU,EAAG,CACZ,IAAMlF,EAAKnrC,EAAKF,IAAIuwC,EAAU,GAC9BnE,EAAMe,UAAU,CAACoD,EAAU,EAAGlF,EAAGoF,oBAC9B,GAAGr0C,EAAM,EAAG,CACf,IAAMs0C,EAAS7J,EAAM,EACf8J,EAAarD,EAAOE,MAAMxtC,IAAI0wC,GAAQ94C,SAAW,EACjDwN,EAAS4oC,EAAehuC,IAAI5D,EAAI,GAAGq0C,aACzCrE,EAAMc,OAAOwD,GACbtE,EAAMe,UAAU,CAACwD,EAAYvrC,IAEjC,MACJ,IAAK,OACDgnC,EAAMe,UAAU,EAAG/nC,EAAS,GAGpCgnC,EAAM5T,UACN8U,EAAOtW,0BACPsW,EAAOr5B,OAAOiI,cACjBi0B,GAnCiCD,IAoCrCv5B,EApCYw5B,GACKtG,OAAAA,IAoCL+G,IAAAA,YAAiBC,GAAAj+B,EAAAg+B,EAAAC,GAAA,IAAA1gB,EAAArd,EAAA89B,GAAA,SAAAA,IAAA,OAAA39B,OAAA29B,GAAAzgB,EAAA5B,MAAAvpB,KAAAS,WAuCzB,OAvCyBsO,EAAA68B,EAAA,CAAA,CAAA58B,IAAA,OAAAkB,MAG1B,WACI,IAAMo4B,EAAStoC,KAAKmqC,QACpB7B,EAAOmC,OAAOpB,UACd,IAAML,EAAiBV,EAAOW,gBACxB7B,EAAQkB,EAAOG,OACf5G,EAAMuF,EAAMiE,SAElBS,EAAAt6B,EADe41B,EAAMkE,YACW,GAAzBC,EAAOO,EAAA,GAAE1rC,EAAM0rC,EAAA,GAChB5wC,EAAOotC,EAAOE,MAAMxtC,IAAI6mC,GACxB2J,EAAUtwC,EAAKF,IAAIuwC,GACnBn0C,EAAM4xC,EAAe31B,UAAUm4B,GAErC,OADeA,EAAQvS,MAAM74B,EAAQ,EAAGhJ,IAAQ4xC,EAAep2C,SAAS,IAEpE,IAAK,OACD,GAAG24C,EAAUrwC,EAAKtI,SAAS,EAAG,CAC1B,IAAMyzC,EAAKnrC,EAAKF,IAAIuwC,EAAU,GACV,SAAjBC,EAAQ7kB,MAA+B,SAAZ0f,EAAG1f,KAC7BygB,EAAMe,UAAU,CAACoD,EAAU,EAAGlF,EAAG0F,eAEjC3E,EAAMe,UAAU,CAACoD,EAAU,EAAGlF,EAAG0F,oBAElC,GAAG30C,EAAM4xC,EAAep2C,SAAS,EAAG,CACvC,IAAMo5C,EAAWnK,EAAM,EACjBzhC,EAAS4oC,EAAehuC,IAAI5D,EAAM,GAAG20C,aAC3C3E,EAAMc,OAAO8D,GACb5E,EAAMe,UAAU,CAAC,EAAG/nC,IAExB,MACJ,IAAK,OACDgnC,EAAMe,UAAU,EAAG/nC,EAAS,GAIpCgnC,EAAM5T,UACN8U,EAAOtW,0BACPsW,EAAOr5B,OAAOiI,cACjB00B,GAvCkCV,IAwCtCv5B,EAxCYi6B,GACK/G,OAAAA,IAwCLoH,IAAAA,YAAcC,GAAAt+B,EAAAq+B,EAAAC,GAAA,IAAA7N,EAAAvwB,EAAAm+B,GAAA,SAAAA,IAAA,OAAAh+B,OAAAg+B,GAAA5N,EAAA9U,MAAAvpB,KAAAS,WAStB,OATsBsO,EAAAk9B,EAAA,CAAA,CAAAj9B,IAAA,OAAAkB,MAGvB,WACIlQ,KAAKmqC,QAAQM,OAAOpB,UACpB,IAAM8C,EAAUnsC,KAAKmqC,QAAQ1B,OAAO4C,SAAW,EAC5Cc,GAAW,GACVnsC,KAAKosC,SAASD,OAErBF,GAT+Bf,IAUnCv5B,EAVYs6B,GACKpH,OAAAA,IAULwH,IAAAA,YAAgBC,GAAA1+B,EAAAy+B,EAAAC,GAAA,IAAAtN,EAAAlxB,EAAAu+B,GAAA,SAAAA,IAAA,OAAAp+B,OAAAo+B,GAAArN,EAAAzV,MAAAvpB,KAAAS,WASxB,OATwBsO,EAAAs9B,EAAA,CAAA,CAAAr9B,IAAA,OAAAkB,MAGzB,WACIlQ,KAAKmqC,QAAQM,OAAOpB,UACpB,IAAM8C,EAAUnsC,KAAKmqC,QAAQ1B,OAAO4C,SAAW,EAC5Cc,EAAUnsC,KAAKmqC,QAAQ3B,MAAM51C,UAC5BoN,KAAKosC,SAASD,OAErBE,GATiCnB,IAUrCv5B,EAVY06B,GACKxH,OAAAA,IAUlB,IAAM0H,GAAS,CACXH,SAAQ,SAACD,GACL,IAAM7D,EAAStoC,KAAKmqC,QACd/C,EAAQkB,EAAOG,OACf5G,EAAMuF,EAAMiE,SAElBmB,EAAAh7B,EADe41B,EAAMkE,YACW,GAAzBC,EAAOiB,EAAA,GAAEpsC,EAAMosC,EAAA,GAChBjE,EAAOD,EAAOE,MAEhBiE,EADSlE,EAAKvtC,IAAI6mC,GACF7mC,IAAIuwC,GACpBmB,EAAsBD,EAAS9R,YAChCv6B,EAAS,IACRssC,GAAuBpE,EAAOqE,iBAAiBF,EAAS16B,OAAOvb,UAAU,EAAG4J,KAGhF,IACMwsC,EADWrE,EAAKvtC,IAAImxC,GACEU,iBAAiBH,EAAqBpE,EAAOvC,aAAcuC,EAAOxa,SAAUwa,EAAOza,YAC/GuZ,EAAMc,OAAOiE,GACb/E,EAAMe,UAAUyE,GAEhBxF,EAAM5T,UACN8U,EAAOtW,0BACPsW,EAAOr5B,OAAOiI,YC1HtB,SAAS41B,GAAsBC,EAAOC,EAAOC,EAAezF,GACxD,IAAIuF,EACA,MAAO,CAACE,GAAe,GAE3B,GAAkB,SAAfF,EAAMpmB,MAAkC,SAAfqmB,EAAMrmB,KAAiB,CAC/C,IAAMvmB,EAAS2sC,EAAMh7B,OAAOnf,OAG5B,OAFAm6C,EAAMlE,UAAUkE,EAAMh7B,OAASi7B,EAAMj7B,OAAQy1B,GAC7CuF,EAAMrG,YAAYsG,EAAMrG,SAAUa,GAC3B,CAACpnC,GAAQ,GAEpB,MAAO,CAAC6sC,GAAe,GDoH3B3iC,OAAOK,OAAOshC,GAAe1mB,UAAWgnB,IACxCjiC,OAAOK,OAAO0hC,GAAiB9mB,UAAWgnB,IClH7BW,IAAAA,YAAK9B,GAAAx9B,EAAAs/B,EAAA9B,GAAA,IAAAv9B,EAAAC,EAAAo/B,GAAA,SAAAA,IAAA,IAAAn/B,EAAAE,OAAAi/B,GAAA,IAAA,IAAAC,EAAA1sC,UAAA7N,OAAA0N,EAAAC,IAAAA,MAAA4sC,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAA9sC,EAAA8sC,GAAA3sC,UAAA2sC,GAGC,OAHDz7B,EAAAxD,EAAAJ,EAAAF,EAAAK,KAAAqb,MAAA1b,EAAA,CAAA7N,MAAA7P,OAAAmQ,gBAGH,MAAIyN,EAuLd,OAvLcgB,EAAAm+B,EAAA,CAAA,CAAAl+B,IAAA,OAAAkB,MAEf,SAAK+0B,EAAMzwB,GACP,IAAM8zB,EAAStoC,KAAKmqC,QACd9W,EAAQiV,EAAOmC,OACfrD,EAAQkB,EAAOG,OACfO,EAAiBV,EAAOW,gBACxBoE,EAAW/E,EAAOgF,UAClB9F,EAAUwB,EAAeuE,cAE/B,GADAvE,EAAewE,kBAAkBpG,GAC9B/T,EAAMoa,aACLpa,EAAY,OAACiV,EAAQd,GAClBvC,IAASL,IAA4BK,IAASL,IAK7C,OAJAoE,EAAe0E,iBACf1E,EAAe2E,iBAAiBvG,GAChCpnC,KAAKmqC,QAAQ3W,eACb6Z,EAASO,MAAMpG,EAASwB,EAAe6E,kBAK/C,IAAMhM,EAAMuF,EAAMiE,SACwByC,EAAAt8B,EAAjB41B,EAAMkE,YAAW,GAArCrF,EAAQ6H,EAAA,GAAE1tC,EAAM0tC,EAAA,GACfvF,EAAOD,EAAOE,MACdttC,EAAOqtC,EAAKvtC,IAAI6mC,GAClB2J,EAAUtwC,EAAKF,IAAIirC,GACnB8H,EAAU7yC,EAAKF,IAAIirC,EAAS,GAE5BrY,EAAU,GACd,GAAoB,SAAjB4d,EAAQ7kB,KACPiH,EAAU4d,EAAQz5B,YACf,GAAoB,UAAjBg8B,MAAAA,OAAAA,EAAAA,EAASpnB,MAEf6kB,EAAUuC,EACV3tC,GAFAwtB,EAAUmgB,EAAQh8B,QAEDnf,OACjBw0C,EAAMe,UAAU,CAAClC,EAAS,EAAGrY,EAAQh7B,aAClC,CACH,IAAMo7C,EAAa,IAAIzG,GAAY,OAAQ,IAC3CyB,EAAeiF,aAAazC,EAASwC,GACrCxC,EAAUwC,EAGd,IACIva,EADAC,EAAa9F,EAAQp3B,UAAU,EAAG4J,GAQtC,OALIqzB,EADDzzB,KAAK2zB,SACW/F,EAAQp3B,UAAUwJ,KAAK2zB,SAAS,IAEhC/F,EAAQp3B,UAAU4J,GAG9B6kC,GACH,KAAKL,GACD,GAAG,QAAQsJ,KAAK15B,GAAO,CACnB,IAAIzC,EAASyC,EAAKlW,MAAM,SACxByT,EAASA,EAAOo8B,QAAQ,KAAM,IAC9B,IAAI/2C,EAAM4xC,EAAe31B,UAAUm4B,GAC/Bx4C,EAAI+e,EAAOknB,QACfuS,EAAQ3C,UAAUnV,EAAa1gC,EAAGw0C,GAClC,IAAInC,EAAOxD,EAAM,EAEjB,IADAzqC,IACM2a,EAAOnf,OAAS,GAAG,CACrB,IAAMR,EAAI,IAAIm1C,GAAY,OAAQx1B,EAAOknB,SACzC7mC,EAAEs0C,aAAY,EAAMc,GACpBnC,IACA2D,EAAevC,UAAUrvC,EAAKhF,GAC9BgF,IAEJpE,EAAI+e,EAAOknB,QACX,IAAMmV,EAAUpF,EAAehuC,IAAI5D,GACnC,GAAGg3C,GAA4B,SAAjBA,EAAQznB,KAClBynB,EAAQvF,UAAU71C,EAAIo7C,EAAQr8B,OAAQy1B,OACnC,CACH,IAAMp1C,EAAI,IAAIm1C,GAAY,OAAQv0C,GAClCg2C,EAAevC,UAAUrvC,EAAKhF,GAElCg1C,EAAMc,OAAO7C,GACb+B,EAAMe,UAAU,CAAC,EAAGn1C,EAAEJ,cAEtB8gC,GAAclf,EACd4yB,EAAMe,UAAU,EAAGf,EAAMkE,UAAU,GAAK92B,EAAK5hB,QAC7C44C,EAAQ3C,UAAUnV,EAAaD,EAAc+T,GAEjD,MACJ,KAAK5C,GACD5kC,KAAK2zB,SAAW,CAACD,EAAW9gC,OAAQ8gC,EAAW9gC,QAC/C,MACJ,KAAKgyC,GACDlR,EAAaA,EAAWl9B,UAAU,EAAGwJ,KAAK2zB,SAAS,IACnDD,GAAclf,EACdg3B,EAAQ3C,UAAUnV,EAAaD,EAAc+T,GAC7C,IAAM6G,EAAKruC,KAAK2zB,SAAS,GAAKnf,EAAK5hB,OACnCw0C,EAAMe,UAAU,EAAGkG,GACnBruC,KAAK2zB,SAAS,GAAK0a,EACnB,MACJ,KAAKzJ,GACDlR,EAAaA,EAAWl9B,UAAU,EAAGwJ,KAAK2zB,SAAS,IACnDyT,EAAMe,UAAU,EAAGnoC,KAAK2zB,SAAS,GAAKnf,EAAK5hB,QAC3CoN,KAAK2zB,SAAW,KAChBD,GAAclf,EACdg3B,EAAQ3C,UAAUnV,EAAaD,EAAc+T,GAC7C,MACJ,KAAK5C,GACD4G,EAAQ3C,UAAUnV,EAAY8T,GAC9BgE,EAAQ9E,aAAY,EAAMc,GAC1B,IAAMp1C,EAAI,IAAIm1C,GAAY,OAAQ9T,GAClCuV,EAAesF,YAAY9C,EAASp5C,GACpCg1C,EAAMc,OAAOrG,EAAI,GACjBuF,EAAMe,UAAU,CAAC,EAAG,IACpB,MAEJ,KAAKvD,GAED,OADe4G,EAAQvS,MAAM74B,GAAS,IAElC,IAAK,OACD,IAAIhJ,EAAM4xC,EAAe31B,UAAUm4B,GACnC,GAAGvF,EAAW,EAAG,CAEb+C,EAAet1C,OAAO0D,EAAI,EAAG,GAC7BA,GAAO,EAGP,IAAgGm3C,EAAA/8B,EAArEs7B,GAAsB9D,EAAehuC,IAAI5D,EAAI,GAAIo0C,EAAS,EAAGhE,GAAQ,GAAzFpnC,EAAMmuC,EAAA,GAAUA,EAAA,IAEnBvF,EAAe5W,OAAOh7B,GAE1BgwC,EAAMe,UAAU,CAAClC,GAAY7lC,EAAS,EAAE,EAAE,GAAIA,SAE3C,GAAGhJ,EAAM,EAAG,CAEf,IAAMs0C,EAAS7J,EAAM,EACf8J,EAAapD,EAAKvtC,IAAI0wC,GAAQ94C,SAAW,EACiD47C,EAAAh9B,EAArEs7B,GAAsB9D,EAAehuC,IAAI5D,EAAI,GAAIo0C,EAAS,EAAGhE,GAAQ,GAAzFpnC,EAAMouC,EAAA,GAAUA,EAAA,IAEnBxF,EAAe5W,OAAOh7B,GAE1BgwC,EAAMc,OAAOwD,GACbtE,EAAMe,UAAU,CAACwD,EAAYvrC,IAEjC,MACJ,IAAK,OACDszB,EAAaA,EAAWl9B,UAAU,EAAGk9B,EAAW9gC,OAAS,GACzDw0C,EAAMe,UAAU,EAAGf,EAAMkE,UAAU,GAAG,GACtCE,EAAQ3C,UAAUnV,EAAaD,EAAc+T,GAGrD,MACJ,KAAK5C,GAED,OADoB4G,EAAQvS,MAAM74B,EAAQ,IAEtC,IAAK,OACD,IAAIhJ,EAAM4xC,EAAe31B,UAAUm4B,GACnC,GAAGvF,EAAW/qC,EAAKtI,SAAS,EAAG,CAE3Bo2C,EAAet1C,OAAO0D,EAAI,EAAG,GAC7B,IACmGq3C,EAAAj9B,EAAxEs7B,GAAsBtB,EADhCxC,EAAehuC,IAAI5D,EAAI,GAC4Bo0C,EAAQz5B,OAAOnf,OAAQ40C,GAAQ,GAA5FpnC,EAAMquC,EAAA,GAAUA,EAAA,IAEnBzF,EAAe5W,OAAOh7B,EAAI,GAE9BgwC,EAAMe,UAAU,CAAClC,EAAU7lC,SAExB,GAAGhJ,EAAM4xC,EAAep2C,SAAS,EAAE,CAEtC,IACmG87C,EAAAl9B,EAAxEs7B,GAAsBtB,EADhCxC,EAAehuC,IAAI5D,EAAI,GAC4Bo0C,EAAQz5B,OAAOnf,OAAQ40C,GAAQ,GAA5FpnC,EAAMsuC,EAAA,GAAUA,EAAA,IAEnB1F,EAAe5W,OAAOh7B,EAAI,GAE9BgwC,EAAMe,UAAU,CAAClC,EAAU7lC,IAE/B,MACJ,IAAK,OACDqzB,EAAeA,EAAaj9B,UAAU,GACtCg1C,EAAQ3C,UAAUnV,EAAaD,EAAc+T,IAM7DwB,EAAe0E,iBACf1E,EAAe2E,iBAAiBvG,GAChCiG,EAASO,MAAMpG,EAASwB,EAAe6E,kBACvC7tC,KAAKmqC,QAAQ3W,cAChB0Z,GA1LsBhC,IA6L1Bv5B,EA7LYu7B,GACKvI,OAAAA,ICZLgK,IAAAA,YAAgBvD,GAAAx9B,EAAA+gC,EAAAvD,GAAA,IAAAv9B,EAAAC,EAAA6gC,GAAA,SAAAA,IAAA,OAAA1gC,OAAA0gC,GAAA9gC,EAAA0b,MAAAvpB,KAAAS,WAyBxB,OAzBwBsO,EAAA4/B,EAAA,CAAA,CAAA3/B,IAAA,OAAAkB,MAGzB,WACI,IAAMo4B,EAAStoC,KAAKmqC,QACpB,GAAInqC,KAAK4uC,aAAT,CAGA,IAAM/+B,EAAQy4B,EAAOr5B,OACrBq5B,EAAOuG,sBACPvG,EAAOwG,oBACPxG,EAAOG,OAAOsG,QAAQl/B,GACtBy4B,EAAOtW,6BACV,CAAAhjB,IAAA,aAAAkB,MAED,WACI,IAAI8gB,GAAO,EACLsX,EAAStoC,KAAKmqC,QAOpB,OANA7B,EAAO54B,cAAc,IAAIqP,GAAW,OAAQ,CACxC9uB,OAAQq4C,EACR/oB,eAAc,WACVyR,GAAO,MAGRA,MACV2d,GAzBiCzD,IA0BrCv5B,EA1BYg9B,GACK7J,OAAAA,IA0BLkK,IAAAA,YAAgBnD,GAAAj+B,EAAAohC,EAAAnD,GAAA,IAAA1gB,EAAArd,EAAAkhC,GAAA,SAAAA,IAAA,OAAA/gC,OAAA+gC,GAAA7jB,EAAA5B,MAAAvpB,KAAAS,WASxB,OATwBsO,EAAAigC,EAAA,CAAA,CAAAhgC,IAAA,OAAAkB,MAGzB,WACI,IAAMo4B,EAAStoC,KAAKmqC,QACpB7B,EAAOuG,sBACPvG,EAAOG,OAAOjV,UACd8U,EAAOtW,0BACPsW,EAAOmC,OAAOpB,cACjB2F,GATiC9D,IAUrCv5B,EAVYq9B,GACKlK,OAAAA,IAWLmK,IAAAA,YAAkB/C,GAAAt+B,EAAAqhC,EAAA/C,GAAA,IAAA7N,EAAAvwB,EAAAmhC,GAAA,SAAAA,IAAA,OAAAhhC,OAAAghC,GAAA5Q,EAAA9U,MAAAvpB,KAAAS,WAmB1B,OAnB0BsO,EAAAkgC,EAAA,CAAA,CAAAjgC,IAAA,OAAAkB,MAG3B,WACI,IAAMo4B,EAAStoC,KAAKmqC,QACpB7B,EAAOuG,sBACP,IAAMzH,EAAQkB,EAAOG,OACfpV,EAAQiV,EAAOmC,OACflC,EAAOD,EAAOE,MACd3G,EAAMuF,EAAMiE,SACZnwC,EAAOqtC,EAAKvtC,IAAI6mC,GAChBoE,EAAW/qC,EAAKtI,SAAW,EACjCygC,EAAMqX,gBAAgB,CAAC7I,EAAK,EAAG,IAC/BxO,EAAMsX,SAAS,CACX9I,EAAKoE,EAAU/qC,EAAKg0C,OAAOzD,eAE/BpY,EAAM8b,YAAY/H,GAClB/T,EAAM/K,SACNggB,EAAOtW,8BACVid,GAnBmC/D,IAoBvCv5B,EApBYs9B,GACKnK,OAAAA,IC1CLsK,IAAAA,YAAchE,GAAAx9B,EAAAwhC,EAAAhE,GAAA,IAAAv9B,EAAAC,EAAAshC,GAAA,SAAAA,IAAA,OAAAnhC,OAAAmhC,GAAAvhC,EAAA0b,MAAAvpB,KAAAS,WAMtB,OANsBsO,EAAAqgC,EAAA,CAAA,CAAApgC,IAAA,OAAAkB,MAEvB,WACkBlQ,KAAKmqC,QAAQM,OACrBC,gBAAgB,MACtB1qC,KAAKmqC,QAAQkF,aAAY,OAC5BD,GAN+BlE,IAOnCv5B,EAPYy9B,GACKvK,OAAAA,IAQLyK,IAAAA,YAAgBzD,GAAAj+B,EAAA0hC,EAAAzD,GAAA,IAAA1gB,EAAArd,EAAAwhC,GAAA,SAAAA,IAAA,OAAArhC,OAAAqhC,GAAAnkB,EAAA5B,MAAAvpB,KAAAS,WAQxB,OARwBsO,EAAAugC,EAAA,CAAA,CAAAtgC,IAAA,OAAAkB,MAGzB,WACI,IAAMmjB,EAAQrzB,KAAKmqC,QAAQM,OACrBrD,EAAQpnC,KAAKmqC,QAAQ1B,OAC3BpV,EAAMqX,gBAAgBtD,EAAMC,WAC5BrnC,KAAKmqC,QAAQkF,aAAY,OAC5BC,GARiCpE,IASrCv5B,EATY29B,GACKzK,OAAAA,IAUL0K,IAAAA,YAAmBrD,GAAAt+B,EAAA2hC,EAAArD,GAAA,IAAA7N,EAAAvwB,EAAAyhC,GAAA,SAAAA,IAAA,OAAAthC,OAAAshC,GAAAlR,EAAA9U,MAAAvpB,KAAAS,WAa3B,OAb2BsO,EAAAwgC,EAAA,CAAA,CAAAvgC,IAAA,OAAAkB,MAG5B,WACI,IAAMo4B,EAAStoC,KAAKmqC,QACpB7B,EAAOuG,sBACP,IAAMzH,EAAQpnC,KAAKmqC,QAAQ1B,OACrBpV,EAAQrzB,KAAKmqC,QAAQM,OAC3BpX,EAAMsX,SAASvD,EAAMC,WACrBhU,EAAM/K,SACN+K,EAAM8b,YAAY/H,GAClBA,EAAM5T,UACN8U,EAAOtW,8BACVud,GAboCrE,IAcxCv5B,EAdY49B,GACKzK,OAAAA,ICrBL0K,IAAAA,YAAYpE,GAAAx9B,EAAA4hC,EAAApE,GAAA,IAAAv9B,EAAAC,EAAA0hC,GAAA,SAAAA,IAAA,OAAAvhC,OAAAuhC,GAAA3hC,EAAA0b,MAAAvpB,KAAAS,WAiBpB,OAjBoBsO,EAAAygC,EAAA,CAAA,CAAAxgC,IAAA,OAAAkB,MAErB,WACI,IAAMo4B,EAAStoC,KAAKmqC,QACd/C,EAAQkB,EAAOG,OACfpV,EAAQiV,EAAOmC,OACflC,EAAOD,EAAOE,MACd3G,EAAM0G,EAAK31C,SAAW,EACtBsI,EAAOqtC,EAAKvtC,IAAI6mC,GAChBoE,EAAW/qC,EAAKtI,SAAW,EACjCygC,EAAMqX,gBAAgB,CAAC,EAAG,EAAG,IAC7BrX,EAAMsX,SAAS,CACX9I,EAAKoE,EAAU/qC,EAAKg0C,OAAOzD,eAE/BpY,EAAM8b,YAAY/H,GAClB/T,EAAM/K,SACNggB,EAAOtW,8BACVwd,GAjB6BtE,IAkBjCv5B,EAlBY69B,GACK3K,OAAAA,ICDL4K,IAAAA,YAAWrE,GAAAx9B,EAAA6hC,EAAArE,GAAA,IAAAv9B,EAAAC,EAAA2hC,GAAA,SAAAA,IAAA,OAAAxhC,OAAAwhC,GAAA5hC,EAAA0b,MAAAvpB,KAAAS,WAOnB,OAPmBsO,EAAA0gC,EAAA,CAAA,CAAAzgC,IAAA,OAAAkB,MAEpB,WACIlQ,KAAKmqC,QAAQM,OAAOpB,UACpBrpC,KAAKmqC,QAAQmD,UAAUpD,OACvBlqC,KAAKmqC,QAAQ3W,cAEhBic,GAP4BvE,IAQhCv5B,EARY89B,GACK5K,OAAAA,IASL6K,IAAAA,YAAW7D,GAAAj+B,EAAA8hC,EAAA7D,GAAA,IAAA1gB,EAAArd,EAAA4hC,GAAA,SAAAA,IAAA,OAAAzhC,OAAAyhC,GAAAvkB,EAAA5B,MAAAvpB,KAAAS,WAMnB,OANmBsO,EAAA2gC,EAAA,CAAA,CAAA1gC,IAAA,OAAAkB,MAEpB,WACIlQ,KAAKmqC,QAAQM,OAAOpB,UACpBrpC,KAAKmqC,QAAQmD,UAAUjD,OACvBrqC,KAAKmqC,QAAQ3W,cAChBkc,GAN4BxE,IAOhCv5B,EAPY+9B,GACK7K,OAAAA,ICwBZ8K,IChBIC,GAMAC,GACAlhD,GDSJghD,YAASr+B,GAAA1D,EAAA+hC,EAAAr+B,GAAA,IAAAzD,EAAAC,EAAA6hC,GAMX,SAAAA,EAAY3hC,GAAS,IAAAD,EA4DO,OA5DPE,OAAA0hC,IACjB5hC,EAAAF,EAAAK,UAAMF,IACDuG,UAAUvG,GACfD,EAAK0H,WAAWzH,GAEhBD,EAAKu/B,UAAY,IAAI/D,GACrBx7B,EAAKu/B,UAAUnD,QAAOh8B,EAAAJ,GACtBA,EAAK06B,OAAS,IAAIvD,GAClBn3B,EAAK08B,OAAS,IAAI7C,GAClB75B,EAAK+hC,kBAAev6C,EAEpBwY,EAAKigB,UAAYhgB,EAAQggB,WAAa,cACtCjgB,EAAK8f,WAAa7f,EAAQ6f,YAAc,6NACxC9f,EAAK+f,SAAW9f,EAAQ8f,UAAY,OACpC/f,EAAKggB,WAAa/f,EAAQ+f,YAAc,GACxChgB,EAAKg4B,aAAe/3B,EAAQ+3B,cAAgB,EAC5Ch4B,EAAKgiC,UAAY/hC,EAAQ+hC,WAAa,EACtChiC,EAAKygB,YAAcxgB,EAAQwgB,aAAe,MAC1CzgB,EAAKkgB,iBAAmBjgB,EAAQigB,kBAAoB,OACpDlgB,EAAK6gB,YAAc5gB,EAAQ4gB,aAAe,UAC1C7gB,EAAK8gB,eAAiB7gB,EAAQ6gB,gBAAkB,YAChD9gB,EAAKkX,SAAWjX,EAAQiX,UAAY,EAGpClX,EAAKiiC,SAAW,WACZ,IAAMhK,EAAWh4B,EAAQgiC,WAIzB,OAHuB,IAApBhK,EAASpzC,QAAqD,SAArCozC,EAASA,EAASpzC,OAAO,GAAG+zB,MACpDqf,EAASzxC,KAAK,IAAIgzC,GAAY,OAAQ,KAEnCvB,GAIXj4B,EAAKy6B,MAAQ,IAAIhD,GACjBz3B,EAAKk7B,gBAAkBzC,GAAoBZ,OAAO73B,EAAKiiC,YACvDjiC,EAAK+gB,QAAU,CACXC,SAAS,EACTkhB,UAAU,GAIdliC,EAAKmiC,SAAW,IAAIC,IACpBpiC,EAAKqiC,cAAczB,IACnB5gC,EAAKqiC,cAAcpB,IACnBjhC,EAAKqiC,cAAchB,IACnBrhC,EAAKqiC,cAAcd,IACnBvhC,EAAKqiC,cAAcb,IACnBxhC,EAAKqiC,cAAclD,IACnBn/B,EAAKqiC,cAAcjF,IACnBp9B,EAAKqiC,cAAcxE,IACnB79B,EAAKqiC,cAAcnE,IACnBl+B,EAAKqiC,cAAc/D,IACnBt+B,EAAKqiC,cAAcZ,IACnBzhC,EAAKqiC,cAAcnB,IAGnBlhC,EAAKqiC,cAAcX,IACnB1hC,EAAKqiC,cAAcV,IACnB3hC,EAAK8hB,kBAEL9hB,EAAKuX,cAAgB,GAAGvX,EA2gB3B,OA1gBAgB,EAAA4gC,EAAA,CAAA,CAAA3gC,IAAA,oBAAAhU,IAjED,WACI,OAAOgF,KAAKouB,YAAc8B,SAASlwB,KAAK8tB,YAC3C,CAAA9e,IAAA,gBAAAkB,MAiED,SAAcmgC,GACNrwC,KAAKkwC,SAAS79B,IAAIg+B,EAAI9N,OACtBviC,KAAKkwC,SAAS1gC,IAAI6gC,EAAI9N,KAAM8N,EAAIzK,OAAO5lC,SAE9C,CAAAgP,IAAA,kBAAAkB,MAED,WAAkB,IAAAC,EAAAnQ,KACdA,KAAKvP,iBAAiB,YAAY,SAACioB,GAC5BA,EAAMlI,gBAAkBL,IAG3BuI,EAAM9I,OAAOa,SAAU,EACpBN,EAAK2e,QAAQC,SACZ5e,EAAKmgC,YAAYxL,QAGzB9kC,KAAKvP,iBAAiB,SAAS,SAACioB,GAK5B,IAAI63B,EAJD73B,EAAMlI,gBAAkBL,IAG3BuI,EAAM9I,OAAOa,SAAU,EAIf8/B,EAFLpgC,EAAK2e,QAAQC,QACT5e,EAAK2e,QAAQO,QACHyV,GAEAA,GAGJA,GAEb30B,EAAKmgC,YAAYC,OAGrBvwC,KAAKvP,iBAAiB,QAAQ,SAACioB,GAC3BvI,EAAK2e,QAAQC,SAAU,EACpB5e,EAAK2/B,cACJ3/B,EAAK2/B,aAAarrB,UAEnBtU,EAAK9B,UACJ8B,EAAKlB,OAAOiI,UAGhB/G,EAAKT,cAAc,IAAIqP,GAAW,SAAU,CACxC9uB,OAAQkgB,EACRqgC,aAAcrgC,EAAK84B,gBAAgBrzC,UAGvCua,EAAKs6B,OAAOpB,UACZl5B,EAAKs4B,OAAOgI,mBAGhBzwC,KAAKvP,iBAAiB,sBAAsB,SAACioB,GACzC,GAAGvI,EAAK2e,QAAQC,UAAY5e,EAAK2e,QAAQO,QAAS,CAC9C3W,EAAM9I,OAAOa,SAAU,EACvBiI,EAAM9I,OAAO2P,iBAEb,IAAMvoB,EAAQmZ,EAAKqW,UACbtzB,EAAIid,EAAK8gB,wBAAwBj6B,GAEjCq8B,EAAQljB,EAAKs6B,OACnBpX,EAAMqX,gBAAiBx3C,CAAAA,EAAE2uC,KAAG1xC,OAAAyb,EAAK1Y,EAAEuuC,UACnC,IAAM5xB,EAAQ6I,EAAM9I,OAAOC,MACvBwiB,GAAQ,EACNjgC,EAAK,SAAAuN,GACPwQ,EAAK2e,QAAQC,SAAU,EACvBsD,GAAQ,EACR,IAAQ1Z,EAAqBhZ,EAArBgZ,QAASC,EAAYjZ,EAAZiZ,QACX9lB,EAAI+c,EAAM+S,oBAAoB,CAACjK,EAASC,IAC9C/I,EAAMgE,OAAO4S,SAAS3zB,GACtB,IAAMkE,EAAQmZ,EAAKqW,UACbtzB,EAAIid,EAAK8gB,wBAAwBj6B,GAEvCq8B,EAAMsX,SAAUz3C,CAAAA,EAAE2uC,KAAG1xC,OAAAyb,EAAK1Y,EAAEuuC,UAC5BpO,EAAM/K,UACPplB,KAAKiN,GAERliB,SAASwC,iBAAiB,cAAe2B,GACzCnE,SAASwC,iBAAiB,aAAa,SAACkP,GACpC1R,SAASsC,oBAAoB,cAAe6B,GAC5CihC,EAAMqX,gBAAgB,MAClBrY,IAGJgB,EAAM8b,YAAYh/B,EAAKs4B,QACvBt4B,EAAK2e,QAAQC,SAAU,EACvB5e,EAAK2/B,aAAaje,WACnB,CACCrhC,MAAM,QAKlBwP,KAAKvP,iBAAiB,aAAa,WAC/B0f,EAAK0+B,sBACL1+B,EAAK2e,QAAQmhB,UAAW,KAE5BjwC,KAAKvP,iBAAiB,YAAY,WAC9B0f,EAAK0+B,yBAET7uC,KAAKvP,iBAAiB,aAAa,WAC/B0f,EAAK2e,QAAQmhB,UAAW,KAG5B,IAAMS,EAAU,SAACh4B,GACb,GAAIvI,EAAK2e,QAAQmhB,SAAjB,CAGAv3B,EAAM9I,OAAOa,SAAU,EACvBN,EAAK2e,QAAQmhB,UAAW,EACxB,IAAM7I,EAAQj3B,EAAKs4B,OACb5G,EAAMuF,EAAMiE,SACZ5J,EAAS2F,EAAMkE,YACfpwC,EAAOiV,EAAKq4B,MAAMxtC,IAAI6mC,GAC5B0D,EAAA/zB,EAAwBiwB,EAAM,GAAzB8J,EAAOhG,EAAA,GAAEnlC,EAAMmlC,EAAA,GACdiG,EAAUtwC,EAAKF,IAAIuwC,GACnBwC,EAAU7yC,EAAKF,IAAIuwC,EAAQ,GAC7BvC,EAAiB74B,EAAK84B,gBAEtB7xC,EAAM4xC,EAAe31B,UAAUm4B,GACf,SAAjBA,EAAQ7kB,MAAoC,UAAjBonB,MAAAA,SAAAA,EAASpnB,QACnCvmB,EAAS2tC,EAAQh8B,OAAOnf,OACxBwE,EAAM4xC,EAAe31B,UAAU06B,IAGnC,IAAM4C,EAAa3H,EAAep2C,SAClCud,EAAKT,cAAc,IAAIqP,GAAW,SAAQE,EAAAA,EACnCvG,GAAAA,EAAM9I,QAAM,GAAA,CACf+W,KAAMjO,EAAMiO,KACZ6pB,aAAcxH,EAAepzC,OAC7BwB,IAAAA,EAAKgJ,OAAAA,MAGT4oC,EAAiB74B,EAAK84B,gBACnB94B,EAAK2e,QAAQC,UACTia,EAAep2C,SAAW+9C,GACzBvJ,EAAMe,UAAU,CACZoD,EAAUvC,EAAep2C,SAAW+9C,EACpC,IAGRxgC,EAAK2/B,aAAaje,SAEnB1hB,EAAK2e,QAAQC,SACZ5e,EAAKs4B,OAAOjV,UAEhBrjB,EAAK6hB,0BACL7hB,EAAKs6B,OAAOpB,YACbnmC,KAAKlD,MACRA,KAAKvP,iBAAiB,WAAYigD,GAClC1wC,KAAKvP,iBAAiB,OAAQigD,KACjC,CAAA1hC,IAAA,cAAAkB,MAED,SAAYH,GACR/P,KAAK8uB,QAAQO,QAAUtf,IAC1B,CAAAf,IAAA,cAAAkB,MAED,SAAY+0B,GACIjlC,KAAKkwC,SAASl1C,IAAIiqC,GAC1B2L,SACP,CAAA5hC,IAAA,oBAAAkB,MAED,WAAoB,IAAAsb,EAAAxrB,KACV6P,EAAQ7P,KAAKiP,OACnBjP,KAAK8vC,aAAe,IAAI/K,GAAYl1B,EAAM+hB,YAC1C5xB,KAAK8vC,aAAar/C,iBAAiBk0C,IAA2B,SAAAhlC,GAC1D,IAAMslC,EAAOtlC,EAAEiQ,OAAOq1B,KACtBzZ,EAAK8kB,YAAYrL,MAGrBjlC,KAAK8vC,aAAar/C,iBAAiBk0C,IAAqB,SAAAhlC,GACpD,IAAMslC,EAAOtlC,EAAEiQ,OAAOq1B,KAChBzwB,EAAO7U,EAAEiQ,OAAO4E,KACVgX,EAAK0kB,SAASl1C,IAAI2pC,IAC1BiM,KAAK3L,EAAMzwB,MAEnBxU,KAAK8uB,QAAQC,SAAU,EACvBlf,EAAMkiB,iBAAiB/xB,QAC1B,CAAAgP,IAAA,sBAAAkB,MAED,WACI,IAAMlZ,EAAQgJ,KAAKwmB,UACb4gB,EAAQpnC,KAAKyoC,OACnBoI,EAAwB7wC,KAAKixB,wBAAwBj6B,GAA7C6qC,EAAGgP,EAAHhP,IAAKJ,EAAMoP,EAANpP,OACb2F,EAAMc,OAAOrG,GACbuF,EAAMe,UAAU1G,KACnB,CAAAzyB,IAAA,UAAAkB,MAED,WACIlQ,KAAK6Q,gBACL7Q,KAAKgyB,0BACLhyB,KAAKiP,OAAOiI,YACf,CAAAlI,IAAA,sBAAAkB,MAED,WACIlQ,KAAKipC,gBAAkBzC,GAAoBZ,OAAO5lC,KAAKgwC,cAC1D,CAAAhhC,IAAA,0BAAAkB,MAED,SAAwBlZ,GACpB,IAAA6rB,EAAArR,EAAexa,EAAK,GAAbnF,EAACgxB,EAAA,GAAE/wB,EAAC+wB,EAAA,GAEL0lB,EAAOvoC,KAAKwoC,MAGZ7vB,EAAU9mB,EAFNmO,KAAKzR,MAAM,EAGfqqB,EAAU9mB,EAFNkO,KAAKxR,OAAO,EAGhBqzC,EAAM0G,EAAKuI,aAAal4B,GAG9B,MAAO,CACHipB,IAAAA,EACAJ,OAJa8G,EAAKvtC,IAAI6mC,GACFgL,iBAAiBl0B,EAAS3Y,KAAK+lC,aAAc/lC,KAAK8tB,SAAU9tB,KAAK6tB,eAK5F,CAAA7e,IAAA,mBAAAkB,MAED,WAAmB,IAQXgjB,EARWtH,EAAA5rB,KACT6hC,EAAM7hC,KAAKyoC,OAAO4C,SAClB5J,EAASzhC,KAAKyoC,OAAO6C,YACrBpwC,EAAO8E,KAAKwoC,MAAMxtC,IAAI6mC,GAC5BiK,EAAAt6B,EAA0BiwB,EAAM,GAAzB8J,EAAOO,EAAA,GAAE1rC,EAAM0rC,EAAA,GAChB9hC,EAAO9O,EAAKF,IAAIuwC,GAChBn0C,EAAM4I,KAAKipC,gBAAgB51B,UAAUrJ,GACrC+jC,EAAU/tC,KAAKipC,gBAAgBjuC,IAAI5D,EAAI,GAEzC+7B,EAAQnzB,KAAK+wC,kBAAkB,EACnC,GAAiB,SAAd/mC,EAAK2c,KAAiB,CACrB,IAAMzzB,EAAI8W,EAAK+H,OAAOvb,UAAU,EAAG4J,GACnC3Q,GAAmB,SAACtB,GAChBA,EAAI4rB,YACJ5rB,EAAI6hC,KAAI7/B,GAAAA,OAAMy7B,EAAKkC,SAAQ,KAAA39B,OAAIy7B,EAAKiC,YACpCqF,EAAKlpB,EAAKqU,QAAUrU,EAAKzb,MAAM,EAAIJ,EAAIkiC,YAAYn9B,GAAG3E,cAG1D2kC,EAAKlpB,EAAKqU,QAAUrU,EAAKzb,MAAM,EAC/B4kC,EAAQnkC,KAAKgK,IAAIm6B,EAAOnpB,EAAKxb,OAAO,GAKxC,OAHc,IAAX4R,GAAgB2tC,GAA4B,SAAjBA,EAAQpnB,OAClCwM,EAAQnkC,KAAKgK,IAAIm6B,EAAO4a,EAAQv/C,OAAO,IAEpC,CAAC0kC,EAAIC,EAAOj4B,EAAKojB,QAASyvB,EAAS/jC,KAC7C,CAAAgF,IAAA,0BAAAkB,MAED,WACI,GAAGlQ,KAAK8uB,QAAQC,QAAS,CACrB,IAAoDiiB,EAAAx/B,EAAvBxR,KAAKixC,mBAAkB,GAA7C/d,EAAE8d,EAAA,GAAE7d,EAAK6d,EAAA,GAAE1yB,EAAO0yB,EAAA,GACnBh6C,EAAQgJ,KAAK2Q,qBAAqB,CAACuiB,EAAI5U,EAAU6U,IACjD5V,EAAavd,KAAKiP,OAAOsO,WACzByW,EAAKhlC,KAAK+J,IAAIwkB,EAAWC,aAAe,IAAKxmB,EAAM,IAEzDgJ,KAAK8vC,aAAaoB,aAAald,EAAIh9B,EAAM,IACzCgJ,KAAK8vC,aAAaje,WAEzB,CAAA7iB,IAAA,SAAAkB,MAGD,SAAO/hB,GACHA,EAAIyB,OACDoQ,KAAK2T,UACJxlB,EAAIk4B,YAAc,GACK,IAAjBrmB,KAAK6O,UACX1gB,EAAIk4B,YAAcrmB,KAAK6O,SAE3B,IAAA0C,EAAAC,EAAiBxR,KAAKoQ,OAAM,GAArBiL,EAAE9J,EAAA,GAAEsJ,EAAEtJ,EAAA,GACP1B,EAAQ7P,KAAKiP,OACbs5B,EAAOvoC,KAAKwoC,MAClBr6C,EAAIo4B,UAAUlL,EAAIR,GAIlB,IAAMmuB,EAAiBhpC,KAAKipC,gBAC5B,GAAGD,EAAenY,UAYd,OAXA1iC,EAAI4rB,YACJ5rB,EAAI6hC,KAAI7/B,GAAAA,OAAM6P,KAAK+tB,WAAU59B,KAAAA,OAAI6P,KAAK8tB,SAAQ39B,KAAAA,OAAI6P,KAAK6tB,YACvD1/B,EAAI+/B,UAAY,SAChB//B,EAAIggC,aAAe,SACnBhgC,EAAI8rB,UAAYja,KAAKiuB,iBACrB9/B,EAAI2iC,SAAS9wB,KAAKwuB,YAAa,EAAG,GAElCxuB,KAAKmxC,cAAchjD,GAEnBA,EAAIo4B,WAAWlL,GAAKR,QACpB1sB,EAAI0B,UAIR1B,EAAI4rB,YACJ5rB,EAAI6hC,KAAI7/B,GAAAA,OAAM6P,KAAK+tB,WAAU59B,KAAAA,OAAI6P,KAAK8tB,SAAQ39B,KAAAA,OAAI6P,KAAK6tB,YACvD1/B,EAAI+/B,UAAY,SAChB//B,EAAIggC,aAAe,SACnBhgC,EAAI8rB,UAAYja,KAAKguB,UACrBua,EAAKpxC,SAAQ,SAAA+D,GACTA,EAAK/D,SAAQ,SAAAkvC,GACM,SAAZA,EAAG1f,MACFx4B,EAAI2iC,SAASuV,EAAGt0B,OAAQs0B,EAAGhoB,QAASgoB,EAAG/nB,eAInD0qB,EAAe7xC,SAAQ,SAAA2uC,GACnB,GAAiB,SAAdA,EAAKnf,KAAiB,CACrB,IAAMxX,EAAWU,EAAM6C,sBAAsBozB,EAAK/zB,QAC/C5C,EAASf,UACRjgB,EAAIyB,OACJuf,EAASzf,OAAOvB,GAChBA,EAAI0B,eAKhBmQ,KAAKmxC,cAAchjD,GACnB6R,KAAKoxC,aAAajjD,GAClBA,EAAIo4B,WAAWlL,GAAKR,GACpB1sB,EAAI0B,YACP,CAAAmf,IAAA,gBAAAkB,MAED,SAAc/hB,GACV,GAAG6R,KAAKyoC,OAAO4I,WAAarxC,KAAK8uB,QAAQC,SAAW/uB,KAAK8uB,QAAQmhB,UAAW,CACxE,IAAoDqB,EAAA9/B,EAAvBxR,KAAKixC,mBAAkB,GAA7C/d,EAAEoe,EAAA,GAAEne,EAAKme,EAAA,GAAEhzB,EAAOgzB,EAAA,GACzBnjD,EAAI4rB,YACJ5rB,EAAI6sB,OAAOkY,EAAI5U,EAAU6U,GACzBhlC,EAAI8sB,OAAOiY,EAAI5U,EAAU6U,GACzBhlC,EAAI04B,UAAY,EAChB14B,EAAI24B,YAAc9mB,KAAK4uB,YACvBzgC,EAAI44B,YAEX,CAAA/X,IAAA,eAAAkB,MAED,SAAa/hB,GACT,IAAMklC,EAAQrzB,KAAKyqC,OACnB,GAAGpX,EAAMoa,WAAY,CACjB,IAAMlF,EAAOvoC,KAAKwoC,MACZ3Z,EAAiB7uB,KAAK6uB,eACtB0iB,EAAcvxC,KAAKxR,OACnBgjD,EAAaxxC,KAAKzR,MAClBwhD,EAAY/vC,KAAK+vC,UAC4B0B,EAAAjgC,EAApB6hB,EAAMqe,eAAc,GAA5CC,EAAGF,EAAA,GAAEG,EAAKH,EAAA,GAAEI,EAAQJ,EAAA,GACsBK,EAAAtgC,EAAlB6hB,EAAM0e,aAAY,GAA1CC,EAAGF,EAAA,GAAEG,EAAKH,EAAA,GAAEI,EAAQJ,EAAA,GAC3B,GAAGH,IAAQK,EAAK,CACZ,GAAGJ,IAAUK,GAASJ,GAAYK,EAC9B,OAEJ,IAAMh3C,EAAOqtC,EAAKvtC,IAAI22C,GAClBQ,EAASR,IAAQpJ,EAAK31C,SAAS,EAAI,EAAIm9C,EACrCnsB,EAAM1oB,EAAKo/B,aAAe6X,EAAQj3C,EAAK1M,OAAS+iD,EAAY,EAC5D/iD,EAAS0M,EAAK1M,OACdkJ,EAAKsI,KAAKoyC,uBAAuBl3C,EAAKF,IAAI42C,GAAQC,EAAU1jD,GAC5DyJ,EAAKoI,KAAKoyC,uBAAuBl3C,EAAKF,IAAIi3C,GAAQC,EAAU/jD,GAClEA,EAAI4rB,YACJ5rB,EAAIkiB,KAAK3Y,EAAIksB,EAAMhsB,EAAKF,EAAIlJ,GAC5BL,EAAI8rB,UAAY4U,EAChB1gC,EAAIotB,YAIJ,IAFA,IAAI82B,EAAKV,EACLW,GAAY,EACVD,GAAML,GAAK,CACb,IAAM92C,EAAOqtC,EAAKvtC,IAAIq3C,GAClBF,EAASE,IAAO9J,EAAK31C,SAAS,EAAI,EAAIm9C,EACpCnsB,EAAM1oB,EAAKo/B,aAAe6X,EAAQj3C,EAAK1M,OAAS+iD,EAAY,EAC5D/iD,EAAS0M,EAAK1M,OAEpB,GAAG8jD,EAAW,CACV,IAAMxM,EAAO5qC,EAAKF,IAAI42C,GAChB//C,EAAImO,KAAKoyC,uBAAuBtM,EAAM+L,EAAU1jD,GAChDokD,EAAWr3C,EAAKg0C,OAChB98C,EAAImgD,EAASl0B,QAAUk0B,EAAShkD,MAAM,EAE5CJ,EAAI4rB,YACJ5rB,EAAIkiB,KAAKxe,EAAG+xB,EAAKxxB,EAAIP,EAAGrD,GACxBL,EAAI8rB,UAAY4U,EAChB1gC,EAAIotB,YACD,GAAG82B,IAAOL,EAAI,CACjB,IAAMlM,EAAO5qC,EAAKF,IAAIi3C,GAChBpgD,EAAImO,KAAKoyC,uBAAuBtM,EAAMoM,EAAU/jD,GACtDA,EAAI4rB,YACJ5rB,EAAIkiB,MAAMmhC,EAAW,EAAG5tB,EAAMkiB,EAAKnL,aAAe9oC,EAAIi0C,EAAKznB,QAAUynB,EAAKv3C,MAAM,GAAIC,GACpFL,EAAI8rB,UAAY4U,EAChB1gC,EAAIotB,YAEJptB,EAAI4rB,YACJ5rB,EAAIkiB,MAAMmhC,EAAW,EAAG5tB,EAAK1oB,EAAK3M,MAAOC,GACzCL,EAAI8rB,UAAY4U,EAChB1gC,EAAIotB,OAGR+2B,GAAY,EACZD,QAIf,CAAArjC,IAAA,yBAAAkB,MAED,SAAuBs7B,EAASprC,EAAQjS,GACpC,MAAoB,SAAjBq9C,EAAQ7kB,MAA8B,IAAXvmB,EACnBorC,EAAQntB,QAAUmtB,EAAQj9C,MAAM,EAEpCi9C,EAAQntB,QAAUmtB,EAAQj9C,MAAM,EAAIJ,EAAIkiC,YAAYmb,EAAQz5B,OAAOvb,UAAU,EAAG4J,IAAS7R,QACnG,CAAAygB,IAAA,mBAAAkB,MAED,SAAiB0d,GAAS,IAClBx7B,EADkB2+B,EAAA/wB,KAMtB,OAJAvQ,GAAmB,SAACtB,GAChBA,EAAI6hC,KAAI7/B,GAAAA,OAAM4gC,EAAKjD,SAAQ,KAAA39B,OAAI4gC,EAAKlD,YACpCz7B,EAAIjE,EAAIkiC,YAAYzC,GAASr/B,SAE1B6D,IACV,CAAA4c,IAAA,uBAAAkB,MAED,WACI,MAAO,CACH3hB,MAAOyR,KAAKzR,MACZC,OAAQwR,KAAKxR,UAEpB,CAAAwgB,IAAA,kBAAAkB,MAED,WACI,IAAME,EAASpQ,KAAKoQ,OACdzG,EAAI3J,KAAKzR,MAAO,EAChBitB,EAAIxb,KAAKxR,OAAO,EAChBm1B,EAAMvT,EAAO,GAAKzG,EAClBia,EAAMxT,EAAO,GAAKoL,EAClBqI,EAAMzT,EAAO,GAAKzG,EAClBma,EAAM1T,EAAO,GAAKoL,EAClB/B,EAAKzZ,KAAK8O,cAKhB,OAJA2K,EAAG,GAAKkK,EACRlK,EAAG,GAAKmK,EACRnK,EAAG,GAAKoK,EACRpK,EAAG,GAAKqK,EACDrK,IACV,CAAAzK,IAAA,cAAAkB,MAED,WACI,IAAMgW,EAAelmB,KAAKqO,SAAS8X,kBAC7BC,EAAepmB,KAAKslB,cAI1B,OAFAtlB,KAAKijB,6BAA6BiD,EAAa,GAAIA,EAAa,GAAIE,EAAc,EAAG,GACrFpmB,KAAKijB,6BAA6BiD,EAAa,GAAIA,EAAa,GAAIE,EAAc,EAAG,GAC9EpmB,KAAKslB,gBACf,CAAAtW,IAAA,kBAAAkB,MAED,WACI,OAAOlQ,KAAKslB,gBACf,CAAAtW,IAAA,0BAAAkB,MAED,SAAwBlZ,GACpB,IAAAssB,EAAA9R,EAAiBxa,EAAK,GAAf8rB,EAAEQ,EAAA,GAAEP,EAAEO,EAAA,GACb5R,EAAAF,EAAiBxR,KAAKoQ,OAAM,GAEtBtd,EAAI,CAACgwB,EAFFpR,EAAA,GAEWqR,EAFPrR,EAAA,IAGb,OAAG1R,KAAKqO,UAAYrO,KAAKqO,SAASgV,wBACvBrjB,KAAKqO,SAASgV,wBAAwBvwB,GAEtCA,IAEd,CAAAkc,IAAA,uBAAAkB,MAED,SAAqBlZ,GACjB,IAAAwsB,EAAAhS,EAAiBxa,EAAK,GAAf8rB,EAAEU,EAAA,GAAET,EAAES,EAAA,GACb0D,EAAA1V,EAAiBxR,KAAKoQ,OAAM,GACtBtd,EAAI,CAACgwB,EADFoE,EAAA,GACWnE,EADPmE,EAAA,IAEb,GAAGlnB,KAAKqO,UAAYrO,KAAKqO,SAASsC,qBAC9B,OAAO3Q,KAAKqO,SAASsC,qBAAqB7d,KAEjD,CAAAkc,IAAA,sBAAAkB,MAED,SAAoBlZ,GAChB,IAAAktB,EAAA1S,EAAiBxa,EAAK,GAAf8rB,EAAEoB,EAAA,GAAEnB,EAAEmB,EAAA,GACbwI,EAAAlb,EAAiBxR,KAAKoQ,OAAM,GAE5B,MADU,CAAC0S,EADF4J,EAAA,GACW3J,EADP2J,EAAA,MAGhB,CAAA1d,IAAA,+BAAAkB,MAED,SAA6Bld,EAAGC,EAAGiwB,EAAKC,EAAMC,GAC1CF,EAAIC,GAAQnwB,EAAIgN,KAAKoQ,OAAO,GAC5B8S,EAAIE,GAAQnwB,EAAI+M,KAAKoQ,OAAO,KAC/B,CAAApB,IAAA,QAAAkB,MAED,SAAMlZ,EAAOyc,GACT,IAAM3gB,EAAIkN,KAAK4iB,oBAAoB5rB,GAC7B6Y,EAAQ7P,KAAKiP,OACnBjP,KAAKwmB,UAAY1zB,EACjB,IAAI0/C,EAAgB,GACGxyC,KAAKipC,gBACb9xC,SAAQ,SAAA2uC,GACnB,GAAiB,SAAdA,EAAKnf,KAAiB,CACrB,IAAMxX,EAAWU,EAAM6C,sBAAsBozB,EAAK/zB,QAC/C5C,EAASf,SACRokC,EAAcj+C,KAAK4a,OAI/B,IAAMlf,EAAS+P,KAAK6T,OAAO4S,SAAS3zB,EAAG2gB,GAAW,SAAChgB,GAAC,OAAK++C,EAAchnC,SAAS/X,MAEhF,GAAGxD,EAAQ,OAAOA,EAElB,IAAMmgB,EAASpQ,KAAKoQ,OACdzG,EAAI3J,KAAKzR,MAAO,EAChBitB,EAAIxb,KAAKxR,OAAO,EACtB,OAAOwI,EAAM,GAAKoZ,EAAO,GAAKzG,GACvB3S,EAAM,GAAKoZ,EAAO,GAAKzG,GACvB3S,EAAM,GAAKoZ,EAAO,GAAKoL,GACvBxkB,EAAM,GAAKoZ,EAAO,GAAKoL,IACjC,CAAAxM,IAAA,QAAAkB,MAED,WAAQ,IAAA+hB,EAAAjyB,KAWJ,OAVU,IAAIqtB,GAAY,CACtB9+B,MAAOyR,KAAKzR,MACZC,OAAQwR,KAAKxR,OACb++B,MAAO,SAACp/B,GACJ,IAAAskD,EAAAjhC,EAAiBygB,EAAK7hB,OAAM,GAArBiL,EAAEo3B,EAAA,GAAE53B,EAAE43B,EAAA,GACbtkD,EAAIo4B,WAAWlL,EAAK4W,EAAK1jC,MAAM,GAAIssB,EAAKoX,EAAKzjC,OAAO,GACpDyjC,EAAKviC,OAAOvB,QAKvB,CAAA6gB,IAAA,UAAAkB,MAED,WACOlQ,KAAKiP,OAAOimB,OAAO/lB,WAAanP,MAC/BA,KAAKiP,OAAO6kB,WAEnB6b,GA7kBmB3+B,IAglBxB1G,OAAOK,OAAOglC,GAAUpqB,UAAWpR,IACnC7J,OAAOK,OAAOglC,GAAUpqB,UAAWhQ,IACnCjL,OAAOK,OAAOglC,GAAUpqB,UAAW,CAE/BvP,sBAAqBA,aACrBhB,sBAAqBA,aACrBiB,OAAM,WAAG,IAAAsc,EAAAvyB,KACDouB,EAAapuB,KAAK+wC,kBAChB/H,EAAiBhpC,KAAKipC,gBACtBV,EAAOvoC,KAAKwoC,MAClB,GAAGQ,EAAenY,UAAW,CACzB,IAAItiC,EAAQ,EACN6D,EAAI42C,EAAehuC,IAAI,GAiB7B,OAhBAvL,GAAmB,SAACtB,GAChBA,EAAI6hC,KAAI7/B,GAAAA,OAAMoiC,EAAKzE,SAAQ,KAAA39B,OAAIoiC,EAAK1E,YACpCt/B,EAAQJ,EAAIkiC,YAAYkC,EAAK/D,aAAajgC,SAEjCg6C,EAAKmK,SAAS,CACvBlkD,OAAQ4/B,EACRkM,aAAclM,IAEbukB,OAAO,EAAGvgD,GACfkY,OAAOK,OAAOvY,EAAG,CACbisB,SAAU9vB,EAAM,EAChBC,OAAQ4/B,EACRwY,QAAQ,IAEZ5mC,KAAKzR,MAAQA,OACbyR,KAAKxR,OAAS4/B,GAGlB,IAAMve,EAAQ7P,KAAKiP,OACnBxf,GAAmB,SAACtB,GAChBA,EAAI6hC,KAAI7/B,GAAAA,OAAMoiC,EAAKzE,SAAQ,KAAA39B,OAAIoiC,EAAK1E,YACpCmb,EAAe7xC,SAAQ,SAAAq0C,GACC,SAAjBA,EAAQ7kB,MAAmB6kB,EAAQ71B,QAClC61B,EAAQj9C,MAAQJ,EAAIkiC,YAAYmb,EAAQz5B,QAAQxjB,MAChDi9C,EAAQ71B,OAAQ,SAI5B,IAAMi9B,EAAW,IAAIpN,GACrBoN,EAASF,SAAS,CACdlkD,OAAQ4/B,IAEZ,IAAIlzB,EAAO03C,EAAS53C,IAAI,GACpBw/B,EAAY,EACZK,EAAW,EACX0X,EAAW,KACTxC,EAAY/vC,KAAK+vC,UACjBhK,EAAe/lC,KAAK+lC,aAC1BiD,EAAe7xC,SAAQ,SAAAq0C,GAGnB,GAFAtwC,EAAK3G,KAAKi3C,GACVA,EAAQ7Q,YAAcz/B,EAAK3M,MACP,SAAjBi9C,EAAQ7kB,KACP6kB,EAAQh9C,OAAS4/B,EACjBlzB,EAAK3M,OAASi9C,EAAQj9C,MACnBi9C,EAAQ7E,WACPnM,GAAct/B,EAAK1M,OAASuhD,EAC5B70C,EAAKo/B,aAAeE,EACpBK,EAAW7rC,KAAKgK,IAAIkC,EAAK3M,MAAOssC,GAChC3/B,EAAOyqC,GAAKC,OAAO,CACfp3C,OAAQ4/B,IAEZwkB,EAASr+C,KAAK2G,QAEf,CACH,IAAM6hC,EAAOltB,EAAM6C,sBAAsB84B,EAAQz5B,QACjDy5B,EAAQh9C,OAASuuC,EAAKvuC,OACtB0M,EAAK1M,OAASQ,KAAKgK,IAAIkC,EAAK1M,OAAQuuC,EAAKvuC,QACzC,IAAMwzB,EAAWuwB,GAA8B,SAAlBA,EAAS5rB,KAAoCof,EAAJ,EAAbA,EACzD7qC,EAAK3M,OAASwuC,EAAKxuC,MAAMyzB,EAE7BuwB,EAAW/G,KAGfxC,EAAekG,OAAOtI,QAAS,EAC/BpM,GAAat/B,EAAK1M,OAClB0M,EAAKo/B,aAAeE,EAGpB,IACMzR,GAHN8R,EAAW7rC,KAAKgK,IAAIgH,KAAKilB,SAAUj2B,KAAKgK,IAAIkC,EAAK3M,MAAOssC,KAGpC,EAChBz/B,IAFOo/B,EAAU,GAGjBqY,EAAc,EAElBD,EAASz7C,SAAQ,SAAA5E,GACb,IAAQ/D,EAAyB+D,EAAzB/D,OAAQ8rC,EAAiB/nC,EAAjB+nC,aACVhc,EAAUljB,EAAKy3C,EAAcrkD,EAAS,EAC5C+D,EAAE+rB,QAAUA,EACZ,IAAIw0B,GAAW/pB,EACXqd,EAAS,KACb7zC,EAAE4E,SAAQ,SAAAkvC,GACN,GAAe,SAAZA,EAAG1f,KACF0f,EAAG/nB,QAAUA,EACb+nB,EAAGhoB,QAAUy0B,EAAUzM,EAAG93C,MAAM,EAChCukD,GAAWzM,EAAG93C,UACX,CACH,IAAM6tC,EAAavsB,EAAM6C,sBAAsB2zB,EAAGt0B,QAC5CghC,GAAiB3M,GAA0B,SAAhBA,EAAOzf,KAClC3E,EAAS+wB,EAA4B,EAAbhN,EAAiBA,EAC/CM,EAAG93C,MAAQ6tC,EAAW7tC,MACtB83C,EAAG/nB,QAAUA,EACb+nB,EAAGhoB,QAAUy0B,EAAUzM,EAAG93C,MAAM,GAAKwkD,EAAe/wB,EAAO,EAAI,GAC/Doa,EAAWhsB,OAAS,CAACi2B,EAAGhoB,QAASgoB,EAAG/nB,SACpCw0B,GAAYzM,EAAG93C,MAAQyzB,EAE3BokB,EAASC,KAEbwM,EAAcvY,KAElBt6B,KAAKwoC,MAAQoK,EACb5yC,KAAKzR,MAAQssC,EACb76B,KAAKxR,OAASgsC,KCjtBZoV,GAKF,uLACEC,GAAO5hD,SAAS4hD,MAAQ5hD,SAAS+kD,qBAAqB,QAAQ,GAC9DrkD,GAAQV,SAASC,cAAc,SAErC2hD,GAAK7Z,YAAYrnC,IACjBA,GAAMg4B,KAAO,WACTh4B,GAAMskD,WAENtkD,GAAMskD,WAAWC,QAAUtD,GAE3BjhD,GAAMqnC,YAAY/nC,SAASklD,eAAevD,SCiBrCwD,GAAQzuB,GAAa0C,IASrBgsB,GAAe1uB,GAAamE,IAS5BwqB,GAAe3uB,GAAagF,IAS5B4pB,GAAe5uB,GAAaoF,GAAS,CAC9ClF,WAAUA,SAACt2B,EAAOC,GACd,MAAO,CAACD,EAAiB,OAATC,EAAkBA,MAW7BglD,GAAuB7uB,GAAa4F,GAAiB,CAC9D1F,WAAUA,SAACt2B,EAAOC,GACd,MAAO,CAACD,EAAOC,EAAiB,MAARD,MAWnBklD,GAAuB9uB,GAAa0E,IAEpCqqB,GAAa/uB,GAAa+B,GAAO,CAC1C7B,oBAAWt2B,EAAOC,EAAQsE,GACtB,IAAMe,EAAI7E,KAAK2kD,KAAK3kD,KAAK+B,KAAKxC,EAAQA,EAAQC,EAASA,GAAU,GACjEsE,EAAE8nB,OAAS/mB,EACX,IAAM8V,EAAQ,EAAJ9V,EACV,MAAO,CAAC8V,EAAGA,MA2BbiqC,YAAKjmC,GAAAC,EAAAgmC,EAAAjmC,GAAA,IAAAE,EAAAC,EAAA8lC,GACP,SAAAA,EAAY5lC,GAAS,IAAAD,EA2GjB,OA3GiBE,OAAA2lC,IACjB7lC,EAAAF,EAAAK,KAAAlO,OACK8P,WAAa,QAIlB/B,EAAK8lC,aAAe,IAAIpzB,GAAazS,EAAQ6lC,cAC7C9lC,EAAKyE,kBACLzE,EAAKyI,YACLzI,EAAKwG,UAAUvG,GACfD,EAAK0H,WAAWzH,GAEhBD,EAAK5f,IAAM,KAEX4f,EAAK/f,OAAS,KAEd+f,EAAK0Q,IAAM,EAEX1Q,EAAK+J,QAAU,GACf/J,EAAK7e,SAAW,KAEtB6e,EAAKlf,MAAQ,KAEPkf,EAAK+lC,YAAc9lC,EAAQ8lC,YAE3B/lC,EAAKgmC,gBAAkB/lC,EAAQgmC,mBAE/BjmC,EAAKkmC,QAAUjmC,EAAQimC,SAAW,EAElClmC,EAAKmmC,QAAUlmC,EAAQkmC,SAAW,GAElCnmC,EAAK2L,gBAAkB1L,EAAQ0L,cAE/B3L,EAAKomC,YAAcnmC,EAAQmmC,YAE3BpmC,EAAKqmC,iBAAmB9pC,OAAOK,OAAO,CAClC0pC,YAAa,CACT/rB,QAAQ,EACRxQ,QAAS,GACTw8B,cAAe,EACfC,wBAAwB,IAE7BvmC,EAAQomC,kBAAoB,IAC/BrmC,EAAKymC,kBAAoBlqC,OAAOK,OAAO,CACnC2d,QAAQ,GACTta,EAAQwmC,mBAAqB,IAGtCzmC,EAAK0mC,QAAU,KACT1mC,EAAK2mC,WAAa,CACd7iD,EAAG,KACHC,EAAG,KACHmqB,UAAU,EACV04B,YAAY,GAEhB5mC,EAAK6mC,eAAiB,CAClB3kD,OAAQ,KACRilB,WAAY,KACZy/B,YAAY,GAGhB5mC,EAAKmB,QAAU,CACXC,SAAU,KACVC,KAAM,KACNylC,OAAQ,KACRC,iBAAiB,EACjBC,aAAa,EAEbxnB,MAAO,CACH4M,MAAO,KACPvpB,QAAS,KACT5Z,MAAO,MAEXgT,KAAM,CACFnY,OAAG0D,EACHzD,OAAGyD,EACHy/C,cAAUz/C,EACV0/C,cAAU1/C,GAEd+Z,OAAQ,CACJ4lC,aAAa,EACbj5B,UAAU,EACV04B,YAAY,EACZplC,aAAa,IAIrBxB,EAAKmnB,OAAS,CACV/lB,SAAU,MAGdpB,EAAKonC,gBAAkB,KAGvBpnC,EAAKqnC,UAAYpnC,EAAQonC,UAEzBrnC,EAAKsnC,UAAY,KACjBtnC,EAAKunC,UAAY,KAEjBvnC,EAAKwnC,KAAOxsC,GAAWC,QAEvB+E,EAAKynC,oBAAqB,EAE1BznC,EAAKwP,WAAa,GAElBxP,EAAKuX,cAAgB,GAErBvX,EAigDH,OAv/CDgB,EAAA6kC,EAAA,CAAA,CAAA5kC,IAAA,mBAAAkB,MAIA,SAAiBulC,GACbnrC,OAAOK,OAAO3K,KAAKkP,QAAS,CACxB2lC,OAAQY,MAIhB,CAAAzmC,IAAA,0BAAAkB,MAIA,SAAwBf,GACpBA,EAASd,SAAWrO,KACpBA,KAAKq1C,UAAYlmC,EACjB7E,OAAOK,OAAO3K,KAAKkP,QAAS,CACxB2lC,OAAQ,CAAC70C,KAAKq1C,WACdp5B,UAAU,MAIlB,CAAAjN,IAAA,6BAAAkB,MAIA,WACI,GAAGlQ,KAAKq1C,UAAW,CAEf,IAAMjlC,EAASpQ,KAAKq1C,UAAUjlC,OAE9B,OADApQ,KAAKq1C,UAAY,KACVjlC,KAGf,CAAApB,IAAA,yBAAAkB,MAGA,WACIlQ,KAAKw1C,oBAAqB,IAE9B,CAAAxmC,IAAA,uBAAAkB,MAGA,WACIlQ,KAAKw1C,oBAAqB,IAE9B,CAAAxmC,IAAA,SAAAkB,MAIA,SAAOwlC,GAAK,IAAAvlC,EAAAnQ,KACR21C,EASI7nD,EAAa4nD,GARb1nD,EAAM2nD,EAAN3nD,OACAG,EAAGwnD,EAAHxnD,IACOswB,EAAGk3B,EAAV9mD,MACO+mD,EAAOD,EAAdpnD,MACQsnD,EAAQF,EAAhBnnD,OACAa,EAASsmD,EAATtmD,UACAC,EAAUqmD,EAAVrmD,WACIqmD,EAAJlnD,KAASknD,EAAHjnD,IAEVsR,KAAKiW,SACLjW,KAAK7R,IAAMA,EACX6R,KAAK4xB,WAAa8jB,EAClB11C,KAAKhS,OAASA,EACdgS,KAAKhS,OAAOqjC,aAAa,cAAc,GACvCrxB,KAAKhS,OAAO8nD,OAAS91C,KACrBA,KAAKud,WAAa,CACdhvB,MAAOc,EACPb,OAAQc,EACRkuB,aAAco4B,EACdn4B,cAAeo4B,GAEnB71C,KAAKye,IAAMA,EAEXze,KAAKgW,wBAEL,IAYI+/B,EAZEj+B,EAAU9X,KAAK8X,QACrBG,EAA6DjY,KAAKkJ,aAAnDgP,EAAOD,EAAd1pB,MAAwB4pB,EAAQF,EAAhBzpB,OAAqB4pB,EAAGH,EAANpmB,EAAWwmB,EAAGJ,EAANnmB,EAC5CkkD,EAAa,CACfnkD,EAAGimB,EACHhmB,EAAGgmB,EACHvpB,MAAOqnD,EAAoB,EAAV99B,EACjBtpB,OAAQqnD,EAAqB,EAAV/9B,GAEjB5oB,EAAW,CAAE2C,EAAG,EAAGC,EAAG,EAAG6mB,QAAS,EAAGC,QAAS,GAC9Cq9B,EAAUD,EAAWznD,MAAQ2pB,EAC7Bg+B,EAAUF,EAAWxnD,OAAS2pB,EAC9Bld,EAAQg7C,GAAWC,EAAU,IAAM,IAGrCH,EADD/1C,KAAK8zC,YACS9zC,KAAK8zC,YAEL9kD,KAAK+J,IAAIk9C,EAASC,GAGnCl2C,KAAKnR,MAAQknD,EACVA,EAAa/1C,KAAKi0C,UACjBj0C,KAAKi0C,QAAU8B,GAEhBA,EAAa/1C,KAAKk0C,UACjBl0C,KAAKk0C,QAAU6B,GAEnB,IAAMI,EAAW/9B,EAAM29B,EACjBK,EAAW/9B,EAAM09B,EACjBM,EAAWL,EAAWznD,MACtB+nD,EAAWN,EAAWxnD,OAC5B,GAAGwR,KAAK+zC,gBAAiB,CACrB,IAAAwC,EAAiBv2C,KAAK+zC,gBAAgBoC,EAAUC,EAAUC,EAAUC,EAAUN,EAAWnkD,EAAGmkD,EAAWlkD,EAAG8jD,EAASC,EAAUz9B,EAAKC,EAAKH,EAASC,GAAxItmB,EAAC0kD,EAAD1kD,EAAGC,EAACykD,EAADzkD,EACX5C,EAAS2C,EAAIA,EACb3C,EAAS4C,EAAIA,OAEb5C,EAAS2C,EAAc,MAAVoJ,EAAgB+6C,EAAWnkD,GAAKwkD,EAAWn+B,EAAU69B,GAAc,EAAIj+B,EACpF5oB,EAAS4C,EAAc,MAAVmJ,EAAgB+6C,EAAWlkD,GAAKwkD,EAAWn+B,EAAW49B,GAAc,EAAIj+B,EAGzF5oB,EAASypB,QAAUzpB,EAAS2C,EAAIskD,EAChCjnD,EAAS0pB,QAAU1pB,EAAS4C,EAAIskD,EAChCp2C,KAAK9Q,SAAWA,EAChB8Q,KAAKw2C,gBAAiB,EACnBx2C,KAAKw0C,kBAAkBlsB,QACtBtoB,KAAK0b,cAAc1b,KAAKw0C,mBAM5Bx0C,KAAK8e,WACL9e,KAAKy2C,sBAEL3mD,GAAyB,SAAC2uB,GACtBtO,EAAKsO,IAAMA,EAEXtO,EAAKumC,eACLvmC,EAAKkH,oBACN,SAAC+J,GACAjR,EAAKwmC,mBAAqBv1B,OAKlC,CAAApS,IAAA,iBAAAkB,MAKA,SAAe6B,EAAQ6kC,EAAShQ,GAC5B,IAAMxK,EAAap8B,KAAK0S,sBAAsBX,GAC9C/R,KAAKq1C,UAAY,IAAIhkC,GAEjBrR,KAAKs1C,UAAYsB,EADlBhQ,EAC0B,CACrBpmC,KAAMR,KAAKq1C,UACXlgC,GAAIinB,GAGiB,CACrB57B,KAAM47B,EACNjnB,GAAInV,KAAKq1C,YAIjBr1C,KAAK62C,YAAY,CACb1nC,SAAU4C,IAEd/R,KAAKu1C,KAAOxsC,GAAWE,UAC1B,CAAA+F,IAAA,kBAAAkB,MAED,WACI,OAAOlQ,KAAKu1C,OAASxsC,GAAWE,UAGpC,CAAA+F,IAAA,iBAAAkB,MAIA,SAAelC,GACRhO,KAAKu1C,OAASxsC,GAAWE,SACxBjJ,KAAKs1C,UAAU3vB,UAAU3X,KAGjC,CAAAgB,IAAA,mBAAAkB,MAGA,WACOlQ,KAAKu1C,OAASxsC,GAAWE,SACxBjJ,KAAKs1C,UAAU3vB,UAAU,CACrBxQ,GAAInV,KAAKq1C,cAGpB,CAAArmC,IAAA,YAAAkB,MAED,WACOlQ,KAAKq1C,YACJr1C,KAAKq1C,UAAU5wB,UACfzkB,KAAKq1C,UAAY,MAElBr1C,KAAKs1C,YACJt1C,KAAKs1C,UAAU7wB,UACfzkB,KAAKs1C,UAAY,MAErBt1C,KAAKkX,YACR,CAAAlI,IAAA,mBAAAkB,MAED,WACIlQ,KAAK82C,mBAAoB,IAG7B,CAAA9nC,IAAA,eAAAkB,MAGA,WACI,GAAGlQ,KAAKhS,QAAUgS,KAAK4xB,WAAY,CAC/B,IAAAmlB,E1DzaL,SAAsB/oD,EAAQD,GACjC,IAAAipD,EAAqCjpD,EAAQO,wBAArCC,EAAKyoD,EAALzoD,MAAOC,EAAMwoD,EAANxoD,OAAYwoD,EAAJvoD,KAASuoD,EAAHtoD,IAC7BV,EAAOW,MAAMJ,MAAQA,EAAQ,KAC7BP,EAAOW,MAAMH,OAASA,EAAS,KAC/B,IAAMK,EAAQC,OAAOC,iBAGrB,OAFAf,EAAOO,MAAQS,KAAKC,MAAMV,EAAQM,GAClCb,EAAOQ,OAASQ,KAAKC,MAAMT,EAASK,GAC7B,CACHN,MAAAA,EACAC,OAAAA,EACAa,UAAWrB,EAAOO,MAClBe,WAAYtB,EAAOQ,Q0DmaXkoD,CAAa12C,KAAKhS,OAAQgS,KAAK4xB,YAJxBgkB,EAAOmB,EAAdxoD,MACQsnD,EAAQkB,EAAhBvoD,OACAa,EAAS0nD,EAAT1nD,UACAC,EAAUynD,EAAVznD,WAEJ0Q,KAAKud,WAAa,CACdhvB,MAAOc,EACPb,OAAQc,EACRkuB,aAAco4B,EACdn4B,cAAeo4B,MAG1B,CAAA7mC,IAAA,mBAAAkB,MAED,SAAiB6sB,GACb/8B,KAAKk1B,OAAO/lB,SAAW4tB,IAG3B,CAAA/tB,IAAA,UAAAkB,MAIA,SAAQ6sB,GACJ,IAAMjT,EAAS9pB,KAAK4iB,oBAAoB,CACpC5iB,KAAKud,WAAWC,aAAa,EAC7Bxd,KAAKud,WAAWE,cAAc,IAE9Brd,EAAS28B,EAAK3sB,OACf2sB,EAAK1uB,SAASgV,0BACbjjB,EAAS28B,EAAK1uB,SAASgV,wBAAwBjjB,IAGnD,IAAMyY,GAAUiR,EAAO,GAAK1pB,EAAO,IAAMJ,KAAKnR,MACxCiqB,GAAUgR,EAAO,GAAK1pB,EAAO,IAAMJ,KAAKnR,MAG9CmR,KAAKoa,qBAAqBvB,EAAQC,GAClC9Y,KAAKkX,YACR,CAAAlI,IAAA,wBAAAkB,MAED,WACI,IAAMzd,EAASuN,KAAK6T,OAAO+R,wBAC3B,GAAG5lB,KAAKkJ,aAAc,CAClBlJ,KAAKkJ,aAAeA,GAAazW,GACjC,IAAAurB,EAGIhe,KAAKkJ,aAFF+tC,EAAIj5B,EAAPnsB,EACGqlD,EAAIl5B,EAAPlsB,EAEEjD,EAAQmR,KAAKnR,MACnBmR,KAAK9Q,SAAS2C,EAAImO,KAAK9Q,SAASypB,QAAUs+B,EAAOpoD,EACjDmR,KAAK9Q,SAAS4C,EAAIkO,KAAK9Q,SAAS0pB,QAAUs+B,EAAOroD,OAEjDmR,KAAKkJ,aAAeA,GAAazW,KAExC,CAAAuc,IAAA,sBAAAkB,MAED,WAAsB,IAEdinC,EAFc3rB,EAAAxrB,KACZhS,EAASgS,KAAKhS,OAEpBgS,KAAK6zC,aAAatqB,MAAMvpB,MACxB,IAAMo3C,EAA4B,WAC9B5rB,EAAKqoB,aAAawD,OAAO7rB,GACzBA,EAAKmrB,sBAIT,GAFAQ,EAAkBC,EAEfp3C,KAAKo1C,UAAW,CACf,IAAMkC,EAAkBt3C,KAAKu3C,YAAYr0C,KAAKlD,MACxCw3C,EAAcx3C,KAAKy3C,QAAQv0C,KAAKlD,MAChC03C,EAAmB13C,KAAK23C,aAAaz0C,KAAKlD,MAChDhS,EAAOyC,iBAAiB,aAAa,SAACkP,GAClCA,EAAE4f,oBAENvxB,EAAOyC,iBAAiB,WAAY6mD,GACpCtpD,EAAOyC,iBAAiB,OAAQ+mD,GAChCxpD,EAAOyC,iBAAiB,YAAainD,GACrCP,EAAkB,WACdC,IACAppD,EAAOuC,oBAAoB,WAAY+mD,GACvCtpD,EAAOuC,oBAAoB,OAAQinD,GACnCxpD,EAAOuC,oBAAoB,YAAamnD,IAGhD13C,KAAKykB,QAAU0yB,IAClB,CAAAnoC,IAAA,gBAAAkB,MAED,SAAc0nC,EAAal/B,GAAO,IAAAkT,EAAA5rB,KAC1BhJ,EAAQgJ,KAAK4iB,oBAAoBg1B,GAC/BC,EAAgB7gD,EACtBgJ,KAAKwmB,UAAYxvB,EACjB,IAuBIke,EAvBAilB,EAAQn6B,KAAK6T,OACX4F,EAAKzZ,KAAKoR,cACVnhB,EAASkqC,EAAM1T,SACjBzvB,GAEA,SAACmY,GACG,OAAQyc,EAAK1c,QAAQI,OAAO2M,UACpB9M,IAAayc,EAAKvc,sBAG9B,SAACF,GACG,OAAOjC,GAAUuM,EAAItK,EAASmB,sBAElC8c,EAAYptB,KAAKsU,WA2CrB,GAhCIrkB,GAAUA,EAAOoe,WAAarO,OAC9BkV,EAAakY,EAAU3G,SAASzvB,GAAO,SAACoY,GACpC,IAAIwc,EAAK1c,QAAQI,OAAO2M,SACpB,OAAO,EAEX,IAAM67B,EAAelsB,EAAKvc,mBAC1B,OAAOD,EAAK5O,OAASs3C,GAAgB1oC,EAAK+F,KAAO2iC,MAGrD5iC,IACAA,EAAakY,EAAU3G,SAASzvB,GAAO,SAACoY,GACpC,OAAQA,EAAK2oC,WAIrBztC,OAAOK,OAAO3K,KAAKkP,QAAS,CACxBC,SAAUlf,EACVmf,KAAM8F,EACN4/B,gBAAiB7kD,IAAW+P,KAAKkP,QAAQC,SACzC4lC,YAAa7/B,IAAelV,KAAKkP,QAAQE,OAE7C9E,OAAOK,OAAO3K,KAAKkP,QAAQqe,MAAO,CAC9B4M,MAAAA,EACAvpB,QAjCU5Q,KAkCVhJ,MAAAA,EACA6gD,cAAAA,IAEJvtC,OAAOK,OAAO3K,KAAKkP,QAAQlF,KAAM,CAC7BnY,EAAG+lD,EAAY,GACf9lD,EAAG8lD,EAAY,KAGN,eAAVl/B,IAA2B1Y,KAAKkP,QAAQI,OAAO2M,WAAajc,KAAKkP,QAAQI,OAAO4lC,YAAa,CAE5F,IADA,IAAI4C,EAAe7nD,EACZ6nD,GAAgBA,EAAazpC,SAAS8W,MAAQ2yB,IAAiB93C,MAClE83C,EAAeA,EAAazpC,SAEhCrO,KAAKg4C,iBAAiBF,GAAgB,CAAEA,IACrCA,GAUC7nD,EAAOygB,YAAY,IAAIqO,GAAW,2BAA4B,CAC1DrG,MAAAA,EACAzoB,OAAQ6nD,EACRjoC,MAAO7P,KACPyQ,SAAS,KAarB,MARG,CAAC,aAAc,QAAS,WAAY,gBAAgBjF,SAASkN,IACzD1Y,KAAKk1B,OAAO/lB,UAAYnP,KAAKk1B,OAAO/lB,WAAalf,IAChD+P,KAAKk1B,OAAO/lB,SAASO,cAAc,IAAIqP,GAAW,OAAQ,CACtDk5B,cAAehoD,KAEnB+P,KAAKk1B,OAAO/lB,SAAW,MAGxBnP,KAAKkP,UACf,CAAAF,IAAA,OAAAkB,MAED,WACOlQ,KAAKk1B,OAAO/lB,WACXnP,KAAKk1B,OAAO/lB,SAASO,cAAc,IAAIqP,GAAW,OAAQ,CACtDk5B,cAAe,QAEnBj4C,KAAKk1B,OAAO/lB,SAAW,QAE9B,CAAAH,IAAA,mBAAAkB,MAED,WACI,OAAOlQ,KAAKkP,QAAQ2lC,QAAU70C,KAAKkP,QAAQ2lC,OAAO,KACrD,CAAA7lC,IAAA,mBAAAkB,MAED,SAAiBf,EAAUuJ,GACvB,GAAG1Y,KAAKm1C,kBAAoBhmC,EAAU,CAAA,IAAA+oC,EAC5BjoD,EAA2BioD,QAArBA,EAAGl4C,KAAKm4C,qBAALD,IAAkBA,OAAlBA,EAAAA,EAAoB/oC,SACnCnP,KAAKo4C,iBAAmBnoD,EACxB,IAAQ+G,EAAUgJ,KAAKkP,QAAQqe,MAAvBv2B,MAER,GAAGgJ,KAAKm1C,gBAAiB,CACrB,IAAMkD,EAASr4C,KAAKm1C,gBASpBkD,EAAO3oC,cAAc,IAAIqP,GAAW,YAAa,CAC7CrG,MAAAA,EACAvJ,SAAUkpC,EACVpoD,OAAAA,EACA4f,MAAO7P,KACPhJ,MAAAA,KAGLmY,GASCA,EAASO,cAAc,IAAIqP,GAAW,YAAa,CAC/CrG,MAAAA,EACAvJ,SAAAA,EACAlf,OAAAA,EACA4f,MAAO7P,KACPhJ,MAAAA,KAGRgJ,KAAKm1C,gBAAkBhmC,OACjBnP,KAAKm1C,iBASXn1C,KAAKm1C,gBAAgBzlC,cAAc,IAAIqP,GAAW,WAAY,CAC1DrG,MAAAA,EACAvJ,SAAAA,EACAU,MAAO7P,KACP/P,OAAQ+P,KAAKo4C,oBAIrBp4C,KAAKs4C,wBACR,CAAAtpC,IAAA,sBAAAkB,MAED,WAAsB,IAAAqoC,EAAAxnB,EAAA/wB,KAClB,GAAwB,QAAxBu4C,EAAGv4C,KAAKo0C,wBAAgBmE,IAAAA,GAAaA,QAAbA,EAArBA,EAAuBlE,uBAAWkE,GAAlCA,EAAoCjwB,SAC/BtoB,KAAKo0C,iBAAiBC,YAAYmE,QAClCx4C,KAAKo0C,iBAAiBC,YAAYmE,MAAQhhC,KAAKC,OAEhDD,KAAKC,MAAQzX,KAAKo0C,iBAAiBC,YAAYmE,MAAQ,KAAK,CAC3D,IAAAC,EAAAjnC,EAAqBxR,KAAKslB,cAAa,GAAhCzzB,EAAC4mD,EAAA,GAAE3mD,EAAC2mD,EAAA,GAAE9uC,EAAC8uC,EAAA,GAAEj9B,EAACi9B,EAAA,GACjBC,EAAAlnC,EAAiBxR,KAAKwmB,UAAS,GAAxBwN,EAAE0kB,EAAA,GAAEC,EAAED,EAAA,GACbE,EAGI54C,KAAKo0C,iBAAiBC,YAFtBv8B,EAAO8gC,EAAP9gC,QACAw8B,EAAasE,EAAbtE,cAEAz7B,EAAS,EACTC,EAAS,EACVkb,EAAKniC,EAAIimB,IACRe,EAASy7B,GAEVtgB,EAAKrqB,EAAImO,IACRe,GAAUy7B,GAEXqE,EAAK7mD,EAAIgmB,IACRgB,EAASw7B,GAEVqE,EAAKn9B,EAAI1D,IACRgB,GAAUw7B,GAEXt0C,KAAK64C,oBACJ74C,KAAK64C,mBAAmB7hC,SAEzB6B,GAAUC,EACT9Y,KAAK64C,mBAAqB74C,KAAK2W,mBAAkB,WAC7Coa,EAAKrR,WAAW7G,EAAQC,MAG5B9Y,KAAKo0C,iBAAiBC,YAAYmE,MAAQ,QAIzD,CAAAxpC,IAAA,cAAAkB,MAED,SAAYwI,GAAO,IAAAuZ,EAAAjyB,KAGf,GAFA0Y,EAAM6G,iBACN7G,EAAMyH,mBACHngB,KAAK40C,eAAeD,WAAvB,CACA30C,KAAK40C,eAAeD,YAAa,EACjC,IAAQh8B,EAAqBD,EAArBC,QAASC,EAAYF,EAAZE,QACjBtO,OAAOK,OAAO3K,KAAKkP,QAAQI,OAAQ,CAC/B4lC,aAAa,IAEjBl1C,KAAK84C,cAAc,CAACngC,EAASC,IAC7B,IAAMzJ,EAAWnP,KAAKkP,QAAQC,UAAYnP,KAAKkP,QAAQE,KACvDpP,KAAK+4C,iBAAiB5pC,EAAUuJ,GAC7B1Y,KAAKkP,QAAQ6lC,aAAe/0C,KAAKkP,QAAQ4lC,gBACxCkE,QAAQC,UAAUC,MAAK,WACnBjnB,EAAK/a,UACL+a,EAAK/iB,QAAQ6lC,aAAc,EAC3B9iB,EAAK/iB,QAAQ4lC,iBAAkB,EAC/B7iB,EAAK2iB,eAAeD,YAAa,KAGrC30C,KAAK40C,eAAeD,YAAa,KAExC,CAAA3lC,IAAA,qBAAAkB,MAED,WAAqB,IAAAipC,EACdn5C,KAAK64C,oBACJ74C,KAAK64C,mBAAmB7hC,SAEJmiC,QAAxBA,EAAGn5C,KAAKo0C,wBAAL+E,IAAqBA,GAArBA,EAAuB9E,cACtBr0C,KAAKo0C,iBAAiBC,YAAYmE,MAAQ,QAEjD,CAAAxpC,IAAA,eAAAkB,MAED,WACIlQ,KAAKo5C,uBACR,CAAApqC,IAAA,UAAAkB,MAED,SAAQwI,GAAO,IAAA6Z,EAAAvyB,KACXA,KAAKo5C,qBACL,IAAMC,EAAUr5C,KAAKs5C,iBACfnqC,EAAWkqC,MAAAA,OAAAA,EAAAA,EAASlqC,SAC1B,GAAGnP,KAAKm1C,gBAAiB,CACrB,IAAMkD,EAASr4C,KAAKm1C,gBACpBkD,EAAO3oC,cAAc,IAAIqP,GAAW,cAAe,CAC/CrG,MAAAA,EACAvJ,SAAUkpC,KAEdr4C,KAAKm1C,gBAAkB,KAE3B,IAAAoE,EAGIv5C,KAAKkP,QAFLE,EAAImqC,EAAJnqC,KACUnf,EAAMspD,EAAhBpqC,SAEJqqC,EAEIx5C,KAAKkP,QAAQqe,MADbv2B,EAAKwiD,EAALxiD,MAAO4Z,EAAO4oC,EAAP5oC,QAERxB,EAcCA,EAAKM,cAAc,IAAIqP,GAAW,OAAQ,CACtCrG,MAAAA,EACAvJ,SAAAA,EACAC,KAAAA,EACAS,MAAO7P,KACP4Q,QAAAA,EACA5Z,MAAAA,KAEE/G,EAYNA,EAAOygB,YAAY,IAAIqO,GAAW,OAAQ,CACtCrG,MAAAA,EACAvJ,SAAAA,EACAU,MAAO7P,KACP/P,OAAAA,EACA+G,MAAAA,EACAyZ,SAAS,KAabzQ,KAAK0P,cAAc,IAAIqP,GAAW,OAAQ,CACtCrG,MAAAA,EACAvJ,SAAAA,EACAU,MAAO7P,KACP/P,OAAAA,EACA+G,MAAAA,KAGRogB,uBAAsB,WAClBmb,EAAKknB,kBAEZ,CAAAzqC,IAAA,aAAAkB,MACD,WACIlQ,KAAKkP,QAAQC,SAAW,KACxBnP,KAAKkP,QAAQE,KAAO,KACpB9E,OAAOK,OAAO3K,KAAKkP,QAAQI,OAAQ,CAC/B4lC,aAAa,MAIrB,CAAAlmC,IAAA,cAAAkB,MAQA,SAAYyI,EAASC,EAASC,EAAQC,EAAQJ,GAAO,IAAAqb,EAAA/zB,KAEjD,IAAGA,KAAK05C,SAAR,CACA15C,KAAK05C,UAAW,EAChB,IAAAC,EAAmD35C,KAAKkJ,aAAzCgP,EAAOyhC,EAAdprD,MAAwB4pB,EAAQwhC,EAAhBnrD,OAAmBmrD,EAAD9nD,EAAI8nD,EAAD7nD,EAC7C,IAAAwrB,EAAgDtd,KAAKud,WAA/B2V,EAAE5V,EAAhBE,aAAiCo8B,EAAEt8B,EAAjBG,cACtBy2B,EAAUl0C,KAAKk0C,QACnB,GAAGl0C,KAAKm0C,YAAa,CACjB,IAAM1/C,EAAIuL,KAAKm0C,YACT/oB,EAAWlT,EAAc,EAAJzjB,EACrB42B,EAAYlT,EAAe,EAAJ1jB,EAC7By/C,EAAUllD,KAAKgK,IAAIk7C,EAASllD,KAAKgK,IAAIk6B,EAAK9H,EAAUwuB,EAAKvuB,IAE7D,IAAIwuB,EAAW75C,KAAKnR,MAEpBgrD,GADe/gC,EAAS,EAAI,KAAO,EAAI,KAavC,IAAIghC,GAXJD,EAAW7qD,KAAK+J,IAAIiH,KAAKi0C,QAASjlD,KAAKgK,IAAIk7C,EAAS2F,KAWrB75C,KAAKnR,MAChCkrD,EAAgB7hC,EAAUlY,KAAKnR,MAC/BmrD,EAAgB7hC,EAAWnY,KAAKnR,MAChCorD,EAAgB/hC,EAAU4hC,EAC1BI,EAAgB/hC,EAAW2hC,EAI3BK,IAFKxhC,EAAU3Y,KAAK9Q,SAAS2C,GAElBkoD,EACXK,IAFKxhC,EAAU5Y,KAAK9Q,SAAS4C,GAElBkoD,EAEfh6C,KAAKnR,MAAQgrD,EACb75C,KAAKoa,qBAAqB+/B,EAAKF,EAAYG,EAAKF,GAMhDl6C,KAAK0P,cAAc,IAAIqP,GAAW,UAAW,CACxClG,OAAQ,EAAGC,OAAQ,KAGxB9Y,KAAKqX,gBAAe,WAChB0c,EAAK2lB,UAAW,QAQxB,CAAA1qC,IAAA,aAAAkB,MAMA,SAAW2I,EAAQC,EAAQJ,GAAO,IAAA+mB,EAAAz/B,KAC9B,IAAGA,KAAKq6C,SAAR,CAKA,GAJAr6C,KAAKq6C,UAAW,EAGZr6C,KAAKkP,QAAQI,OADb2M,SAES,CACT,IAAM67B,EAAe93C,KAAKkP,QAAQ2lC,OAC/BiD,GACI93C,KAAKo0C,iBAAiBC,YAAYE,wBACjCuD,EAAa3gD,SAAQ,SAAA/E,GACjBA,EAAEge,OAAO,KAAOyI,EAAS4mB,EAAK5wC,MAC9BuD,EAAEge,OAAO,KAAO0I,EAAS2mB,EAAK5wC,SAM9CmR,KAAKoa,qBAAqBvB,EAAQC,GAMlC9Y,KAAK0P,cAAc,IAAIqP,GAAW,UAAW,CACzClG,OAAAA,EACAC,OAAAA,KAEJ9Y,KAAKqX,gBAAe,WAChBooB,EAAK4a,UAAW,QAQxB,CAAArrC,IAAA,oBAAAkB,MAMA,SAAkByI,EAASC,EAASF,GAAO,IAAA4hC,EAAAt6C,KACvC,IAAGA,KAAK0c,sBAAR,CAGApS,OAAOK,OAAO3K,KAAKkP,QAAQlF,KAAM,CAC7BgrC,SAAUr8B,EACVs8B,SAAUr8B,IAEd,IAAA2hC,EAGIv6C,KAAK84C,cAAc,CAACngC,EAASC,GAAU,cAFvCxJ,EAAImrC,EAAJnrC,KACAD,EAAQorC,EAARprC,SAGJ,GAAGnP,KAAKu1C,OAASxsC,GAAWE,QAA5B,CAKA,GAJAqB,OAAOK,OAAO3K,KAAKkP,QAAQI,OAAQ,CAC/B2M,UAAU,EACV04B,YAAY,IAEb30C,KAAKkP,QAAQ2lC,OAAQ,CACpB,IAAMA,EAAS70C,KAAKqP,mBAUpBwlC,EAAOnlC,cAAc,IAAIqP,GAAW,aAAc,CAC9CrG,MAAAA,EACAvJ,SAAU0lC,EACVhlC,MAAO7P,QAGf,IAAM5N,EAAI4N,KAAKw6C,qBAAqBprC,EAAMD,GACvC/c,GAYCA,EAAEse,YAAY,IAAIqO,GAAW,qBAAsB,CAC/CrG,MAAAA,EACAzoB,OAAQmC,EACRyd,MAAO7P,KACPyQ,SAAS,EACT8O,eAAgB,WACZ+6B,EAAKG,wBAAyB,EAC9BH,EAAKI,eACLzsD,SAASwC,iBAAiB,aAAa,SAAAkP,GACnCA,EAAE4f,iBACF5f,EAAEwgB,kBACFm6B,EAAKG,wBAAyB,IAC/B,CAAEjqD,MAAM,QAInBwP,KAAKy6C,wBACLz6C,KAAK0P,cAAc,IAAIqP,GAAW,kBAAmB,CACjDrG,MAAAA,EACA7I,MAAO7P,YAInB,CAAAgP,IAAA,mBAAAkB,MAMA,SAAiByI,EAASC,EAASF,GAAO,IAAAiiC,EAAA36C,KACtC,IAAGA,KAAKy6C,yBAGLz6C,KAAK0c,sBAAR,CAGA,IAAAk+B,EAEI56C,KAAKkP,QAAQI,OADb2M,EAAQ2+B,EAAR3+B,SAAU04B,EAAUiG,EAAVjG,WAEdkG,EAAiB76C,KAAKkP,QAAQlF,KAAtBnY,EAACgpD,EAADhpD,EAAGC,EAAC+oD,EAAD/oD,EAEX,IAAImqB,EAAU,CACV,GAAGjc,KAAK4d,oBAAoBjF,EAASC,GACjC,OAEA5Y,KAAK8d,sBAKb,IAAI7B,IAAa04B,EAAY,CACzB,IAAAmG,EAGI96C,KAAK84C,cAAc,CAACngC,EAASC,IAF7BxJ,EAAI0rC,EAAJ1rC,KACAD,EAAQ2rC,EAAR3rC,SAEE/c,EAAI4N,KAAKw6C,qBAAqBprC,EAAMD,GAgC1C,GA/BG/c,EAgBCA,EAAEse,YAAY,IAAIqO,GAAW,oBAAqB,CAC9CrG,MAAAA,EACAvJ,SAAU/c,EACVyd,MAAO7P,KACPyQ,SAAS,KAGbzQ,KAAK0P,cAAc,IAAIqP,GAAW,oBAAqB,CACnDrG,MAAAA,EACAvJ,SAAU,KACVU,MAAO7P,QAKZA,KAAKu1C,OAASxsC,GAAWE,QA6BxB,OAfAjJ,KAAKq1C,UAAUjlC,OAASpQ,KAAKwmB,UAE7BxmB,KAAKqX,gBAAe,WAChBsjC,EAAKzrC,QAAQ6lC,aAAc,EAC3B4F,EAAKzrC,QAAQ4lC,iBAAkB,EAC/B6F,EAAKzrC,QAAQI,OAAOqlC,YAAa,UAErC30C,KAAKs4C,sBA4Bb,GAPAt4C,KAAK0P,cAAc,IAAIqP,GAAW,kBAAmB,CACjDrG,MAAAA,EACA7I,MAAO7P,QAKPic,IAED04B,EAAH,CAEA,IAAMmD,EAAe93C,KAAKkP,QAAQ2lC,OAClC70C,KAAKkP,QAAQI,OAAOC,aAAc,EAClCvP,KAAKkP,QAAQI,OAAOqlC,YAAa,EACjC,IAAM97B,EAASF,EAAU9mB,EACnBinB,EAASF,EAAU9mB,EACtBgmD,EACI93C,KAAKw1C,oBACJsC,EAAa3gD,SAAQ,SAAA/E,GACjBA,EAAEge,OAAO,IAAMyI,EAAS8hC,EAAK9rD,MAC7BuD,EAAEge,OAAO,IAAM0I,EAAS6hC,EAAK9rD,UAIrCmR,KAAKoa,qBAAqBvB,EAAQC,GAClC9Y,KAAK0P,cAAc,IAAIqP,GAAW,UAAW,CACzClG,OAAAA,EAAQC,OAAAA,MAGhB,IAAAiiC,EAA2B/6C,KAAK84C,cAAc,CAACngC,EAASC,IAAhDzJ,EAAQ4rC,EAAR5rC,SAAUC,EAAI2rC,EAAJ3rC,KAElBpP,KAAK+4C,iBAAiB5pC,GAAYC,EAAMsJ,GAExC1Y,KAAKqX,gBAAe,WAChBsjC,EAAKzrC,QAAQ6lC,aAAc,EAC3B4F,EAAKzrC,QAAQ4lC,iBAAkB,EAC/B6F,EAAKzrC,QAAQI,OAAOqlC,YAAa,SASzC,CAAA3lC,IAAA,iBAAAkB,MAKA,SAAe8qC,EAAYtiC,GACvB,IAAG1Y,KAAKy6C,uBAAR,CAUA,GANGz6C,KAAK64C,oBACJ74C,KAAK64C,mBAAmB7hC,SAE5BhX,KAAKo5C,qBAEQp5C,KAAKkP,QAAQlF,KACvBhK,KAAKu1C,OAASxsC,GAAWE,QAAS,CACjC,IAAM7W,EAAI4N,KAAKkP,QAAQC,SACjBkqC,EAAUr5C,KAAKs5C,iBAEjB2B,GAAkB,EAChB17B,EAAiB,WACnB07B,GAAkB,GAEtB,GAAG7oD,EAWCA,EAAEse,YAAY,IAAIqO,GAAW,OAAQ,CACjCrG,MAAAA,EACAzoB,OAAQmC,EACRyd,MAAO7P,KACPq5C,QAAAA,EACA5oC,SAAS,EACTrB,KAAMpP,KAAKs1C,UACX/1B,eAAAA,SAED,CACH,IAAQ5G,EAAqBD,EAArBC,QAASC,EAAYF,EAAZE,QACjB5Y,KAAK0P,cAAc,IAAIqP,GAAW,OAAQ,CACtCrG,MAAAA,EACA7I,MAAO7P,KACPq5C,QAAAA,EACAjpC,OAAQpQ,KAAK4iB,oBAAoB,CAACjK,EAASC,IAC3CxJ,KAAMpP,KAAKs1C,UACX/1B,eAAAA,KAGR,GAAG07B,EACC,OAgBJ,OAdAj7C,KAAK06C,eACD16C,KAAK82C,oBACF92C,KAAKq1C,YACJr1C,KAAKq1C,UAAU5wB,UACfzkB,KAAKq1C,UAAY,MAElBr1C,KAAKs1C,YACJt1C,KAAKs1C,UAAU7wB,UACfzkB,KAAKs1C,UAAY,OAGzBt1C,KAAK82C,mBAAoB,EACzB92C,KAAKu1C,KAAOxsC,GAAWC,aACvBhJ,KAAKkX,UAIT,GAAGlX,KAAKkP,QAAQ2lC,OAAQ,CACpB,IAAIqG,GAAc,EAIlB,GAHGl7C,KAAKwV,QAAO,SACX0lC,EAAcl7C,KAAKsW,YAAYtW,KAAKqP,sBAEpC6rC,GAAel7C,KAAKkP,QAAQE,KAAM,CAElC,IAAA+rC,EAEIn7C,KAAKkP,QAAQqe,MADR4tB,EAALnkD,UAAO4Z,EAAOuqC,EAAPvqC,QAELxB,EAAOpP,KAAKkP,QAAQE,KACpBD,EAAWnP,KAAKqP,mBAYtBD,EAAKM,cAAc,IAAIqP,GAAW,OAAQ,CACtCrG,MAAAA,EACAvJ,SAAAA,EACAC,KAAAA,EACAS,MAAO7P,KACP4Q,QAAAA,KAEJ5Q,KAAKkP,QAAQE,KAAO,KACpBpP,KAAKkP,QAAQC,SAAW,KAEzBnP,KAAKkP,QAAQ2lC,SACT70C,KAAKkP,QAAQC,SAaZnP,KAAKkP,QAAQC,SAASuB,YAAY,IAAIqO,GAAW,WAAY,CACzDrG,MAAAA,EACAvJ,SAAUnP,KAAKqP,mBACfQ,MAAO7P,KACP/P,OAAQ+P,KAAKkP,QAAQC,SACrBsB,SAAS,KAYbzQ,KAAK0P,cAAc,IAAIqP,GAAW,WAAY,CAC1CrG,MAAAA,EACAvJ,SAAUnP,KAAKqP,mBACfQ,MAAO7P,SAInBA,KAAKkP,QAAQ2lC,OAAS,KACtB70C,KAAKo7C,6BAELp7C,KAAKkX,UAETlX,KAAK06C,kBAER,CAAA1rC,IAAA,eAAAkB,MAMD,SAAayI,EAASC,EAASF,GAC3B,IAAA2iC,EAIIr7C,KAAK84C,cAAc,CAACngC,EAASC,GAAU,SAHvCxJ,EAAIisC,EAAJjsC,KACAD,EAAQksC,EAARlsC,SACAnF,EAAIqxC,EAAJrxC,KAEJ,GAAGhb,KAAK0B,IAAIsZ,EAAKgrC,SAAWhrC,EAAKnY,GAAK,GAC/B7C,KAAK0B,IAAIsZ,EAAKirC,SAAWjrC,EAAKlY,GAAK,EAAG,CACrC,GAAG4mB,EAAMzoB,SAAW+P,KAAKhS,OAMrB,OALAgS,KAAK06C,oBACLpwC,OAAOK,OAAO3K,KAAKkP,QAAQlF,KAAM,CAC7BgrC,cAAUz/C,EACV0/C,cAAU1/C,IAIlB,IAAQsiD,EAAkB73C,KAAKkP,QAAQqe,MAA/BsqB,cACFzlD,EAAI4N,KAAKw6C,qBAAqBprC,EAAMD,GAC1C,GAAG/c,EAAG,CACF,IAAMnC,EAASmC,EAYfnC,EAAOygB,YAAY,IAAIqO,GAAW,QAAS,CACvCrG,MAAAA,EACA7I,MAAO7P,KACP/P,OAAAA,EACA4nD,cAAAA,EACApnC,SAAS,UAYbzQ,KAAK0P,cAAc,IAAIqP,GAAW,QAAS,CACvCrG,MAAAA,EACA7I,MAAO7P,KACP63C,cAAAA,KAGR73C,KAAK06C,eACLpwC,OAAOK,OAAO3K,KAAKkP,QAAQlF,KAAM,CAC7BgrC,cAAUz/C,EACV0/C,cAAU1/C,OAI1B,CAAAyZ,IAAA,qBAAAkB,MAMA,SAAmByI,EAASC,EAASF,GACjC,IAAA4iC,EAGIt7C,KAAK84C,cAAc,CAACngC,EAASC,GAAU,gBAFvCxJ,EAAIksC,EAAJlsC,KACAD,EAAQmsC,EAARnsC,SAEI0oC,EAAkB73C,KAAKkP,QAAQqe,MAA/BsqB,cACFzlD,EAAI4N,KAAKw6C,qBAAqBprC,EAAMD,GAC1C,GAAG/c,EAAG,CACF,IAAMnC,EAASmC,EAYfnC,EAAOygB,YAAY,IAAIqO,GAAW,eAAgB,CAC9CrG,MAAAA,EACA7I,MAAO7P,KACP/P,OAAAA,EACA4nD,cAAAA,EACApnC,SAAS,UAYbzQ,KAAK0P,cAAc,IAAIqP,GAAW,eAAgB,CAC9CrG,MAAAA,EACA7I,MAAO7P,KACP63C,cAAAA,OAGX,CAAA7oC,IAAA,kBAAAkB,MAED,SAAgByI,EAASC,EAASF,GAC9B,IAAA6iC,EAGIv7C,KAAK84C,cAAc,CAACngC,EAASC,GAAU,YAFvCxJ,EAAImsC,EAAJnsC,KACAD,EAAQosC,EAARpsC,SAEI0oC,EAAkB73C,KAAKkP,QAAQqe,MAA/BsqB,cACFzlD,EAAI4N,KAAKw6C,qBAAqBprC,EAAMD,GAC1C,GAAG/c,EAAG,CACF,IAAMnC,EAASmC,EAYfnC,EAAOygB,YAAY,IAAIqO,GAAW,WAAY,CAC1CrG,MAAAA,EACA7I,MAAO7P,KACP/P,OAAAA,EACA4nD,cAAAA,EACApnC,SAAS,UAGbzQ,KAAK0P,cAAc,IAAIqP,GAAW,WAAY,CAC1CrG,MAAAA,EACA7I,MAAO7P,KACP63C,cAAAA,OAKZ,CAAA7oC,IAAA,uBAAAkB,MAwCA,SAAqBd,EAAMD,GACvB,OAAOC,MAAAA,GAAAA,EAAM2oC,OAAS3oC,EAAQD,GAAYC,IAC7C,CAAAJ,IAAA,eAAAkB,MAED,WACI5F,OAAOK,OAAO3K,KAAKkP,QAAQlF,KAAM,CAC7BnY,OAAG0D,EACHzD,OAAGyD,IAIP+U,OAAOK,OAAO3K,KAAKkP,QAAQI,OAAQ,CAC/B2M,UAAU,EACV04B,YAAY,EACZplC,aAAa,IAEjBjF,OAAOK,OAAO3K,KAAKkP,QAAS,CACxBC,SAAU,KACVC,KAAM,KACNylC,OAAQ,SAEf,CAAA7lC,IAAA,uBAAAkB,MAED,SAAqB2I,EAAQC,EAAQjqB,GACjC,IAAA2sD,EAAgCx7C,KAAKkJ,aAA7BrX,EAAC2pD,EAAD3pD,EAAGC,EAAC0pD,EAAD1pD,EAAGvD,EAAKitD,EAALjtD,MAAOC,EAAMgtD,EAANhtD,OACrB4vB,EAAgDpe,KAAKud,WAA/B2V,EAAE9U,EAAhBZ,aAAiCo8B,EAAEx7B,EAAjBX,cAM1B,QALaloB,IAAV1G,IACCA,EAAQmR,KAAKnR,OAIdmR,KAAKm0C,YAAa,CAEjB,IAAM1/C,EAAIuL,KAAKm0C,YACTpyC,GAAOlQ,EAAItD,EAAQkG,GAAG5F,EAAQqkC,EAC9BjxB,GAAOpQ,EAAI4C,GAAG5F,EAEdid,EAAKja,EAAIhD,EAETwsB,EADKrb,KAAK9Q,SAAS2C,EAAIgnB,EACb/M,EAChB9L,KAAK9Q,SAASypB,QAAU3pB,KAAK+J,IAAI/J,KAAKgK,KAAK+I,EAAKsZ,IAAMpZ,GAGtDjC,KAAK9Q,SAAS2C,EAAImO,KAAK9Q,SAASypB,QAAU7M,EAI1C,IAAM9J,GAAOlQ,EAAItD,EAASiG,GAAG5F,EAAQ+qD,EAC/B13C,GAAOpQ,EAAI2C,GAAG5F,EAEdkd,EAAKja,EAAIjD,EAETgsB,EADK7a,KAAK9Q,SAAS4C,EAAIgnB,EACb/M,EAChB/L,KAAK9Q,SAAS0pB,QAAU5pB,KAAK+J,IAAI/J,KAAKgK,KAAKgJ,EAAK6Y,IAAM3Y,GAEtDlC,KAAK9Q,SAAS4C,EAAIkO,KAAK9Q,SAAS0pB,QAAU7M,OAE1C/L,KAAK9Q,SAAS2C,GAAKgnB,EACnB7Y,KAAK9Q,SAAS4C,GAAKgnB,EACnB9Y,KAAK9Q,SAASypB,QAAU3Y,KAAK9Q,SAAS2C,EAAIA,EAAIhD,EAC9CmR,KAAK9Q,SAAS0pB,QAAU5Y,KAAK9Q,SAAS4C,EAAIA,EAAIjD,IAGrD,CAAAmgB,IAAA,uBAAAkB,MAED,SAAqBpd,GACjB,IAAMjE,EAAQmR,KAAKnR,MACbK,EAAW8Q,KAAK9Q,SACtB,MAAO,CAAC4D,EAAE,GAAKjE,EAAQK,EAASypB,QAAS7lB,EAAE,GAAKjE,EAAQK,EAAS0pB,WACpE,CAAA5J,IAAA,sBAAAkB,MAED,SAAoBpd,GAChB,IAAMjE,EAAQmR,KAAKnR,MACbK,EAAW8Q,KAAK9Q,SACtB,MAAO,EAAE4D,EAAE,GAAK5D,EAASypB,SAAS9pB,GAAQiE,EAAE,GAAK5D,EAAS0pB,SAAW/pB,KACxE,CAAAmgB,IAAA,+BAAAkB,MAED,SAA6Bld,EAAGC,EAAGiwB,EAAKC,EAAMC,GAC1C,IAAMv0B,EAAQmR,KAAKnR,MACbK,EAAW8Q,KAAK9Q,SACtBg0B,EAAIC,IAASnwB,EAAI9D,EAASypB,SAAW9pB,EACrCq0B,EAAIE,IAASnwB,EAAI/D,EAAS0pB,SAAW/pB,IACxC,CAAAmgB,IAAA,qBAAAkB,MAED,SAAmB3d,GACf,OAAOyN,KAAKnR,MAAQ0D,IACvB,CAAAyc,IAAA,kBAAAkB,MAED,WACI,IAAAurC,EAA6Cz7C,KAAKud,WAAnCq4B,EAAO6F,EAAdltD,MAAwBsnD,EAAQ4F,EAAhBjtD,OAClBU,EAAW8Q,KAAK9Q,SAChBL,EAAQmR,KAAKnR,MACbV,EAAM6R,KAAK7R,IACjBA,EAAIorB,eACJprB,EAAIwB,UAAU,EAAG,EAAGimD,EAASC,GAC7B1nD,EAAIU,MAAMmR,KAAKye,IAAKze,KAAKye,KACzBtwB,EAAIqrB,UAAU3qB,EAAO,EAAG,EAAGA,EAAOK,EAASypB,QAASzpB,EAAS0pB,WAKhE,CAAA5J,IAAA,iBAAAkB,MAED,SAAe/hB,GACX,IAAMe,EAAW8Q,KAAK9Q,SAChBL,EAAQmR,KAAKnR,MACnBV,EAAIorB,eACJprB,EAAIU,MAAMmR,KAAKye,IAAKze,KAAKye,KACzBtwB,EAAIqrB,UAAU3qB,EAAO,EAAG,EAAGA,EAAOK,EAASypB,QAASzpB,EAAS0pB,WAChE,CAAA5J,IAAA,cAAAkB,MAED,WAKI,IAAMkW,EAAepmB,KAAKslB,cAM1B,OALAtlB,KAAKijB,6BAA6B,EAAE,EAAGmD,EAAc,EAAG,GACxDpmB,KAAKijB,6BACDjjB,KAAKud,WAAWC,aAChBxd,KAAKud,WAAWE,cAChB2I,EAAc,EAAG,GACdA,IACV,CAAApX,IAAA,oBAAAkB,MAED,SAAkB6sB,GACd,IAAMpoB,EAAQ3U,KAAK6T,OAAOR,WAAU,SAAA/b,GAAC,OAAIA,IAAMylC,KAC/C,IAAc,IAAXpoB,EAAc,CACb,IAAOynB,EAA0C5qB,EAA5BxR,KAAK6T,OAAOngB,OAAOihB,EAAO,GAAE,GAAhC,GACjB3U,KAAK6T,OAAOtf,KAAK6nC,MAExB,CAAAptB,IAAA,kBAAAkB,MAED,WACI,OAAOlQ,KAAKslB,gBACf,CAAAtW,IAAA,UAAAkB,MAGD,WACIlQ,KAAKqX,mBAGR,CAAArI,IAAA,WAAAkB,MAGD,WACI,GAAIlQ,KAAKw2C,eAAT,CAEAx2C,KAAKsX,gBACLtX,KAAK07C,kBACL,IAAMvtD,EAAM6R,KAAK7R,IACjB6R,KAAK0P,cAAc,IAAIqP,GAAW,oBAAqB,CACnD5wB,IAAAA,KAEJ,IAAMsrB,EAAKzZ,KAAKoR,cAEbpR,KAAK0Z,eACJ1Z,KAAKsU,WAAW5kB,OAAOvB,GAAK,SAACihB,GAAI,OAAMA,EAAK2oC,QAAU3oC,EAAK3B,YAAYgM,MACvEzZ,KAAK6T,OAAOnkB,OAAOvB,GAAK,SAACghB,GACrB,IAAMxK,EAASuI,GAAUuM,EAAItK,EAASmB,mBAEtC,OADAnB,EAASwsC,aAAeh3C,EACjBA,KAEX3E,KAAKsU,WAAW5kB,OAAOvB,GAAK,SAACihB,GAAI,OAAKA,EAAK2oC,QAAU3oC,EAAK3B,YAAYgM,QAEtEzZ,KAAK6T,OAAOnkB,OAAOvB,GAAK,SAACghB,GACrB,IAAMxK,EAASuI,GAAUuM,EAAItK,EAASmB,mBAGtC,OADAnB,EAASwsC,aAAeh3C,EACjBA,KAEX3E,KAAKsU,WAAW5kB,OAAOvB,GAAK,SAACihB,GAAI,OAAKA,EAAK3B,YAAYgM,OAexDzZ,KAAKq1C,YACJlnD,EAAIyB,OACJoQ,KAAKq1C,UAAU3lD,OAAOvB,GACtBA,EAAI0B,WAELmQ,KAAKs1C,YACJnnD,EAAIyB,OACJoQ,KAAKs1C,UAAU7nC,YAAYgM,GAC3BzZ,KAAKs1C,UAAU5lD,OAAOvB,GACtBA,EAAI0B,WAGRmQ,KAAK0P,cAAc,IAAIqP,GAAW,mBAAoB,CAClD5wB,IAAAA,KAEJ6R,KAAKwe,gBAAgBrwB,QAExBylD,GAAA9iC,EA7mDeC,cA+mDpBzG,OAAOK,OAAOipC,GAAMruB,UCvvDC,CACjBq2B,SAAU,KAKV/E,YAAW,SAACgF,GACR77C,KAAK47C,SAAWC,GAMpBvC,eAAc,WACV,IAAMuC,EAAM77C,KAAK47C,SAEjB,OADA57C,KAAK47C,SAAW,KACTC,GAEX1D,YAAW,WACP,OAAOn4C,KAAK47C,YDquDpBtxC,OAAOK,OAAOipC,GAAMruB,UAAWpR,IAC/B7J,OAAOK,OAAOipC,GAAMruB,UAAWhQ,IAC/BjL,OAAOK,OAAOipC,GAAMruB,UAAWhT,IAC/BjI,OAAOK,OAAOipC,GAAMruB,UAAWhP,IAC/BjM,OAAOK,OAAOipC,GAAMruB,UAAW5N,IAC/BrN,OAAOK,OAAOipC,GAAMruB,UAAW5G,IAC/BrU,OAAOK,OAAOipC,GAAMruB,UAAW9J,IEnwD/B,IAAMqgC,GAAcC,QAAQ,mBAK5BjtD,OAAOktD,eAAiBF,GAAYG,+fhCLrB,CACXjuD,OAAQ,CACJsxB,MAAKA,SAAE5G,EAAO7I,GACV6I,EAAM6G,iBACN,IAAM5G,EAAqCD,EAArCC,QAASC,EAA4BF,EAA5BE,QAASC,EAAmBH,EAAnBG,OAAQC,EAAWJ,EAAXI,OAC7BJ,EAAM8G,UACL1G,GAAUA,GAEdjJ,EAAM4P,YAAY9G,EAASC,EAASC,EAAQC,EAAQJ"}