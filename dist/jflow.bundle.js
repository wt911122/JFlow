!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["@joskii/jflow"]=e():t["@joskii/jflow"]=e()}(self,(function(){return(()=>{"use strict";var e={359:t=>{function e(){return n(null,[].slice.call(arguments,0))}function n(t,e){for(var n,o,i,a,s,c=e.length,u=e[0],l={},f=t&&t.equal||r,h=1;h<c;h++)for(n=e[h],i=(o=Object.keys(n)).length,s=0;s<i;s++)f(n[a=o[s]],u[a])||(l[a]=n[a]);return l}function r(t,e){return t===e}e.custom=function(t){return n(t,[].slice.call(arguments,1))},t.exports=e},147:t=>{t.exports=JSON.parse('{"name":"@joskii/jflow","version":"0.2.31-beta","description":"","main":"dist/jflow.bundle.js","files":["dist/*.js"],"scripts":{"dev:demo":"cd demo/vue-scopedslots && npm run serve","build:doc":"rm -rf docs && cd jsdoc-plugin && npm run build && cd ../demo/vue-scopedslots && npm run build && cd ../../ && npm run build:jsdoc","build:jsdoc":"rm -rf docs &&  jsdoc -c conf.json -t ~/Documents/Source-Codes/docstrap/template -R README.md -r . && mv out docs","build:lib":"webpack --config configs/webpack.lib.config.js"},"author":"","license":"ISC","dependencies":{"bezier-js":"^4.1.1","object-diff":"0.0.4"},"peerDependencies":{"vue":"^2.6.11"},"devDependencies":{"@babel/core":"^7.17.5","@babel/preset-env":"^7.16.11","@vue/compiler-sfc":"^3.2.26","babel-loader":"^8.2.3","ink-docstrap":"^1.3.2","jsdoc":"^3.6.7","jsdoc-vuejs":"^4.0.0","webpack":"^5.70.0","webpack-cli":"^4.9.2"}}')}},n={};function r(t){var o=n[t];if(void 0!==o)return o.exports;var i=n[t]={exports:{}};return e[t](i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return(()=>{r.r(o),r.d(o,{BaseLink:()=>Mr,BezierLink:()=>Xo,Capsule:()=>_n,CapsuleGroup:()=>Gc,CapsuleVertical:()=>Rn,CapsuleVerticalGroup:()=>$c,Diamond:()=>Kn,DiamondGroup:()=>Vc,DiamondVerticalGroup:()=>Uc,ERLayout:()=>ji,Group:()=>Yc,GroupFactory:()=>We,Icon:()=>oo,Instance:()=>yt,JFLOW_MODE:()=>L,JFlowEvent:()=>ge,JFlowLinkGroup:()=>gu,JFlowPath2D:()=>Cc,JFlowVuePlugin:()=>Eu,LinearLayout:()=>Vo,Link:()=>Oo,Lowcodelayout:()=>bi,Node:()=>Ot,Point:()=>Ke,PointGroup:()=>Jc,PolyLink:()=>Io,Rectangle:()=>un,Rhombus:()=>zn,RhombusGroup:()=>qc,ScrollGroup:()=>Sr,ShadowDom:()=>po,Text:()=>Zr,TextElement:()=>ga,TextGroup:()=>xc,commonEventAdapter:()=>jr,default:()=>Cu});var e={};function n(t){var e=document.createElement("canvas"),n=e.getContext("2d"),r=t.getBoundingClientRect(),o=r.width,i=r.height,a=r.left,s=r.top;e.style.width=o+"px",e.style.height=i+"px",e.style.userSelect="none";var c=window.devicePixelRatio;return e.width=Math.floor(o*c),e.height=Math.floor(i*c),t&&(t.style.position="relative",t.style.overflow="hidden",t.append(e)),{canvas:e,width:o,height:i,raw_width:e.width,raw_height:e.height,left:a,top:s,ctx:n,scale:c}}r.r(e),r.d(e,{BaseLink:()=>Mr,BezierLink:()=>Xo,Capsule:()=>_n,CapsuleGroup:()=>Gc,CapsuleVertical:()=>Rn,CapsuleVerticalGroup:()=>$c,Diamond:()=>Kn,DiamondGroup:()=>Vc,DiamondVerticalGroup:()=>Uc,ERLayout:()=>ji,Group:()=>Yc,GroupFactory:()=>We,Icon:()=>oo,Instance:()=>yt,JFLOW_MODE:()=>L,JFlowEvent:()=>ge,JFlowPath2D:()=>Cc,LinearLayout:()=>Vo,Link:()=>Oo,Lowcodelayout:()=>bi,Node:()=>Ot,Point:()=>Ke,PointGroup:()=>Jc,PolyLink:()=>Io,Rectangle:()=>un,Rhombus:()=>zn,RhombusGroup:()=>qc,ScrollGroup:()=>Sr,ShadowDom:()=>po,Text:()=>Zr,TextElement:()=>ga,TextGroup:()=>xc,commonEventAdapter:()=>jr,default:()=>Zc});var i=document.createElement("canvas");i.width=1,i.height=1;var a=i.getContext("2d"),s=window.devicePixelRatio;function c(t){a.clearRect(0,0,5,5),a.save(),t(a),a.restore(),a.clearRect(0,0,5,5)}function u(t,e){var n=matchMedia("(resolution: ".concat(window.devicePixelRatio,"dppx)"));function r(){console.log("devicePixelRatio changed: "+window.devicePixelRatio),t(window.devicePixelRatio),u(t,e)}e((function(){console.log("remove devicePixelRatio event handler"),n.removeEventListener("change",r,{once:!0})})),n.addEventListener("change",r,{once:!0})}a.scale(s,s);const{abs:l,cos:f,sin:h,acos:p,atan2:d,sqrt:y,pow:v}=Math;function b(t){return t<0?-v(-t,1/3):v(t,1/3)}const g=Math.PI,m=2*g,_=g/2,w=Number.MAX_SAFE_INTEGER||9007199254740991,k=Number.MIN_SAFE_INTEGER||-9007199254740991,O={x:0,y:0,z:0},x={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){const n=e(t);let r=n.x*n.x+n.y*n.y;return void 0!==n.z&&(r+=n.z*n.z),y(r)},compute:function(t,e,n){if(0===t)return e[0].t=0,e[0];const r=e.length-1;if(1===t)return e[r].t=1,e[r];const o=1-t;let i=e;if(0===r)return e[0].t=t,e[0];if(1===r){const e={x:o*i[0].x+t*i[1].x,y:o*i[0].y+t*i[1].y,t};return n&&(e.z=o*i[0].z+t*i[1].z),e}if(r<4){let e,a,s,c=o*o,u=t*t,l=0;2===r?(i=[i[0],i[1],i[2],O],e=c,a=o*t*2,s=u):3===r&&(e=c*o,a=c*t*3,s=o*u*3,l=t*u);const f={x:e*i[0].x+a*i[1].x+s*i[2].x+l*i[3].x,y:e*i[0].y+a*i[1].y+s*i[2].y+l*i[3].y,t};return n&&(f.z=e*i[0].z+a*i[1].z+s*i[2].z+l*i[3].z),f}const a=JSON.parse(JSON.stringify(e));for(;a.length>1;){for(let e=0;e<a.length-1;e++)a[e]={x:a[e].x+(a[e+1].x-a[e].x)*t,y:a[e].y+(a[e+1].y-a[e].y)*t},void 0!==a[e].z&&(a[e]=a[e].z+(a[e+1].z-a[e].z)*t);a.splice(a.length-1,1)}return a[0].t=t,a[0]},computeWithRatios:function(t,e,n,r){const o=1-t,i=n,a=e;let s,c=i[0],u=i[1],l=i[2],f=i[3];return c*=o,u*=t,2===a.length?(s=c+u,{x:(c*a[0].x+u*a[1].x)/s,y:(c*a[0].y+u*a[1].y)/s,z:!!r&&(c*a[0].z+u*a[1].z)/s,t}):(c*=o,u*=2*o,l*=t*t,3===a.length?(s=c+u+l,{x:(c*a[0].x+u*a[1].x+l*a[2].x)/s,y:(c*a[0].y+u*a[1].y+l*a[2].y)/s,z:!!r&&(c*a[0].z+u*a[1].z+l*a[2].z)/s,t}):(c*=o,u*=1.5*o,l*=3*o,f*=t*t*t,4===a.length?(s=c+u+l+f,{x:(c*a[0].x+u*a[1].x+l*a[2].x+f*a[3].x)/s,y:(c*a[0].y+u*a[1].y+l*a[2].y+f*a[3].y)/s,z:!!r&&(c*a[0].z+u*a[1].z+l*a[2].z+f*a[3].z)/s,t}):void 0))},derive:function(t,e){const n=[];for(let r=t,o=r.length,i=o-1;o>1;o--,i--){const t=[];for(let n,o=0;o<i;o++)n={x:i*(r[o+1].x-r[o].x),y:i*(r[o+1].y-r[o].y)},e&&(n.z=i*(r[o+1].z-r[o].z)),t.push(n);n.push(t),r=t}return n},between:function(t,e,n){return e<=t&&t<=n||x.approximately(t,e)||x.approximately(t,n)},approximately:function(t,e,n){return l(t-e)<=(n||1e-6)},length:function(t){const e=x.Tvalues.length;let n=0;for(let r,o=0;o<e;o++)r=.5*x.Tvalues[o]+.5,n+=x.Cvalues[o]*x.arcfn(r,t);return.5*n},map:function(t,e,n,r,o){return r+(t-e)/(n-e)*(o-r)},lerp:function(t,e,n){const r={x:e.x+t*(n.x-e.x),y:e.y+t*(n.y-e.y)};return void 0!==e.z&&void 0!==n.z&&(r.z=e.z+t*(n.z-e.z)),r},pointToString:function(t){let e=t.x+"/"+t.y;return void 0!==t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map(x.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,n){const r=e.x-t.x,o=e.y-t.y,i=n.x-t.x,a=n.y-t.y;return d(r*a-o*i,r*i+o*a)},round:function(t,e){const n=""+t,r=n.indexOf(".");return parseFloat(n.substring(0,r+1+e))},dist:function(t,e){const n=t.x-e.x,r=t.y-e.y;return y(n*n+r*r)},closest:function(t,e){let n,r,o=v(2,63);return t.forEach((function(t,i){r=x.dist(e,t),r<o&&(o=r,n=i)})),{mdist:o,mpos:n}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const n=v(t,e)+v(1-t,e);return l((n-1)/n)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const n=v(1-t,e);return n/(v(t,e)+n)},lli8:function(t,e,n,r,o,i,a,s){const c=(t-n)*(i-s)-(e-r)*(o-a);return 0!=c&&{x:((t*r-e*n)*(o-a)-(t-n)*(o*s-i*a))/c,y:((t*r-e*n)*(i-s)-(e-r)*(o*s-i*a))/c}},lli4:function(t,e,n,r){const o=t.x,i=t.y,a=e.x,s=e.y,c=n.x,u=n.y,l=r.x,f=r.y;return x.lli8(o,i,a,s,c,u,l,f)},lli:function(t,e){return x.lli4(t,t.c,e,e.c)},makeline:function(t,e){const n=t.x,r=t.y,o=e.x,i=e.y,a=(o-n)/3,s=(i-r)/3;return new M(n,r,n+a,r+s,n+2*a,r+2*s,o,i)},findbbox:function(t){let e=w,n=w,r=k,o=k;return t.forEach((function(t){const i=t.bbox();e>i.x.min&&(e=i.x.min),n>i.y.min&&(n=i.y.min),r<i.x.max&&(r=i.x.max),o<i.y.max&&(o=i.y.max)})),{x:{min:e,mid:(e+r)/2,max:r,size:r-e},y:{min:n,mid:(n+o)/2,max:o,size:o-n}}},shapeintersections:function(t,e,n,r,o){if(!x.bboxoverlap(e,r))return[];const i=[],a=[t.startcap,t.forward,t.back,t.endcap],s=[n.startcap,n.forward,n.back,n.endcap];return a.forEach((function(e){e.virtual||s.forEach((function(r){if(r.virtual)return;const a=e.intersects(r,o);a.length>0&&(a.c1=e,a.c2=r,a.s1=t,a.s2=n,i.push(a))}))})),i},makeshape:function(t,e,n){const r=e.points.length,o=t.points.length,i=x.makeline(e.points[r-1],t.points[0]),a=x.makeline(t.points[o-1],e.points[0]),s={startcap:i,forward:t,back:e,endcap:a,bbox:x.findbbox([i,t,e,a]),intersections:function(t){return x.shapeintersections(s,s.bbox,t,t.bbox,n)}};return s},getminmax:function(t,e,n){if(!n)return{min:0,max:0};let r,o,i=w,a=k;-1===n.indexOf(0)&&(n=[0].concat(n)),-1===n.indexOf(1)&&n.push(1);for(let s=0,c=n.length;s<c;s++)r=n[s],o=t.get(r),o[e]<i&&(i=o[e]),o[e]>a&&(a=o[e]);return{min:i,mid:(i+a)/2,max:a,size:a-i}},align:function(t,e){const n=e.p1.x,r=e.p1.y,o=-d(e.p2.y-r,e.p2.x-n);return t.map((function(t){return{x:(t.x-n)*f(o)-(t.y-r)*h(o),y:(t.x-n)*h(o)+(t.y-r)*f(o)}}))},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const n=t.length-1,r=x.align(t,e),o=function(t){return 0<=t&&t<=1};if(2===n){const t=r[0].y,e=r[1].y,n=r[2].y,i=t-2*e+n;if(0!==i){const r=-y(e*e-t*n),a=-t+e;return[-(r+a)/i,-(-r+a)/i].filter(o)}return e!==n&&0===i?[(2*e-n)/(2*e-2*n)].filter(o):[]}const i=r[0].y,a=r[1].y,s=r[2].y;let c=3*a-i-3*s+r[3].y,u=3*i-6*a+3*s,l=-3*i+3*a,h=i;if(x.approximately(c,0)){if(x.approximately(u,0))return x.approximately(l,0)?[]:[-h/l].filter(o);const t=y(l*l-4*u*h),e=2*u;return[(t-l)/e,(-l-t)/e].filter(o)}u/=c,l/=c,h/=c;const d=(3*l-u*u)/3,v=d/3,g=(2*u*u*u-9*u*l+27*h)/27,_=g/2,w=_*_+v*v*v;let k,O,S,j,T;if(w<0){const t=-d/3,e=y(t*t*t),n=-g/(2*e),r=p(n<-1?-1:n>1?1:n),i=2*b(e);return S=i*f(r/3)-u/3,j=i*f((r+m)/3)-u/3,T=i*f((r+2*m)/3)-u/3,[S,j,T].filter(o)}if(0===w)return k=_<0?b(-_):-b(_),S=2*k-u/3,j=-k-u/3,[S,j].filter(o);{const t=y(w);return k=b(-_+t),O=b(_+t),[k-O-u/3].filter(o)}},droots:function(t){if(3===t.length){const e=t[0],n=t[1],r=t[2],o=e-2*n+r;if(0!==o){const t=-y(n*n-e*r),i=-e+n;return[-(t+i)/o,-(-t+i)/o]}return n!==r&&0===o?[(2*n-r)/(2*(n-r))]:[]}if(2===t.length){const e=t[0],n=t[1];return e!==n?[e/(e-n)]:[]}return[]},curvature:function(t,e,n,r,o){let i,a,s,c,u=0,f=0;const h=x.compute(t,e),p=x.compute(t,n),d=h.x*h.x+h.y*h.y;if(r?(i=y(v(h.y*p.z-p.y*h.z,2)+v(h.z*p.x-p.z*h.x,2)+v(h.x*p.y-p.x*h.y,2)),a=v(d+h.z*h.z,1.5)):(i=h.x*p.y-h.y*p.x,a=v(d,1.5)),0===i||0===a)return{k:0,r:0};if(u=i/a,f=a/i,!o){const o=x.curvature(t-.001,e,n,r,!0).k,i=x.curvature(t+.001,e,n,r,!0).k;c=(i-u+(u-o))/2,s=(l(i-u)+l(u-o))/2}return{k:u,r:f,dk:c,adk:s}},inflections:function(t){if(t.length<4)return[];const e=x.align(t,{p1:t[0],p2:t.slice(-1)[0]}),n=e[2].x*e[1].y,r=e[3].x*e[1].y,o=e[1].x*e[2].y,i=18*(-3*n+2*r+3*o-e[3].x*e[2].y),a=18*(3*n-r-3*o),s=18*(o-n);if(x.approximately(i,0)){if(!x.approximately(a,0)){let t=-s/a;if(0<=t&&t<=1)return[t]}return[]}const c=a*a-4*i*s,u=Math.sqrt(c),l=2*i;return x.approximately(l,0)?[]:[(u-a)/l,-(a+u)/l].filter((function(t){return 0<=t&&t<=1}))},bboxoverlap:function(t,e){const n=["x","y"],r=n.length;for(let o,i,a,s,c=0;c<r;c++)if(o=n[c],i=t[o].mid,a=e[o].mid,s=(t[o].size+e[o].size)/2,l(i-a)>=s)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,n){const r=t.bbox(),o=e.bbox(),i=1e5,a=n||.5;if(r.x.size+r.y.size<a&&o.x.size+o.y.size<a)return[(i*(t._t1+t._t2)/2|0)/i+"/"+(i*(e._t1+e._t2)/2|0)/i];let s=t.split(.5),c=e.split(.5),u=[{left:s.left,right:c.left},{left:s.left,right:c.right},{left:s.right,right:c.right},{left:s.right,right:c.left}];u=u.filter((function(t){return x.bboxoverlap(t.left.bbox(),t.right.bbox())}));let l=[];return 0===u.length||(u.forEach((function(t){l=l.concat(x.pairiteration(t.left,t.right,a))})),l=l.filter((function(t,e){return l.indexOf(t)===e}))),l},getccenter:function(t,e,n){const r=e.x-t.x,o=e.y-t.y,i=n.x-e.x,a=n.y-e.y,s=r*f(_)-o*h(_),c=r*h(_)+o*f(_),u=i*f(_)-a*h(_),l=i*h(_)+a*f(_),p=(t.x+e.x)/2,y=(t.y+e.y)/2,v=(e.x+n.x)/2,b=(e.y+n.y)/2,g=p+s,w=y+c,k=v+u,O=b+l,S=x.lli8(p,y,g,w,v,b,k,O),j=x.dist(S,t);let T,P=d(t.y-S.y,t.x-S.x),E=d(e.y-S.y,e.x-S.x),R=d(n.y-S.y,n.x-S.x);return P<R?((P>E||E>R)&&(P+=m),P>R&&(T=R,R=P,P=T)):R<E&&E<P?(T=R,R=P,P=T):R+=m,S.s=P,S.e=R,S.r=j,S},numberSort:function(t,e){return t-e}};class S{constructor(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map((function(t){return x.pointsToString(t.points)})).join(", ")+"]"}addCurve(t){this.curves.push(t),this._3d=this._3d||t._3d}length(){return this.curves.map((function(t){return t.length()})).reduce((function(t,e){return t+e}))}curve(t){return this.curves[t]}bbox(){const t=this.curves;for(var e=t[0].bbox(),n=1;n<t.length;n++)x.expandbox(e,t[n].bbox());return e}offset(t){const e=[];return this.curves.forEach((function(n){e.push(...n.offset(t))})),new S(e)}}const{abs:j,min:T,max:P,cos:E,sin:R,acos:C,sqrt:I}=Math,B=Math.PI;class M{constructor(t){let e=t&&t.forEach?t:Array.from(arguments).slice(),n=!1;if("object"==typeof e[0]){n=e.length;const t=[];e.forEach((function(e){["x","y","z"].forEach((function(n){void 0!==e[n]&&t.push(e[n])}))})),e=t}let r=!1;const o=e.length;if(n){if(n>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");r=!0}}else if(6!==o&&8!==o&&9!==o&&12!==o&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const i=this._3d=!r&&(9===o||12===o)||t&&t[0]&&void 0!==t[0].z,a=this.points=[];for(let t=0,n=i?3:2;t<o;t+=n){var s={x:e[t],y:e[t+1]};i&&(s.z=e[t+2]),a.push(s)}const c=this.order=a.length-1,u=this.dims=["x","y"];i&&u.push("z"),this.dimlen=u.length;const l=x.align(a,{p1:a[0],p2:a[c]});this._linear=!l.some((t=>j(t.y)>1e-4)),this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(t,e,n,r){if(void 0===r&&(r=.5),0===r)return new M(e,e,n);if(1===r)return new M(t,e,e);const o=M.getABC(2,t,e,n,r);return new M(t,o.A,n)}static cubicFromPoints(t,e,n,r,o){void 0===r&&(r=.5);const i=M.getABC(3,t,e,n,r);void 0===o&&(o=x.dist(e,i.C));const a=o*(1-r)/r,s=x.dist(t,n),c=(n.x-t.x)/s,u=(n.y-t.y)/s,l=o*c,f=o*u,h=a*c,p=a*u,d=e.x-l,y=e.y-f,v=e.x+h,b=e.y+p,g=i.A,m=g.x+(d-g.x)/(1-r),_=g.y+(y-g.y)/(1-r),w=g.x+(v-g.x)/r,k=g.y+(b-g.y)/r,O={x:t.x+(m-t.x)/r,y:t.y+(_-t.y)/r},S={x:n.x+(w-n.x)/(1-r),y:n.y+(k-n.y)/(1-r)};return new M(t,O,S,n)}static getUtils(){return x}getUtils(){return M.getUtils()}static get PolyBezier(){return S}valueOf(){return this.toString()}toString(){return x.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const t=this.points,e=["M",t[0].x,t[0].y,2===this.order?"Q":"C"];for(let n=1,r=t.length;n<r;n++)e.push(t[n].x),e.push(t[n].y);return e.join(" ")}setRatios(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}verify(){const t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}coordDigest(){return this.points.map((function(t,e){return""+e+t.x+t.y+(t.z?t.z:0)})).join("")}update(){this._lut=[],this.dpoints=x.derive(this.points,this._3d),this.computedirection()}computedirection(){const t=this.points,e=x.angle(t[0],t[this.order],t[1]);this.clockwise=e>0}length(){return x.length(this.derivative.bind(this))}static getABC(t=2,e,n,r,o=.5){const i=x.projectionratio(o,t),a=1-i,s={x:i*e.x+a*r.x,y:i*e.y+a*r.y},c=x.abcratio(o,t);return{A:{x:n.x+(n.x-s.x)/c,y:n.y+(n.y-s.y)/c},B:n,C:s,S:e,E:r}}getABC(t,e){e=e||this.get(t);let n=this.points[0],r=this.points[this.order];return M.getABC(this.order,n,e,r,t)}getLUT(t){if(this.verify(),t=t||100,this._lut.length===t)return this._lut;this._lut=[],t--;for(let e,n,r=0;r<t;r++)n=r/(t-1),e=this.compute(n),e.t=n,this._lut.push(e);return this._lut}on(e,n){n=n||5;const r=this.getLUT(),o=[];for(let t,i=0,a=0;i<r.length;i++)t=r[i],x.dist(t,e)<n&&(o.push(t),a+=i/r.length);return!!o.length&&(t/=o.length)}project(t){const e=this.getLUT(),n=e.length-1,r=x.closest(e,t),o=r.mpos,i=(o-1)/n,a=(o+1)/n,s=.1/n;let c,u,l=r.mdist,f=i,h=f;for(l+=1;f<a+s;f+=s)c=this.compute(f),u=x.dist(t,c),u<l&&(l=u,h=f);return h=h<0?0:h>1?1:h,c=this.compute(h),c.t=h,c.d=l,c}get(t){return this.compute(t)}point(t){return this.points[t]}compute(t){return this.ratios?x.computeWithRatios(t,this.points,this.ratios,this._3d):x.compute(t,this.points,this._3d,this.ratios)}raise(){const t=this.points,e=[t[0]],n=t.length;for(let r,o,i=1;i<n;i++)r=t[i],o=t[i-1],e[i]={x:(n-i)/n*r.x+i/n*o.x,y:(n-i)/n*r.y+i/n*o.y};return e[n]=t[n-1],new M(e)}derivative(t){return x.compute(t,this.dpoints[0],this._3d)}dderivative(t){return x.compute(t,this.dpoints[1],this._3d)}align(){let t=this.points;return new M(x.align(t,{p1:t[0],p2:t[t.length-1]}))}curvature(t){return x.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return x.inflections(this.points)}normal(t){return this._3d?this.__normal3(t):this.__normal2(t)}__normal2(t){const e=this.derivative(t),n=I(e.x*e.x+e.y*e.y);return{x:-e.y/n,y:e.x/n}}__normal3(t){const e=this.derivative(t),n=this.derivative(t+.01),r=I(e.x*e.x+e.y*e.y+e.z*e.z),o=I(n.x*n.x+n.y*n.y+n.z*n.z);e.x/=r,e.y/=r,e.z/=r,n.x/=o,n.y/=o,n.z/=o;const i={x:n.y*e.z-n.z*e.y,y:n.z*e.x-n.x*e.z,z:n.x*e.y-n.y*e.x},a=I(i.x*i.x+i.y*i.y+i.z*i.z);i.x/=a,i.y/=a,i.z/=a;const s=[i.x*i.x,i.x*i.y-i.z,i.x*i.z+i.y,i.x*i.y+i.z,i.y*i.y,i.y*i.z-i.x,i.x*i.z-i.y,i.y*i.z+i.x,i.z*i.z];return{x:s[0]*e.x+s[1]*e.y+s[2]*e.z,y:s[3]*e.x+s[4]*e.y+s[5]*e.z,z:s[6]*e.x+s[7]*e.y+s[8]*e.z}}hull(t){let e=this.points,n=[],r=[],o=0;for(r[o++]=e[0],r[o++]=e[1],r[o++]=e[2],3===this.order&&(r[o++]=e[3]);e.length>1;){n=[];for(let i,a=0,s=e.length-1;a<s;a++)i=x.lerp(t,e[a],e[a+1]),r[o++]=i,n.push(i);e=n}return r}split(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;const n=this.hull(t),r={left:2===this.order?new M([n[0],n[3],n[5]]):new M([n[0],n[4],n[7],n[9]]),right:2===this.order?new M([n[5],n[4],n[2]]):new M([n[9],n[8],n[6],n[3]]),span:n};return r.left._t1=x.map(0,0,1,this._t1,this._t2),r.left._t2=x.map(t,0,1,this._t1,this._t2),r.right._t1=x.map(t,0,1,this._t1,this._t2),r.right._t2=x.map(1,0,1,this._t1,this._t2),e?(e=x.map(e,t,1,0,1),r.right.split(e).left):r}extrema(){const t={};let e=[];return this.dims.forEach(function(n){let r=function(t){return t[n]},o=this.dpoints[0].map(r);t[n]=x.droots(o),3===this.order&&(o=this.dpoints[1].map(r),t[n]=t[n].concat(x.droots(o))),t[n]=t[n].filter((function(t){return t>=0&&t<=1})),e=e.concat(t[n].sort(x.numberSort))}.bind(this)),t.values=e.sort(x.numberSort).filter((function(t,n){return e.indexOf(t)===n})),t}bbox(){const t=this.extrema(),e={};return this.dims.forEach(function(n){e[n]=x.getminmax(this,n,t[n])}.bind(this)),e}overlaps(t){const e=this.bbox(),n=t.bbox();return x.bboxoverlap(e,n)}offset(t,e){if(void 0!==e){const n=this.get(t),r=this.normal(t),o={c:n,n:r,x:n.x+r.x*e,y:n.y+r.y*e};return this._3d&&(o.z=n.z+r.z*e),o}if(this._linear){const e=this.normal(0),n=this.points.map((function(n){const r={x:n.x+t*e.x,y:n.y+t*e.y};return n.z&&e.z&&(r.z=n.z+t*e.z),r}));return[new M(n)]}return this.reduce().map((function(e){return e._linear?e.offset(t)[0]:e.scale(t)}))}simple(){if(3===this.order){const t=x.angle(this.points[0],this.points[3],this.points[1]),e=x.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&e<0||t<0&&e>0)return!1}const t=this.normal(0),e=this.normal(1);let n=t.x*e.x+t.y*e.y;return this._3d&&(n+=t.z*e.z),j(C(n))<B/3}reduce(){let t,e,n=0,r=0,o=.01,i=[],a=[],s=this.extrema().values;for(-1===s.indexOf(0)&&(s=[0].concat(s)),-1===s.indexOf(1)&&s.push(1),n=s[0],t=1;t<s.length;t++)r=s[t],e=this.split(n,r),e._t1=n,e._t2=r,i.push(e),n=r;return i.forEach((function(t){for(n=0,r=0;r<=1;)for(r=n+o;r<=1.01;r+=o)if(e=t.split(n,r),!e.simple()){if(r-=o,j(n-r)<o)return[];e=t.split(n,r),e._t1=x.map(n,0,1,t._t1,t._t2),e._t2=x.map(r,0,1,t._t1,t._t2),a.push(e),n=r;break}n<1&&(e=t.split(n,1),e._t1=x.map(n,0,1,t._t1,t._t2),e._t2=t._t2,a.push(e))})),a}scale(t){const e=this.order;let n=!1;if("function"==typeof t&&(n=t),n&&2===e)return this.raise().scale(n);const r=this.clockwise,o=n?n(0):t,i=n?n(1):t,a=[this.offset(0,10),this.offset(1,10)],s=this.points,c=[],u=x.lli4(a[0],a[0].c,a[1],a[1].c);if(!u)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach((function(t){const n=c[t*e]=x.copy(s[t*e]);n.x+=(t?i:o)*a[t].n.x,n.y+=(t?i:o)*a[t].n.y})),n?([0,1].forEach((function(o){if(2!==e||!o){var i=s[o+1],a={x:i.x-u.x,y:i.y-u.y},l=n?n((o+1)/e):t;n&&!r&&(l=-l);var f=I(a.x*a.x+a.y*a.y);a.x/=f,a.y/=f,c[o+1]={x:i.x+l*a.x,y:i.y+l*a.y}}})),new M(c)):([0,1].forEach((t=>{if(2===e&&t)return;const n=c[t*e],r=this.derivative(t),o={x:n.x+r.x,y:n.y+r.y};c[t+1]=x.lli4(n,o,u,s[t+1])})),new M(c))}outline(t,e,n,r){e=void 0===e?t:e;const o=this.reduce(),i=o.length,a=[];let s,c=[],u=0,l=this.length();const f=void 0!==n&&void 0!==r;function h(t,e,n,r,o){return function(i){const a=r/n,s=(r+o)/n,c=e-t;return x.map(i,0,1,t+a*c,t+s*c)}}o.forEach((function(o){const i=o.length();f?(a.push(o.scale(h(t,n,l,u,i))),c.push(o.scale(h(-e,-r,l,u,i)))):(a.push(o.scale(t)),c.push(o.scale(-e))),u+=i})),c=c.map((function(t){return s=t.points,s[3]?t.points=[s[3],s[2],s[1],s[0]]:t.points=[s[2],s[1],s[0]],t})).reverse();const p=a[0].points[0],d=a[i-1].points[a[i-1].points.length-1],y=c[i-1].points[c[i-1].points.length-1],v=c[0].points[0],b=x.makeline(y,p),g=x.makeline(d,v),m=[b].concat(a).concat([g]).concat(c);return m.length,new S(m)}outlineshapes(t,e,n){e=e||t;const r=this.outline(t,e).curves,o=[];for(let t=1,e=r.length;t<e/2;t++){const i=x.makeshape(r[t],r[e-t],n);i.startcap.virtual=t>1,i.endcap.virtual=t<e/2-1,o.push(i)}return o}intersects(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof M&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)}lineIntersects(t){const e=T(t.p1.x,t.p2.x),n=T(t.p1.y,t.p2.y),r=P(t.p1.x,t.p2.x),o=P(t.p1.y,t.p2.y);return x.roots(this.points,t).filter((t=>{var i=this.get(t);return x.between(i.x,e,r)&&x.between(i.y,n,o)}))}selfintersects(t){const e=this.reduce(),n=e.length-2,r=[];for(let o,i,a,s=0;s<n;s++)i=e.slice(s,s+1),a=e.slice(s+2),o=this.curveintersects(i,a,t),r.push(...o);return r}curveintersects(t,e,n){const r=[];t.forEach((function(t){e.forEach((function(e){t.overlaps(e)&&r.push({left:t,right:e})}))}));let o=[];return r.forEach((function(t){const e=x.pairiteration(t.left,t.right,n);e.length>0&&(o=o.concat(e))})),o}arcs(t){return t=t||.5,this._iterate(t,[])}_error(t,e,n,r){const o=(r-n)/4,i=this.get(n+o),a=this.get(r-o),s=x.dist(t,e),c=x.dist(t,i),u=x.dist(t,a);return j(c-s)+j(u-s)}_iterate(t,e){let n,r=0,o=1;do{n=0,o=1;let i,a,s,c,u,l=this.get(r),f=!1,h=!1,p=o,d=1,y=0;do{if(h=f,c=s,p=(r+o)/2,y++,i=this.get(p),a=this.get(o),s=x.getccenter(l,i,a),s.interval={start:r,end:o},f=this._error(s,l,r,o)<=t,u=h&&!f,u||(d=o),f){if(o>=1){if(s.interval.end=d=1,c=s,o>1){let t={x:s.x+s.r*E(s.e),y:s.y+s.r*R(s.e)};s.e+=x.angle({x:s.x,y:s.y},t,this.get(1))}break}o+=(o-r)/2}else o=p}while(!u&&n++<100);if(n>=100)break;c=c||s,e.push(c),r=d}while(o<1);return e}}var A={RIGHT:0,BOTTOM:1,LEFT:2,TOP:3,SELF:100},L={DEFAULT:"DEFAULT",LINKING:"LINKING"};function D(t,e,n){return D=F()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&H(o,n.prototype),o},D.apply(null,arguments)}function F(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function H(t,e){return H=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},H(t,e)}function z(t){return function(t){if(Array.isArray(t))return N(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||W(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(t,e){if(t){if("string"==typeof t)return N(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(t,e):void 0}}function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function X(t){if(0===t.length)return{width:1,height:1,x:0,y:0};var e=1/0,n=1/0,r=-1/0,o=-1/0;for(var i in t){var a=t[i];a[0]<e&&(e=a[0]),a[0]>r&&(r=a[0]),a[1]<n&&(n=a[1]),a[1]>o&&(o=a[1])}return{width:Math.max(r-e,10),height:Math.max(o-n,10),x:e,y:n}}function Y(t){return t*t}function G(t,e){return Y(t[0]-e[0])+Y(t[1]-e[1])}function q(t,e,n){var r=G(e,n);if(0===r)return G(t,e);var o=((t[0]-e[0])*(n[0]-e[0])+(t[1]-e[1])*(n[1]-e[1]))/r;return o=Math.max(0,Math.min(1,o)),G(t,[e[0]+o*(n[0]-e[0]),e[1]+o*(n[1]-e[1])])}function V(t,e){var n={fromDir:null,fromP:null,toDir:null,toP:null,distMin:1/0};return Object.keys(t).forEach((function(r){if(+r!==A.SELF){var o=t[r];Object.keys(e).forEach((function(t){if(+t!==A.SELF){var i=e[t],a=G(o,i);a<n.distMin&&Object.assign(n,{distMin:a,fromDir:+r,fromP:o,toDir:+t,toP:i})}}))}})),n}function U(t,e,n,r){return e===A.TOP?[t[0],t[1]-r]:e===A.BOTTOM?[t[0],t[1]+r]:e===A.LEFT?[t[0]-n,t[1]]:e===A.RIGHT?[t[0]+n,t[1]]:void 0}function $(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.TOP,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.TOP,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=Math.max(Math.abs((t[0]-e[0])/2),o),s=Math.max(Math.abs((t[1]-e[1])/2),i),c=U(t,n,a,s),u=U(e,r,a,s),l=[A.TOP,A.LEFT].includes(r)?-5:5,f=[A.TOP,A.BOTTOM].includes(r),h=f?e[0]:e[0]+l,p=f?e[1]+l:e[1];return[].concat(z(c),z(u),[h,p])}function J(t,e,n,r,o,i,a,s,c){var u=Math.pow(1-t,2)*(r-e)+2*t*(1-t)*(i-r)+t*t*(s-i),l=Math.pow(1-t,2)*(o-n)+2*t*(1-t)*(a-o)+t*t*(c-a);return-Math.atan2(u,l)+.5*Math.PI}function K(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.TOP,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.TOP,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:10,a=arguments.length>6?arguments[6]:void 0,s=Math.abs(n-r),c=n===A.TOP||n===A.BOTTOM,u=[];switch(s){case 0:if(n===A.TOP){var l=Math.min(t[1],e[1]),f=l-i;u.push([t[0],f]),u.push([e[0],f])}if(n===A.BOTTOM){var h=Math.max(t[1],e[1]),p=h+i;u.push([t[0],p]),u.push([e[0],p])}if(n===A.LEFT){var d=Math.min(t[0],e[0]),y=d-o;u.push([y,t[1]]),u.push([y,e[1]])}if(n===A.RIGHT){var v=Math.max(t[0],e[0]),b=v+o;u.push([b,t[1]]),u.push([b,e[1]])}break;case 1:case 3:if(a)c?(u.push([t[0],t[1]+i]),u.push([e[0]+o,t[1]+i]),u.push([e[0]+o,e[1]])):(u.push([t[0]+o,t[1]]),u.push([t[0]+o,e[1]+i]),u.push([e[0],e[1]+i]));else{var g=c?[t[0],e[1]]:[e[0],t[1]];u.push(g)}break;case 2:var m=[(t[0]-e[0])/2+e[0],(t[1]-e[1])/2+e[1]];c?(u.push([t[0],m[1]]),u.push([e[0],m[1]])):(u.push([m[0],t[1]]),u.push([m[0],e[1]]))}return u.unshift(t),u.push(e),u}function Z(t,e){return[t[0]-e[0],t[1]-e[1]]}function Q(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function tt(t,e){return[t[0]*e,t[1]*e]}function et(t,e){return t[0]!=t[2]&&t[1]!=t[3]&&e[0]!=e[2]&&e[1]!=e[3]&&!(t[2]<=e[0]||t[3]<=e[1]||t[0]>=e[2]||t[1]>=e[3])}function nt(t){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(t)}function rt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ot(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function it(t,e){if(e&&("object"===nt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return at(t)}function at(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function st(t){var e="function"==typeof Map?new Map:void 0;return st=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return ct(t,arguments,ft(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),lt(r,t)},st(t)}function ct(t,e,n){return ct=ut()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&lt(o,n.prototype),o},ct.apply(null,arguments)}function ut(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function lt(t,e){return lt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},lt(t,e)}function ft(t){return ft=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ft(t)}var ht=Symbol("ishit"),pt=Symbol("isInViewBox"),dt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lt(t,e)}(a,t);var e,n,r,o,i=(e=a,n=ut(),function(){var t,r=ft(e);if(n){var o=ft(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return it(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return rt(this,a),t=i.call(this),Object.assign(at(t),e),t.visible=!0,t._belongs=void 0,t[ht]=!1,t.borderWidth=e.borderWidth||0,t.borderColor=e.borderColor||"transparent",t.backgroundColor=e.backgroundColor||"transparent",t.shadowColor=e.shadowColor,t.shadowBlur=e.shadowBlur||5,t.shadowOffsetX=e.shadowOffsetX||0,t.shadowOffsetY=e.shadowOffsetY||0,t.opacity=e.opacity||1,t}return r=a,o=[{key:"_isTargeting",get:function(){return this===(this._jflow._target.instance||this._jflow._target.link)}},{key:"_isMoving",get:function(){return this===this._jflow._getMovingTarget()&&this._jflow._target.status.movingState}},{key:"_isHit",get:function(){return this[ht]},set:function(t){this[ht]!==t&&this.dispatchEvent(new CustomEvent(t?"mouseenter":"mouseleave",{detail:{instance:this,jflow:this._jflow}})),this[ht]=t}},{key:"_jflow",get:function(){return"jflow"===this._belongs.uniqueName?this._belongs:this._belongs._jflow}},{key:"isInViewBox",get:function(){return this[pt]}},{key:"_isInViewBox",set:function(t){t!==this[pt]&&(t?this.onEnterViewbox():this.onLeaveViewbox()),this[pt]=t}},{key:"onEnterViewbox",value:function(){}},{key:"onLeaveViewbox",value:function(){}},{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n])}))}},{key:"render",value:function(t){throw"require render implement"}},{key:"isHit",value:function(t){throw"require isHit implement"}},{key:"getBoundingRect",value:function(){throw"require getBoundingRect implement"}},{key:"calculateIntersection",value:function(){throw"require calculateIntersection implement"}},{key:"getIntersectionsInFourDimension",value:function(){throw"require getIntersectionsInFourDimension implement"}},{key:"getCenter",value:function(){return this.anchor}},{key:"getBoundingDimension",value:function(){var t=instance.getBoundingRect(),e=1/0,n=-1/0,r=1/0,o=-1/0;return t.forEach((function(t){n=Math.max(n,t[1]),e=Math.min(e,t[1]),o=Math.max(o,t[0]),r=Math.min(r,t[0])})),{height:n-e,width:o-r}}},{key:"bubbleEvent",value:function(t){t.detail.currentTarget=this,this.dispatchEvent(t),t.detail.bubbles&&(this._belongs.bubbleEvent?this._belongs.bubbleEvent(t):this._belongs.dispatchEvent(t))}},{key:"calculateToRealWorld",value:function(t){return this._belongs&&this._belongs.calculateToRealWorld?this._belongs.calculateToRealWorld(t):t}},{key:"calculateToRealWorldWithScalar",value:function(t){return this._jflow.scale*t}},{key:"recalculateUp",value:function(){this.belongs&&this.belongs.recalculateUp()}},{key:"destroy",value:function(){}}],o&&ot(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),a}(st(EventTarget));const yt=dt;function vt(t){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vt(t)}function bt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mt(t,e){return mt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},mt(t,e)}function _t(t,e){if(e&&("object"===vt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function wt(t){return wt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},wt(t)}var kt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mt(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=wt(r);if(o){var n=wt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return _t(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return bt(this,a),(t=i.call(this,e))._rawConfigs=e,t.anchor=e.anchor||[0,0],t.absolutePosition=e.absolutePosition,t}return e=a,(n=[{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n],e._rawConfigs[n]=t[n])}))}},{key:"setAnchorX",value:function(t){this.anchor[0]=t}},{key:"setAnchorY",value:function(t){this.anchor[1]=t}},{key:"setAnchor",value:function(t,e){this.anchor[0]=t,this.anchor[1]=e}},{key:"clone",value:function(){var t=new(0,this.constructor)(this._rawConfigs);return t.visible=this.visible,t}}])&&gt(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(yt);const Ot=kt;function xt(t){return xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xt(t)}function St(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Tt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Pt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Et(t,e){return Et=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Et(t,e)}function Rt(t,e){if(e&&("object"===xt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ct(t){return Ct=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ct(t)}const It=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Et(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ct(r);if(o){var n=Ct(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Rt(this,t)});function a(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),i.call(this,t)}return e=a,(n=[{key:"render",value:function(t){}},{key:"isHit",value:function(t){return!1}},{key:"calculateIntersection",value:function(t){return this.anchor}},{key:"getBoundingRect",value:function(){var t=jt(this.anchor,2),e=t[0],n=t[1];return[e,n,e,n]}},{key:"getBoundingDimension",value:function(){return{width:0,height:0}}},{key:"getIntersectionsInFourDimension",value:function(){var t,e=jt(this.anchor,2),n=e[0],r=e[1];return St(t={},A.RIGHT,[n+1,r]),St(t,A.LEFT,[n-1,r]),St(t,A.BOTTOM,[n,r+1]),St(t,A.TOP,[n,r-1]),t}}])&&Pt(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ot);function Bt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Mt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._map=new WeakMap}var e,n;return e=t,(n=[{key:"get",value:function(t){return this._map.get(t)}},{key:"set",value:function(t){var e={layoutNode:void 0,jflowNode:void 0,jflowlinks:[],jflowFromLinks:[],jflowToLinks:[]};return this._map.set(t,e),e}},{key:"has",value:function(t){return this._map.has(t)}},{key:"delete",value:function(t){this._map.delete(t)}},{key:"clear",value:function(){this._map.clear()}}])&&Bt(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),At={initNodeWeakMap:function(){this.source_Layout_Render_NodeMap=new Mt},getRenderNodeBySource:function(t){var e=this.source_Layout_Render_NodeMap.get(t);if(e)return e.jflowNode},getLayoutNodeBySource:function(t){var e=this.source_Layout_Render_NodeMap.get(t);if(e)return e.layoutNode},getSourceRenderMeta:function(t){return this.source_Layout_Render_NodeMap.get(t)},_getMap:function(t){var e=this.source_Layout_Render_NodeMap;return e.has(t)?e.get(t):e.set(t)},setLayoutNodeBySource:function(t,e){this._getMap(t).layoutNode=e},setRenderNodeBySource:function(t,e){this._getMap(t).jflowNode=e},addLinkNodeBySource:function(t,e,n){var r=this._getMap(t);r.jflowFromLinks.push(n),(r=this._getMap(e)).jflowToLinks.push(n)},removeLinkNodeBySource:function(t,e,n){var r=this._getMap(t),o=r.jflowFromLinks.findIndex((function(t){return t===n}));-1!==o&&r.jflowFromLinks.splice(o,1),-1!==(o=(r=this._getMap(e)).jflowToLinks.findIndex((function(t){return t===n})))&&r.jflowToLinks.splice(o,1)}};function Lt(t){return Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lt(t)}function Dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ft(t,e){if(e&&("object"===Lt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ht(t){var e="function"==typeof Map?new Map:void 0;return Ht=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return zt(t,arguments,Xt(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Nt(r,t)},Ht(t)}function zt(t,e,n){return zt=Wt()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&Nt(o,n.prototype),o},zt.apply(null,arguments)}function Wt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Nt(t,e){return Nt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Nt(t,e)}function Xt(t){return Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Xt(t)}var Yt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nt(t,e)}(a,t);var e,n,r,o,i=(e=a,n=Wt(),function(){var t,r=Xt(e);if(n){var o=Xt(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return Ft(this,t)});function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this))._currentHit=null,t}return r=a,o=[{key:"render",value:function(t,e){var n;this.forEach((function(r){r._isMoving?n=r:!r.visible||e&&!e(r)||(t.save(),r.render(t),t.restore())})),n&&(t.save(),n.render(t),t.restore())}},{key:"resetHitStatus",value:function(){this._currentHit=null,this.forEach((function(t){t._stack&&t._stack.resetHitStatus(),t._isHit=!1}))}},{key:"checkHit",value:function(t,e,n){for(var r=this.length-1;r>=0;){var o=this[r];if(o.visible&&!o.ignoreHit){if(e&&e(o)){r--;continue}if(n&&!n(o)){r--;continue}var i=o.isHit(t,e);if(i)return this._currentHit!==o&&(this._currentHit&&(this._currentHit._isHit=!1),o._isHit=!0,this._currentHit=o),"boolean"!=typeof i?i:o;o._isHit=!1}r--}return this._currentHit=null,null}},{key:"getBoundingRectPoints",value:function(){var t=[];return this.forEach((function(e){if(e.visible&&!e.absolutePosition){var n=e.getBoundingRect();t.push([n[0],n[1]]),t.push([n[2],n[3]])}})),t}},{key:"getAnchorRectPoints",value:function(){var t=[];return this.forEach((function(e){e.visible&&!e.absolutePosition&&t.push(e.anchor)})),t}}],o&&Dt(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),a}(Ht(Array));const Gt=Yt,qt={instances:[],links:[],_stack:null,_linkStack:null,initStack:function(t){var e=this,n=t.data;this._stack=new Gt,this._linkStack=new Gt,n&&(this.instances=n.instances,this.links=n.links,this.instances.forEach((function(t){e._stack.push(t),t._belongs=e})),this.links.forEach((function(t){e._linkStack.push(t),t._belongs=e})))},addToStack:function(t){t._belongs=this,this._stack.push(t)},replaceFromStack:function(t,e){var n=this._stack.findIndex((function(e){return e===t}));this._stack.splice(n,1,e),t._belongs=null,e._belongs=this},addToLinkStack:function(t){t._belongs=this,this._linkStack.push(t)},removeFromStack:function(t){var e=this._stack.findIndex((function(e){return e===t}));-1!==e&&this._stack.splice(e,1)},removeFromLinkStack:function(t){var e=this._linkStack.findIndex((function(e){return e===t}));-1!==e&&this._linkStack.splice(e,1)},emptyLink:function(){this._linkStack=new Gt},resetChildrenPosition:function(){this._stack.forEach((function(t){t.anchor=[0,0]}))},addInstanceToLink:function(t,e){this.addToStack(e);var n=t.from,r=t.to,o=this._linkStack.findIndex((function(e){return e===t})),i=t.__proto__.constructor,a=new i({from:n,to:e});a._belongs=this;var s=new i({from:e,to:r});s._belongs=this,this._linkStack.splice(o,1,a,s)},interateNodeStack:function(t){this._stack.forEach((function(e){t(e)}))}},Vt={_layout:null,initLayout:function(t){this._layout=t.layout},recalculateUp:function(){var t=!0;if(this.getBoundingDimension){var e=this.getBoundingDimension(),n=e.width,r=e.height;this.resetChildrenPosition&&this.resetChildrenPosition(),this._getBoundingGroupRect&&this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect();var o=this.getBoundingDimension(),i=o.width,a=o.height;t=n!==i||r!==a}else this.reflow();this._belongs&&t&&this._belongs.recalculateUp()},recalculate:function(){this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect()},staticCheck:function(t){return!!this._layout&&this._layout.staticCheck(t,this)},reflow:function(){this._layout&&this._layout.reflow(this)}},Ut={initAnime:function(){this.anime_queue=[],this.__animeClock__=void 0},requestJFlowAnime:function(t){var e=this.enqueueAnime(t);return this._runAnime(),e},enqueueAnime:function(t){var e=this,n={start:void 0,callback:t,cancel:function(){e._cancelAnime(n),e._render()}};return this.anime_queue.push(n),n},_cancelAnime:function(t){var e=this.anime_queue.findIndex((function(e){return e===t}));~e&&this.anime_queue.splice(e,1)},runAnime:function(){this._runAnime()},_runAnime:function(){var t=this;this.anime_queue.length&&requestAnimationFrame((function(){t.scheduleRender(),t._runAnime()}))},runAnimeFrame:function(){this.anime_queue.forEach((function(t){var e=Date.now();t.start||(t.start=e);var n=e-t.start;t.callback(n)}))}};function $t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Jt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Jt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const Kt={captureMap:function(t,e){var r=this,o=e.padding,i=void 0===o?0:o,a=e.placement,s=void 0===a?"normal":a;this._getBoundingGroupRect();var c=this.bounding_box,u=c.width,l=c.height,f=c.x,h=c.y;if(!this.miniMap){this.miniMap=n(t);var p=this.miniMap,d=p.width,y=p.height,v=p.raw_width,b=p.raw_height;this.addEventListener("zoompan",(function(){r._renderMap&&r._renderMap()}));var g=!1;this.miniMap.canvas.addEventListener("pointerdown",(function(t){var e=t.offsetX,n=t.offsetY;t.deltaX,t.deltaY,g=!0,r._onMoveMap&&r._onMoveMap(e,n)})),this.miniMap.canvas.addEventListener("pointermove",(function(t){var e=t.offsetX,n=t.offsetY;t.deltaX,t.deltaY,g&&r._onMoveMap&&r._onMoveMap(e,n),(n<5||e<5||e>d-5||n>y-5)&&(g=!1)})),this.miniMap.canvas.addEventListener("pointerup",(function(){g=!1}));var m=document.createElement("canvas");m.width=v,m.height=b,this.cacheMinimapCtx=m.getContext("2d")}var _=this.miniMap,w=_.width,k=_.height,O=_.raw_width,x=_.raw_height,S=(_.left,_.top,_.scale),j=_.ctx,T=2*i,P=i,E=(w-T)/u,R=(k-T)/l,C=Math.min(E,R),I=0,B=0;"center"===s?(B=(k-l*C)/2-h*C,I=(w-u*C)/2-f*C):E<R?(B=(k-l*C)/2-h*C,I=P):(I=(w-u*C)/2-f*C,B=P);var M=this.cacheMinimapCtx;M.setTransform(),M.clearRect(0,0,O,x),M.scale(S,S),M.transform(C,0,0,C,I,B);var A=[0,0,0,0];this.NodeRenderTop?(this._linkStack.render(M,(function(t){return t.isInViewBox(A),!0})),this._stack.render(M)):(this._stack.render(M),this._linkStack.render(M,(function(t){return t.isInViewBox(A),!0})));var L=M.getImageData(0,0,O,x);this._renderMap=function(){j.save(),j.setTransform(),j.clearRect(0,0,O,x),j.scale(S,S),j.putImageData(L,0,0),j.transform(C,0,0,C,I,B);var t=$t(r._getViewBox(),4),e=t[0],n=t[1],o=t[2],i=t[3];j.beginPath(),j.rect(e,n,o-e,i-n),j.setTransform(),j.rect(0,0,O,x),j.clip("evenodd"),j.fillStyle="rgba(0,0,0,0.4)",j.fillRect(0,0,O,x),j.restore()},this._renderMap(),this._onMoveMap=function(t,e){var n=$t(r._getViewBox(),4),o=n[0],i=n[1],a=n[2],s=n[3],c=[((a-o)/2+o)*C+I,((s-i)/2+i)*C+B];r._recalculatePosition((c[0]-t)/C*r.scale,(c[1]-e)/C*r.scale),r._render(),r._renderMap()}}};function Zt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Qt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function te(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ee(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ne=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};te(this,t),this.anchor=[0,0],this.width=n.barWidth||4,this.height=n.barWidth||4,this.barMarginX=0,this.barMarginY=0,this.dir=e,this.plainColor=n.plainColor||"rgba(0, 0, 0, 0.15)",this.focusColor=n.focusColor||"rgba(0, 0, 0, 0.25)",this.isFocus=!1}var e,n;return e=t,n=[{key:"render",value:function(t){var e=Zt(this.anchor,2),n=e[0],r=e[1];if(t.save(),t.beginPath(),"x"===this.dir){var o=this.height/2,i=r+o,a=r+this.height,s=n+this.width-2*this.barMarginX-o,c=n+this.barMarginX+o;t.moveTo(c,a),t.arc(c,i,o,Math.PI/2,Math.PI/2*3),t.lineTo(s,r),t.arc(s,i,o,-Math.PI/2,Math.PI/2),t.closePath()}else{var u=this.width/2,l=r+this.barMarginY+u,f=r+this.height-2*this.barMarginY-u,h=n+u,p=n+this.width;t.moveTo(n,l),t.arc(h,l,u,-Math.PI,0),t.lineTo(p,f),t.arc(h,f,u,0,Math.PI),t.closePath()}t.fillStyle=this.isFocus?this.focusColor:this.plainColor,t.fill(),t.restore()}},{key:"isHit",value:function(t){var e=this.anchor,n=this.width,r=this.height;return t[0]>e[0]-5&&t[0]<e[0]+n+5&&t[1]>e[1]-5&&t[1]<e[1]+r+5}}],n&&ee(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();const re={initScrollBar:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.barColor,r=e.barFocusColor,o=e.barMarginX,i=e.barMarginY,a=e.barWidth;this._scrollbarEnable=!0,this._scrollbarX=new ne("x",{plainColor:n,focusColor:r,barWidth:a}),this._scrollbarX.barMarginX=o||5,this._scrollbarY=new ne("y",{plainColor:n,focusColor:r,barWidth:a}),this._scrollbarY.barMarginY=i||5,this._scrollBarStatus={dragging:!1,target:null,xscale:void 0,yscale:void 0,barInitX:0,barInitY:0},this.addEventListener("zoompan",(function(){t.scrollBarOnPanAndZoom()})),this.scrollBarOnPanAndZoom(),this.canvas.addEventListener("pointerdown",(function(e){var n=e.offsetX,r=e.offsetY,o=e.clientX,i=e.clientY;t.onScrollbarPressStart(n,r,o,i)}))},checkScrollDragging:function(){return this._scrollBarStatus&&this._scrollBarStatus.dragging},onScrollbarPressStart:function(t,e,n,r){var o=this;this._scrollbarX.isHit([t,e])&&Object.assign(this._scrollBarStatus,{dragging:!0,target:this._scrollbarX,barStartX:this._scrollbarX.anchor[0],barInitX:n}),this._scrollbarY.isHit([t,e])&&Object.assign(this._scrollBarStatus,{dragging:!0,target:this._scrollbarY,barStartY:this._scrollbarY.anchor[1],barInitY:r});var i=function(t){var e=t.offsetX,n=t.offsetY,r=t.clientX,i=t.clientY;o.onDraggingScrollbar(e,n,r,i)}.bind(this);document.addEventListener("pointermove",i);var a=function(t){Object.assign(o._scrollBarStatus,{dragging:!1,target:null,x:void 0,y:void 0}),document.removeEventListener("pointermove",i),document.removeEventListener("pointerup",a),o.canvas.removeEventListener("pointerup",a)}.bind(this);this.canvas.addEventListener("pointerup",a,{once:!0}),document.addEventListener("pointerup",a,{once:!0})},onDraggingScrollbar:function(t,e,n,r){if(this._scrollbarEnable&&this._scrollBarStatus.dragging){var o=this._scrollBarStatus,i=o.target,a=o.barInitX,s=o.barStartX,c=o.barInitY,u=o.barStartY,l=(o.xscale,o.yscale,o.scollbarHeight),f=o.scollbarWidth,h=o.realR,p=o.realL,d=o.realT,y=o.realB,v=this.canvasMeta,b=v.actual_width,g=v.actual_height,m=this.bounding_box,_=m.x,w=m.y;if("x"===i.dir){var k=s+(n-a),O=(_-((h-p)*((i.anchor[0]=Math.max(Math.min(k,b-f),0))/b)+p))*this.scale;Object.assign(this.position,{offsetX:O-_*this.scale,x:O})}if("y"===i.dir){var x=u+(r-c),S=(w-((y-d)*((i.anchor[1]=Math.max(Math.min(x,g-l),0))/g)+d))*this.scale;Object.assign(this.position,{offsetY:S-w*this.scale,y:S})}return this.scheduleRender(),!0}return!1},checkScrollBarHover:function(t,e){if(this._scrollbarEnable){if(this._scrollbarX.isHit([t,e]))return this._scrollbarX.isFocus||(this._scrollbarX.isFocus=!0,this.scheduleRender()),this.canvas.style.cursor="default",!0;if(this._scrollbarY.isHit([t,e]))return this._scrollbarY.isFocus||(this._scrollbarY.isFocus=!0,this.scheduleRender()),this.canvas.style.cursor="default",!0}return!1},resetScrollBarHover:function(){this._scrollbarEnable&&(this._scrollbarY.isFocus||this._scrollbarX.isFocus)&&(this._scrollbarY.isFocus=!1,this._scrollbarX.isFocus=!1,this.scheduleRender())},_getScrollViewBoundingbox:function(){var t=this.bounding_box;return{width:t.width+240,height:t.height+240,x:t.x-120,y:t.y-120}},scrollBarOnPanAndZoom:function(){if(this._scrollbarEnable&&!this._scrollBarStatus.dragging){var t=this._getScrollViewBoundingbox(),e=t.width,n=t.height,r=t.x,o=t.y,i=Zt(this._getViewBox(),4),a=i[0],s=i[1],c=i[2],u=i[3],l=Math.max(c,r+e),f=Math.min(a,r),h=Math.min(s,o),p=Math.max(u,o+n),d=c-a,y=u-s,v=this.canvasMeta,b=v.actual_width,g=v.actual_height,m=d/(l-f);if(m<1){var _=b*m,w=(a-f)*m*this.scale;this._scrollbarX.anchor=[w,g-10],this._scrollbarX.width=_,this._scrollBarStatus.scollbarWidth=_}var k=y/(p-h);if(k<1){var O=g*k,x=(s-h)*k*this.scale;this._scrollbarY.anchor=[b-10,x],this._scrollbarY.height=O,this._scrollBarStatus.scollbarHeight=O}Object.assign(this._scrollBarStatus,{yscale:k,xscale:m,realR:l,realL:f,realT:h,realB:p})}},resetScollBarStatus:function(){this._scrollbarEnable&&Object.assign(this._scrollBarStatus,{dragging:!1,target:null,x:void 0,y:void 0})},renderScrollBar:function(t){if(this._scrollbarEnable){t.setTransform(),t.scale(this.dpr,this.dpr);var e=this._scrollBarStatus,n=e.xscale,r=e.yscale;n<1&&this._scrollbarX.render(t),r<1&&this._scrollbarY.render(t)}}};var oe=1e3/60;const ie={initSchedule:function(){this.__clock__=Date.now()-oe,this.__callbacks__=[]},scheduleRender:function(t){var e=this;t&&this.__callbacks__.push(t),!this.__processing__&&Date.now()-this.__clock__>=oe&&(this.__processing__=!0,requestAnimationFrame((function(t){e.__render(),e.__callbacks__.forEach((function(e){e(t)})),e.__callbacks__=[],e.__processing__=!1,e.__clock__=t})))}};function ae(t){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ae(t)}function se(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ce(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?se(Object(n),!0).forEach((function(e){ue(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ue(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function le(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fe(t,e){if(e&&("object"===ae(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function he(t){var e="function"==typeof Map?new Map:void 0;return he=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return pe(t,arguments,ve(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ye(r,t)},he(t)}function pe(t,e,n){return pe=de()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&ye(o,n.prototype),o},pe.apply(null,arguments)}function de(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function ye(t,e){return ye=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ye(t,e)}function ve(t){return ve=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ve(t)}var be=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ye(t,e)}(i,t);var e,n,r,o=(e=i,n=de(),function(){var t,r=ve(e);if(n){var o=ve(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return fe(this,t)});function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};le(this,i);var n=ce(ce({},e),{},{originEvent:e.event,target:e.target,jflow:e.jflow,bubbles:e.bubbles||!1});return o.call(this,t,{detail:n})}return r=i,Object.defineProperty(r,"prototype",{writable:!1}),r}(he(CustomEvent));const ge=be;function me(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function we(){var t={pointerDown:!1,dirty:!1};return{canvas:{wheel:function(t,e){t.preventDefault();var n=t.offsetX,r=t.offsetY,o=t.deltaX,i=t.deltaY;t.ctrlKey?(i=-i,e.zoomHandler(n,r,o,i,t)):e.panHandler(-o,-i,t)},pointerdown:function(e,n){var r=e.offsetX,o=e.offsetY;e.deltaY,0===e.button&&(t.pointerDown=!0,n.pressStartHandler(r,o,e))},pointermove:function(e,n){var r=e.offsetX,o=e.offsetY;t.pointerDown&&(t.dirty=!0),n.pressMoveHandler(r,o,e)},pointerup:function(e,n){e.preventDefault(),e.offsetX,e.offsetY,0===e.button&&t.pointerDown&&t.dirty&&(t.pointerDown=!1,t.dirty=!1,n.pressUpHanlder(!1,e))},contextmenu:function(t,e){t.preventDefault(),t.stopPropagation();var n=t.offsetX,r=t.offsetY;e.contextMenuHanlder(n,r,t)},dblclick:function(t,e){t.preventDefault(),t.stopPropagation();var n=t.offsetX,r=t.offsetY;e.dblclickHandler(n,r,t)},click:function(e,n){e.preventDefault(),e.stopPropagation();var r=e.offsetX,o=e.offsetY;t.dirty||(t.pointerDown=!1,t.dirty=!1,n.clickHanlder(r,o,e))}},document:{pointerup:function(t,e){e.pressUpHanlder(!0,t)}}}}var ke=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};me(this,t),this.plugin=we(),this.use(e),this.canvasHandlers=[],this.documentHandlers=[]}var e,n;return e=t,n=[{key:"use",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.canvas,n=t.document;if(e)for(var r in e)e.hasOwnProperty(r)&&(this.plugin.canvas[r]=e[r]);if(n)for(var o in n)n.hasOwnProperty(o)&&(this.plugin.document[o]=n[o])}},{key:"apply",value:function(t){var e=this,n=this.plugin,r=n.canvas,o=n.document,i=t.canvas,a=function(n){var o=r[n];function a(e){o(e,t)}i.addEventListener(n,a),e.canvasHandlers.push({eventName:n,handlerWrapperd:a})};for(var s in r)a(s);var c=function(n){var r=void 0,i={};function a(e){r(e,t)}"function"==typeof o[n]?r=o[n]:(r=o[n].handler,Object.assign(i,o[n].options)),document.addEventListener(n,a,i),e.documentHandlers.push({eventName:n,handlerWrapperd:a,options:i})};for(var u in o)c(u)}},{key:"unload",value:function(t){var e=t.canvas;this.canvasHandlers.forEach((function(t){var n=t.eventName,r=t.handlerWrapperd;e.removeEventListener(n,r)})),this.documentHandlers.forEach((function(t){var e=t.eventName,n=t.handlerWrapperd,r=t.options;console.log("unload",e),document.removeEventListener(e,n,r)}))}}],n&&_e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();const Oe=ke;function xe(t){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xe(t)}function Se(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function je(t,e,n){return e&&Se(t.prototype,e),n&&Se(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Te(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Pe(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ee(t,e)}function Ee(t,e){return Ee=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ee(t,e)}function Re(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Be(t);if(e){var o=Be(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ce(this,n)}}function Ce(t,e){if(e&&("object"===xe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ie(t)}function Ie(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Be(t){return Be=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Be(t)}function Me(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Ae(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ae(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ae(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Le(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function De(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Le(Object(n),!0).forEach((function(e){Fe(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Fe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var He=De(De(De({},qt),Vt),{},{_setPadding:function(t){this.padding={top:t.paddingTop||t.padding||0,right:t.paddingRight||t.padding||0,bottom:t.paddingBottom||t.padding||0,left:t.paddingLeft||t.padding||0}},_setMargin:function(t){this.margin={top:t.marginTop||t.margin||0,right:t.marginRight||t.margin||0,bottom:t.marginBottom||t.margin||0,left:t.marginLeft||t.margin||0}},_getCenter:function(){var t=this.anchor,e=this.padding,n=this.margin,r=(n.left-n.right)/2,o=(n.top-n.bottom)/2,i=(e.left-e.right)/2+r,a=(e.top-e.bottom)/2+o;return this._shape.anchor=[t[0]+r,t[1]+o],[t[0]+i,t[1]+a]},setAnchorX:function(t){this.anchor[0]=t,this._getCenter()},setAnchorY:function(t){this.anchor[1]=t,this._getCenter()},setAnchor:function(t,e){this.anchor[0]=t,this.anchor[1]=e,this._getCenter()},_calculatePointBack:function(t){var e=Me(t,2),n=e[0],r=e[1],o=Me(this._getCenter(),2);return[n-o[0],r-o[1]]},calculateToCoordination:function(t){var e=Me(t,2),n=e[0],r=e[1],o=Me(this._getCenter(),2),i=[n+o[0],r+o[1]];return this._belongs&&this._belongs.calculateToCoordination?this._belongs.calculateToCoordination(i):i},calculateToRealWorld:function(t){var e=Me(t,2),n=e[0],r=e[1],o=Me(this._getCenter(),2),i=[n+o[0],r+o[1]];if(this._belongs&&this._belongs.calculateToRealWorld)return this._belongs.calculateToRealWorld(i)},clone:function(){var t=new(0,this.constructor)(Object.assign({},this._rawConfigs,{layout:this._layout&&this._layout.clone()}));return this.interateNodeStack((function(e){t.addToStack(e.clone())})),t.recalculate(),t.visible=this.visible,t},getBoundingDimension:function(){return{width:this.width,height:this.height}},getBoundingRect:function(){var t=this.anchor,e=this.width/2,n=this.height/2;return[t[0]-e,t[1]-n,t[0]+e,t[1]+n]},getIntersectionsInFourDimension:function(){var t,e=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(e=this._belongs.calculateToCoordination(e));var n=Me(e,2),r=n[0],o=n[1],i=this.width/2,a=this.height/2;return Fe(t={},A.RIGHT,[r+i,o]),Fe(t,A.LEFT,[r-i,o]),Fe(t,A.BOTTOM,[r,o+a]),Fe(t,A.TOP,[r,o-a]),Fe(t,A.SELF,[r+.618*i,o+.618*a]),t},calculateIntersection:function(t){var e,n,r=Me(t,2),o=r[0],i=r[1],a=Me(this.anchor,2),s=a[0],c=a[1],u=this.width/2,l=this.height/2,f=s-o,h=c-i,p=l/u,d=Math.abs(h/f),y=o>s,v=i>c;return d<p?(e=s+(y?u:-u),n=u*(v?d:-d)+c):(n=c+(v?l:-l),e=l/(y?d:-d)+s),[e,n]},onEnterViewbox:function(){this.interateNodeStack((function(t){t.onEnterViewbox()}))},onLeaveViewbox:function(){this.interateNodeStack((function(t){t.onLeaveViewbox()}))},destroy:function(){this._shape.destroy(),this.interateNodeStack((function(t){t.destroy()}))}});function ze(t,e){return[t,e]}const We=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="function"==typeof e.shapeShift?e.shapeShift:ze,r=function(e){Pe(r,e);var n=Re(r);function r(e){var o,i,a;return Te(this,r),(a=n.call(this,e)).initStack(e),a.initLayout(e),a._shape=new t(e),a._shape.anchor=[0,0],a._shape._belongs=Ie(a),a._setPadding(e),a._setMargin(e),a.definedWidth=e.width,a.minWidth=e.minWidth,a.definedHeight=e.height,a.lock=null===(o=e.lock)||void 0===o||o,a.display=e.display||"default",a.transparent=null!==(i=e.transparent)&&void 0!==i&&i,a._getBoundingGroupRect(),a.reflow(),a._getBoundingGroupRect(),a}return je(r)}(Ot);return Object.assign(r.prototype,He),Object.assign(r.prototype,{reflow:function(){He.reflow.call(this);var t=this.margin,e=Me(n(this.width-t.left-t.right,this.height-t.top-t.bottom,this._shape),2),r=e[0],o=e[1];this._shape.width=r,this._shape.height=o},setConfig:function(t){this._shape.setConfig(t),this._setPadding(t),this._setMargin(t),"opacity"in t&&(this.opacity=t.opacity),t.layout&&this._layout!==t.layout&&(this._layout=t.layout)},_getBoundingGroupRect:function(){var t=X(this._stack.getBoundingRectPoints()),e=this.padding,r=this.minWidth,o=this.definedWidth,i=t.width+e.left+e.right,a=t.height+e.top+e.bottom,s=r?Math.max(r,i):o||i,c=this.definedHeight||a;this._paddingWidth=s,this._paddingHeight=c;var u=Me(n(s,c,this._shape),2),l=u[0],f=u[1];this._shape.width=l,this._shape.height=f;var h=this.margin;this.width=l+h.left+h.right,this.height=f+h.top+h.bottom},render:function(t){t.save(),this._isMoving?t.globalAlpha=.6:1!==this.opacity&&(t.globalAlpha=this.opacity);var e=Me(this._getCenter(),2),n=e[0],r=e[1];this._shape.render(t),t.translate(n,r),this._stack.render(t),this._linkStack.render(t),t.translate(-n,-r),t.restore()},isHit:function(t,e){var n=this._calculatePointBack(t);return this._currentp=n,this._stack.checkHit(n,e)||!this.transparent&&this._shape.isHit(t)}}),r};function Ne(t){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ne(t)}function Xe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ye(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Ge(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ge(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ge(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function qe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ve(t,e){return Ve=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ve(t,e)}function Ue(t,e){if(e&&("object"===Ne(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function $e(t){return $e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},$e(t)}var Je=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ve(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$e(r);if(o){var n=$e(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Ue(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).type="Point",e.radius=t.radius||10,e._doCache(),e}return e=a,n=[{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n],e._rawConfigs[n]=t[n])})),this._doCache()}},{key:"_doCache",value:function(){this.width=2*this.radius,this.height=2*this.radius}},{key:"render",value:function(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath(),t.arc(this.anchor[0],this.anchor[1],this.radius,0,2*Math.PI),t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}},{key:"isHit",value:function(t){var e=this.anchor;return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)<this.radius*this.radius}},{key:"getBoundingRect",value:function(){var t=this.anchor,e=this.radius;return[t[0]-e,t[1]-e,t[0]+e,t[1]+e]}},{key:"calculateIntersection",value:function(t){var e=Ye(t,2),n=e[0],r=e[1],o=Ye(this.anchor,2),i=o[0],a=o[1],s=i-n,c=a-r,u=Math.sqrt(s*s+c*c),l=this.radius/u;return[i-l*s,a-l*c]}},{key:"getIntersectionsInFourDimension",value:function(){var t,e=Ye(this.anchor,2),n=e[0],r=e[1],o=this.radius;return Xe(t={},A.RIGHT,[n+o,r]),Xe(t,A.LEFT,[n-o,r]),Xe(t,A.BOTTOM,[n,r+o]),Xe(t,A.TOP,[n,r-o]),t}},{key:"calculateIntersectionInFourDimension",value:function(t,e){var n,r=Ye(t,2),o=r[0],i=r[1],a=Ye(this.anchor,2),s=a[0],c=a[1],u=this.radius,l=s-o,f=c-i,h=(Xe(n={},A.RIGHT,[s+u,c]),Xe(n,A.LEFT,[s-u,c]),Xe(n,A.BOTTOM,[s,c+u]),Xe(n,A.TOP,[s,c-u]),n),p=Math.abs(f)>Math.abs(l)?f<0?A.BOTTOM:A.TOP:l<0?A.RIGHT:A.LEFT;return{p:h[p],dir:p}}},{key:"getBoundingDimension",value:function(){return{width:this.width,height:this.height}}}],n&&qe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ot);const Ke=Je;function Ze(t){return Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ze(t)}function Qe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function tn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return en(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?en(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function en(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function nn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function on(t,e){return on=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},on(t,e)}function an(t,e){if(e&&("object"===Ze(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function sn(t){return sn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},sn(t)}var cn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&on(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=sn(r);if(o){var n=sn(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return an(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return nn(this,a),(t=i.call(this,e)).type="Rectangle",t.width=e.width||10,t.height=e.height||10,t.borderRadius=e.borderRadius||0,t._setBorder(e),t}return e=a,n=[{key:"_setBorder",value:function(t){var e,n,r,o,i,a,s,c,u,l,f,h,p,d,y,v,b,g,m,_,w,k,O,x;this.border={top:{color:(null===(e=t.border)||void 0===e||null===(n=e.top)||void 0===n?void 0:n.borderColor)||t.borderColor||"transparent",width:(null===(r=t.border)||void 0===r||null===(o=r.top)||void 0===o?void 0:o.borderWidth)||t.borderWidth||0,enable:null===(i=t.border)||void 0===i||null===(a=i.top)||void 0===a?void 0:a.borderWidth},right:{color:(null===(s=t.border)||void 0===s||null===(c=s.right)||void 0===c?void 0:c.borderColor)||t.borderColor||"transparent",width:(null===(u=t.border)||void 0===u||null===(l=u.right)||void 0===l?void 0:l.borderWidth)||t.borderWidth||0,enable:null===(f=t.border)||void 0===f||null===(h=f.right)||void 0===h?void 0:h.borderWidth},bottom:{color:(null===(p=t.border)||void 0===p||null===(d=p.bottom)||void 0===d?void 0:d.borderColor)||t.borderColor||"transparent",width:(null===(y=t.border)||void 0===y||null===(v=y.bottom)||void 0===v?void 0:v.borderWidth)||t.borderWidth||0,enable:null===(b=t.border)||void 0===b||null===(g=b.bottom)||void 0===g?void 0:g.borderWidth},left:{color:(null===(m=t.border)||void 0===m||null===(_=m.left)||void 0===_?void 0:_.borderColor)||t.borderColor||"transparent",width:(null===(w=t.border)||void 0===w||null===(k=w.left)||void 0===k?void 0:k.borderWidth)||t.borderWidth||0,enable:null===(O=t.border)||void 0===O||null===(x=O.left)||void 0===x?void 0:x.borderWidth}},this.borderColor=t.borderColor||"transparent",this.borderWidth=t.borderWidth||0}},{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n],e._rawConfigs[n]=t[n])})),this._setBorder(t)}},{key:"render",value:function(t){t.save(),this._isMoving&&(t.globalAlpha=.6);var e=this.borderRadius,n=(this.anchor,this.width),r=this.height,o=this.anchor[0]-this.width/2,i=this.anchor[1]-this.height/2,a=this.anchor[0]+this.width/2,s=this.anchor[1]+this.height/2;if(this.borderRadius?(t.beginPath(),t.moveTo(o+e,i),t.lineTo(o+n-e,i),t.quadraticCurveTo(o+n,i,o+n,i+e),t.lineTo(o+n,i+r-e),t.quadraticCurveTo(o+n,i+r,o+n-e,i+r),t.lineTo(o+e,i+r),t.quadraticCurveTo(o,i+r,o,i+r-e),t.lineTo(o,i+e),t.quadraticCurveTo(o,i,o+e,i),t.closePath()):(t.beginPath(),t.rect(this.anchor[0]-this.width/2,this.anchor[1]-this.height/2,this.width,this.height)),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor),this.shadowColor&&"transparent"!==this.shadowColor){t.shadowColor=this.shadowColor;var c=this._jflow.scale;t.shadowBlur=this.shadowBlur*c,t.shadowOffsetX=this.shadowOffsetX*c,t.shadowOffsetY=this.shadowOffsetY*c;var u=new Path2D;this.borderRadius?(u.moveTo(o+e,i),u.lineTo(o+n-e,i),u.quadraticCurveTo(o+n,i,o+n,i+e),u.lineTo(o+n,i+r-e),u.quadraticCurveTo(o+n,i+r,o+n-e,i+r),u.lineTo(o+e,i+r),u.quadraticCurveTo(o,i+r,o,i+r-e),u.lineTo(o,i+e),u.quadraticCurveTo(o,i,o+e,i),u.closePath()):u.rect(this.anchor[0]-this.width/2,this.anchor[1]-this.height/2,this.width,this.height),u.rect(o-10,i-10,this.width+20,this.height+20),t.save(),t.clip(u,"evenodd"),t.stroke(),t.restore()}if(t.fillStyle=this.backgroundColor,t.fill(),this.borderRadius&&this.borderWidth&&(t.shadowColor="transparent",t.stroke()),this.borderRadius){if(this.border.top.enable){var l=i-this.border.top.width/2;t.beginPath();var f=new Path2D;f.moveTo(o,l+e),f.quadraticCurveTo(o,l,o+e,l),f.lineTo(o+n-e,l),f.quadraticCurveTo(o+n,l,o+n,l+e),f.closePath(),t.clip(f),t.save(),t.shadowColor="transparent",t.fillStyle=this.border.top.color,t.rect(o,l,this.width,this.border.top.width),t.fill(),t.restore()}}else this.border.top.width&&(t.beginPath(),t.moveTo(o,i),t.lineTo(a,i),t.strokeStyle=this.border.top.color,t.lineWidth=this.border.top.width,t.stroke()),this.border.right.width&&(t.beginPath(),t.moveTo(a,i),t.lineTo(a,s),t.strokeStyle=this.border.right.color,t.lineWidth=this.border.right.width,t.stroke()),this.border.bottom.width&&(t.beginPath(),t.moveTo(a,s),t.lineTo(o,s),t.strokeStyle=this.border.bottom.color,t.lineWidth=this.border.bottom.width,t.stroke()),this.border.left.width&&(t.beginPath(),t.moveTo(o,s),t.lineTo(o,i),t.strokeStyle=this.border.left.color,t.lineWidth=this.border.left.width,t.stroke());t.restore()}},{key:"isHit",value:function(t){var e=this.anchor,n=this.width/2,r=this.height/2;return t[0]>e[0]-n&&t[0]<e[0]+n&&t[1]>e[1]-r&&t[1]<e[1]+r}},{key:"getBoundingRect",value:function(){var t=this.anchor,e=this.width/2,n=this.height/2;return[t[0]-e,t[1]-n,t[0]+e,t[1]+n]}},{key:"getBoundingDimension",value:function(){return{height:this.height,width:this.width}}},{key:"calculateIntersection",value:function(t){var e,n,r=tn(t,2),o=r[0],i=r[1],a=tn(this.anchor,2),s=a[0],c=a[1],u=this.width/2,l=this.height/2,f=s-o,h=c-i,p=l/u,d=Math.abs(h/f),y=o>s,v=i>c;return d<p?(e=s+(y?u:-u),n=u*(v?d:-d)+c):(n=c+(v?l:-l),e=l/(y?d:-d)+s),[e,n]}},{key:"getIntersectionsInFourDimension",value:function(){var t,e=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(e=this._belongs.calculateToCoordination(e));var n=tn(e,2),r=n[0],o=n[1],i=this.width/2,a=this.height/2;return Qe(t={},A.RIGHT,[r+i,o]),Qe(t,A.LEFT,[r-i,o]),Qe(t,A.BOTTOM,[r,o+a]),Qe(t,A.TOP,[r,o-a]),t}},{key:"calculateIntersectionInFourDimension",value:function(t,e){var n,r=tn(t,2),o=r[0],i=r[1],a=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(a=this._belongs.calculateToCoordination(a));var s=tn(a,2),c=s[0],u=s[1],l=this.width/2,f=this.height/2,h=(Qe(n={},A.RIGHT,[c+l,u]),Qe(n,A.LEFT,[c-l,u]),Qe(n,A.BOTTOM,[c,u+f]),Qe(n,A.TOP,[c,u-f]),n),p=c-o,d=u-i,y=f/l,v=o>c,b=Math.abs(d/p)>y?i>u?A.BOTTOM:A.TOP:v?A.RIGHT:A.LEFT;return{p:h[b],dir:b}}}],n&&rn(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ot);const un=cn;function ln(t){return ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ln(t)}function fn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function hn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return pn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pn(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function dn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vn(t,e){return vn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},vn(t,e)}function bn(t,e){if(e&&("object"===ln(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function gn(t){return gn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},gn(t)}var mn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vn(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=gn(r);if(o){var n=gn(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return bn(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return dn(this,a),(t=i.call(this,e)).type="Capsule",t.width=e.width||20,t.height=e.height||10,t}return e=a,n=[{key:"render",value:function(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();var e=hn(this.anchor,2),n=e[0],r=e[1],o=this.width/2,i=this.height/2,a=n-o+i,s=n+o-i,c=r-i,u=r+i;t.moveTo(a,c),t.lineTo(s,c),t.arc(s,r,i,-Math.PI/2,Math.PI/2),t.lineTo(a,u),t.arc(a,r,i,Math.PI/2,Math.PI/2*3),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}},{key:"isHit",value:function(t){var e=this.anchor,n=this.width/2,r=this.height/2,o=Math.abs(n-r),i=e[0]-n+r,a=e[0]+n-r,s=r*r;return t[0]>e[0]-o&&t[0]<e[0]+o&&t[1]>e[1]-r&&t[1]<e[1]+r||Math.pow(t[0]-i,2)+Math.pow(t[1]-e[1],2)<s||Math.pow(t[0]-a,2)+Math.pow(t[1]-e[1],2)<s}},{key:"getBoundingRect",value:function(){var t=this.anchor,e=this.width/2,n=this.height/2;return[t[0]-e,t[1]-n,t[0]+e,t[1]+n]}},{key:"getBoundingDimension",value:function(){return{height:this.height,width:this.width}}},{key:"getIntersectionsInFourDimension",value:function(){var t,e=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(e=this._belongs.calculateToCoordination(e));var n=hn(e,2),r=n[0],o=n[1],i=this.width/2,a=this.height/2;return fn(t={},A.RIGHT,[r+i,o]),fn(t,A.LEFT,[r-i,o]),fn(t,A.BOTTOM,[r,o+a]),fn(t,A.TOP,[r,o-a]),t}}],n&&yn(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ot);const _n=mn;function wn(t){return wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wn(t)}function kn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return On(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?On(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function On(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function xn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function jn(t,e){return jn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},jn(t,e)}function Tn(t,e){if(e&&("object"===wn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Pn(t){return Pn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Pn(t)}var En=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&jn(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Pn(r);if(o){var n=Pn(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Tn(this,t)});function a(){return xn(this,a),i.apply(this,arguments)}return e=a,n=[{key:"render",value:function(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();var e=kn(this.anchor,2),n=e[0],r=e[1],o=this.width/2,i=this.height/2,a=r-i+o,s=r+i-o,c=n-o,u=n+o;t.moveTo(c,a),t.arc(n,a,o,-Math.PI,0),t.lineTo(u,s),t.arc(n,s,o,0,Math.PI),t.closePath(),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}},{key:"isHit",value:function(t,e){var n=kn(this.anchor,2),r=n[0],o=n[1],i=this.width/2,a=this.height/2,s=Math.abs(a-i),c=o-a+i,u=o+a-i,l=i*i;return t[0]>r-i&&t[0]<r+i&&t[1]>o-s&&t[1]<o+s||Math.pow(t[0]-r,2)+Math.pow(t[1]-c,2)<l||Math.pow(t[0]-r,2)+Math.pow(t[1]-u,2)<l}}],n&&Sn(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(_n);const Rn=En;function Cn(t){return Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cn(t)}function In(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Bn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Mn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function An(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ln(t,e){return Ln=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ln(t,e)}function Dn(t,e){if(e&&("object"===Cn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Fn(t){return Fn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Fn(t)}var Hn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ln(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Fn(r);if(o){var n=Fn(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Dn(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Mn(this,a),(t=i.call(this,e)).type="Rhombus",t.height=e.diagonalsV||10,t.width=e.diagonalsH||20,t}return e=a,n=[{key:"render",value:function(t){t.save(),this._isMoving&&(t.globalAlpha=.6);var e=this.width/2,n=this.height/2,r=this.anchor;if(t.translate(r[0],r[1]),t.beginPath(),t.moveTo(0,-n),t.lineTo(e,0),t.lineTo(0,n),t.lineTo(-e,0),t.closePath(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor),this.shadowColor){t.shadowColor=this.shadowColor;var o=this._jflow.scale;t.shadowBlur=this.shadowBlur*o,t.shadowOffsetX=this.shadowOffsetX*o,t.shadowOffsetY=this.shadowOffsetY*o;var i=new Path2D;i.moveTo(0,-n),i.lineTo(e,0),i.lineTo(0,n),i.lineTo(-e,0),i.closePath(),i.rect(-e-10,-n-10,this.width+20,this.height+20),t.save(),t.clip(i,"evenodd"),t.stroke(),t.restore()}t.fillStyle=this.backgroundColor,t.fill(),this.borderWidth&&(t.shadowColor="transparent",t.stroke()),t.translate(-r[0],-r[1]),t.restore()}},{key:"isHit",value:function(t){var e=this.height/2,n=this.width/2,r=this.anchor;return Math.abs(t[0]-r[0])/n+Math.abs(t[1]-r[1])/e<=1}},{key:"getBoundingRect",value:function(){var t=this.anchor,e=this.width/2,n=this.height/2;return[t[0]-e,t[1]-n,t[0]+e,t[1]+n]}},{key:"getBoundingDimension",value:function(){return{height:this.height,width:this.width}}},{key:"getIntersectionsInFourDimension",value:function(){var t,e=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(e=this._belongs.calculateToCoordination(e));var n,r,o=(r=2,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(n,r)||function(t,e){if(t){if("string"==typeof t)return Bn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bn(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],a=o[1],s=this.width/2,c=this.height/2;return In(t={},A.RIGHT,[i+s,a]),In(t,A.LEFT,[i-s,a]),In(t,A.BOTTOM,[i,a+c]),In(t,A.TOP,[i,a-c]),In(t,A.SELF,[i+.618*s,a+.618*c]),t}}],n&&An(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ot);const zn=Hn;function Wn(t){return Wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wn(t)}function Nn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Xn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Yn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yn(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Gn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Vn(t,e){return Vn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Vn(t,e)}function Un(t,e){if(e&&("object"===Wn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function $n(t){return $n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},$n(t)}var Jn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vn(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$n(r);if(o){var n=$n(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Un(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Gn(this,a),(t=i.call(this,e)).type="Diamond",t.width=e.width||20,t.height=e.height||10,t.side=e.side||6,t._doCache(),t}return e=a,n=[{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n],e._rawConfigs[n]=t[n])})),this._doCache()}},{key:"_doCache",value:function(){this.sinSIDE=Math.sin(Math.PI/3)*this.side,this.cosSIDE=Math.cos(Math.PI/3)*this.side}},{key:"render",value:function(t){var e=Xn(this.anchor,2),n=e[0],r=e[1],o=this.width/2,i=this.height/2,a=i/1.732,s=n-o+a,c=n+o-a,u=n+o,l=n-o,f=r-i,h=r+i;this._cachePoints=[[c,f],[u,r],[c,h],[s,h],[l,r],[s,f]],t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();var p=this.side,d=this.sinSIDE,y=this.cosSIDE;t.moveTo(n,f),t.lineTo(c-p,f),t.quadraticCurveTo(c,f,c+y,f+d),t.lineTo(u-y,r-d),t.quadraticCurveTo(u,r,u-y,r+d),t.lineTo(c+y,h-d),t.quadraticCurveTo(c,h,c-p,h),t.lineTo(s+p,h),t.quadraticCurveTo(s,h,s-y,h-d),t.lineTo(l+y,r+d),t.quadraticCurveTo(l,r,l+y,r-d),t.lineTo(s-y,f+d),t.quadraticCurveTo(s,f,s+p,f),t.closePath(),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore()}},{key:"isHit",value:function(t){if(!this._cachePoints)return!1;for(var e=this._cachePoints,n=!1,r=0,o=e.length-1;r<e.length;r++)e[r][1]>t[1]!=e[o][1]>t[1]&&t[0]<(e[o][0]-e[r][0])*(t[1]-e[r][1])/(e[o][1]-e[r][1])+e[r][0]&&(n=!n),o=r;return n}},{key:"getBoundingRect",value:function(){var t=this.anchor,e=this.width/2,n=this.height/2;return[t[0]-e,t[1]-n,t[0]+e,t[1]+n]}},{key:"getBoundingDimension",value:function(){return{height:this.height,width:this.width}}},{key:"getIntersectionsInFourDimension",value:function(){var t,e=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(e=this._belongs.calculateToCoordination(e));var n=Xn(e,2),r=n[0],o=n[1],i=this.width/2,a=this.height/2;return Nn(t={},A.RIGHT,[r+i,o]),Nn(t,A.LEFT,[r-i,o]),Nn(t,A.BOTTOM,[r,o+a]),Nn(t,A.TOP,[r,o-a]),t}}],n&&qn(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ot);const Kn=Jn;function Zn(t){return Zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zn(t)}function Qn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function tr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function er(t,e){return er=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},er(t,e)}function nr(t,e){if(e&&("object"===Zn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function rr(t){return rr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},rr(t)}Math.sqrt(3);const or=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&er(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=rr(r);if(o){var n=rr(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return nr(this,t)});function a(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),i.call(this,t)}return e=a,(n=[{key:"render",value:function(t){t.save(),this._isMoving&&(t.globalAlpha=.6),t.beginPath();var e,n,r=(e=this.anchor,n=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return Qn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qn(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1],a=this.width/2,s=this.height/2,c=a/1.732,u=i-s,l=i+s,f=i-s+c,h=i+s-c,p=o-a,d=o+a;t.moveTo(o,u),t.lineTo(d,f),t.lineTo(d,h),t.lineTo(o,l),t.lineTo(p,h),t.lineTo(p,f),t.closePath(),t.fillStyle=this.backgroundColor,this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fill(),this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke()),t.restore(),this._cachePoints=[[o,u],[d,f],[d,h],[o,l],[p,h],[p,f]]}}])&&tr(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Kn);function ir(t){return ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ir(t)}function ar(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function sr(t){return function(t){if(Array.isArray(t))return lr(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||ur(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||ur(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ur(t,e){if(t){if("string"==typeof t)return lr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lr(t,e):void 0}}function lr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function fr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function hr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function pr(t,e,n){return e&&hr(t.prototype,e),n&&hr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function dr(){return dr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=yr(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},dr.apply(this,arguments)}function yr(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=wr(t)););return t}function vr(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&br(t,e)}function br(t,e){return br=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},br(t,e)}function gr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=wr(t);if(e){var o=wr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return mr(this,n)}}function mr(t,e){if(e&&("object"===ir(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _r(t)}function _r(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function wr(t){return wr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},wr(t)}var kr=Symbol("ishit"),Or=function(t){vr(n,t);var e=gr(n);function n(t){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fr(this,n),(r=e.call(this,t,o)).visible=!1,r}return pr(n,[{key:"render",value:function(t){this.visible&&dr(wr(n.prototype),"render",this).call(this,t)}},{key:"setHit",value:function(t){this[kr]!==t&&(this.isFocus=t,this.onHit()),this[kr]=t}}]),n}(ne),xr=function(t){vr(n,t);var e=gr(n);function n(t){var r,o;return fr(this,n),(o=e.call(this,t)).type="ScrollGroup",o.initStack(t),o.initLayout(t),o.initScrollBar(t),o._shape=new un(t),o._shape.anchor=[0,0],o._shape._belongs=_r(o),o.maxWidth=t.maxWidth||1/0,o.definedWidth=t.definedWidth,o.maxHeight=t.maxHeight||1/0,o.definedHeight=t.definedHeight,o.lock=null===(r=t.lock)||void 0===r||r,o._offset=[0,0],o._getBoundingGroupRect(),o.reflow(),o._getBoundingGroupRect(),o._resetOffset(),o}return pr(n,[{key:"initScrollBar",value:function(t){var e=this,n=t.barColor,r=t.barFocusColor,o=t.barMarginX,i=t.barMarginY,a=t.barWidth;this._scrollbarX=new Or("x",{plainColor:n,focusColor:r,barWidth:a}),this._scrollbarY=new Or("y",{plainColor:n,focusColor:r,barWidth:a}),this._scrollbarX.barMarginX=o||1,this._scrollbarY.barMarginY=i||1;var s=function(){e._jflow.scheduleRender()};this._scrollbarX.onHit=s,this._scrollbarY.onHit=s,this._scrollBarStatus={dragging:!1,target:null,barInitX:0,barInitY:0,barStartX:0,barStartY:0,hitScrollX:!1,hitScrollY:!1},this.addEventListener("instancePressStart",(function(t){if(e._scrollBarStatus.hitScrollX){t.detail.preventDefault(),t.detail.bubbles=!1;var n=t.detail.event.clientX;Object.assign(e._scrollBarStatus,{dragging:!0,target:e._scrollbarX,barStartX:e._scrollbarX.anchor[0],barInitX:n}),e.onScrollbarPressStart()}if(e._scrollBarStatus.hitScrollY){t.detail.preventDefault(),t.detail.bubbles=!1;var r=t.detail.event.clientY;Object.assign(e._scrollBarStatus,{dragging:!0,target:e._scrollbarY,barStartY:e._scrollbarY.anchor[1],barInitY:r}),e.onScrollbarPressStart()}}))}},{key:"onScrollbarPressStart",value:function(){var t=this,e=this._jflow.canvas,n=function(e){var n=e.clientX,r=e.clientY;t.onDraggingScrollbar(n,r)}.bind(this);document.addEventListener("pointermove",n);var r=function(o){Object.assign(t._scrollBarStatus,{dragging:!1,target:null,barInitX:0,barInitY:0,barStartX:0,barStartY:0,hitScrollX:!1,hitScrollY:!1}),document.removeEventListener("pointermove",n),document.removeEventListener("pointerup",r),e.removeEventListener("pointerup",r)}.bind(this);e.addEventListener("pointerup",r,{once:!0}),document.addEventListener("pointerup",r,{once:!0})}},{key:"onDraggingScrollbar",value:function(t,e){if(this._scrollbarX.visible&&this._scrollBarStatus.dragging){var n=this._jflow,r=n.scale,o=this._scrollBarStatus,i=o.target,a=o.barInitX,s=o.barStartX,c=o.barInitY,u=o.barStartY;if("x"===i.dir){var l=this._scrollbarX.width,f=this._outerWidth,h=s+(t-a)/r,p=(i.anchor[0]=Math.max(Math.min(h,f-l),0))/(f-l),d=(this._innerWidth-f)/2;this._offset[0]=d-(this._innerWidth-f)*p,n.scheduleRender()}if("y"===i.dir){var y=this._scrollbarY.height,v=this._outerHeight,b=u+(e-c)/r,g=(i.anchor[1]=Math.max(Math.min(b,v-y),0))/(v-y),m=(this._innerHeight-v)/2;this._offset[1]=m-(this._innerHeight-v)*g,n.scheduleRender()}}}},{key:"setConfig",value:function(t){this._shape.setConfig(t)}},{key:"_getBoundingGroupRect",value:function(){var t=X(this._stack.getBoundingRectPoints()),e=t.width,n=t.height,r=this.definedWidth||Math.min(e,this.maxWidth),o=this.definedHeight||Math.min(n,this.maxHeight);this._innerWidth=e,this._outerWidth=r,this._innerHeight=n,this._outerHeight=o,this._shape.width=r,this._shape.height=o,this.width=r,this.height=o}},{key:"_calculatePointBack",value:function(t){var e=cr(t,2),n=e[0],r=e[1],o=cr(this._offset,2),i=o[0],a=o[1],s=cr(this.anchor,2);return[n-s[0]-i,r-s[1]-a]}},{key:"calculateToCoordination",value:function(t){var e=cr(t,2),n=e[0],r=e[1],o=cr(this.anchor,2),i=o[0],a=o[1],s=cr(this._offset,2),c=[n+i-s[0],r+a-s[1]];return this._belongs&&this._belongs.calculateToCoordination?this._belongs.calculateToCoordination(c):c}},{key:"calculateToRealWorld",value:function(t){var e=cr(t,2),n=e[0],r=e[1],o=cr(this.anchor,2),i=o[0],a=o[1],s=cr(this._offset,2),c=[n+i-s[0],r+a-s[1]];if(this._belongs&&this._belongs.calculateToRealWorld)return this._belongs.calculateToRealWorld(c)}},{key:"_getViewBox",value:function(){var t=[].concat(sr(this._calculatePointBack([0,0])),sr(this._calculatePointBack([this.width,this.height])));return this._cacheViewBox=t,t}},{key:"_resetOffset",value:function(){this._offset=[Math.max((this._innerWidth-this._outerWidth)/2,0),Math.max((this._innerHeight-this._outerHeight)/2,0)],this._innerWidth>this._outerWidth?(this._scrollbarX.visible=!0,this._scrollbarX.width=this._outerWidth*this._outerWidth/this._innerWidth,this._scrollbarX.anchor=[0,this._outerHeight-4]):this._scrollbarX.visible=!1,this._innerHeight>this._outerHeight?(this._scrollbarY.visible=!0,this._scrollbarY.height=this._outerHeight*this._outerHeight/this._innerHeight,this._scrollbarY.anchor=[this._outerWidth-4,0]):this._scrollbarY.visible=!1}},{key:"render",value:function(t){this._isMoving?t.globalAlpha=.6:1!==this.opacity&&(t.globalAlpha=this.opacity);var e=cr(this.anchor,2),n=e[0],r=e[1],o=this.width,i=this.height,a=o/2,s=i/2,c=cr(this._offset,2),u=c[0],l=c[1];t.translate(n,r),this._shape.render(t),t.translate(-a,-s),this._scrollbarX.visible&&this._scrollbarX.render(t),this._scrollbarY.visible&&this._scrollbarY.render(t),t.translate(a,s),t.save(),t.beginPath(),t.rect(-a,-s,o,i),t.clip(),t.translate(u,l),this._stack.render(t),this._linkStack.render(t),t.translate(-n-u,-r-l),t.restore()}},{key:"isHit",value:function(t,e){var n=cr(t,2),r=n[0],o=n[1],i=cr(this.anchor,2),a=i[0],s=i[1],c=[r-a+this.width/2,o-s+this.height/2];if(this._scrollBarStatus.hitScrollX=!1,this._scrollBarStatus.hitScrollY=!1,this._scrollbarX.visible&&this._scrollbarX.isHit(c))return this._scrollBarStatus.hitScrollX=!0,this._scrollbarX.setHit(!0),!0;if(this._scrollbarX.setHit(!1),this._scrollbarY.visible&&this._scrollbarY.isHit(c))return this._scrollBarStatus.hitScrollY=!0,this._scrollbarY.setHit(!0),!0;if(this._scrollbarY.setHit(!1),this._shape.isHit([r-a,o-s])){var u=cr(this._offset,2),l=[r-a-u[0],o-s-u[1]];this._currentp=l;var f=this._stack.checkHit(l,e);if(f)return f}else this._stack.resetHitStatus();return!1}},{key:"getBoundingDimension",value:function(){return{width:this.width,height:this.height}}},{key:"getBoundingRect",value:function(){var t=this.anchor,e=this.width/2,n=this.height/2;return[t[0]-e,t[1]-n,t[0]+e,t[1]+n]}},{key:"getIntersectionsInFourDimension",value:function(){var t,e=this.anchor;this._belongs&&this._belongs.calculateToCoordination&&(e=this._belongs.calculateToCoordination(e));var n=cr(e,2),r=n[0],o=n[1],i=this.width/2,a=this.height/2;return ar(t={},A.RIGHT,[r+i,o]),ar(t,A.LEFT,[r-i,o]),ar(t,A.BOTTOM,[r,o+a]),ar(t,A.TOP,[r,o-a]),ar(t,A.SELF,[r+.618*i,o+.618*a]),t}},{key:"onEnterViewbox",value:function(){this.interateNodeStack((function(t){t.onEnterViewbox()}))}},{key:"onLeaveViewbox",value:function(){this.interateNodeStack((function(t){t.onLeaveViewbox()}))}},{key:"destroy",value:function(){this._shape.destroy(),this.interateNodeStack((function(t){t.destroy()}))}},{key:"clone",value:function(){var t=new(0,this.constructor)(Object.assign({},this._rawConfigs,{layout:this._layout&&this._layout.clone()}));return this.interateNodeStack((function(e){t.addToStack(e.clone())})),t.recalculate(),t.visible=this.visible,t}}]),n}(Ot);Object.assign(xr.prototype,qt),Object.assign(xr.prototype,Vt),Object.assign(xr.prototype,{recalculateUp:function(){var t=!0;if(this.getBoundingDimension){var e=this._innerWidth,n=this._innerHeight;this.resetChildrenPosition&&this.resetChildrenPosition(),this._getBoundingGroupRect&&this._getBoundingGroupRect(),this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect();var r=this._innerWidth,o=this._innerHeight;t=e!==r||n!==o}else this.reflow();this._belongs&&t&&(this._resetOffset(),this._belongs.recalculateUp())},recalculate:function(){var t=this.getBoundingDimension(),e=t.width,n=t.height;this.reflow(),this._getBoundingGroupRect&&this._getBoundingGroupRect();var r=this.getBoundingDimension(),o=r.width,i=r.height;e===o&&n===i||this._resetOffset()}});const Sr=xr,jr={canvas:{wheel:function(t,e){t.preventDefault();var n=t.offsetX,r=t.offsetY,o=t.deltaX,i=t.deltaY;t.ctrlKey&&(i=-i),e.zoomHandler(n,r,o,i,t)}}};function Tr(t){return Tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tr(t)}function Pr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Er(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Rr(t,e){return Rr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Rr(t,e)}function Cr(t,e){if(e&&("object"===Tr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ir(t){return Ir=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ir(t)}var Br=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Rr(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ir(r);if(o){var n=Ir(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Cr(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Pr(this,a),(t=i.call(this)).from=e.from,t.to=e.to,t.fromDir=e.fromDir,t.toDir=e.toDir,t._cachePoints=null,t.backgroundColor=e.backgroundColor||"#000",t.isSelf=!!e.isSelf,t}return e=a,(n=[{key:"isInViewBox",value:function(t){return!0}},{key:"bringToTop",value:function(){var t=this,e=this._jflow._linkStack,n=e.findIndex((function(e){return e===t}));e.splice(n,1),e.push(this),this._jflow._render()}}])&&Er(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(yt);const Mr=Br;function Ar(t){return Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ar(t)}function Lr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Dr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Fr(t,e){return Fr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Fr(t,e)}function Hr(t,e){if(e&&("object"===Ar(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function zr(t){return zr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},zr(t)}const Wr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fr(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=zr(r);if(o){var n=zr(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Hr(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).width=t.width,e.height=t.height,e.imageBuffer=document.createElement("canvas"),e.imageBuffer.width=e.width+2,e.imageBuffer.height=e.height+2,t.cache(e.imageBuffer.getContext("2d")),e}return e=a,(n=[{key:"render",value:function(t){var e,n,r=(e=this.anchor,n=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return Lr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Lr(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];t.save(),t.translate(o,i),t.beginPath(),t.drawImage(this.imageBuffer,-this.width/2,-this.height/2),t.translate(-o,-i),t.restore()}},{key:"getBoundingDimension",value:function(){return{height:this.height,width:this.width}}},{key:"recalculate",value:function(){}},{key:"getBoundingRect",value:function(){var t=this.anchor,e=this.width/2,n=this.height/2;return[t[0]-e,t[1]-n,t[0]+e,t[1]+n]}}])&&Dr(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ot);function Nr(t){return Nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nr(t)}function Xr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Yr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yr(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Gr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function qr(t,e){return qr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},qr(t,e)}function Vr(t,e){if(e&&("object"===Nr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ur(t){return Ur=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ur(t)}var $r="left",Jr="right",Kr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qr(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ur(r);if(o){var n=Ur(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Vr(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).type="Text",e.content=t.content||"",e.fontFamily=t.fontFamily||"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",e.fontSize=t.fontSize||"14px",e.fontWeight=t.fontWeight||"",e.textColor=t.textColor||"white",e.placeholderColor=t.placeholderColor||t.textColor||"white",e.textAlign=t.textAlign||"center",e.textBaseline=t.textBaseline||"middle",e.lineHeight=t.lineHeight,e.indent=t.indent||0,e.backgroundColor=t.backgroundColor,e.editable=t.editable,e.definedWidth=t.definedWidth,e.minWidth=t.minWidth||0,e.maxWidth=t.maxWidth,e.ellipsis=t.ellipsis,e.placeholder=t.placeholder||"",e.emptyWhenInput=t.emptyWhenInput||!1,e.editting=!1,e.disabled=t.disabled,e.cursorColor=t.cursorColor||"#60CFC4",e.textRangeColor=t.textRangeColor||"#4E75EC1A",e._status={editing:!1,cursorshow:!0,cursoranime:null,lastElapsed:0,refreshElapsed:!1,cursorDragging:!1,shiftOn:!1,oldVal:"",inputElement:null},e._cursorOffset=0,e._textRange={enable:!1,rangefrom:null,rangeTo:null,initialRange:null},e.editable&&e._makeFunctional(),e.preCalculateText(),e.shadowCache(),e}return e=a,n=[{key:"currentContent",get:function(){return this.content||this.placeholder}},{key:"isEmpty",get:function(){return!this.content}},{key:"preCalculateText",value:function(){var t=this;c((function(e){e.beginPath(),e.font="".concat(t.fontSize," ").concat(t.fontFamily),e.textAlign=t.textAlign,e.textBaseline=t.textBaseline;var n=parseInt(t.fontSize),r=t.currentContent,o=e.measureText(r),i=o.fontBoundingBoxAscent,a=o.fontBoundingBoxDescent,s=o.width;if(t._textWidth=t.indent+s,t.definedWidth){if(t.ellipsis&&t._textWidth>t.definedWidth){var c=t._calculateOffset(t.definedWidth-12);t.ellipsisContent=r.substring(0,c)+"..."}else t.ellipsisContent=r;t.width=t.definedWidth}else if(t.maxWidth&&t.ellipsis){if(t._textWidth>t.maxWidth){var u=t.maxWidth/t._textWidth,l=Math.floor(r.length*u-3);t.ellipsisContent=r.substring(0,l)+"..."}else t.ellipsisContent=r;t.width=Math.min(t.maxWidth,t._textWidth)}else t.width=Math.max(t.minWidth,t._textWidth);var f=Math.abs(i)+Math.abs(a)||n;t._textHeight=f,t.lineHeight?t.height=t.lineHeight:t.height=f}))}},{key:"shadowCache",value:function(){var t=this,e=window.devicePixelRatio,n=this.width*e,r=this.height*e,o=this.indent*e,i=parseInt(this.fontSize)*e;this._shadowCache=new Wr({width:n,height:r,cache:function(e){e.translate(n/2,r/2);var a="".concat(t.fontWeight," ").concat(i,"px ").concat(t.fontFamily);e.font=a,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,e.fillStyle=t.isEmpty?t.placeholderColor:t.textColor;var s=t.currentContent;if(t.ellipsisContent&&(s=t.ellipsisContent),s)if(t.textAlign===$r){var c=n/2;e.fillText(s,o/2-c,0)}else if(t.textAlign===Jr){var u=n/2;e.fillText(s,u,0)}else e.fillText(s,o/2,0)}})}},{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n],e._rawConfigs[n]=t[n])})),this.preCalculateText(),this.shadowCache()}},{key:"click",value:function(){var t=this;if(!this._status.editing){var e=!0;if(this.dispatchEvent(new ge("edit",{target:this,preventDefault:function(){e=!1}})),!e)return;var n=this._belongs._currentp,r=this._jflow;this._cursorOffset=n?this._positionToCursorOffset(n):0;var o=function(t,e){var n=document.createElement("input");n.setAttribute("style","\n        width: 100px;\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        opacity: 0;\n        z-index: -1;\n        contain: strict;"),n.setAttribute("tabindex",-1),n.setAttribute("aria-hidden",!0),n.setAttribute("spellcheck",!1),n.setAttribute("autocorrect","off");var r=!1,o={ctrlOn:!1};return n.addEventListener("beforeinput",(function(e){e.preventDefault(),e.data&&(r||t("Input",e.data))})),n.addEventListener("compositionstart",(function(e){t("compositionstart"),r=!0})),n.addEventListener("compositionupdate",(function(e){t("compositionupdate",e.data)})),n.addEventListener("compositionend",(function(e){t("compositionend",e.data),n.value="",r=!1})),n.addEventListener("keyup",(function(e){switch(e.key){case"Shift":t("Shift",!1);break;case"Meta":case"Control":o.ctrlOn=!1}})),n.addEventListener("keydown",(function(e){switch(e.code){case"Enter":t("Enter");break;case"Backspace":t("Backspace");break;case"ArrowLeft":t("ArrowLeft");break;case"ArrowRight":t("ArrowRight");break;case"ArrowDown":t("ArrowDown");break;case"ArrowUp":t("ArrowUp")}switch(e.key){case"Shift":t("Shift",!0);break;case"Meta":case"Control":o.ctrlOn=!0;break;case"a":o.ctrlOn&&t("CtrlA")}})),n.addEventListener("keyup",(function(t){e("KeyUp",t)})),n.addEventListener("keydown",(function(t){e("KeyDown",t)})),n.addEventListener("copy",(function(e){e.preventDefault(),e.stopPropagation(),t("COPY",null,e)})),n.addEventListener("cut",(function(e){e.preventDefault(),e.stopPropagation(),t("CUT",null,e)})),n.addEventListener("paste",(function(e){e.preventDefault(),e.stopPropagation(),t("PASTE",null,e)})),n}(this._controlCallback.bind(this),this._defaultCallback.bind(this));r.DOMwrapper.append(o),o.focus({preventScroll:!0}),r.setFocusInstance(this),Object.assign(this._status,{editing:!0,oldVal:this.content,inputElement:o,cursoranime:r.requestJFlowAnime((function(e){var n=t._status.lastElapsed;t._status.refreshElapsed&&(t._status.lastElapsed=e,t._status.refreshElapsed=!1),e-n>500&&(t._status.cursorshow=!t._status.cursorshow,t._status.lastElapsed=e)}))}),this.emptyWhenInput&&(this.content=""),this.syncShadowInputPosition()}}},{key:"_makeFunctional",value:function(){var t=this;this.addEventListener("dblclick",(function(e){e.currentTarget===t&&t._status.editing&&t._selectFullRange()})),this.addEventListener("click",(function(e){if(e.currentTarget===t){if(t._status.editing){var n=t._belongs._currentp,r=t._positionToCursorOffset(n);if(t._status.shiftOn){var o=t._textRange.initialRange;Object.assign(t._textRange,{rangefrom:Math.min(r,o),rangeTo:Math.max(r,o),enable:!0}),t._cursorOffset=t._textRange.rangeTo,t._status.inputElement.focus({preventScroll:!0})}else t._cursorOffset=r,t._status.inputElement.focus({preventScroll:!0}),t._refreshCursor(),t.syncShadowInputPosition()}t.click()}})),this.addEventListener("blur",(function(e){t._status.editing=!1,t._status.inputElement&&t._status.inputElement.remove(),t._belongs&&t._jflow.scheduleRender(),t.dispatchEvent(new ge("change",{target:t,oldVal:t._status.oldVal,val:t.content})),t._textRange.enable=!1,t._status.cursoranime.cancel(),Object.assign(t._status,{editing:!1,cursorshow:!0,cursoranime:null,lastElapsed:0,refreshElapsed:!1,cursorDragging:!1,shiftOn:!1,oldVal:"",inputElement:null})})),this.addEventListener("instancePressStart",(function(e){if(t._status.editing&&!t._status.shiftOn){e.detail.bubbles=!1,e.detail.preventDefault();var n=t._belongs._currentp,r=t._positionToCursorOffset(n);t._textRange.initialRange=r;var o=e.detail.jflow,i=!1,a=function(e){i=!0;var n=e.offsetX,r=e.offsetY,a=o._calculatePointBack([n,r]);o._stack.checkHit(a);var s=t._belongs._currentp,c=t._positionToCursorOffset(s),u=t._textRange.initialRange;t._status.editing=!1,Object.assign(t._textRange,{rangefrom:Math.min(c,u),rangeTo:Math.max(c,u),enable:!0})}.bind(t);document.addEventListener("pointermove",a),document.addEventListener("pointerup",(function(e){if(document.removeEventListener("pointermove",a),i){var n=t._textRange.rangeTo;t._cursorOffset=n,t._status.editing=!0,t._status.inputElement.focus({preventScroll:!0}),t._textRange.initialRange=null}else t._textRange.initialRange=null}),{once:!0})}}))}},{key:"_positionToCursorOffset",value:function(t){var e=Xr(t,1)[0],n=this.width/2,r=e-(Xr(this.anchor,1)[0]-n);return r>=this._textWidth?this.content.length:this._calculateOffset(r)}},{key:"_calculateOffset",value:function(t){var e=this,n=this.content,r=n.length-1,o=this._textWidth;if(0===o)return 0;var i=o,a=Math.floor(t/i*r);return c((function(o){var s,c,u;o.font="".concat(e.fontSize," ").concat(e.fontFamily);var l=n.substring(0,a),f=n.substring(a-1,a),h=n.substring(a,a+1),p=o.measureText(l).width,d=o.measureText(f).width,y=o.measureText(h).width;s=p-d/2,c=p+y/2;do{if(s<=t&&c>=t)break;if(s>t){var v=c-t;u=a,a-=v<100?1:Math.floor(v/c*u),l=n.substring(a,u),p-=o.measureText(l).width}else if(c<t){var b=t-s;u=a,a+=b<100?1:Math.floor(b/(i-s)*(r-u)),l=n.substring(u,a),p+=o.measureText(l).width}f=n.substring(a-1,a),h=n.substring(a,a+1),s=p-(d=o.measureText(f).width)/2,c=p+(y=o.measureText(h).width)/2}while(a>=0&&a<=r)})),a}},{key:"_refreshCursor",value:function(){this._status.editing&&Object.assign(this._status,{cursorshow:!0,refreshElapsed:!0}),this._textRange.enable&&(this._textRange.enable=!1)}},{key:"render",value:function(t){if(this._isMoving&&(t.globalAlpha=.6),!t.disableCache&&!this._status.editing&&this._jflow.scale*parseInt(this.fontSize)<8){var e=Xr(this.anchor,2),n=e[0],r=e[1];return t.save(),t.translate(n,r),t.beginPath(),t.drawImage(this._shadowCache.imageBuffer,-this.width/2,-this.height/2,this.width,this.height),t.translate(-n,-r),void t.restore()}var o="".concat(this.fontWeight," ").concat(this.fontSize," ").concat(this.fontFamily);t.font!==o&&(t.font=o),t.textAlign!==this.textAlign&&(t.textAlign=this.textAlign),t.textBaseline!==this.textBaseline&&(t.textBaseline=this.textBaseline),t.fillStyle=this.isEmpty?this.placeholderColor:this.textColor;var i=this.currentContent;if(this.ellipsisContent&&(i=this.ellipsisContent),i)if(this.textAlign===$r){var a=this.width/2;t.fillText(i,this.anchor[0]-a+this.indent/2,this.anchor[1])}else if(this.textAlign===Jr){var s=this.width/2;t.fillText(i,this.anchor[0]+s,this.anchor[1])}else t.fillText(i,this.anchor[0]+this.indent/2,this.anchor[1]);var c=this.width/2,u=this._textHeight,l=Xr(this.anchor,2),f=l[0],h=l[1],p=f-c,d=h-u/2;if(this._status.cursorshow&&this._status.editing){var y=this._cursorOffset,v=this.content.substring(0,y),b=p+t.measureText(v).width,g=this._textHeight/2;t.beginPath(),t.moveTo(b,h-g),t.lineTo(b,h+g),t.lineWidth=2,t.strokeStyle=this.cursorColor,t.stroke()}if(this._textRange.enable){var m=this._textRange,_=m.rangefrom,w=m.rangeTo,k=this.content.substring(0,_),O=this.content.substring(_,w),x=p+t.measureText(k).width,S=t.measureText(O).width;t.beginPath(),t.rect(x,d,S,u),t.fillStyle=this.textRangeColor,t.fill()}}},{key:"_inputControl",value:function(t,e){if(this._textRange.enable&&(this._clearTextRange(),"Backspace"===t))return this.dispatchEvent(new ge("input",{target:this,oldVal:this._status.oldVal,val:this.content})),this.refresh(),void this.syncShadowInputPosition();var n,r=this._cursorOffset,o=this.content,i=o.substring(0,r);n=this.cacheIdx?o.substring(this.cacheIdx[1]):o.substring(r);var a=!1;switch(t){case"Input":i+=e,this._cursorOffset+=e.length,this.content=i+n;break;case"compositionstart":this.cacheIdx=[i.length,i.length];break;case"compositionupdate":i=i.substring(0,this.cacheIdx[0]),i+=e,this.content=i+n,this._cursorOffset=this.cacheIdx[0]+e.length,this.cacheIdx[1]=this.cacheIdx[0]+e.length;break;case"compositionend":i=i.substring(0,this.cacheIdx[0]),this._cursorOffset=this.cacheIdx[0]+e.length,this.cacheIdx=null,i+=e,this.content=i+n;break;case"Enter":if(this.cacheIdx)return;var s=!0;this.dispatchEvent(new ge("enterkeypressed",{target:this,handler:function(t){s=t},stopInput:function(){a=!0}})),s&&this._jflow.blur();break;case"Backspace":i=i.substring(0,i.length-1),this._cursorOffset=Math.max(0,this._cursorOffset-1),this.content=i+n}a||this.dispatchEvent(new ge("input",{target:this,oldVal:this._status.oldVal,val:this.content})),this.refresh(),this.syncShadowInputPosition()}},{key:"refresh",value:function(){this.preCalculateText(),this._belongs.recalculateUp(),this._jflow.scheduleRender()}},{key:"syncShadowInputPosition",value:function(){var t=this;if(this._status.editing){var e=this.width/2,n=this.height/2,r=this.anchor[0]-e,o=this._cursorOffset;c((function(e){e.beginPath(),e.font="".concat(t.fontSize," ").concat(t.fontFamily);var n=t.content.substring(0,o);r+=e.measureText(n).width}));var i=this.calculateToRealWorld([r,n]),a=this._jflow.canvasMeta,s=Math.min(a.actual_width-120,i[0]);this._status.inputElement.style.transform="translate(".concat(s,"px, ").concat(i[1],"px)")}}},{key:"_controlCallback",value:function(t,e,n){switch(this._status.editing&&Object.assign(this._status,{cursorshow:!0,refreshElapsed:!0}),t){case"Input":case"compositionstart":case"compositionupdate":case"compositionend":case"Enter":case"Backspace":this._inputControl(t,e);break;case"ArrowLeft":this._textRange.enable&&(this._textRange.enable=!1),this._onArrowLeft();break;case"ArrowRight":this._textRange.enable&&(this._textRange.enable=!1),this._onArrowRight();break;case"Shift":this._onShiftToggle(e);break;case"CtrlA":this._selectFullRange();break;case"COPY":this._copy(n);break;case"CUT":this._cut(n);break;case"PASTE":this._paste(n)}}},{key:"_onArrowLeft",value:function(){this._cursorOffset=Math.max(0,this._cursorOffset-1),this._jflow.scheduleRender(),this.syncShadowInputPosition()}},{key:"_onArrowRight",value:function(){this._cursorOffset=Math.min(this.content.length,this._cursorOffset+1),this._jflow.scheduleRender(),this.syncShadowInputPosition()}},{key:"_onShiftToggle",value:function(t){this._status.shiftOn=t,this._textRange.initialRange=t?this._cursorOffset:null}},{key:"_selectFullRange",value:function(){this._textRange={enable:!0,rangefrom:0,rangeTo:this.content.length},this._cursorOffset=this.content.length}},{key:"_clearTextRange",value:function(){if(this._textRange.enable){var t=this._textRange,e=t.rangefrom,n=t.rangeTo,r=this.content,o=r.substring(0,e),i=r.substring(n);this.content=o+i,this._cursorOffset=o.length,this._textRange.enable=!1}}},{key:"_getSelection",value:function(){if(this._textRange.enable){var t=this._textRange,e=t.rangefrom,n=t.rangeTo;return this.content.substring(e,n)}return null}},{key:"_copy",value:function(t){var e=this._getSelection();e&&t.clipboardData.setData("text/plain",e)}},{key:"_cut",value:function(t){var e=this._getSelection();e&&(t.clipboardData.setData("text/plain",e),this._clearTextRange(),this.refresh())}},{key:"_paste",value:function(t){var e=(t.clipboardData||window.clipboardData).getData("text"),n=!1;if(this.dispatchEvent(new ge("paste",{target:this,content:e,preventDefault:function(){n=!0},resolvePasteContent:function(t){e=t(e)}})),!n){this._clearTextRange();var r=this._cursorOffset,o=this.content,i=o.substring(0,r),a=o.substring(r);this.content=i+e+a,this._cursorOffset=(i+e).length,this.refresh()}}},{key:"_defaultCallback",value:function(t,e){switch(t){case"KeyDown":this.dispatchEvent(new ge("keydown",{target:this,key:e.key,code:e.code,rawEvent:e}));break;case"KeyUp":this.dispatchEvent(new ge("keyup",{target:this,key:e.key,code:e.code,rawEvent:e}))}}},{key:"destroy",value:function(){this._jflow._focus.instance===this&&this._jflow.blur()}}],n&&Gr(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(un);const Zr=Kr;function Qr(t){return Qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qr(t)}function to(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function eo(t,e){return eo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},eo(t,e)}function no(t,e){if(e&&("object"===Qr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ro(t){return ro=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ro(t)}const oo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&eo(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ro(r);if(o){var n=ro(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return no(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).image=t.image,e.image.onload=function(){e._jflow._render()},e.imageBounding={width:t.imageWidth||t.width,height:t.imageHeight||t.height},e}return e=a,(n=[{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&null!==t[n]&&(e[n]=t[n],e._rawConfigs[n]=t[n])})),t.image&&!t.image.complete&&(this.image.onload=function(){e._jflow._render()}),this.imageBounding={width:t.imageWidth||t.width||this.imageBounding.width,height:t.imageHeight||t.height||this.imageBounding.height}}},{key:"render",value:function(t){t.save(),this._isMoving&&(t.globalAlpha=.6),un.prototype.render.call(this,t);var e=this.anchor[0]-this.width/2,n=this.anchor[1]-this.height/2;this.opacity<1&&(t.globalAlpha=this.opacity),this.image.complete&&t.drawImage(this.image,e,n,this.imageBounding.width,this.imageBounding.height),t.restore()}}])&&to(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(un);function io(t){return io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},io(t)}function ao(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function so(){return so="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=co(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},so.apply(this,arguments)}function co(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=fo(t)););return t}function uo(t,e){return uo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},uo(t,e)}function lo(t,e){if(e&&("object"===io(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function fo(t){return fo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},fo(t)}var ho=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&uo(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=fo(r);if(o){var n=fo(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return lo(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).domFactory=t.createDocument,e._dom=null,e}return e=a,n=[{key:"getRealWorldPosition",value:function(){var t=this.getBoundingRect();return this.calculateToRealWorld(t.slice(0,2))}},{key:"render",value:function(t){var e=this;if(!this._dom&&this.domFactory)requestAnimationFrame((function(){if(!e._dom){var t=document.createElement("div"),n=e.getRealWorldPosition(),r=e._jflow.scale;t.setAttribute("style","\n                        position: absolute;\n                        width: ".concat(e.width,"px;\n                        height: ").concat(e.height,"px;\n                        transform-origin: left top;\n                        top: 0;\n                        left: 0;\n                        transform: translate(").concat(n[0],"px, ").concat(n[1],"px) scale(").concat(r,");")),e._dom=t,e._jflow.DOMwrapper.appendChild(t),e.domFactory(t)}}));else{var n=this.getRealWorldPosition(),r=this._jflow.scale;this._dom.style.transform="translate(".concat(n[0],"px, ").concat(n[1],"px) scale(").concat(r,")")}so(fo(a.prototype),"render",this).call(this,t)}},{key:"onEnterViewbox",value:function(){this._dom&&(this._dom.style.display="block")}},{key:"onLeaveViewbox",value:function(){this._dom&&(this._dom.style.display="none")}},{key:"destroy",value:function(){this._dom&&this._jflow.DOMwrapper.removeChild(this._dom),so(fo(a.prototype),"destroy",this).call(this)}}],n&&ao(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(un);const po=ho;function yo(t){return yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yo(t)}function vo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return bo(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bo(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function go(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mo(t,e){return mo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},mo(t,e)}function _o(t,e){if(e&&("object"===yo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function wo(t){return wo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},wo(t)}var ko=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mo(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=wo(r);if(o){var n=wo(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return _o(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).fontFamily=t.fontFamily="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",e.fontSize=t.fontSize||"12px",e.content=t.content||"",e.lineDash=t.lineDash,e.approximate=t.approximate||6,e}return e=a,n=[{key:"_calculateAnchorPoints",value:function(){var t=this.from.calculateIntersection(this.to.getCenter()),e=this.to.calculateIntersection(this.from.getCenter());this._cachePoints=[t,e];var n=e[0]-t[0],r=e[1]-t[1],o=Math.atan2(r,n);this._cacheAngle=o}},{key:"isInViewBox",value:function(t){return this._calculateAnchorPoints(),!0}},{key:"render",value:function(t){var e=vo(this._cachePoints,2),n=e[0],r=e[1],o=this._cacheAngle,i=r[0]-n[0],a=r[1]-n[1];if(t.fillStyle=t.strokeStyle=this.backgroundColor,t.beginPath(),this.content){t.textAlign="center",t.font="".concat(this.fontSize," ").concat(this.fontFamily),t.textBaseline="middle";var s=t.measureText(this.content),c=s.actualBoundingBoxLeft,u=s.actualBoundingBoxRight,l=s.fontBoundingBoxAscent,f=s.fontBoundingBoxDescent,h=i/2+n[0],p=a/2+n[1];t.fillText(this.content,h,p);var d=Math.abs(c)+Math.abs(u)+20,y=1.5*(Math.abs(l)+Math.abs(f));t.beginPath();var v=new Path2D;v.rect(h-d/2,p-y/2,d,y);var b=Math.min(r[0],n[0])-10,g=Math.min(r[1],n[1])-10,m=Math.abs(i)+20,_=Math.abs(a)+20;v.rect(b,g,m,_),t.clip(v,"evenodd")}t.moveTo(n[0],n[1]),t.lineTo(r[0],r[1]),this.lineDash&&(t.save(),t.setLineDash(this.lineDash)),t.stroke(),this.lineDash&&t.restore(),t.translate(r[0],r[1]),t.rotate(o),t.moveTo(0,0),t.lineTo(-5,-4),t.lineTo(-5,4),t.lineTo(0,0),t.fill(),t.rotate(-o),t.translate(-r[0],-r[1])}},{key:"isHit",value:function(t){if(!this._cachePoints)return!1;var e=vo(this._cachePoints,2);return q(t,e[0],e[1])<this.approximate}}],n&&go(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Mr);const Oo=ko;function xo(t){return xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xo(t)}function So(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function To(t,e){return To=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},To(t,e)}function Po(t,e){if(e&&("object"===xo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Eo(t){return Eo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Eo(t)}var Ro=Math.PI/180,Co=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&To(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Eo(r);if(o){var n=Eo(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Po(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).approximate=t.approximate||6,e.radius=t.radius||0,e.minSpanX=t.minSpanX||10,e.minSpanY=t.minSpanY||10,e.lineDash=t.lineDash,e.doubleLink=t.doubleLink,e.fontFamily=t.fontFamily="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",e.fontSize=t.fontSize||"12px",e.content=t.content||"",e.isSelf=!!t.isSelf,e.noArrow=!!t.noArrow,e}return e=a,n=[{key:"_calculateAnchorPoints",value:function(){var t=this.from.getIntersectionsInFourDimension(),e=this.to.getIntersectionsInFourDimension();if(this.isSelf){var n=K(t[this.fromDir],e[A.SELF],this.fromDir,this.toDir,this.minSpanX,this.minSpanY,!0);this._cachePoints=n,this._cacheAngle=[this.fromDir,this.toDir]}else if(void 0!==this.fromDir&&void 0!==this.toDir){var r=K(t[this.fromDir],e[this.toDir],this.fromDir,this.toDir,this.minSpanX,this.minSpanY);this._cachePoints=r,this._cacheAngle=[this.fromDir,this.toDir]}else{var o=V(t,e),i=K(o.fromP,o.toP,o.fromDir,o.toDir,this.minSpanX,this.minSpanY);this._cachePoints=i,this._cacheAngle=[o.fromDir,o.toDir]}}},{key:"isInViewBox",value:function(t){return!!this._static||(this._calculateAnchorPoints(),function(t,e){for(var n=t[0],r=t.length,o=1,i=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||W(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,4),a=i[0],s=i[1],c=i[2],u=i[3];o<r;){var l=t[o];if(n[0]===l[0]){if(n[0]<c&&n[0]>a&&!(n[1]>u&&l[1]>u||n[1]<s&&l[1]<s))return!0}else if(n[1]<u&&n[1]>s&&!(n[0]>c&&l[0]>c||n[0]<a&&l[0]<a))return!0;n=l,o++}return!1}(this._cachePoints,t))}},{key:"render",value:function(t){var e=this,n=this.radius,r=this._cachePoints,o=r[0],i=r[r.length-1],a=(this._cacheAngle[1]+2)%4*90*Ro;if(t.fillStyle=t.strokeStyle=this.backgroundColor,this.doubleLink){var s=(this._cacheAngle[0]+2)%4*90*Ro;t.beginPath(),t.translate(o[0],o[1]),t.rotate(s),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-s),t.translate(-o[0],-o[1])}if(t.beginPath(),t.moveTo(o[0],o[1]),r.slice(1,r.length-1).forEach((function(o,i){if(e.radius){var a=function(t,e,n,r){var o=Z(e,t),i=Z(e,n),a=Q(o),s=Q(i);if(!a||!s)return{p1:null,p2:null};var c=tt(o,r/a),u=tt(i,r/s);return{p1:Z(e,c),p2:Z(e,u)}}(r[i],o,r[i+2],n),s=a.p1,c=a.p2;s&&c?(t.lineTo(s[0],s[1]),t.quadraticCurveTo(o[0],o[1],c[0],c[1])):t.lineTo(o[0],o[1])}else t.lineTo(o[0],o[1])})),t.lineTo(i[0],i[1]),this.lineDash&&(t.save(),t.setLineDash(this.lineDash)),t.stroke(),this.lineDash&&t.restore(),this.noArrow||(t.beginPath(),t.translate(i[0],i[1]),t.rotate(a),t.moveTo(0,0),t.lineTo(-5,-4),t.lineTo(-5,4),t.lineTo(0,0),t.fill(),t.rotate(-a),t.translate(-i[0],-i[1])),this.content)switch(t.beginPath(),t.font="".concat(this.fontSize," ").concat(this.fontFamily),this.fromDir){case A.BOTTOM:t.textAlign="left",t.fillText(this.content,o[0]+2,o[1]+10);break;case A.RIGHT:t.textAlign="left",t.fillText(this.content,o[0]+10,o[1]-2)}}},{key:"isHit",value:function(t){if(this._static)return!1;if(!this._cachePoints)return!1;var e=this._cachePoints,n=e[0],r=e.slice(1);do{var o=r.shift();if(o&&q(t,n,o)<this.approximate)return!0;n=o}while(n);return!1}},{key:"cloneStatic",value:function(){var t,e=new a({});return Object.assign(e,(So(t={radius:this.radius,_cachePoints:this._cachePoints,_cacheAngle:this._cacheAngle,backgroundColor:this.backgroundColor,doubleLink:this.doubleLink},"radius",this.radius),So(t,"lineDash",this.lineDash),So(t,"noArrow",this.noArrow),So(t,"content",this.content),So(t,"fontSize",this.fontSize),So(t,"fontFamily",this.fontFamily),So(t,"fromDir",this.fromDir),So(t,"_static",!0),t)),e}}],n&&jo(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Mr);const Io=Co;function Bo(t){return Bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bo(t)}function Mo(t){return function(t){if(Array.isArray(t))return Lo(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Ao(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ao(t,e){if(t){if("string"==typeof t)return Lo(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Lo(t,e):void 0}}function Lo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Do(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Fo(t,e){return Fo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Fo(t,e)}function Ho(t,e){if(e&&("object"===Bo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function zo(t){return zo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},zo(t)}var Wo=Math.PI/180,No=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fo(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=zo(r);if(o){var n=zo(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Ho(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).approximate=t.approximate||6,e.minSpanX=t.minSpanX||0,e.minSpanY=t.minSpanY||0,e.lineDash=t.lineDash,e.doubleLink=t.doubleLink,e.fontFamily=t.fontFamily="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",e.fontSize=t.fontSize||"12px",e.content=t.content||"",e.isSelf=!!t.isSelf,e}return e=a,n=[{key:"_calculateAnchorPoints",value:function(){var t=this.from.getIntersectionsInFourDimension(),e=this.to.getIntersectionsInFourDimension();if(this.isSelf){var n=$(t[this.fromDir],e[A.SELF],this.fromDir,A.BOTTOM,this.minSpanX,this.minSpanY);this._cachePoints=[].concat(Mo(t[this.fromDir]),Mo(n)),this._cacheAngle=[this.fromDir,A.BOTTOM]}else if(void 0!==this.fromDir&&void 0!==this.toDir){var r=$(t[this.fromDir],e[this.toDir],this.fromDir,this.toDir,this.minSpanX,this.minSpanY);this._cachePoints=[].concat(Mo(t[this.fromDir]),Mo(r)),this._cacheAngle=[this.fromDir,this.toDir]}else{var o=V(t,e),i=$(o.fromP,o.toP,o.fromDir,o.toDir);this._cachePoints=[].concat(Mo(o.fromP),Mo(i)),this._cacheAngle=[o.fromDir,o.toDir]}}},{key:"render",value:function(t){this._calculateAnchorPoints();var e,n,r=this._cachePoints,o=J.apply(null,[1].concat(Mo(r)));if(t.fillStyle=t.strokeStyle=this.backgroundColor,this.doubleLink){var i=(this._cacheAngle[0]+2)%4*90*Wo;t.beginPath(),t.translate(r[0],r[1]),t.rotate(i),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-i),t.translate(-r[0],-r[1])}if(t.beginPath(),t.moveTo(r[0],r[1]),t.bezierCurveTo.apply(t,Mo(r.slice(2))),this.lineDash&&(t.save(),t.setLineDash(this.lineDash)),t.stroke(),this.lineDash&&t.restore(),t.beginPath(),t.translate(r[6],r[7]),t.rotate(o),t.moveTo(5,0),t.lineTo(0,-4),t.lineTo(0,4),t.lineTo(5,0),t.fill(),t.rotate(-o),t.translate(-r[6],-r[7]),this.content){t.beginPath();var a=r[0]>r[6],s=function(t,e){var n=.5,r=.125*e[0]+.375*e[2]+.375*e[4]+.125*e[6],o=.125*e[1]+.375*e[3]+.375*e[5]+.125*e[7],i=n*n*(e[2]-e[0])+.5*(e[4]-e[2])+t*t*(e[6]-e[4]),a=n*n*(e[3]-e[1])+.5*(e[5]-e[3])+t*t*(e[7]-e[5]);return[r,o,Math.atan2(a,i)]}(.5,r),c=(n=3,function(t){if(Array.isArray(t))return t}(e=s)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(e,n)||Ao(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=c[0],l=c[1],f=c[2];t.translate(u,l),t.rotate(f),a&&t.rotate(Math.PI),t.font="".concat(this.fontSize," ").concat(this.fontFamily),t.textAlign="center",t.fillText(this.content,0,-(parseInt(this.fontSize)||12)/4),a&&t.rotate(Math.PI),t.rotate(-f),t.translate(-u,-l)}}},{key:"isHit",value:function(t){if(!this._cachePoints)return!1;var e=function(t,e){var n=D(M,z(e)).project({x:t[0],y:t[1]});return G(t,[n.x,n.y])}(t,this._cachePoints);return e<this.approximate}}],n&&Do(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Mr);const Xo=No;function Yo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Go(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var qo=function(){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Yo(this,t),this.direction=n.direction||"vertical",this.gap=null!==(e=n.gap)&&void 0!==e?e:5,this.alignment=n.alignment||"center",this.justify=n.justify||"center",this._rawConfigs=n}var e,n;return e=t,n=[{key:"reflow",value:function(t){var e=this,n=t._stack.filter((function(t){return t.visible&&!t.absolutePosition})),r=t._stack.filter((function(t){return t.visible&&t.absolutePosition})),o=t.width-t.padding.left-t.padding.right;if("vertical"===this.direction){var i=0,a=0,s=0,c=0,u=n.concat(r);u.forEach((function(t,e){"block"===t.display&&(t.width=0,t.resetChildrenPosition(),t.reflow(),t._getBoundingGroupRect())})),n.forEach((function(t,n){var r=t.getBoundingDimension(),o=r.width,u=r.height,l=n>0?e.gap:0;"outstretch"!==t.display&&(s=Math.max(o,s)),c+=u+l,i+=u/2+l+a,a=u/2,t.anchor=[0,i]})),u.forEach((function(e,n){if("block"===e.display)e.resetChildrenPosition(),e.width=s,e.reflow();else if("outstretch"===e.display){var r=t._belongs.width-t._belongs.padding.left-t._belongs.padding.right;e.resetChildrenPosition(),e.width=Math.max(r,s),e.reflow()}})),s=Math.max(o,s),c/=2,"start"===this.alignment&&n.forEach((function(t,e){var n=t.getBoundingDimension().width;t.anchor[0]=-(s-n)/2,t.anchor[1]-=c})),"end"===this.alignment&&n.forEach((function(t,e){var n=t.getBoundingDimension().width;t.anchor[0]=(s-n)/2,t.anchor[1]-=c})),"center"===this.alignment&&n.forEach((function(t,e){t.getBoundingDimension().width,t.anchor[1]-=c}))}if("horizontal"===this.direction){var l=0,f=0,h=0,p=0;if(n.forEach((function(t,n){var r=t.getBoundingDimension(),o=r.width,i=r.height,a=n>0?e.gap:0;h=Math.max(i,h),p+=o+a,l+=o/2+a+f,f=o/2,t.anchor=[l,0]})),"start"===this.justify){var d=o/2;n.forEach((function(t,e){t.anchor[0]-=d}))}if("end"===this.justify){var y=o/2-p;n.forEach((function(t,e){t.anchor[0]+=y}))}if("center"===this.justify){var v=p/2;n.forEach((function(t,e){t.anchor[0]-=v}))}if("space-between"===this.justify&&n.length>1){var b=Math.max(o,p),g=(b-p)/(n.length-1),m=b/2;n.forEach((function(t,e){t.anchor[0]+=g*e-m}))}"start"===this.alignment&&n.forEach((function(t,e){var n=t.getBoundingDimension().height;t.anchor[1]=-(h-n)/2})),"end"===this.alignment&&n.forEach((function(t,e){var n=t.getBoundingDimension().height;t.anchor[1]=(h-n)/2}))}if(r.length){"block"===t.display?t.getBoundingDimension():t._getBoundingGroupRect();var _=t.width/2,w=t.height/2,k=(t.padding.top-t.padding.bottom)/2,O=(t.padding.left-t.padding.right)/2;r.forEach((function(t){t.anchor=e._resolveAbsoluteAnchor(t.absolutePosition,t,_,w,O,k)}))}}},{key:"_resolveAbsoluteAnchor",value:function(t,e,n,r,o,i){var a=t.top,s=t.right,c=t.bottom,u=t.left,l=t.centerX,f=t.centerY,h=e.getBoundingDimension(),p=h.width/2,d=h.height/2,y=0,v=0;return"number"==typeof a&&(y=a+d-r-i),"number"==typeof s&&(v=n-s-p-o),"number"==typeof c&&(y=r-c-d-i),"number"==typeof u&&(v=u+p-n-o),"number"==typeof l&&(v=l),"number"==typeof f&&(y=f),[v,y]}},{key:"clone",value:function(){return new t(this._rawConfigs)}}],n&&Go(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();const Vo=qo;function Uo(t){return Uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Uo(t)}function $o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Jo(t,e)}function Jo(t,e){return Jo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Jo(t,e)}function Ko(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ti(t);if(e){var o=ti(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Zo(this,n)}}function Zo(t,e){if(e&&("object"===Uo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Qo(t)}function Qo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ti(t){return ti=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ti(t)}function ei(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ni(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ri(t,e,n){return e&&ni(t.prototype,e),n&&ni(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var oi=function(){function t(e){ei(this,t),this.source=e,this.id=e.id,this.type=e.type,this.level=void 0,this.sequence=void 0,this.isFree=!1,this.parent=void 0,this.idx=void 0,this.parentIterateType=void 0,this.hasEndPoint=!1}return ri(t,[{key:"reflowPreCalculate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return this.level=t,this.sequence=e,this.spanX=1,this.spanY=1,n&&n(t,e,this),{spanX:this.spanX,spanY:this.spanY,level:t,sequence:e}}},{key:"makeLink",value:function(t){return this}},{key:"makeEndpoint",value:function(){}},{key:"traverse",value:function(t){t(this)}},{key:"getNodes",value:function(t){var e=[];return this.traverse((function(n){var r=t.getRenderNodeBySource(n.source);r&&e.push(r)})),e}},{key:"linkSource",value:function(t){this.parent.source[this.parentIterateType].splice(this.idx+1,0,t)}},{key:"remove",value:function(){this.parent.source[this.parentIterateType].splice(this.idx,1)}}]),t}(),ii=function(t){$o(n,t);var e=Ko(n);function n(t){var r;ei(this,n),(r=e.call(this,t)).isroot=!0,r.body=(t.body||[]).map(hi("body").bind(Qo(r)));var o=hi("playground").bind(Qo(r));return r.playground=(t.playground||[]).map((function(t,e){var n=o(t,e);return n.isFree=!0,n})),r}return ri(n,[{key:"reflowBodyPreCalculate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=1,o=1;return this.level=t,this.sequence=e,n&&n(t,e,this),this.body.forEach((function(i){var a=i.reflowPreCalculate(t+1,e,n),s=a.spanX,c=a.spanY;r=Math.max(s,r),o+=c,t+=c})),this.spanX=r,this.spanY=o,{spanX:r,spanY:o,level:t,sequence:e}}},{key:"reflowPlaygroundPreCalculate",value:function(t,e){this.playground.forEach((function(n){t(n),n.reflowPreCalculate(0,0,e)}))}},{key:"makeLink",value:function(t){var e;return this.body.forEach((function(n){e?(t({from:e,to:n,part:"body",fromDir:A.BOTTOM,toDir:A.TOP}),n=n.makeLink(t),e=n):e=n})),this.playground.forEach((function(e){e.makeLink(t)})),this}},{key:"traverse",value:function(t){this.body.forEach((function(e){e.traverse(t)})),this.playground.forEach((function(e){e.traverse(t)}))}}]),n}(oi),ai=function(t){$o(n,t);var e=Ko(n);function n(t){var r;return ei(this,n),(r=e.call(this,t)).consequent=(t.consequent||[]).map(hi("consequent").bind(Qo(r))),r.alternate=(t.alternate||[]).map(hi("alternate").bind(Qo(r))),r.isLocked=!0,r.hasEndPoint=!0,r}return ri(n,[{key:"reflowPreCalculate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=1,o=1;this.level=t,this.sequence=e,n&&n(t,e,this);var i=1,a=0,s=0,c=0;this.consequent.forEach((function(r,o){var s=r.reflowPreCalculate(t+1,e,n),c=s.spanX,u=s.spanY;i=Math.max(i,c),a+=u,t+=u}));var u=e+i;t=this.level,this.alternate.forEach((function(e,r){var o=e.reflowPreCalculate(t+1,u,n),i=o.spanX,a=o.spanY;s=Math.max(s,i),c+=a,t+=a})),r=Math.max(1,i+s),o+=Math.max(a,c),t=this.level+o-1;var l=this.Endpoint.reflowPreCalculate(t+1,e,n),f=l.spanY;return o+=f,this.spanX=r,this.spanY=o,{spanX:r,spanY:o,level:t,sequence:e}}},{key:"makeLink",value:function(t){var e=this,n=this;this.consequent.forEach((function(e){t({from:n,to:e,part:"consequent",fromDir:A.BOTTOM,toDir:A.TOP}),e=e.makeLink(t),n=e})),t({from:n,to:this.Endpoint,fromDir:A.BOTTOM,toDir:A.TOP,part:"consequent"});var r=this;return this.alternate.forEach((function(n){t({from:r,to:n,fromDir:r===e?A.RIGHT:A.BOTTOM,toDir:A.TOP,part:"alternate"}),n=n.makeLink(t),r=n})),t({from:r,to:this.Endpoint,fromDir:r===this?A.RIGHT:A.BOTTOM,toDir:A.RIGHT,part:"alternate"}),this.Endpoint}},{key:"traverse",value:function(t){t(this),this.consequent.forEach((function(e){e.traverse(t)})),this.alternate.forEach((function(e){e.traverse(t)})),console.log(this.Endpoint),t(this.Endpoint)}},{key:"linkSource",value:function(t,e){this.source[e.part].unshift(t)}}]),n}(oi),si=function(t){$o(n,t);var e=Ko(n);function n(t){var r;return ei(this,n),(r=e.call(this,t)).cases=(t.cases||[]).map(hi("case").bind(Qo(r))),r.cases.length&&(r.cases[r.cases.length-1].lastCase=!0),r.isLocked=!0,r.hasEndPoint=!0,r}return ri(n,[{key:"reflowPreCalculate",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,o=1,i=1;this.level=e,this.sequence=n,r&&r(e,n,this);var a=1,s=0;if(this.cases.length){var c=this.cases[this.cases.length-1].consequent;e=this.level,c.forEach((function(t){var o=t.reflowPreCalculate(e+1,n,r),i=o.spanX,c=o.spanY;a=Math.max(a,i),s+=c,e+=c}))}var u=a,l=0;this.cases.forEach((function(o,i){var a=n+u,s=0,c=0;e=t.level,o.alternate.forEach((function(t){var n=t.reflowPreCalculate(e+1,a,r),o=n.spanX,i=n.spanY;s=Math.max(s,o),c+=i,e+=i})),u+=s,l=Math.max(l,c)})),o=Math.max(1,u),i=Math.max(s,l),e=this.level+i;var f=this.Endpoint.reflowPreCalculate(e+1,n,r),h=f.spanY;return i+=h,i+=1,this.spanX=o,this.spanY=i,{spanX:o,spanY:i,level:e,sequence:n}}},{key:"makeLink",value:function(t){var e=this,n=this;return this.cases.length&&this.cases[this.cases.length-1].consequent.forEach((function(e,r){t({from:n,to:e,fromDir:A.BOTTOM,toDir:A.TOP,part:"consequent"}),n=e.makeLink(t)})),console.log(n),t({from:n,to:this.Endpoint,fromDir:A.BOTTOM,toDir:A.TOP,part:"consequent"}),this.cases.forEach((function(n,r){var o=n;n.alternate.forEach((function(e){t({from:o,to:e,fromDir:o===n?A.RIGHT:A.BOTTOM,toDir:A.TOP,part:"alternate"}),o=e.makeLink(t)})),t({from:o,to:e.Endpoint,fromDir:o===n?A.RIGHT:A.BOTTOM,toDir:A.RIGHT,part:"alternate",minSpanX:32*(r+1)})})),this.Endpoint}},{key:"traverse",value:function(t){t(this),this.cases.forEach((function(e){e.traverse(t)})),t(this.Endpoint)}},{key:"getNodes",value:function(t){var e=[];return this.traverse((function(n){if("SwitchCase"!==n.type){var r=t.getRenderNodeBySource(n.source);r&&e.push(r)}})),e}},{key:"linkSource",value:function(t,e){var n=this.source.cases;n[n.length-1].consequent.unshift(t)}}]),n}(oi),ci=function(t){$o(n,t);var e=Ko(n);function n(){return ei(this,n),e.apply(this,arguments)}return ri(n)}(oi),ui=function(t){$o(n,t);var e=Ko(n);function n(t){var r;return ei(this,n),(r=e.call(this,t)).body=(t.body||[]).map(hi("body").bind(Qo(r))),r.isLocked=!0,r}return ri(n,[{key:"reflowPreCalculate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=1,o=1;this.level=t,this.sequence=e,n&&n(t,e,this);var i=e+1;return this.body.forEach((function(e){var a=e.reflowPreCalculate(t+1,i,n),s=a.spanX,c=a.spanY;r=Math.max(s,r),o+=c,t+=c})),this.spanX=r+1,this.spanY=o,{spanX:r,spanY:o,level:t,sequence:e}}},{key:"makeLink",value:function(t){var e=this,n=this;return this.body.forEach((function(r,o){t({from:n,to:r,part:"body",fromDir:n===e?A.RIGHT:A.BOTTOM,toDir:A.TOP}),r=r.makeLink(t),n=r})),t({from:n,to:this,part:"body",fromDir:n===this?A.RIGHT:A.BOTTOM,anticlock:n===this,toDir:A.BOTTOM,isSelf:!0,minSpanX:20,minSpanY:20}),this}},{key:"traverse",value:function(t){t(this),this.body.forEach((function(e){e.traverse(t)}))}},{key:"linkSource",value:function(t,e){this.source[e.part].unshift(t)}}]),n}(oi),li=function(t){$o(n,t);var e=Ko(n);function n(t){var r;return ei(this,n),(r=e.call(this,t)).consequent=(t.consequent||[]).map(hi("consequent").bind(Qo(r))),r.alternate=(t.alternate||[]).map(hi("alternate").bind(Qo(r))),r.lastCase=!1,r}return ri(n,[{key:"reflowPreCalculate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=1,o=1;this.level=t,this.sequence=e,n&&n(t,e,this);var i=0,a=0,s=0,c=0;this.lastCase&&this.consequent.forEach((function(r,o){var s=r.reflowPreCalculate(t+1,e,n),c=s.spanX,u=s.spanY;i=Math.max(i,c),a+=u,t+=u}));var u=e+Math.max(i,1);return t=this.level,this.alternate.forEach((function(e,r){var o=e.reflowPreCalculate(t+1,u,n),i=o.spanX,a=o.spanY;s=Math.max(s,i),c+=a,t+=a})),r=Math.max(1,i+s),o+=Math.max(a,c),this.spanX=r,this.spanY=o,{spanX:r,spanY:o,level:t,sequence:e}}},{key:"traverse",value:function(t){t(this),this.consequent.forEach((function(e){e.traverse(t)})),this.alternate.forEach((function(e){e.traverse(t)}))}},{key:"linkSource",value:function(t,e){this.source[e.part].unshift(t)}}]),n}(oi),fi={IfStatement:ai,SwitchStatement:si,SwitchCase:li,ForEachStatement:ci,WhileStatement:ui,Root:ii,other:oi};function hi(t){return function(e,n){var r=pi(e);if(r.parent=this,r.idx=n,r.parentIterateType=t,r.hasEndPoint){e.__endpoint__||(e.__endpoint__={type:"endpoint",id:"".concat(r.id,"-endpoint")});var o=pi(e.__endpoint__);o.parent=this,o.idx=n,o.parentIterateType=t,r.Endpoint=o}return r}}function pi(t){var e=t.type;return new(fi[e]||fi.other)(t)}function di(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function yi(t){return t*t}var vi=function(){function t(e){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.linkLength=e.linkLength||18,this.gap=e.gap||30,this.treeItemDraggable=null===(n=e.treeItemDraggable)||void 0===n||n,this.reOrder(e.ast),this.static=!0}var e,n;return e=t,n=[{key:"reOrder",value:function(t){var e=this;this.ast=t,this.flowStack=[],this.flowLinkStack=[],this.root=pi(this.ast),this.root.traverse((function(t){"playground"!==t.parentIterateType&&(t.isDraggable=e.treeItemDraggable),e.flowStack.push({type:t.type,source:t.source,layoutNode:t})}));var n,r={vertical:{},horizontal:{}},o={};this.root.reflowBodyPreCalculate(0,0,(function(t,e,n){n.isroot||(r.vertical[t]||(r.vertical[t]={}),r.vertical[t][e]=n,r.horizontal[e]||(r.horizontal[e]={}),r.horizontal[e][t]=n)})),this.root.reflowPlaygroundPreCalculate((function(t){n=t.id,o[t.id]={vertical:{},horizontal:{},node:t}}),(function(t,e,r){var i=o[n];i.vertical[t]||(i.vertical[t]={}),i.vertical[t][e]=r,i.horizontal[e]||(i.horizontal[e]={}),i.horizontal[e][t]=r})),this.layoutMapping=r,this.playgroundLayoutMapping=o,this.root.makeLink((function(t){e.flowLinkStack.push(t)}))}},{key:"staticCheck",value:function(t,e){if(t._layoutNode&&t._layoutNode.isFree)return!1;if(!e._linkStack.find((function(e){return e.from===t||e.to===t})))return!1;var n,r,o=t.anchor.slice();return e.reflow(),e._linkStack.length<2?void 0:(r=t.anchor,yi((n=o)[0]-r[0])+yi(n[1]-r[1])>1e3&&(t.dispatchEvent(new ge("outOfFlow",{anchor:o,instance:t,jflow:e,point:o})),!0))}},{key:"reflowByMapping",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=this.linkLength,i=this.gap,a=e.vertical,s=e.horizontal,c=n;Object.keys(s).forEach((function(e,n){var r=s[e],o=0,a=Object.keys(r);a.forEach((function(e){var n=r[e],i=t.getRenderNodeBySource(n.source).getBoundingDimension().width;o=Math.max(i,o)})),c+=0===n?0:o/2,a.forEach((function(e){var n=r[e];t.getRenderNodeBySource(n.source).anchor[0]=c})),c+=o/2+i}));var u=r;Object.keys(a).forEach((function(e,n){var r=a[e],i=0,s=Object.keys(r);s.forEach((function(e){var n=r[e],o=t.getRenderNodeBySource(n.source).getBoundingDimension(),a=o.height;o.width,i=Math.max(a,i)})),u+=0===n?0:i/2,s.forEach((function(e){var n=r[e];t.getRenderNodeBySource(n.source).anchor[1]=u})),u+=i/2+o}))}},{key:"findLayoutNode",value:function(t){var e=this.flowStack.find((function(e){return e.configs===t}));return e?e.layoutMeta:null}},{key:"reflow",value:function(t){var e=this;this.reflowByMapping(t,this.layoutMapping),Object.values(this.playgroundLayoutMapping).forEach((function(n){var r=t.getRenderNodeBySource(n.node.source);e.reflowByMapping(t,n,r.anchor[0],r.anchor[1])}))}}],n&&di(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();const bi=vi;function gi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mi(t,e,n){return e&&gi(t.prototype,e),n&&gi(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var wi=mi((function t(e,n,r){_i(this,t),this.type="ERProperty",this.source=e,this.node=n,this.ref=e.ref,this.type=e.type,this.association=e.association,this.id=r?"".concat(n.id,"-").concat(e.name,"-navigation"):"".concat(n.id,"-").concat(e.name),this._selfLink=!1,this.parentPropertyRef=void 0,this.getJflowInstance=void 0,this.doubleRef=void 0})),ki=function(){function t(e){var n=this;_i(this,t),this.type="ERNode",this.source=e,this.id=e.name,this.isDraggable=!0,this.getJflowInstance=void 0,this.propertyList=e.propertyList.map((function(t){return new wi(t,n)})),this.navigationPropertyList=e.navigationPropertyList.map((function(t){return new wi(t,n,!0)})),this.idProperty=this.propertyList.find((function(t){return"id"===t.source.name}))}return mi(t,[{key:"_traverseProperty",value:function(t){var e=this;this.propertyList.forEach((function(n){var r=n.source.idRef;if(n.source.isParentRef,r&&"Array"!==n.source.type&&t[r]){var o=t[r];n.source.isParentRef&&(e.parentRef=o),o===e&&(n._selfLink=!0),n.parentPropertyRef=o.idProperty}})),this.navigationPropertyList.forEach((function(n){var r=n.source.objectRef;if(r&&t[r]){var o=t[r],i=o.navigationPropertyList.find((function(t){return t.source.objectRef===e.id}));o===e&&(n._selfLink=!0),n.doubleRef=i}}))}},{key:"traverse",value:function(e){e(this),this.propertyList.forEach((function(n){n.ref instanceof t&&e(n)}))}},{key:"makeLink",value:function(t){this.propertyList.forEach((function(e){if(e.parentPropertyRef instanceof wi){var n=e.parentPropertyRef;e._selfLink?t({from:e.id,to:n.id,part:"property",fromDir:A.LEFT,toDir:A.LEFT,content:e.association,minSpanX:80,meta:{from:e,to:n}}):t({from:e.id,to:n.id,part:"property",content:e.association,meta:{from:e,to:n}})}})),this.navigationPropertyList.forEach((function(e){if(e.doubleRef instanceof wi){var n=e.doubleRef;e._selfLink?t({from:e.id,to:n.id,part:"property",fromDir:A.LEFT,toDir:A.TOP,lineDash:[10,5],doubleLink:!0,content:e.association,minSpanX:80,minSpanY:80,meta:{from:e,to:n}}):t({from:e.id,to:n.id,part:"property",lineDash:[10,5],doubleLink:!0,content:e.association,meta:{from:e,to:n,isObjectRef:!0}})}}))}}]),t}();function Oi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function xi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Si=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.static=!1,this.flowStack=[],this.flowLinkStack=[],this.erNodes=[],this.reOrder(e.entityRelationship)}var e,n;return e=t,n=[{key:"reOrder",value:function(t){var e=this;this.er=t,this.flowStack=[],this.flowLinkStack=[];var n=function(t){var e={},n=t.map((function(t){var n=new ki(t);return e[t.name]=n,n}));return n.forEach((function(t){t._traverseProperty(e)})),n}(this.er),r=[];n.forEach((function(t){t.traverse((function(t){e.flowStack.push({type:t.type,configs:t.source,layoutMeta:t})})),t.makeLink((function(t){var n=t.from,o=t.to,i=t.meta;if(i.isObjectRef){var a="".concat(n,"-").concat(o),s="".concat(o,"-").concat(n),c=i.from;if(r.includes(a)||r.includes(s))return;c.source.isParentRef||(r.push(a),r.push(s),e.flowLinkStack.push(t))}else e.flowLinkStack.push(t)}))})),this.erNodes=n}},{key:"staticCheck",value:function(t,e){return!1}},{key:"reflow",value:function(t){this.flowLinkStack,this.erNodes;var e={},n=1e3;function r(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=[0,0];return t.parentRef?e.includes(t.parentRef)?[o[0]-500+t.source.diagramWeight*n,o[1]]:(e.push(t.parentRef),[(o=r(t.parentRef,e))[0]-500+t.source.diagramWeight*n,o[1]+600]):o}this.erNodes.forEach((function(t){var n,o,i=t.getJflowInstance(),a=(n=r(t),o=2,function(t){if(Array.isArray(t))return t}(n)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(n,o)||function(t,e){if(t){if("string"==typeof t)return Oi(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Oi(t,e):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=a[0],c=a[1];e[c]||(e[c]=[]),e[c].push(t),i.anchor=[s+500*e[c].length,c]}))}}],n&&xi(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();const ji=Si;var Ti="input",Pi="control",Ei="input",Ri="compositionstart",Ci="compositionupdate",Ii="compositionend",Bi="enter",Mi="delete",Ai="backspace",Li="arrowLeft",Di="arrowRight",Fi="arrowUp",Hi="arrowDown",zi="undo",Wi="redo",Ni="shift_down",Xi="shift_up",Yi="ctrla",Gi="startedit",qi="editclick",Vi="shiftonclick",Ui="doubleclick";function $i(t){return $i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$i(t)}function Ji(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ki(t,e){if(e&&("object"===$i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Zi(t)}function Zi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Qi(t){var e="function"==typeof Map?new Map:void 0;return Qi=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return ta(t,arguments,ra(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),na(r,t)},Qi(t)}function ta(t,e,n){return ta=ea()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&na(o,n.prototype),o},ta.apply(null,arguments)}function ea(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function na(t,e){return na=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},na(t,e)}function ra(t){return ra=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ra(t)}var oa=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&na(t,e)}(a,t);var e,n,r,o,i=(e=a,n=ea(),function(){var t,r=ra(e);if(n){var o=ra(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return Ki(this,t)});function a(t){var e,n,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),null,(r="_inputElement")in(n=Zi(e=i.call(this)))?Object.defineProperty(n,r,{value:null,enumerable:!0,configurable:!0,writable:!0}):n[r]=null,e._inputElement=function(t){var e=document.createElement("input");e.setAttribute("style","\n        width: 100px;\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        opacity: 0;\n        z-index: -1;\n        contain: strict;"),e.setAttribute("tabindex",-1),e.setAttribute("aria-hidden",!0),e.setAttribute("spellcheck",!1),e.setAttribute("autocorrect","off");var n=!1,r={ctrlOn:!1,shiftOn:!1};return e.addEventListener("beforeinput",(function(e){e.preventDefault(),e.data&&(n||t(Ei,e.data))})),e.addEventListener("compositionstart",(function(e){t(Ri),n=!0})),e.addEventListener("compositionupdate",(function(e){t(Ci,e.data)})),e.addEventListener("compositionend",(function(r){t(Ii,r.data),e.value="",n=!1})),e.addEventListener("keyup",(function(e){if(!n)switch(e.key){case"Shift":t(Xi),r.shiftOn=!1;break;case"Meta":case"Control":r.ctrlOn=!1}})),e.addEventListener("keydown",(function(e){if(!n){switch(e.code){case"Enter":t(Bi);break;case"Backspace":t(Ai);break;case"Delete":t(Mi);break;case"ArrowLeft":t(Li);break;case"ArrowRight":t(Di);break;case"ArrowDown":t(Hi);break;case"ArrowUp":t(Fi)}switch(e.key){case"Shift":t(Ni),r.shiftOn=!0;break;case"Meta":case"Control":r.ctrlOn=!0;break;case"a":r.ctrlOn&&t(Yi);break;case"c":r.ctrlOn&&t("ctrlc");break;case"v":r.ctrlOn&&t("ctrlv");break;case"x":r.ctrlOn&&t("ctrlx");break;case"y":r.ctrlOn&&(e.preventDefault(),t(Wi));break;case"z":r.ctrlOn&&r.shiftOn?t(Wi):r.ctrlOn&&t(zi)}}})),e}(e.controlCallback.bind(Zi(e))),t.append(e._inputElement),e._inputElement.focus(),e}return r=a,(o=[{key:"controlCallback",value:function(t,e){switch(t){case Ei:case Ri:case Ci:case Ii:case Bi:case Ai:case Mi:this.dispatchEvent(new CustomEvent(Ti,{detail:{kind:t,data:e}}));break;case Li:case Di:case Fi:case Hi:case Yi:case Ni:case Xi:case zi:case Wi:this.dispatchEvent(new CustomEvent(Pi,{detail:{kind:t}}))}}},{key:"focus",value:function(){this._inputElement.focus({preventScroll:!0})}},{key:"syncPosition",value:function(t,e){this._inputElement.style.transform="translate(".concat(t,"px, ").concat(e,"px)")}},{key:"destroy",value:function(){this._inputElement.remove()}}])&&Ji(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),a}(Qi(EventTarget));const ia=oa;function aa(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function sa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ca(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ua=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ca(this,"_row",0),ca(this,"_column",[0,0]),ca(this,"_status",{show:!0,anime:null,lastElapsed:0,refreshElapsed:!1})}var e,n;return e=t,n=[{key:"setRow",value:function(t){this._row=t}},{key:"setColumn",value:function(t,e){void 0!==e?this._column[t]=e:this._column=t}},{key:"getRow",value:function(){return this._row}},{key:"getColumn",value:function(t){return void 0!==t?this._column[t]:this._column}},{key:"animate",value:function(t){var e=this;this._status.anime=t.requestJFlowAnime((function(t){var n=e._status.lastElapsed;e._status.refreshElapsed&&(e._status.lastElapsed=t,e._status.refreshElapsed=!1),t-n>500&&(e._status.show=!e._status.show,e._status.lastElapsed=t)}))}},{key:"cancelAnimate",value:function(){this._status.cursoranime.cancel(),Object.assign(this._status,{show:!0,anime:null,lastElapsed:0})}},{key:"isShow",value:function(){return this._status.show}},{key:"refresh",value:function(){Object.assign(this._status,{show:!0,refreshElapsed:!0})}},{key:"toRange",value:function(){return[this._row].concat(function(t){if(Array.isArray(t))return aa(t)}(t=this._column)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return aa(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?aa(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());var t}},{key:"fromRange",value:function(t){this._row=t[0],this._column=t.slice(1)}}],n&&sa(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();const la=ua;function fa(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ha(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function pa(t,e,n){return e&&ha(t.prototype,e),n&&ha(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function da(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ya=function(){function t(){fa(this,t),da(this,"_lines",[])}return pa(t,[{key:"get",value:function(t){return this._lines[t]}},{key:"getLineAbove",value:function(t){for(var e=0,n=this._lines;e<n.length&&!(n[e].reduceHeight>t);)e++;return Math.min(e,n.length-1)}},{key:"truncate",value:function(t){var e=va.create(t);return this._lines=[e],e}},{key:"push",value:function(t){this._lines.push(t)}},{key:"forEach",value:function(t){this._lines.forEach(t)}},{key:"length",value:function(){return this._lines.length}}]),t}(),va=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};fa(this,t),da(this,"width",0),da(this,"anchorY",0),da(this,"height",0),da(this,"reduceHeight",0),da(this,"_elements",[]),da(this,"_elements",[]),Object.assign(this,e)}return pa(t,[{key:"get",value:function(t){return this._elements[t]}},{key:"length",value:function(){return this._elements.length}},{key:"insert",value:function(t,e){this._elements.splice(t,0,e)}},{key:"push",value:function(t){this._elements.push(t)}},{key:"tail",value:function(){return this._elements[this._elements.length-1]}},{key:"copy",value:function(){return this._elements.slice()}},{key:"getColumnNearest",value:function(t,e,n,r){var o=this._elements;if(t>=this.width){var i=o.length-1,a=o[i],s=0;return"text"===a.type&&(s=a.source.length),[i,s]}for(var u=0,l=0,f=0,h=null;u<o.length-1;){l=f;var p=o[u];if("text"!==p.type){var d=h&&"text"===h.type?2*e:e;f+=p.width+d}else f+=p.width;if(f>t){h=p;break}h=p,u++}f<=t&&(l=f);var y=o[u];if("text"===y.type){var v=function(t,e,n,r){var o=e.source,i=o.length-1;if(0===e.width)return 0;var a=e.width,s=Math.floor(t/a*i);return c((function(e){var c,u,l;e.font="".concat(n," ").concat(r);var f=o.substring(0,s),h=o.substring(s-1,s),p=o.substring(s,s+1),d=e.measureText(f).width,y=e.measureText(h).width,v=e.measureText(p).width;c=d-y/2,u=d+v/2;do{if(c<=t&&u>=t)break;if(c>t){var b=u-t;l=s,s-=b<100?1:Math.floor(b/u*l),f=o.substring(s,l),d-=e.measureText(f).width}else if(u<t){var g=t-c;l=s,s+=g<100?1:Math.floor(g/(a-c)*(i-l)),f=o.substring(l,s),d+=e.measureText(f).width}h=o.substring(s-1,s),p=o.substring(s,s+1),c=d-(y=e.measureText(h).width)/2,u=d+(v=e.measureText(p).width)/2}while(s>=0&&s<=i)})),s}(t-l,y,n,r);return[u,v]}return t-l>h.width/2?[u+1,0]:[u,0]}},{key:"forEach",value:function(t){this._elements.forEach(t)}}],[{key:"create",value:function(e){return new t(e)}}]),t}(),ba=function(){function t(){fa(this,t),da(this,"_textElements",[]),da(this,"_records",[]),da(this,"_caretRecord",null)}return pa(t,[{key:"insertBefore",value:function(t,e){var n=this.findIndex(t);this.inersetAt(n,e)}},{key:"insertAfter",value:function(t,e){var n=this.findIndex(t);this.get(n+1)&&e.setNeedWrap(t.needWrap||t.isTail),this.inersetAt(n+1,e)}},{key:"findIndex",value:function(t){return this._textElements.findIndex((function(e){return e===t}))}},{key:"get",value:function(t){return this._textElements[t]}},{key:"from",value:function(t){this._textElements=t}},{key:"inersetAt",value:function(t,e){this.splice(t,0,e)}},{key:"push",value:function(t){this.splice(this.length(),0,t)}},{key:"remove",value:function(t){this.splice(t,1)}},{key:"splice",value:function(){var t,e=(t=this._textElements).splice.apply(t,arguments);this._records.push({op:"splice",args:arguments,removed:e})}},{key:"copy",value:function(){return this._textElements.slice()}},{key:"isEmpty",value:function(){return 1===this._textElements.length&&""===this._textElements[0].source}},{key:"forEach",value:function(t){this._textElements.forEach(t)}},{key:"tail",value:function(){return this._textElements[this._textElements.length-1]}},{key:"filter",value:function(t){return this._textElements.filter(t)}},{key:"length",value:function(){return this._textElements.length}},{key:"startRecord",value:function(){return this._caretRecord={before:null,after:null},this._records=[],this._records}},{key:"getRecord",value:function(){return this._records}},{key:"recordBeforeCaret",value:function(t){this._caretRecord.before=t.toRange()}},{key:"recordAfterCaret",value:function(t){this._caretRecord.after=t.toRange()}},{key:"getCaretRecord",value:function(){return this._caretRecord}},{key:"collectRecords",value:function(){return this._records}}],[{key:"create",value:function(e){var n=new t;return n.from(e),n}}]),t}(),ga=function(){function t(e,n){fa(this,t),da(this,"needWrap",!1),da(this,"width",0),da(this,"reduceWidth",0),da(this,"height",0),da(this,"anchorX",0),da(this,"anchorY",0),da(this,"dirty",!0),da(this,"isTail",!1),this.type=e,this.source=n}return pa(t,[{key:"setSource",value:function(t,e){var n=this.source;this.source=t,this.dirty=!0,e&&e.push({op:"setSource",args:[this,t,n]})}},{key:"setNeedWrap",value:function(t,e){var n=this.needWrap;this.needWrap=t,n!==t&&e&&e.push({op:"setNeedWrap",args:[this,t,n]})}},{key:"shift",value:function(t,e){if("text"===this.type){var n=this.source.length,r=t+e;return r<0?"prev":r>n?"next":"self"}return e>0?"next":e<0?"prev":void 0}},{key:"tailOffset",value:function(){return"text"===this.type?this.needWrap||this.isTail?this.source.length:Math.max(0,this.source.length-1):0}},{key:"headOffset",value:function(){return 0}}]),t}();function ma(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return _a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_a(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function wa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ka(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Oa=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ka(this,"_enable",!1),ka(this,"_rangeFrom",null),ka(this,"_rangeTo",null),ka(this,"_initialRange",null)}var e,n;return e=t,n=[{key:"setInitialRange",value:function(t){this._initialRange=t}},{key:"getRangeFrom",value:function(){return this._rangeFrom}},{key:"getRangeTo",value:function(){return this._rangeTo}},{key:"isEnable",value:function(){return this._enable}},{key:"enable",value:function(){this._enable=!0}},{key:"disable",value:function(){this._enable=!1}},{key:"handleCaret",value:function(t){var e=ma(this._rangeTo,3),n=e[0],r=e[1],o=e[2];t.setRow(n),t.setColumn([r,o])}},{key:"setRange",value:function(t){var e=this._initialRange;this._compareRange(e,t)?(this._rangeFrom=e,this._rangeTo=t):(this._rangeFrom=t,this._rangeTo=e)}},{key:"_compareRange",value:function(t,e){return!(t[0]>e[0]||t[0]===e[0]&&t[1]>e[1]||t[0]===e[0]&&t[1]===e[1]&&t[2]>e[2])}},{key:"delete",value:function(t,e){if(this._enable){var n=t._area,r=t._caret,o=this._rangeFrom,i=this._rangeTo,a=n.get(o[0]).get(o[1]),s=n.get(i[0]).get(i[1]),c=ma(o,3),u=c[0],l=c[1],f=c[2];if(e.push({op:"range",args:[o.slice(),i.slice()]}),a===s){var h=a.source;a.setSource(h.substring(0,o[2])+h.substring(i[2]),e),a.dirty=!0}else{var p,d,y=t._flattenTxtElem,v="",b="",g=y.findIndex(a),m=y.findIndex(s),_=!1;if("text"===a.type?v=a.source.substring(0,o[2]):p=y.get(g-1),"text"===s.type?(b=s.source.substring(i[2]),_=s.needWrap):d=y.get(m-1),p)if(y.splice(g,m-g+1),"text"===p.type)p.needWrap?u-=1:l-=1,f=p.source.length,p.setSource(p.source+b,e),p.dirty=!0,p.setNeedWrap(_,e);else{var w=new ga("text",v+b);w.setNeedWrap(_,e),y.splice(g,0,w)}else if(y.splice(g,m-g),d){var k=new ga("text",v);y.splice(g,0,k)}else s.setSource(v+b,e),s.dirty=!0;0===y.length()&&y.push(new ga("text",""))}this.disable(),r.setRow(u),r.setColumn([l,f])}}}],n&&wa(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();const xa=Oa;function Sa(t){return function(t){if(Array.isArray(t))return Ra(t)}(t)||ja(t)||Ea(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ja(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function Ta(t,e){return Ca(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||Ea(t,e)||Pa()}function Pa(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ea(t,e){if(t){if("string"==typeof t)return Ra(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ra(t,e):void 0}}function Ra(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ca(t){if(Array.isArray(t))return t}function Ia(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ba(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ma(t,e,n){return e&&Ba(t.prototype,e),n&&Ba(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Aa(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function La(t){return 1===t.length&&"setSource"===t[0].op}var Da=function(){function t(){Ia(this,t),Aa(this,"_undo",[]),Aa(this,"_redo",[]),Aa(this,"_editor",null)}return Ma(t,[{key:"write",value:function(e,n){if(0!==e.length){if(La(e)){var r=e[0],o=this.getLastUndo();if(o&&La(o._batch)){var i=o._batch[0];if(i.args[0]===r.args[0])return i.args[1]=r.args[1],void(o._caretMetaTo=n.after)}}var a=new Fa(e);a._caretMetaFrom=n.before,a._caretMetaTo=n.after,this._undo.push(a),this._undo.length>t.length&&this._undo.splice(0,1),this._redo.length&&(this._redo=[])}}},{key:"getLastUndo",value:function(){return this._undo[this._undo.length-1]}},{key:"undo",value:function(){var t=this._undo.pop();return t&&(t.undo(this._editor),this._redo.push(t)),t}},{key:"redo",value:function(){for(var t=this._redo.pop();t&&t.SKIP_REDO;)t=this._redo.pop();return t&&(t.redo(this._editor),this._undo.push(t)),t}}]),t}();Aa(Da,"length",50);var Fa=function(){function t(e){Ia(this,t),Aa(this,"_batch",[]),Aa(this,"_caretMetaFrom",null),Aa(this,"_caretMetaTo",null),this._batch=e}return Ma(t,[{key:"updateCaretMetaTo",value:function(t){this._caretMetaTo=t}},{key:"undo",value:function(t){this._batch.slice().reverse().forEach((function(e){switch(e.op){case"range":var n=Ta(e.args,2),r=n[0],o=n[1],i=t._range;i.setInitialRange(r),i.setRange(o),i.enable();break;case"setSource":var a=Ta(e.args,3),s=a[0],c=(a[1],a[2]);s.source=c,s.dirty=!0;break;case"setNeedWrap":var u=Ta(e.args,3),l=u[0],f=(u[1],u[2]);l.needWrap=f,l.dirty=!0;break;case"splice":var h=t._flattenTxtElem,p=Ca(g=e.args)||ja(g)||Ea(g)||Pa(),d=p[0],y=(p[1],p.slice(2)),v=e.removed,b=0;y&&(b=y.length),h.splice.apply(h,[d,b].concat(Sa(v)))}var g})),t._caret.fromRange(this._caretMetaFrom)}},{key:"redo",value:function(t){this._batch.forEach((function(e){switch(e.op){case"setSource":var n=Ta(e.args,3),r=n[0],o=n[1];n[2],r.source=o,r.dirty=!0;break;case"setNeedWrap":var i=Ta(e.args,3),a=i[0],s=i[1];i[2],a.needWrap=s,a.dirty=!0;break;case"splice":var c=t._flattenTxtElem;c.splice.apply(c,Sa(e.args))}})),t._caret.fromRange(this._caretMetaTo)}}]),t}();function Ha(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}const za=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._editor=e}var e,n,r;return e=t,r=[{key:"create",value:function(t){return new this(t)}}],(n=[{key:"exec",value:function(){}}])&&Ha(e.prototype,n),r&&Ha(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Wa(t){return Wa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wa(t)}function Na(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Xa(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xa(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xa(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ya(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ga(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function qa(t,e,n){return e&&Ga(t.prototype,e),n&&Ga(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Va(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ua(t,e)}function Ua(t,e){return Ua=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ua(t,e)}function $a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ka(t);if(e){var o=Ka(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ja(this,n)}}function Ja(t,e){if(e&&("object"===Wa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ka(t){return Ka=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ka(t)}function Za(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Qa=function(t){Va(n,t);var e=$a(n);function n(){return Ya(this,n),e.apply(this,arguments)}return qa(n,[{key:"exec",value:function(){var t=this._editor;t._range.disable();var e=t._flattenTxtElem,n=t._caret,r=n.getRow(),o=Na(n.getColumn(),2),i=o[0],a=o[1],s=t._area.get(r),c=s.get(i),u=e.findIndex(c);switch(c.shift(a,-1)){case"prev":if(i>0){var l=s.get(i-1);n.setColumn([i-1,l.tailOffset()])}else if(u>0){var f=r-1,h=t._area.get(f).length()-1,p=e.get(u-1).tailOffset();n.setRow(f),n.setColumn([h,p])}break;case"self":n.setColumn(1,a-1)}n.refresh(),t.syncShadowInputPosition(),t._jflow._render()}}]),n}(za);Za(Qa,"name",Li);var ts=function(t){Va(n,t);var e=$a(n);function n(){return Ya(this,n),e.apply(this,arguments)}return qa(n,[{key:"exec",value:function(){var t=this._editor;t._range.disable();var e=t._flattenTxtElem,n=t._caret,r=n.getRow(),o=Na(n.getColumn(),2),i=o[0],a=o[1],s=t._area.get(r),c=s.get(i),u=e.findIndex(c);switch(c.shift(a,1,u===e.length()-1)){case"next":if(i<s.length()-1){var l=s.get(i+1);"text"===c.type&&"text"!==l.type?n.setColumn([i+2,l.headOffset()]):n.setColumn([i+1,l.headOffset()])}else if(u<e.length()-1){var f=r+1,h=e.get(u+1).headOffset();n.setRow(f),n.setColumn([0,h])}break;case"self":n.setColumn(1,a+1)}n.refresh(),t.syncShadowInputPosition(),t._jflow._render()}}]),n}(za);Za(ts,"name",Di);var es=function(t){Va(n,t);var e=$a(n);function n(){return Ya(this,n),e.apply(this,arguments)}return qa(n,[{key:"exec",value:function(){this._editor._range.disable();var t=this._editor._caret.getRow()-1;t>-1&&this._handler(t)}}]),n}(za);Za(es,"name",Fi);var ns=function(t){Va(n,t);var e=$a(n);function n(){return Ya(this,n),e.apply(this,arguments)}return qa(n,[{key:"exec",value:function(){this._editor._range.disable();var t=this._editor._caret.getRow()+1;t<this._editor._area.length()&&this._handler(t)}}]),n}(za);Za(ns,"name",Hi);var rs={_handler:function(t){var e=this._editor,n=e._caret,r=n.getRow(),o=Na(n.getColumn(),2),i=o[0],a=o[1],s=e._area,c=s.get(r).get(i),u=c.reduceWidth;a>0&&(u+=e.measureTextWidth(c.source.substring(0,a)));var l=s.get(t).getColumnNearest(u,e.elementSpace,e.fontSize,e.fontFamily);n.setRow(t),n.setColumn(l),n.refresh(),e.syncShadowInputPosition(),e._jflow._render()}};function os(t){return os="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},os(t)}function is(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return as(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?as(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function as(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ss(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cs(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function us(t,e){return us=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},us(t,e)}function ls(t,e){if(e&&("object"===os(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return fs(t)}function fs(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hs(t){return hs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},hs(t)}function ps(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ds(t,e,n,r){if(!t)return[n,!1];if("text"===t.type&&"text"===e.type){var o=t.source.length;return t.setSource(t.source+e.source,r),t.setNeedWrap(e.needWrap,r),[o,!0]}return[n,!1]}Object.assign(es.prototype,rs),Object.assign(ns.prototype,rs);var ys=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&us(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=hs(r);if(o){var n=hs(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return ls(this,t)});function a(){var t;ss(this,a);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return ps(fs(t=i.call.apply(i,[this].concat(n))),"cacheIdx",null),t}return e=a,n=[{key:"exec",value:function(t,e){var n=this._editor,r=n._range,o=n._caret,i=n._flattenTxtElem,a=n._undoredo,s=i.startRecord();if(i.recordBeforeCaret(o),r.isEnable()&&(r.delete(n,s),t===Ai||t===Mi))return i.collectRecords(),i.recordAfterCaret(o),this._editor.refresh(),void a.write(s,i.getCaretRecord());var c=o.getRow(),u=is(o.getColumn(),2),l=u[0],f=u[1],h=n._area,p=h.get(c),d=p.get(l),y=p.get(l-1),v="";if("text"===d.type)v=d.source;else if("text"===(null==y?void 0:y.type))d=y,f=(v=y.source).length,o.setColumn([l-1,v.length]);else{var b=new ga("text","");i.insertBefore(d,b),d=b}var g,m=v.substring(0,f);switch(g=this.cacheIdx?v.substring(this.cacheIdx[1]):v.substring(f),t){case Ei:if(/\r?\n/.test(e)){var _=e.split(/\r?\n/);_=_.replace(/\t/,"");var w=i.findIndex(d),k=_.shift();d.setSource(m+k,s);var O=c+1;for(w++;_.length>1;){var x=new ga("text",_.shift());x.setNeedWrap(!0,s),O++,i.inersetAt(w,x),w++}k=_.shift();var S=i.get(w);if(S&&"text"===S.type)S.setSource(k+S.source,s);else{var j=new ga("text",k);i.inersetAt(w,j)}o.setRow(O),o.setColumn([0,k.length])}else m+=e,o.setColumn(1,o.getColumn(1)+e.length),d.setSource(m+g,s);break;case Ri:this.cacheIdx=[m.length,m.length];break;case Ci:m=m.substring(0,this.cacheIdx[0]),m+=e,d.setSource(m+g,s);var T=this.cacheIdx[0]+e.length;o.setColumn(1,T),this.cacheIdx[1]=T;break;case Ii:m=m.substring(0,this.cacheIdx[0]),o.setColumn(1,this.cacheIdx[0]+e.length),this.cacheIdx=null,m+=e,d.setSource(m+g,s);break;case Bi:d.setSource(m,s),d.setNeedWrap(!0,s);var P=new ga("text",g);i.insertAfter(d,P),o.setRow(c+1),o.setColumn([0,0]);break;case Ai:switch(d.shift(f,-1)){case"prev":var E=i.findIndex(d);if(l>0){i.splice(E-1,1),E-=1;var R=is(ds(i.get(E-1),d,0,s),2),C=R[0];R[1]&&i.remove(E),o.setColumn([l-(C>0?2:1),C])}else if(E>0){var I=c-1,B=h.get(I).length()-1,M=is(ds(i.get(E-1),d,0,s),2),A=M[0];M[1]&&i.remove(E),o.setRow(I),o.setColumn([B,A])}break;case"self":m=m.substring(0,m.length-1),o.setColumn(1,o.getColumn(1)-1),d.setSource(m+g,s)}break;case Mi:switch(d.shift(f,1)){case"next":var L=i.findIndex(d);if(l<p.length()-1){i.splice(L+1,1);var D=is(ds(d,i.get(L+1),d.source.length,s),2),F=D[0];D[1]&&i.remove(L+1),o.setColumn([l,F])}else if(L<i.length()-1){var H=is(ds(d,i.get(L+1),d.source.length,s),2),z=H[0];H[1]&&i.remove(L+1),o.setColumn([l,z])}break;case"self":g=g.substring(1),d.setSource(m+g,s)}}i.collectRecords(),i.recordAfterCaret(o),a.write(s,i.getCaretRecord()),this._editor.refresh()}}],n&&cs(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(za);function vs(t){return vs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vs(t)}function bs(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gs(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ms(t,e,n){return e&&gs(t.prototype,e),n&&gs(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ws(t,e)}function ws(t,e){return ws=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ws(t,e)}function ks(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=xs(t);if(e){var o=xs(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Os(this,n)}}function Os(t,e){if(e&&("object"===vs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function xs(t){return xs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},xs(t)}function Ss(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}ps(ys,"name",Ti);var js=function(t){_s(n,t);var e=ks(n);function n(){return bs(this,n),e.apply(this,arguments)}return ms(n,[{key:"exec",value:function(){var t=this._editor;if(this._startEdit()){var e=t._jflow;t.moveCaretByHitPoint(),t.createShadowInput(),t._caret.animate(e),t.syncShadowInputPosition()}}},{key:"_startEdit",value:function(){var t=!0,e=this._editor;return e.dispatchEvent(new ge("edit",{target:e,preventDefault:function(){t=!1}})),t}}]),n}(za);Ss(js,"name",Gi);var Ts=function(t){_s(n,t);var e=ks(n);function n(){return bs(this,n),e.apply(this,arguments)}return ms(n,[{key:"exec",value:function(){var t=this._editor;t.moveCaretByHitPoint(),t._caret.refresh(),t.syncShadowInputPosition(),t._range.disable()}}]),n}(za);Ss(Ts,"name",qi);var Ps=function(t){_s(n,t);var e=ks(n);function n(){return bs(this,n),e.apply(this,arguments)}return ms(n,[{key:"exec",value:function(){var t=this._editor;t.moveCaretByHitPoint();var e=t._caret,n=t._range,r=t._area,o=e.getRow(),i=r.get(o),a=i.length()-1;n.setInitialRange([o,0,0]),n.setRange([o,a,i.tail().tailOffset()]),n.handleCaret(e),n.enable(),t.syncShadowInputPosition()}}]),n}(za);function Es(t){return Es="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Es(t)}function Rs(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Cs(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Is(t,e,n){return e&&Cs(t.prototype,e),n&&Cs(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Bs(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ms(t,e)}function Ms(t,e){return Ms=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ms(t,e)}function As(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ds(t);if(e){var o=Ds(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ls(this,n)}}function Ls(t,e){if(e&&("object"===Es(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ds(t){return Ds=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ds(t)}function Fs(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}Ss(Ps,"name",Ui);var Hs=function(t){Bs(n,t);var e=As(n);function n(){return Rs(this,n),e.apply(this,arguments)}return Is(n,[{key:"exec",value:function(){this._editor._range.setInitialRange(null),this._editor.toggleShift(!1)}}]),n}(za);Fs(Hs,"name",Xi);var zs=function(t){Bs(n,t);var e=As(n);function n(){return Rs(this,n),e.apply(this,arguments)}return Is(n,[{key:"exec",value:function(){var t=this._editor._range,e=this._editor._caret;t.setInitialRange(e.toRange()),this._editor.toggleShift(!0)}}]),n}(za);Fs(zs,"name",Ni);var Ws=function(t){Bs(n,t);var e=As(n);function n(){return Rs(this,n),e.apply(this,arguments)}return Is(n,[{key:"exec",value:function(){var t=this._editor;t.moveCaretByHitPoint();var e=this._editor._caret,n=this._editor._range;n.setRange(e.toRange()),n.enable(),n.handleCaret(e),e.refresh(),t.syncShadowInputPosition()}}]),n}(za);function Ns(t){return Ns="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ns(t)}function Xs(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ys(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Gs(t,e){return Gs=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Gs(t,e)}function qs(t,e){if(e&&("object"===Ns(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Vs(t){return Vs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Vs(t)}Fs(Ws,"name",Vi);var Us,$s,Js,Ks=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gs(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Vs(r);if(o){var n=Vs(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return qs(this,t)});function a(){return Xs(this,a),i.apply(this,arguments)}return e=a,n=[{key:"exec",value:function(){var t=this._editor,e=t._caret,n=t._range,r=t._area,o=r.length()-1,i=r.get(o),a=i.length()-1;n.setInitialRange([0,0,0]),n.setRange([o,a,i.tail().tailOffset()]),n.handleCaret(e),n.enable(),t.syncShadowInputPosition()}}],n&&Ys(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(za);function Zs(t){return Zs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zs(t)}function Qs(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ec(t,e,n){return e&&tc(t.prototype,e),n&&tc(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function nc(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rc(t,e)}function rc(t,e){return rc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},rc(t,e)}function oc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ac(t);if(e){var o=ac(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ic(this,n)}}function ic(t,e){if(e&&("object"===Zs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ac(t){return ac=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ac(t)}function sc(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}Js=Yi,($s="name")in(Us=Ks)?Object.defineProperty(Us,$s,{value:Js,enumerable:!0,configurable:!0,writable:!0}):Us.name=Js;var cc=function(t){nc(n,t);var e=oc(n);function n(){return Qs(this,n),e.apply(this,arguments)}return ec(n,[{key:"exec",value:function(){this._editor._range.disable(),this._editor._undoredo.undo(),this._editor.refresh()}}]),n}(za);sc(cc,"name",zi);var uc=function(t){nc(n,t);var e=oc(n);function n(){return Qs(this,n),e.apply(this,arguments)}return ec(n,[{key:"exec",value:function(){this._editor._range.disable(),this._editor._undoredo.redo(),this._editor.refresh()}}]),n}(za);function lc(t){return lc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lc(t)}function fc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function hc(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?fc(Object(n),!0).forEach((function(e){pc(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fc(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function pc(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function dc(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||vc(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yc(t){return function(t){if(Array.isArray(t))return bc(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||vc(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vc(t,e){if(t){if("string"==typeof t)return bc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bc(t,e):void 0}}function bc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function gc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mc(t,e){return mc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},mc(t,e)}function _c(t,e){if(e&&("object"===lc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return wc(t)}function wc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function kc(t){return kc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},kc(t)}sc(uc,"name",Wi);var Oc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mc(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=kc(r);if(o){var n=kc(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return _c(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t)).initStack(t),e.initLayout(t),e._undoredo=new Da,e._undoredo._editor=wc(e),e._caret=new la,e._range=new xa,e._shadowInput=void 0,e.textColor=t.textColor||"transparent",e.fontFamily=t.fontFamily||"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",e.fontSize=t.fontSize||"28px",e.fontWeight=t.fontWeight||"",e.elementSpace=t.elementSpace||5,e.lineSpace=t.lineSpace||5,e.placeholder=t.placeholder||"请输入",e.placeholderColor=t.placeholderColor||"#eee",e.cursorColor=t.cursorColor||"#60CFC4",e.textRangeColor=t.textRangeColor||"#4E75EC1A",e.minWidth=t.minWidth||0,e.resolver=function(){var e=t.resolver();return 0!==e.length&&"text"===e[e.length-1].type||e.push(new ga("text","")),e},e._area=new ya,e._flattenTxtElem=ba.create(e.resolver()),e._status={editing:!1,dragover:!1},e.commands=new Map,e.registCommand(js),e.registCommand(Ts),e.registCommand(Hs),e.registCommand(zs),e.registCommand(Ws),e.registCommand(ys),e.registCommand(Qa),e.registCommand(ts),e.registCommand(es),e.registCommand(ns),e.registCommand(Ks),e.registCommand(Ps),e.registCommand(cc),e.registCommand(uc),e._makeFunctional(),e}return e=a,n=[{key:"currentLineHeight",get:function(){return this.lineHeight||parseInt(this.fontSize)}},{key:"registCommand",value:function(t){this.commands.has(t.name)||this.commands.set(t.name,t.create(this))}},{key:"_makeFunctional",value:function(){var t=this;this.addEventListener("dblclick",(function(e){e.currentTarget===t&&(e.detail.bubbles=!1,t._status.editing&&t.execCommand(Ui))})),this.addEventListener("click",(function(e){var n;e.currentTarget===t&&(e.detail.bubbles=!1,n=t._status.editing?t._status.shiftOn?Vi:qi:Gi,t.execCommand(n))})),this.addEventListener("blur",(function(e){t._status.editing=!1,t._shadowInput&&t._shadowInput.destroy(),t._belongs&&t._jflow._render(),t.dispatchEvent(new ge("change",{target:t,textElements:t._flattenTxtElem.copy()})),t._range.disable(),t._caret.cancelAnimate()})),this.addEventListener("instancePressStart",(function(e){if(t._status.editing&&!t._status.shiftOn){e.detail.bubbles=!1,e.detail.preventDefault();var n=t._currentp,r=t._positionToCursorOffset(n),o=t._range;o.setInitialRange([r.row].concat(yc(r.column)));var i=e.detail.jflow,a=!1,s=function(e){t._status.editing=!1,a=!0;var n=e.offsetX,r=e.offsetY,s=i._calculatePointBack([n,r]);i._stack.checkHit(s);var c=t._currentp,u=t._positionToCursorOffset(c);o.setRange([u.row].concat(yc(u.column))),o.enable()}.bind(t);document.addEventListener("pointermove",s),document.addEventListener("pointerup",(function(e){document.removeEventListener("pointermove",s),o.setInitialRange(null),a&&(o.handleCaret(t._caret),t._status.editing=!0,t._shadowInput.focus())}),{once:!0})}})),this.addEventListener("dragenter",(function(){t.moveCaretByHitPoint(),t._status.dragover=!0})),this.addEventListener("dragover",(function(){t.moveCaretByHitPoint()})),this.addEventListener("dragleave",(function(){t._status.dragover=!1}));var e=function(e){if(t._status.dragover){e.detail.bubbles=!1,t._status.dragover=!1;var n=t._caret,r=n.getRow(),o=n.getColumn(),i=t._area.get(r),a=dc(o,2),s=a[0],c=a[1],u=i.get(s),l=i.get(s-1),f=t._flattenTxtElem,h=f.findIndex(u);"text"!==u.type&&"text"===(null==l?void 0:l.type)&&(c=l.source.length,h=f.findIndex(l));var p=f.length();t.dispatchEvent(new ge("insert",hc(hc({},e.detail),{},{type:e.type,textElements:f.copy(),idx:h,offset:c}))),f=t._flattenTxtElem,t._status.editing&&(f.length()>p&&n.setColumn([s+f.length()-p,0]),t._shadowInput.focus()),t._status.editing&&t._caret.refresh(),t.syncShadowInputPosition(),t._range.disable()}}.bind(this);this.addEventListener("pressEnd",e),this.addEventListener("drop",e)}},{key:"toggleShift",value:function(t){this._status.shiftOn=t}},{key:"execCommand",value:function(t){this.commands.get(t).exec()}},{key:"createShadowInput",value:function(){var t=this,e=this._jflow;this._shadowInput=new ia(e.DOMwrapper),this._shadowInput.addEventListener(Pi,(function(e){var n=e.detail.kind;t.execCommand(n)})),this._shadowInput.addEventListener(Ti,(function(e){var n=e.detail.kind,r=e.detail.data;t.commands.get(Ti).exec(n,r)})),this._status.editing=!0,e.setFocusInstance(this)}},{key:"moveCaretByHitPoint",value:function(){var t=this._currentp,e=this._caret,n=this._positionToCursorOffset(t),r=n.row,o=n.column;e.setRow(r),e.setColumn(o)}},{key:"refresh",value:function(){this.recalculateUp(),this.syncShadowInputPosition(),this._jflow._render()}},{key:"refreshTextElements",value:function(){this._flattenTxtElem=ba.create(this.resolver())}},{key:"_positionToCursorOffset",value:function(t){var e=dc(t,2),n=e[0],r=e[1],o=this._area,i=n+this.width/2,a=r+this.height/2,s=o.getLineAbove(a);return{row:s,column:o.get(s).getColumnNearest(i,this.elementSpace,this.fontSize,this.fontFamily)}}},{key:"_caretToPosition",value:function(){var t,e=this,n=this._caret.getRow(),r=this._caret.getColumn(),o=this._area.get(n),i=dc(r,2),a=i[0],s=i[1],u=o.get(a),l=this._flattenTxtElem.findIndex(u),f=this._flattenTxtElem.get(l-1),h=this.currentLineHeight/2;if("text"===u.type){var p=u.source.substring(0,s);c((function(n){n.beginPath(),n.font="".concat(e.fontSize," ").concat(e.fontFamily),t=u.anchorX-u.width/2+n.measureText(p).width}))}else t=u.anchorX-u.width/2,h=Math.max(h,u.height/2);return 0===s&&f&&"text"!==f.type&&(h=Math.max(h,f.height/2)),[t,h,o.anchorY,f,u]}},{key:"syncShadowInputPosition",value:function(){if(this._status.editing){var t=dc(this._caretToPosition(),3),e=t[0],n=t[1],r=t[2],o=this.calculateToRealWorld([e,r+n]),i=this._jflow.canvasMeta,a=Math.min(i.actual_width-120,o[0]);this._shadowInput.syncPosition(a,o[1]),this._shadowInput.focus()}}},{key:"render",value:function(t){t.save(),this._isMoving?t.globalAlpha=.6:1!==this.opacity&&(t.globalAlpha=this.opacity);var e=dc(this.anchor,2),n=e[0],r=e[1],o=this._jflow,i=this._area;t.translate(n,r);var a=this._flattenTxtElem;if(a.isEmpty())return t.beginPath(),t.font="".concat(this.fontWeight," ").concat(this.fontSize," ").concat(this.fontFamily),t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.placeholderColor,t.fillText(this.placeholder,0,0),this._randerCursor(t),t.translate(-n,-r),void t.restore();t.beginPath(),t.font="".concat(this.fontWeight," ").concat(this.fontSize," ").concat(this.fontFamily),t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.textColor,i.forEach((function(e){e.forEach((function(e){"text"===e.type&&t.fillText(e.source,e.anchorX,e.anchorY)}))})),a.forEach((function(e){if("text"!==e.type){var n=o.getRenderNodeBySource(e.source);n.visible&&(t.save(),n.render(t),t.restore())}})),this._randerCursor(t),this._renderRange(t),t.translate(-n,-r),t.restore()}},{key:"_randerCursor",value:function(t){if(this._caret.isShow()&&(this._status.editing||this._status.dragover)){var e=dc(this._caretToPosition(),3),n=e[0],r=e[1],o=e[2];t.beginPath(),t.moveTo(n,o-r),t.lineTo(n,o+r),t.lineWidth=2,t.strokeStyle=this.cursorColor,t.stroke()}}},{key:"_renderRange",value:function(t){var e=this._range;if(e.isEnable()){var n=this._area,r=this.textRangeColor,o=this.height,i=this.width,a=this.lineSpace,s=dc(e.getRangeFrom(),3),c=s[0],u=s[1],l=s[2],f=dc(e.getRangeTo(),3),h=f[0],p=f[1],d=f[2];if(c===h){if(u===p&&l==d)return;var y=n.get(c),v=c===n.length()-1?0:a,b=y.reduceHeight-v-y.height-o/2,g=y.height,m=this._measureElementOffsetX(y.get(u),l,t),_=this._measureElementOffsetX(y.get(p),d,t);t.beginPath(),t.rect(m,b,_-m,g),t.fillStyle=r,t.fill()}else for(var w=c,k=!0;w<=h;){var O=n.get(w),x=w===n.length()-1?0:a,S=O.reduceHeight-x-O.height-o/2,j=O.height;if(k){var T=O.get(u),P=this._measureElementOffsetX(T,l,t),E=O.tail(),R=E.anchorX+E.width/2;t.beginPath(),t.rect(P,S,R-P,j),t.fillStyle=r,t.fill()}else if(w===h){var C=O.get(p),I=this._measureElementOffsetX(C,d,t);t.beginPath(),t.rect(-i/2,S,C.reduceWidth+(I-C.anchorX+C.width/2),j),t.fillStyle=r,t.fill()}else t.beginPath(),t.rect(-i/2,S,O.width,j),t.fillStyle=r,t.fill();k=!1,w++}}}},{key:"_measureElementOffsetX",value:function(t,e,n){return"text"!==t.type||0===e?t.anchorX-t.width/2:t.anchorX-t.width/2+n.measureText(t.source.substring(0,e)).width}},{key:"measureTextWidth",value:function(t){var e,n=this;return c((function(r){r.font="".concat(n.fontSize," ").concat(n.fontFamily),e=r.measureText(t).width})),e}},{key:"getBoundingDimension",value:function(){return{width:this.width,height:this.height}}},{key:"getBoundingRect",value:function(){var t=this.anchor,e=this.width/2,n=this.height/2;return[t[0]-e,t[1]-n,t[0]+e,t[1]+n]}},{key:"calculateToCoordination",value:function(t){var e=dc(t,2),n=e[0],r=e[1],o=dc(this.anchor,2),i=[n+o[0],r+o[1]];return this._belongs&&this._belongs.calculateToCoordination?this._belongs.calculateToCoordination(i):i}},{key:"calculateToRealWorld",value:function(t){var e=dc(t,2),n=e[0],r=e[1],o=dc(this.anchor,2),i=[n+o[0],r+o[1]];if(this._belongs&&this._belongs.calculateToRealWorld)return this._belongs.calculateToRealWorld(i)}},{key:"_calculatePointBack",value:function(t){var e=dc(t,2),n=e[0],r=e[1],o=dc(this.anchor,2);return[n-o[0],r-o[1]]}},{key:"isHit",value:function(t,e){var n=this._calculatePointBack(t),r=this._jflow;this._currentp=n;var o=[];this._flattenTxtElem.forEach((function(t){if("text"!==t.type){var e=r.getRenderNodeBySource(t.source);e.visible&&o.push(e)}}));var i=this._stack.checkHit(n,e,(function(t){return o.includes(t)}));if(i)return i;var a=this.anchor,s=this.width/2,c=this.height/2;return t[0]>a[0]-s&&t[0]<a[0]+s&&t[1]>a[1]-c&&t[1]<a[1]+c}},{key:"clone",value:function(){var t=this;return new Wr({width:this.width,height:this.height,cache:function(e){var n=dc(t.anchor,2),r=n[0],o=n[1];e.translate(-r+t.width/2,-o+t.height/2),t.render(e)}})}},{key:"destroy",value:function(){this._jflow._focus.instance===this&&this._jflow.blur()}}],n&&gc(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ot);Object.assign(Oc.prototype,qt),Object.assign(Oc.prototype,Vt),Object.assign(Oc.prototype,{_getBoundingGroupRect:function(){},resetChildrenPosition:function(){},reflow:function(){var t=this,e=this.currentLineHeight,n=this._flattenTxtElem,r=this._area;if(n.isEmpty()){var o=0,i=n.get(0);return c((function(e){e.font="".concat(t.fontSize," ").concat(t.fontFamily),o=e.measureText(t.placeholder).width})),r.truncate({height:e,reduceHeight:e}).insert(0,i),Object.assign(i,{anchorX:-o/2,height:e,isTail:!0}),this.width=o,void(this.height=e)}var a=this._jflow;c((function(e){e.font="".concat(t.fontSize," ").concat(t.fontFamily),n.forEach((function(t){"text"===t.type&&t.dirty&&(t.width=e.measureText(t.source).width,t.dirty=!1)}))}));var s=new ya;s.truncate({height:e});var u=s.get(0),l=0,f=0,h=null,p=this.lineSpace,d=this.elementSpace;n.forEach((function(t){if(u.push(t),t.reduceWidth=u.width,"text"===t.type)t.height=e,u.width+=t.width,t.needWrap&&(l+=u.height+p,u.reduceHeight=l,f=Math.max(u.width,f),u=va.create({height:e}),s.push(u));else{var n=a.getRenderNodeBySource(t.source);t.height=n.height,u.height=Math.max(u.height,n.height);var r=h&&"text"!==h.type?d:2*d;u.width+=n.width+r}h=t})),n.tail().isTail=!0,l+=u.height,u.reduceHeight=l;var y=(f=Math.max(this.minWidth,Math.max(u.width,f)))/2,v=-l/2,b=0;s.forEach((function(t){var e=t.height,n=t.reduceHeight,r=v+b+e/2;t.anchorY=r;var o=-y,i=null;t.forEach((function(t){if("text"===t.type)t.anchorY=r,t.anchorX=o+t.width/2,o+=t.width;else{var e=a.getRenderNodeBySource(t.source),n=!i||"text"===i.type,s=n?2*d:d;t.width=e.width,t.anchorY=r,t.anchorX=o+t.width/2+(n?s/2:0),e.anchor=[t.anchorX,t.anchorY],o+=t.width+s}i=t})),b=n})),this._area=s,this.width=f,this.height=l}});const xc=Oc;function Sc(t){return function(t){if(Array.isArray(t))return jc(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return jc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jc(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Tc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Pc,Ec,Rc,Cc=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._commands=[]}var e,n;return e=t,n=[{key:"addPath",value:function(){throw"not allowed addpath()"}},{key:"closePath",value:function(){this._commands.push((function(t){t.closePath()}))}},{key:"moveTo",value:function(t,e){this._commands.push((function(n,r){n.moveTo.apply(n,Sc(r.multiplyVec([t,e])))}))}},{key:"lineTo",value:function(t,e){this._commands.push((function(n,r){n.lineTo.apply(n,Sc(r.multiplyVec([t,e])))}))}},{key:"bezierCurveTo",value:function(t,e,n,r,o,i){this._commands.push((function(a,s){a.bezierCurveTo.apply(a,Sc(s.multiplyVec([t,e])).concat(Sc(s.multiplyVec([n,r])),Sc(s.multiplyVec([o,i]))))}))}},{key:"quadraticCurveTo",value:function(t,e,n,r){this._commands.push((function(o,i){o.quadraticCurveTo.apply(o,Sc(i.multiplyVec([t,e])).concat(Sc(i.multiplyVec([n,r]))))}))}},{key:"arc",value:function(t,e,n){for(var r=arguments.length,o=new Array(r>3?r-3:0),i=3;i<r;i++)o[i-3]=arguments[i];var a=function(r,i){r.arc.apply(r,Sc(i.multiplyVec([t,e])).concat([i.scaleValue(n)],o))};this._commands.push(a)}},{key:"arcTo",value:function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];var i=function(n,o){n.arcTo.apply(n,Sc(o.multiplyVec([t,e])).concat(r))};this._commands.push(i)}},{key:"rect",value:function(t,e,n,r){this._commands.push((function(o,i){o.rect.apply(o,Sc(i.multiplyVec([t,e])).concat(Sc(i.scaleVec([n,r]))))}))}},{key:"exec",value:function(t,e){this._commands.forEach((function(n){n(t,e)}))}}],n&&Tc(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ic(t){return Ic="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ic(t)}function Bc(t){return function(t){if(Array.isArray(t))return Lc(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Ac(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Mc(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||Ac(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ac(t,e){if(t){if("string"==typeof t)return Lc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Lc(t,e):void 0}}function Lc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Dc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Fc(t,e){if(e&&("object"===Ic(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Hc(t){var e="function"==typeof Map?new Map:void 0;return Hc=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return zc(t,arguments,Xc(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Nc(r,t)},Hc(t)}function zc(t,e,n){return zc=Wc()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&Nc(o,n.prototype),o},zc.apply(null,arguments)}function Wc(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Nc(t,e){return Nc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Nc(t,e)}function Xc(t){return Xc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Xc(t)}Pc=".jfloweditablespan[contenteditable=true]:empty:before{\n        content: attr(placeholder);\n        opacity: 0.5;\n        pointer-events: none;\n        display: block; \n      }",Ec=document.head||document.getElementsByTagName("head")[0],Rc=document.createElement("style"),Ec.appendChild(Rc),Rc.type="text/css",Rc.styleSheet?Rc.styleSheet.cssText=Pc:Rc.appendChild(document.createTextNode(Pc));var Yc=We(un),Gc=We(_n),qc=We(zn),Vc=We(Kn,{shapeShift:function(t,e){return[t+.28865*e,e]}}),Uc=We(or,{shapeShift:function(t,e){return[t,e+.5773*t]}}),$c=We(Rn),Jc=We(Ke,{shapeShift:function(t,e,n){var r=Math.ceil(Math.sqrt(t*t+e*e)/2);n.radius=r;var o=2*r;return[o,o]}}),Kc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nc(t,e)}(s,t);var e,r,o,i,a=(e=s,r=Wc(),function(){var t,n=Xc(e);if(r){var o=Xc(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return Fc(this,t)});function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=a.call(this)).uniqueName="jflow",e.eventAdapter=new Oe(t.eventAdapter),e.initNodeWeakMap(),e.initAnime(),e.initStack(t),e.initLayout(t),e.ctx=null,e.canvas=null,e.dpr=1,e.padding=20,e.position=null,e.scale=null,e.initialZoom=t.initialZoom,e.initialPosition=t.setInitialPosition,e.maxZoom=t.maxZoom||3,e.minZoom=t.minZoom||.5,e.NodeRenderTop=!!t.NodeRenderTop,e.worldMargin=t.worldMargin,e.draggingbehavior=Object.assign({panInBorder:{enable:!0,padding:20,deltamovement:8,allowMovingTargetInPan:!0}},t.draggingbehavior||{}),e.scrollBarBehavior=Object.assign({enable:!0},t.scrollBarBehavior||{}),e.offeset=null,e._lastState={x:null,y:null,dragging:!1,processing:!1},e._lastDragState={target:null,targetLink:null,processing:!1},e._target={instance:null,link:null,moving:null,isInstanceDirty:!1,isLinkDirty:!1,cache:{stack:null,belongs:null,point:null},meta:{x:void 0,y:void 0,initialX:void 0,initialY:void 0},status:{dragovering:!1,dragging:!1,processing:!1,movingState:!1}},e._focus={instance:null},e._dragOverTarget=null,e.allowDrop=t.allowDrop,e._tempNode=null,e._tempLink=null,e.mode=L.DEFAULT,e._allowMovingTarget=!0,e.canvasMeta={},e}return o=s,i=[{key:"setMovingTargets",value:function(t){Object.assign(this._target,{moving:t})}},{key:"setTempDraggingInstance",value:function(t){t._belongs=this,this._tempNode=t,Object.assign(this._target,{moving:[this._tempNode],dragging:!0})}},{key:"removeTempDraggingInstance",value:function(){if(this._tempNode){var t=this._tempNode.anchor;return this._tempNode=null,t}}},{key:"preventDefaultDragging",value:function(){this._allowMovingTarget=!1}},{key:"allowDefaultDragging",value:function(){this._allowMovingTarget=!0}},{key:"$mount",value:function(t){var e=this,r=n(t),o=r.canvas,i=r.ctx,a=r.scale,s=r.width,c=r.height,l=r.raw_width,f=r.raw_height;r.left,r.top,this.reflow(),this.ctx=i,this.DOMwrapper=t,this.canvas=o,this.canvas.setAttribute("data-jflow",!0),this.canvas.$jflow=this,this.canvasMeta={width:l,height:f,actual_width:s,actual_height:c},this.dpr=a,this._getBoundingGroupRect();var h,p=this.padding,d=this.bounding_box,y=d.width,v=d.height,b=d.x,g=d.y,m={x:p,y:p,width:s-2*p,height:c-2*p},_={x:0,y:0,offsetX:0,offsetY:0},w=m.width/y,k=m.height/v,O=w<=k?"x":"y";h=this.initialZoom?this.initialZoom:Math.min(w,k),this.scale=h,h>this.maxZoom&&(this.maxZoom=h),h<this.minZoom&&(this.minZoom=h);var x=b*h,S=g*h,j=m.width,T=m.height;if(this.initialPosition){var P=this.initialPosition(x,S,j,T,m.x,m.y,s,c,b,g,y,v),E=P.x,R=P.y;_.x=E,_.y=R}else _.x="x"===O?m.x:(j-y*h)/2+p,_.y="y"===O?m.y:(T-v*h)/2+p;_.offsetX=_.x-x,_.offsetY=_.y-S,this.position=_,this._readyToRender=!0,this.scrollBarBehavior.enable&&this.initScrollBar(this.scrollBarBehavior),this.initSchedule(),this.scheduleRender((function(){e._createEventHandler()})),u((function(t){e.dpr=t,e.resizeCanvas(),e.scheduleRender()}),(function(t){e.destroyDprListener=t}))}},{key:"setLinkingMode",value:function(t,e,n){var r=this.getRenderNodeBySource(t);this._tempNode=new It,this._tempLink=e(n?{from:this._tempNode,to:r}:{from:r,to:this._tempNode}),this.sendMessage({instance:t}),this.mode=L.LINKING}},{key:"isInLinkingMode",value:function(){return this.mode===L.LINKING}},{key:"setLinkingLink",value:function(t){this.mode===L.LINKING&&this._tempLink.setConfig(t)}},{key:"resetLinkingLink",value:function(){this.mode===L.LINKING&&this._tempLink.setConfig({to:this._tempNode})}},{key:"clearTemp",value:function(){this._tempNode&&(this._tempNode.destroy(),this._tempNode=null),this._tempLink&&(this._tempLink.destroy(),this._tempLink=null),this._render()}},{key:"preventClearTemp",value:function(){this._preventClearTemp=!0}},{key:"resizeCanvas",value:function(){if(this.canvas&&this.DOMwrapper){var t=function(t,e){var n=e.getBoundingClientRect(),r=n.width,o=n.height;n.left,n.top,t.style.width=r+"px",t.style.height=o+"px";var i=window.devicePixelRatio;return t.width=Math.floor(r*i),t.height=Math.floor(o*i),{width:r,height:o,raw_width:t.width,raw_height:t.height}}(this.canvas,this.DOMwrapper),e=t.width,n=t.height,r=t.raw_width,o=t.raw_height;this.canvasMeta={width:r,height:o,actual_width:e,actual_height:n}}}},{key:"setFocusInstance",value:function(t){this._focus.instance=t}},{key:"focusOn",value:function(t){var e=this._calculatePointBack([this.canvasMeta.actual_width/2,this.canvasMeta.actual_height/2]),n=t.anchor;t._belongs.calculateToCoordination&&(n=t._belongs.calculateToCoordination(n));var r=(e[0]-n[0])*this.scale,o=(e[1]-n[1])*this.scale;this._recalculatePosition(r,o),this._render()}},{key:"_getBoundingGroupRect",value:function(){var t=this._stack.getBoundingRectPoints();if(this.bounding_box){this.bounding_box=X(t);var e=this.bounding_box,n=e.x,r=e.y,o=this.scale;this.position.x=this.position.offsetX+n*o,this.position.y=this.position.offsetY+r*o}else this.bounding_box=X(t)}},{key:"_createEventHandler",value:function(){var t,e=this,n=this.canvas;this.eventAdapter.apply(this);var r=function(){e.eventAdapter.unload(e),e.destroyDprListener()};if(t=r,this.allowDrop){var o=this._onDragover.bind(this),i=this._onDrop.bind(this),a=this._onDragLeave.bind(this);n.addEventListener("dragstart",(function(t){t.preventDefault()})),n.addEventListener("dragover",o),n.addEventListener("drop",i),n.addEventListener("dragleave",a),t=function(){r(),n.removeEventListener("dragover",o),n.removeEventListener("drop",i),n.removeEventListener("dragleave",a)}}this.destroy=t}},{key:"_targetLockOn",value:function(t,e){var n=this,r=this._calculatePointBack(t),o=r;this._currentp=r;var i,a=this._stack,s=this._getViewBox(),c=a.checkHit(r,(function(t){return n._target.status.dragging&&t===n._getMovingTarget()}),(function(t){return et(s,t.getBoundingRect())})),u=this._linkStack;if(c&&c._belongs!==this||(i=u.checkHit(r,(function(t){if(!n._target.status.dragging)return!1;var e=n._getMovingTarget();return t.from===e||t.to===e}))),i||(i=u.checkHit(r,(function(t){return!t.ON_TOP}))),Object.assign(this._target,{instance:c,link:i,isInstanceDirty:c===this._target.instance,isLinkDirty:i===this._target.link}),Object.assign(this._target.cache,{stack:a,belongs:this,point:r,topLayerPoint:o}),Object.assign(this._target.meta,{x:t[0],y:t[1]}),"pressStart"===e&&!this._target.status.dragging&&!this._target.status.dragovering){for(var l=c;l&&l._belongs.lock&&l!==this;)l=l._belongs;this.setMovingTargets(l&&[l]),l&&c.bubbleEvent(new ge("afterResolveMovingTarget",{event:e,target:l,jflow:this,bubbles:!0}))}return["pressStart","click","dblclick","contextclick"].includes(e)&&this._focus.instance&&this._focus.instance!==c&&(this._focus.instance.dispatchEvent(new ge("blur",{relatedTarget:c})),this._focus.instance=null),this._target}},{key:"blur",value:function(){this._focus.instance&&(this._focus.instance.dispatchEvent(new ge("blur",{relatedTarget:null})),this._focus.instance=null)}},{key:"_getMovingTarget",value:function(){return this._target.moving&&this._target.moving[0]}},{key:"_processDragOver",value:function(t,e){if(this._dragOverTarget!==t){var n,r=null===(n=this.readMessage())||void 0===n?void 0:n.instance;this._dragCurrentData=r;var o=this._target.cache.point;if(this._dragOverTarget){var i=this._dragOverTarget;i.dispatchEvent(new ge("dragleave",{event:e,instance:i,target:r,jflow:this,point:o}))}t&&t.dispatchEvent(new ge("dragenter",{event:e,instance:t,target:r,jflow:this,point:o})),this._dragOverTarget=t}else this._dragOverTarget&&this._dragOverTarget.dispatchEvent(new ge("dragover",{event:e,instance:t,jflow:this,target:this._dragCurrentData}));this._processPanInBorder()}},{key:"_processPanInBorder",value:function(){var t,e,n=this;if(null!==(t=this.draggingbehavior)&&void 0!==t&&null!==(e=t.panInBorder)&&void 0!==e&&e.enable&&(this.draggingbehavior.panInBorder.timer||(this.draggingbehavior.panInBorder.timer=Date.now()),Date.now()-this.draggingbehavior.panInBorder.timer>500)){var r=Mc(this._cacheViewBox,4),o=r[0],i=r[1],a=r[2],s=r[3],c=Mc(this._currentp,2),u=c[0],l=c[1],f=this.draggingbehavior.panInBorder,h=f.padding,p=f.deltamovement,d=0,y=0;u<o+h&&(d=p),u>a-h&&(d=-p),l<i+h&&(y=p),l>s-h&&(y=-p),this.__processOverAnime&&this.__processOverAnime.cancel(),d||y?this.__processOverAnime=this.requestJFlowAnime((function(){n.panHandler(d,y)})):this.draggingbehavior.panInBorder.timer=null}}},{key:"_onDragover",value:function(t){var e=this;if(t.preventDefault(),t.stopPropagation(),!this._lastDragState.processing){this._lastDragState.processing=!0;var n=t.offsetX,r=t.offsetY;Object.assign(this._target.status,{dragovering:!0}),this._targetLockOn([n,r]);var o=this._target.instance||this._target.link;this._processDragOver(o,t),this._target.isLinkDirty||this._target.isInstanceDirty?Promise.resolve().then((function(){e._render(),e._target.isLinkDirty=!1,e._target.isInstanceDirty=!1,e._lastDragState.processing=!1})):this._lastDragState.processing=!1}}},{key:"_cancelPanInBorder",value:function(){var t;this.__processOverAnime&&this.__processOverAnime.cancel(),null!==(t=this.draggingbehavior)&&void 0!==t&&t.panInBorder&&(this.draggingbehavior.panInBorder.timer=null)}},{key:"_onDragLeave",value:function(){this._cancelPanInBorder()}},{key:"_onDrop",value:function(t){var e=this;this._cancelPanInBorder();var n=this.consumeMessage(),r=null==n?void 0:n.instance;if(this._dragOverTarget){var o=this._dragOverTarget;o.dispatchEvent(new ge("dragoverend",{event:t,instance:o})),this._dragOverTarget=null}var i=this._target,a=i.link,s=i.instance,c=this._target.cache,u=c.point,l=c.belongs;a?a.dispatchEvent(new ge("drop",{event:t,instance:r,link:a,jflow:this,belongs:l,point:u})):s?s.bubbleEvent(new ge("drop",{event:t,instance:r,jflow:this,target:s,point:u,bubbles:!0})):this.dispatchEvent(new ge("drop",{event:t,instance:r,jflow:this,target:s,point:u})),requestAnimationFrame((function(){e.cancelDrop()}))}},{key:"cancelDrop",value:function(){this._target.instance=null,this._target.link=null,Object.assign(this._target.status,{dragovering:!1})}},{key:"zoomHandler",value:function(t,e,n,r,o){var i=this;if(!this._zooming){this._zooming=!0;var a=this.bounding_box,s=a.width,c=a.height,u=(a.x,a.y,this.canvasMeta),l=u.actual_width,f=u.actual_height,h=this.minZoom;if(this.worldMargin){var p=this.worldMargin,d=s+2*p,y=c+2*p;h=Math.max(h,Math.max(l/d,f/y))}var v=this.scale;v*=r>0?1.05:1/1.05;var b=(v=Math.min(this.maxZoom,Math.max(h,v)))-this.scale,g=s*this.scale,m=c*this.scale,_=s*b,w=c*b,k=-(t-this.position.x)/g,O=-(e-this.position.y)/m;this.scale=v,this._recalculatePosition(k*_,O*w),this.dispatchEvent(new ge("zoompan",{deltaX:0,deltaY:0})),this.scheduleRender((function(){i._zooming=!1}))}}},{key:"panHandler",value:function(t,e,n){var r=this;if(!this._panning){if(this._panning=!0,this._target.status.dragging){var o=this._target.moving;o&&this.draggingbehavior.panInBorder.allowMovingTargetInPan&&o.forEach((function(n){n.anchor[0]+=-t/r.scale,n.anchor[1]+=-e/r.scale}))}this._recalculatePosition(t,e),this.dispatchEvent(new ge("zoompan",{deltaX:t,deltaY:e})),this.scheduleRender((function(){r._panning=!1}))}}},{key:"pressStartHandler",value:function(t,e,n){var r=this;if(!this.checkScrollDragging()){Object.assign(this._target.meta,{initialX:t,initialY:e});var o=this._targetLockOn([t,e],"pressStart"),i=o.link,a=o.instance;if(this.mode!==L.LINKING){if(Object.assign(this._target.status,{dragging:!0,processing:!1}),this._target.moving){var s=this._getMovingTarget();s.dispatchEvent(new ge("pressStart",{event:n,instance:s,jflow:this}))}var c=this._resolveLockOnTarget(i,a);c&&c.bubbleEvent(new ge("instancePressStart",{event:n,target:c,jflow:this,bubbles:!0,preventDefault:function(){r._preventPressSequeence=!0,r._clearTarget(),document.addEventListener("pointerup",(function(t){t.preventDefault(),t.stopPropagation(),r._preventPressSequeence=!1}),{once:!0})}})),this._preventPressSequeence||this.dispatchEvent(new ge("jflowPressStart",{event:n,jflow:this}))}}}},{key:"pressMoveHandler",value:function(t,e,n){var r=this;if(!this._preventPressSequeence&&!this.checkScrollDragging()){var o=this._target.status,i=o.dragging,a=o.processing,s=this._target.meta,c=s.x,u=s.y;if(!i){if(this.checkScrollBarHover(t,e))return;this.resetScrollBarHover()}if(!i&&!a){var l=this._targetLockOn([t,e]),f=l.link,h=l.instance,p=this._resolveLockOnTarget(f,h);if(p?p.bubbleEvent(new ge("instancemousemove",{event:n,instance:p,jflow:this,bubbles:!0})):this.dispatchEvent(new ge("instancemousemove",{event:n,instance:null,jflow:this})),this.mode===L.LINKING)return this._tempNode.anchor=this._currentp,this.scheduleRender((function(){r._target.isLinkDirty=!1,r._target.isInstanceDirty=!1,r._target.status.processing=!1})),void this._processPanInBorder()}if(this.dispatchEvent(new ge("canvasmousemove",{event:n,jflow:this})),i&&!a){var d=this._target.moving;this._target.status.movingState=!0,this._target.status.processing=!0;var y=t-c,v=e-u;d?this._allowMovingTarget&&d.forEach((function(t){t.anchor[0]+=y/r.scale,t.anchor[1]+=v/r.scale})):(this._recalculatePosition(y,v),this.dispatchEvent(new ge("zoompan",{deltaX:y,deltaY:v})));var b=this._targetLockOn([t,e]),g=b.instance,m=b.link;this._processDragOver(g||m,n),this.scheduleRender((function(){r._target.isLinkDirty=!1,r._target.isInstanceDirty=!1,r._target.status.processing=!1}))}}}},{key:"pressUpHanlder",value:function(t,e){if(!this._preventPressSequeence){if(this.__processOverAnime&&this.__processOverAnime.cancel(),this._cancelPanInBorder(),this._target.meta,this.mode===L.LINKING){var n=this._target.instance,r=this.consumeMessage(),o=!1,i=function(){o=!0};if(n)n.bubbleEvent(new ge("link",{event:e,target:n,jflow:this,payload:r,bubbles:!0,link:this._tempLink,preventDefault:i}));else{var a=e.offsetX,s=e.offsetY;this.dispatchEvent(new ge("link",{event:e,jflow:this,payload:r,anchor:this._calculatePointBack([a,s]),link:this._tempLink,preventDefault:i}))}if(o)return;return this._clearTarget(),this._preventClearTemp||(this._tempNode&&(this._tempNode.destroy(),this._tempNode=null),this._tempLink&&(this._tempLink.destroy(),this._tempLink=null)),this._preventClearTemp=!1,this.mode=L.DEFAULT,void this._render()}if(this._target.moving){var c=!1;if(this._layout.static&&(c=this.staticCheck(this._getMovingTarget())),!c&&this._target.link){var u=this._target.cache,l=(u.point,u.belongs),f=this._target.link,h=this._getMovingTarget();f.dispatchEvent(new ge("drop",{event:e,instance:h,link:f,jflow:this,belongs:l})),this._target.link=null,this._target.instance=null}this._target.moving&&(this._target.instance?this._target.instance.bubbleEvent(new ge("pressEnd",{event:e,instance:this._getMovingTarget(),jflow:this,target:this._target.instance,bubbles:!0})):this.dispatchEvent(new ge("pressEnd",{event:e,instance:this._getMovingTarget(),jflow:this}))),this._target.moving=null,this.removeTempDraggingInstance(),this._render()}this._clearTarget()}}},{key:"clickHanlder",value:function(t,e,n){var r=this._targetLockOn([t,e],"click"),o=r.link,i=r.instance,a=r.meta;if(Math.abs(a.initialX-a.x)<1&&Math.abs(a.initialY-a.y)<1){if(n.target!==this.canvas)return this._clearTarget(),void Object.assign(this._target.meta,{initialX:void 0,initialY:void 0});var s=this._target.cache.topLayerPoint,c=this._resolveLockOnTarget(o,i);if(c){var u=c;u.bubbleEvent(new ge("click",{event:n,jflow:this,target:u,topLayerPoint:s,bubbles:!0}))}else this.dispatchEvent(new ge("click",{event:n,jflow:this,topLayerPoint:s}));this._clearTarget(),Object.assign(this._target.meta,{initialX:void 0,initialY:void 0})}}},{key:"contextMenuHanlder",value:function(t,e,n){var r=this._targetLockOn([t,e],"contextclick"),o=r.link,i=r.instance,a=this._target.cache.topLayerPoint,s=this._resolveLockOnTarget(o,i);if(s){var c=s;c.bubbleEvent(new ge("contextclick",{event:n,jflow:this,target:c,topLayerPoint:a,bubbles:!0}))}else this.dispatchEvent(new ge("contextclick",{event:n,jflow:this,topLayerPoint:a}))}},{key:"dblclickHandler",value:function(t,e,n){var r=this._targetLockOn([t,e],"dblclick"),o=r.link,i=r.instance,a=this._target.cache.topLayerPoint,s=this._resolveLockOnTarget(o,i);if(s){var c=s;c.bubbleEvent(new ge("dblclick",{event:n,jflow:this,target:c,topLayerPoint:a,bubbles:!0}))}else this.dispatchEvent(new ge("dblclick",{event:n,jflow:this,topLayerPoint:a}))}},{key:"_resolveLockOnTarget",value:function(t,e){return null!=t&&t.ON_TOP?t:e||t}},{key:"_clearTarget",value:function(){Object.assign(this._target.meta,{x:void 0,y:void 0}),Object.assign(this._target.status,{dragging:!1,processing:!1,movingState:!1}),Object.assign(this._target,{instance:null,link:null,moving:null})}},{key:"_recalculatePosition",value:function(t,e,n){var r=this.bounding_box,o=r.x,i=r.y,a=r.width,s=r.height,c=this.canvasMeta,u=c.actual_width,l=c.actual_height;if(void 0===n&&(n=this.scale),this.worldMargin){var f=this.worldMargin,h=(o+a+f)*n-u,p=(o-f)*n,d=o*n,y=this.position.x+t-d;this.position.offsetX=Math.min(Math.max(-h,y),-p),this.position.x=this.position.offsetX+d;var v=(i+s+f)*n-l,b=(i-f)*n,g=i*n,m=this.position.y+e-g;this.position.offsetY=Math.min(Math.max(-v,m),-b),this.position.y=this.position.offsetY+g}else this.position.x+=t,this.position.y+=e,this.position.offsetX=this.position.x-o*n,this.position.offsetY=this.position.y-i*n}},{key:"calculateToRealWorld",value:function(t){var e=this.scale,n=this.position;return[t[0]*e+n.offsetX,t[1]*e+n.offsetY]}},{key:"_calculatePointBack",value:function(t){var e=this.scale,n=this.position;return[(t[0]-n.offsetX)/e,(t[1]-n.offsetY)/e]}},{key:"_calculateDistance",value:function(t){return this.scale*t}},{key:"_resetTransform",value:function(){var t=this.canvasMeta,e=t.width,n=t.height,r=this.position,o=this.scale,i=this.ctx;i.setTransform(),i.clearRect(0,0,e,n),i.scale(this.dpr,this.dpr),i.transform(o,0,0,o,r.offsetX,r.offsetY)}},{key:"resetTransform",value:function(t){var e=this.position,n=this.scale;t.setTransform(),t.scale(this.dpr,this.dpr),t.transform(n,0,0,n,e.offsetX,e.offsetY)}},{key:"_getViewBox",value:function(){var t=[].concat(Bc(this._calculatePointBack([0,0])),Bc(this._calculatePointBack([this.canvasMeta.actual_width,this.canvasMeta.actual_height])));return this._cacheViewBox=t,t}},{key:"setNodeToTopLayer",value:function(t){var e=this._stack.findIndex((function(e){return e===t}));if(-1!==e){var n=Mc(this._stack.splice(e,1),1)[0];this._stack.push(n)}}},{key:"getCacheViewBox",value:function(){return this._cacheViewBox}},{key:"_render",value:function(){this.scheduleRender()}},{key:"__render",value:function(){if(this._readyToRender){this.runAnimeFrame(),this._resetTransform();var t=this.ctx;this.dispatchEvent(new ge("beforeJflowRender",{ctx:t}));var e=this._getViewBox();this._viewBox=e,this.NodeRenderTop?(this._linkStack.render(t,(function(t){return!t.ON_TOP&&t.isInViewBox(e)})),this._stack.render(t,(function(t){var n=et(e,t.getBoundingRect());return t._isInViewBox=n,n})),this._linkStack.render(t,(function(t){return t.ON_TOP&&t.isInViewBox(e)}))):(this._stack.render(t,(function(t){var n=et(e,t.getBoundingRect());return t._isInViewBox=n,n})),this._linkStack.render(t,(function(t){return t.isInViewBox(e)}))),this._tempNode&&(t.save(),this._tempNode.render(t),t.restore()),this._tempLink&&(t.save(),this._tempLink.isInViewBox(e),this._tempLink.render(t),t.restore()),this.dispatchEvent(new ge("afterJflowRender",{ctx:t})),this.renderScrollBar(t)}}}],i&&Dc(o.prototype,i),Object.defineProperty(o,"prototype",{writable:!1}),s}(Hc(EventTarget));Object.assign(Kc.prototype,{_message:null,sendMessage:function(t){this._message=t},consumeMessage:function(){var t=this._message;return this._message=null,t},readMessage:function(){return this._message}}),Object.assign(Kc.prototype,qt),Object.assign(Kc.prototype,Vt),Object.assign(Kc.prototype,At),Object.assign(Kc.prototype,Ut),Object.assign(Kc.prototype,Kt),Object.assign(Kc.prototype,ie),Object.assign(Kc.prototype,re);const Zc=Kc,Qc={provide:function(){return{addToStack:this.addToStack,removeFromStack:this.removeFromStack}},data:function(){return{stack:[]}},methods:{addToStack:function(t,e){this._jflowInstance.addToStack(t),e&&t._jflow.setRenderNodeBySource(e,t)},removeFromStack:function(t){this._jflowInstance.removeFromStack(t)},onStackChangeHandler:function(){this._jflowInstance.recalculate(),this._jflowInstance.reflow()}}};function tu(t){return function(t){if(Array.isArray(t))return ru(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||nu(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eu(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||nu(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nu(t,e){if(t){if("string"==typeof t)return ru(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ru(t,e):void 0}}function ru(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const ou={mixins:[Qc],provide:function(){return{renderJFlow:this.renderJFlow,getJFlow:this.getInstance,addToLinkStack:this.addToLinkStack,removeFromLinkStack:this.removeFromLinkStack}},props:{configs:{type:Object,default:function(){return{}}},loading:Boolean,genVueComponentKey:{type:Function}},data:function(){return{renderNodes:[],renderLinks:[]}},render:function(t){var e=this;if(this.renderNodes.length){var n=this.renderNodes.map((function(t){var n=t.type,r=t.source,o=t.layoutNode;if(!e.$scopedSlots[n]){if(!e.$scopedSlots.jflowcommon)return null;n="jflowcommon"}if(o.__vnode__)return o.__vnode__;var i=eu(e.$scopedSlots[n]({source:r,layoutNode:o}),1)[0];return e.genVueComponentKey&&(i.key=e.genVueComponentKey(r)),o.__vnode__=i,i})).filter((function(t){return!!t})),r=this.renderLinks.map((function(t){var n=t.type||"plainlink";if(!e.$scopedSlots[n])return null;if(t.__vnode__)return t.__vnode__;var r=eu(e.$scopedSlots[n]({configs:t}),1)[0];if(e.genVueComponentKey){var o=e.genVueComponentKey(t.from.source),i=e.genVueComponentKey(t.to.source),a=t.part;r.key="".concat(o,"-").concat(i,"-").concat(a)}return t.__vnode__=r,r}));return t("div",[].concat(tu(n),tu(r)))}return t("div",this.$slots.default)},created:function(){this._jflowInstance=new Zc(this.configs),this.genNodeLinkMeta(),this.loadingNodes()},beforeDestroy:function(){var t;null===(t=this._jflowInstance)||void 0===t||t.destroy()},methods:{loadingNodes:function(){var t=this;this.$emit("update:loading",!0);var e=0,n=function n(){var r=e+100,o=t.links.slice(e,r);o.length?(t.renderLinks=t.renderLinks.concat(o),e=r,requestAnimationFrame(n)):requestAnimationFrame(t.mountJFlow.bind(t))};requestAnimationFrame((function r(){var o=e+100,i=t.nodes.slice(e,o);i.length?(t.renderNodes=t.renderNodes.concat(i),e=o,requestAnimationFrame(r)):(e=0,requestAnimationFrame(n))}))},mountJFlow:function(){var t=this;this._jflowInstance.$mount(this.$el),Object.keys(this.$listeners).map((function(e){var n=t.$listeners[e].bind(t);t._jflowInstance.addEventListener(e,n)})),this.$emit("update:loading",!1)},genNodeLinkMeta:function(){var t=this;this.nodes=this._jflowInstance._layout.flowStack.map((function(e){e.type;var n=e.layoutNode,r=e.source,o=t._jflowInstance.source_Layout_Render_NodeMap;return(o.has(r)?o.get(r):o.set(r)).layoutNode=n,e})),this.links=this._jflowInstance._layout.flowLinkStack.slice()},syncNodeLink:function(){this.renderNodes=this.nodes.slice(),this.renderLinks=this.links.slice()},reflow:function(t,e){var n=this;this.genNodeLinkMeta(),this.syncNodeLink(),this.$nextTick((function(){t&&t(),n._jflowInstance.recalculate(),n._jflowInstance.scheduleRender((function(){e&&e()}))}))},getInstance:function(){return this._jflowInstance},renderJFlow:function(){var t=this;this.__renderInSchedule__||(this.__renderInSchedule__=!0,this.$nextTick((function(){t._jflowInstance._render(),t.__renderInSchedule__=!1})))},addToLinkStack:function(t,e,n){this._jflowInstance.addToLinkStack(t),e&&n&&t._jflow.addLinkNodeBySource(e,n,t)},removeFromLinkStack:function(t,e,n){this._jflowInstance.removeFromLinkStack(t),e&&n&&t._jflow.removeLinkNodeBySource(e,n,t)}}};var iu=r(359),au=r.n(iu);function su(t){var n="string"==typeof t?e[t]:t;return{inject:["addToStack","removeFromStack"],props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},source:{type:Object}},watch:{configs:function(t,e){var n=au()(t,e);0!==Object.keys(n).length&&this._jflowInstance.setConfig(t)},$listeners:function(t,e){var n=this,r=[],o=[],i=Object.keys(t).map((function(e){return{event:e,handler:t[e]}})),a=Object.keys(e).map((function(t){return{event:t,handler:e[t]}}));i.forEach((function(t){var e=t.handler;a.find((function(t){return t.handler===e}))||r.push(t)})),a.forEach((function(t){var e=t.handler;i.find((function(t){return t.handler===e}))||o.push(t)})),r.forEach((function(t){n._jflowInstance.addEventListener(t.event,t.handler)})),o.forEach((function(t){n._jflowInstance.removeEventListener(t.event,t.handler)}))},visible:function(t){this._jflowInstance.visible=t},source:function(t){this._jflowInstance._jflow.setRenderNodeBySource(t,this._jflowInstance)}},render:function(t){return null},created:function(){this._jflowInstance=new n(this.configs),this._jflowInstance.visible=this.visible,this.bindListeners(),this.addToStack(this._jflowInstance,this.source)},destroyed:function(){this._jflowInstance.destroy(),this.removeFromStack(this._jflowInstance)},methods:{bindListeners:function(){var t=this;Object.keys(this.$listeners).map((function(e){var n=t.$listeners[e];t._jflowInstance.addEventListener(e,n)}))}}}}function cu(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function uu(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?cu(Object(n),!0).forEach((function(e){lu(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):cu(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function lu(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function fu(t,n){var r="string"==typeof t?e[t]:t;return{inject:["addToLinkStack","removeFromLinkStack","getJFlow"],props:{configs:{type:Object,default:function(){return{}}},from:Object,to:Object},render:function(t){return null},created:function(){var t=this.getJFlow(),e=t.getRenderNodeBySource(this.from),n=t.getRenderNodeBySource(this.to);this.createInstance(e,n)},mounted:function(){var t=this;this.unwatch=this.$watch((function(){return[t.from,t.to,t.configs]}),(function(){t.refreshConfig()}))},methods:{createInstance:function(t,e){t&&e&&(this._jflowInstance=new r(uu(uu({},this.configs),{},{from:t,to:e})),this.bindListeners(),this.addToLinkStack(this._jflowInstance,this.from,this.to))},refreshConfig:function(){var t=this.getJFlow(),e=t.getRenderNodeBySource(this.from),n=t.getRenderNodeBySource(this.to);this._jflowInstance?this._jflowInstance.setConfig(uu(uu({},this.configs),{},{from:e,to:n})):this.createInstance(e,n)},bindListeners:function(){var t=this;Object.keys(this.$listeners).map((function(e){var n=t.$listeners[e];t._jflowInstance.addEventListener(e,n)}))}},destroyed:function(){this.unwatch(),this._jflowInstance&&this.removeFromLinkStack(this._jflowInstance,this.from,this.to)}}}function hu(t){var n="string"==typeof t?e[t]:t;return{mixins:[Qc],inject:{addToBelongStack:{from:"addToStack"},removeFromBelongStack:{from:"removeFromStack"},renderJFlow:{from:"renderJFlow"}},render:function(t){return t("jflow-group",this.$slots.default)},props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},source:{type:Object}},watch:{configs:function(t,e){JSON.stringify(t)!==JSON.stringify(e)&&this._jflowInstance.setConfig(t)},$listeners:function(t,e){var n=this,r=[],o=[],i=Object.keys(t).map((function(e){return{event:e,handler:t[e]}})),a=Object.keys(e).map((function(t){return{event:t,handler:e[t]}}));i.forEach((function(t){var e=t.handler;a.find((function(t){return t.handler===e}))||r.push(t)})),a.forEach((function(t){var e=t.handler;i.find((function(t){return t.handler===e}))||o.push(t)})),r.forEach((function(t){n._jflowInstance.addEventListener(t.event,t.handler)})),o.forEach((function(t){n._jflowInstance.removeEventListener(t.event,t.handler)}))},visible:function(t){this._jflowInstance.visible=t},source:function(t){this._jflowInstance._jflow.setRenderNodeBySource(t,this._jflowInstance)}},created:function(){var t=this;this._jflowInstance=new n(this.configs),this._jflowInstance.visible=this.visible,Object.keys(this.$listeners).map((function(e){var n=t.$listeners[e].bind(t);t._jflowInstance.addEventListener(e,n)})),this.addToBelongStack(this._jflowInstance,this.source)},mounted:function(){this._jflowInstance.recalculate()},updated:function(){this._jflowInstance.recalculateUp()},destroyed:function(){this._jflowInstance.destroy(),this.removeFromBelongStack(this._jflowInstance)}}}function pu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const du={mixins:[Qc],inject:{addToBelongStack:{from:"addToStack"},removeFromBelongStack:{from:"removeFromStack"},renderJFlow:{from:"renderJFlow"}},data:function(){return{nodes:[]}},props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},source:{type:Object},genVueComponentKey:{type:Function}},watch:{configs:function(t,e){JSON.stringify(t)!==JSON.stringify(e)&&this._jflowInstance.setConfig(t)},$listeners:function(t,e){var n=this,r=[],o=[],i=Object.keys(t).map((function(e){return{event:e,handler:t[e]}})),a=Object.keys(e).map((function(t){return{event:t,handler:e[t]}}));i.forEach((function(t){var e=t.handler;a.find((function(t){return t.handler===e}))||r.push(t)})),a.forEach((function(t){var e=t.handler;i.find((function(t){return t.handler===e}))||o.push(t)})),r.forEach((function(t){n._jflowInstance.addEventListener(t.event,t.handler)})),o.forEach((function(t){n._jflowInstance.removeEventListener(t.event,t.handler)}))},visible:function(t){this._jflowInstance.visible=t},source:function(t){this._jflowInstance._jflow.setRenderNodeBySource(t,this._jflowInstance)}},created:function(){var t=this;this._jflowInstance=new xc(this.configs),this._jflowInstance.visible=this.visible,Object.keys(this.$listeners).map((function(e){var n=t.$listeners[e].bind(t);t._jflowInstance.addEventListener(e,n)})),this.addToBelongStack(this._jflowInstance,this.source),this.genTextElementMeta()},mounted:function(){this._jflowInstance.recalculate()},updated:function(){this._jflowInstance.recalculateUp()},destroyed:function(){this._jflowInstance.destroy(),this.removeFromBelongStack(this._jflowInstance)},render:function(t){var e=this;return this.nodes.length?t("div",this.nodes.map((function(t){var n=t.type,r=t.source;if(!e.$scopedSlots[n]){if(!e.$scopedSlots.jflowcommon)return;n="jflowcommon"}if(t.__vnode__)return t.__vnode__;var o,i,a=(o=e.$scopedSlots[n]({source:r,textElement:t}),i=1,function(t){if(Array.isArray(t))return t}(o)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(o,i)||function(t,e){if(t){if("string"==typeof t)return pu(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pu(t,e):void 0}}(o,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0];return e.genVueComponentKey&&(a.key=e.genVueComponentKey(r)),t.__vnode__=a,a}))):t("jflow-group",this.$slots.default)},methods:{genTextElementMeta:function(){this.nodes=this._jflowInstance._flattenTxtElem.filter((function(t){return"text"!==t.type}))},reflow:function(){var t=this;this._jflowInstance.refreshTextElements(),this.genTextElementMeta(),this.$nextTick((function(){t._jflowInstance.refresh()}))}}};function yu(t){return function(t){if(Array.isArray(t))return bu(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||vu(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vu(t,e){if(t){if("string"==typeof t)return bu(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bu(t,e):void 0}}function bu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function gu(t){return{mixins:[Qc],inject:{addToBelongStack:{from:"addToStack"},removeFromBelongStack:{from:"removeFromStack"},renderJFlow:{from:"renderJFlow"}},render:function(t){var e=this,n=this.renderLinks.map((function(t){var n=t.type||"plainlink";if(!e.$scopedSlots[n])return null;if(t.__vnode__)return t.__vnode__;var r,o,i=(r=e.$scopedSlots[n]({configs:t}),o=1,function(t){if(Array.isArray(t))return t}(r)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(r,o)||vu(r,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0];if(e.genVueComponentKey){var a=e.genVueComponentKey(t.from.source),s=e.genVueComponentKey(t.to.source),c=t.part;i.key="".concat(a,"-").concat(s,"-").concat(c)}return t.__vnode__=i,i}));return t("jflow-group",[].concat(yu(this.$slots.default),yu(n)))},props:{configs:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!0},source:{type:Object}},data:function(){return{renderLinks:[]}},watch:{configs:function(t,e){JSON.stringify(t)!==JSON.stringify(e)&&this._jflowInstance.setConfig(t)},$listeners:function(t,e){var n=this,r=[],o=[],i=Object.keys(t).map((function(e){return{event:e,handler:t[e]}})),a=Object.keys(e).map((function(t){return{event:t,handler:e[t]}}));i.forEach((function(t){var e=t.handler;a.find((function(t){return t.handler===e}))||r.push(t)})),a.forEach((function(t){var e=t.handler;i.find((function(t){return t.handler===e}))||o.push(t)})),r.forEach((function(t){n._jflowInstance.addEventListener(t.event,t.handler)})),o.forEach((function(t){n._jflowInstance.removeEventListener(t.event,t.handler)}))},visible:function(t){this._jflowInstance.visible=t},source:function(t){this._jflowInstance._jflow.setRenderNodeBySource(t,this._jflowInstance)}},created:function(){var e=this;this._jflowInstance=new t(this.configs),this._jflowInstance.visible=this.visible,Object.keys(this.$listeners).map((function(t){var n=e.$listeners[t].bind(e);e._jflowInstance.addEventListener(t,n)})),this.addToBelongStack(this._jflowInstance,this.source),this.genLinks()},mounted:function(){this._jflowInstance.recalculate()},updated:function(){this._jflowInstance.recalculateUp()},destroyed:function(){this._jflowInstance.destroy(),this.removeFromBelongStack(this._jflowInstance)},methods:{genLinks:function(){this.renderLinks=this._jflowInstance._layout.flowLinkStack.slice()}}}}function mu(t){return mu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mu(t)}function _u(t,e){if(e&&("object"===mu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function wu(t){var e="function"==typeof Map?new Map:void 0;return wu=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return ku(t,arguments,Su(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),xu(r,t)},wu(t)}function ku(t,e,n){return ku=Ou()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&xu(o,n.prototype),o},ku.apply(null,arguments)}function Ou(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function xu(t,e){return xu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},xu(t,e)}function Su(t){return Su=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Su(t)}function ju(t){return function(t){if(Array.isArray(t))return Tu(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Tu(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tu(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Pu=[{name:"Jflow",component:ou},{name:"Group",component:hu("Group")}].concat(ju(["CapsuleGroup","CapsuleVerticalGroup","DiamondGroup","DiamondVerticalGroup","RhombusGroup","PointGroup","ScrollGroup"].map((function(t){return{name:t,component:hu(t)}}))),ju(["Point","Rectangle","Capsule","Diamond","Rhombus","Text","Icon","ShadowDom","TextEditor"].map((function(t){return{name:t,component:su(t)}}))),ju(["Link","PolyLink","BezierLink"].map((function(t){return{name:t,component:fu(t)}}))),[{name:"TextGroup",component:du}]);customElements.define("jflow-group",function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xu(t,e)}(i,t);var e,n,r,o=(e=i,n=Ou(),function(){var t,r=Su(e);if(n){var o=Su(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return _u(this,t)});function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this)).attachShadow({mode:"open"}),t}return r=i,Object.defineProperty(r,"prototype",{writable:!1}),r}(wu(HTMLElement)));const Eu={install:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="j";e&&e.prefix&&(n=e.prefix),Pu.forEach((function(e){t.component("".concat(n).concat(e.name),e.component)})),e.customInstance&&Object.keys(e.customInstance).forEach((function(r){t.component("".concat(n).concat(r),su(e.customInstance[r]))})),e.customGroups&&Object.keys(e.customGroups).forEach((function(r){t.component("".concat(n).concat(r),hu(e.customGroups[r]))})),e.customLink&&Object.keys(e.customLink).forEach((function(r){t.component("".concat(n).concat(r),fu(e.customLink[r]))}))}};var Ru=r(147);const Cu=Zc;window.$jflow_version=Ru.version})(),o})()}));