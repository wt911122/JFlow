{"version":3,"file":"jflow.es.min.js","sources":["../src/core/utils/canvas.js","../node_modules/bezier-js/src/utils.js","../node_modules/bezier-js/src/poly-bezier.js","../node_modules/bezier-js/src/bezier.js","../src/core/utils/constance.js","../src/core/utils/functions.js","../src/core/instance/instance.js","../src/core/instance/node.js","../src/core/instance/ghostNode.js","../src/core/instance/nodeWeakMap.js","../src/core/instance/stack.js","../src/core/instance/stackMixin.js","../src/core/instance/layoutMixin.js","../src/core/instance/messageMixin.js","../src/core/anime/animeMixin.js","../src/core/miniMap/minimap-mixin.js","../src/core/scrollbar/scrollbarMixin.js","../src/core/flow/schedule.js","../src/core/events/index.js","../src/core/events/adapter.js","../src/core/instance/groupFactory.js","../src/core/instance/shapes/point.js","../src/core/instance/shapes/rectangle.js","../src/core/instance/shapes/capsule.js","../src/core/instance/shapes/capsule-vertical.js","../src/core/instance/shapes/rhombus.js","../src/core/instance/shapes/diamond.js","../src/core/instance/groups/scroll-group.js","../src/core/events/commonAdapter.js","../src/core/instance/base-link.js","../src/core/instance/shapes/shadow-cache.js","../src/core/instance/elements/text.js","../src/core/instance/image.js","../src/core/instance/shadowDom.js","../src/core/instance/link.js","../src/core/instance/poly-link.js","../src/core/instance/bezier-link.js","../src/core/layout/linear-layout.js","../src/core/layout/low-code-types/baseNode.js","../src/core/layout/low-code-layout.js","../src/core/layout/er-layout/er-node.js","../src/core/layout/er-layout/er-layout.js","../src/core/instance/text-group/base/constants.js","../src/core/instance/text-group/base/shadow-input.js","../src/core/instance/text-group/base/caret.js","../src/core/instance/text-group/storage/index.js","../src/core/instance/text-group/utils.js","../src/core/instance/text-group/base/range.js","../src/core/instance/text-group/undoredo.js","../src/core/instance/text-group/command/base.js","../src/core/instance/text-group/command/movement.js","../src/core/instance/text-group/command/input.js","../src/core/instance/text-group/command/mouse.js","../src/core/instance/text-group/command/shift.js","../src/core/instance/text-group/command/ctrl.js","../src/core/instance/text-group/command/undoredo.js","../src/core/instance/text-group/text-group.js","../src/core/instance/text.js","../src/core/flow/index.js","../src/core/instance/shapes/diamond-vertical.js","../src/index.js"],"sourcesContent":["\n/**\n * @typedef {Object} CanvasMeta\n * @property {Element} canvas - canvas 元素\n * @property {number} width - 画布宽度\n * @property {number} height - 画布高度\n * @property {number} raw_width - 画布元素宽度\n * @property {number} raw_height - 画布元素高度\n * @property {number} left - 画布距离左端距离\n * @property {number} top - 画布距离顶端距离\n * @property {Context2d} ctx - Context2d\n * @property {number} scale - 当前的像素设备比\n */\n/**\n * 创建一个 canvas 元素\n * @param  {Element} wrapper - dom元素\n * @return {CanvasMeta}\n */\nexport function createCanvas(wrapper) {\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    const { width, height, left, top } = wrapper.getBoundingClientRect();\n    canvas.style.width = width + \"px\";\n    canvas.style.height = height + \"px\";\n    canvas.style.userSelect = 'none';\n    const scale = window.devicePixelRatio;\n    canvas.width = Math.floor(width * scale);\n    canvas.height = Math.floor(height * scale);\n\n    if(wrapper) {\n        wrapper.style.position = 'relative';\n        wrapper.style.overflow = 'hidden';\n        wrapper.append(canvas);\n    }\n    return {\n        canvas,\n        width,\n        height,\n        raw_width: canvas.width,\n        raw_height: canvas.height,\n        left,\n        top,\n        ctx,\n        scale,\n    }\n}\n\nexport function resizeCanvas(canvas, wrapper) {\n    const { width, height, left, top } = wrapper.getBoundingClientRect();\n    canvas.style.width = width + \"px\";\n    canvas.style.height = height + \"px\";\n    const scale = window.devicePixelRatio;\n    canvas.width = Math.floor(width * scale);\n    canvas.height = Math.floor(height * scale);\n    return {\n        width,\n        height,\n        raw_width: canvas.width,\n        raw_height: canvas.height,\n    }\n}\n\nconst caheCanvas = document.createElement('canvas');\ncaheCanvas.width = 1;\ncaheCanvas.height = 1;\nconst caheCanvasctx = caheCanvas.getContext('2d');\nconst scale = window.devicePixelRatio;\ncaheCanvasctx.scale(scale, scale);\n\n/**\n * 在离线canvas上绘制元素\n * @param  {render} render - 绘图函数\n */\nexport function requestCacheCanvas(render) {\n    caheCanvasctx.clearRect(0,0,5,5);\n    caheCanvasctx.save();\n    render(caheCanvasctx);\n    caheCanvasctx.restore();\n    caheCanvasctx.clearRect(0,0,5,5);\n}\n\nexport function listenOnDevicePixelRatio(callback, destroyHandler) {\n    const target = matchMedia(\n        `(resolution: ${window.devicePixelRatio}dppx)`\n    );\n    function onChange() {\n      console.log(\"devicePixelRatio changed: \" + window.devicePixelRatio);\n      callback(window.devicePixelRatio);\n      listenOnDevicePixelRatio(callback, destroyHandler);\n    }\n    destroyHandler(() => {\n        console.log('remove devicePixelRatio event handler')\n        target.removeEventListener(\"change\", onChange, { once: true });\n    })\n    target.addEventListener(\"change\", onChange, { once: true });\n}","import { Bezier } from \"./bezier.js\";\n\n// math-inlining.\nconst { abs, cos, sin, acos, atan2, sqrt, pow } = Math;\n\n// cube root function yielding real roots\nfunction crt(v) {\n  return v < 0 ? -pow(-v, 1 / 3) : pow(v, 1 / 3);\n}\n\n// trig constants\nconst pi = Math.PI,\n  tau = 2 * pi,\n  quart = pi / 2,\n  // float precision significant decimal\n  epsilon = 0.000001,\n  // extremas used in bbox calculation and similar algorithms\n  nMax = Number.MAX_SAFE_INTEGER || 9007199254740991,\n  nMin = Number.MIN_SAFE_INTEGER || -9007199254740991,\n  // a zero coordinate, which is surprisingly useful\n  ZERO = { x: 0, y: 0, z: 0 };\n\n// Bezier utility functions\nconst utils = {\n  // Legendre-Gauss abscissae with n=24 (x_i values, defined at i=n as the roots of the nth order Legendre polynomial Pn(x))\n  Tvalues: [\n    -0.0640568928626056260850430826247450385909,\n    0.0640568928626056260850430826247450385909,\n    -0.1911188674736163091586398207570696318404,\n    0.1911188674736163091586398207570696318404,\n    -0.3150426796961633743867932913198102407864,\n    0.3150426796961633743867932913198102407864,\n    -0.4337935076260451384870842319133497124524,\n    0.4337935076260451384870842319133497124524,\n    -0.5454214713888395356583756172183723700107,\n    0.5454214713888395356583756172183723700107,\n    -0.6480936519369755692524957869107476266696,\n    0.6480936519369755692524957869107476266696,\n    -0.7401241915785543642438281030999784255232,\n    0.7401241915785543642438281030999784255232,\n    -0.8200019859739029219539498726697452080761,\n    0.8200019859739029219539498726697452080761,\n    -0.8864155270044010342131543419821967550873,\n    0.8864155270044010342131543419821967550873,\n    -0.9382745520027327585236490017087214496548,\n    0.9382745520027327585236490017087214496548,\n    -0.9747285559713094981983919930081690617411,\n    0.9747285559713094981983919930081690617411,\n    -0.9951872199970213601799974097007368118745,\n    0.9951872199970213601799974097007368118745,\n  ],\n\n  // Legendre-Gauss weights with n=24 (w_i values, defined by a function linked to in the Bezier primer article)\n  Cvalues: [\n    0.1279381953467521569740561652246953718517,\n    0.1279381953467521569740561652246953718517,\n    0.1258374563468282961213753825111836887264,\n    0.1258374563468282961213753825111836887264,\n    0.121670472927803391204463153476262425607,\n    0.121670472927803391204463153476262425607,\n    0.1155056680537256013533444839067835598622,\n    0.1155056680537256013533444839067835598622,\n    0.1074442701159656347825773424466062227946,\n    0.1074442701159656347825773424466062227946,\n    0.0976186521041138882698806644642471544279,\n    0.0976186521041138882698806644642471544279,\n    0.086190161531953275917185202983742667185,\n    0.086190161531953275917185202983742667185,\n    0.0733464814110803057340336152531165181193,\n    0.0733464814110803057340336152531165181193,\n    0.0592985849154367807463677585001085845412,\n    0.0592985849154367807463677585001085845412,\n    0.0442774388174198061686027482113382288593,\n    0.0442774388174198061686027482113382288593,\n    0.0285313886289336631813078159518782864491,\n    0.0285313886289336631813078159518782864491,\n    0.0123412297999871995468056670700372915759,\n    0.0123412297999871995468056670700372915759,\n  ],\n\n  arcfn: function (t, derivativeFn) {\n    const d = derivativeFn(t);\n    let l = d.x * d.x + d.y * d.y;\n    if (typeof d.z !== \"undefined\") {\n      l += d.z * d.z;\n    }\n    return sqrt(l);\n  },\n\n  compute: function (t, points, _3d) {\n    // shortcuts\n    if (t === 0) {\n      points[0].t = 0;\n      return points[0];\n    }\n\n    const order = points.length - 1;\n\n    if (t === 1) {\n      points[order].t = 1;\n      return points[order];\n    }\n\n    const mt = 1 - t;\n    let p = points;\n\n    // constant?\n    if (order === 0) {\n      points[0].t = t;\n      return points[0];\n    }\n\n    // linear?\n    if (order === 1) {\n      const ret = {\n        x: mt * p[0].x + t * p[1].x,\n        y: mt * p[0].y + t * p[1].y,\n        t: t,\n      };\n      if (_3d) {\n        ret.z = mt * p[0].z + t * p[1].z;\n      }\n      return ret;\n    }\n\n    // quadratic/cubic curve?\n    if (order < 4) {\n      let mt2 = mt * mt,\n        t2 = t * t,\n        a,\n        b,\n        c,\n        d = 0;\n      if (order === 2) {\n        p = [p[0], p[1], p[2], ZERO];\n        a = mt2;\n        b = mt * t * 2;\n        c = t2;\n      } else if (order === 3) {\n        a = mt2 * mt;\n        b = mt2 * t * 3;\n        c = mt * t2 * 3;\n        d = t * t2;\n      }\n      const ret = {\n        x: a * p[0].x + b * p[1].x + c * p[2].x + d * p[3].x,\n        y: a * p[0].y + b * p[1].y + c * p[2].y + d * p[3].y,\n        t: t,\n      };\n      if (_3d) {\n        ret.z = a * p[0].z + b * p[1].z + c * p[2].z + d * p[3].z;\n      }\n      return ret;\n    }\n\n    // higher order curves: use de Casteljau's computation\n    const dCpts = JSON.parse(JSON.stringify(points));\n    while (dCpts.length > 1) {\n      for (let i = 0; i < dCpts.length - 1; i++) {\n        dCpts[i] = {\n          x: dCpts[i].x + (dCpts[i + 1].x - dCpts[i].x) * t,\n          y: dCpts[i].y + (dCpts[i + 1].y - dCpts[i].y) * t,\n        };\n        if (typeof dCpts[i].z !== \"undefined\") {\n          dCpts[i] = dCpts[i].z + (dCpts[i + 1].z - dCpts[i].z) * t;\n        }\n      }\n      dCpts.splice(dCpts.length - 1, 1);\n    }\n    dCpts[0].t = t;\n    return dCpts[0];\n  },\n\n  computeWithRatios: function (t, points, ratios, _3d) {\n    const mt = 1 - t,\n      r = ratios,\n      p = points;\n\n    let f1 = r[0],\n      f2 = r[1],\n      f3 = r[2],\n      f4 = r[3],\n      d;\n\n    // spec for linear\n    f1 *= mt;\n    f2 *= t;\n\n    if (p.length === 2) {\n      d = f1 + f2;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y) / d,\n        z: !_3d ? false : (f1 * p[0].z + f2 * p[1].z) / d,\n        t: t,\n      };\n    }\n\n    // upgrade to quadratic\n    f1 *= mt;\n    f2 *= 2 * mt;\n    f3 *= t * t;\n\n    if (p.length === 3) {\n      d = f1 + f2 + f3;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y) / d,\n        z: !_3d ? false : (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z) / d,\n        t: t,\n      };\n    }\n\n    // upgrade to cubic\n    f1 *= mt;\n    f2 *= 1.5 * mt;\n    f3 *= 3 * mt;\n    f4 *= t * t * t;\n\n    if (p.length === 4) {\n      d = f1 + f2 + f3 + f4;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x + f4 * p[3].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y + f4 * p[3].y) / d,\n        z: !_3d\n          ? false\n          : (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z + f4 * p[3].z) / d,\n        t: t,\n      };\n    }\n  },\n\n  derive: function (points, _3d) {\n    const dpoints = [];\n    for (let p = points, d = p.length, c = d - 1; d > 1; d--, c--) {\n      const list = [];\n      for (let j = 0, dpt; j < c; j++) {\n        dpt = {\n          x: c * (p[j + 1].x - p[j].x),\n          y: c * (p[j + 1].y - p[j].y),\n        };\n        if (_3d) {\n          dpt.z = c * (p[j + 1].z - p[j].z);\n        }\n        list.push(dpt);\n      }\n      dpoints.push(list);\n      p = list;\n    }\n    return dpoints;\n  },\n\n  between: function (v, m, M) {\n    return (\n      (m <= v && v <= M) ||\n      utils.approximately(v, m) ||\n      utils.approximately(v, M)\n    );\n  },\n\n  approximately: function (a, b, precision) {\n    return abs(a - b) <= (precision || epsilon);\n  },\n\n  length: function (derivativeFn) {\n    const z = 0.5,\n      len = utils.Tvalues.length;\n\n    let sum = 0;\n\n    for (let i = 0, t; i < len; i++) {\n      t = z * utils.Tvalues[i] + z;\n      sum += utils.Cvalues[i] * utils.arcfn(t, derivativeFn);\n    }\n    return z * sum;\n  },\n\n  map: function (v, ds, de, ts, te) {\n    const d1 = de - ds,\n      d2 = te - ts,\n      v2 = v - ds,\n      r = v2 / d1;\n    return ts + d2 * r;\n  },\n\n  lerp: function (r, v1, v2) {\n    const ret = {\n      x: v1.x + r * (v2.x - v1.x),\n      y: v1.y + r * (v2.y - v1.y),\n    };\n    if (v1.z !== undefined && v2.z !== undefined) {\n      ret.z = v1.z + r * (v2.z - v1.z);\n    }\n    return ret;\n  },\n\n  pointToString: function (p) {\n    let s = p.x + \"/\" + p.y;\n    if (typeof p.z !== \"undefined\") {\n      s += \"/\" + p.z;\n    }\n    return s;\n  },\n\n  pointsToString: function (points) {\n    return \"[\" + points.map(utils.pointToString).join(\", \") + \"]\";\n  },\n\n  copy: function (obj) {\n    return JSON.parse(JSON.stringify(obj));\n  },\n\n  angle: function (o, v1, v2) {\n    const dx1 = v1.x - o.x,\n      dy1 = v1.y - o.y,\n      dx2 = v2.x - o.x,\n      dy2 = v2.y - o.y,\n      cross = dx1 * dy2 - dy1 * dx2,\n      dot = dx1 * dx2 + dy1 * dy2;\n    return atan2(cross, dot);\n  },\n\n  // round as string, to avoid rounding errors\n  round: function (v, d) {\n    const s = \"\" + v;\n    const pos = s.indexOf(\".\");\n    return parseFloat(s.substring(0, pos + 1 + d));\n  },\n\n  dist: function (p1, p2) {\n    const dx = p1.x - p2.x,\n      dy = p1.y - p2.y;\n    return sqrt(dx * dx + dy * dy);\n  },\n\n  closest: function (LUT, point) {\n    let mdist = pow(2, 63),\n      mpos,\n      d;\n    LUT.forEach(function (p, idx) {\n      d = utils.dist(point, p);\n      if (d < mdist) {\n        mdist = d;\n        mpos = idx;\n      }\n    });\n    return { mdist: mdist, mpos: mpos };\n  },\n\n  abcratio: function (t, n) {\n    // see ratio(t) note on http://pomax.github.io/bezierinfo/#abc\n    if (n !== 2 && n !== 3) {\n      return false;\n    }\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    } else if (t === 0 || t === 1) {\n      return t;\n    }\n    const bottom = pow(t, n) + pow(1 - t, n),\n      top = bottom - 1;\n    return abs(top / bottom);\n  },\n\n  projectionratio: function (t, n) {\n    // see u(t) note on http://pomax.github.io/bezierinfo/#abc\n    if (n !== 2 && n !== 3) {\n      return false;\n    }\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    } else if (t === 0 || t === 1) {\n      return t;\n    }\n    const top = pow(1 - t, n),\n      bottom = pow(t, n) + top;\n    return top / bottom;\n  },\n\n  lli8: function (x1, y1, x2, y2, x3, y3, x4, y4) {\n    const nx =\n        (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),\n      ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),\n      d = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n    if (d == 0) {\n      return false;\n    }\n    return { x: nx / d, y: ny / d };\n  },\n\n  lli4: function (p1, p2, p3, p4) {\n    const x1 = p1.x,\n      y1 = p1.y,\n      x2 = p2.x,\n      y2 = p2.y,\n      x3 = p3.x,\n      y3 = p3.y,\n      x4 = p4.x,\n      y4 = p4.y;\n    return utils.lli8(x1, y1, x2, y2, x3, y3, x4, y4);\n  },\n\n  lli: function (v1, v2) {\n    return utils.lli4(v1, v1.c, v2, v2.c);\n  },\n\n  makeline: function (p1, p2) {\n    const x1 = p1.x,\n      y1 = p1.y,\n      x2 = p2.x,\n      y2 = p2.y,\n      dx = (x2 - x1) / 3,\n      dy = (y2 - y1) / 3;\n    return new Bezier(\n      x1,\n      y1,\n      x1 + dx,\n      y1 + dy,\n      x1 + 2 * dx,\n      y1 + 2 * dy,\n      x2,\n      y2\n    );\n  },\n\n  findbbox: function (sections) {\n    let mx = nMax,\n      my = nMax,\n      MX = nMin,\n      MY = nMin;\n    sections.forEach(function (s) {\n      const bbox = s.bbox();\n      if (mx > bbox.x.min) mx = bbox.x.min;\n      if (my > bbox.y.min) my = bbox.y.min;\n      if (MX < bbox.x.max) MX = bbox.x.max;\n      if (MY < bbox.y.max) MY = bbox.y.max;\n    });\n    return {\n      x: { min: mx, mid: (mx + MX) / 2, max: MX, size: MX - mx },\n      y: { min: my, mid: (my + MY) / 2, max: MY, size: MY - my },\n    };\n  },\n\n  shapeintersections: function (\n    s1,\n    bbox1,\n    s2,\n    bbox2,\n    curveIntersectionThreshold\n  ) {\n    if (!utils.bboxoverlap(bbox1, bbox2)) return [];\n    const intersections = [];\n    const a1 = [s1.startcap, s1.forward, s1.back, s1.endcap];\n    const a2 = [s2.startcap, s2.forward, s2.back, s2.endcap];\n    a1.forEach(function (l1) {\n      if (l1.virtual) return;\n      a2.forEach(function (l2) {\n        if (l2.virtual) return;\n        const iss = l1.intersects(l2, curveIntersectionThreshold);\n        if (iss.length > 0) {\n          iss.c1 = l1;\n          iss.c2 = l2;\n          iss.s1 = s1;\n          iss.s2 = s2;\n          intersections.push(iss);\n        }\n      });\n    });\n    return intersections;\n  },\n\n  makeshape: function (forward, back, curveIntersectionThreshold) {\n    const bpl = back.points.length;\n    const fpl = forward.points.length;\n    const start = utils.makeline(back.points[bpl - 1], forward.points[0]);\n    const end = utils.makeline(forward.points[fpl - 1], back.points[0]);\n    const shape = {\n      startcap: start,\n      forward: forward,\n      back: back,\n      endcap: end,\n      bbox: utils.findbbox([start, forward, back, end]),\n    };\n    shape.intersections = function (s2) {\n      return utils.shapeintersections(\n        shape,\n        shape.bbox,\n        s2,\n        s2.bbox,\n        curveIntersectionThreshold\n      );\n    };\n    return shape;\n  },\n\n  getminmax: function (curve, d, list) {\n    if (!list) return { min: 0, max: 0 };\n    let min = nMax,\n      max = nMin,\n      t,\n      c;\n    if (list.indexOf(0) === -1) {\n      list = [0].concat(list);\n    }\n    if (list.indexOf(1) === -1) {\n      list.push(1);\n    }\n    for (let i = 0, len = list.length; i < len; i++) {\n      t = list[i];\n      c = curve.get(t);\n      if (c[d] < min) {\n        min = c[d];\n      }\n      if (c[d] > max) {\n        max = c[d];\n      }\n    }\n    return { min: min, mid: (min + max) / 2, max: max, size: max - min };\n  },\n\n  align: function (points, line) {\n    const tx = line.p1.x,\n      ty = line.p1.y,\n      a = -atan2(line.p2.y - ty, line.p2.x - tx),\n      d = function (v) {\n        return {\n          x: (v.x - tx) * cos(a) - (v.y - ty) * sin(a),\n          y: (v.x - tx) * sin(a) + (v.y - ty) * cos(a),\n        };\n      };\n    return points.map(d);\n  },\n\n  roots: function (points, line) {\n    line = line || { p1: { x: 0, y: 0 }, p2: { x: 1, y: 0 } };\n\n    const order = points.length - 1;\n    const aligned = utils.align(points, line);\n    const reduce = function (t) {\n      return 0 <= t && t <= 1;\n    };\n\n    if (order === 2) {\n      const a = aligned[0].y,\n        b = aligned[1].y,\n        c = aligned[2].y,\n        d = a - 2 * b + c;\n      if (d !== 0) {\n        const m1 = -sqrt(b * b - a * c),\n          m2 = -a + b,\n          v1 = -(m1 + m2) / d,\n          v2 = -(-m1 + m2) / d;\n        return [v1, v2].filter(reduce);\n      } else if (b !== c && d === 0) {\n        return [(2 * b - c) / (2 * b - 2 * c)].filter(reduce);\n      }\n      return [];\n    }\n\n    // see http://www.trans4mind.com/personal_development/mathematics/polynomials/cubicAlgebra.htm\n    const pa = aligned[0].y,\n      pb = aligned[1].y,\n      pc = aligned[2].y,\n      pd = aligned[3].y;\n\n    let d = -pa + 3 * pb - 3 * pc + pd,\n      a = 3 * pa - 6 * pb + 3 * pc,\n      b = -3 * pa + 3 * pb,\n      c = pa;\n\n    if (utils.approximately(d, 0)) {\n      // this is not a cubic curve.\n      if (utils.approximately(a, 0)) {\n        // in fact, this is not a quadratic curve either.\n        if (utils.approximately(b, 0)) {\n          // in fact in fact, there are no solutions.\n          return [];\n        }\n        // linear solution:\n        return [-c / b].filter(reduce);\n      }\n      // quadratic solution:\n      const q = sqrt(b * b - 4 * a * c),\n        a2 = 2 * a;\n      return [(q - b) / a2, (-b - q) / a2].filter(reduce);\n    }\n\n    // at this point, we know we need a cubic solution:\n\n    a /= d;\n    b /= d;\n    c /= d;\n\n    const p = (3 * b - a * a) / 3,\n      p3 = p / 3,\n      q = (2 * a * a * a - 9 * a * b + 27 * c) / 27,\n      q2 = q / 2,\n      discriminant = q2 * q2 + p3 * p3 * p3;\n\n    let u1, v1, x1, x2, x3;\n    if (discriminant < 0) {\n      const mp3 = -p / 3,\n        mp33 = mp3 * mp3 * mp3,\n        r = sqrt(mp33),\n        t = -q / (2 * r),\n        cosphi = t < -1 ? -1 : t > 1 ? 1 : t,\n        phi = acos(cosphi),\n        crtr = crt(r),\n        t1 = 2 * crtr;\n      x1 = t1 * cos(phi / 3) - a / 3;\n      x2 = t1 * cos((phi + tau) / 3) - a / 3;\n      x3 = t1 * cos((phi + 2 * tau) / 3) - a / 3;\n      return [x1, x2, x3].filter(reduce);\n    } else if (discriminant === 0) {\n      u1 = q2 < 0 ? crt(-q2) : -crt(q2);\n      x1 = 2 * u1 - a / 3;\n      x2 = -u1 - a / 3;\n      return [x1, x2].filter(reduce);\n    } else {\n      const sd = sqrt(discriminant);\n      u1 = crt(-q2 + sd);\n      v1 = crt(q2 + sd);\n      return [u1 - v1 - a / 3].filter(reduce);\n    }\n  },\n\n  droots: function (p) {\n    // quadratic roots are easy\n    if (p.length === 3) {\n      const a = p[0],\n        b = p[1],\n        c = p[2],\n        d = a - 2 * b + c;\n      if (d !== 0) {\n        const m1 = -sqrt(b * b - a * c),\n          m2 = -a + b,\n          v1 = -(m1 + m2) / d,\n          v2 = -(-m1 + m2) / d;\n        return [v1, v2];\n      } else if (b !== c && d === 0) {\n        return [(2 * b - c) / (2 * (b - c))];\n      }\n      return [];\n    }\n\n    // linear roots are even easier\n    if (p.length === 2) {\n      const a = p[0],\n        b = p[1];\n      if (a !== b) {\n        return [a / (a - b)];\n      }\n      return [];\n    }\n\n    return [];\n  },\n\n  curvature: function (t, d1, d2, _3d, kOnly) {\n    let num,\n      dnm,\n      adk,\n      dk,\n      k = 0,\n      r = 0;\n\n    //\n    // We're using the following formula for curvature:\n    //\n    //              x'y\" - y'x\"\n    //   k(t) = ------------------\n    //           (x'² + y'²)^(3/2)\n    //\n    // from https://en.wikipedia.org/wiki/Radius_of_curvature#Definition\n    //\n    // With it corresponding 3D counterpart:\n    //\n    //          sqrt( (y'z\" - y\"z')² + (z'x\" - z\"x')² + (x'y\" - x\"y')²)\n    //   k(t) = -------------------------------------------------------\n    //                     (x'² + y'² + z'²)^(3/2)\n    //\n\n    const d = utils.compute(t, d1);\n    const dd = utils.compute(t, d2);\n    const qdsum = d.x * d.x + d.y * d.y;\n\n    if (_3d) {\n      num = sqrt(\n        pow(d.y * dd.z - dd.y * d.z, 2) +\n          pow(d.z * dd.x - dd.z * d.x, 2) +\n          pow(d.x * dd.y - dd.x * d.y, 2)\n      );\n      dnm = pow(qdsum + d.z * d.z, 3 / 2);\n    } else {\n      num = d.x * dd.y - d.y * dd.x;\n      dnm = pow(qdsum, 3 / 2);\n    }\n\n    if (num === 0 || dnm === 0) {\n      return { k: 0, r: 0 };\n    }\n\n    k = num / dnm;\n    r = dnm / num;\n\n    // We're also computing the derivative of kappa, because\n    // there is value in knowing the rate of change for the\n    // curvature along the curve. And we're just going to\n    // ballpark it based on an epsilon.\n    if (!kOnly) {\n      // compute k'(t) based on the interval before, and after it,\n      // to at least try to not introduce forward/backward pass bias.\n      const pk = utils.curvature(t - 0.001, d1, d2, _3d, true).k;\n      const nk = utils.curvature(t + 0.001, d1, d2, _3d, true).k;\n      dk = (nk - k + (k - pk)) / 2;\n      adk = (abs(nk - k) + abs(k - pk)) / 2;\n    }\n\n    return { k: k, r: r, dk: dk, adk: adk };\n  },\n\n  inflections: function (points) {\n    if (points.length < 4) return [];\n\n    // FIXME: TODO: add in inflection abstraction for quartic+ curves?\n\n    const p = utils.align(points, { p1: points[0], p2: points.slice(-1)[0] }),\n      a = p[2].x * p[1].y,\n      b = p[3].x * p[1].y,\n      c = p[1].x * p[2].y,\n      d = p[3].x * p[2].y,\n      v1 = 18 * (-3 * a + 2 * b + 3 * c - d),\n      v2 = 18 * (3 * a - b - 3 * c),\n      v3 = 18 * (c - a);\n\n    if (utils.approximately(v1, 0)) {\n      if (!utils.approximately(v2, 0)) {\n        let t = -v3 / v2;\n        if (0 <= t && t <= 1) return [t];\n      }\n      return [];\n    }\n\n    const trm = v2 * v2 - 4 * v1 * v3,\n      sq = Math.sqrt(trm),\n      d2 = 2 * v1;\n\n    if (utils.approximately(d2, 0)) return [];\n\n    return [(sq - v2) / d2, -(v2 + sq) / d2].filter(function (r) {\n      return 0 <= r && r <= 1;\n    });\n  },\n\n  bboxoverlap: function (b1, b2) {\n    const dims = [\"x\", \"y\"],\n      len = dims.length;\n\n    for (let i = 0, dim, l, t, d; i < len; i++) {\n      dim = dims[i];\n      l = b1[dim].mid;\n      t = b2[dim].mid;\n      d = (b1[dim].size + b2[dim].size) / 2;\n      if (abs(l - t) >= d) return false;\n    }\n    return true;\n  },\n\n  expandbox: function (bbox, _bbox) {\n    if (_bbox.x.min < bbox.x.min) {\n      bbox.x.min = _bbox.x.min;\n    }\n    if (_bbox.y.min < bbox.y.min) {\n      bbox.y.min = _bbox.y.min;\n    }\n    if (_bbox.z && _bbox.z.min < bbox.z.min) {\n      bbox.z.min = _bbox.z.min;\n    }\n    if (_bbox.x.max > bbox.x.max) {\n      bbox.x.max = _bbox.x.max;\n    }\n    if (_bbox.y.max > bbox.y.max) {\n      bbox.y.max = _bbox.y.max;\n    }\n    if (_bbox.z && _bbox.z.max > bbox.z.max) {\n      bbox.z.max = _bbox.z.max;\n    }\n    bbox.x.mid = (bbox.x.min + bbox.x.max) / 2;\n    bbox.y.mid = (bbox.y.min + bbox.y.max) / 2;\n    if (bbox.z) {\n      bbox.z.mid = (bbox.z.min + bbox.z.max) / 2;\n    }\n    bbox.x.size = bbox.x.max - bbox.x.min;\n    bbox.y.size = bbox.y.max - bbox.y.min;\n    if (bbox.z) {\n      bbox.z.size = bbox.z.max - bbox.z.min;\n    }\n  },\n\n  pairiteration: function (c1, c2, curveIntersectionThreshold) {\n    const c1b = c1.bbox(),\n      c2b = c2.bbox(),\n      r = 100000,\n      threshold = curveIntersectionThreshold || 0.5;\n\n    if (\n      c1b.x.size + c1b.y.size < threshold &&\n      c2b.x.size + c2b.y.size < threshold\n    ) {\n      return [\n        (((r * (c1._t1 + c1._t2)) / 2) | 0) / r +\n          \"/\" +\n          (((r * (c2._t1 + c2._t2)) / 2) | 0) / r,\n      ];\n    }\n\n    let cc1 = c1.split(0.5),\n      cc2 = c2.split(0.5),\n      pairs = [\n        { left: cc1.left, right: cc2.left },\n        { left: cc1.left, right: cc2.right },\n        { left: cc1.right, right: cc2.right },\n        { left: cc1.right, right: cc2.left },\n      ];\n\n    pairs = pairs.filter(function (pair) {\n      return utils.bboxoverlap(pair.left.bbox(), pair.right.bbox());\n    });\n\n    let results = [];\n\n    if (pairs.length === 0) return results;\n\n    pairs.forEach(function (pair) {\n      results = results.concat(\n        utils.pairiteration(pair.left, pair.right, threshold)\n      );\n    });\n\n    results = results.filter(function (v, i) {\n      return results.indexOf(v) === i;\n    });\n\n    return results;\n  },\n\n  getccenter: function (p1, p2, p3) {\n    const dx1 = p2.x - p1.x,\n      dy1 = p2.y - p1.y,\n      dx2 = p3.x - p2.x,\n      dy2 = p3.y - p2.y,\n      dx1p = dx1 * cos(quart) - dy1 * sin(quart),\n      dy1p = dx1 * sin(quart) + dy1 * cos(quart),\n      dx2p = dx2 * cos(quart) - dy2 * sin(quart),\n      dy2p = dx2 * sin(quart) + dy2 * cos(quart),\n      // chord midpoints\n      mx1 = (p1.x + p2.x) / 2,\n      my1 = (p1.y + p2.y) / 2,\n      mx2 = (p2.x + p3.x) / 2,\n      my2 = (p2.y + p3.y) / 2,\n      // midpoint offsets\n      mx1n = mx1 + dx1p,\n      my1n = my1 + dy1p,\n      mx2n = mx2 + dx2p,\n      my2n = my2 + dy2p,\n      // intersection of these lines:\n      arc = utils.lli8(mx1, my1, mx1n, my1n, mx2, my2, mx2n, my2n),\n      r = utils.dist(arc, p1);\n\n    // arc start/end values, over mid point:\n    let s = atan2(p1.y - arc.y, p1.x - arc.x),\n      m = atan2(p2.y - arc.y, p2.x - arc.x),\n      e = atan2(p3.y - arc.y, p3.x - arc.x),\n      _;\n\n    // determine arc direction (cw/ccw correction)\n    if (s < e) {\n      // if s<m<e, arc(s, e)\n      // if m<s<e, arc(e, s + tau)\n      // if s<e<m, arc(e, s + tau)\n      if (s > m || m > e) {\n        s += tau;\n      }\n      if (s > e) {\n        _ = e;\n        e = s;\n        s = _;\n      }\n    } else {\n      // if e<m<s, arc(e, s)\n      // if m<e<s, arc(s, e + tau)\n      // if e<s<m, arc(s, e + tau)\n      if (e < m && m < s) {\n        _ = e;\n        e = s;\n        s = _;\n      } else {\n        e += tau;\n      }\n    }\n    // assign and done.\n    arc.s = s;\n    arc.e = e;\n    arc.r = r;\n    return arc;\n  },\n\n  numberSort: function (a, b) {\n    return a - b;\n  },\n};\n\nexport { utils };\n","import { utils } from \"./utils.js\";\n\n/**\n * Poly Bezier\n * @param {[type]} curves [description]\n */\nclass PolyBezier {\n  constructor(curves) {\n    this.curves = [];\n    this._3d = false;\n    if (!!curves) {\n      this.curves = curves;\n      this._3d = this.curves[0]._3d;\n    }\n  }\n\n  valueOf() {\n    return this.toString();\n  }\n\n  toString() {\n    return (\n      \"[\" +\n      this.curves\n        .map(function (curve) {\n          return utils.pointsToString(curve.points);\n        })\n        .join(\", \") +\n      \"]\"\n    );\n  }\n\n  addCurve(curve) {\n    this.curves.push(curve);\n    this._3d = this._3d || curve._3d;\n  }\n\n  length() {\n    return this.curves\n      .map(function (v) {\n        return v.length();\n      })\n      .reduce(function (a, b) {\n        return a + b;\n      });\n  }\n\n  curve(idx) {\n    return this.curves[idx];\n  }\n\n  bbox() {\n    const c = this.curves;\n    var bbox = c[0].bbox();\n    for (var i = 1; i < c.length; i++) {\n      utils.expandbox(bbox, c[i].bbox());\n    }\n    return bbox;\n  }\n\n  offset(d) {\n    const offset = [];\n    this.curves.forEach(function (v) {\n      offset.push(...v.offset(d));\n    });\n    return new PolyBezier(offset);\n  }\n}\n\nexport { PolyBezier };\n","/**\n  A javascript Bezier curve library by Pomax.\n\n  Based on http://pomax.github.io/bezierinfo\n\n  This code is MIT licensed.\n**/\n\nimport { utils } from \"./utils.js\";\nimport { PolyBezier } from \"./poly-bezier.js\";\n\n// math-inlining.\nconst { abs, min, max, cos, sin, acos, sqrt } = Math;\nconst pi = Math.PI;\n// a zero coordinate, which is surprisingly useful\nconst ZERO = { x: 0, y: 0, z: 0 };\n\n/**\n * Bezier curve constructor.\n *\n * ...docs pending...\n */\nclass Bezier {\n  constructor(coords) {\n    let args =\n      coords && coords.forEach ? coords : Array.from(arguments).slice();\n    let coordlen = false;\n\n    if (typeof args[0] === \"object\") {\n      coordlen = args.length;\n      const newargs = [];\n      args.forEach(function (point) {\n        [\"x\", \"y\", \"z\"].forEach(function (d) {\n          if (typeof point[d] !== \"undefined\") {\n            newargs.push(point[d]);\n          }\n        });\n      });\n      args = newargs;\n    }\n\n    let higher = false;\n    const len = args.length;\n\n    if (coordlen) {\n      if (coordlen > 4) {\n        if (arguments.length !== 1) {\n          throw new Error(\n            \"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n          );\n        }\n        higher = true;\n      }\n    } else {\n      if (len !== 6 && len !== 8 && len !== 9 && len !== 12) {\n        if (arguments.length !== 1) {\n          throw new Error(\n            \"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n          );\n        }\n      }\n    }\n\n    const _3d = (this._3d =\n      (!higher && (len === 9 || len === 12)) ||\n      (coords && coords[0] && typeof coords[0].z !== \"undefined\"));\n\n    const points = (this.points = []);\n    for (let idx = 0, step = _3d ? 3 : 2; idx < len; idx += step) {\n      var point = {\n        x: args[idx],\n        y: args[idx + 1],\n      };\n      if (_3d) {\n        point.z = args[idx + 2];\n      }\n      points.push(point);\n    }\n    const order = (this.order = points.length - 1);\n\n    const dims = (this.dims = [\"x\", \"y\"]);\n    if (_3d) dims.push(\"z\");\n    this.dimlen = dims.length;\n\n    const aligned = utils.align(points, { p1: points[0], p2: points[order] });\n    this._linear = !aligned.some((p) => abs(p.y) > 0.0001);\n\n    this._lut = [];\n\n    this._t1 = 0;\n    this._t2 = 1;\n    this.update();\n  }\n\n  static quadraticFromPoints(p1, p2, p3, t) {\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    }\n    // shortcuts, although they're really dumb\n    if (t === 0) {\n      return new Bezier(p2, p2, p3);\n    }\n    if (t === 1) {\n      return new Bezier(p1, p2, p2);\n    }\n    // real fitting.\n    const abc = Bezier.getABC(2, p1, p2, p3, t);\n    return new Bezier(p1, abc.A, p3);\n  }\n\n  static cubicFromPoints(S, B, E, t, d1) {\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    }\n    const abc = Bezier.getABC(3, S, B, E, t);\n    if (typeof d1 === \"undefined\") {\n      d1 = utils.dist(B, abc.C);\n    }\n    const d2 = (d1 * (1 - t)) / t;\n\n    const selen = utils.dist(S, E),\n      lx = (E.x - S.x) / selen,\n      ly = (E.y - S.y) / selen,\n      bx1 = d1 * lx,\n      by1 = d1 * ly,\n      bx2 = d2 * lx,\n      by2 = d2 * ly;\n    // derivation of new hull coordinates\n    const e1 = { x: B.x - bx1, y: B.y - by1 },\n      e2 = { x: B.x + bx2, y: B.y + by2 },\n      A = abc.A,\n      v1 = { x: A.x + (e1.x - A.x) / (1 - t), y: A.y + (e1.y - A.y) / (1 - t) },\n      v2 = { x: A.x + (e2.x - A.x) / t, y: A.y + (e2.y - A.y) / t },\n      nc1 = { x: S.x + (v1.x - S.x) / t, y: S.y + (v1.y - S.y) / t },\n      nc2 = {\n        x: E.x + (v2.x - E.x) / (1 - t),\n        y: E.y + (v2.y - E.y) / (1 - t),\n      };\n    // ...done\n    return new Bezier(S, nc1, nc2, E);\n  }\n\n  static getUtils() {\n    return utils;\n  }\n\n  getUtils() {\n    return Bezier.getUtils();\n  }\n\n  static get PolyBezier() {\n    return PolyBezier;\n  }\n\n  valueOf() {\n    return this.toString();\n  }\n\n  toString() {\n    return utils.pointsToString(this.points);\n  }\n\n  toSVG() {\n    if (this._3d) return false;\n    const p = this.points,\n      x = p[0].x,\n      y = p[0].y,\n      s = [\"M\", x, y, this.order === 2 ? \"Q\" : \"C\"];\n    for (let i = 1, last = p.length; i < last; i++) {\n      s.push(p[i].x);\n      s.push(p[i].y);\n    }\n    return s.join(\" \");\n  }\n\n  setRatios(ratios) {\n    if (ratios.length !== this.points.length) {\n      throw new Error(\"incorrect number of ratio values\");\n    }\n    this.ratios = ratios;\n    this._lut = []; //  invalidate any precomputed LUT\n  }\n\n  verify() {\n    const print = this.coordDigest();\n    if (print !== this._print) {\n      this._print = print;\n      this.update();\n    }\n  }\n\n  coordDigest() {\n    return this.points\n      .map(function (c, pos) {\n        return \"\" + pos + c.x + c.y + (c.z ? c.z : 0);\n      })\n      .join(\"\");\n  }\n\n  update() {\n    // invalidate any precomputed LUT\n    this._lut = [];\n    this.dpoints = utils.derive(this.points, this._3d);\n    this.computedirection();\n  }\n\n  computedirection() {\n    const points = this.points;\n    const angle = utils.angle(points[0], points[this.order], points[1]);\n    this.clockwise = angle > 0;\n  }\n\n  length() {\n    return utils.length(this.derivative.bind(this));\n  }\n\n  static getABC(order = 2, S, B, E, t = 0.5) {\n    const u = utils.projectionratio(t, order),\n      um = 1 - u,\n      C = {\n        x: u * S.x + um * E.x,\n        y: u * S.y + um * E.y,\n      },\n      s = utils.abcratio(t, order),\n      A = {\n        x: B.x + (B.x - C.x) / s,\n        y: B.y + (B.y - C.y) / s,\n      };\n    return { A, B, C, S, E };\n  }\n\n  getABC(t, B) {\n    B = B || this.get(t);\n    let S = this.points[0];\n    let E = this.points[this.order];\n    return Bezier.getABC(this.order, S, B, E, t);\n  }\n\n  getLUT(steps) {\n    this.verify();\n    steps = steps || 100;\n    if (this._lut.length === steps) {\n      return this._lut;\n    }\n    this._lut = [];\n    // We want a range from 0 to 1 inclusive, so\n    // we decrement and then use <= rather than <:\n    steps--;\n    for (let i = 0, p, t; i < steps; i++) {\n      t = i / (steps - 1);\n      p = this.compute(t);\n      p.t = t;\n      this._lut.push(p);\n    }\n    return this._lut;\n  }\n\n  on(point, error) {\n    error = error || 5;\n    const lut = this.getLUT(),\n      hits = [];\n    for (let i = 0, c, t = 0; i < lut.length; i++) {\n      c = lut[i];\n      if (utils.dist(c, point) < error) {\n        hits.push(c);\n        t += i / lut.length;\n      }\n    }\n    if (!hits.length) return false;\n    return (t /= hits.length);\n  }\n\n  project(point) {\n    // step 1: coarse check\n    const LUT = this.getLUT(),\n      l = LUT.length - 1,\n      closest = utils.closest(LUT, point),\n      mpos = closest.mpos,\n      t1 = (mpos - 1) / l,\n      t2 = (mpos + 1) / l,\n      step = 0.1 / l;\n\n    // step 2: fine check\n    let mdist = closest.mdist,\n      t = t1,\n      ft = t,\n      p;\n    mdist += 1;\n    for (let d; t < t2 + step; t += step) {\n      p = this.compute(t);\n      d = utils.dist(point, p);\n      if (d < mdist) {\n        mdist = d;\n        ft = t;\n      }\n    }\n    ft = ft < 0 ? 0 : ft > 1 ? 1 : ft;\n    p = this.compute(ft);\n    p.t = ft;\n    p.d = mdist;\n    return p;\n  }\n\n  get(t) {\n    return this.compute(t);\n  }\n\n  point(idx) {\n    return this.points[idx];\n  }\n\n  compute(t) {\n    if (this.ratios) {\n      return utils.computeWithRatios(t, this.points, this.ratios, this._3d);\n    }\n    return utils.compute(t, this.points, this._3d, this.ratios);\n  }\n\n  raise() {\n    const p = this.points,\n      np = [p[0]],\n      k = p.length;\n    for (let i = 1, pi, pim; i < k; i++) {\n      pi = p[i];\n      pim = p[i - 1];\n      np[i] = {\n        x: ((k - i) / k) * pi.x + (i / k) * pim.x,\n        y: ((k - i) / k) * pi.y + (i / k) * pim.y,\n      };\n    }\n    np[k] = p[k - 1];\n    return new Bezier(np);\n  }\n\n  derivative(t) {\n    return utils.compute(t, this.dpoints[0], this._3d);\n  }\n\n  dderivative(t) {\n    return utils.compute(t, this.dpoints[1], this._3d);\n  }\n\n  align() {\n    let p = this.points;\n    return new Bezier(utils.align(p, { p1: p[0], p2: p[p.length - 1] }));\n  }\n\n  curvature(t) {\n    return utils.curvature(t, this.dpoints[0], this.dpoints[1], this._3d);\n  }\n\n  inflections() {\n    return utils.inflections(this.points);\n  }\n\n  normal(t) {\n    return this._3d ? this.__normal3(t) : this.__normal2(t);\n  }\n\n  __normal2(t) {\n    const d = this.derivative(t);\n    const q = sqrt(d.x * d.x + d.y * d.y);\n    return { x: -d.y / q, y: d.x / q };\n  }\n\n  __normal3(t) {\n    // see http://stackoverflow.com/questions/25453159\n    const r1 = this.derivative(t),\n      r2 = this.derivative(t + 0.01),\n      q1 = sqrt(r1.x * r1.x + r1.y * r1.y + r1.z * r1.z),\n      q2 = sqrt(r2.x * r2.x + r2.y * r2.y + r2.z * r2.z);\n    r1.x /= q1;\n    r1.y /= q1;\n    r1.z /= q1;\n    r2.x /= q2;\n    r2.y /= q2;\n    r2.z /= q2;\n    // cross product\n    const c = {\n      x: r2.y * r1.z - r2.z * r1.y,\n      y: r2.z * r1.x - r2.x * r1.z,\n      z: r2.x * r1.y - r2.y * r1.x,\n    };\n    const m = sqrt(c.x * c.x + c.y * c.y + c.z * c.z);\n    c.x /= m;\n    c.y /= m;\n    c.z /= m;\n    // rotation matrix\n    const R = [\n      c.x * c.x,\n      c.x * c.y - c.z,\n      c.x * c.z + c.y,\n      c.x * c.y + c.z,\n      c.y * c.y,\n      c.y * c.z - c.x,\n      c.x * c.z - c.y,\n      c.y * c.z + c.x,\n      c.z * c.z,\n    ];\n    // normal vector:\n    const n = {\n      x: R[0] * r1.x + R[1] * r1.y + R[2] * r1.z,\n      y: R[3] * r1.x + R[4] * r1.y + R[5] * r1.z,\n      z: R[6] * r1.x + R[7] * r1.y + R[8] * r1.z,\n    };\n    return n;\n  }\n\n  hull(t) {\n    let p = this.points,\n      _p = [],\n      q = [],\n      idx = 0;\n    q[idx++] = p[0];\n    q[idx++] = p[1];\n    q[idx++] = p[2];\n    if (this.order === 3) {\n      q[idx++] = p[3];\n    }\n    // we lerp between all points at each iteration, until we have 1 point left.\n    while (p.length > 1) {\n      _p = [];\n      for (let i = 0, pt, l = p.length - 1; i < l; i++) {\n        pt = utils.lerp(t, p[i], p[i + 1]);\n        q[idx++] = pt;\n        _p.push(pt);\n      }\n      p = _p;\n    }\n    return q;\n  }\n\n  split(t1, t2) {\n    // shortcuts\n    if (t1 === 0 && !!t2) {\n      return this.split(t2).left;\n    }\n    if (t2 === 1) {\n      return this.split(t1).right;\n    }\n\n    // no shortcut: use \"de Casteljau\" iteration.\n    const q = this.hull(t1);\n    const result = {\n      left:\n        this.order === 2\n          ? new Bezier([q[0], q[3], q[5]])\n          : new Bezier([q[0], q[4], q[7], q[9]]),\n      right:\n        this.order === 2\n          ? new Bezier([q[5], q[4], q[2]])\n          : new Bezier([q[9], q[8], q[6], q[3]]),\n      span: q,\n    };\n\n    // make sure we bind _t1/_t2 information!\n    result.left._t1 = utils.map(0, 0, 1, this._t1, this._t2);\n    result.left._t2 = utils.map(t1, 0, 1, this._t1, this._t2);\n    result.right._t1 = utils.map(t1, 0, 1, this._t1, this._t2);\n    result.right._t2 = utils.map(1, 0, 1, this._t1, this._t2);\n\n    // if we have no t2, we're done\n    if (!t2) {\n      return result;\n    }\n\n    // if we have a t2, split again:\n    t2 = utils.map(t2, t1, 1, 0, 1);\n    return result.right.split(t2).left;\n  }\n\n  extrema() {\n    const result = {};\n    let roots = [];\n\n    this.dims.forEach(\n      function (dim) {\n        let mfn = function (v) {\n          return v[dim];\n        };\n        let p = this.dpoints[0].map(mfn);\n        result[dim] = utils.droots(p);\n        if (this.order === 3) {\n          p = this.dpoints[1].map(mfn);\n          result[dim] = result[dim].concat(utils.droots(p));\n        }\n        result[dim] = result[dim].filter(function (t) {\n          return t >= 0 && t <= 1;\n        });\n        roots = roots.concat(result[dim].sort(utils.numberSort));\n      }.bind(this)\n    );\n\n    result.values = roots.sort(utils.numberSort).filter(function (v, idx) {\n      return roots.indexOf(v) === idx;\n    });\n\n    return result;\n  }\n\n  bbox() {\n    const extrema = this.extrema(),\n      result = {};\n    this.dims.forEach(\n      function (d) {\n        result[d] = utils.getminmax(this, d, extrema[d]);\n      }.bind(this)\n    );\n    return result;\n  }\n\n  overlaps(curve) {\n    const lbbox = this.bbox(),\n      tbbox = curve.bbox();\n    return utils.bboxoverlap(lbbox, tbbox);\n  }\n\n  offset(t, d) {\n    if (typeof d !== \"undefined\") {\n      const c = this.get(t),\n        n = this.normal(t);\n      const ret = {\n        c: c,\n        n: n,\n        x: c.x + n.x * d,\n        y: c.y + n.y * d,\n      };\n      if (this._3d) {\n        ret.z = c.z + n.z * d;\n      }\n      return ret;\n    }\n    if (this._linear) {\n      const nv = this.normal(0),\n        coords = this.points.map(function (p) {\n          const ret = {\n            x: p.x + t * nv.x,\n            y: p.y + t * nv.y,\n          };\n          if (p.z && nv.z) {\n            ret.z = p.z + t * nv.z;\n          }\n          return ret;\n        });\n      return [new Bezier(coords)];\n    }\n    return this.reduce().map(function (s) {\n      if (s._linear) {\n        return s.offset(t)[0];\n      }\n      return s.scale(t);\n    });\n  }\n\n  simple() {\n    if (this.order === 3) {\n      const a1 = utils.angle(this.points[0], this.points[3], this.points[1]);\n      const a2 = utils.angle(this.points[0], this.points[3], this.points[2]);\n      if ((a1 > 0 && a2 < 0) || (a1 < 0 && a2 > 0)) return false;\n    }\n    const n1 = this.normal(0);\n    const n2 = this.normal(1);\n    let s = n1.x * n2.x + n1.y * n2.y;\n    if (this._3d) {\n      s += n1.z * n2.z;\n    }\n    return abs(acos(s)) < pi / 3;\n  }\n\n  reduce() {\n    // TODO: examine these var types in more detail...\n    let i,\n      t1 = 0,\n      t2 = 0,\n      step = 0.01,\n      segment,\n      pass1 = [],\n      pass2 = [];\n    // first pass: split on extrema\n    let extrema = this.extrema().values;\n    if (extrema.indexOf(0) === -1) {\n      extrema = [0].concat(extrema);\n    }\n    if (extrema.indexOf(1) === -1) {\n      extrema.push(1);\n    }\n\n    for (t1 = extrema[0], i = 1; i < extrema.length; i++) {\n      t2 = extrema[i];\n      segment = this.split(t1, t2);\n      segment._t1 = t1;\n      segment._t2 = t2;\n      pass1.push(segment);\n      t1 = t2;\n    }\n\n    // second pass: further reduce these segments to simple segments\n    pass1.forEach(function (p1) {\n      t1 = 0;\n      t2 = 0;\n      while (t2 <= 1) {\n        for (t2 = t1 + step; t2 <= 1 + step; t2 += step) {\n          segment = p1.split(t1, t2);\n          if (!segment.simple()) {\n            t2 -= step;\n            if (abs(t1 - t2) < step) {\n              // we can never form a reduction\n              return [];\n            }\n            segment = p1.split(t1, t2);\n            segment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n            segment._t2 = utils.map(t2, 0, 1, p1._t1, p1._t2);\n            pass2.push(segment);\n            t1 = t2;\n            break;\n          }\n        }\n      }\n      if (t1 < 1) {\n        segment = p1.split(t1, 1);\n        segment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n        segment._t2 = p1._t2;\n        pass2.push(segment);\n      }\n    });\n    return pass2;\n  }\n\n  scale(d) {\n    const order = this.order;\n    let distanceFn = false;\n    if (typeof d === \"function\") {\n      distanceFn = d;\n    }\n    if (distanceFn && order === 2) {\n      return this.raise().scale(distanceFn);\n    }\n\n    // TODO: add special handling for degenerate (=linear) curves.\n    const clockwise = this.clockwise;\n    const r1 = distanceFn ? distanceFn(0) : d;\n    const r2 = distanceFn ? distanceFn(1) : d;\n    const v = [this.offset(0, 10), this.offset(1, 10)];\n    const points = this.points;\n    const np = [];\n    const o = utils.lli4(v[0], v[0].c, v[1], v[1].c);\n\n    if (!o) {\n      throw new Error(\"cannot scale this curve. Try reducing it first.\");\n    }\n    // move all points by distance 'd' wrt the origin 'o'\n\n    // move end points by fixed distance along normal.\n    [0, 1].forEach(function (t) {\n      const p = (np[t * order] = utils.copy(points[t * order]));\n      p.x += (t ? r2 : r1) * v[t].n.x;\n      p.y += (t ? r2 : r1) * v[t].n.y;\n    });\n\n    if (!distanceFn) {\n      // move control points to lie on the intersection of the offset\n      // derivative vector, and the origin-through-control vector\n      [0, 1].forEach((t) => {\n        if (order === 2 && !!t) return;\n        const p = np[t * order];\n        const d = this.derivative(t);\n        const p2 = { x: p.x + d.x, y: p.y + d.y };\n        np[t + 1] = utils.lli4(p, p2, o, points[t + 1]);\n      });\n      return new Bezier(np);\n    }\n\n    // move control points by \"however much necessary to\n    // ensure the correct tangent to endpoint\".\n    [0, 1].forEach(function (t) {\n      if (order === 2 && !!t) return;\n      var p = points[t + 1];\n      var ov = {\n        x: p.x - o.x,\n        y: p.y - o.y,\n      };\n      var rc = distanceFn ? distanceFn((t + 1) / order) : d;\n      if (distanceFn && !clockwise) rc = -rc;\n      var m = sqrt(ov.x * ov.x + ov.y * ov.y);\n      ov.x /= m;\n      ov.y /= m;\n      np[t + 1] = {\n        x: p.x + rc * ov.x,\n        y: p.y + rc * ov.y,\n      };\n    });\n    return new Bezier(np);\n  }\n\n  outline(d1, d2, d3, d4) {\n    d2 = typeof d2 === \"undefined\" ? d1 : d2;\n    const reduced = this.reduce(),\n      len = reduced.length,\n      fcurves = [];\n\n    let bcurves = [],\n      p,\n      alen = 0,\n      tlen = this.length();\n\n    const graduated = typeof d3 !== \"undefined\" && typeof d4 !== \"undefined\";\n\n    function linearDistanceFunction(s, e, tlen, alen, slen) {\n      return function (v) {\n        const f1 = alen / tlen,\n          f2 = (alen + slen) / tlen,\n          d = e - s;\n        return utils.map(v, 0, 1, s + f1 * d, s + f2 * d);\n      };\n    }\n\n    // form curve oulines\n    reduced.forEach(function (segment) {\n      const slen = segment.length();\n      if (graduated) {\n        fcurves.push(\n          segment.scale(linearDistanceFunction(d1, d3, tlen, alen, slen))\n        );\n        bcurves.push(\n          segment.scale(linearDistanceFunction(-d2, -d4, tlen, alen, slen))\n        );\n      } else {\n        fcurves.push(segment.scale(d1));\n        bcurves.push(segment.scale(-d2));\n      }\n      alen += slen;\n    });\n\n    // reverse the \"return\" outline\n    bcurves = bcurves\n      .map(function (s) {\n        p = s.points;\n        if (p[3]) {\n          s.points = [p[3], p[2], p[1], p[0]];\n        } else {\n          s.points = [p[2], p[1], p[0]];\n        }\n        return s;\n      })\n      .reverse();\n\n    // form the endcaps as lines\n    const fs = fcurves[0].points[0],\n      fe = fcurves[len - 1].points[fcurves[len - 1].points.length - 1],\n      bs = bcurves[len - 1].points[bcurves[len - 1].points.length - 1],\n      be = bcurves[0].points[0],\n      ls = utils.makeline(bs, fs),\n      le = utils.makeline(fe, be),\n      segments = [ls].concat(fcurves).concat([le]).concat(bcurves),\n      slen = segments.length;\n\n    return new PolyBezier(segments);\n  }\n\n  outlineshapes(d1, d2, curveIntersectionThreshold) {\n    d2 = d2 || d1;\n    const outline = this.outline(d1, d2).curves;\n    const shapes = [];\n    for (let i = 1, len = outline.length; i < len / 2; i++) {\n      const shape = utils.makeshape(\n        outline[i],\n        outline[len - i],\n        curveIntersectionThreshold\n      );\n      shape.startcap.virtual = i > 1;\n      shape.endcap.virtual = i < len / 2 - 1;\n      shapes.push(shape);\n    }\n    return shapes;\n  }\n\n  intersects(curve, curveIntersectionThreshold) {\n    if (!curve) return this.selfintersects(curveIntersectionThreshold);\n    if (curve.p1 && curve.p2) {\n      return this.lineIntersects(curve);\n    }\n    if (curve instanceof Bezier) {\n      curve = curve.reduce();\n    }\n    return this.curveintersects(\n      this.reduce(),\n      curve,\n      curveIntersectionThreshold\n    );\n  }\n\n  lineIntersects(line) {\n    const mx = min(line.p1.x, line.p2.x),\n      my = min(line.p1.y, line.p2.y),\n      MX = max(line.p1.x, line.p2.x),\n      MY = max(line.p1.y, line.p2.y);\n    return utils.roots(this.points, line).filter((t) => {\n      var p = this.get(t);\n      return utils.between(p.x, mx, MX) && utils.between(p.y, my, MY);\n    });\n  }\n\n  selfintersects(curveIntersectionThreshold) {\n    // \"simple\" curves cannot intersect with their direct\n    // neighbour, so for each segment X we check whether\n    // it intersects [0:x-2][x+2:last].\n\n    const reduced = this.reduce(),\n      len = reduced.length - 2,\n      results = [];\n\n    for (let i = 0, result, left, right; i < len; i++) {\n      left = reduced.slice(i, i + 1);\n      right = reduced.slice(i + 2);\n      result = this.curveintersects(left, right, curveIntersectionThreshold);\n      results.push(...result);\n    }\n    return results;\n  }\n\n  curveintersects(c1, c2, curveIntersectionThreshold) {\n    const pairs = [];\n    // step 1: pair off any overlapping segments\n    c1.forEach(function (l) {\n      c2.forEach(function (r) {\n        if (l.overlaps(r)) {\n          pairs.push({ left: l, right: r });\n        }\n      });\n    });\n    // step 2: for each pairing, run through the convergence algorithm.\n    let intersections = [];\n    pairs.forEach(function (pair) {\n      const result = utils.pairiteration(\n        pair.left,\n        pair.right,\n        curveIntersectionThreshold\n      );\n      if (result.length > 0) {\n        intersections = intersections.concat(result);\n      }\n    });\n    return intersections;\n  }\n\n  arcs(errorThreshold) {\n    errorThreshold = errorThreshold || 0.5;\n    return this._iterate(errorThreshold, []);\n  }\n\n  _error(pc, np1, s, e) {\n    const q = (e - s) / 4,\n      c1 = this.get(s + q),\n      c2 = this.get(e - q),\n      ref = utils.dist(pc, np1),\n      d1 = utils.dist(pc, c1),\n      d2 = utils.dist(pc, c2);\n    return abs(d1 - ref) + abs(d2 - ref);\n  }\n\n  _iterate(errorThreshold, circles) {\n    let t_s = 0,\n      t_e = 1,\n      safety;\n    // we do a binary search to find the \"good `t` closest to no-longer-good\"\n    do {\n      safety = 0;\n\n      // step 1: start with the maximum possible arc\n      t_e = 1;\n\n      // points:\n      let np1 = this.get(t_s),\n        np2,\n        np3,\n        arc,\n        prev_arc;\n\n      // booleans:\n      let curr_good = false,\n        prev_good = false,\n        done;\n\n      // numbers:\n      let t_m = t_e,\n        prev_e = 1,\n        step = 0;\n\n      // step 2: find the best possible arc\n      do {\n        prev_good = curr_good;\n        prev_arc = arc;\n        t_m = (t_s + t_e) / 2;\n        step++;\n\n        np2 = this.get(t_m);\n        np3 = this.get(t_e);\n\n        arc = utils.getccenter(np1, np2, np3);\n\n        //also save the t values\n        arc.interval = {\n          start: t_s,\n          end: t_e,\n        };\n\n        let error = this._error(arc, np1, t_s, t_e);\n        curr_good = error <= errorThreshold;\n\n        done = prev_good && !curr_good;\n        if (!done) prev_e = t_e;\n\n        // this arc is fine: we can move 'e' up to see if we can find a wider arc\n        if (curr_good) {\n          // if e is already at max, then we're done for this arc.\n          if (t_e >= 1) {\n            // make sure we cap at t=1\n            arc.interval.end = prev_e = 1;\n            prev_arc = arc;\n            // if we capped the arc segment to t=1 we also need to make sure that\n            // the arc's end angle is correct with respect to the bezier end point.\n            if (t_e > 1) {\n              let d = {\n                x: arc.x + arc.r * cos(arc.e),\n                y: arc.y + arc.r * sin(arc.e),\n              };\n              arc.e += utils.angle({ x: arc.x, y: arc.y }, d, this.get(1));\n            }\n            break;\n          }\n          // if not, move it up by half the iteration distance\n          t_e = t_e + (t_e - t_s) / 2;\n        } else {\n          // this is a bad arc: we need to move 'e' down to find a good arc\n          t_e = t_m;\n        }\n      } while (!done && safety++ < 100);\n\n      if (safety >= 100) {\n        break;\n      }\n\n      // console.log(\"L835: [F] arc found\", t_s, prev_e, prev_arc.x, prev_arc.y, prev_arc.s, prev_arc.e);\n\n      prev_arc = prev_arc ? prev_arc : arc;\n      circles.push(prev_arc);\n      t_s = prev_e;\n    } while (t_e < 1);\n    return circles;\n  }\n}\n\nexport { Bezier };\n","/**\n * 方向\n * @readonly\n * @enum {number}\n */\nexport const DIRECTION = {\n    /** RIGHT */\n    RIGHT: 0,\n    /** BOTTOM */\n    BOTTOM: 1,\n    /** LEFT */\n    LEFT: 2,\n    /** TOP */\n    TOP: 3,\n    /** SELF */\n    SELF: 100,\n}\n\nexport function nextDirection(direction, clockwise) {\n    const nextDir = (direction + (clockwise ? 1 : -1)) % 4;\n    return nextDir;\n}\n\nexport function oppositeDirection(direction) {\n    return (direction + 2) % 4\n}\n\nexport const APPROXIMATE = 6;\n\nexport const JFLOW_MODE = {\n    DEFAULT: 'DEFAULT',\n    LINKING: 'LINKING',\n}\n\nexport const LINE_DIR = {\n    FROM: 'from',\n    TO: 'to',\n}","import {\n    Bezier,\n} from 'bezier-js';\nimport { DIRECTION } from './constance';\n\n/**\n * 根据点计算最小外接矩形\n * @param {number[][]} points - 点集合\n * @return {Object} demension 宽高，坐标\n */\nexport function bounding_box(points) {\n    if(points.length === 0) {\n        return {\n            width: 1,\n            height: 1,\n            x: 0,\n            y: 0,\n        }\n    }\n    let min_x = Infinity; \n    let min_y = Infinity; \n    let max_x = -Infinity; \n    let max_y = -Infinity; \n    for(let idx in points) {\n        const item = points[idx];\n        if(item[0] < min_x){\n            min_x = item[0]\n        }\n\n        if (item[0] > max_x) {\n            max_x = item[0]\n        } \n\n        if (item[1] < min_y) {\n            min_y = item[1]\n        }\n\n        if (item[1] > max_y) {\n            max_y = item[1]\n        }\n    }\n    return {\n        // points: [(min_x,min_y),(max_x,min_y),(max_x,max_y),(min_x,max_y)],\n        width: Math.max(max_x - min_x, 10),\n        height: Math.max(max_y - min_y, 10),\n        x: min_x,\n        y: min_y,\n    }\n}\n\nfunction sqr(x) {\n    return x * x;\n}\nexport function dist2(v, w) {\n    return sqr(v[0] - w[0]) + sqr(v[1] - w[1]);\n}\n\n// p - point\n// v - start point of segment\n// w - end point of segment\nexport function distToSegmentSquared(p, v, w) {\n    const l2 = dist2(v, w);\n    if (l2 === 0) return dist2(p, v);\n    let t = ((p[0] - v[0]) * (w[0] - v[0]) + (p[1] - v[1]) * (w[1] - v[1])) / l2;\n    t = Math.max(0, Math.min(1, t));\n    return dist2(p, [ v[0] + t * (w[0] - v[0]), v[1] + t * (w[1] - v[1]) ]);\n}\n\nexport function minIntersectionBetweenNodes(dmsfrom, dmsto) {\n    const meta = {\n        fromDir: null,\n        fromP: null,\n        toDir: null,\n        toP: null,\n        distMin: Infinity\n    }\n    Object.keys(dmsfrom).forEach(df => {\n        if((+df) === DIRECTION.SELF) {\n            return;\n        }\n        let pf = dmsfrom[df];\n        Object.keys(dmsto).forEach(dt => {\n            if((+dt) === DIRECTION.SELF) {\n                return;\n            }\n            let pt = dmsto[dt];\n            const dist = dist2(pf, pt);\n            if(dist < meta.distMin) {\n                Object.assign(meta, {\n                    distMin: dist,\n                    fromDir: +df,\n                    fromP: pf,\n                    toDir: +dt,\n                    toP: pt,\n                })\n            }\n        })\n    });\n    return meta;\n}\n\n// export function bezierPoints(p1, p2, start_dir = DIRECTION.TOP, end_dir = DIRECTION.TOP, anticlock = false) {\n//     const isSameDirection = start_dir === end_dir;\n//     const isVerticalStart = [DIRECTION.TOP, DIRECTION.BOTTOM].includes(start_dir);   \n//     const isVerticalEnd = [DIRECTION.TOP, DIRECTION.BOTTOM].includes(end_dir);\n//     const arrowspan = [DIRECTION.TOP, DIRECTION.LEFT].includes(end_dir) ? -5 : 5;\n//     const endX = isVerticalEnd ? p2[0] : p2[0] + arrowspan;\n//     const endY = isVerticalEnd ? p2[1] + arrowspan : p2[1];\n//     if(isSameDirection) {\n//         let span = Math.abs(isVerticalStart ? (endY - p1[1]) : (endX - p1[0]))\n//         span = Math.min(span, 50);\n//         const symb = [DIRECTION.RIGHT, DIRECTION.BOTTOM].includes(end_dir)\n//         span = symb ? span : - span;\n//         const cp1 = isVerticalStart ? [p1[0], p1[1] + span] : [p1[0] + span, p1[1]];\n//         const cp2 = isVerticalEnd ? [endX, endY + span] : [endX + span, endY];\n//         return [ \n//             ...cp1,\n//             ...cp2,\n//             endX, endY ];\n//     }\n//     let spanStart = (anticlock ? -5 : 1) * (isVerticalStart ? (endY - p1[1]) / 2 : (endX - p1[0]) / 2)\n//     let spanEnd = (anticlock ? -4 : 1) * (isVerticalEnd ? (p1[1] - endY) / 2 : (p1[0] - endX) / 2)\n//     let u1 = spanStart / Math.abs(spanStart);\n//     spanStart = u1 * Math.min(Math.abs(spanStart), 50);\n//     let u2 = spanEnd / Math.abs(spanEnd);\n//     spanEnd = u2 * Math.min(Math.abs(spanEnd), 50);\n//     const cp1 = isVerticalStart ? [p1[0], p1[1] + spanStart] : [p1[0] + spanStart, p1[1]];\n//     const cp2 = isVerticalEnd ? [endX, endY + spanEnd] : [endX + spanEnd, endY];\n//     return [ \n//         ...cp1,\n//         ...cp2,\n//         endX, endY ];\n// }\nfunction _resolveControlPoint(p, dir, spanx, spany){\n    if(dir === DIRECTION.TOP){\n        return [p[0], p[1]-spany]\n    }\n    if(dir === DIRECTION.BOTTOM){\n        return [p[0], p[1]+spany]\n    }\n    if(dir === DIRECTION.LEFT){\n        return [p[0]-spanx, p[1]]\n    }\n    if(dir === DIRECTION.RIGHT){\n        return [p[0]+spanx, p[1]]\n    }\n}\n\nexport function bezierPoints(p1, p2, start_dir = DIRECTION.TOP, end_dir = DIRECTION.TOP, minSpanX = 0, minSpanY = 0) {\n    const spanx = Math.max(Math.abs((p1[0] - p2[0])/2), minSpanX);\n    const spany = Math.max(Math.abs((p1[1] - p2[1])/2), minSpanY);\n    const cp1 = _resolveControlPoint(p1, start_dir, spanx, spany);\n    const cp2 = _resolveControlPoint(p2, end_dir, spanx, spany);\n    const arrowspan = [DIRECTION.TOP, DIRECTION.LEFT].includes(end_dir) ? -5 : 5;\n    const isVerticalEnd = [DIRECTION.TOP, DIRECTION.BOTTOM].includes(end_dir);\n    const endX = isVerticalEnd ? p2[0] : p2[0] + arrowspan;\n    const endY = isVerticalEnd ? p2[1] + arrowspan : p2[1];\n    return [ \n        ...cp1,\n        ...cp2,\n        endX, endY];\n}\n\nexport function bezierPoint(t, P) {\n    const q = 1-t;\n    const x = q*q*q*P[0] + 3*q*q*t*P[2] + 3*q*t*t*P[4] + t*t*t*P[6];\n    const y = q*q*q*P[1] + 3*q*q*t*P[3] + 3*q*t*t*P[5] + t*t*t*P[7];\n    const u = q*q*(P[2]-P[0]) + 2*t*q*(P[4]-P[2]) + t*t*(P[6]-P[4]);\n    const v = q*q*(P[3]-P[1]) + 2*t*q*(P[5]-P[3]) + t*t*(P[7]-P[5]);\n    let angle = Math.atan2(v, u);\n    // console.log(angle * 180)\n    // if(angle < 0) {\n    //     angle = Math.PI + angle;\n    // }\n    return [x, y, angle];\n}\n\n// export function bezierPoints(p1, p2, start_vec, end_vec) {\n\n// }\n\nexport function distToBezierSegmentSquared(p, points) {\n    const b = new Bezier(...points);\n\n    const point = b.project({ x: p[0], y: p[1] });\n    const d = dist2(p, [ point.x, point.y ]);\n    return d;\n}\n\nexport function getBezierAngle(t, sx, sy, cp1x, cp1y, cp2x, cp2y, ex, ey) {\n  var dx = Math.pow(1-t, 2)*(cp1x-sx) + 2*t*(1-t)*(cp2x-cp1x) + t * t * (ex - cp2x);\n  var dy = Math.pow(1-t, 2)*(cp1y-sy) + 2*t*(1-t)*(cp2y-cp1y) + t * t * (ey - cp2y);\n  return -Math.atan2(dx, dy) + 0.5*Math.PI;\n}\n\n\nexport function getInstanceHeight(instance) {\n    const rect = instance.getBoundingRect();\n    // let min_y = Infinity;\n    // let max_y = -Infinity;\n    // let min_x = Infinity;\n    // let max_x = -Infinity;\n    // rect.forEach(point => {\n    //     max_y = Math.max(max_y, point[1]);\n    //     min_y = Math.min(min_y, point[1]);\n    //     max_x = Math.max(max_x, point[0]);\n    //     min_x = Math.min(min_x, point[0]);\n    // });\n    return {\n        height: rect[3] - rect[1],\n        width: rect[2] - rect[0],\n    }\n}\n\nexport function polylinePoints(points, p1, p2, start_dir = DIRECTION.TOP, end_dir = DIRECTION.TOP, minSpanX = 10, minSpanY = 10, isSelf) {\n    const dirSpan = Math.abs(start_dir - end_dir);\n    // const spanx = Math.max(Math.abs((p1[0] - p2[0])/2), minSpanX);\n    // const spany = Math.max(Math.abs((p1[1] - p2[1])/2), minSpanY);\n    const isVerticalStart = (start_dir === DIRECTION.TOP || start_dir === DIRECTION.BOTTOM);\n    points.length = 0;\n    switch (dirSpan) {\n        case 0:\n            // 都按向右好了\n            if(start_dir === DIRECTION.TOP) {\n                const y = Math.min(p1[1], p2[1]);\n                const yp = y - minSpanY;\n                points.push([p1[0], yp]);\n                points.push([p2[0], yp]);\n            }\n            if(start_dir === DIRECTION.BOTTOM) {\n                const y = Math.max(p1[1], p2[1]);\n                const yp = y + minSpanY;\n                points.push([p1[0], yp]);\n                points.push([p2[0], yp]);\n            }\n            if(start_dir === DIRECTION.LEFT) {\n                const x = Math.min(p1[0], p2[0]);\n                const xp = x - minSpanX;\n                points.push([xp, p1[1]]);\n                points.push([xp, p2[1]]);\n            }\n            if(start_dir === DIRECTION.RIGHT) {\n                const x = Math.max(p1[0], p2[0]);\n                const xp = x + minSpanX;\n                points.push([xp, p1[1]]);\n                points.push([xp, p2[1]]);\n            }\n            break;\n        case 1:\n        case 3:  \n            if(isSelf) {\n                if(!isVerticalStart) {\n                    points.push([p1[0] + minSpanX, p1[1]]);\n                    points.push([p1[0] + minSpanX, p2[1] + minSpanY]);\n                    points.push([p2[0], p2[1] + minSpanY]);\n                } else {\n                    points.push([p1[0], p1[1] + minSpanY]);\n                    points.push([p2[0] + minSpanX, p1[1] + minSpanY]);\n                    points.push([p2[0] + minSpanX, p2[1]]);\n                }\n            } else {\n                const point = isVerticalStart ? [p1[0], p2[1]]: [p2[0], p1[1]]\n                points.push(point);\n            }\n            break;\n        case 2:\n            const pmiddle = [\n                (p1[0] - p2[0])/2 + p2[0],\n                (p1[1] - p2[1])/2 + p2[1]\n            ]; \n            if(isVerticalStart) {\n                points.push([p1[0], pmiddle[1]])\n                points.push([p2[0], pmiddle[1]])\n            } else {\n                points.push([pmiddle[0], p1[1]])\n                points.push([pmiddle[0], p2[1]])\n            }\n            break;\n        default:\n            break;\n    }\n    points.unshift(p1);\n    points.push(p2);\n}\n\nfunction minusVec(p1, p2) {\n    return [p1[0] - p2[0], p1[1] - p2[1]]\n}\n\nfunction absVec(vec) {\n    return Math.sqrt(vec[0] * vec[0] + vec[1] * vec[1]);\n}\n\nfunction scaleVec(vec, scale) {\n    return [vec[0] * scale, vec[1] * scale];\n}\n\nexport function makeRadiusFromVector(pbefore, p, pnext, radius) {\n    const vec1 = minusVec(p, pbefore);\n    const vec2 = minusVec(p, pnext);\n    const absVec1 = absVec(vec1);\n    const absVec2 = absVec(vec2);\n    if(!absVec1 || !absVec2) {\n        return {\n            p1: null,\n            p2: null,\n        }\n    }\n    const r1 = scaleVec(vec1, radius/absVec1);\n    const r2 = scaleVec(vec2, radius/absVec2);\n    return {\n        p1: minusVec(p, r1),\n        p2: minusVec(p, r2),\n    }\n}\n// 矩形重叠计算\nexport function doOverlap(rec1, rec2) {\n    if (rec1[0] == rec1[2] || rec1[1] == rec1[3] ||\n        rec2[0] == rec2[2] || rec2[1] == rec2[3]) {\n        // the line cannot have positive overlap\n        return false;\n    }\n\n    return !(rec1[2] <= rec2[0] ||   // left\n                rec1[3] <= rec2[1] ||   // bottom\n                rec1[0] >= rec2[2] ||   // right\n                rec1[1] >= rec2[3]);    // top\n}\n\nexport function isPolyLineIntersectionRectange(polyline, rect) {\n    let p = polyline[0];\n    let l = polyline.length;\n    let i = 1;\n    const [l0, l1, r0, r1] = rect;\n    while (i < l) {\n        const cp = polyline[i];\n        if(p[0] === cp[0]) {\n            // vertical\n            if(p[0] < r0 && p[0] > l0 \n                && !((p[1] > r1 && cp[1] > r1) || (p[1] < l1 && cp[1] < l1))){\n                    return true;\n                } \n        } else {\n            // horizontal\n            if(p[1] < r1 && p[1] > l1\n                && !((p[0] > r0 && cp[0] > r0) || (p[0] < l0 && cp[0] < l0))){\n                    return true;\n                } \n        }\n        p = cp;\n        i++;\n    }\n    return false;\n}\n\nexport function debounce(func, timeout = 300){\n    let timer;\n    return () => {\n      clearTimeout(timer);\n      timer = setTimeout(() => { func.call(this); }, timeout);\n    };\n  }\n\nexport function compareBoundingbox(a, b) {\n    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\nexport function copyBoundingbox(a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = b[3];\n}","// import { setUniqueId, getUniqueId } from '../utils/functions';\n// import { nextDirection } from '../utils/constance';\n// const margin = 5;\nconst ishitKey = Symbol('ishit');\nconst isInViewBox = Symbol('isInViewBox');\n/**\n * @typedef Instance~Configs\n * @type {object}\n * @property {number} borderWidth      - 边的宽度 默认是 2\n * @property {string} borderColor      - 边框颜色 默认 black\n * @property {string} color            - 填充颜色 默认 white\n * @property {string} shadowColor      - 阴影颜色\n * @property {string} shadowBlur       - 阴影扩散范围\n * @property {string} shadowOffsetX    - 阴影偏移 X\n * @property {string} shadowOffsetX    - 阴影偏移 Y\n */\n\n/** \n * 图中的最小单元\n * @constructor Instance\n * @extends EventTarget\n * @param {Instance~Configs} configs - 最小单元的一些通用属性配置\n */\nclass Instance extends EventTarget{\n    constructor(configs = {}) {\n        super();\n        Object.assign(this, configs);\n        // this.anchor = configs.anchor || [0, 0];\n        // this.belongs = undefined;\n        /** @member {boolean}      - 元素可见 默认 true */\n        this.visible = true;\n        // this._jflow = undefined;\n        this._belongs = undefined;\n        this[ishitKey] = false; \n\n        /** @member {number}      - 边的宽度 默认是 0 */\n        this.borderWidth =      configs.borderWidth || 0;\n        /** @member {string}     - 边框颜色 默认 transparent */\n        this.borderColor =      configs.borderColor || 'transparent';\n        /** @member {string}     - 填充颜色 默认 transparent */\n        this.backgroundColor =  configs.backgroundColor || 'transparent';\n        /** @member {string}     - 阴影颜色 空就不显示阴影 */\n        this.shadowColor =      configs.shadowColor;\n        /** @member {string}     - 阴影扩散范围 默认 5 */\n        this.shadowBlur  =      configs.shadowBlur || 5;\n        /** @member {string}     - 阴影偏移 X */\n        this.shadowOffsetX =    configs.shadowOffsetX || 0;\n        /** @member {string}     - 阴影偏移 Y */\n        this.shadowOffsetY =    configs.shadowOffsetY || 0;\n        /** @member {number}     - 透明度 */\n        this.opacity  =         configs.opacity || 1\n\n        this._boundingrect = [0,0,0,0];\n    }\n    /**\n     * @member {boolean} - 当前单元选中状态\n     */\n    get _isTargeting() {\n        return this === (this._jflow._target.instance || this._jflow._target.link);\n    }\n    /**\n     * @member {boolean} - 当前单元移动状态\n     */\n    get _isMoving() {\n        return this === this._jflow._getMovingTarget() && this._jflow._target.status.movingState; // 移动了之后才能被当做移动状态\n    }\n    /**\n     * @member {boolean}  - 当前单元碰撞检测状态\n     */\n    get _isHit() {\n        return this[ishitKey];\n    }\n    /**\n     * @member {JFlow}  - canvas上 jflow 实体\n     */\n    get _jflow() {\n        return this._belongs.uniqueName === 'jflow' ? this._belongs : this._belongs._jflow;\n    }\n\n    set _isHit(ishit) {\n        if(this[ishitKey] !== ishit) {\n            /**\n             * 鼠标移入事件\n             *\n             * @event Instance#mouseenter\n             * @type {object}\n             * @property {Instance} instance      - 移入的对象 \n             */\n            /**\n             * 鼠标移出事件\n             *\n             * @event Instance#mouseleave\n             * @type {object}\n             * @property {Instance} instance      - 移入的对象 \n             */\n            this.dispatchEvent(new CustomEvent(ishit ? 'mouseenter': 'mouseleave' , {\n                detail: {\n                    instance: this,\n                    jflow: this._jflow\n                }\n            }));\n        }\n        this[ishitKey] = ishit; // validation could be checked here such as only allowing non numerical values\n    }\n\n    get isInViewBox() {\n        return this[isInViewBox];\n    }\n\n    set _isInViewBox(val) {\n        const oldval = this[isInViewBox];\n        if(val !== oldval) {\n            if(val) {\n                this.onEnterViewbox();\n            } else {\n                this.onLeaveViewbox();\n            } \n        }    \n        this[isInViewBox] = val;\n    }\n\n    /**\n     * 当节点离开可视区域的回调\n     */\n    onEnterViewbox() {\n        return;\n    }\n\n    /**\n     * 当节点离开可视区域的回调\n     */\n    onLeaveViewbox() {\n        return;\n    }\n\n    /**\n     * 改变当前配置\n     * @param {Configs} configs - The string containing two comma-separated numbers.\n     */\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k]\n            }\n        })\n    }\n    /**\n     * 绘制单元\n     * @param {Context2d} ctx \n     */\n    render(ctx) {\n        throw 'require render implement'\n    }\n    /**\n     * 判断当前单元是否被命中\n     * @param {number[]} point \n     * @return {Boolean}\n     */\n    isHit(point) {\n        throw 'require isHit implement'\n    }\n    /**\n     * 计算当前的最大外接矩形的\n     * @return {number[]} [leftx, lefty, rightx, righty]\n     */\n    getBoundingRect() {\n        throw 'require getBoundingRect implement'\n    }\n    calculateIntersection() {\n        throw 'require calculateIntersection implement'\n    }\n    /**\n     * 计算当前连线接入点的位置\n     * @return {Object} intersection 交叉点\n     * @return {number} intersection[DIRECTION.TOP] 上\n     * @return {number} intersection[DIRECTION.BOTTOM] 下\n     * @return {number} intersection[DIRECTION.LEFT] 上\n     * @return {number} intersection[DIRECTION.RIGHT] 右\n     */\n    getIntersectionsInFourDimension() {\n        throw 'require getIntersectionsInFourDimension implement'\n    }\n\n\n    /**\n     * 获取当前所在层级的坐标\n     * @return {Number[]} 坐标\n     */\n    getCenter() {\n        return this.anchor;\n    }\n    /**\n     * 获取宽高\n     * @return {Object} demension 宽高\n     * @return {number} demension.width 宽\n     * @return {number} demension.height 高\n     */\n    getBoundingDimension() {\n        const rect = instance.getBoundingRect();\n        let min_y = Infinity;\n        let max_y = -Infinity;\n        let min_x = Infinity;\n        let max_x = -Infinity;\n        rect.forEach(point => {\n            max_y = Math.max(max_y, point[1]);\n            min_y = Math.min(min_y, point[1]);\n            max_x = Math.max(max_x, point[0]);\n            min_x = Math.min(min_x, point[0]);\n        });\n        return {\n            height: max_y - min_y,\n            width: max_x - min_x,\n        }\n    }\n    /**\n     * 冒泡事件\n     * @param {JFlowEvent} customEvent 自定义事件\n     */\n    bubbleEvent(customEvent){\n        customEvent.detail.currentTarget = this;\n        this.dispatchEvent(customEvent);\n        if(customEvent.detail.bubbles){\n            if(this._belongs.bubbleEvent) {\n                this._belongs.bubbleEvent(customEvent);\n            } else {\n                this._belongs.dispatchEvent(customEvent); \n            }\n            \n        }\n    }\n    /**\n     * 反算回页面的像素坐标\n     * @param {Number[]} point\n     * @return {Number[]} 世界坐标\n     */\n    calculateToRealWorld(point) {\n        if(this._belongs && this._belongs.calculateToRealWorld) {\n            return this._belongs.calculateToRealWorld(point);\n        } else {\n            return point;\n        }\n    }\n\n    calculateToRealWorldWithScalar(length){\n        return this._jflow.scale * length;\n    }\n\n    /**\n     * 从当前布局中删除虚拟布局节点\n     */\n    // removeFromLayoutSource() {\n    //     if(this._layoutNode) {\n    //         this._layoutNode.remove();\n    //     }\n    // }\n\n    recalculateUp() {\n        if(this.belongs) {\n            this.belongs.recalculateUp();\n        }\n    }\n\n    destroy() {\n        // this._belongs = undefined;\n        // this.removeEventListener();\n    }\n}\n\nexport default Instance;","import Instance from './instance';\nimport { doOverlap } from '../utils/functions';\n\n/**\n * 绝对定位 配置， 绝对定位不受布局影响，相对于当前组来定位\n * @typedef {object} Node~AbsolutePosition \n * @property {number} top       - 上距离\n * @property {number} bottom    - 下距离\n * @property {number} right     - 右距离\n * @property {number} left      - 左距离\n */\n/**\n * Node 配置\n * @typedef {Instance~Configs} Node~Configs \n * @property {number[]} anchor - 坐标\n * @property {Node~AbsolutePosition} absolutePosition - 绝对定位位置\n */\n/**\n * 节点基类\n * @constructor Node\n * @extends Instance\n * @param {Node~Configs} configs - 节点配置\n */\nclass Node extends Instance {\n    constructor(configs = {}) {\n        super(configs);\n        this._rawConfigs = configs;\n        // for layout\n        /** @member {number[]} */\n        this.anchor =           configs.anchor || [0, 0];\n        /** @member {Node~AbsolutePosition} */\n        this.absolutePosition = configs.absolutePosition;\n    }\n\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k]\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n    }\n    setAnchorX(x) {\n        this.anchor[0] = x;\n    }\n    setAnchorY(y) {\n        this.anchor[1] = y;\n    }\n    setAnchor(x, y) {\n        this.anchor[0] = x;\n        this.anchor[1] = y;\n    }\n\n    beforeRender() {\n        return doOverlap(this._belongs._getViewBox(), this.getBoundingRect())\n    }\n\n    /**\n     * 克隆当前节点.\n     * @return {Node} 当前节点的副本\n     */\n    clone() {\n        const C = this.constructor;\n        const t = new C(this._rawConfigs);\n        t.visible = this.visible;\n        return t;\n    }\n}\n\nexport default Node;","import Node from './node';\nimport { DIRECTION } from '../utils/constance';\n\nclass GhostNode extends Node {\n    constructor(configs) {\n        super(configs);\n    }\n\n    render(ctx) {}\n\n    isHit(point) {\n        return false;\n    }\n    calculateIntersection(point) {\n        return this.anchor;\n    }\n\n    getBoundingRect() {\n        const [x2, y2] = this.anchor;\n        return [x2, y2, x2, y2]\n    }\n\n    getBoundingDimension() {\n        return {\n            width: 0, height: 0\n        }\n    }\n\n    getIntersectionsInFourDimension() {\n        const [x2, y2] = this.anchor;\n        return {\n            [DIRECTION.RIGHT]:  [x2+1, y2],\n            [DIRECTION.LEFT]:   [x2-1, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+1],\n            [DIRECTION.TOP]:    [x2, y2-1],\n        }\n    }\n}\n\nexport default GhostNode;","function getMapObject() {\n    return {\n        layoutNode: undefined,\n        jflowNode: undefined,\n        jflowlinks: [],\n        jflowFromLinks: [],\n        jflowToLinks: [],\n    }\n}\nclass NodeWeakMap {\n    constructor() {\n        this._map = new WeakMap();\n    }\n\n    get(source) {\n        return this._map.get(source);\n    }\n\n    set(source) {\n        const obj = getMapObject();\n        this._map.set(source, obj);\n        return obj;\n    }\n\n    has(source) {\n        return this._map.has(source);\n    }\n\n    delete(source) {\n        this._map.delete(source);\n    }\n\n    clear() {\n        this._map.clear();\n    }\n}\n\nexport const NodeWeakMapMixin = {\n    initNodeWeakMap() {\n        this.source_Layout_Render_NodeMap = new NodeWeakMap();\n    },\n    getRenderNodeBySource(source) {\n        const mapping = this.source_Layout_Render_NodeMap.get(source);\n        if(mapping) {\n            return mapping.jflowNode;\n        }\n        return undefined;\n    },  \n    getLayoutNodeBySource(source) {\n        const mapping = this.source_Layout_Render_NodeMap.get(source);\n        if(mapping) {\n            return mapping.layoutNode;\n        }\n        return undefined;\n    },\n    getSourceRenderMeta(source) {\n        const map = this.source_Layout_Render_NodeMap;\n        return map.get(source)\n    },\n    _getMap(source) {\n        const map = this.source_Layout_Render_NodeMap;\n        let obj;\n        if(map.has(source)) {\n            obj = map.get(source);\n        } else {\n            obj = map.set(source);\n        }\n        return obj\n    },\n    setLayoutNodeBySource(source, layoutNode) {\n        let obj = this._getMap(source);\n        obj.layoutNode = layoutNode;\n    },\n    setRenderNodeBySource(source, instance) {\n        let obj = this._getMap(source);\n        obj.jflowNode = instance;\n    },\n    addLinkNodeBySource(sourceFrom, sourceTo, link) {\n        let obj = this._getMap(sourceFrom);\n        obj.jflowFromLinks.push(link);\n\n        obj = this._getMap(sourceTo);\n        obj.jflowToLinks.push(link);\n    },\n    removeLinkNodeBySource(sourceFrom, sourceTo, link) {\n        let obj = this._getMap(sourceFrom);\n        let idx = obj.jflowFromLinks.findIndex(l => l === link);\n        if(idx !== -1) {\n            obj.jflowFromLinks.splice(idx, 1);\n        }\n\n        obj = this._getMap(sourceTo);\n        idx = obj.jflowToLinks.findIndex(l => l === link);\n        if(idx !== -1) {\n            obj.jflowToLinks.splice(idx, 1);\n        }\n    }\n}\n\nexport default NodeWeakMap;\n\n","/**\n * 绘图栈\n * @extends Array\n */\nclass InstanceStack extends Array {\n    constructor() {\n        super();\n        this._currentHit = null;\n    }\n    /**\n     * 绘制当前栈\n     * @param {Context2d} ctx - canvas context2d\n     */\n    render(ctx, condition) {\n        let movingTarget;\n        this.forEach(instance => {\n            if(instance._isMoving) {\n                movingTarget = instance;\n                return;\n            }\n            if(instance.visible && (!condition || condition(instance))) {\n                if(instance.beforeRender) {\n                    if(!instance.beforeRender(ctx)){\n                        return;\n                    }\n                }\n                ctx.save();\n                instance.render(ctx);\n                ctx.restore();\n            }\n        });\n        if(movingTarget) {\n            ctx.save();\n            // if(movingTarget.reflow && !movingTarget._reflowed) {\n            //     movingTarget.reflow();\n            //     movingTarget._reflowed = true;\n            // }\n            movingTarget.render(ctx);\n            ctx.restore();\n        }\n    }\n\n    resetHitStatus() {\n        this._currentHit = null;\n        this.forEach(i => {\n            if(i._stack) {\n                i._stack.resetHitStatus();\n            }\n            i._isHit = false;\n        })\n    }\n\n    /**\n     * 碰撞对象过滤条件\n     * @name InstanceStack~InstanceFilter\n     * @function\n     * @param {Instance} instance - 当前对象\n    */\n    /**\n     * 碰撞检测\n     * @param {number[]} point - 碰撞点\n     * @param {InstanceStack~InstanceFilter} condition - 碰撞对象过滤条件\n     * @return {Instance}\n     */\n    checkHit(point, condition, currentConstraint){\n        let i = this.length - 1;\n        while(i >= 0) {\n            const instance = this[i];\n            \n            if(instance.visible && !instance.ignoreHit) {\n                if(condition && condition(instance)) {\n                    i--\n                    continue;\n                }\n                if(currentConstraint && !currentConstraint(instance)) {\n                    i--\n                    continue\n                }\n                const ishit = instance.isHit(point, condition);\n                \n                if(ishit) {\n                    if(this._currentHit !== instance) {\n                        if(this._currentHit) {\n                            this._currentHit._isHit = false;\n                        }\n                        instance._isHit = true;\n                        this._currentHit = instance;\n                    }\n                    if(typeof ishit !== 'boolean') {\n                        return ishit;\n                    }\n                    return instance;\n                } else {\n                    instance._isHit = false;\n                }\n                \n            }\n            i--\n        }\n        this._currentHit = null;\n        return null;\n    }\n    /**\n     * 获取当前层栈的最小外接矩形\n     * @return {number[][]} - 外接矩形坐标\n     */\n    getBoundingRectPoints() {\n        const points = [];\n        this.forEach(instance => {\n            if(instance.visible && !instance.absolutePosition) {\n                const rect = instance.getBoundingRect()\n                points.push([rect[0], rect[1]]);\n                points.push([rect[2], rect[3]]);\n            }\n        });\n        return points;\n    }\n\n    /**\n     * 获取当前层栈的锚点矩形\n     * @return {number[][]} - 锚点矩形坐标\n     */\n    getAnchorRectPoints() {\n        const points = [];\n        this.forEach(instance => {\n            if(instance.visible && !instance.absolutePosition) {\n                points.push(instance.anchor);\n            }\n        });\n        return points;\n    }\n}\n\nexport default InstanceStack;\n","import InstanceStack from './stack';\n// import { setUniqueId, getUniqueId } from '../utils/functions';\n/**\n * 对象栈 mixin 用于方便控制节点栈和连线栈\n *\n * @mixin\n */\nconst StackMixin = {\n    /** @property {Node[]}          - 对象数组 */\n    instances: [],\n    /** @property {BaseLink[]}      - 连线数组 */\n    links: [],\n    /** @property {InstanceStack}       - 对象栈 */\n    _stack: null,\n    /** @property {InstanceStack}       - 连线栈 */\n    _linkStack: null,\n    /**\n     * 初始化对象栈\n     * @param {JflowConfigs} configs - 配置\n     */\n    initStack({ data }) {\n        this._stack = new InstanceStack();\n        this._linkStack = new InstanceStack();\n        if(!data) return;\n        this.instances = data.instances;\n        this.links = data.links;\n        this.instances.forEach(i => { \n            this._stack.push(i);\n            i._belongs = this;\n        })\n        this.links.forEach((link) => {\n            this._linkStack.push(link);\n            link._belongs = this;\n        });\n    },\n    /**\n     * 加入节点对象\n     * @param {Node} instance - 节点对象\n     */\n    addToStack(instance) {\n        instance._belongs = this;\n        this._stack.push(instance);\n        // this.recalculate()\n    },\n    /**\n     * 替换对象\n     * @param {Instance} target - 被替换的对象\n     * @param {Instance} instance - 替换对象\n     */\n    replaceFromStack(target, instance) {\n        const index = this._stack.findIndex(i => i === target);\n        this._stack.splice(index, 1, instance);\n        target._belongs = null;\n        instance._belongs = this;\n        // this.recalculate()\n    },\n    /**\n     * 加入连线对象\n     * @param {BaseLink} instance - 连线对象\n     */\n    addToLinkStack(link) {\n        link._belongs = this;\n        this._linkStack.push(link);\n    },\n    /**\n     * 删除节点对象\n     * @param {Node} target - 节点对象\n     */\n    removeFromStack(target) {\n        // this.removeLinkOnInstance(target);\n        const index = this._stack.findIndex(i => i === target);\n        if(index !== -1) {\n            this._stack.splice(index, 1);\n        }\n        // this.recalculate()\n    },\n    /**\n     * 删除连线对象\n     * @param {Node} target - 连线对象\n     */\n    removeFromLinkStack(target) {\n        const index = this._linkStack.findIndex(i => i === target);\n        if(index !== -1) {\n            this._linkStack.splice(index, 1);\n        }\n    },\n   \n    emptyLink() {\n        this._linkStack = new InstanceStack();\n    },\n    /**\n     * 重置当前栈中对象的位置\n     */\n    resetChildrenPosition() {\n        this._stack.forEach(i => {\n            i.anchor = [0,0]\n        });\n    },\n\n    addInstanceToLink(targetLink, instance) {\n        this.addToStack(instance);\n        const { from, to } = targetLink;\n        const index = this._linkStack.findIndex(l => l === targetLink);\n        const _constuctor = targetLink.__proto__.constructor;\n        const l1 = new _constuctor({\n            from, \n            to: instance,\n        });\n        l1._belongs = this;\n        const l2 = new _constuctor({\n            from: instance, \n            to,\n        });\n        l2._belongs = this;\n\n        this._linkStack.splice(index, 1, l1, l2);\n    },\n    \n    /**\n     * 循环当前栈中节点\n     * @property {stackIteratorCallback} 循环访问栈中每个节点\n     */\n    interateNodeStack(callback) {\n        this._stack.forEach(instance => {\n            callback(instance);\n        })\n    }   \n    /**\n    * 循环访问栈中每个节点\n    * @callback stackIteratorCallback\n    * @param {Node} instance 栈中节点\n    */\n}\n\nexport default StackMixin;","/**\n * Layout mixin 配置\n * @typedef {Object} LayoutMixin~LayoutConfigs\n * @property {Layout} layout             - 布局对象 \n */\n/**\n * 布局 mixin 用于注册和方便控制布局\n *\n * @mixin\n */\nconst LayoutMixin = {\n    /** @property {Layout}      - 布局对象 */\n    _layout: null,\n    /**\n     * 初始化布局\n     * @param {LayoutMixin~LayoutConfigs} configs - 配置\n     */\n    initLayout(configs) {\n        this._layout = configs.layout;\n    },\n    /**\n     * 从当前层出发，向上层递归重排\n     */\n    recalculateUp() {\n        let dirty = true;\n        if(this.getBoundingDimension) {\n            const { width: wold, height: hold } = this.getBoundingDimension();\n            if(this.resetChildrenPosition) {\n                this.resetChildrenPosition();\n            }\n            if(this._getBoundingGroupRect){\n                this._getBoundingGroupRect();\n            }\n            this.reflow();\n            if(this._getBoundingGroupRect){\n                this._getBoundingGroupRect();\n            }\n            const { width: wnow, height: hnow } = this.getBoundingDimension();\n            dirty = (wold !== wnow || hold !== hnow)\n        } else {\n            this.reflow();\n        }\n        if(this._belongs && dirty) {\n            this._belongs.recalculateUp();\n        }\n    },\n    /**\n     * 重新计算布局，相当于浏览器里面重排，并重算当前布局下的最小外接矩形\n     */\n    recalculate() {\n        this.reflow();\n        if(this._getBoundingGroupRect){\n            this._getBoundingGroupRect();\n        }\n    },\n    /**\n     * 布局静态检查\n     * @param {Instance} instance - 检查单元\n     * @return {Boolean} - 检查结果 \n     */\n    staticCheck(instance) {\n        if(this._layout) {\n            return this._layout.staticCheck(instance, this);\n        }\n        return false;\n    },\n    /**\n     * 重新计算布局，相当于浏览器里面重排\n     */\n    reflow() {\n        if(this._layout) {\n            this._layout.reflow(this);\n        }\n    },\n}\n\nexport default LayoutMixin;","/**\n * 消息 mixin 用于给Jflow传递消息\n *\n * @mixin\n */\nconst MessageMixin = {\n    _message: null,\n    /**\n     * 发送消息\n     * @param {Object} msg - 消息体\n     */\n    sendMessage(msg) {\n        this._message = msg;\n    },\n    /**\n     * 接收消息\n     * @return {Object} msg - 消息体\n     */\n    consumeMessage() {\n        const msg = this._message;\n        this._message = null;\n        return msg;\n    },\n    readMessage() {\n        return this._message;\n    }\n}\n\nexport default MessageMixin;","\nexport default {\n    initAnime() {\n        this.anime_queue = [];\n        this.__animeClock__ = undefined;\n        // this.animeclock = undefined;\n        // this.frameRendered = false;\n    },\n    // setAnimeClock(time) {\n    //     if(time !== this.animeclock) {\n    //         this.frameRendered = false;\n    //         this.animeclock = time;\n    //     }\n    // },\n\n    // hasAnimeAndFrameRendered() {\n    //     return this.anime_queue.length && this.frameRendered;\n    // },\n\n    // setFrameRendered() {\n    //     if(this.anime_queue.length) {\n    //         this.frameRendered = true;\n    //     }\n    // },\n\n    requestJFlowAnime(frameCallBack) {\n        const meta = this.enqueueAnime(frameCallBack);\n        this._runAnime();\n        return meta;\n    },\n\n    enqueueAnime(callback) {\n        const animeMeta = {\n            start: undefined,\n            callback,\n            cancel: () => {\n                this._cancelAnime(animeMeta);\n                this._render();\n            }\n        }\n        this.anime_queue.push(animeMeta);\n        return animeMeta;\n    },\n\n    _cancelAnime(meta) {\n        const idx = this.anime_queue.findIndex(m => m === meta);\n        ~idx && this.anime_queue.splice(idx, 1);\n        \n    },\n\n    runAnime() {\n        this._runAnime();\n        // requestAnimationFrame(this._runAnime.bind(this));\n    },\n    _runAnime() {\n        if (this.anime_queue.length) {\n            requestAnimationFrame(() => {\n                this.scheduleRender();\n                this._runAnime();\n            })  \n            // requestAnimationFrame(this._runAnime.bind(this))\n        }\n    },\n\n    runAnimeFrame() {\n        this.anime_queue.forEach(meta => {\n            const timestamp = Date.now();\n            if(!meta.start) {\n                meta.start = timestamp;\n            }\n            const elapsed = timestamp - meta.start;\n            meta.callback(elapsed);\n        });\n    }\n}","import { createCanvas } from '../utils/canvas';\nexport default {\n    // 传入一个别的 context2d 来绘制\n    captureMap(wrapper, {\n        padding = 0,\n        placement = 'normal',\n    }) {\n\n        this._getBoundingGroupRect();\n        const { \n            width: p_width, \n            height: p_height, \n            x: p_x, \n            y: p_y \n        } = this.bounding_box;\n        let miniMap = this.miniMap;\n        if(!miniMap) {\n            this.miniMap = createCanvas(wrapper);\n            const {\n                width, height,\n                raw_width,\n                raw_height,\n            } = this.miniMap;\n            this.addEventListener('zoompan', () => {\n                this._renderMap && this._renderMap();\n            })\n            let pressDown = false;\n            this.miniMap.canvas.addEventListener('pointerdown', (event) => {\n                let { offsetX, offsetY, deltaX, deltaY } = event\n                pressDown = true;\n                this._onMoveMap && this._onMoveMap(offsetX, offsetY)  \n            })\n            this.miniMap.canvas.addEventListener('pointermove', (event) => {\n                let { offsetX, offsetY, deltaX, deltaY } = event\n                if(pressDown) {\n                    this._onMoveMap && this._onMoveMap(offsetX, offsetY)\n                }\n                if(offsetY < 5 || offsetX < 5 || offsetX > width-5 || offsetY > height-5) {\n                    pressDown = false;\n                }\n            })\n            this.miniMap.canvas.addEventListener('pointerup', () => {\n                pressDown = false;\n            })\n\n            const caheCanvas = document.createElement('canvas');\n            caheCanvas.width = raw_width;\n            caheCanvas.height = raw_height;\n            this.cacheMinimapCtx = caheCanvas.getContext('2d');\n        }\n        const { \n            width,\n            height,\n            raw_width,\n            raw_height,\n            left,\n            top,\n            scale,\n            ctx\n        } = this.miniMap\n        const pad2 = padding * 2;\n        const pad = padding;\n        const r1 = (width - pad2) / p_width;\n        const r2 = (height - pad2) / p_height;\n        const r = Math.min(r1, r2);\n        \n        let m_x = 0;\n        let m_y = 0;\n\n        if(placement === 'center') {\n            m_y = (height - p_height * r) / 2 - p_y * r;\n            m_x = (width - p_width * r) / 2 - p_x * r;\n        } else {\n            if(r1 < r2) {\n                m_y = (height - p_height * r) / 2 - p_y * r;\n                m_x = pad;\n            } else {\n                m_x = (width - p_width * r) / 2 - p_x * r;\n                m_y = pad;\n            }\n        }\n        const cachectx = this.cacheMinimapCtx;\n        cachectx.setTransform();\n        cachectx.clearRect(0, 0, raw_width, raw_height);\n        cachectx.scale(scale, scale);\n        cachectx.transform(r, 0, 0, r, m_x, m_y);\n        // ctx.fillStyle = 'red';\n        // ctx.arc( 30, 30, 100, 0, 2*Math.PI);\n        // ctx.fill()\n        // debugger\n        const br = [0,0,0,0]\n        if(this.NodeRenderTop) {\n            this._linkStack.render(cachectx, (link) => { link.isInViewBox(br); return true; });\n            // this._linkStack.render(cachectx);\n            this._stack.render(cachectx);\n        } else {\n            this._stack.render(cachectx);\n            this._linkStack.render(cachectx, (link) => { link.isInViewBox(br); return true; });\n        }\n        const _cacheMapImageData = cachectx.getImageData(0, 0,raw_width, raw_height);\n        this._renderMap = () => {\n            ctx.save();\n            ctx.setTransform();\n            ctx.clearRect(0, 0, raw_width, raw_height);\n            // if(!i) {\n            ctx.scale(scale, scale);\n            ctx.putImageData(_cacheMapImageData, 0, 0);\n            ctx.transform(r, 0, 0, r, m_x, m_y);\n            const [x, y, t, d] = this._getViewBox();\n            ctx.beginPath();\n            ctx.rect(x, y,  t-x, d-y);\n            ctx.setTransform();\n            ctx.rect(0, 0, raw_width, raw_height);\n            ctx.clip(\"evenodd\");\n            \n            ctx.fillStyle = 'rgba(0,0,0,0.4)';\n            ctx.fillRect(0, 0, raw_width, raw_height);\n            ctx.restore();\n            // }\n        }\n        this._renderMap();\n\n        this._onMoveMap = (offsetX, offsetY) => {\n            const [x, y, t, d] = this._getViewBox();\n            // const w = t-x;\n            const a = (t-x)/2 + x;\n            const b = (d-y)/2 + y;\n            \n            const p = [a * r + m_x, b * r + m_y]\n            this._recalculatePosition((p[0] - offsetX)/ r * this.scale, (p[1] - offsetY)/ r * this.scale);\n            this._render();\n            this._renderMap();\n        }\n        // this._render(ctx);\n    }\n\n\n}","export class ScrollBar {\n    constructor(dir, configs = {}) {\n        this.anchor = [0,0];\n        this.width = configs.barWidth || 4;\n        this.height = configs.barWidth || 4;  \n        this.barMarginX = 0;\n        this.barMarginY = 0\n        this.dir = dir;\n        this.plainColor = configs.plainColor || 'rgba(0, 0, 0, 0.15)';\n        this.focusColor = configs.focusColor || 'rgba(0, 0, 0, 0.25)';\n        this.isFocus = false;\n    }\n    render(ctx) {\n        const [x, y] = this.anchor;\n        ctx.save();\n        ctx.beginPath();\n        if(this.dir === 'x') {\n            const radius = this.height / 2;\n            const cy = y + radius;\n            const by = y + this.height;\n            const rc = x + this.width - this.barMarginX*2 - radius;\n            const lc = x + this.barMarginX + radius\n            ctx.moveTo(lc, by);\n            ctx.arc(lc, cy, radius, Math.PI/2, Math.PI/2*3);\n            ctx.lineTo(rc, y);\n            ctx.arc(rc, cy, radius,  -Math.PI/2, Math.PI/2);\n            ctx.closePath();\n  \n        } else {\n            const radius = this.width / 2;\n            const tc = y + this.barMarginY + radius;\n            const bc = y + this.height - this.barMarginY*2 - radius\n            const cx = x + radius;\n            const rx = x + this.width;\n            ctx.moveTo(x, tc);\n            ctx.arc(cx, tc, radius, -Math.PI, 0);\n            ctx.lineTo(rx, bc);\n            ctx.arc(cx, bc, radius, 0, Math.PI);\n            ctx.closePath();\n            \n        }\n                //   ctx.rect(\n                // x + this.barMarginX,\n                // y + this.barMarginY,\n                // this.width - this.barMarginX*2,\n                // this.height - this.barMarginY*2);\n\n        ctx.fillStyle = this.isFocus ? this.focusColor : this.plainColor;\n        ctx.fill();\n        ctx.restore();\n    }\n    isHit(point) {\n        const anchor = this.anchor;\n        const w = this.width;\n        const h = this.height;\n        return point[0] > anchor[0] - 5\n            && point[0] < anchor[0] + w + 5\n            && point[1] > anchor[1] - 5\n            && point[1] < anchor[1] + h + 5;\n    }\n}\nexport default {\n    initScrollBar(configs = {}) {\n        const {\n            barColor,\n            barFocusColor,\n            barMarginX,\n            barMarginY,\n            barWidth,\n        } = configs;\n        this._scrollbarEnable = true;\n        this._scrollbarX = new ScrollBar('x', {\n            plainColor: barColor,\n            focusColor: barFocusColor,\n            barWidth,\n        });\n        this._scrollbarX.barMarginX = barMarginX || 5;\n        \n        this._scrollbarY = new ScrollBar('y', {\n            plainColor: barColor,\n            focusColor: barFocusColor,\n            barWidth\n        });\n        this._scrollbarY.barMarginY = barMarginY || 5;\n\n        this._scrollBarStatus = {\n            dragging: false,\n            target: null,\n            xscale: undefined,\n            yscale: undefined,\n\n            barInitX: 0,\n            barInitY: 0,\n        }\n        \n        this.addEventListener('zoompan', () => {\n            this.scrollBarOnPanAndZoom();\n        })\n        \n        this.scrollBarOnPanAndZoom();\n\n        this.canvas.addEventListener('pointerdown', e => {\n            const { offsetX, offsetY, clientX, clientY } = e;\n            this.onScrollbarPressStart(offsetX, offsetY, clientX, clientY)\n        })\n    },\n    checkScrollDragging() {\n        return this._scrollBarStatus && this._scrollBarStatus.dragging;\n    },\n    onScrollbarPressStart(offsetX, offsetY, clientX, clientY) {\n        const xhit = this._scrollbarX.isHit([offsetX, offsetY]);\n        if(xhit) {\n            Object.assign(this._scrollBarStatus, {\n                dragging: true,\n                target: this._scrollbarX,\n                barStartX: this._scrollbarX.anchor[0],\n                barInitX: clientX,\n            });\n        }\n        const yhit = this._scrollbarY.isHit([offsetX, offsetY]);\n        if(yhit) {\n            Object.assign(this._scrollBarStatus, {\n                dragging: true,\n                target: this._scrollbarY,\n                barStartY: this._scrollbarY.anchor[1],\n                barInitY: clientY,\n            });\n        }\n        const f = (e => {\n            const { offsetX, offsetY, clientX, clientY } = e;\n            this.onDraggingScrollbar(offsetX, offsetY, clientX, clientY)\n        }).bind(this);\n        \n        document.addEventListener('pointermove', f);\n        const t = (e => {\n            Object.assign(this._scrollBarStatus, {\n                dragging: false,\n                target: null,\n                x: undefined,\n                y: undefined,\n            });\n            document.removeEventListener('pointermove', f);\n            document.removeEventListener('pointerup', t);\n            this.canvas.removeEventListener('pointerup', t);\n        }).bind(this);\n        this.canvas.addEventListener('pointerup', t, {\n            once: true\n        })\n        document.addEventListener('pointerup', t, {\n            once: true\n        })\n    },\n    onDraggingScrollbar(offsetX, offsetY, clientX, clientY) {\n        if(this._scrollbarEnable && this._scrollBarStatus.dragging) {\n            const {\n                target,\n                barInitX,\n                barStartX,\n                barInitY,\n                barStartY,\n                xscale,\n                yscale,\n                scollbarHeight,\n                scollbarWidth,\n                realR,\n                realL,\n                realT,\n                realB,\n            } = this._scrollBarStatus;\n            const { actual_width, actual_height } = this.canvasMeta;\n            const { \n                x: p_x, \n                y: p_y \n            } = this.bounding_box;\n            // console.log(target.dir, realT, realB)\n            if(target.dir === 'x') {\n                const deltaX = clientX - barInitX;\n                const xnew = barStartX + deltaX;\n                const q = target.anchor[0] = Math.max(Math.min(xnew, actual_width - scollbarWidth), 0);\n                const ratioInX = q / actual_width;\n                // const y = (realB - (realB - realT) * ratioInY) * this.scale\n                const ratioX = (realR - realL) * ratioInX + realL\n                const x = (p_x - ratioX) * this.scale\n                Object.assign(this.position, {\n                    offsetX: x - p_x * this.scale,\n                    x,\n                });\n            }\n\n            if(target.dir === 'y') {      \n                const deltaY = clientY - barInitY;\n                const ynew = barStartY + deltaY;\n                const q = target.anchor[1] = Math.max(Math.min(ynew, actual_height - scollbarHeight), 0);;\n                const ratioInY = q / actual_height;\n                // const y = (realB - (realB - realT) * ratioInY) * this.scale\n                const ratioY = (realB - realT) * ratioInY + realT\n                const y = (p_y - ratioY) * this.scale\n                Object.assign(this.position, {\n                    offsetY: y - p_y * this.scale,\n                    y,\n                });\n            }\n            this.scheduleRender()\n            return true;\n        }\n        return false;\n    },\n    checkScrollBarHover(offsetX, offsetY) {\n        if(this._scrollbarEnable) {\n            const xhit = this._scrollbarX.isHit([offsetX, offsetY]);\n            if(xhit) {\n                // this._scrollBarStatus.hoverTarget = this._scrollbarX;\n                if(!this._scrollbarX.isFocus) {\n                    this._scrollbarX.isFocus = true;\n                    this.scheduleRender();\n                }\n                this.canvas.style.cursor = 'default';\n                return true;\n            }\n            const yhit = this._scrollbarY.isHit([offsetX, offsetY]);\n            if(yhit) {\n                // this._scrollBarStatus.hoverTarget = this._scrollbarY;\n                if(!this._scrollbarY.isFocus) {\n                    this._scrollbarY.isFocus = true;\n                    this.scheduleRender();\n                }\n                this.canvas.style.cursor = 'default';\n                return true;\n            }\n        }\n        return false;\n    },\n    resetScrollBarHover() {\n        if(this._scrollbarEnable) {\n            if(this._scrollbarY.isFocus || this._scrollbarX.isFocus) {\n                this._scrollbarY.isFocus = false;\n                this._scrollbarX.isFocus = false;\n                this.scheduleRender();\n            }\n        }\n    },\n    _getScrollViewBoundingbox() {\n        const padding = 120;\n        const { \n            width: p_width, \n            height: p_height, \n            x: p_x, \n            y: p_y \n        } = this.bounding_box;\n        const p = padding;\n        const p2 = padding * 2;\n        return {\n            width: p_width + p2,\n            height: p_height + p2,\n            x: p_x - p,\n            y: p_y - p\n        }\n    },\n    scrollBarOnPanAndZoom() {\n        if(!this._scrollbarEnable || this._scrollBarStatus.dragging) {\n            return;\n        }\n        const { \n            width: p_width, \n            height: p_height, \n            x: p_x, \n            y: p_y \n        } = this._getScrollViewBoundingbox();\n        \n        let [x, y, r, b] = this._getViewBox();\n        const realR = Math.max(r, p_x + p_width);\n        const realL = Math.min(x, p_x);\n        const realT = Math.min(y, p_y);\n        const realB = Math.max(b, p_y + p_height);\n        const vw = r - x;\n        const vh = b - y;\n        const { actual_width, actual_height } = this.canvasMeta;\n        const xscale = vw / (realR - realL)\n        if(xscale < 1)  {\n            const scollbarWidth = actual_width * xscale;\n            const anchorX = (x - realL) * xscale * this.scale;\n            this._scrollbarX.anchor = [anchorX, actual_height - 10];\n            this._scrollbarX.width = scollbarWidth;\n            this._scrollBarStatus.scollbarWidth = scollbarWidth;\n        }\n        \n        const yscale = vh / (realB - realT);\n        if(yscale < 1)  {\n            const scollbarHeight = actual_height * yscale;\n            const anchorY = (y - realT) * yscale * this.scale;\n            this._scrollbarY.anchor = [actual_width - 10, anchorY];\n            this._scrollbarY.height = scollbarHeight;\n            this._scrollBarStatus.scollbarHeight = scollbarHeight;\n        }\n\n        Object.assign(this._scrollBarStatus, {\n            yscale,\n            xscale,\n            realR,\n            realL,\n            realT,\n            realB,\n        })\n        \n    },\n    resetScollBarStatus() {\n        if(this._scrollbarEnable) {\n            Object.assign(this._scrollBarStatus, {\n                dragging: false,\n                target: null,\n                x: undefined,\n                y: undefined,\n            });\n        }\n    },\n    renderScrollBar(ctx) {\n        if(this._scrollbarEnable) {\n            ctx.setTransform();\n            ctx.scale(this.dpr, this.dpr);\n            const {\n                xscale,\n                yscale\n            } = this._scrollBarStatus;\n            if(xscale < 1)  {\n                this._scrollbarX.render(ctx);\n            }\n            if(yscale < 1)  {\n                this._scrollbarY.render(ctx);\n            }\n        }\n    }\n}","export default {\n    initSchedule() {\n        this.__clock__ = undefined;\n    },\n    scheduleRender(callback) {\n        requestAnimationFrame((timestamp) => {\n            const isFirstTime = this.__clock__ !== timestamp\n            if(isFirstTime) {\n                this.__render();\n            }\n            if(callback) {\n                callback(timestamp);\n            }\n            this.__clock__ = timestamp;\n        })\n    }\n}","/**\n * JFlow 抛出事件\n * @extends CustomEvent\n * @property {Event}  originEvent      - 原始事件\n * @property {Instance} target         - 事件触发对象\n * @property {JFlow} jflow             - JFlow 对象\n * @property {boolean} bubbles         - 冒泡标识\n */\nclass JFlowEvent extends CustomEvent{\n    constructor(event, configs = {}) {\n        const detail = {\n            ...configs,\n            originEvent: configs.event,\n            target: configs.target,\n            jflow: configs.jflow,\n            bubbles: configs.bubbles || false,    \n        }\n        super(event, {\n            detail\n        });\n    }\n}\n\nexport default JFlowEvent;","/**\n * 事件处理函数\n * @name EventAdapter~Handler\n * @function\n * @param {Event} event - 原生事件\n * @param {JFlow} jflow - 当前jflow 对象\n */\n\n/**\n * EventAdapter 对象 plugin 配置\n * @typedef {Object} EventAdapter~pluginDef\n * @property {Object} canvas - canvas 相关的事件\n * @property {EventAdapter~Handler} canvas.eventName - 注册 canvas 上的事件处理\n * @property {Object} document - document 相关的事件\n * @property {EventAdapter~Handler} document.eventName - 注册 document 上的事件处理\n */\n\nfunction getDefaultPlugin() {\n    let _mouseStatus = {\n        // x: undefined,\n        // y: undefined,\n        // enableClick: false,\n        pointerDown: false,\n        dirty: false,\n    }\n    return {\n        canvas: {\n            wheel: function (event, jflow) {\n                event.preventDefault();\n                let { offsetX, offsetY, deltaX, deltaY } = event\n                if(event.ctrlKey) { \n                    deltaY = -deltaY;\n                    jflow.zoomHandler(offsetX, offsetY, deltaX, deltaY, event);\n                } else {\n                    jflow.panHandler(-deltaX, -deltaY, event);\n                }\n            },\n            pointerdown: function (event, jflow) {\n                const { offsetX, offsetY, deltaY, button } = event\n                if(button !== 0) return;\n                _mouseStatus.pointerDown = true;\n                \n                jflow.pressStartHandler(offsetX, offsetY, event);\n            },\n            pointermove: function (event, jflow) {\n                const { offsetX, offsetY } = event\n                if(_mouseStatus.pointerDown) {\n                    _mouseStatus.dirty = true;\n                }\n                jflow.pressMoveHandler(offsetX, offsetY, event);\n            },\n            pointerup: function (event, jflow) {\n                event.preventDefault();\n                // event.stopPropagation(); ALWAYS ENABLE PROPAGATION \n                const { offsetX, offsetY, button } = event\n                if(button !== 0) return;\n                if(_mouseStatus.pointerDown && _mouseStatus.dirty) {\n                    _mouseStatus.pointerDown = false;\n                    _mouseStatus.dirty = false;\n                    jflow.pressUpHanlder(false, event);\n                }\n            },\n            contextmenu: function (event, jflow) {\n                event.preventDefault();\n                event.stopPropagation();\n                const { offsetX, offsetY } = event;\n                jflow.contextMenuHanlder(offsetX, offsetY, event);\n            },\n            dblclick: function (event, jflow) {\n                event.preventDefault();\n                event.stopPropagation();\n                const { offsetX, offsetY } = event;\n                jflow.dblclickHandler(offsetX, offsetY, event);\n            },\n            click: function(event, jflow) {\n                event.preventDefault();\n                event.stopPropagation();\n                const { offsetX, offsetY } = event;\n                if(!_mouseStatus.dirty) {\n                    _mouseStatus.pointerDown = false;\n                    _mouseStatus.dirty = false;\n                    jflow.clickHanlder(offsetX, offsetY, event);\n                }\n                \n            }\n        },\n        document: {\n            pointerup: function(event, jflow) {\n                jflow.pressUpHanlder(true, event);\n            }\n        }\n    }\n}\n\n/** \n * EventAdapter 对象\n * EventAdapter 通过 plugin 的形式实现多种交互方式的映射\n * @constructor EventAdapter\n */\nclass EventAdapter {\n    constructor(plugin = {}) {\n        this.plugin = getDefaultPlugin();\n        this.use(plugin);\n        this.canvasHandlers = [];\n        this.documentHandlers = [];\n    }\n    use(plugin = {}) {\n        const { canvas: ca, document: docObj } = plugin;\n        if(ca) {\n            for(let eventName in ca){\n                if (ca.hasOwnProperty(eventName)) {\n                    this.plugin.canvas[eventName] = ca[eventName];\n                }\n            }\n        }\n        if(docObj) {\n            for(let eventName in docObj){\n                if (docObj.hasOwnProperty(eventName)) {\n                    this.plugin.document[eventName] = docObj[eventName];\n                }\n            }\n        }\n    }\n\n    apply(jflow) {\n        const { canvas: ca, document: docObj } = this.plugin;\n        const canvas = jflow.canvas;\n        for(let eventName in ca){\n            const handler = ca[eventName];\n            function handlerWrapperd (e) {\n                handler(e, jflow);\n            }\n            canvas.addEventListener(eventName, handlerWrapperd)\n            this.canvasHandlers.push({\n                eventName,\n                handlerWrapperd\n            });\n        }\n        for(let eventName in docObj){\n            let handler;\n            let options = {}\n            if(typeof docObj[eventName] === 'function') {\n                handler = docObj[eventName]\n            } else {\n                handler = docObj[eventName].handler;\n                Object.assign(options, docObj[eventName].options);\n            }\n                \n            function handlerWrapperd (e) {\n                handler(e, jflow);\n            }\n            document.addEventListener(eventName, handlerWrapperd, options)\n            this.documentHandlers.push({\n                eventName,\n                handlerWrapperd,\n                options\n            });\n        }\n    }\n\n    unload(jflow) {\n        const canvas = jflow.canvas;\n        this.canvasHandlers.forEach(({ eventName, handlerWrapperd }) => {\n            canvas.removeEventListener(eventName, handlerWrapperd);\n        });\n        this.documentHandlers.forEach(({ eventName, handlerWrapperd, options }) => {\n            console.log('unload', eventName)\n            document.removeEventListener(eventName, handlerWrapperd, options);\n        })\n    }\n}\n\nexport default EventAdapter;\n","import Node from './node';\nimport StackMixin from './stackMixin';\nimport LayoutMixin from './layoutMixin';\nimport { bounding_box } from '../utils/functions';\nimport { DIRECTION } from '../utils/constance';\nconst GroupMixin = {\n    ...StackMixin,\n    ...LayoutMixin,\n    _setPadding(configs) {\n        this.padding = {\n            top: configs.paddingTop || configs.padding || 0,\n            right: configs.paddingRight || configs.padding || 0,\n            bottom: configs.paddingBottom || configs.padding || 0,\n            left: configs.paddingLeft || configs.padding || 0,\n        };\n    },\n    _setMargin(configs)  {\n        this.margin = {\n            top: configs.marginTop || configs.margin || 0,\n            right: configs.marginRight || configs.margin || 0,\n            bottom: configs.marginBottom || configs.margin || 0,\n            left: configs.marginLeft || configs.margin || 0,\n        };\n    },\n    _getCenter() {\n        const anchor = this.anchor;\n        const padding = this.padding;\n        const margin = this.margin;\n        const mx = (margin.left - margin.right)/2;\n        const my = (margin.top - margin.bottom)/2;\n        const centerX = (padding.left - padding.right)/2 + mx;\n        const centerY = (padding.top - padding.bottom)/2 + my;\n        this._shape.anchor = [anchor[0] + mx, anchor[1] + my];\n        return [anchor[0] + centerX, anchor[1] + centerY];\n    },\n    setAnchorX(x) {\n        this.anchor[0] = x;\n        this._getCenter(); \n    },\n    setAnchorY(y) {\n        this.anchor[1] = y;\n        this._getCenter(); \n    },\n    setAnchor(x, y) {\n        this.anchor[0] = x;\n        this.anchor[1] = y;\n        this._getCenter(); \n    },\n    _calculatePointBack(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this._getCenter(); \n        const p = [gx - cx, gy - cy]\n        return p\n    },\n    _calculatePointBackWithPoint(a, b, arr, idx1, idx2) {\n        const anchor = this.anchor;\n        const padding = this.padding;\n        const margin = this.margin;\n        arr[idx1] = a - ( anchor[0] + (padding.left - padding.right)/2 + (margin.left - margin.right)/2 );\n        arr[idx2] = b - ( anchor[1] + (padding.top - padding.bottom)/2 + (margin.top - margin.bottom)/2 );\n    },\n    /**\n     * 反算回 canvas 顶层坐标\n     * @param {Number[]} point\n     * @return {Number[]} 世界坐标\n     */\n    calculateToCoordination(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this._getCenter(); \n        // const p = [cx + anchor[0] - spanH, cy + anchor[1] - spanV];\n        const p = [gx + cx, gy + cy]\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            return this._belongs.calculateToCoordination(p);\n        } else {\n            return p;\n        }\n    },\n    /**\n     * 反算回页面的像素坐标，重载 {@link Instance#calculateToRealWorld}\n     * @param {Number[]} point\n     * @return {Number[]} 世界坐标\n     */\n    calculateToRealWorld(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this._getCenter(); \n        const p = [gx + cx, gy + cy]\n        if(this._belongs && this._belongs.calculateToRealWorld) {\n            return this._belongs.calculateToRealWorld(p);\n        }\n    },\n    clone() {\n        const C = this.constructor;\n        const configs = Object.assign({}, this._rawConfigs, {\n            layout: this._layout && this._layout.clone(),\n        })\n        const t = new C(configs);\n        this.interateNodeStack((instance) => {\n            t.addToStack(instance.clone());\n        })\n        t.recalculate();\n        t.visible = this.visible;\n        return t;\n    },\n    getBoundingDimension() {\n        return {\n            width: this.width,\n            height: this.height,\n        }\n    },\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    },\n    getIntersectionsInFourDimension() {\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n        return {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n            [DIRECTION.SELF]:   [x2+w*0.618, y2+h*0.618]\n        }\n    },\n    calculateIntersection(point) {\n        const [x1, y1] = point;\n        const [x2, y2] = this.anchor;\n        const w = this.width/2;\n        const h = this.height/2;\n        const vecx = x2 - x1;\n        const vecy = y2 - y1;\n        const theta1 = h/w;\n        const theta2 = Math.abs(vecy/vecx);\n        const dirx = x1 > x2;\n        const diry = y1 > y2;\n        let x, y;\n        if(theta2 < theta1) {\n            x = x2 + (dirx?w:-w);\n            y = w * (diry?theta2:-theta2) + y2;\n        } else {\n            y = y2 + (diry?h:-h);\n            x = h / (dirx?theta2:-theta2) + x2;\n        }\n        return [x, y];\n    },\n    onEnterViewbox() {\n        this.interateNodeStack((instance) => {\n            instance.onEnterViewbox();\n        })\n    },\n    onLeaveViewbox() {\n        this.interateNodeStack((instance) => {\n            instance.onLeaveViewbox();\n        })\n    },\n    destroy() {\n        this._shape.destroy();\n        this.interateNodeStack((instance) => {\n            instance.destroy();\n        })\n    }, \n}\n\nfunction defaultShift(width, height) {\n    return [width, height];\n}\n\n/**\n * 根据paddingbox宽高来计算shapeshiftbox的宽高\n * @function shapeShift\n * @param {number} width            - paddingBox宽\n * @param {number} height           - paddingBox高\n * @return {number[]}\n */\n\n/**\n * 组工厂函数，用于通过JFlow 绘图节点来创建不同的组\n * @global \n * @function GroupFactory\n * @param {Node} jflowNodeConstructor - 绘图节点构造器\n * @param {object} options            - 配置项\n * @param {shapeShift} options.shapeShift - shift层适配方法\n * @return {Group} - 绘图节点构造器\n */\nfunction GroupFactory(jflowNodeConstructor, options = {}) {\n    const shapeShift = typeof options.shapeShift === 'function' ? options.shapeShift : defaultShift;\n\n    /**\n     * Group 配置\n     * @typedef {Object} GroupTemplate~GroupConfigs\n     * @property {number} width             - 设定宽度\n     * @property {number} minWidth          - 最小宽度\n     * @property {number} height            - 设定高度\n     * @property {number} padding          - 内边距\n     * @property {number} paddingTop          - 内上边距\n     * @property {number} paddingRight         - 内右边距\n     * @property {number} paddingBottom        - 内下边距\n     * @property {number} paddingLeft          - 内左边距\n     * @property {number} margin            - 外边距\n     * @property {number} marginTop          - 外上边距\n     * @property {number} marginRight         - 外右边距\n     * @property {number} marginBottom        - 外下边距\n     * @property {number} marginLeft          - 外左边距\n     * @property {boolean} lock            - 布局锁定状态 默认 true\n     */\n    class t extends Node {\n        /**\n        * @constructs GroupTemplate\n        * @param {GroupTemplate~GroupConfigs} configs - 组配置\n        * @mixes LayoutMixin\n        * @mixes StackMixin \n        */\n        constructor(configs) {\n            super(configs);\n            this.initStack(configs);\n            this.initLayout(configs);\n            /** @member {Node}      - 壳绘图单元 */\n            this._shape = new jflowNodeConstructor(configs);\n            this._shape.anchor = [0, 0];\n            this._shape._belongs = this;\n            this._setPadding(configs);\n            this._setMargin(configs);  \n            /** @member {Number}      - 设定宽度 */\n            this.definedWidth =     configs.width;\n            /** @member {Number}      - 最小宽度 */\n            this.minWidth =         configs.minWidth;\n            /** @member {Number}      - 设定的高度 */\n            this.definedHeight =    configs.height;\n            /** @member {Boolean}      - 组内元素是否锁定， 默认true */\n            this.lock =             configs.lock ?? true ;\n            this.display =          configs.display || 'default';\n            /** @member {Boolean}      - 组本身是否进入形状判定范围 */\n            this.transparent =      configs.transparent ?? false;\n            this._getBoundingGroupRect();\n            this.reflow();\n            this._getBoundingGroupRect();  \n            this._cacheViewBox = [];\n        }\n    }\n    Object.assign(t.prototype, GroupMixin);\n    Object.assign(t.prototype, { \n        reflow() {\n            GroupMixin.reflow.call(this);\n            const margin = this.margin;\n            const [shapeWidth, shapeHeight] = shapeShift(\n                    this.width - margin.left - margin.right,\n                    this.height - margin.top - margin.bottom, this._shape);\n            this._shape.width = shapeWidth;\n            this._shape.height = shapeHeight;\n        },\n        setConfig(configs) {\n            this._shape.setConfig(configs);\n            this._setPadding(configs);\n            this._setMargin(configs);  \n            if('opacity' in configs) {\n                this.opacity = configs.opacity\n            }\n            \n            if(configs.layout && this._layout !== configs.layout) {\n                this._layout = configs.layout;\n            }\n        },\n        _getBoundingGroupRect() {\n            const points = this._stack.getBoundingRectPoints();\n            // content box \n            const bbox = bounding_box(points);\n\n             // padding box \n            const padding = this.padding;\n            const minWidth = this.minWidth// - padding.left - padding.right;\n            const definedWidth = this.definedWidth// - padding.left - padding.right;\n            const w = bbox.width + padding.left + padding.right;\n            const h = bbox.height + padding.top + padding.bottom;\n            const paddingWidth = minWidth ? Math.max(minWidth, w) : definedWidth || w;\n            const paddingHeight = this.definedHeight || h;\n            this._paddingWidth = paddingWidth;\n            this._paddingHeight = paddingHeight;\n\n            // shapeBox\n            const [shapeWidth, shapeHeight] = shapeShift(paddingWidth, paddingHeight, this._shape)\n            this._shape.width = shapeWidth;\n            this._shape.height = shapeHeight;\n            // marginBox\n            const margin = this.margin;\n            this.width = shapeWidth + margin.left + margin.right;\n            this.height = shapeHeight + margin.top + margin.bottom;\n        },\n\n        _getViewBox() {\n            const belongs_vbox = this._belongs.getCacheViewBox();\n            const cacheViewBox = this._cacheViewBox;\n            \n            this._calculatePointBackWithPoint(belongs_vbox[0], belongs_vbox[1], cacheViewBox, 0, 1);\n            this._calculatePointBackWithPoint(belongs_vbox[2], belongs_vbox[3], cacheViewBox, 2, 3);\n            return this._cacheViewBox;\n        },\n        getCacheViewBox() {\n            return this._cacheViewBox;\n        },\n\n        // beforeRender() {\n        //     return doOverlap(this._belongs.getCacheViewBox(), this._boundingrect)\n        // },\n        \n        render(ctx) {\n            ctx.save();\n            if(this._isMoving){\n                ctx.globalAlpha = 0.6\n            } else if(this.opacity !== 1) {\n                ctx.globalAlpha = this.opacity;\n            }\n            const [cx, cy] = this._getCenter(); \n            this._shape.render(ctx);\n            ctx.translate(cx, cy);\n            this._stack.render(ctx);\n            // this._linkStack.render(ctx);    \n            ctx.translate(-cx, -cy);\n            ctx.restore();\n\n            // ctx.save();\n            // ctx.beginPath();\n            // ctx.arc(cx, cy, 5, 0, Math.PI*2);\n            // ctx.fillStyle = 'rgb(0,0,0)'\n            // ctx.fill();\n            // ctx.restore();\n        },\n        isHit(point, condition) {\n            const p = this._calculatePointBack(point);\n            this._currentp = p; // 暂存，为了后续计算别的位置\n            const target = this._stack.checkHit(p, condition);\n            if(target) return target;\n            if(!this.transparent) {\n                return this._shape.isHit(point);\n            }\n            return false;\n        },    \n        /* renderCache(ctx) {\n            const rect = this.getBoundingRect();\n            const [a, b] = this._belongs.calculateToRealWorld([rect[0], rect[1]]);\n            const [c, d] = this._belongs.calculateToRealWorld([rect[2], rect[3]]);\n            ctx.putImageData(this._cached, a, b, 0, 0, c-a, d-b)\n        },\n        cache(ctx) {\n            const rect = this.getBoundingRect();\n            const [a, b] = this._belongs.calculateToRealWorld([rect[0], rect[1]]);\n            const [c, d] = this._belongs.calculateToRealWorld([rect[2], rect[3]]);\n            console.log(a, b, c-a ,d-b);\n            this._cached = ctx.getImageData(a, b, c-a, d-b)\n        }  */  \n    });\n    return t\n}\n\nexport default GroupFactory;\n\n","import Node from '../node';\nimport { DIRECTION } from '../../utils/constance';\n/**\n * 圆形单元 配置\n * @typedef {Node~Configs} Point~PointConfigs\n * @property {number} radius  - 半径\n */\n/**\n * 圆形节点\n * @constructor Point\n * @extends Node\n * @param {Point~PointConfigs} configs - 配置\n */\nclass Point extends Node {\n    constructor(configs) {\n        super(configs);\n        this.type =             'Point';\n        /** @member {Number}      - 半径 */\n        this.radius =           configs.radius || 10;\n        this._doCache();\n    }\n\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k];\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n        this._doCache();\n    }\n    _doCache() {\n        this.width = this.radius * 2;\n        this.height = this.radius * 2;\n    }\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        ctx.beginPath();\n        ctx.arc(this.anchor[0], this.anchor[1], this.radius, 0, 2 * Math.PI);\n        ctx.fillStyle = this.backgroundColor;\n        ctx.fill();\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n            ctx.stroke();\n        }\n        // if(this._isTargeting) {\n        //     this.renderFocus(ctx);\n        // }\n        ctx.restore();\n    }\n\n    isHit(point) {\n        const anchor = this.anchor;\n        return Math.pow(point[0] - anchor[0], 2) + Math.pow(point[1] - anchor[1], 2) < this.radius * this.radius\n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const r = this.radius;\n        const ltx = anchor[0] - r;\n        const lty = anchor[1] - r;\n        const rbx = anchor[0] + r;\n        const rby = anchor[1] + r;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n\n    calculateIntersection(point) {\n        const [x1, y1] = point;\n        const [x2, y2] = this.anchor;\n        const vecx = x2 - x1;\n        const vecy = y2 - y1;\n        const dist = Math.sqrt(vecx * vecx + vecy * vecy);\n\n        const ratio = this.radius / dist;\n        return [x2 - ratio * vecx, y2 - ratio * vecy];\n    }\n\n    getIntersectionsInFourDimension() {\n        const [x2, y2] = this.anchor;\n        const r = this.radius;\n        return {\n            [DIRECTION.RIGHT]:  [x2 + r, y2],\n            [DIRECTION.LEFT]:   [x2 - r, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+r],\n            [DIRECTION.TOP]:    [x2, y2-r],\n        }\n    }\n\n    calculateIntersectionInFourDimension(point, end) {\n        const [x1, y1] = point;\n        const [x2, y2] = this.anchor;\n        const r = this.radius;\n        const vecx = x2 - x1;\n        const vecy = y2 - y1;\n        const allIntersections = {\n            [DIRECTION.RIGHT]:  [x2 + r, y2],\n            [DIRECTION.LEFT]:   [x2 - r, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+r],\n            [DIRECTION.TOP]:    [x2, y2-r],\n        }\n        // console.log(Math.abs(vecx) > Math.abs(vecy), vecx, r)\n        // if() {\n        //     return {\n        //         p: [x2 + (vecx<0?r:-r), y2],\n        //         dir: vecx<0 ? DIRECTION.RIGHT : DIRECTION.LEFT,\n        //     }\n        // } else {\n        //     return {\n        //         p: [x2, y2+(vecy<0?r:-r)],\n        //         dir: vecy<0 ? DIRECTION.BOTTOM : DIRECTION.TOP,\n        //     }\n        // }\n        let interDir = (Math.abs(vecy) > Math.abs(vecx)\n            ? (vecy < 0 ? DIRECTION.BOTTOM : DIRECTION.TOP)\n            : (vecx < 0 ? DIRECTION.RIGHT : DIRECTION.LEFT));\n\n        // interDir = this.checkLinked(interDir, end);\n        return {\n            p: allIntersections[interDir],\n            dir: interDir,\n        }\n    }\n\n    getBoundingDimension() {\n        return {\n            width: this.width,\n            height: this.height\n        }\n    }\n\n}\n\nexport default Point;","import Node from '../node';\nimport { DIRECTION, oppositeDirection } from '../../utils/constance';\n/**\n * @typedef Rectangle~border\n * @type {object}\n * @property {number} borderColor      - 边框宽度, 默认 0\n * @property {number} borderWidth      - 边框颜色, 默认 transparent\n */\n/**\n * @typedef Rectangle~borders\n * @type {object}\n * @property {Rectangle~border} top      - 上边框\n * @property {Rectangle~border} right      - 右边框\n * @property {Rectangle~border} bottom      - 下边框\n * @property {Rectangle~border} left      - 左边框\n */\n\n/**\n * 矩形单元 配置\n * @typedef {Node~Configs} Rectangle~RectangleConfigs\n * @property {number} width - 宽\n * @property {number} height - 高\n * @property {number} borderRadius - 圆角矩形半径\n * @property {string} borderColor - 边框颜色, 默认 transparent\n * @property {string} borderWidth - 边框宽度, 默认 0\n * @property {Rectangle~borders} border      - 边框设置\n */\n/**\n * 矩形单元\n * @constructor Rectangle\n * @extends Node\n * @param {Rectangle~RectangleConfigs} configs\n */\nclass Rectangle extends Node {\n    constructor(configs = {}) {\n        super(configs);\n        this.type =             'Rectangle';\n         /** @member {Number}      - 宽 */\n        this.width =            configs.width || 10;\n         /** @member {Number}      - 高 */\n        this.height =           configs.height || 10;\n         /** @member {Number}      - 圆角矩形半径 */\n        this.borderRadius =     configs.borderRadius || 0;\n        this._setBorder(configs);\n    }\n\n    _setBorder(configs){\n        /** @member {Rectangle~borders}      - 边框设置，优先级高于 borderWidth，borderColor */\n        this.border = {\n            top: {\n                color: configs.border?.top?.borderColor || configs.borderColor || 'transparent',\n                width: configs.border?.top?.borderWidth || configs.borderWidth || 0,\n                enable: configs.border?.top?.borderWidth,\n            },\n            right: {\n                color: configs.border?.right?.borderColor || configs.borderColor || 'transparent',\n                width: configs.border?.right?.borderWidth || configs.borderWidth || 0,\n                enable: configs.border?.right?.borderWidth,\n            },\n            bottom: {\n                color: configs.border?.bottom?.borderColor || configs.borderColor || 'transparent',\n                width: configs.border?.bottom?.borderWidth || configs.borderWidth || 0,\n                enable: configs.border?.bottom?.borderWidth,\n            },\n            left: {\n                color: configs.border?.left?.borderColor || configs.borderColor || 'transparent',\n                width: configs.border?.left?.borderWidth || configs.borderWidth || 0,\n                enable: configs.border?.left?.borderWidth,\n            }\n        };\n        this.borderColor = configs.borderColor || 'transparent';\n        this.borderWidth = configs.borderWidth || 0;\n    }\n\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k];\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n        this._setBorder(configs);\n    }\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n\n        const {\n            borderRadius: radius, anchor, width, height\n        } = this;\n        const x = this.anchor[0] - this.width / 2;\n        const y = this.anchor[1] - this.height / 2;\n        const xt = this.anchor[0] + this.width / 2;\n        const yt = this.anchor[1] + this.height / 2;\n        if(this.borderRadius) {\n            ctx.beginPath();\n            ctx.moveTo(x + radius, y);\n            ctx.lineTo(x + width - radius, y);\n            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\n            ctx.lineTo(x + width, y + height - radius);\n            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n            ctx.lineTo(x + radius, y + height);\n            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);\n            ctx.lineTo(x, y + radius);\n            ctx.quadraticCurveTo(x, y, x + radius, y);\n            ctx.closePath(); \n        } else {\n            ctx.beginPath();\n            ctx.rect(this.anchor[0] - this.width / 2, this.anchor[1] - this.height / 2, this.width, this.height);\n        }\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n        }\n        \n        if(this.shadowColor && this.shadowColor !== 'transparent') {\n            ctx.shadowColor = this.shadowColor;\n            const scale = this._jflow.scale;\n            ctx.shadowBlur = this.shadowBlur * scale;\n            ctx.shadowOffsetX = this.shadowOffsetX * scale;\n            ctx.shadowOffsetY = this.shadowOffsetY * scale;\n            let switchPath = new Path2D();\n            if(this.borderRadius) {\n                switchPath.moveTo(x + radius, y);\n                switchPath.lineTo(x + width - radius, y);\n                switchPath.quadraticCurveTo(x + width, y, x + width, y + radius);\n                switchPath.lineTo(x + width, y + height - radius);\n                switchPath.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n                switchPath.lineTo(x + radius, y + height);\n                switchPath.quadraticCurveTo(x, y + height, x, y + height - radius);\n                switchPath.lineTo(x, y + radius);\n                switchPath.quadraticCurveTo(x, y, x + radius, y);\n                switchPath.closePath();\n            } else {\n                switchPath.rect(this.anchor[0] - this.width / 2, this.anchor[1] - this.height / 2, this.width, this.height);\n            }\n            switchPath.rect(x - 10, y - 10, this.width+ 20, this.height+ 20);\n            ctx.save();\n            ctx.clip(switchPath, \"evenodd\");\n            ctx.stroke();\n            ctx.restore();\n        }  \n        ctx.fillStyle = this.backgroundColor;\n        ctx.fill();\n        if(this.borderRadius && this.borderWidth) {\n            ctx.shadowColor = 'transparent'\n            ctx.stroke();\n        }\n        \n        if(this.borderRadius) {\n            if(this.border.top.enable) {\n                const ty = y - this.border.top.width / 2;\n                // console.log(this.border.top.width)\n                ctx.beginPath();\n                let topPath = new Path2D();\n                topPath.moveTo(x, ty + radius);\n                topPath.quadraticCurveTo(x, ty, x + radius, ty);\n                topPath.lineTo(x + width - radius, ty);\n                topPath.quadraticCurveTo(x + width, ty, x + width, ty + radius);\n                topPath.closePath();\n                ctx.clip(topPath);             \n                ctx.save();\n                ctx.shadowColor = 'transparent';\n                ctx.fillStyle = this.border.top.color;\n                ctx.rect(x, ty, this.width, this.border.top.width);\n                ctx.fill();\n                ctx.restore();\n\n                // ctx.stroke();\n                // ctx.save();\n                // ctx.beginPath();\n                // ctx.moveTo(x, ty + radius);\n                // ctx.quadraticCurveTo(x, ty, x + radius, ty);\n                // ctx.lineTo(x + width - radius, ty);\n                // ctx.quadraticCurveTo(x + width, ty, x + width, ty + radius);\n                // ctx.closePath();\n\n                // // ctx.fill();\n                // ctx.clip();\n\n                // ctx.beginPath();\n                // ctx.rect(x, ty, this.width, this.border.top.width);\n                // ctx.fillStyle = this.border.top.color;\n                // ctx.shadowColor = 'transparent';\n                // ctx.fill();\n                // ctx.restore();\n            }\n        } else {\n            if(this.border.top.width) {\n                ctx.beginPath();\n                ctx.moveTo(x, y);\n                ctx.lineTo(xt, y);\n                ctx.strokeStyle = this.border.top.color;\n                ctx.lineWidth = this.border.top.width;\n                ctx.stroke();\n            }\n\n            if(this.border.right.width) {\n                ctx.beginPath();\n                ctx.moveTo(xt, y);\n                ctx.lineTo(xt, yt);\n                ctx.strokeStyle = this.border.right.color;\n                ctx.lineWidth = this.border.right.width;\n                ctx.stroke();\n            }\n\n            if(this.border.bottom.width) {\n                ctx.beginPath();\n                ctx.moveTo(xt, yt);\n                ctx.lineTo(x, yt);\n                ctx.strokeStyle = this.border.bottom.color;\n                ctx.lineWidth = this.border.bottom.width;\n                ctx.stroke();\n            }\n\n            if(this.border.left.width) {\n                ctx.beginPath();\n                ctx.moveTo(x, yt);\n                ctx.lineTo(x, y);\n                ctx.strokeStyle = this.border.left.color;\n                ctx.lineWidth = this.border.left.width;\n                ctx.stroke();\n            }\n        }\n        ctx.restore();\n    }\n\n    isHit(point) {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        return point[0] > anchor[0] - w\n            && point[0] < anchor[0] + w\n            && point[1] > anchor[1] - h\n            && point[1] < anchor[1] + h;\n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n\n    getBoundingDimension() {\n        return {\n            height: this.height,\n            width: this.width,\n        }\n    }\n\n    calculateIntersection(point) {\n        const [x1, y1] = point;\n        const [x2, y2] = this.anchor;\n        const w = this.width/2;\n        const h = this.height/2;\n        const vecx = x2 - x1;\n        const vecy = y2 - y1;\n        const theta1 = h/w;\n        const theta2 = Math.abs(vecy/vecx);\n        const dirx = x1 > x2;\n        const diry = y1 > y2;\n        let x, y;\n        if(theta2 < theta1) {\n            x = x2 + (dirx?w:-w);\n            y = w * (diry?theta2:-theta2) + y2;\n        } else {\n            y = y2 + (diry?h:-h);\n            x = h / (dirx?theta2:-theta2) + x2;\n        }\n        return [x, y];\n    }\n\n    getIntersectionsInFourDimension() {\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n        return {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n        }\n    }\n\n    calculateIntersectionInFourDimension(point, end) {\n        const [x1, y1] = point;\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n        const allIntersections = {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n        }\n        const vecx = x2 - x1;\n        const vecy = y2 - y1;\n        const theta1 = h/w;\n        const theta2 = Math.abs(vecy/vecx);\n        const dirx = x1 > x2;\n        const diry = y1 > y2;\n        let interDir = (theta2 > theta1\n            ? (diry ? DIRECTION.BOTTOM : DIRECTION.TOP)\n            : (dirx ? DIRECTION.RIGHT : DIRECTION.LEFT));\n\n        // if(this._belongs && this._belongs.calculateToCoordination) {\n        //     console.log(JSON.stringify(this._intersections));\n        //     console.log(interDir)\n        // }\n        // interDir = this.checkLinked(interDir, end);\n        // if(this._belongs && this._belongs.calculateToCoordination) {\n        //     console.log(interDir)\n        // }\n\n        // if(!interDir) {\n        //     debugger\n        // }\n        // let endDir = interDir;\n        // if(end === 'to') {\n        //     endDir = oppositeDirection(endDir)\n        // }\n        return {\n            p: allIntersections[interDir],\n            dir: interDir,\n        }\n    }\n}\n\nexport default Rectangle;","import Node from '../node';\nimport { DIRECTION, oppositeDirection } from '../../utils/constance';\n/**\n * 胶囊单元 配置\n * @typedef {Node~Configs} Capsule~CapsuleConfigs\n * @property {number} width  - 内部矩形宽\n * @property {number} height - 内部矩形高\n */\n/**\n * 胶囊单元\n * @constructor Capsule\n * @extends Node\n * @param {Capsule~CapsuleConfigs} configs - 配置\n */\nclass Capsule extends Node {\n    constructor(configs = {}) {\n        super(configs);\n        this.type =             'Capsule';\n        /** @member {Number}      - 内部矩形宽 */\n        this.width =            configs.width || 20;\n        /** @member {Number}      - 内部矩形高 */\n        this.height =           configs.height || 10;\n    }\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        ctx.beginPath();\n        const [x, y] = this.anchor;\n        const hw = this.width/2;\n        const hh = this.height/2;\n        const leftCenter = x - hw + hh;\n        const rightCenter = x + hw - hh;\n        const top = y - hh;\n        const bottom = y + hh;\n\n        ctx.moveTo(leftCenter, top);\n        ctx.lineTo(rightCenter, top);\n        ctx.arc(rightCenter, y, hh, -Math.PI/2, Math.PI/2);\n        ctx.lineTo(leftCenter, bottom);\n        ctx.arc(leftCenter, y, hh, Math.PI/2, Math.PI/2*3);\n\n        ctx.fillStyle = this.backgroundColor;\n        if (this.shadowColor) {\n            ctx.shadowColor = this.shadowColor;\n            ctx.shadowBlur = this.shadowBlur;\n            ctx.shadowOffsetX = this.shadowOffsetX;\n            ctx.shadowOffsetY = this.shadowOffsetY;\n        }\n        ctx.fill();\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n            ctx.stroke();\n        }\n        // ctx.fillStyle = 'rgba(0,0,0,0.3)';\n        // ctx.fillRect(x-hw, y-hh, this.width, this.height)\n\n        ctx.restore();\n    }\n\n    isHit(point) {\n        const anchor = this.anchor;\n        const hw = this.width/2;\n        const hh = this.height/2;\n        const ww =  Math.abs(hw - hh);\n        const leftCenter = anchor[0] - hw + hh;\n        const rightCenter = anchor[0] + hw - hh;\n        const rr = hh * hh;\n        return (point[0] > anchor[0] - ww\n            && point[0] < anchor[0] + ww\n            && point[1] > anchor[1] - hh\n            && point[1] < anchor[1] + hh)\n            || ( Math.pow(point[0] - leftCenter, 2) + Math.pow(point[1] - anchor[1], 2) < rr)\n            || ( Math.pow(point[0] - rightCenter, 2) + Math.pow(point[1] - anchor[1], 2) < rr)\n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n\n    getBoundingDimension() {\n        return {\n            height: this.height,\n            width: this.width,\n        }\n    }\n\n    getIntersectionsInFourDimension() {\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n        return {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n        }\n    }\n}\n\nexport default Capsule;","import Capsule from './capsule';\n/**\n * 垂直胶囊单元\n * @constructor CapsuleVertical\n * @extends Capsule\n * @param {Capsule~CapsuleConfigs} configs - 配置\n */\nclass CapsuleVertical extends Capsule {\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        ctx.beginPath();\n        const [x, y] = this.anchor;\n        const hw = this.width/2;\n        const hh = this.height/2;\n        const topCenter = y - hh + hw;\n        const bottomCenter = y + hh - hw;\n        const left = x - hw;\n        const right = x + hw;\n\n        ctx.moveTo(left, topCenter);\n        ctx.arc(x, topCenter, hw, -Math.PI, 0);\n        ctx.lineTo(right, bottomCenter);\n        ctx.arc(x, bottomCenter, hw, 0, Math.PI);\n        ctx.closePath();\n\n        ctx.fillStyle = this.backgroundColor;\n        if (this.shadowColor) {\n            ctx.shadowColor = this.shadowColor;\n            ctx.shadowBlur = this.shadowBlur;\n            ctx.shadowOffsetX = this.shadowOffsetX;\n            ctx.shadowOffsetY = this.shadowOffsetY;\n        }\n        ctx.fill();\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n            ctx.stroke();\n        }\n        // ctx.fillStyle = 'rgba(0,0,0,0.3)';\n        // ctx.fillRect(x-hw, y-hh, this.width, this.height)\n\n        ctx.restore();\n    }\n\n    isHit(point, condition) {\n        const [x, y] = this.anchor;\n        const hw = this.width/2;\n        const hh = this.height/2;\n        const yy =  Math.abs(hh - hw);\n        const topCenter = y - hh + hw;\n        const bottomCenter = y + hh - hw;\n        const rr = hw * hw;\n        return (point[0] > x - hw\n            && point[0] < x + hw\n            && point[1] > y - yy\n            && point[1] < y + yy)\n            || ( Math.pow(point[0] - x, 2) + Math.pow(point[1] - topCenter, 2) < rr)\n            || ( Math.pow(point[0] - x, 2) + Math.pow(point[1] - bottomCenter, 2) < rr)\n    }\n}\nexport default CapsuleVertical;","import Node from '../node';\nimport { DIRECTION } from '../../utils/constance';\n/**\n * 菱形单元 配置\n * @typedef {Node~Configs} Rhombus~RhombusConfigs\n * @property {number} diagonalsV  - 内十字高度\n * @property {number} diagonalsH  - 内十字宽度\n */\n/**\n * 菱形单元\n * @constructor Rhombus\n * @param {Rhombus~RhombusConfigs} configs - 配置\n * @extends Node\n */\nclass Rhombus extends Node {\n    constructor(configs = {}) {\n        super(configs);\n        this.type =             'Rhombus';\n        /** @member {Number}      - 内十字高度 */\n        this.height =           configs.diagonalsV || 10;\n        /** @member {Number}      - 内十字宽度 */\n        this.width =            configs.diagonalsH || 20;\n    }\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        const w = this.width / 2;\n        const h = this.height / 2;\n        const center = this.anchor;\n        ctx.translate(center[0], center[1])\n        ctx.beginPath();\n        ctx.moveTo(0, -h);\n        ctx.lineTo(w, 0);\n        ctx.lineTo(0, h);\n        ctx.lineTo(-w, 0);\n        ctx.closePath();\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n        }\n\n        \n        if(this.shadowColor) {\n            ctx.shadowColor = this.shadowColor;\n            const scale = this._jflow.scale;\n            ctx.shadowBlur = this.shadowBlur * scale;\n            ctx.shadowOffsetX = this.shadowOffsetX * scale;\n            ctx.shadowOffsetY = this.shadowOffsetY * scale;\n            let switchPath = new Path2D();\n            switchPath.moveTo(0, -h);\n            switchPath.lineTo(w, 0);\n            switchPath.lineTo(0, h);\n            switchPath.lineTo(-w, 0);\n            switchPath.closePath();\n            switchPath.rect(-w - 10,  -h - 10, this.width + 20, this.height+ 20);\n            // switchPath.moveTo(x, y-h);\n            // switchPath.lineTo(x + w, y);\n            // switchPath.lineTo(x, y + h);\n            // switchPath.lineTo(x-w, y);\n            // switchPath.closePath();\n            // switchPath.rect(x - w - 10, y - h - 10, this.width+ 20, this.height+ 20);\n            ctx.save();\n            ctx.clip(switchPath, \"evenodd\");\n            ctx.stroke();\n            ctx.restore();\n        }\n        ctx.fillStyle = this.backgroundColor;\n        ctx.fill();\n        if (this.borderWidth) {\n            ctx.shadowColor = 'transparent'\n            ctx.stroke();\n        }\n       \n        ctx.translate(-center[0], -center[1])\n        ctx.restore();\n    }\n\n    isHit(point) {\n        const v = this.height / 2;\n        const h = this.width / 2;\n        const anchor = this.anchor;\n        const x = Math.abs(point[0] - anchor[0]);\n        const y = Math.abs(point[1] - anchor[1]);\n        return (x / h + y / v) <= 1;\n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height /2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n\n    getBoundingDimension() {\n        return {\n            height: this.height,\n            width: this.width,\n        }\n    }\n\n    getIntersectionsInFourDimension() {\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n\n        return {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n            [DIRECTION.SELF]:   [x2+w*0.618, y2+h*0.618]\n        }\n    }\n}\n\nexport default Rhombus;\n","import Node from '../node';\nimport { DIRECTION, oppositeDirection } from '../../utils/constance';\n// import { makeBezierPoints } from '../../utils/functions';\n/**\n * 钻石形单元 配置\n * @typedef {Node~Configs} Diamond~DiamondConfigs\n * @property {number} width  - 内部矩形宽\n * @property {number} height - 内部矩形高\n * @property {number} side   - 两侧三角形的宽\n */\n/**\n * 钻石形单元\n * @constructor Diamond\n * @param {Diamond~DiamondConfigs} configs - 配置\n * @extends Node\n */\n\nclass Diamond extends Node {\n\n    constructor(configs = {}) {\n        super(configs);\n        this.type =             'Diamond';\n        /** @member {Number}      - 内部矩形宽 */\n        this.width =            configs.width || 20;\n        /** @member {Number}      - 内部矩形高 */\n        this.height =           configs.height || 10;\n        /** @member {Number}      - 两侧三角形的宽 */\n        this.side =             configs.side || 6;\n        this._doCache();\n    }\n\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k];\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n        this._doCache();\n    }\n\n    _doCache() {\n        this.sinSIDE = Math.sin(Math.PI/3) * this.side;\n        this.cosSIDE = Math.cos(Math.PI/3) * this.side;\n    }\n\n    render(ctx) {\n        const [x, y] = this.anchor;\n        const hw = this.width/2;\n        const hh = this.height/2;\n        const xx = hh / 1.732\n        const leftCenter = x - hw + xx;\n        const rightCenter = x + hw - xx;\n        const right = x + hw;\n        const left = x - hw;\n        const top = y - hh;\n        const bottom = y + hh;\n\n        this._cachePoints = [\n            [rightCenter, top],\n            [right, y],\n            [rightCenter, bottom],\n            [leftCenter, bottom],\n            [left, y],\n            [leftCenter, top]\n        ];\n\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        ctx.beginPath();\n        const {\n            side, sinSIDE, cosSIDE\n        } = this;\n        ctx.moveTo(x, top);\n        ctx.lineTo(rightCenter - side, top);\n        ctx.quadraticCurveTo(rightCenter, top, rightCenter + cosSIDE, top + sinSIDE);\n        ctx.lineTo(right - cosSIDE, y - sinSIDE);\n        ctx.quadraticCurveTo(right, y, right - cosSIDE, y + sinSIDE);\n        ctx.lineTo(rightCenter + cosSIDE, bottom - sinSIDE);\n        ctx.quadraticCurveTo(rightCenter, bottom, rightCenter - side, bottom);\n\n        ctx.lineTo(leftCenter + side, bottom);\n        ctx.quadraticCurveTo(leftCenter, bottom, leftCenter - cosSIDE, bottom - sinSIDE);\n        ctx.lineTo(left + cosSIDE, y + sinSIDE);\n        ctx.quadraticCurveTo(left, y, left + cosSIDE, y - sinSIDE);\n        ctx.lineTo(leftCenter - cosSIDE, top + sinSIDE);\n        ctx.quadraticCurveTo(leftCenter, top, leftCenter + side, top);\n\n        ctx.closePath();\n\n        ctx.fillStyle = this.backgroundColor;\n        if (this.shadowColor) {\n            ctx.shadowColor = this.shadowColor;\n            ctx.shadowBlur = this.shadowBlur;\n            ctx.shadowOffsetX = this.shadowOffsetX;\n            ctx.shadowOffsetY = this.shadowOffsetY;\n        }\n        ctx.fill();\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n            ctx.stroke();\n        }\n\n        // if(this._isTargeting) {\n        //     this.renderFocus(ctx);\n        // }\n        // ctx.fillStyle = 'rgba(0,0,0,0.3)';\n        // ctx.fillRect(x-hw, y-hh, this.width, this.height)\n\n        ctx.restore();\n\n\n    }\n\n    isHit(point) {\n        if(!this._cachePoints) return false;\n        const polygon = this._cachePoints;\n        let odd = false;\n        // For each edge (In this case for each point of the polygon and the previous one)\n        for (let i = 0, j = polygon.length - 1; i < polygon.length; i++) {\n            // If a line from the point into infinity crosses this edge\n            if (((polygon[i][1] > point[1]) !== (polygon[j][1] > point[1])) // One point needs to be above, one below our y coordinate\n                // ...and the edge doesn't cross our Y corrdinate before our x coordinate (but between our x coordinate and infinity)\n                && (point[0] < ((polygon[j][0] - polygon[i][0]) * (point[1] - polygon[i][1]) / (polygon[j][1] - polygon[i][1]) + polygon[i][0]))) {\n                // Invert odd\n                odd = !odd;\n            }\n            j = i;\n\n        }\n        return odd;\n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n\n    getBoundingDimension() {\n        return {\n            height: this.height,\n            width: this.width,\n        }\n    }\n\n    getIntersectionsInFourDimension() {\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n        return {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n        }\n    }\n}\n\nexport default Diamond;","import Node from '../node';\nimport StackMixin from '../stackMixin';\nimport LayoutMixin from '../layoutMixin';\nimport Rectangle from '../shapes/rectangle';\nimport { bounding_box, doOverlap } from '../../utils/functions';\nimport { DIRECTION } from '../../utils/constance';\nimport { ScrollBar } from '../../scrollbar/scrollbarMixin';\nconst ishitKey = Symbol('ishit');\n\nclass InnerScrollBar extends ScrollBar {\n    constructor(dir, configs = {}) {\n        super(dir, configs);\n        this.visible = false;\n    }\n    render(ctx) {\n        if(this.visible) {\n            super.render(ctx);\n        }\n    }\n\n    setHit(ishit) {\n        if(this[ishitKey] !== ishit) {\n            this.isFocus = ishit\n            this.onHit();\n        }\n        this[ishitKey] = ishit;\n    }\n}\n \nclass ScrollGroup extends Node {\n    constructor(configs) {\n        super(configs);\n        this.type = 'ScrollGroup';\n        this.initStack(configs);\n        this.initLayout(configs);\n        this.initScrollBar(configs);\n        this._shape = new Rectangle(configs);\n        this._shape.anchor = [0, 0];\n        this._shape._belongs = this;\n\n        this.maxWidth = configs.maxWidth || Infinity;\n        this.definedWidth = configs.definedWidth;\n        this.maxHeight = configs.maxHeight || Infinity;\n        this.definedHeight = configs.definedHeight;\n\n        this.lock = configs.lock ?? true ;\n        this._offset = [0, 0];\n\n        this._getBoundingGroupRect();\n        this.reflow();\n        this._getBoundingGroupRect();  \n        this._resetOffset();\n        this._cacheViewBox = []\n\n    }\n\n    initScrollBar(configs) {\n        const {\n            barColor,\n            barFocusColor,\n            barMarginX,\n            barMarginY,\n            barWidth,\n        } = configs;\n        this._scrollbarX = new InnerScrollBar('x', {\n            plainColor: barColor,\n            focusColor: barFocusColor,\n            barWidth,\n        });\n        this._scrollbarY = new InnerScrollBar('y', {\n            plainColor: barColor,\n            focusColor: barFocusColor,\n            barWidth\n        });\n        this._scrollbarX.barMarginX = barMarginX || 1;\n        this._scrollbarY.barMarginY = barMarginY || 1;\n        const _f = () => {\n            this._jflow.scheduleRender();\n        }\n        this._scrollbarX.onHit = _f;\n        this._scrollbarY.onHit = _f;\n\n        this._scrollBarStatus = {\n            dragging: false,\n            target: null,\n\n            barInitX: 0,\n            barInitY: 0,\n            barStartX: 0,\n            barStartY: 0,\n\n            hitScrollX: false,\n            hitScrollY: false,\n        }\n        // // const jflowInstance = this._jflow;\n        // this.addEventListener('instancemousemove', e => {\n        //     if(this._scrollBarStatus.hitScrollX) {\n        //         if(!this._scrollbarX.isFocus) {\n        //             this._scrollbarX.isFocus = true;\n        //             e.detail.jflow.scheduleRender();\n        //         }\n        //         return;\n        //     }\n        //     if(this._scrollbarX.isFocus) {\n        //         this._scrollbarX.isFocus = false;\n        //         e.detail.jflow.scheduleRender();\n        //     }\n        \n        // })\n        this.addEventListener('instancePressStart', e => {\n            if(this._scrollBarStatus.hitScrollX) {\n                e.detail.preventDefault();\n                e.detail.bubbles = false;\n                const clientX = e.detail.event.clientX;\n                Object.assign(this._scrollBarStatus, {\n                    dragging: true,\n                    target: this._scrollbarX,\n                    barStartX: this._scrollbarX.anchor[0],\n                    barInitX: clientX,\n                });\n                this.onScrollbarPressStart();\n            }\n            if(this._scrollBarStatus.hitScrollY) {\n                e.detail.preventDefault();\n                e.detail.bubbles = false;\n                const clientY = e.detail.event.clientY;\n                Object.assign(this._scrollBarStatus, {\n                    dragging: true,\n                    target: this._scrollbarY,\n                    barStartY: this._scrollbarY.anchor[1],\n                    barInitY: clientY,\n                });\n                this.onScrollbarPressStart();\n            }\n        })\n    }\n\n    onScrollbarPressStart() {\n        const jflowInstance = this._jflow;\n        const canvas = jflowInstance.canvas;\n        const f = (e => {\n            const { clientX, clientY } = e;\n            this.onDraggingScrollbar(clientX, clientY)\n        }).bind(this);\n        document.addEventListener('pointermove', f);\n        const t = (e => {\n            Object.assign(this._scrollBarStatus, {\n                dragging: false,\n                target: null,\n                barInitX: 0,\n                barInitY: 0,\n                barStartX: 0,\n                barStartY: 0,\n                hitScrollX: false,\n                hitScrollY: false,\n            });\n            document.removeEventListener('pointermove', f);\n            document.removeEventListener('pointerup', t);\n            canvas.removeEventListener('pointerup', t);\n        }).bind(this);\n        canvas.addEventListener('pointerup', t, {\n            once: true\n        })\n        document.addEventListener('pointerup', t, {\n            once: true\n        })\n    }\n\n    onDraggingScrollbar(clientX, clientY) {\n        if(this._scrollbarX.visible && this._scrollBarStatus.dragging) {\n            const JFLOW = this._jflow;\n            const scale = JFLOW.scale;\n            const {\n                target,\n                barInitX,\n                barStartX,\n                barInitY,\n                barStartY\n            } = this._scrollBarStatus;\n            if(target.dir === 'x') {\n                const _scrollWidth = this._scrollbarX.width;\n                const _outerWidth = this._outerWidth;\n                const deltaX = clientX - barInitX;\n                const xnew = barStartX + deltaX / scale;\n                const q = target.anchor[0] = Math.max(Math.min(xnew, _outerWidth - _scrollWidth), 0);\n                const ratioInX = q / (_outerWidth - _scrollWidth);\n                const s = (this._innerWidth - _outerWidth)/2;\n                this._offset[0] = s - (this._innerWidth - _outerWidth) * ratioInX\n                JFLOW.scheduleRender()\n            }\n\n            if(target.dir === 'y') {\n                const _scrollHeight = this._scrollbarY.height;\n                const _outerHeight = this._outerHeight;\n                const deltaY = clientY - barInitY;\n                const ynew = barStartY + deltaY / scale;\n                const q = target.anchor[1] = Math.max(Math.min(ynew, _outerHeight - _scrollHeight), 0);\n                const ratio = q / (_outerHeight - _scrollHeight);\n                const s = (this._innerHeight - _outerHeight)/2;\n                this._offset[1] = s - (this._innerHeight - _outerHeight) * ratio\n                JFLOW.scheduleRender()\n            }\n        }\n    }\n\n\n    setConfig(configs) {\n        this._shape.setConfig(configs);\n    }\n\n    _getBoundingGroupRect() {\n        const points = this._stack.getBoundingRectPoints();\n        // content box \n        const bbox = bounding_box(points);\n        const w = bbox.width;\n        const h = bbox.height;\n        const outerWidth = this.definedWidth || Math.min(w, this.maxWidth);\n        const outerHeight = this.definedHeight || Math.min(h, this.maxHeight);\n        this._innerWidth = w;\n        this._outerWidth = outerWidth;\n        this._innerHeight = h;\n        this._outerHeight = outerHeight;\n\n        this._shape.width = outerWidth;\n        this._shape.height = outerHeight;\n        this.width = outerWidth;\n        this.height = outerHeight;\n    }\n\n    _calculatePointBack(point) {\n        const [gx, gy] = point;\n        const [tx, ty] = this._offset;\n        const [cx, cy] = this.anchor; \n        const p = [gx - cx - tx, gy - cy - ty]\n        return p\n    }\n\n    _calculatePointBackWithPoint(a, b, arr, idx1, idx2) {\n        const anchor = this.anchor;\n        const offset = this._offset;\n        arr[idx1] = a - anchor[0] - offset[0];\n        arr[idx2] = b - anchor[1] - offset[1];\n    }\n\n    calculateToCoordination(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this.anchor;  \n        const [tx, ty] = this._offset;\n        const p = [gx + cx - tx, gy + cy - ty]\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            return this._belongs.calculateToCoordination(p);\n        } else {\n            return p;\n        }\n    }\n\n    calculateToRealWorld(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this.anchor;  \n        const [tx, ty] = this._offset;\n        const p = [gx + cx - tx, gy + cy - ty]\n        if(this._belongs && this._belongs.calculateToRealWorld) {\n            return this._belongs.calculateToRealWorld(p);\n        }\n    }\n\n    _getViewBox() {\n        const cacheViewBox = this._cacheViewBox;\n        this._calculatePointBackWithPoint(0, 0, cacheViewBox, 0, 1);\n        this._calculatePointBackWithPoint(this.width, this.height, cacheViewBox, 2, 3);\n        return cacheViewBox;\n    }\n\n    getCacheViewBox() {\n        return this._cacheViewBox;\n    }\n\n    _resetOffset() {\n        this._offset = [\n            Math.max((this._innerWidth - this._outerWidth)/2, 0),\n            Math.max((this._innerHeight - this._outerHeight)/2, 0),\n        ];\n        if(this._innerWidth > this._outerWidth) {\n            this._scrollbarX.visible = true;\n            this._scrollbarX.width = this._outerWidth * this._outerWidth / this._innerWidth;\n            this._scrollbarX.anchor = [0, this._outerHeight - 4]\n        } else {\n            this._scrollbarX.visible = false;\n        }\n        if(this._innerHeight > this._outerHeight) {\n            this._scrollbarY.visible = true;\n            this._scrollbarY.height = this._outerHeight * this._outerHeight / this._innerHeight;\n            this._scrollbarY.anchor = [this._outerWidth - 4, 0]\n        } else {\n            this._scrollbarY.visible = false;\n        }\n    }\n\n    render(ctx) {\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        } else if(this.opacity !== 1) {\n            ctx.globalAlpha = this.opacity;\n        }\n        const [cx, cy] = this.anchor; \n        const w = this.width;\n        const h = this.height;\n        const w2 = w/2;\n        const h2 = h/2;\n        // if((this.width * this.height) * this._jflow.scale < 144) {\n        //     ctx.restore();\n        //     return;\n        // }\n        const [tx, ty] = this._offset;\n        ctx.translate(cx, cy);\n        this._shape.render(ctx);\n        ctx.translate(-w2, -h2);\n        if(this._scrollbarX.visible) {\n            this._scrollbarX.render(ctx);\n        }\n        if(this._scrollbarY.visible) {\n            this._scrollbarY.render(ctx);\n        }\n\n        ctx.translate(w2, h2);\n        ctx.save();\n        ctx.beginPath();\n        ctx.rect(-w2, -h2, w, h);\n        ctx.clip();\n        ctx.translate(tx, ty);\n        this._stack.render(ctx);\n        this._linkStack.render(ctx);    \n        ctx.translate(-cx-tx, -cy-ty);\n        ctx.restore();\n    }\n\n    isHit(point, condition) {\n        const [gx, gy] = point;\n        const [cx, cy] = this.anchor; \n        const w = this.width/2;\n        const h = this.height/2;\n        const sp = [gx - cx + w, gy - cy + h]\n        this._scrollBarStatus.hitScrollX = false;\n        this._scrollBarStatus.hitScrollY = false;\n        if(this._scrollbarX.visible) {\n            const xhit = this._scrollbarX.isHit(sp);\n            if(xhit) {\n                this._scrollBarStatus.hitScrollX = true;\n                this._scrollbarX.setHit(true)\n                return true;\n            }\n        }\n        this._scrollbarX.setHit(false)\n\n        if(this._scrollbarY.visible) {\n            const yhit = this._scrollbarY.isHit(sp);\n            if(yhit) {\n                this._scrollBarStatus.hitScrollY = true;\n                this._scrollbarY.setHit(true)\n                return true;\n            }\n        }\n        this._scrollbarY.setHit(false)\n       \n        // const br = this._getViewBox();\n        const isInBound = this._shape.isHit([gx - cx, gy - cy]);\n        if(isInBound) {\n            const [tx, ty] = this._offset;\n            const p = [gx - cx - tx, gy - cy - ty];\n            this._currentp = p; // 暂存，为了后续计算别的位置\n            const target = this._stack.checkHit(p, condition); \n            if(target) return target; \n        } else {\n            this._stack.resetHitStatus();\n        }\n        return false;\n    }\n\n    getBoundingDimension() {\n        return {\n            width: this.width,\n            height: this.height,\n        }\n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n\n    getIntersectionsInFourDimension() {\n        let p2 = this.anchor;\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            p2 = this._belongs.calculateToCoordination(p2);\n        }\n\n        const [x2, y2] = p2;\n        const w = this.width/2;\n        const h = this.height/2;\n        return {\n            [DIRECTION.RIGHT]:  [x2+w, y2],\n            [DIRECTION.LEFT]:   [x2-w, y2],\n            [DIRECTION.BOTTOM]: [x2, y2+h],\n            [DIRECTION.TOP]:    [x2, y2-h],\n            [DIRECTION.SELF]:   [x2+w*0.618, y2+h*0.618]\n        }\n    }\n\n    onEnterViewbox() {\n        this.interateNodeStack((instance) => {\n            instance.onEnterViewbox();\n        })\n    }\n    onLeaveViewbox() {\n        this.interateNodeStack((instance) => {\n            instance.onLeaveViewbox();\n        })\n    }\n    destroy() {\n        this._shape.destroy();\n        this.interateNodeStack((instance) => {\n            instance.destroy();\n        })\n    }\n\n    clone() {\n        const C = this.constructor;\n        const configs = Object.assign({}, this._rawConfigs, {\n            layout: this._layout && this._layout.clone(),\n        })\n        const t = new C(configs);\n        this.interateNodeStack((instance) => {\n            t.addToStack(instance.clone());\n        })\n        t.recalculate();\n        t.visible = this.visible;\n        return t;\n    }\n}\n\nObject.assign(ScrollGroup.prototype, StackMixin);\nObject.assign(ScrollGroup.prototype, LayoutMixin);\nObject.assign(ScrollGroup.prototype, {\n    recalculateUp() {\n        let dirty = true;\n        \n        if(this.getBoundingDimension) {\n            // const { width: wold, height: hold } = this.getBoundingDimension();\n            const wold = this._innerWidth;\n            const hold = this._innerHeight;\n            if(this.resetChildrenPosition) {\n                this.resetChildrenPosition();\n            }\n            if(this._getBoundingGroupRect){\n                this._getBoundingGroupRect();\n            }\n            this.reflow();\n            if(this._getBoundingGroupRect){\n                this._getBoundingGroupRect();\n            }\n            const wnow = this._innerWidth;\n            const hnow = this._innerHeight;\n            // const { width: wnow, height: hnow } = this.getBoundingDimension();\n            dirty = (wold !== wnow || hold !== hnow)\n        } else {\n            this.reflow();\n        }\n        if(this._belongs && dirty) {\n            this._resetOffset();\n            this._belongs.recalculateUp();\n        }\n    },\n\n    recalculate() {\n        const { width: wold, height: hold } = this.getBoundingDimension();\n        this.reflow();\n        if(this._getBoundingGroupRect){\n            this._getBoundingGroupRect();\n        }\n        const { width: wnow, height: hnow } = this.getBoundingDimension();\n        if (wold !== wnow || hold !== hnow) {\n            this._resetOffset();\n        }\n    },\n})\n\n\nexport default ScrollGroup","export default {\n    canvas: {\n        wheel (event, jflow) {\n            event.preventDefault();\n            let { offsetX, offsetY, deltaX, deltaY } = event \n            if(event.ctrlKey) { \n                deltaY = -deltaY;\n            }\n            jflow.zoomHandler(offsetX, offsetY, deltaX, deltaY, event);\n        },\n    }\n}","import Instance from './instance';\n\n/**\n * @typedef {Instance~Configs} BaseLink~Configs\n * @property {Instance} from   - 起始单元\n * @property {Instance} to     - 终止单元\n * @property {String} fromDir  - 起始方向 \n * @property {String} toDir    - 终止方向 \n * @property {String} key      - 连线唯一键值\n * @property {String} backgroundColor    - 线条颜色 \n */\n/**\n * 连线基类\n * @constructor BaseLink\n * @extends Instance\n * @param {BaseLink~Configs} configs - 配置\n */\nclass BaseLink extends Instance{\n    constructor(configs = {}) {\n        super();\n        /** @member {Instance}      - 起始单元 */\n        this.from     = configs.from;\n        /** @member {Instance}      - 终止单元 */\n        this.to       = configs.to;\n        /** @member {DIRECTION}      - 起始方向 */\n        this.fromDir  = configs.fromDir;\n        /** @member {DIRECTION}      - 终止方向 */\n        this.toDir    = configs.toDir;\n        /** @member {number[][]}     - 连线控制点缓存 */\n        this._cachePoints = null;\n        /** @member {string}     - 连线颜色，默认为 #000 */\n        this.backgroundColor = configs.backgroundColor || '#000';\n\n        this.isSelf        = !!configs.isSelf\n    }\n\n    /**\n     * 是否出现在当前视窗内\n     * @param {number[]} viewbox\n     */\n    isInViewBox(viewbox){\n        return true;\n    }\n\n    bringToTop() {\n        const linkStack = this._jflow._linkStack;\n        const index = linkStack.findIndex(l => l === this);\n        linkStack.splice(index, 1);\n        linkStack.push(this);\n        this._jflow._render();\n    }\n\n    \n}\n\nexport default BaseLink;","import Node from '../node';\n\nclass ShadowCache extends Node {\n    constructor(configs) {\n        super(configs);\n        // this.imageData = configs.imageData;\n        this.width = configs.width;\n        this.height = configs.height;\n        this.imageBuffer = document.createElement('canvas');\n        this.imageBuffer.width = this.width + 2;\n        this.imageBuffer.height = this.height + 2;\n        configs.cache(this.imageBuffer.getContext('2d'));\n    }\n\n    render(ctx) {\n        const [cx, cy] = this.anchor;\n        ctx.save();\n        ctx.translate(cx, cy);\n        ctx.beginPath();\n        ctx.drawImage(this.imageBuffer, -this.width/2, -this.height/2);\n        ctx.translate(-cx, -cy);\n        ctx.restore();\n    }\n\n    getBoundingDimension() {\n        return {\n            height: this.height,\n            width: this.width,\n        }\n    }\n\n    recalculate(){}\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n}\n\n\nexport default ShadowCache;","import Rectangle from \"../shapes/rectangle\";\nimport { requestCacheCanvas } from '../../utils/canvas';\nimport JFlowEvent from '../../events'\nimport ShadowCache from '../shapes/shadow-cache';\n\nconst TEXT_ALIGN = {\n    CENTER: 'center',\n    LEFT: 'left',\n    RIGHT: 'right',\n};\n\nclass Text extends Rectangle {\n    constructor(configs) {\n        super(configs);\n        this.type =         'Text';\n        this.content =      configs.content || '';\n        this.fontFamily =       configs.fontFamily || '-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji'\n        this.fontSize =         configs.fontSize || '14px';\n        this.fontWeight =       configs.fontWeight || '';\n        this.textColor =        configs.textColor || 'white';\n        this.placeholderColor = configs.placeholderColor ||  configs.textColor || 'white';\n        this.textAlign =        configs.textAlign || TEXT_ALIGN.CENTER;\n        this.textBaseline =     configs.textBaseline || 'middle';\n        this.lineHeight =       configs.lineHeight ;\n        this.indent =           configs.indent || 0;\n        this.backgroundColor =  configs.backgroundColor;\n        this.editable =         configs.editable;\n        this.definedWidth =     configs.definedWidth;\n        this.minWidth =         configs.minWidth || 0;\n        this.maxWidth =         configs.maxWidth;\n        this.ellipsis =         configs.ellipsis;\n\n        this.placeholder =      configs.placeholder || '';\n        this.emptyWhenInput =   configs.emptyWhenInput || false;\n        \n        this.editting =         false;\n        this.disabled =         configs.disabled;\n\n        this.cursorColor =      configs.cursorColor || '#60CFC4';\n        this.textRangeColor =   configs.textRangeColor || '#4E75EC1A';\n\n        this._status = {\n            editing: false,\n            cursorshow: true,\n            cursoranime: null,\n            lastElapsed: 0,\n            refreshElapsed: false,\n\n            cursorDragging: false,\n            shiftOn: false,\n\n            oldVal: '',\n            inputElement: null,\n        }\n\n        this._cursorOffset = 0;\n\n        this._textRange = {\n            enable: false,\n            rangefrom: null, // offsetfrom\n            rangeTo: null,   // offsetto\n            initialRange: null // offset\n        }\n        if(this.editable) {\n            this._makeFunctional();\n        }\n\n        this.preCalculateText();\n        this.shadowCache();\n        \n    }\n\n    get currentContent() {\n        return this.content || this.placeholder;\n    }\n\n    get isEmpty() {\n        return !this.content;\n    }\n\n    preCalculateText() {\n        requestCacheCanvas((ctx) => {\n            ctx.beginPath();\n            ctx.font = `${this.fontSize} ${this.fontFamily}`;\n            ctx.textAlign = this.textAlign;\n            ctx.textBaseline = this.textBaseline;\n            const t_h = parseInt(this.fontSize);\n            const content = this.currentContent;\n            const {\n                // actualBoundingBoxLeft,\n                // actualBoundingBoxRight,\n                fontBoundingBoxAscent,\n                fontBoundingBoxDescent,\n                width,\n            } = ctx.measureText(content);\n\n            this._textWidth = this.indent + width;\n            if(this.definedWidth) {\n                if(this.ellipsis && (this._textWidth > this.definedWidth)) {\n                    const offset = this._calculateOffset(this.definedWidth - 12);\n                    this.ellipsisContent = content.substring(0, offset) + '...'; \n                } else {\n                    this.ellipsisContent = content;\n                }\n                this.width = this.definedWidth;\n            } else if(this.maxWidth && this.ellipsis) {\n                if(this._textWidth > this.maxWidth) {\n                    const ratio =this.maxWidth / this._textWidth;\n                    const l = Math.floor(content.length * ratio - 3);\n                    this.ellipsisContent = content.substring(0, l) + '...'; \n                }  else {\n                    this.ellipsisContent = content;\n                }\n                this.width = Math.min(this.maxWidth, this._textWidth);\n            } else{ \n                this.width = Math.max(this.minWidth, this._textWidth);\n            }\n            \n            const height = (Math.abs(fontBoundingBoxAscent) + Math.abs(fontBoundingBoxDescent)) || t_h;\n            this._textHeight = height;\n            if(this.lineHeight) {\n                this.height = this.lineHeight;\n            } else {\n                this.height = height;\n            }\n        });\n    }\n\n    shadowCache() {\n        const scale = window.devicePixelRatio;\n        const w = this.width * scale;\n        const h = this.height * scale;\n        const i = this.indent * scale;\n        const size = parseInt(this.fontSize) * scale;\n        this._shadowCache = new ShadowCache({\n            width: w,\n            height: h,\n            cache: (ctx) => {\n                // const [cx, cy] = this.anchor;\n                // ctx.scale(4, 4)\n                ctx.translate(w/2, h/2);\n                const font = `${this.fontWeight} ${size}px ${this.fontFamily}`;\n                ctx.font = font\n                ctx.textAlign = this.textAlign;\n                ctx.textBaseline = this.textBaseline;\n                ctx.fillStyle = this.isEmpty ? this.placeholderColor : this.textColor;\n                let content = this.currentContent;\n                if(this.ellipsisContent) {\n                    content = this.ellipsisContent;\n                }\n                if(content) {\n                    if(this.textAlign === TEXT_ALIGN.LEFT){\n                        const hw = w / 2;\n                        ctx.fillText(content,  -hw + i / 2, 0);\n                    } else if(this.textAlign === TEXT_ALIGN.RIGHT) {\n                        const hw = w / 2;\n                        ctx.fillText(content, hw, 0);\n                    } else {\n                        ctx.fillText(content, i / 2, 0);\n                    }\n                    \n                }\n            }\n        });\n        \n    }\n\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k];\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n        this.preCalculateText();\n        this.shadowCache();\n    }\n\n    click() {\n        if(!this._status.editing) {\n            let flag = true;\n            this.dispatchEvent(new JFlowEvent('edit', {\n                target: this,\n                preventDefault() {\n                    flag = false;\n                }\n            }))  \n            if(!flag) {\n                return;\n            }\n\n            const point = this._belongs._currentp;\n            const jflow = this._jflow; \n            if(point) {\n                this._cursorOffset = this._positionToCursorOffset(point);\n            } else {\n                this._cursorOffset = 0;\n            }\n            \n            const inputElement = createInputElement(\n                this._controlCallback.bind(this),\n                this._defaultCallback.bind(this));\n            const wrapper = jflow.DOMwrapper;\n            wrapper.append(inputElement);  \n            inputElement.focus({ preventScroll: true });      \n            jflow.setFocusInstance(this);\n\n            Object.assign(this._status, {\n                editing: true,\n                oldVal: this.content,\n                inputElement,\n                cursoranime: jflow.requestJFlowAnime((elapsed) => {\n                    const lastElapsed = this._status.lastElapsed;\n                    if(this._status.refreshElapsed) {\n                        this._status.lastElapsed = elapsed;\n                        this._status.refreshElapsed = false;\n                    }\n                    if(elapsed - lastElapsed > 500) {\n                        this._status.cursorshow = !this._status.cursorshow;\n                        this._status.lastElapsed = elapsed;\n                    } \n                })\n            });\n            if(this.emptyWhenInput) {\n                this.content = '';\n            }\n            this.syncShadowInputPosition();\n        }\n    }\n\n    _makeFunctional() {\n        const blurHandler = (event) => {\n            this._status.editing = false;\n            if(this._status.inputElement) {\n                this._status.inputElement.remove();\n            }\n            if(this._belongs) {\n                this._jflow.scheduleRender();\n            } \n        };\n        this.addEventListener('dblclick', (event) => {\n            if(event.currentTarget !== this) {\n                return\n            }\n            if(this._status.editing) {\n                this._selectFullRange();\n            } \n        });\n        this.addEventListener('click', (event) => {\n            if(event.currentTarget !== this) {\n                return\n            }\n            // event.detail.bubbles = false;\n            if(this._status.editing) {\n                const point = this._belongs._currentp;\n                const offset = this._positionToCursorOffset(point);\n                if(this._status.shiftOn) {\n                    const initialRange = this._textRange.initialRange;\n                    Object.assign(this._textRange, {\n                        rangefrom: Math.min(offset, initialRange),\n                        rangeTo: Math.max(offset, initialRange),\n                        enable: true,\n                    });\n                    this._cursorOffset = this._textRange.rangeTo;\n                    this._status.inputElement.focus({ preventScroll: true });\n                    // this._refreshCursor();  \n                } else {\n                    this._cursorOffset = offset\n                    this._status.inputElement.focus({ preventScroll: true });\n                    this._refreshCursor();  \n                    this.syncShadowInputPosition();\n                }\n            } \n            this.click();\n        })\n        this.addEventListener('blur', (event) => {\n            blurHandler(event);\n            this.dispatchEvent(new JFlowEvent('change', {\n                target: this,\n                oldVal: this._status.oldVal,\n                val: this.content,\n            }));\n            this._textRange.enable = false;\n            this._status.cursoranime.cancel()\n            Object.assign(this._status, {\n                editing: false,\n                cursorshow: true,\n                cursoranime: null,\n                lastElapsed: 0,\n                refreshElapsed: false,\n\n                cursorDragging: false,\n                shiftOn: false,\n\n                oldVal: '',\n                inputElement: null,\n            })\n        })\n        this.addEventListener('instancePressStart', (event) => {\n            if(this._status.editing && !this._status.shiftOn) {\n                event.detail.bubbles = false;\n                event.detail.preventDefault();\n                const point = this._belongs._currentp;\n                const c = this._positionToCursorOffset(point);\n\n                this._textRange.initialRange = c;\n                const jflow = event.detail.jflow;\n                let moved = false;\n                const t = (e => {\n                    moved = true;\n                    const { offsetX, offsetY } = e;\n                    const p = jflow._calculatePointBack([offsetX, offsetY]);\n                    jflow._stack.checkHit(p)\n                    const point = this._belongs._currentp;\n                    const c = this._positionToCursorOffset(point);\n                    const initialRange = this._textRange.initialRange;\n                    this._status.editing = false;\n                    Object.assign(this._textRange, {\n                        rangefrom: Math.min(c, initialRange),\n                        rangeTo: Math.max(c, initialRange),\n                        enable: true,\n                    });\n                }).bind(this);\n\n                document.addEventListener('pointermove', t)\n                document.addEventListener('pointerup', (e) => {\n                    document.removeEventListener('pointermove', t);\n                    if(!moved) {\n                        this._textRange.initialRange = null;\n                        return;\n                    }\n                    const rangeTo = this._textRange.rangeTo;\n                    this._cursorOffset = rangeTo;\n                    this._status.editing = true;\n                    this._status.inputElement.focus({ preventScroll: true });   \n                    this._textRange.initialRange = null;\n                }, {\n                    once: true,\n                })\n            }\n        });\n    }\n\n    _positionToCursorOffset(point) {\n        const [x] = point;\n        const w = this.width/2;\n        const [ox] = this.anchor;\n        const offsetX = x - (ox - w);\n        let cursorOffset = 0;\n        if(offsetX >= this._textWidth) {\n            cursorOffset = this.content.length;\n        } else {\n            cursorOffset = this._calculateOffset(offsetX);\n        }\n\n        return cursorOffset;\n    }\n\n    _calculateOffset(offx) {\n        const content = this.content;\n        const maxL = content.length - 1;\n        const contentWidth = this._textWidth;\n        if(contentWidth === 0) {\n            return 0;\n        }\n        const allwidth = contentWidth;\n        let idx = Math.floor(offx / allwidth * maxL) ;\n        requestCacheCanvas((ctx) => {\n            ctx.font = `${this.fontSize} ${this.fontFamily}`;\n            let g1, g2;\n            let lastidx;\n\n            let c = content.substring(0, idx);\n            let c1 = content.substring(idx-1, idx);\n            let c2 = content.substring(idx, idx+1);\n            let w = ctx.measureText(c).width;\n            let w1 = ctx.measureText(c1).width;\n            let w2 = ctx.measureText(c2).width;\n            g1 = w - w1/2;\n            g2 = w + w2/2;\n            \n            do {\n                if(g1 <= offx && g2 >= offx) {\n                    break;\n                }  \n                if(g1 > offx) {\n                    // 左侧少了\n                    const spanw = g2 - offx;\n                    lastidx = idx;\n                    if(spanw < 100) {\n                        idx -= 1;\n                    } else {\n                        idx -= Math.floor(spanw / g2 * lastidx)\n                    }\n                    c = content.substring(idx, lastidx);\n                    w -= ctx.measureText(c).width;\n                } else if(g2 < offx) {\n                    // 右侧少了\n                    const spanw = offx - g1;\n                    lastidx = idx;\n                    if(spanw < 100) {\n                        idx += 1;\n                    } else {\n                        idx += Math.floor(spanw / (allwidth - g1) * (maxL - lastidx))\n                    }\n                    c = content.substring(lastidx, idx);\n                    w += ctx.measureText(c).width;\n                }\n                \n                c1 = content.substring(idx-1, idx);\n                c2 = content.substring(idx, idx+1);\n                w1 = ctx.measureText(c1).width;\n                w2 = ctx.measureText(c2).width;\n                g1 = w - w1/2;\n                g2 = w + w2/2;\n            } while(idx >= 0 && idx <= maxL)\n            \n        });\n        return idx;\n    }\n\n    _refreshCursor() {\n        if(this._status.editing) {\n            Object.assign(this._status, {\n                cursorshow: true,\n                refreshElapsed: true,\n            });\n        }\n        if(this._textRange.enable) {\n            this._textRange.enable = false;\n        }\n    }\n\n    render(ctx) {\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        if(!ctx.disableCache && !this._status.editing && this._jflow.scale * parseInt(this.fontSize) < 8) {\n            const [cx, cy] = this.anchor;\n            // this._shadowCache.render(ctx);\n            ctx.save();\n            ctx.translate(cx, cy);\n            ctx.beginPath();\n            ctx.drawImage(this._shadowCache.imageBuffer, -this.width/2, -this.height/2, this.width, this.height);\n            ctx.translate(-cx, -cy);\n            ctx.restore();\n            return;\n        }\n\n        const font = `${this.fontWeight} ${this.fontSize} ${this.fontFamily}`;\n        if(ctx.font !== font) {\n            ctx.font = font\n        }\n\n        if(ctx.textAlign !== this.textAlign) {\n            ctx.textAlign = this.textAlign;\n        }\n\n        if(ctx.textBaseline !== this.textBaseline) {\n            ctx.textBaseline = this.textBaseline;\n        }\n\n        ctx.fillStyle = this.isEmpty ? this.placeholderColor : this.textColor;\n        let content = this.currentContent;\n        if(this.ellipsisContent) {\n            content = this.ellipsisContent;\n        }\n        if(content) {\n            if(this.textAlign === TEXT_ALIGN.LEFT){\n                const hw = this.width / 2;\n                ctx.fillText(content, this.anchor[0] - hw + this.indent / 2, this.anchor[1]);\n            } else if(this.textAlign === TEXT_ALIGN.RIGHT) {\n                const hw = this.width / 2;\n                ctx.fillText(content, this.anchor[0] + hw, this.anchor[1]);\n            } else {\n                ctx.fillText(content, this.anchor[0] + this.indent / 2, this.anchor[1]);\n            }\n            \n        }\n\n        const hw = this.width/2;\n        const textheight = this._textHeight\n        const [x, y] = this.anchor;\n        const lx = x - hw;\n        const ly = y - textheight/2;\n\n        if(this._status.cursorshow && this._status.editing) {\n            const offset = this._cursorOffset;\n            const c = this.content.substring(0, offset);\n            const cw = lx + ctx.measureText(c).width;\n            const c_len = this._textHeight/2;\n            ctx.beginPath();\n            ctx.moveTo(cw, y - c_len);\n            ctx.lineTo(cw, y + c_len);\n            ctx.lineWidth = 2;\n            ctx.strokeStyle = this.cursorColor;\n            ctx.stroke();\n        }\n\n        if(this._textRange.enable) {\n            const {\n                rangefrom, rangeTo\n            } = this._textRange;\n            const c = this.content.substring(0, rangefrom);\n            const range = this.content.substring(rangefrom, rangeTo)\n            \n            const x = lx + ctx.measureText(c).width;\n            const w = ctx.measureText(range).width;\n            ctx.beginPath();\n            ctx.rect(x, ly, w, textheight);\n            ctx.fillStyle = this.textRangeColor\n            ctx.fill();\n        } \n    }\n\n    _inputControl(op, data) {\n        if(this._textRange.enable) {\n            this._clearTextRange();\n            if(op === 'Backspace') {\n                this.dispatchEvent(new JFlowEvent('input', {\n                    target: this,\n                    oldVal: this._status.oldVal,\n                    val: this.content,\n                }));\n                this.refresh();\n                this.syncShadowInputPosition();\n                return;\n            }\n        }\n        const offset = this._cursorOffset;\n        const content = this.content;\n        let preContent = content.substring(0, offset);\n        let afterContent \n        if(this.cacheIdx) {\n            afterContent = content.substring(this.cacheIdx[1]);\n        } else {\n            afterContent = content.substring(offset);\n        }\n        let stopInputEvent = false;\n        switch(op){\n            case \"Input\":\n                preContent += data;\n                this._cursorOffset += data.length;\n                this.content = preContent + afterContent;\n                break;\n            case \"compositionstart\":\n                this.cacheIdx = [preContent.length, preContent.length];\n                break;\n            case \"compositionupdate\":\n                preContent = preContent.substring(0, this.cacheIdx[0]);\n                preContent += data;\n                this.content = preContent + afterContent;\n\n                this._cursorOffset = this.cacheIdx[0] + data.length;\n                this.cacheIdx[1] = this.cacheIdx[0] + data.length;\n                break;\n            case \"compositionend\":\n                preContent = preContent.substring(0, this.cacheIdx[0]);\n                this._cursorOffset = this.cacheIdx[0] + data.length;\n                this.cacheIdx = null;\n                preContent += data;\n                this.content = preContent + afterContent;\n                break;\n            case \"Enter\":\n                if(this.cacheIdx) {\n                    return;\n                }\n                let defaultAct = true;\n                \n                this.dispatchEvent(new JFlowEvent('enterkeypressed', {\n                    target: this,\n                    handler: (val) => {\n                        defaultAct = val;\n                    },\n                    stopInput() {\n                        stopInputEvent = true;\n                    }\n                }))\n                if(defaultAct) {\n                    this._jflow.blur();\n                }\n         \n                break;\n            case \"Backspace\":\n                preContent = preContent.substring(0, preContent.length - 1);\n                this._cursorOffset = Math.max(0, this._cursorOffset-1);\n                this.content = preContent + afterContent;\n                break;\n            \n        }\n\n        if(!stopInputEvent) {\n            this.dispatchEvent(new JFlowEvent('input', {\n                target: this,\n                oldVal: this._status.oldVal,\n                val: this.content,\n            }));\n    \n        }\n       \n        this.refresh();\n        this.syncShadowInputPosition();\n    }\n\n    refresh() {\n        this.preCalculateText();\n        this._belongs.recalculateUp();\n        this._jflow.scheduleRender();\n    }\n\n    syncShadowInputPosition() {\n        if(this._status.editing) {\n            const hw = this.width/2;\n            const hh = this.height/2;\n            let lx = this.anchor[0] - hw;\n            const offset = this._cursorOffset;\n\n            requestCacheCanvas((ctx) => {\n                ctx.beginPath();\n                ctx.font = `${this.fontSize} ${this.fontFamily}`;\n                const c = this.content.substring(0, offset);\n                lx += ctx.measureText(c).width;\n            });\n            const point = this.calculateToRealWorld([lx, hh]);\n            const canvasMeta = this._jflow.canvasMeta;\n            const px = Math.min(canvasMeta.actual_width - 120, point[0]);\n            this._status.inputElement.style.transform = `translate(${px}px, ${point[1]}px)`\n        }\n    }\n\n    _controlCallback(op, data, e) {\n        if(this._status.editing) {\n            Object.assign(this._status, {\n                cursorshow: true,\n                refreshElapsed: true,\n            });\n        }\n        switch(op){\n            case \"Input\":\n            case \"compositionstart\":\n            case \"compositionupdate\":\n            case \"compositionend\":\n            case \"Enter\":\n            case \"Backspace\":\n                this._inputControl(op, data);\n                break;\n            case \"ArrowLeft\":\n                if(this._textRange.enable) {\n                    this._textRange.enable = false;\n                }\n                this._onArrowLeft();\n                break;\n            case \"ArrowRight\":\n                if(this._textRange.enable) {\n                    this._textRange.enable = false;\n                }\n                this._onArrowRight();\n                break;\n            case \"Shift\":\n                this._onShiftToggle(data)\n                break;\n            case \"CtrlA\":\n                this._selectFullRange();\n                break;\n            case \"COPY\":\n                this._copy(e);\n                break;\n            case \"CUT\":\n                this._cut(e);\n                break;\n            case \"PASTE\":\n                this._paste(e);\n                break;\n        }\n\n    }\n\n    _onArrowLeft() {\n        this._cursorOffset = Math.max(0, this._cursorOffset - 1);\n        this._jflow.scheduleRender();\n        this.syncShadowInputPosition();\n    }\n\n    _onArrowRight() {\n        this._cursorOffset = Math.min(this.content.length, this._cursorOffset + 1);\n        this._jflow.scheduleRender();\n        this.syncShadowInputPosition();\n    }    \n\n    _onShiftToggle(val) {\n        this._status.shiftOn = val;\n        if(val) {\n            this._textRange.initialRange = this._cursorOffset;\n        } else {\n            this._textRange.initialRange = null;\n        }\n    }\n\n    _selectFullRange() {\n        this._textRange = {\n            enable: true,\n            rangefrom: 0,\n            rangeTo: this.content.length\n        }\n        this._cursorOffset = this.content.length;\n    }\n\n    _clearTextRange() {\n        if(this._textRange.enable) {\n            const { rangefrom, rangeTo } = this._textRange;\n            const content = this.content;\n            const preContent = content.substring(0, rangefrom);\n            const afterContent = content.substring(rangeTo);\n            this.content = preContent + afterContent;\n            this._cursorOffset = preContent.length;\n            this._textRange.enable = false;\n        }\n    }\n\n    _getSelection() {\n        if(this._textRange.enable) {\n            const { rangefrom, rangeTo } = this._textRange;\n            const content = this.content;\n            return content.substring(rangefrom, rangeTo);\n        }\n        return null;\n    }\n\n    _copy(event) {\n        const selection = this._getSelection();\n        if(selection) {\n            event.clipboardData.setData(\"text/plain\", selection);\n        }\n    }\n    _cut(event) {\n        const selection = this._getSelection();\n        if(selection) {\n            event.clipboardData.setData(\"text/plain\", selection);\n            this._clearTextRange();\n            this.refresh();\n        }\n    }\n    _paste(event) {\n        let pasteContent = (event.clipboardData || window.clipboardData).getData(\"text\");\n        let flag = false;\n        this.dispatchEvent(new JFlowEvent('paste', {\n            target: this,\n            content: pasteContent,\n            preventDefault() {\n                flag = true;\n            },\n            resolvePasteContent(callback) {\n                pasteContent = callback(pasteContent);\n            }\n        }));\n        if(flag) {\n            return;\n        }\n        this._clearTextRange();\n        const offset = this._cursorOffset;\n        const content = this.content;\n        const preContent = content.substring(0, offset);\n        const afterContent = content.substring(offset);\n        this.content = preContent + pasteContent + afterContent;\n        this._cursorOffset = (preContent + pasteContent).length;\n        this.refresh();\n    }\n    _defaultCallback(op, e) {\n        switch(op){\n            case 'KeyDown': \n                this.dispatchEvent(new JFlowEvent('keydown', {\n                    target: this,\n                    key: e.key,\n                    code: e.code,\n                    rawEvent: e,\n                }));\n                break;\n            case 'KeyUp': \n                this.dispatchEvent(new JFlowEvent('keyup', {\n                    target: this,\n                    key: e.key,\n                    code: e.code,\n                    rawEvent: e,\n                }));\n                break;\n        }\n        \n    }\n\n    destroy() {\n        if(this._jflow._focus.instance === this) {\n            this._jflow.blur();\n        }\n    }\n}       \n\nexport default Text;\n\n\nfunction createInputElement(controlCallback, defaultCallback) {\n    const input = document.createElement('input');\n    input.setAttribute('style',`\n        width: 100px;\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        opacity: 0;\n        z-index: -1;\n        contain: strict;`);\n    input.setAttribute('tabindex', -1);\n    input.setAttribute('aria-hidden', true);\n    input.setAttribute('spellcheck', false);\n    input.setAttribute('autocorrect', 'off');\n\n\n    // let content = configs.content;\n    // let startidx = 0;\n\n    // function renderContent() {\n    //     configs.callback(content)\n    // }\n    let stopInput = false;\n    let status = {\n        ctrlOn: false,\n    }\n\n    input.addEventListener('beforeinput', e => {\n        e.preventDefault();\n        if(e.data) {\n            // content += e.data;\n            // renderContent();\n            if(!stopInput) {\n                controlCallback('Input', e.data);\n            }\n        }\n    })\n\n    input.addEventListener('compositionstart', (e) => {\n        // cache composition start offset\n        // startidx = content.length;\n        controlCallback('compositionstart');\n        stopInput = true;\n    });\n    input.addEventListener('compositionupdate', (e) => {\n        // update content\n        // content = content.substring(0, startidx);\n        // content += e.data;\n        // renderContent();\n        controlCallback('compositionupdate', e.data);\n    });\n    input.addEventListener('compositionend', (e) => {\n        // replace text at start offset\n        // content = content.substring(0, startidx);\n        // startidx = 0;\n        // content += e.data;\n        // renderContent();\n        controlCallback('compositionend', e.data);\n        input.value = '';\n        stopInput = false\n    });\n\n    input.addEventListener('keyup', (event) => {\n        switch(event.key) {\n            case \"Shift\":\n                controlCallback(\"Shift\", false);\n                break;\n            case \"Meta\":\n            case \"Control\":\n                status.ctrlOn = false;\n                break;\n            \n        }\n    });\n\n    input.addEventListener('keydown', (event) => {\n        switch(event.code) {\n            case \"Enter\":\n                // content = content + '\\n';\n                // renderContent();\n                controlCallback('Enter');\n                break;\n            case \"Backspace\":\n                // content = content.substring(0, content.length - 1);\n                // renderContent();\n                controlCallback('Backspace');\n                break;\n            case \"ArrowLeft\":\n                controlCallback(\"ArrowLeft\");\n                break;\n            case \"ArrowRight\":\n                controlCallback(\"ArrowRight\");\n                break;\n            case \"ArrowDown\":\n                controlCallback(\"ArrowDown\");\n                break;\n            case \"ArrowUp\":\n                controlCallback(\"ArrowUp\");\n                break;\n        }\n        switch(event.key) {\n            case \"Shift\":\n                controlCallback(\"Shift\", true);\n                break;\n            case \"Meta\":\n            case \"Control\":\n                status.ctrlOn = true;\n                break;\n            case 'a':\n                if(status.ctrlOn) {\n                    controlCallback('CtrlA');\n                }\n                break;\n        }\n    })\n\n    input.addEventListener('keyup', (event) => {\n        defaultCallback('KeyUp', event);\n    });\n\n    input.addEventListener('keydown', (event) => {\n        defaultCallback('KeyDown', event);\n    });\n\n    input.addEventListener('copy', event => {\n        event.preventDefault();\n        event.stopPropagation();\n        controlCallback('COPY', null, event);\n    });\n\n    input.addEventListener('cut', event => {\n        event.preventDefault();\n        event.stopPropagation();\n        controlCallback('CUT', null, event);\n    });\n\n    input.addEventListener('paste', event => {\n        event.preventDefault();\n        event.stopPropagation();\n        controlCallback('PASTE', null, event);\n    });\n    return input;\n}\n","import Rectangle from './shapes/rectangle';\nimport StackMixin from './stackMixin';\nimport LayoutMixin from './layoutMixin';\nimport { bounding_box } from '../utils/functions';\nimport { DIRECTION } from '../utils/constance';\n\n/**\n * @typedef {Object} Icon~ImageBounding\n * @property {number} width   - 图片宽度\n * @property {number} height   - 图片高度 \n */\n/**\n * 图片单元 配置\n * @typedef {Rectangle~RectangleConfigs} Icon~IconConfigs\n * @property {number} image   - 图片地址\n * @property {number} imageWidth   - 图片宽度\n * @property {number} imageHeight   - 图片高度\n */\n\n/**\n * 图片单元\n * @description 图片单元可以绘制图片，图片加载后会自动重新绘制\n * @constructor Icon\n * @extends Rectangle\n * @param {Icon~IconConfigs} configs - 配置\n */\nclass Icon extends Rectangle {\n    constructor(configs) {\n        super(configs)\n        /** @member {CanvasImageSource}      - 图片 */\n        this.image = configs.image;\n        this.image.onload = () => {\n            this._jflow._render();\n            // requestAnimationFrame(() => {\n                \n            // })\n        }\n        /** @member {Icon~ImageBounding}      - 图片维度 */\n        this.imageBounding = {\n            width: configs.imageWidth || configs.width,\n            height: configs.imageHeight ||  configs.height,\n        }\n    }\n\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                this[k] = configs[k];\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n        if(configs.image && !configs.image.complete) {\n            this.image.onload = () => {\n                this._jflow._render();\n                // requestAnimationFrame(() => {\n                //     this._jflow._render();\n                // })\n            }\n        }\n        this.imageBounding = {\n            width: configs.imageWidth || configs.width || this.imageBounding.width,\n            height: configs.imageHeight ||  configs.height || this.imageBounding.height,\n        }\n    }\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        Rectangle.prototype.render.call(this, ctx);\n        const x = this.anchor[0] - this.width / 2;\n        const y = this.anchor[1] - this.height / 2;\n        if(this.opacity < 1) {\n            ctx.globalAlpha = this.opacity;\n        }\n        if(this.image.complete) {\n            ctx.drawImage(this.image, x, y, this.imageBounding.width, this.imageBounding.height);\n        }\n        ctx.restore();\n    }\n}\nexport default Icon;","import Rectangle from './shapes/rectangle';\n/**\n * @funtion domFactory\n * @param {Element} container - DOM容器\n */\n/**\n * DOM元素容器 配置\n * @typedef {Rectangle~Configs} ShadowDom~RectangleConfigs\n * @property {domFactory} createDocument - 宽\n */\n/**\n * DOM元素容器 内容可贴 DOM 元素，支持缩放平移\n * @constructor ShadowDom\n * @extends Rectangle\n * @param {ShadowDom~RectangleConfigs} configs\n */\nclass ShadowDom extends Rectangle {\n    constructor(configs) {\n        super(configs);\n        this.domFactory = configs.createDocument;\n        this._dom = null;\n    }\n\n    getRealWorldPosition() {\n        const b = this.getBoundingRect();\n        return this.calculateToRealWorld(b.slice(0, 2));\n    }\n\n    render(ctx) {\n        if(!this._dom && this.domFactory) {\n            requestAnimationFrame(() => {\n                if(!this._dom) {\n                    const container = document.createElement('div');\n                    const pos = this.getRealWorldPosition();\n                    const scale = this._jflow.scale;\n                    container.setAttribute('style', `\n                        position: absolute;\n                        width: ${this.width}px;\n                        height: ${this.height}px;\n                        transform-origin: left top;\n                        top: 0;\n                        left: 0;\n                        transform: translate(${pos[0]}px, ${pos[1]}px) scale(${scale});`);\n                    this._dom = container;\n                    this._jflow.DOMwrapper.appendChild(container);\n                    this.domFactory(container);\n                }\n            });\n        } else {\n            const pos = this.getRealWorldPosition();\n            const scale = this._jflow.scale;\n            this._dom.style.transform = `translate(${pos[0]}px, ${pos[1]}px) scale(${scale})`\n        }\n        super.render(ctx)\n    }    \n\n    onEnterViewbox() {\n        if(this._dom) {\n            this._dom.style.display = 'block';\n        }\n    }\n\n    onLeaveViewbox(){\n        if(this._dom) {\n            this._dom.style.display = 'none';\n        }\n    }\n\n    destroy() {\n        \n        if(this._dom) {\n            this._jflow.DOMwrapper.removeChild(this._dom);\n        }\n        super.destroy();\n    }\n}\nexport default ShadowDom;\n","import BaseLink from './base-link';\nimport { distToSegmentSquared,\n    isPolyLineIntersectionRectange,\n    compareBoundingbox,\n    copyBoundingbox\n} from '../utils/functions';\nimport { APPROXIMATE } from '../utils/constance';\n/**\n * @typedef {BaseLink~Configs} Link~Configs\n * @property {Number} approximate   - 点击响应范围\n * @property {Number[]} lineDash    - 虚线数组\n * @property {Boolean} doubleLink   - 双向箭头\n * @property {String} fontFamily    - 连线上的文字字体\n * @property {Number} fontSize      - 连线上的文字大小\n * @property {String} content       - 连线上的文字\n */\n/**\n * 直线\n * @constructor Link\n * @extends BaseLink\n * @param {Link~Configs} configs - 配置\n */\nclass Link extends BaseLink {\n    constructor(configs) {\n        super(configs);\n        this.fontFamily    = configs.fontFamily = '-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji'\n        this.fontSize      = configs.fontSize || '12px';\n        this.content       = configs.content || '';\n        this.lineDash      = configs.lineDash;\n        this.approximate  = configs.approximate || APPROXIMATE;\n\n        this._cacheAngle = undefined;\n        this._cachePoints = [];\n        this._cacheBoundingbox = {\n            from: [],\n            to: []\n        };\n    }\n\n    _calculateAnchorPoints() {\n        const p0 = this.from.calculateIntersection(this.to.getCenter());\n        const p1 = this.to.calculateIntersection(this.from.getCenter());\n        this._cachePoints[0] = p0;\n        this._cachePoints[1] = p1;\n        const dx = p1[0] - p0[0];\n        const dy = p1[1] - p0[1];\n        const angle = Math.atan2(dy, dx);\n        this._cacheAngle = angle;\n    }\n    \n    isInViewBox(br) {\n        const frombox = this.from.getBoundingRect();\n        const tobox = this.to.getBoundingRect();\n        const _box = this._cacheBoundingbox;\n        if(!compareBoundingbox(_box.from, frombox) || compareBoundingbox(_box.to, tobox)) {\n            copyBoundingbox(_box.from, frombox);\n            copyBoundingbox(_box.to, tobox);\n            this._calculateAnchorPoints();\n        }\n        return true;\n    }\n\n    render(ctx) {\n        const [ p0, p1 ] = this._cachePoints;\n        const angle = this._cacheAngle;\n        const dx = p1[0] - p0[0];\n        const dy = p1[1] - p0[1];\n        ctx.fillStyle = ctx.strokeStyle = this.backgroundColor;\n        ctx.beginPath();\n        if(this.content){ \n\n            ctx.textAlign = 'center';\n            ctx.font = `${this.fontSize} ${this.fontFamily}`;\n            ctx.textBaseline = 'middle';\n            const {\n                actualBoundingBoxLeft,\n                actualBoundingBoxRight,\n                fontBoundingBoxAscent,\n                fontBoundingBoxDescent\n            } = ctx.measureText(this.content);\n            const x = dx /2 + p0[0];\n            const y = dy /2 + p0[1];\n            ctx.fillText(this.content, x, y);\n            const width = Math.abs(actualBoundingBoxLeft) + Math.abs(actualBoundingBoxRight) + 20;\n            const height = (Math.abs(fontBoundingBoxAscent) + Math.abs(fontBoundingBoxDescent)) * 1.5;\n            ctx.beginPath();\n            let region = new Path2D();\n            region.rect(x - width/2 , y - height/2, width, height);\n            const rx = Math.min(p1[0], p0[0]) - 10;\n            const ry = Math.min(p1[1], p0[1]) - 10;\n            const rw = Math.abs(dx) + 20;\n            const rh = Math.abs(dy) + 20;\n            region.rect(rx , ry, rw, rh);\n            ctx.clip(region, \"evenodd\");\n        }\n\n\n        ctx.moveTo(p0[0], p0[1]);\n        ctx.lineTo(p1[0], p1[1]);\n        if(this.lineDash) {\n            ctx.save();\n            ctx.setLineDash(this.lineDash);\n        }\n        ctx.stroke();\n        if(this.lineDash) {\n            ctx.restore();\n        }\n\n        ctx.translate(p1[0], p1[1]);\n        ctx.rotate(angle);\n        ctx.moveTo(0, 0);\n        ctx.lineTo(-5, -4);\n        ctx.lineTo(-5, 4);\n        ctx.lineTo(0, 0);\n        ctx.fill();\n        ctx.rotate(-angle);\n        ctx.translate(-p1[0], -p1[1]);\n    }\n\n    isHit(point) {\n        if(!this._cachePoints) return false;\n        const [ start, end ] = this._cachePoints;\n        const dist = distToSegmentSquared(point, start, end)\n        return dist < this.approximate;\n    }\n}\n\nexport default Link;","import BaseLink from './base-link';\nimport { \n    polylinePoints, \n    distToSegmentSquared, \n    makeRadiusFromVector, \n    minIntersectionBetweenNodes,\n    isPolyLineIntersectionRectange,\n} from '../utils/functions';\nimport { APPROXIMATE, DIRECTION } from '../utils/constance';\n// import { dist2, bezierPoint } from '../utils/functions';\nconst PIINRATIO = Math.PI / 180\n/**\n * @typedef {BaseLink~Configs} PolyLink~Configs\n * @property {Number} approximate   - 点击响应范围\n * @property {Number} radius        - 拐角弧度\n * @property {Number} minSpanX      - 起点终点在 x 方向最小的跨度\n * @property {Number} minSpanY      - 起点终点在 y 方向最小的跨度\n * @property {number[]} lineDash    - 虚线数组\n * @property {Boolean} doubleLink   - 双向箭头\n * @property {String} fontFamily    - 连线上的文字字体\n * @property {Number} fontSize      - 连线上的文字大小\n * @property {String} content       - 连线上的文字\n * @property {String} isSelf        - 是否为自连接\n */\n/**\n * 方形折线\n * @constructor PolyLink\n * @extends BaseLink\n * @param {PolyLink~Configs} configs - 配置\n */\nclass PolyLink extends BaseLink {\n     /**\n     * 创建方形折线\n     * @param {PolyLink~Configs} configs - 配置\n     **/\n    constructor(configs) {\n        super(configs);\n        /** @member {Number}   - 点击响应范围 */\n        this.approximate   = configs.approximate || APPROXIMATE;\n        /** @member {Number}   - 拐角弧度 */\n        this.radius        = configs.radius || 0;\n        /** @member {Number}   - 起点终点在 x 方向最小的跨度 */\n        this.minSpanX      = configs.minSpanX || 10;\n        /** @member {Number}   - 起点终点在 y 方向最小的跨度 */\n        this.minSpanY      = configs.minSpanY || 10;\n        /** @member {Number}    - 虚线数组 */\n        this.lineDash      = configs.lineDash;\n        /** @member {Number}    - 双向箭头 */\n        this.doubleLink    = configs.doubleLink;\n        /** @member {Number}    - 连线上的文字字体 */\n        this.fontFamily    = configs.fontFamily = '-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji'\n        /** @member {Number}    - 连线上的文字大小 */\n        this.fontSize      = configs.fontSize || '12px';\n        /** @member {Number}    - 连线上的文字 */\n        this.content       = configs.content || '';\n        /** @member {Number}    - 是否为自连接 */\n        this.isSelf        = !!configs.isSelf\n\n        this.noArrow       = !!configs.noArrow \n        this._cacheAngle = [];\n        this._cachePoints = [];\n        this._cacheBoundingbox = {\n            from: [],\n            to: []\n        };\n    }\n\n    _calculateAnchorPoints() {\n        const dmsfrom = this.from.getIntersectionsInFourDimension();\n        const dmsto = this.to.getIntersectionsInFourDimension();\n        const _cacheAngle = this._cacheAngle;\n        if(this.isSelf){\n            polylinePoints(\n                this._cachePoints,\n                dmsfrom[this.fromDir],\n                dmsto[DIRECTION.SELF],\n                this.fromDir,\n                this.toDir, \n                this.minSpanX, \n                this.minSpanY,\n                true);\n            _cacheAngle[0] = this.fromDir;\n            _cacheAngle[1] = this.toDir;\n        } else if(this.fromDir !== undefined && this.toDir !== undefined) {\n            polylinePoints(\n                this._cachePoints,\n                dmsfrom[this.fromDir],\n                dmsto[this.toDir],\n                this.fromDir,\n                this.toDir, this.minSpanX , this.minSpanY);\n            _cacheAngle[0] = this.fromDir;\n            _cacheAngle[1] = this.toDir;\n        } else {\n            const meta = minIntersectionBetweenNodes(dmsfrom, dmsto);\n            polylinePoints(\n                this._cachePoints,\n                meta.fromP,\n                meta.toP,\n                meta.fromDir,\n                meta.toDir,\n                this.minSpanX , this.minSpanY);\n            _cacheAngle[0] = meta.fromDir;\n            _cacheAngle[1] = meta.toDir;\n        }\n    }\n    \n    isInViewBox(br) {\n        if(this._static) {\n            return true;\n        }\n        this._calculateAnchorPoints();     \n        return isPolyLineIntersectionRectange(this._cachePoints, br);\n    }\n\n    render(ctx) {\n        // this._calculateAnchorPoints();\n        const radius = this.radius;\n        const points = this._cachePoints;\n        const p = points[0];\n        const pEnd = points[points.length - 1];\n        const angleEnd = ((this._cacheAngle[1] + 2) % 4) * 90 * PIINRATIO;\n        ctx.fillStyle = ctx.strokeStyle = this.backgroundColor;\n        if(this.doubleLink) {\n            const beginAngle = ((this._cacheAngle[0] + 2) % 4) * 90 * PIINRATIO;\n            ctx.beginPath();\n            ctx.translate(p[0], p[1]);\n            ctx.rotate(beginAngle);\n            ctx.moveTo(5, 0);\n            ctx.lineTo(0, -4);\n            ctx.lineTo(0, 4);\n            ctx.lineTo(5, 0);\n            ctx.fill();\n            ctx.rotate(-beginAngle);\n            ctx.translate(-p[0], -p[1]);\n        }\n        ctx.beginPath();\n        ctx.moveTo(p[0], p[1]);\n        points.slice(1, points.length - 1).forEach((p, idx) => {\n            if(this.radius) {\n                const pLast = points[idx];\n                const pNext = points[idx+2];\n                const { p1, p2 } = makeRadiusFromVector(pLast, p, pNext, radius);\n                if(p1 && p2){\n                    ctx.lineTo(p1[0], p1[1]);\n                    ctx.quadraticCurveTo(p[0], p[1], p2[0], p2[1]);\n                } else {\n                    ctx.lineTo(p[0], p[1]);\n                }  \n            } else {\n                ctx.lineTo(p[0], p[1]);\n            }\n        });\n        ctx.lineTo(pEnd[0], pEnd[1]);\n\n        if(this.lineDash) {\n            ctx.save();\n            ctx.setLineDash(this.lineDash);\n        }\n        ctx.stroke();\n        if(this.lineDash) {\n            ctx.restore();\n        }\n\n        if(!this.noArrow) {\n            ctx.beginPath();\n            ctx.translate(pEnd[0], pEnd[1]);\n            ctx.rotate(angleEnd);\n            ctx.moveTo(0, 0);\n            ctx.lineTo(-5, -4);\n            ctx.lineTo(-5, 4);\n            ctx.lineTo(0, 0);\n            ctx.fill();\n            ctx.rotate(-angleEnd);\n            ctx.translate(-pEnd[0], -pEnd[1]);\n        }\n        if(this.content) {\n            ctx.beginPath();\n            ctx.font = `${this.fontSize} ${this.fontFamily}`;\n            switch (this.fromDir) {\n                case DIRECTION.BOTTOM:\n                    ctx.textAlign = 'left';\n                    ctx.fillText(this.content, p[0] + 2, p[1] + 10);\n                    break;\n                case DIRECTION.RIGHT:\n                    ctx.textAlign = 'left';\n                    ctx.fillText(this.content, p[0] + 10, p[1] - 2);\n                    break;\n                default:\n                    break;\n            }\n        }\n\n    }\n\n    isHit(point) {\n        if(this._static) {\n            return false;\n        }\n        if(!this._cachePoints) {\n            return false;\n        }\n        const points = this._cachePoints;\n        let lastP = points[0];\n        const remainPoints = points.slice(1)\n        do {\n            const currentP = remainPoints.shift();\n            if(currentP) {\n                const dist = distToSegmentSquared(point, lastP, currentP);\n                if(dist < this.approximate){\n                    return true;\n                }\n            }\n            lastP = currentP;\n        } while(lastP)\n\n        return false\n    }\n\n    cloneStatic() {\n        const t = new PolyLink({});\n        Object.assign(t, {\n            radius: this.radius,\n            _cachePoints: this._cachePoints,\n            _cacheAngle: this._cacheAngle,\n            backgroundColor: this.backgroundColor,\n            doubleLink: this.doubleLink,\n            radius: this.radius,\n            lineDash: this.lineDash,\n            noArrow: this.noArrow,\n            content: this.content,\n            fontSize: this.fontSize,\n            fontFamily: this.fontFamily,\n            fromDir: this.fromDir,\n            _static: true,\n        });\n        return t;\n    }\n}\n\nexport default PolyLink;","import BaseLink from './base-link';\nimport { bezierPoints, distToBezierSegmentSquared, getBezierAngle, minIntersectionBetweenNodes } from '../utils/functions';\nimport { APPROXIMATE, DIRECTION } from '../utils/constance';\nimport { dist2, bezierPoint } from '../utils/functions';\nconst PIINRATIO = Math.PI / 180\n/**\n * @typedef {BaseLink~Configs} BezierLink~Configs\n * @property {Number} approximate   - 点击响应范围\n * @property {Number} minSpanX      - 起点终点在 x 方向最小的跨度\n * @property {Number} minSpanY      - 起点终点在 y 方向最小的跨度\n * @property {Number[]} lineDash    - 虚线数组\n * @property {Boolean} doubleLink   - 双向箭头\n * @property {String} fontFamily    - 连线上的文字字体\n * @property {Number} fontSize      - 连线上的文字大小\n * @property {String} content       - 连线上的文字\n * @property {Boolean} isSelf        - 是否为自连接\n */\n/**\n * 贝塞尔曲线\n * @constructor BezierLink\n * @extends BaseLink\n * @param {BezierLink~Configs} configs - 配置\n */\nclass BezierLink extends BaseLink {\n     /**\n     * 创建贝塞尔曲线.\n     * @param {BezierLink~Configs} configs - 配置\n     **/\n    constructor(configs) {\n        super(configs);\n        /** @member {Number}      - 点击响应范围 */\n        this.approximate   = configs.approximate || APPROXIMATE;\n        /** @member {Number}      - 起点终点在 x 方向最小的跨度 */\n        this.minSpanX      = configs.minSpanX || 0;\n        /** @member {Number}      - 起点终点在 y 方向最小的跨度 */\n        this.minSpanY      = configs.minSpanY || 0;\n        /** @member {Number[]}      - 虚线数组 */\n        this.lineDash      = configs.lineDash;\n        /** @member {Boolean}      - 双向箭头 */\n        this.doubleLink    = configs.doubleLink;\n        /** @member {String}      - 连线上的文字字体 */\n        this.fontFamily    = configs.fontFamily = '-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji'\n        /** @member {Number}      - 连线上的文字大小 */\n        this.fontSize      = configs.fontSize || '12px';\n        /** @member {String}      - 连线上的文字 */\n        this.content       = configs.content || '';\n        /** @member {Boolean}      - 是否为自连接 */\n        this.isSelf        = !!configs.isSelf\n    }\n    \n    // getColor() {\n    //     if(this._isTargeting) {\n    //         return this.hoverStyle;\n    //     }\n    //     return this.defaultStyle;\n    // }\n    \n    // _calculateAnchorPoints() {\n    //     let start;\n    //     let end;\n    //     if(this.fromDir !== undefined) {\n    //         start = {\n    //             dir: this.fromDir,\n    //             p: this.from.getIntersectionsInFourDimension()[this.fromDir],\n    //         }\n    //     } else {\n    //         start = this.from.calculateIntersectionInFourDimension(this.to.getCenter(), 'from');\n    //     }\n    //     if(this.toDir !== undefined) {\n    //         end = {\n    //             dir: this.toDir,\n    //             p: this.to.getIntersectionsInFourDimension()[this.toDir],\n    //         }\n    //     } else {\n    //         end = this.to.calculateIntersectionInFourDimension(this.from.getCenter(), 'to');\n    //     }\n        \n        \n    //     // const start = this.from.calculateIntersectionInFourDimension(this.to.getCenter(), 'from');\n    //     // const end = this.to.calculateIntersectionInFourDimension(this.from.getCenter(), 'to');\n    //     const p1 = start.p;\n    //     const p2 = end.p;\n    //     const points = bezierPoints(p1, p2, start.dir, end.dir, this.anticlock);\n\n    //     this._cachePoints = [...p1, ...points]\n    // }\n\n    _calculateAnchorPoints() {\n        const dmsfrom = this.from.getIntersectionsInFourDimension();\n        const dmsto = this.to.getIntersectionsInFourDimension();\n        if(this.isSelf) {\n            const points = bezierPoints(\n                dmsfrom[this.fromDir],\n                dmsto[DIRECTION.SELF],\n                this.fromDir,\n                DIRECTION.BOTTOM, \n                this.minSpanX, \n                this.minSpanY);\n\n            this._cachePoints = [...dmsfrom[this.fromDir], ...points] \n            this._cacheAngle = [this.fromDir, DIRECTION.BOTTOM]\n        } else if(this.fromDir !== undefined && this.toDir !== undefined) {\n            const points = bezierPoints(\n                dmsfrom[this.fromDir],\n                dmsto[this.toDir],\n                this.fromDir,\n                this.toDir, this.minSpanX , this.minSpanY);\n            this._cachePoints = [...dmsfrom[this.fromDir], ...points] \n            this._cacheAngle = [this.fromDir, this.toDir]\n        } else {\n            const meta = minIntersectionBetweenNodes(dmsfrom, dmsto);\n            const points = bezierPoints(\n                meta.fromP,\n                meta.toP,\n                meta.fromDir,\n                meta.toDir);\n\n            this._cachePoints = [...meta.fromP, ...points];\n            this._cacheAngle = [meta.fromDir, meta.toDir];\n        }\n    }\n\n    render(ctx) {\n        this._calculateAnchorPoints();\n        const points = this._cachePoints;\n        const angle = getBezierAngle.apply(null, [1, ...points])\n        ctx.fillStyle = ctx.strokeStyle = this.backgroundColor;\n        if(this.doubleLink) {\n            const beginAngle = ((this._cacheAngle[0] + 2) % 4) * 90 * PIINRATIO;\n            ctx.beginPath();\n            ctx.translate(points[0], points[1]);\n            ctx.rotate(beginAngle);\n            ctx.moveTo(5, 0);\n            ctx.lineTo(0, -4);\n            ctx.lineTo(0, 4);\n            ctx.lineTo(5, 0);\n            ctx.fill();\n            ctx.rotate(-beginAngle);\n            ctx.translate(-points[0], -points[1]);\n        }\n        ctx.beginPath();\n        ctx.moveTo(points[0], points[1])\n        ctx.bezierCurveTo(...points.slice(2));\n        if(this.lineDash) {\n            ctx.save();\n            ctx.setLineDash(this.lineDash);\n        }\n        ctx.stroke();\n        if(this.lineDash) {\n            ctx.restore();\n        }\n        ctx.beginPath();\n        ctx.translate(points[6], points[7]);\n        ctx.rotate(angle);\n        ctx.moveTo(5, 0);\n        ctx.lineTo(0, -4);\n        ctx.lineTo(0, 4);\n        ctx.lineTo(5, 0);\n        ctx.fill();\n        ctx.rotate(-angle);\n        ctx.translate(-points[6], -points[7]);\n        if(this.content) {\n            ctx.beginPath();\n            const hasFlip = points[0] > points[6];\n            let [x, y, angle] = bezierPoint(0.5, points);\n            ctx.translate(x, y);\n            ctx.rotate(angle);\n            if(hasFlip){\n                ctx.rotate(Math.PI);\n            }\n            ctx.font = `${this.fontSize} ${this.fontFamily}`;\n            ctx.textAlign = 'center';\n            ctx.fillText(this.content, 0, -(parseInt(this.fontSize) || 12)/4);\n            if(hasFlip){\n                ctx.rotate(Math.PI);\n            }\n            ctx.rotate(-angle);\n            ctx.translate(-x, -y);\n        }\n    }\n\n    isHit(point) {\n        if(!this._cachePoints) return false;\n        const points = this._cachePoints;\n        const dist = distToBezierSegmentSquared(point, points)\n        return dist < this.approximate;\n    }\n}\n\nexport default BezierLink;","/**\n * 线性布局配置\n * @typedef {Object} LinearLayout~Configs\n * @property {string} direction     - 排列方向 默认 vertical\n * @property {number} gap           - 边距, 默认是 5\n * @property {string} alignment     - 垂直排列方向对齐方式 默认 center\n * @property {string} justify       - 排列方向对齐方式 默认 center\n */\n/**\n    线性布局\n\n    排列方向\n    direction:\n        + vertical 从上至下排布\n        + horizontal 从左至右排布\n    \n    不重叠，中线对齐\n    只针对当前的 group\n\n    对齐方式\n    alignment: \n        + start 主轴左侧对齐\n        + center 主轴对齐\n        + end   主轴右侧对齐\n    justify: \n        + start 开始时对齐\n        + center 居中对齐\n        + end   末尾对齐\n        + space-between 平均分配空间对齐\n\n * @constructor LinearLayout\n * @implements {Layout}\n * @param {LinearLayout~Configs} configs - 配置\n */\n\nclass LinearLayout {\n    constructor(configs = {}) {\n        /** @member {string}  - 排列方向 默认 vertical */\n        this.direction =     configs.direction || 'vertical';\n        /** @member {number}  - 边距, 默认是 5 */\n        this.gap =           configs.gap ?? 5;\n        /** @member {string}  - 垂直排列方向对齐方式 默认 center */\n        this.alignment =     configs.alignment || 'center';\n        /** @member {string}  - 排列方向对齐方式 默认 center */\n        this.justify =       configs.justify || 'center';\n        // this.widthSetByParent =  configs.width === '100%'\n        this._rawConfigs = configs;\n    }\n\n\n    reflow(group) {\n        const stack = group._stack.filter(instance => instance.visible && !instance.absolutePosition);\n        const absoluteStack = group._stack.filter(instance => instance.visible && instance.absolutePosition)\n        const groupWidth = group.width - group.padding.left - group.padding.right;\n        if(this.direction === 'vertical') {\n            let reduceHeight = 0;\n            let lastInstanceHeight = 0;\n            let maxWidth = 0;\n            let allHeight = 0;\n            const childAll = stack.concat(absoluteStack);\n            childAll.forEach((instance, idx) =>  {\n                if(instance.display === 'block') {\n                    instance.width = 0;\n                    // instance.definedWidth = maxWidth;\n                    instance.resetChildrenPosition();\n                    instance.reflow();\n                    instance._getBoundingGroupRect();\n                }\n            });\n\n            stack.forEach((instance, idx) =>  {\n                \n                const { width, height } = instance.getBoundingDimension();\n                // console.log(height, instance.type);\n                const gap = (idx > 0 ? this.gap : 0);\n                if(instance.display !== 'outstretch') {\n                    maxWidth = Math.max(width, maxWidth);\n                }\n                allHeight += (height + gap);\n                reduceHeight += (height/2 + gap + lastInstanceHeight)\n                lastInstanceHeight = height / 2;\n                instance.anchor = [0, reduceHeight];\n            });\n            childAll.forEach((instance, idx) =>  {\n                if(instance.display === 'block') {\n                    // instance.definedWidth = maxWidth;\n                    instance.resetChildrenPosition();\n                    instance.width = maxWidth;\n                    instance.reflow();\n                    // instance._getBoundingGroupRect();\n                } else if(instance.display === 'outstretch') {\n                    const w = group._belongs.width - group._belongs.padding.left - group._belongs.padding.right;\n                    instance.resetChildrenPosition();\n                    instance.width = Math.max(w, maxWidth);\n                    instance.reflow();\n                }\n            });\n\n            maxWidth = Math.max(groupWidth, maxWidth);\n            \n            allHeight = allHeight/2;\n            if(this.alignment === 'start') {\n                stack.forEach((instance, idx) =>  {\n                    const { width } = instance.getBoundingDimension();\n                    instance.anchor[0] = -(maxWidth - width) / 2;\n                    instance.anchor[1] -= allHeight;\n                    // console.log(maxWidth, width, instance.anchor[0])\n                })\n            }\n            if(this.alignment === 'end') {\n                stack.forEach((instance, idx) =>  {\n                    const { width } = instance.getBoundingDimension();\n                    instance.anchor[0] = (maxWidth - width) / 2;\n                    instance.anchor[1] -= allHeight;\n                })\n            }\n            if(this.alignment === 'center') {\n                stack.forEach((instance, idx) =>  {\n                    const { width } = instance.getBoundingDimension();\n                    instance.anchor[1] -= allHeight;\n                })\n            }\n        } \n        if(this.direction === 'horizontal') {\n            let reduceWidth = 0;\n            let lastInstanceWidth = 0;\n            let maxHeight = 0;\n            let allWidth = 0;\n            let allPureWidth = 0;\n            \n            stack.forEach((instance, idx) =>  {\n                const { width, height } = instance.getBoundingDimension();\n                const gap = (idx > 0 ? this.gap : 0);\n                maxHeight = Math.max(height, maxHeight);\n                allWidth += (width+gap);\n                allPureWidth += width;\n                reduceWidth += (width/2 + gap + lastInstanceWidth)\n                lastInstanceWidth = width / 2;\n                instance.anchor = [reduceWidth, 0]\n            });\n            if(this.justify === 'start') {\n                const withdraw = groupWidth/2;\n                stack.forEach((instance, idx) => {\n                    instance.anchor[0] -= withdraw;\n                });  \n            }\n            if(this.justify === 'end') {\n                const withdraw = groupWidth/2 - allWidth;\n                stack.forEach((instance, idx) => {\n                    instance.anchor[0] += withdraw;\n                });  \n            }\n            if(this.justify === 'center') { \n                const withdraw = allWidth / 2;\n                stack.forEach((instance, idx) => {\n                    instance.anchor[0] -= withdraw;\n                })                \n            }\n            if(this.justify === 'space-between' && stack.length > 1) {\n                \n                const width = Math.max(groupWidth, allWidth);\n                const gapAverage = (width - allWidth) / (stack.length - 1);\n                const withdraw = width/2;\n                stack.forEach((instance, idx) => {\n                    instance.anchor[0] += ((gapAverage * idx) - withdraw);\n                });  \n            }\n            if(this.alignment === 'start') {\n                stack.forEach((instance, idx) => {\n                    const { height } = instance.getBoundingDimension();\n                    instance.anchor[1] = -(maxHeight - height) / 2;\n                })\n            }\n            if(this.alignment === 'end') {\n                stack.forEach((instance, idx) => {\n                    const { height } = instance.getBoundingDimension();\n                    instance.anchor[1] = (maxHeight - height) / 2;\n                })\n            }\n        }\n\n        if(absoluteStack.length) {\n            if(group.display === 'block') {\n                group.getBoundingDimension();\n            } else {\n                group._getBoundingGroupRect();\n            }\n            const WIDTH = group.width /2;\n            const HEIGHT = group.height /2;\n            const shifty = (group.padding.top - group.padding.bottom)/2;\n            const shiftx = (group.padding.left - group.padding.right)/2;\n            absoluteStack.forEach(instance => {\n                instance.anchor = this._resolveAbsoluteAnchor(instance.absolutePosition, instance, WIDTH, HEIGHT, shiftx, shifty);\n            })\n        }\n    }\n\n    _resolveAbsoluteAnchor(config, instance, w, h, shiftx, shifty){\n        const { top, right, bottom, left, centerX, centerY } = config;\n        const { width, height } = instance.getBoundingDimension();\n        const hw = width / 2;\n        const hh = height / 2;\n        let y = 0;\n        let x = 0;\n        if(typeof top === 'number') {\n            y = top + hh - h - shifty;\n        }\n        if(typeof right === 'number') {\n            x = w - right - hw - shiftx;\n        }\n        if(typeof bottom === 'number') {\n            y = h - bottom - hh - shifty;\n        }\n        if(typeof left === 'number') {\n            x = left + hw - w - shiftx;\n        }\n        if(typeof centerX === 'number') {\n            x = centerX;\n        }\n        if(typeof centerY === 'number') {\n            y = centerY;\n        }\n        return [x, y]\n    }\n\n    clone() {\n        return new LinearLayout(this._rawConfigs);\n    }\n}\n\nexport default LinearLayout;","\n// import EventEmitter from '../../utils/EventEmitter';\nimport { DIRECTION } from '../../utils/constance';\nclass BaseNode {\n    constructor(source) {\n        this.source = source;\n        this.id = source.id;\n        this.type = source.type;\n        // this.isDraggable = true;\n        // this.getJflowInstance = undefined;\n        this.level = undefined;\n        this.sequence = undefined;\n        // this.isLocked = false;\n        this.isFree = false;\n        this.parent = undefined;\n        this.idx = undefined;\n        this.parentIterateType = undefined;\n        \n        this.hasEndPoint = false;\n        // source._getAstNode = () => this;\n    }\n\n    reflowPreCalculate(level = 0, sequence = 0, callback) {\n        this.level = level;\n        this.sequence = sequence;\n        this.spanX = 1;\n        this.spanY = 1;\n        if(callback) {\n            callback(level, sequence, this);\n        }\n        return {\n            spanX: this.spanX, \n            spanY: this.spanY, \n            level, sequence,\n        }\n    }\n\n    makeLink(callback) {\n        return this;\n    }\n\n    makeEndpoint() { }\n\n    traverse(callback) {\n        callback(this);\n    }\n\n    getNodes(jflow) {\n        const nodes = [];\n        this.traverse(n => {\n            const renderNode = jflow.getRenderNodeBySource(n.source);\n            if(renderNode)\n                nodes.push(renderNode);\n        })\n        return nodes;\n    }\n\n    linkSource(source) {\n        this.parent.source[this.parentIterateType].splice(this.idx + 1, 0, source);\n    }\n\n    remove() {\n        this.parent.source[this.parentIterateType].splice(this.idx, 1);\n    }\n}\n\nclass Root extends BaseNode {\n    constructor(source) {\n        super(source);\n        this.isroot = true;\n        this.body = (source.body || []).map(mapFunc('body').bind(this));\n        const playgrounditerator = mapFunc('playground').bind(this)\n        this.playground = (source.playground || []).map((s, idx) => {\n            const n = playgrounditerator(s, idx);\n            n.isFree = true;\n            return n;\n        });\n    }\n\n    reflowBodyPreCalculate(level = 0, sequence = 0, callback) {\n        let spanX = 1;\n        let spanY = 1;\n        this.level = level;\n        this.sequence = sequence;\n        if(callback) {\n            callback(level, sequence, this);\n        }\n        this.body.forEach((b) => {\n            const { spanX: sx, spanY: sy } = b.reflowPreCalculate(level + 1, sequence, callback);\n            spanX = Math.max(sx, spanX);\n            spanY += sy;\n            level += sy;\n        });\n\n        this.spanX = spanX;\n        this.spanY = spanY;\n        return {\n            spanX, spanY, level, sequence\n        }\n    }\n\n    reflowPlaygroundPreCalculate(preCallback, callback) {\n        this.playground.forEach(node => {\n            preCallback(node)\n            node.reflowPreCalculate(0, 0, callback)\n        })\n    }\n\n\n    makeLink(callback) {\n        let last;\n        this.body.forEach(b => {\n            if(!last) {\n                last = b;\n                return;\n            }\n            callback({\n                from: last,\n                to: b,\n                part: 'body',\n                fromDir: DIRECTION.BOTTOM,\n                toDir: DIRECTION.TOP,\n            })\n            \n            b = b.makeLink(callback);\n            last = b;\n        });\n\n        this.playground.forEach(n => {\n            n.makeLink(callback);\n        });\n        return this;\n    }\n\n    traverse(callback) {\n        this.body.forEach(n => {\n            n.traverse(callback);\n        });\n\n        this.playground.forEach(n => {\n            n.traverse(callback);\n        })\n    }\n}\n\nclass IfStatement extends BaseNode {\n    constructor(source) {\n        super(source);\n        this.consequent = (source.consequent || []).map(mapFunc('consequent').bind(this));\n        this.alternate = (source.alternate || []).map(mapFunc('alternate').bind(this));\n        this.isLocked = true;\n        this.hasEndPoint = true;\n    }\n    \n    reflowPreCalculate(level = 0, sequence = 0, callback) {\n        let spanX = 1;\n        let spanY = 1;\n        this.level = level;\n        this.sequence = sequence;\n        if(callback) {\n            callback(level, sequence, this);\n        }\n        let c_spanX = 1;\n        let c_spanY = 0;\n        let a_spanX = 0;\n        let a_spanY = 0;\n        this.consequent.forEach((c, idx) => {   \n            const { spanX: sx, spanY: sy } = c.reflowPreCalculate(level + 1, sequence, callback);\n            c_spanX = Math.max(c_spanX, sx);\n            c_spanY += sy;\n            level += sy;\n        });\n        const nextSequeence = sequence + c_spanX;\n        level = this.level;\n        this.alternate.forEach((a, idx) => {\n            const { spanX: sx, spanY: sy } = a.reflowPreCalculate(level + 1, nextSequeence, callback);\n            a_spanX = Math.max(a_spanX, sx);\n            a_spanY += sy;\n            level += sy;\n        });\n        spanX = Math.max(1, c_spanX + a_spanX);\n        spanY += Math.max(c_spanY, a_spanY);\n        level = this.level + spanY - 1;\n        const { spanY: sy } = this.Endpoint.reflowPreCalculate(level + 1, sequence, callback);\n        spanY += sy;\n        this.spanX = spanX;\n        this.spanY = spanY;\n        return {\n            spanX, spanY, level, sequence\n        }\n    }\n\n    makeLink(callback) {\n        let lastc = this;\n        this.consequent.forEach(c => {\n            callback({\n                from: lastc,\n                to: c,\n                part: 'consequent',\n                fromDir: DIRECTION.BOTTOM,\n                toDir: DIRECTION.TOP,\n            });\n\n            c = c.makeLink(callback)\n            lastc = c;\n        })\n\n        callback({\n            from: lastc,\n            to: this.Endpoint,\n            fromDir: DIRECTION.BOTTOM,\n            toDir: DIRECTION.TOP,\n            part: 'consequent',\n        });\n\n        let lasta = this;\n        this.alternate.forEach(a => {\n            callback({\n                from: lasta,\n                to: a,\n                fromDir: lasta === this ? DIRECTION.RIGHT : DIRECTION.BOTTOM,\n                toDir: DIRECTION.TOP,\n                part: 'alternate',\n            })\n            a = a.makeLink(callback)\n            lasta = a;\n        });\n        callback({\n            from: lasta,\n            to: this.Endpoint,\n            fromDir: lasta === this ? DIRECTION.RIGHT : DIRECTION.BOTTOM,\n            toDir: DIRECTION.RIGHT,\n            part: 'alternate',\n        });\n\n        return this.Endpoint;\n    }\n\n    // makeEndpoint() {\n    //     const fakeSource = {\n    //         type: 'endpoint',\n    //         id: `${this.id}-endpoint`,\n    //     };\n    //     this.Endpoint = makeAST(fakeSource);\n    //     this.Endpoint.parent = this.parent;\n    //     this.Endpoint.idx = this.idx;\n    //     this.Endpoint.parentIterateType = this.parentIterateType;\n    //     return fakeSource;     \n    // }\n\n    traverse(callback) {\n        callback(this);\n        this.consequent.forEach(n => {\n            n.traverse(callback);\n        });\n        this.alternate.forEach(n => {\n            n.traverse(callback);\n        });\n        console.log(this.Endpoint)\n        callback(this.Endpoint);\n    }\n\n    linkSource(source, linkMeta) {\n        this.source[linkMeta.part].unshift(source);\n    }\n}\n\nclass SwitchStatement extends BaseNode {\n    constructor(source) {\n        super(source);\n        this.cases = (source.cases || []).map(mapFunc('case').bind(this))\n        if(this.cases.length) {\n            this.cases[this.cases.length - 1].lastCase = true;\n        }\n        this.isLocked = true;\n        this.hasEndPoint = true;\n    }\n\n    reflowPreCalculate(level = 0, sequence = 0, callback) {\n        let spanX = 1;\n        let spanY = 1;\n        this.level = level;\n        this.sequence = sequence;\n        if(callback) {\n            callback(level, sequence, this);\n        }\n\n        let c_spanX = 1;\n        let c_spanY = 0;\n        if(this.cases.length) {\n            const consequent = this.cases[this.cases.length - 1].consequent;\n            level = this.level;\n            consequent.forEach(cc => {\n                const { spanX: sx, spanY: sy } = cc.reflowPreCalculate(level + 1, sequence, callback);\n                c_spanX = Math.max(c_spanX, sx);\n                c_spanY += sy;\n                level += sy;\n            });\n        }\n        \n        \n        let s_spanX = c_spanX;\n        let s_spanY = 0;\n        this.cases.forEach((c, idx) => {\n            const nextSequeence = sequence + s_spanX;\n            let a_spanX = 0;\n            let a_spanY = 0;\n            level = this.level;\n            c.alternate.forEach(ca => {\n                const { spanX: sx, spanY: sy } = ca.reflowPreCalculate(level + 1, nextSequeence, callback);\n                a_spanX = Math.max(a_spanX, sx);\n                a_spanY += sy;\n                level += sy;\n            });\n            s_spanX += a_spanX;\n            s_spanY = Math.max(s_spanY, a_spanY);\n        });\n       \n        \n        spanX = Math.max(1, s_spanX);\n        spanY = Math.max(c_spanY, s_spanY);\n        level = this.level + spanY;\n        const { spanY: sy } = this.Endpoint.reflowPreCalculate(level + 1, sequence, callback);\n        spanY += sy;\n        spanY += 1 // 要算上自己\n        this.spanX = spanX;\n        this.spanY = spanY;\n        return {\n            spanX, spanY, level, sequence\n        }       \n    }\n\n    makeLink(callback) {\n        let lastc = this;\n        if(this.cases.length) {\n            const consequent = this.cases[this.cases.length - 1].consequent;\n            consequent.forEach((c, idx) => {\n                callback({\n                    from: lastc,\n                    to: c,\n                    fromDir: DIRECTION.BOTTOM,\n                    toDir: DIRECTION.TOP,\n                    part: 'consequent',\n                });\n                lastc = c.makeLink(callback)\n            });\n        }\n        console.log(lastc)\n        callback({\n            from: lastc,\n            to: this.Endpoint,\n            fromDir: DIRECTION.BOTTOM,\n            toDir: DIRECTION.TOP,\n            part: 'consequent',\n        });\n\n        this.cases.forEach((c, idx) => {\n            let lasta = c;\n            c.alternate.forEach(a => {\n                callback({\n                    from: lasta,\n                    to: a,\n                    fromDir: lasta === c ? DIRECTION.RIGHT : DIRECTION.BOTTOM,\n                    toDir: DIRECTION.TOP,\n                    part: 'alternate',\n                });\n                lasta = a.makeLink(callback)\n            })\n            \n            callback({\n                from: lasta,\n                to: this.Endpoint,\n                fromDir: lasta === c ? DIRECTION.RIGHT : DIRECTION.BOTTOM,\n                toDir: DIRECTION.RIGHT,\n                part: 'alternate',\n                minSpanX: 32 * (idx + 1),\n            });\n        });\n\n        return this.Endpoint;\n    }\n\n    // makeEndpoint() {\n    //     this.Endpoint = makeAST({\n    //         type: 'endpoint',\n    //         id: `${this.id}-endpoint`,\n    //     });\n    //     this.Endpoint.parent = this.parent;\n    //     this.Endpoint.parentIterateType = this.parentIterateType;     \n    //     this.Endpoint.idx = this.idx;\n    // }\n\n    traverse(callback) {\n        callback(this);\n        this.cases.forEach(n => {\n            n.traverse(callback);\n        });\n        callback(this.Endpoint);\n    }\n\n    getNodes(jflow) {\n        const nodes = [];\n        this.traverse(n => {\n            if(n.type === 'SwitchCase') return\n            const renderNode = jflow.getRenderNodeBySource(n.source);\n            if(renderNode)\n                nodes.push(renderNode);\n        })\n        return nodes;\n    }\n\n    linkSource(source, linkMeta) {\n        const cases = this.source.cases;\n        const consequent = cases[cases.length - 1].consequent;\n        consequent.unshift(source);\n    }\n}\n\nclass ForEachStatement extends BaseNode {\n    \n}\n\nclass WhileStatement extends BaseNode {\n    constructor(source) {\n        super(source);\n        this.body = (source.body || []).map(mapFunc('body').bind(this));\n        this.isLocked = true\n    }\n\n    reflowPreCalculate(level = 0, sequence = 0, callback) {\n        let spanX = 1;\n        let spanY = 1;\n        this.level = level;\n        this.sequence = sequence;\n        if(callback) {\n            callback(level, sequence, this);\n        }\n        const nextSequeence = sequence + 1;\n        // level--;\n        this.body.forEach((b) => {\n            const { spanX: sx, spanY: sy } = b.reflowPreCalculate(level + 1, nextSequeence, callback);\n            spanX = Math.max(sx, spanX);\n            spanY += sy;\n            level += sy;\n        });\n\n        this.spanX = spanX + 1;\n        this.spanY = spanY;\n        return {\n            spanX, spanY, level, sequence\n        }\n    }\n\n    makeLink(callback) {\n        let last = this;\n        // const lastIdx = this.body.length - 1;\n        this.body.forEach((b, idx) => {\n            callback({\n                from: last,\n                to: b,\n                part: 'body',\n                fromDir: last === this ? DIRECTION.RIGHT: DIRECTION.BOTTOM,\n                toDir: DIRECTION.TOP,\n            })\n            \n            b = b.makeLink(callback);\n            last = b;\n        });\n        callback({\n            from: last,\n            to: this,\n            part: 'body',\n            fromDir: last === this ? DIRECTION.RIGHT : DIRECTION.BOTTOM,\n            anticlock: last === this,\n            toDir: DIRECTION.BOTTOM,\n            isSelf: true,\n            minSpanX: 20,\n            minSpanY: 20,\n        });\n        return this;\n    }\n\n    traverse(callback) {\n        callback(this);\n        this.body.forEach(n => {\n            n.traverse(callback);\n        });\n    }\n\n    linkSource(source, linkMeta) {\n        this.source[linkMeta.part].unshift(source);\n    }\n}\n\nclass SwitchCase extends BaseNode {\n    constructor(source) {\n        super(source);\n        this.consequent = (source.consequent || []).map(mapFunc('consequent').bind(this));\n        this.alternate = (source.alternate || []).map(mapFunc('alternate').bind(this));\n        this.lastCase = false;\n    }\n\n    reflowPreCalculate(level = 0, sequence = 0, callback) {\n        let spanX = 1;\n        let spanY = 1;\n        this.level = level;\n        this.sequence = sequence;\n        if(callback) {\n            callback(level, sequence, this);\n        }\n        \n        let c_spanX = 0;\n        let c_spanY = 0;\n        let a_spanX = 0;\n        let a_spanY = 0;\n        if(this.lastCase) {\n            this.consequent.forEach((c, idx) => {\n                const { spanX: sx, spanY: sy } = c.reflowPreCalculate(level + 1, sequence, callback);\n                c_spanX = Math.max(c_spanX, sx);\n                c_spanY += sy;\n                level += sy;\n            });\n        }\n        \n        const nextSequeence = sequence + Math.max(c_spanX, 1);\n        level = this.level;\n        this.alternate.forEach((a, idx) => {\n            const { spanX: sx, spanY: sy } = a.reflowPreCalculate(level + 1, nextSequeence, callback);\n            a_spanX = Math.max(a_spanX, sx);\n            a_spanY += sy;\n            level += sy;\n        });\n        spanX = Math.max(1, c_spanX + a_spanX);\n        spanY += Math.max(c_spanY, a_spanY);\n\n        this.spanX = spanX;\n        this.spanY = spanY;\n        return {\n            spanX, spanY, level, sequence\n        }       \n    }\n\n    traverse(callback) {\n        callback(this);\n        this.consequent.forEach(n => {\n            n.traverse(callback);\n        });\n        this.alternate.forEach(n => {\n            n.traverse(callback);\n        });\n    }\n\n    linkSource(source, linkMeta) {\n        this.source[linkMeta.part].unshift(source);\n    }\n\n    // makeLink()\n}\n \nconst TYPE_MAPPING = {\n    IfStatement,\n    SwitchStatement,\n    SwitchCase,\n    ForEachStatement,\n    WhileStatement,\n    Root,\n    other: BaseNode,\n}\n\nfunction mapFunc(type)  {\n    return function(n, idx) {\n        const p = makeAST(n);\n        p.parent = this;\n        p.idx = idx;\n        p.parentIterateType = type;\n\n        // 重要！！！ weakMap 功能需要 endPoint source 保持一致\n        if(p.hasEndPoint) {\n            if(!n.__endpoint__) {\n                n.__endpoint__ = {\n                    type: 'endpoint',\n                    id: `${p.id}-endpoint`,\n                };\n            }\n            const e = makeAST(n.__endpoint__);\n            e.parent = this;\n            e.idx = idx;\n            e.parentIterateType = type;\n            p.Endpoint = e;\n        }\n        return p;\n    }\n}\nfunction makeAST(source) {\n    const type = source.type;\n    const Constructor = TYPE_MAPPING[type] || TYPE_MAPPING.other;\n    const node = new Constructor(source);\n    return node;\n}\nexport { \n    makeAST,\n}\n\n","import JFlowEvent from '../events'; \nimport { DIRECTION } from '../utils/constance';\nimport { makeAST } from './low-code-types/baseNode';\n\nfunction sqr(x) {\n    return x * x;\n}\nfunction dist2(v, w) {\n    return sqr(v[0] - w[0]) + sqr(v[1] - w[1]);\n}\n\n/**\n * @typedef {Object} LowcodeLayout~Configs\n * @property {number} linkLength - 最小连线长度\n * @property {number} gap       - 列间隙\n * @property {boolean} treeItemDraggable - 树上的是否可以拖动\n * @property {Object} ast       - 语法树\n */\n\n/**\n    lowcode layout\n\n    type: \n        + IfStatement,\n        + SwitchStatement,\n        + SwitchCase,\n        + ForEachStatement,\n        + WhileStatement,\n        + Root,\n        + other,\n    \n    * @implements {Layout}\n    * @param {LowcodeLayout~Configs} - 配置\n    \n */\nclass LowcodeLayout {\n    constructor(configs) {\n        /** @member {number}      - 最小连线长度 */\n        this.linkLength = configs.linkLength || 18;\n        /** @member {number}      - 列间隙 */\n        this.gap = configs.gap || 30;\n        /** @member {boolean}      - 树上的是否可以拖动 */\n        this.treeItemDraggable = configs.treeItemDraggable ?? true;\n        this.reOrder(configs.ast);\n        /** @member {boolean}      - true 需要检查元素拖动 */\n        this.static = true;\n    }\n    /**\n     * 从 ast 计算布局\n     * @param {AstNode} ast - ASL 树\n     */\n    reOrder(ast) {\n        this.ast = ast;\n        this.flowStack = [];\n        this.flowLinkStack = [];\n\n        this.root = makeAST(this.ast)// new AstNode(this.ast, this.flowStack, true);\n        this.root.traverse((node) => {\n            if(node.parentIterateType !== 'playground') {\n                node.isDraggable = this.treeItemDraggable\n            }\n            this.flowStack.push({\n                type: node.type,\n                source: node.source,\n                layoutNode: node,\n            });\n        });\n\n        const layoutMapping = {\n            vertical: {},\n            horizontal: {},\n        };\n        const playgroundLayoutMapping = {}\n        this.root.reflowBodyPreCalculate(0, 0, (level, sequence, node) => {\n            if(!node.isroot) {\n                if(!layoutMapping.vertical[level]){\n                    layoutMapping.vertical[level] = {};\n                }\n                layoutMapping.vertical[level][sequence] = node;\n                \n                if(!layoutMapping.horizontal[sequence]){\n                    layoutMapping.horizontal[sequence] = {};\n                }\n                layoutMapping.horizontal[sequence][level] = node;\n            }\n        });\n\n        let currentTopNodeId;\n        this.root.reflowPlaygroundPreCalculate(\n            (topNode) => {\n                currentTopNodeId = topNode.id;\n                playgroundLayoutMapping[topNode.id] = {\n                    vertical: {},\n                    horizontal: {},\n                    node: topNode,\n                }\n            },\n            (level, sequence, node) => {\n                const layoutMapping = playgroundLayoutMapping[currentTopNodeId];\n                if(!layoutMapping.vertical[level]){\n                    layoutMapping.vertical[level] = {};\n                }\n                layoutMapping.vertical[level][sequence] = node;\n                \n                if(!layoutMapping.horizontal[sequence]){\n                    layoutMapping.horizontal[sequence] = {};\n                }\n                layoutMapping.horizontal[sequence][level] = node;\n            })\n\n        this.layoutMapping = layoutMapping;\n        this.playgroundLayoutMapping = playgroundLayoutMapping;\n        this.root.makeLink((configs) => {\n            this.flowLinkStack.push(configs)\n        })\n    }\n\n    staticCheck(instance, jflow) {\n\n        if(instance._layoutNode && instance._layoutNode.isFree) {\n            return false;\n        }\n        const finded = jflow._linkStack.find(l => l.from === instance || l.to === instance);\n        if(!finded) {\n            return false;\n        }\n        const nowAnchor = instance.anchor.slice();\n        jflow.reflow();\n        if(jflow._linkStack.length < 2) return;\n        const currentAnchor = instance.anchor;\n        const d = dist2(nowAnchor, currentAnchor);\n        if(d > 1000) {\n            instance.dispatchEvent(new JFlowEvent('outOfFlow', {\n                anchor: nowAnchor,\n                instance,\n                jflow,\n                point: nowAnchor,\n            }))\n            return true;\n        }\n        return false;\n    }\n\n    reflowByMapping(jflow, layoutMapping, x = 0, y = 0) {\n        const linkLength = this.linkLength;\n        const gap = this.gap;\n        const {\n            vertical: verticalMapping,\n            horizontal: horizontalMapping,\n        } = layoutMapping;\n\n        let reduceWidth = x;\n        Object.keys(horizontalMapping).forEach((columnNumber, idx) => {\n            const column = horizontalMapping[columnNumber];\n            let rowWidth = 0;\n            const rows = Object.keys(column)\n            rows.forEach(rowNumber => {\n                const ast = column[rowNumber];\n                const instance = jflow.getRenderNodeBySource(ast.source) // ast.getJflowInstance();\n                const { width } = instance.getBoundingDimension();\n                rowWidth = Math.max(width, rowWidth);\n            });\n            reduceWidth += idx === 0 ? 0: rowWidth/2\n            rows.forEach(rowNumber => {\n                const ast = column[rowNumber];\n                const instance = jflow.getRenderNodeBySource(ast.source);\n                instance.anchor[0] = reduceWidth;\n            });\n            reduceWidth += (rowWidth/2 + gap) ;\n        });\n\n        let reduceHeight = y;\n        // console.log(verticalMapping)\n        Object.keys(verticalMapping).forEach((rowNumber, idx) => {\n            const row = verticalMapping[rowNumber];\n            let rowHeight = 0;\n            const columns = Object.keys(row)\n            columns.forEach(columnNumber => {\n                const ast = row[columnNumber];\n                const instance = jflow.getRenderNodeBySource(ast.source);\n                const { height, width } = instance.getBoundingDimension();\n                rowHeight = Math.max(height, rowHeight);\n            });\n            reduceHeight += idx === 0 ? 0 : rowHeight/2;\n            columns.forEach(columnNumber => {\n                const ast = row[columnNumber];\n                const instance = jflow.getRenderNodeBySource(ast.source);\n                instance.anchor[1] = reduceHeight;\n            });\n            reduceHeight += (rowHeight/2 + linkLength) ;\n        });\n        \n    }\n\n    findLayoutNode(configs) {\n        const finded = this.flowStack.find(node => node.configs === configs);\n        if(finded) {\n            return finded.layoutMeta;\n        }\n        return null;\n    }\n\n    reflow(jflow){\n        this.reflowByMapping(jflow, this.layoutMapping);\n        Object.values(this.playgroundLayoutMapping).forEach(mapping => {\n            // const node = mapping.node.getJflowInstance();\n            const node = jflow.getRenderNodeBySource(mapping.node.source)\n            this.reflowByMapping(jflow, mapping, node.anchor[0], node.anchor[1]);\n        })\n    }\n}\n\nexport default LowcodeLayout;","import { DIRECTION } from '../../utils/constance';\nfunction getRelationShip(p1, p2) {\n    if(p1.type === 'Array' && p2.type !== 'Array') {\n        return '多对一'\n    }\n    if(p2.type === 'Array' && p1.type !== 'Array') {\n        return '一对多'\n    }\n    if(p1.type === 'Array' && p2.type === 'Array') {\n        return '多对多'\n    }\n    if(p1.type !== 'Array' && p2.type !== 'Array') {\n        return '一对一'\n    }\n}\n/**\n    ER property Node\n    * @implements {LayoutNode}\n */\nclass ERProperty {\n    constructor(source, node, isNavigation) {\n        /** @member {String}      - 布局节点类型 */\n        this.type = 'ERProperty';\n        /** @member {Object}      - 数据源 */\n        this.source = source;\n        this.node = node;\n        this.ref = source.ref;\n        this.type = source.type;\n        this.association = source.association;\n        /** @member {String}      - 唯一标识 */\n        this.id = isNavigation ? `${node.id}-${source.name}-navigation` : `${node.id}-${source.name}`\n        this._selfLink = false;\n        this.parentPropertyRef = undefined;\n        /** @member {LayoutNode~getJflowInstance}      - 获取jflow对象 */\n        this.getJflowInstance = undefined;\n        this.doubleRef = undefined;\n    }\n}\n/**\n ER Node\n * @implements {LayoutNode}\n * @param {Object} source\n */\nclass ERNode { \n    constructor(source) {\n        /** @member {String}      - 布局节点类型 */\n        this.type = 'ERNode';\n        /** @member {Object}      - 数据源 */\n        this.source = source;\n        /** @member {String}      - 唯一标识 */\n        this.id = source.name;\n        /** @member {Boolean}      - true, 可拖动 */\n        this.isDraggable = true;\n        /** @member {LayoutNode~getJflowInstance}      - 获取jflow对象 */\n        this.getJflowInstance = undefined;\n        // this.adjacencyList = []\n        this.propertyList = source.propertyList.map(p => new ERProperty(p, this));\n        this.navigationPropertyList = source.navigationPropertyList.map(p => new ERProperty(p, this, true))\n        this.idProperty = this.propertyList.find(p => p.source.name === 'id');\n        // this.VertexNameProperty = this.propertyList.find(p => p.source.type === 'VertexName');\n    }\n\n    _traverseProperty(nodeMap) {\n        this.propertyList.forEach(property => {\n            const idRef = property.source.idRef; // 决定链接的对象\n            const isParentRef = property.source.isParentRef; // 决定连接的性质\n            if(idRef && property.source.type !== 'Array' && nodeMap[idRef]) {\n                const parentRef = nodeMap[idRef];\n                if (property.source.isParentRef) {\n                    this.parentRef = parentRef;\n                }\n                if (parentRef === this) {\n                    property._selfLink = true;\n                }\n                property.parentPropertyRef = parentRef.idProperty;\n            }\n        });\n        this.navigationPropertyList.forEach(property => {\n            const objectRef = property.source.objectRef;\n            if(objectRef && nodeMap[objectRef]) {\n                const node = nodeMap[objectRef];\n                const targetProperty = node.navigationPropertyList.find(n => n.source.objectRef === this.id)\n                if (node === this) {\n                    property._selfLink = true;\n                }\n                property.doubleRef = targetProperty;\n            }\n        })\n        \n    }\n\n    traverse(callback) {\n        callback(this);\n        this.propertyList.forEach(property => {\n            if(property.ref instanceof ERNode) {\n                callback(property);\n            }\n        })\n    }\n\n    makeLink(callback) {\n        this.propertyList.forEach(property => {\n            if(property.parentPropertyRef instanceof ERProperty) {\n                const toProperty = property.parentPropertyRef;\n                if(property._selfLink) {\n                    callback({\n                        from: property.id,\n                        to: toProperty.id,\n                        part: 'property',\n                        fromDir: DIRECTION.LEFT,\n                        toDir: DIRECTION.LEFT,\n                        content: property.association,\n                        minSpanX: 80,\n                        meta: {\n                            from: property,\n                            to: toProperty,\n                        }\n                    });\n                } else {\n                    callback({\n                        from: property.id,\n                        to: toProperty.id,\n                        part: 'property',\n                        content: property.association,\n                        meta: {\n                            from: property,\n                            to: toProperty,\n                        }\n                    });\n                }\n            }\n        });\n\n        \n        this.navigationPropertyList.forEach(property => {\n            if(property.doubleRef instanceof ERProperty) {\n                const toProperty = property.doubleRef;\n                if(property._selfLink) {\n                    callback({\n                        from: property.id,\n                        to: toProperty.id,\n                        part: 'property',\n                        fromDir: DIRECTION.LEFT,\n                        toDir: DIRECTION.TOP,\n                        lineDash: [10, 5],\n                        doubleLink: true,\n                        content: property.association,\n                        minSpanX: 80,\n                        minSpanY: 80,\n                        meta: {\n                            from: property,\n                            to: toProperty,\n                        }\n                    });\n                } else {\n                    callback({\n                        from: property.id,\n                        to: toProperty.id,\n                        part: 'property',\n                        lineDash: [10, 5],\n                        doubleLink: true,\n                        content: property.association,\n                        meta: {\n                            from: property,\n                            to: toProperty,\n                            isObjectRef: true,\n                        }\n                    });\n                }\n            }\n        })\n    }\n}\n\nfunction makeER(source) {\n    const nodeMap = {};\n    const nodes = source.map(s => {\n        const node = new ERNode(s);\n        nodeMap[s.name] = node\n        return node;\n    });\n    nodes.forEach(node => {\n        node._traverseProperty(nodeMap);\n    });\n    return nodes;\n}\nexport { \n    makeER,\n}","\nimport { makeER } from './er-node';\n/**\n * ER source\n * @typedef {Object} ERLayout~sourceConfigs\n * @property {string} type - node\n * @property {string} id - 唯一标识\n * @property {Object[]} properties - 描述\n */\n/**\n * ER布局数据源配置\n * @typedef {Object} ERLayout~Configs\n * @property {ERLayout~sourceConfigs[]} entityRelationship - 关系\n */\n/**\n    ER layout\n\n    Entity Relationship Structure\n    tree = [\n        {\n            type: 'node',\n            id: 'uniqueID',\n            properties: [\n                {\n                    name: 'xxxx',\n                    ref: someUniqueId,\n                    description: 'xxxxxx',\n                },\n                ...\n            ]\n        },\n        ...\n    ]\n    \n    * @implements {Layout}\n */\n\nclass ERLayout {\n    constructor(configs) {\n        /** @member {boolean}      - false 不需要布局变化检查 */\n        this.static = false;\n        /** @member {Layout~NodeMeta[]}      - 布局节点单元数组 */\n        this.flowStack = [];\n        /** @member {Layout~LinkMeta[]}      - 布局连线单元数组 */\n        this.flowLinkStack = [];\n        /** @member {LayoutNode[]}      - 布局节点数组 */\n        this.erNodes = [];\n        this.reOrder(configs.entityRelationship);\n    }\n    /**\n     * 从 tree 计算布局\n     * @param {AstNode} tree - ER 树\n     */\n    reOrder(er) {\n        this.er = er;\n        this.flowStack = [];\n        this.flowLinkStack = [];\n        const nodes = makeER(this.er);\n        const idMap = [];\n        nodes.forEach(node => {\n            node.traverse((n) => {\n                this.flowStack.push({\n                    type: n.type,\n                    configs: n.source,\n                    layoutMeta: n,\n                })\n            });\n            node.makeLink(configs => {\n                const {\n                    from: property,\n                    to: toProperty,\n                    meta,\n                } = configs;\n                if(meta.isObjectRef) {\n                    const id1 = `${property}-${toProperty}`;\n                    const id2 = `${toProperty}-${property}`;\n                    \n                    const fromMeta = meta.from;\n                    if(idMap.includes(id1) || idMap.includes(id2)) {\n                        return;\n                    }\n                    if(!fromMeta.source.isParentRef) {  \n                        idMap.push(id1);\n                        idMap.push(id2);\n                        this.flowLinkStack.push(configs)\n                    }\n                } else {\n                    this.flowLinkStack.push(configs)\n                }\n               \n            })\n        });\n        this.erNodes = nodes;\n    }\n\n    staticCheck(instance, jflow) {\n        return false;\n    }\n\n    reflow(jflow){\n        const links = this.flowLinkStack;\n        const nodes = this.erNodes;\n        let x = 0;\n        const lineMapping = {};\n        const size = 1000;\n        function computeNodeAnchor(node, recorded = []) {\n            let relativeAnchor = [0, 0];\n            \n            \n            if (node.parentRef) {\n                if(recorded.includes(node.parentRef)) {\n                    // debugger;\n                    return [\n                        relativeAnchor[0] - (size/2) + node.source.diagramWeight * size,\n                        relativeAnchor[1]\n                    ];\n                }\n                recorded.push(node.parentRef);\n                \n                relativeAnchor = computeNodeAnchor(node.parentRef, recorded);\n                return [\n                    relativeAnchor[0] - (size/2) + node.source.diagramWeight * size,\n                    relativeAnchor[1] + 600,\n                ];\n            } else {\n                return relativeAnchor;\n            }\n        }\n        this.erNodes.forEach(node => {\n            const instance = node.getJflowInstance();\n            const [nx, ny] = computeNodeAnchor(node);\n            if(!lineMapping[ny]) {\n                lineMapping[ny] = [];\n            }\n            lineMapping[ny].push(node);\n            instance.anchor = [nx + lineMapping[ny].length * 500, ny];\n            x+=300\n        });\n        // debugger\n        // // Kahn’s Algorithm\n        // // Calcuate the incoming degree of each vertex\n        // const vertices = nodes.slice();\n        // debugger\n        // const inDegree = {};\n        // vertices.forEach(v => {\n        //     v.adjacencyList.forEach(p => {\n        //         const name = p.name;\n        //         inDegree[name] = inDegree[name] + 1 || 1;\n        //     })\n            \n        // })\n        // console.log(inDegree)\n        // debugger\n\n        // // Create a queue which stores the vertex without dependencies\n        // const queue = vertices.filter((v) => !inDegree[v.name]);\n        // console.log(queue)\n        // debugger\n        // const topNums = {};\n        // let index = 0;\n        // while (queue.length) {\n        //     const v = queue.shift();\n        //     topNums[v.name] = index++;\n        //     v.adjacencyList.forEach(neighbor => {\n        //         const name = neighbor.name;\n        //         inDegree[name]--;\n        //         if (inDegree[name] === 0) {\n        //             queue.push(neighbor);\n        //         }\n        //     });\n        // }\n        // if (index !== vertices.length) {\n        //     console.log(\"Detect a cycle\");\n        // }\n        // console.log(topNums);\n    }\n}\n\nexport default ERLayout;","\nexport const EDITOR_EVENTS = {\n    INPUT: 'input',\n    CONTROL_CMD: 'control'\n}\n\nexport const KEYBOARD_INPUT = {\n    INPUT: 'input',\n    COMPOSITION_START: 'compositionstart',\n    COMPOSITION_UPDATE: 'compositionupdate',\n    COMPOSITION_END: 'compositionend',\n    ENTER: 'enter',\n    DELETE: 'delete',\n    BACKSPACE: 'backspace',\n}\n\nexport const KEYBOARD_COMMANDS = {\n    ARROW_LEFT: 'arrowLeft',\n    ARROW_RIGHT: 'arrowRight',\n    ARROW_UP: 'arrowUp',\n    ARROW_DOWN: 'arrowDown',\n    UNDO: 'undo',\n    REDO: 'redo',\n    SHIFT_DOWN: 'shift_down',\n    SHIFT_UP: 'shift_up',\n    CTRLA: 'ctrla',\n    CTRLC: 'ctrlc',\n    CTRLV: 'ctrlv',\n    CTRLX: 'ctrlx',\n}\n\nexport const MOUSE_COMMANDS = {\n    START_EDIT: 'startedit',\n    EDIT_CLICK: 'editclick',\n    SHIFT_ON_CLICK: 'shiftonclick',\n    DOUBLE_CLICK: 'doubleclick'\n}\n\n\nexport const OPERRATION = {\n    PLAININPUT: 'plaininput',\n    SPACEINPUT: 'spaceinput',\n    RETURNINPUT: 'returninput',\n    CARETMOVEMENT: 'caretmovement',\n    DELETE_IN_LINE: 'deleteinline',\n    DELETE_IN_EDITAREA: 'deleteineditarea',\n    ENSURE_DELETE: 'ensuredelete',\n    SELECTION_DELETE: 'selectiondelete',\n    SELECTION_INPUT: 'selectioninput',\n    COMPOSITE_INSERT: 'compositeinsert'\n}\n","import { KEYBOARD_COMMANDS, KEYBOARD_INPUT, EDITOR_EVENTS } from './constants';\n\nclass ShadowInput extends EventTarget{\n    _inputElement = null;\n\n    constructor(wrapper) {\n        super();\n        this._inputElement = createInputElement(this.controlCallback.bind(this));\n        wrapper.append(this._inputElement);\n        this._inputElement.focus();\n    }\n    controlCallback(kind, data) {\n        switch(kind) {\n            case KEYBOARD_INPUT.INPUT:\n            case KEYBOARD_INPUT.COMPOSITION_START:\n            case KEYBOARD_INPUT.COMPOSITION_UPDATE:\n            case KEYBOARD_INPUT.COMPOSITION_END:\n            case KEYBOARD_INPUT.ENTER:\n            case KEYBOARD_INPUT.BACKSPACE:\n            case KEYBOARD_INPUT.DELETE:\n                this.dispatchEvent(new CustomEvent(EDITOR_EVENTS.INPUT, {\n                    detail: {\n                        kind,\n                        data,\n                    }\n                }))\n            break;\n\n            case KEYBOARD_COMMANDS.ARROW_LEFT:\n            case KEYBOARD_COMMANDS.ARROW_RIGHT:\n            case KEYBOARD_COMMANDS.ARROW_UP:\n            case KEYBOARD_COMMANDS.ARROW_DOWN:\n            case KEYBOARD_COMMANDS.CTRLA:\n            case KEYBOARD_COMMANDS.SHIFT_DOWN:\n            case KEYBOARD_COMMANDS.SHIFT_UP:\n            case KEYBOARD_COMMANDS.UNDO:\n            case KEYBOARD_COMMANDS.REDO:\n                this.dispatchEvent(new CustomEvent(EDITOR_EVENTS.CONTROL_CMD, {\n                    detail: {\n                        kind,\n                    }\n                }))\n            break;\n\n        }\n    }\n\n    focus() {\n        this._inputElement.focus({ preventScroll: true });  \n    }\n\n    syncPosition(x, y) {\n        this._inputElement.style.transform = `translate(${x}px, ${y}px)`\n    }\n\n    destroy() {\n        this._inputElement.remove();\n    }\n}\n\nexport default ShadowInput;\n\nfunction createInputElement(controlCallback) {\n    const input = document.createElement('input');\n    input.setAttribute('style',`\n        width: 100px;\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        opacity: 0;\n        z-index: -1;\n        contain: strict;`);\n    input.setAttribute('tabindex', -1);\n    input.setAttribute('aria-hidden', true);\n    input.setAttribute('spellcheck', false);\n    input.setAttribute('autocorrect', 'off');\n\n    let stopInput = false;\n    let status = {\n        ctrlOn: false,\n        shiftOn: false,\n    }\n\n    input.addEventListener('beforeinput', e => {\n        e.preventDefault();\n        if(e.data) {\n            // content += e.data;\n            // renderContent();\n            if(!stopInput) {\n                controlCallback(KEYBOARD_INPUT.INPUT, e.data);\n            }\n        }\n    })\n\n    input.addEventListener('compositionstart', (e) => {\n        controlCallback(KEYBOARD_INPUT.COMPOSITION_START);\n        stopInput = true;\n    });\n    input.addEventListener('compositionupdate', (e) => {\n        controlCallback(KEYBOARD_INPUT.COMPOSITION_UPDATE, e.data);\n    });\n    input.addEventListener('compositionend', (e) => {\n        controlCallback(KEYBOARD_INPUT.COMPOSITION_END, e.data);\n        input.value = '';\n        stopInput = false\n    });\n\n    input.addEventListener('keyup', (event) => {\n        if(stopInput) {\n            return;\n        }\n        switch(event.key) {\n            case \"Shift\":\n                controlCallback(KEYBOARD_COMMANDS.SHIFT_UP);\n                status.shiftOn = false;\n                break;\n            case \"Meta\":\n            case \"Control\":\n                status.ctrlOn = false;\n                break;\n            \n        }\n    })\n\n    input.addEventListener('keydown', (event) => {\n        if(stopInput) {\n            return;\n        }\n        switch(event.code) {\n            case \"Enter\":\n                controlCallback(KEYBOARD_INPUT.ENTER);\n                break;\n            case \"Backspace\":\n                controlCallback(KEYBOARD_INPUT.BACKSPACE);\n                break;\n            case \"Delete\":\n                controlCallback(KEYBOARD_INPUT.DELETE);\n                break;\n            case \"ArrowLeft\":\n                controlCallback(KEYBOARD_COMMANDS.ARROW_LEFT);\n                break;\n            case \"ArrowRight\":\n                controlCallback(KEYBOARD_COMMANDS.ARROW_RIGHT);\n                break;\n            case \"ArrowDown\":\n                controlCallback(KEYBOARD_COMMANDS.ARROW_DOWN);\n                break;\n            case \"ArrowUp\":\n                controlCallback(KEYBOARD_COMMANDS.ARROW_UP);\n                break;\n        }\n        switch(event.key) {\n            case \"Shift\":\n                controlCallback(KEYBOARD_COMMANDS.SHIFT_DOWN);\n                status.shiftOn = true;\n                break;\n            case \"Meta\":\n            case \"Control\":\n                status.ctrlOn = true;\n                break;\n            case 'a':\n                if(status.ctrlOn) {\n                    controlCallback(KEYBOARD_COMMANDS.CTRLA);\n                }\n                break;\n            case 'c':\n                if(status.ctrlOn) {\n                    controlCallback(KEYBOARD_COMMANDS.CTRLC);\n                }\n                break; \n            case 'v':\n                if(status.ctrlOn) {\n                    controlCallback(KEYBOARD_COMMANDS.CTRLV);\n                }\n                break;   \n            case 'x':\n                if(status.ctrlOn) {\n                    controlCallback(KEYBOARD_COMMANDS.CTRLX);\n                }\n                break;\n            case 'y':\n                if(status.ctrlOn) {\n                    event.preventDefault();\n                    controlCallback(KEYBOARD_COMMANDS.REDO);\n                }\n                break;\n            case 'z':\n                if((status.ctrlOn && status.shiftOn)) {\n                    controlCallback(KEYBOARD_COMMANDS.REDO);\n                } else if(status.ctrlOn) {\n                    controlCallback(KEYBOARD_COMMANDS.UNDO);\n                }\n                break;\n        }   \n    })\n    return input;\n}","class Caret { \n    _row = 0;\n    _column = [0,0];\n\n    _status = {\n        show: true,\n        anime: null,\n        lastElapsed: 0,\n        refreshElapsed: false,\n    }\n\n    setRow(row) {\n        this._row = row;\n    }\n    setColumn(columnoridx, column) {\n        if(column !== undefined) {\n            this._column[columnoridx] = column;\n        } else {\n            this._column = columnoridx;\n        }\n    }\n\n    getRow() {\n        return this._row;\n    }\n\n    getColumn(idx) {\n        if(idx !== undefined) {\n            return this._column[idx];\n        }\n        return this._column;\n    }\n\n    animate(jflow) {\n        this._status.anime = jflow.requestJFlowAnime((elapsed) => {\n            const lastElapsed = this._status.lastElapsed;\n            if(this._status.refreshElapsed) {\n                this._status.lastElapsed = elapsed;\n                this._status.refreshElapsed = false;\n            }\n            if(elapsed - lastElapsed > 500) {\n                this._status.show = !this._status.show;\n                this._status.lastElapsed = elapsed;\n            } \n        });\n    }\n\n    cancelAnimate() {\n        this._status.anime.cancel()\n        Object.assign(this._status, {\n            show: true,\n            anime: null,\n            lastElapsed: 0,\n        })\n    }\n\n    isShow() {\n        return this._status.show;\n    }\n\n    refresh() {\n        Object.assign(this._status, {\n            show: true,\n            refreshElapsed: true,\n        });\n    }\n\n    toRange() {\n        return [this._row, ...this._column];\n    }\n\n    fromRange(range) {\n        this._row = range[0];\n        this._column = range.slice(1);\n    }\n}\n\nexport default Caret;","import { calculateOffsetByWidth } from '../utils'\nexport class Area {\n    _lines = []; \n\n    get(idx) {\n        return this._lines[idx];\n    }\n\n    getLineAbove(offsetY) {\n        let row = 0;\n        const lines = this._lines;\n        while(row < lines.length) {\n            if(lines[row].reduceHeight > offsetY) {\n                break;\n            }\n            row ++;\n        }\n        return Math.min(row, lines.length - 1);\n    }\n\n    truncate(configs) {\n        const l = Line.create(configs);\n        this._lines = [l];\n        return l;\n    }\n\n    push(line) {\n        this._lines.push(line);\n    }\n\n    forEach(callback) {\n        this._lines.forEach(callback);\n    }\n\n    length() {\n        return this._lines.length;\n    }\n}\n\nexport class Line {\n    width = 0;\n    anchorY = 0;\n    height = 0;\n    reduceHeight = 0;\n    _elements = []\n\n    static create(configs) {\n        const l = new Line(configs);\n        return l;\n    }\n\n    constructor(configs = {}) {\n        Object.assign(this, configs);\n    }\n\n    _elements = [];\n\n    get(idx) {\n        return this._elements[idx];\n    }\n    length() {\n        return this._elements.length;\n    }\n\n    insert(idx, elem) {\n        this._elements.splice(idx, 0, elem)\n    }\n    push(elem) {\n        this._elements.push(elem);\n    }\n    tail() {\n        return this._elements[this._elements.length-1];\n    }\n    copy() {\n        return this._elements.slice();\n    }\n\n    getColumnNearest(offsetX, elementSpace, fontSize, fontFamily) {\n        const elements = this._elements;\n        if(offsetX >= this.width) {\n            const c = elements.length - 1;\n            const elem = elements[c];\n            let q = 0;\n            if(elem.type === 'text') {\n                q = elem.source.length;\n            } \n            return [c, q]\n        } else {\n            let elem_idx = 0;\n            let last_c = 0;\n            let _c = 0; \n            let lastel = null;\n            while(elem_idx < elements.length -1) {\n                last_c = _c;\n                const el = elements[elem_idx];\n                if(el.type !== 'text') {\n                    const doubleMargin = (lastel && lastel.type === 'text');\n                    const margin = doubleMargin ? elementSpace*2 : elementSpace;\n                    _c += (el.width + margin);\n                } else {\n                    _c += el.width;\n                }\n                if(_c > offsetX) {\n                    lastel = el\n                    break;\n                }\n                lastel = el\n                \n                elem_idx++;\n                \n            }\n            if(_c <= offsetX) {\n                last_c = _c;\n            }\n            const textmeta = elements[elem_idx];\n            if(textmeta.type === 'text') {\n                const offx = offsetX - last_c;\n                const idx = calculateOffsetByWidth(offx, textmeta, fontSize, fontFamily)\n                return [elem_idx, idx];\n            } else {\n                const offx = offsetX - last_c;\n                if(offx > lastel.width/2){\n                    return [elem_idx+1, 0]\n                } else {\n                    return [elem_idx, 0];\n                }\n               \n            }\n        }\n    }\n\n    forEach(callback) {\n        this._elements.forEach(callback);\n    }\n}\n\nexport class FlattenTextElements {\n    static create(elements) {\n        const _e = new FlattenTextElements();\n        _e.from(elements);\n        return _e;\n    }\n    _textElements = [];\n    _records = [];\n    _caretRecord = null;\n\n    insertBefore(anchor, elem) {\n        const idx = this.findIndex(anchor);\n        this.inersetAt(idx, elem);\n    }\n    insertAfter(anchor, elem) {\n        const idx = this.findIndex(anchor);\n        const next = this.get(idx+1);\n        if(next) {\n            elem.setNeedWrap(anchor.needWrap || anchor.isTail);\n        }\n        this.inersetAt(idx+1, elem);\n    }\n    findIndex(elem) {\n        return this._textElements.findIndex(el => el === elem);\n    }\n    get(idx) {\n        return this._textElements[idx];\n    }\n    from(elements) {\n        this._textElements = elements;\n    }\n    inersetAt(idx, elem) {\n        this.splice(idx, 0, elem)\n    }\n    push(elem) {\n        this.splice(this.length(), 0, elem);\n    }\n    remove(idx) {\n        this.splice(idx, 1);\n    }\n    splice() {\n        const removed = this._textElements.splice(...arguments);\n        this._records.push({\n            op: 'splice',\n            args: arguments,\n            removed,\n        })\n    }\n    copy() {\n        return this._textElements.slice();\n    }\n    isEmpty() {\n        return this._textElements.length === 1 && this._textElements[0].source === '';\n    }\n    forEach(callback) {\n        this._textElements.forEach(callback);\n    }\n    tail() {\n        return this._textElements[this._textElements.length-1];\n    }\n    filter(callback) {\n        return this._textElements.filter(callback);\n    }\n    length() {\n        return this._textElements.length;\n    }\n\n    startRecord() {\n        this._caretRecord = {\n            before: null,\n            after: null,\n        }\n        this._records = [];\n        return this._records;\n    }\n\n    getRecord() {\n        return this._records;\n    }\n\n    recordBeforeCaret(caret) {\n        this._caretRecord.before = caret.toRange();\n    }\n\n    recordAfterCaret(caret) {\n        this._caretRecord.after = caret.toRange();\n    }\n\n    getCaretRecord() {\n        return this._caretRecord;\n    }\n\n    collectRecords() {\n        return this._records;\n    }\n}\n\nexport class TextElement {\n    needWrap = false;\n    width = 0;\n    reduceWidth = 0;\n    height = 0;\n    anchorX = 0;\n    anchorY = 0;\n    dirty = true;\n    isTail = false;\n\n    constructor(type, source) {\n        this.type = type;\n        this.source = source;\n    }\n\n    setSource(source, records) {\n        const lastSource = this.source;\n        this.source = source;\n        this.dirty = true;\n        if(records) {\n            records.push({\n                op: 'setSource',\n                args: [this, source, lastSource],\n            })\n        }\n    }\n\n    setNeedWrap(needWrap, records) {\n        const lastWrap = this.needWrap;\n        this.needWrap = needWrap;\n        if(lastWrap!== needWrap && records) {\n            records.push({\n                op: 'setNeedWrap',\n                args: [this, needWrap, lastWrap],\n            })\n        }\n    }\n\n    shift(offset, step) {\n        if(this.type === 'text') {\n            const content = this.source;\n            const l = content.length;\n            const nextOffset = offset + step;\n            if(nextOffset < 0) {\n                return 'prev';\n            }\n            if(nextOffset > l ){//- ((isTail || this.needWrap) ? 0 : 1)) {\n                return 'next';\n            }\n            return 'self';\n        } else {\n            if(step > 0) {\n                return 'next';\n            } \n            if(step < 0){\n                return 'prev';\n            }\n        }\n    }\n\n    tailOffset() {\n        if(this.type === 'text') {\n            if(this.needWrap || this.isTail){\n                return this.source.length;\n            } else {\n                return Math.max(0, this.source.length - 1);\n            }\n        } else {\n            return 0;\n        }\n    }\n\n    headOffset() {\n        return 0;\n    }\n}","import { requestCacheCanvas } from '../../utils/canvas';\nexport function calculateOffsetByWidth(\n    offx, \n    textmeta,\n    fontSize, fontFamily\n) {\n    const content = textmeta.source;\n    const maxL = content.length - 1;\n    if(textmeta.width === 0) {\n        return 0;\n    }\n    const allwidth = textmeta.width;\n    let idx = Math.floor(offx / allwidth * maxL) ;\n    requestCacheCanvas((ctx) => {\n        ctx.font = `${fontSize} ${fontFamily}`;\n        let g1, g2;\n        let lastidx;\n\n        let c = content.substring(0, idx);\n        let c1 = content.substring(idx-1, idx);\n        let c2 = content.substring(idx, idx+1);\n        let w = ctx.measureText(c).width;\n        let w1 = ctx.measureText(c1).width;\n        let w2 = ctx.measureText(c2).width;\n        g1 = w - w1/2;\n        g2 = w + w2/2;\n        \n        do {\n            if(g1 <= offx && g2 >= offx) {\n                break;\n            }  \n            if(g1 > offx) {\n                // 左侧少了\n                const spanw = g2 - offx;\n                lastidx = idx;\n                if(spanw < 100) {\n                    idx -= 1;\n                } else {\n                    idx -= Math.floor(spanw / g2 * lastidx)\n                }\n                c = content.substring(idx, lastidx);\n                w -= ctx.measureText(c).width;\n            } else if(g2 < offx) {\n                // 右侧少了\n                const spanw = offx - g1;\n                lastidx = idx;\n                if(spanw < 100) {\n                    idx += 1;\n                } else {\n                    idx += Math.floor(spanw / (allwidth - g1) * (maxL - lastidx))\n                }\n                c = content.substring(lastidx, idx);\n                w += ctx.measureText(c).width;\n            }\n            \n            c1 = content.substring(idx-1, idx);\n            c2 = content.substring(idx, idx+1);\n            w1 = ctx.measureText(c1).width;\n            w2 = ctx.measureText(c2).width;\n            g1 = w - w1/2;\n            g2 = w + w2/2;\n        } while(idx >= 0 && idx <= maxL)\n        \n    });\n    return idx;\n}","import { TextElement } from \"../storage\";\nclass Range {\n    _enable = false;\n    _rangeFrom = null; // [row, elem_idx, offset]\n    _rangeTo = null;   // [row, elem_idx, offset]\n    _initialRange = null; \n\n    setInitialRange(initialRange) {\n        this._initialRange = initialRange;\n    }\n\n    getRangeFrom() {\n        return this._rangeFrom;\n    }\n\n    getRangeTo() {\n        return this._rangeTo;\n    }\n\n    isEnable() {\n        return this._enable;\n    }\n\n    enable() {\n        this._enable = true;\n    }\n    disable() {\n        this._enable = false;\n    }\n\n    handleCaret(caret) {\n        const [a, b, c] = this._rangeTo;\n        caret.setRow(a);\n        caret.setColumn([b, c]);\n    }\n\n    setRange(another) {\n        const a = this._initialRange;\n        if(this._compareRange(a, another)) {\n            this._rangeFrom = a;\n            this._rangeTo = another;\n        } else {\n            this._rangeFrom = another;\n            this._rangeTo = a;\n        }\n\n    }\n\n    _compareRange(r1, r2) {\n        if(r1[0] > r2[0]) {\n            return false;\n        }\n        if(r1[0] === r2[0] && r1[1] > r2[1]) {\n            return false;\n        }\n        if(r1[0] === r2[0] && r1[1] === r2[1] && r1[2] > r2[2]) {\n            return false;\n        }\n        return true;\n    }\n\n    delete(editor, records) {\n        if(this._enable) {\n            const area = editor._area;\n            const caret = editor._caret;\n            const rangeFrom = this._rangeFrom;\n            const rangeTo = this._rangeTo;\n            const elemFrom = area.get(rangeFrom[0]).get(rangeFrom[1]);\n            const elemTo = area.get(rangeTo[0]).get(rangeTo[1]);\n            let [row, elem_idx, offset] = rangeFrom;\n            records.push({\n                op: 'range',\n                args: [rangeFrom.slice(), rangeTo.slice()],\n            })\n            if(elemFrom === elemTo) {\n                const c = elemFrom.source;\n                elemFrom.setSource(c.substring(0, rangeFrom[2]) + c.substring(rangeTo[2]), records);\n                elemFrom.dirty = true;\n            } else {\n                const flattenTxtElem = editor._flattenTxtElem\n                let preContent = '';\n                let afterContent = '';\n                let preElement;\n                let afterElement;  \n                const fromIdx = flattenTxtElem.findIndex(elemFrom);\n                const toIdx = flattenTxtElem.findIndex(elemTo);\n                let endTextNeedWrap = false;\n                if(elemFrom.type === 'text') {\n                    preContent = elemFrom.source.substring(0, rangeFrom[2]);\n                } else {\n                    preElement = flattenTxtElem.get(fromIdx-1)\n                }\n                if(elemTo.type === 'text') {\n                    afterContent = elemTo.source.substring(rangeTo[2]);\n                    endTextNeedWrap = elemTo.needWrap;\n                } else {\n                    afterElement = flattenTxtElem.get(toIdx-1);\n                }\n\n                if(preElement) {\n                    flattenTxtElem.splice(fromIdx, toIdx-fromIdx+1);\n                    if(preElement.type === 'text') {\n                        if(preElement.needWrap) {\n                            row -= 1;\n                        } else {\n                            elem_idx -= 1;\n                        }\n                        offset = preElement.source.length;\n                        preElement.setSource(preElement.source + afterContent, records);\n                        preElement.dirty = true;\n                        preElement.setNeedWrap(endTextNeedWrap, records);\n                    } else {\n                        const t = new TextElement('text', preContent + afterContent);\n                        t.setNeedWrap(endTextNeedWrap, records);\n                        flattenTxtElem.splice(fromIdx, 0, t)\n                    }\n                } else {\n                    flattenTxtElem.splice(fromIdx, toIdx-fromIdx);\n                    if(afterElement) {\n                        const t = new TextElement('text', preContent);\n                        flattenTxtElem.splice(fromIdx, 0, t);\n                    } else {\n                        elemTo.setSource(preContent + afterContent, records);\n                        elemTo.dirty = true;\n                    }\n                }\n                \n                if(flattenTxtElem.length() === 0) {\n                    // elem_idx = 0;\n                    flattenTxtElem.push(new TextElement('text', ''));\n                }\n\n            }\n            this.disable();\n            \n            caret.setRow(row);\n            caret.setColumn([elem_idx, offset]);\n        }\n    }\n}\nexport default Range;","\nfunction isSetSourceBatch(x) {\n    return x.length === 1 && x[0].op === 'setSource';\n}\nexport default class UndoRedo {\n    static length = 50;\n    _undo = [];\n    _redo = [];\n    _editor = null;\n\n    write(x, caretRecord) {\n        if(x.length === 0) {\n            return;\n        }\n        if(isSetSourceBatch(x)) {\n            const t = x[0];\n            const lastUndo = this.getLastUndo();\n            if(lastUndo && isSetSourceBatch(lastUndo._batch)) {\n                const q = lastUndo._batch[0];\n                if(q.args[0] === t.args[0]) {\n                    q.args[1] = t.args[1];\n                    lastUndo._caretMetaTo = caretRecord.after;\n                    return;\n                }\n            }\n        }\n        const r = new BatchAction(x);\n        r._caretMetaFrom = caretRecord.before;\n        r._caretMetaTo = caretRecord.after;\n        this._undo.push(r);\n        \n        if(this._undo.length > UndoRedo.length) {\n            this._undo.splice(0, 1);\n        }\n        if(this._redo.length) {\n            this._redo = [];\n        }\n    }\n\n    getLastUndo() {\n        return this._undo[this._undo.length - 1];\n    }\n\n    undo() {\n        const x = this._undo.pop();\n        if(x) {\n            x.undo(this._editor)\n            this._redo.push(x);\n        }\n        return x;\n    }\n\n    redo() {\n        let x = this._redo.pop();\n        while(x && x.SKIP_REDO) {\n            x = this._redo.pop();\n        }\n        if(x) {\n            x.redo(this._editor)\n            this._undo.push(x);\n        }\n        return x;\n    }\n}\n\nclass BatchAction {\n    _batch = [];\n    _caretMetaFrom = null;\n    _caretMetaTo = null;\n    constructor(batch) {\n        this._batch = batch;\n    }\n\n    updateCaretMetaTo(meta) {\n        this._caretMetaTo = meta;\n    }\n\n    undo(editor) {\n        this._batch.slice().reverse().forEach(action => {\n            switch(action.op) {\n                case 'range':\n                    const [rangeFrom, rangeTo] = action.args;\n                    const range = editor._range;\n                    range.setInitialRange(rangeFrom);\n                    range.setRange(rangeTo);\n                    range.enable();\n                    break;\n                case 'setSource':\n                    const [elem, s, ls] = action.args;\n                    elem.source = ls;\n                    elem.dirty = true;\n                    break;\n                case 'setNeedWrap':\n                    const [o, p, q] = action.args;\n                    o.needWrap = q;\n                    o.dirty = true;\n                    break;\n                case 'splice':\n                    const flattenTxtElem = editor._flattenTxtElem;\n                    const [a, b, ...c] = action.args;\n                    const removed = action.removed;\n                    let i = 0\n                    if(c) {\n                        i = c.length\n                    }\n                    flattenTxtElem.splice(a, i, ...removed);\n                    break;\n            }\n        });\n\n        editor._caret.fromRange(this._caretMetaFrom);\n    }\n\n    redo(editor) {\n        this._batch.forEach(action => {\n            switch(action.op) {\n                case 'setSource':\n                    const [elem, s, ls] = action.args;\n                    elem.source = s;\n                    elem.dirty = true;\n                    break;\n                case 'setNeedWrap':\n                    const [o, p, q] = action.args;\n                    o.needWrap = p;\n                    o.dirty = true;\n                    break;\n                case 'splice':\n                    const flattenTxtElem = editor._flattenTxtElem;\n                    flattenTxtElem.splice(...action.args);\n                    break;\n            }\n        })\n        editor._caret.fromRange(this._caretMetaTo);\n    }\n}","class Command {\n    static create(editor) {\n        return new this(editor)\n    }\n\n    constructor(editor) {\n        this._editor = editor;\n    }\n\n    exec() {}\n}\n\nexport default Command;","import Command from './base';\nimport { KEYBOARD_COMMANDS } from '../base/constants';\n\nexport class ArrowLeftCommand extends Command {\n    static name = KEYBOARD_COMMANDS.ARROW_LEFT;\n\n    exec() {\n        const editor = this._editor;\n        editor._range.disable();\n        const flattenTxtElem = editor._flattenTxtElem\n        const caret = editor._caret;\n        const row = caret.getRow();\n        const column = caret.getColumn();\n        const [elemidx, offset] = column;\n        const line = editor._area.get(row);\n        const element = line.get(elemidx);\n        const idx = flattenTxtElem.findIndex(element);\n        const result = element.shift(offset, -1);\n        switch(result) {\n            case 'prev':\n                if(elemidx > 0) {\n                    const el = line.get(elemidx - 1);\n                    caret.setColumn([elemidx - 1, el.tailOffset()])\n                } else if(idx > 0) {\n                    const preRow = row - 1;\n                    const preElemidx = editor._area.get(preRow).length() - 1\n                    const offset = flattenTxtElem.get(idx-1).tailOffset();\n                    caret.setRow(preRow);\n                    caret.setColumn([preElemidx, offset]);\n                }\n                break;\n            case 'self':\n                caret.setColumn(1, offset - 1)\n                break;\n        }\n        caret.refresh();\n        editor.syncShadowInputPosition();\n        editor._jflow._render();\n    }\n}\nexport class ArrowRightCommand extends Command {\n    static name = KEYBOARD_COMMANDS.ARROW_RIGHT;\n\n    exec() {\n        const editor = this._editor;\n        editor._range.disable();\n        const flattenTxtElem = editor._flattenTxtElem\n        const caret = editor._caret;\n        const row = caret.getRow();\n        const column = caret.getColumn();\n        const [elemidx, offset] = column;\n        const line = editor._area.get(row);\n        const element = line.get(elemidx);\n        const idx = flattenTxtElem.findIndex(element);\n        const result = element.shift(offset, 1, idx === flattenTxtElem.length()-1);\n        switch(result) {\n            case 'next':\n                if(elemidx < line.length()-1) {\n                    const el = line.get(elemidx + 1);\n                    if(element.type === 'text' && el.type !== 'text') {\n                        caret.setColumn([elemidx + 2, el.headOffset()])\n                    } else {\n                        caret.setColumn([elemidx + 1, el.headOffset()])\n                    }\n                } else if(idx < flattenTxtElem.length()-1) {\n                    const afterRow = row + 1;\n                    const offset = flattenTxtElem.get(idx + 1).headOffset();\n                    caret.setRow(afterRow);\n                    caret.setColumn([0, offset]);\n                }            \n                break;\n            case 'self':\n                caret.setColumn(1, offset + 1);\n                break;\n        }\n\n        caret.refresh();\n        editor.syncShadowInputPosition();\n        editor._jflow._render();\n    }\n}\nexport class ArrowUpCommand extends Command {\n    static name = KEYBOARD_COMMANDS.ARROW_UP;\n\n    exec() {\n        this._editor._range.disable();\n        const nextRow = this._editor._caret.getRow() - 1;\n        if(nextRow > -1){\n            this._handler(nextRow);\n        }\n    }\n}\nexport class ArrowDownCommand extends Command {\n    static name = KEYBOARD_COMMANDS.ARROW_DOWN;\n\n    exec() {\n        this._editor._range.disable();\n        const nextRow = this._editor._caret.getRow() + 1;\n        if(nextRow < this._editor._area.length()){\n            this._handler(nextRow);\n        }\n    }\n}\nconst _mixin = {\n    _handler(nextRow) {\n        const editor = this._editor;\n        const caret = editor._caret;\n        const row = caret.getRow();\n        const column = caret.getColumn();\n        const [elemidx, offset] = column;\n        const area = editor._area;\n        const line = area.get(row);\n        let currElem = line.get(elemidx);\n        let currElemReduceWidth = currElem.reduceWidth;\n        if(offset > 0) {\n            currElemReduceWidth += editor.measureTextWidth(currElem.source.substring(0, offset))\n        }\n        \n        const nextLine = area.get(nextRow);\n        const nextColumn = nextLine.getColumnNearest(currElemReduceWidth, editor.elementSpace, editor.fontSize, editor.fontFamily)\n        caret.setRow(nextRow);\n        caret.setColumn(nextColumn);\n        \n        caret.refresh();\n        editor.syncShadowInputPosition();\n        editor._jflow._render();\n    }\n}\n\nObject.assign(ArrowUpCommand.prototype, _mixin);\nObject.assign(ArrowDownCommand.prototype, _mixin);","import Command from './base';\nimport { TextElement } from '../storage';\nimport { EDITOR_EVENTS, KEYBOARD_INPUT } from '../base/constants';\nfunction _blandAdjacentElement(elem1, elem2, defaultOffset, records) {\n    if(!elem1) {\n        return [defaultOffset, false];\n    }\n    if(elem1.type === 'text' && elem2.type === 'text') {\n        const offset = elem1.source.length;\n        elem1.setSource(elem1.source + elem2.source, records);\n        elem1.setNeedWrap(elem2.needWrap, records)\n        return [offset, true];\n    }\n    return [defaultOffset, false];\n}\n\nexport class Input extends Command {\n    static name = EDITOR_EVENTS.INPUT;\n\n    cacheIdx = null;\n\n    exec(kind, data) {\n        const editor = this._editor;\n        const range = editor._range;\n        const caret = editor._caret;\n        const flattenTxtElem = editor._flattenTxtElem;\n        const undoredo = editor._undoredo;\n        const records = flattenTxtElem.startRecord();\n        flattenTxtElem.recordBeforeCaret(caret);\n        if(range.isEnable()) {\n            range.delete(editor, records);\n            if(kind === KEYBOARD_INPUT.BACKSPACE || kind === KEYBOARD_INPUT.DELETE) {\n                flattenTxtElem.collectRecords();\n                flattenTxtElem.recordAfterCaret(caret);\n                this._editor.refresh();\n                undoredo.write(records, flattenTxtElem.getCaretRecord());\n                return;\n            }\n        }\n        \n        const row = caret.getRow();\n        let [elem_idx, offset] = caret.getColumn();\n        const area = editor._area;\n        const line = area.get(row);\n        let element = line.get(elem_idx);\n        let preElem = line.get(elem_idx-1);\n        \n        let content = '';\n        if(element.type === 'text') {\n            content = element.source;\n        } else if(preElem?.type ==='text'){\n            content = preElem.source;\n            element = preElem;\n            offset = content.length;\n            caret.setColumn([elem_idx-1, content.length]);\n        } else {\n            const newElement = new TextElement('text', '');\n            flattenTxtElem.insertBefore(element, newElement);\n            element = newElement;\n        }\n\n        let preContent = content.substring(0, offset);\n        let afterContent \n        if(this.cacheIdx) {\n            afterContent = content.substring(this.cacheIdx[1]);\n        } else {\n            afterContent = content.substring(offset);\n        }\n\n        switch(kind){\n            case KEYBOARD_INPUT.INPUT:\n                if(/\\r?\\n/.test(data)) {\n                    let source = data.split(/\\r?\\n/);\n                    source = source.replace(/\\t/, '');\n                    let idx = flattenTxtElem.findIndex(element);\n                    let a = source.shift();\n                    element.setSource(preContent + a, records);\n                    let _row = row + 1;\n                    idx++;\n                    while(source.length > 1) {\n                        const t = new TextElement('text', source.shift());\n                        t.setNeedWrap(true, records);\n                        _row++;\n                        flattenTxtElem.inersetAt(idx, t);\n                        idx++;\n                    }\n                    a = source.shift();\n                    const curElem = flattenTxtElem.get(idx);\n                    if(curElem && curElem.type === 'text') {\n                        curElem.setSource(a + curElem.source, records);\n                    } else {\n                        const t = new TextElement('text', a);\n                        flattenTxtElem.inersetAt(idx, t);\n                    }\n                    caret.setRow(_row);\n                    caret.setColumn([0, a.length])\n                } else {\n                    preContent += data;\n                    caret.setColumn(1, caret.getColumn(1) + data.length);\n                    element.setSource(preContent + afterContent, records);\n                }\n                break;\n            case KEYBOARD_INPUT.COMPOSITION_START:\n                this.cacheIdx = [preContent.length, preContent.length];\n                break;\n            case KEYBOARD_INPUT.COMPOSITION_UPDATE:\n                preContent = preContent.substring(0, this.cacheIdx[0]);\n                preContent += data;\n                element.setSource(preContent + afterContent, records);\n                const _t = this.cacheIdx[0] + data.length;\n                caret.setColumn(1, _t);\n                this.cacheIdx[1] = _t;\n                break;\n            case KEYBOARD_INPUT.COMPOSITION_END:\n                preContent = preContent.substring(0, this.cacheIdx[0]);\n                caret.setColumn(1, this.cacheIdx[0] + data.length);\n                this.cacheIdx = null;\n                preContent += data;\n                element.setSource(preContent + afterContent, records);\n                break;\n            case KEYBOARD_INPUT.ENTER:\n                element.setSource(preContent, records);\n                element.setNeedWrap(true, records);\n                const t = new TextElement('text', afterContent);\n                flattenTxtElem.insertAfter(element, t);\n                caret.setRow(row+1);\n                caret.setColumn([0, 0])\n                break;\n            \n            case KEYBOARD_INPUT.BACKSPACE:\n                const result = element.shift(offset, -1);\n                switch(result) {\n                    case 'prev':\n                        let idx = flattenTxtElem.findIndex(element);\n                        if(elem_idx > 0) {\n                            // 行内\n                            flattenTxtElem.splice(idx-1, 1);\n                            idx -= 1;\n                            // element.setSource(afterContent, records);\n                            // element.dirty = true;\n                            const [offset, deleteop] = _blandAdjacentElement(flattenTxtElem.get(idx-1), element, 0, records);\n                            if(deleteop) {\n                                flattenTxtElem.remove(idx);\n                            }\n                            caret.setColumn([elem_idx - (offset > 0?2:1), offset])\n                            \n                        } else if(idx > 0) {\n                            // 换行了\n                            const preRow = row - 1;\n                            const preElemidx = area.get(preRow).length() - 1;\n                            const [offset, deleteop] = _blandAdjacentElement(flattenTxtElem.get(idx-1), element, 0, records);\n                            if(deleteop) {\n                                flattenTxtElem.remove(idx);\n                            }\n                            caret.setRow(preRow);\n                            caret.setColumn([preElemidx, offset]);\n                        }\n                        break;\n                    case 'self':\n                        preContent = preContent.substring(0, preContent.length - 1);\n                        caret.setColumn(1, caret.getColumn(1)-1)\n                        element.setSource(preContent + afterContent, records);\n                        break;\n                }\n                break;\n            case KEYBOARD_INPUT.DELETE:\n                const shiftresult = element.shift(offset, 1);\n                switch(shiftresult) {\n                    case 'next':\n                        let idx = flattenTxtElem.findIndex(element);\n                        if(elem_idx < line.length()-1) {\n                            // 行内\n                            flattenTxtElem.splice(idx+1, 1);\n                            const nextElem = flattenTxtElem.get(idx+1);\n                            const [offset, deleteop] = _blandAdjacentElement(element, nextElem, element.source.length, records);\n                            if(deleteop) {\n                                flattenTxtElem.remove(idx+1);\n                            }\n                            caret.setColumn([elem_idx, offset])\n                            \n                        } else if(idx < flattenTxtElem.length()-1){\n                            // 换行了\n                            const nextElem = flattenTxtElem.get(idx+1);\n                            const [offset, deleteop] = _blandAdjacentElement(element, nextElem, element.source.length, records);\n                            if(deleteop) {\n                                flattenTxtElem.remove(idx+1);\n                            }\n                            caret.setColumn([elem_idx, offset])\n                        }\n                        break;\n                    case 'self':\n                        afterContent = afterContent.substring(1);\n                        element.setSource(preContent + afterContent, records);\n                        break;\n                }\n                break;\n        }\n\n        flattenTxtElem.collectRecords();\n        flattenTxtElem.recordAfterCaret(caret);\n        undoredo.write(records, flattenTxtElem.getCaretRecord());\n        this._editor.refresh();\n    }\n\n    \n}","import Command from './base';\n\nimport { MOUSE_COMMANDS } from '../base/constants';\nimport JFlowEvent from '../../../events/index';\n\nexport class StartEditCommand extends Command {\n    static name = MOUSE_COMMANDS.START_EDIT;\n\n    exec() {\n        const editor = this._editor;\n        if(!this._startEdit()) {\n            return;\n        }\n        const jflow = editor._jflow;\n        editor.moveCaretByHitPoint();\n        editor.createShadowInput();\n        editor._caret.animate(jflow);\n        editor.syncShadowInputPosition();\n    }\n\n    _startEdit() {\n        let flag = true;\n        const editor = this._editor;\n        editor.dispatchEvent(new JFlowEvent('edit', {\n            target: editor,\n            preventDefault() {\n                flag = false;\n            }\n        })) \n        return flag; \n    }\n}\nexport class EditClickCommand extends Command {\n    static name = MOUSE_COMMANDS.EDIT_CLICK;\n\n    exec() {\n        const editor = this._editor;\n        editor.moveCaretByHitPoint();\n        editor._caret.refresh();\n        editor.syncShadowInputPosition();\n        editor._range.disable();\n    }\n}\n\nexport class DoubleClickCommand extends Command {\n    static name = MOUSE_COMMANDS.DOUBLE_CLICK;\n\n    exec() {\n        const editor = this._editor;\n        editor.moveCaretByHitPoint();\n        const caret = editor._caret;\n        const range = editor._range;\n        const area = editor._area;\n        const row = caret.getRow();\n        const line = area.get(row);\n        const elem_idx = line.length() - 1;\n        range.setInitialRange([row, 0, 0]);\n        range.setRange([\n            row, elem_idx, line.tail().tailOffset()\n        ]);\n        range.handleCaret(caret);\n        range.enable();\n        editor.syncShadowInputPosition();\n    }\n}\n","import Command from './base';\nimport { KEYBOARD_COMMANDS, MOUSE_COMMANDS } from '../base/constants';\n\nexport class ShiftUpCommand extends Command {\n    static name = KEYBOARD_COMMANDS.SHIFT_UP;\n    exec() {\n        const range = this._editor._range;\n        range.setInitialRange(null);\n        this._editor.toggleShift(false)\n    }\n}\n\nexport class ShiftDownCommand extends Command {\n    static name = KEYBOARD_COMMANDS.SHIFT_DOWN;\n    \n    exec() {\n        const range = this._editor._range;\n        const caret = this._editor._caret;\n        range.setInitialRange(caret.toRange());\n        this._editor.toggleShift(true)\n    }\n}\n\nexport class ShiftOnClickCommand extends Command {\n    static name = MOUSE_COMMANDS.SHIFT_ON_CLICK;\n\n    exec() {\n        const editor = this._editor;\n        editor.moveCaretByHitPoint();\n        const caret = this._editor._caret;\n        const range = this._editor._range;\n        range.setRange(caret.toRange());\n        range.enable();\n        range.handleCaret(caret);\n        caret.refresh();\n        editor.syncShadowInputPosition();\n    }\n}","import Command from './base';\nimport { KEYBOARD_COMMANDS } from '../base/constants';\n\nexport class CtrlACommand extends Command {\n    static name = KEYBOARD_COMMANDS.CTRLA;\n    exec() {\n        const editor = this._editor;\n        const caret = editor._caret;\n        const range = editor._range;\n        const area = editor._area;\n        const row = area.length() - 1;\n        const line = area.get(row);\n        const elem_idx = line.length() - 1;\n        range.setInitialRange([0, 0, 0]);\n        range.setRange([\n            row, elem_idx, line.tail().tailOffset()\n        ]);\n        range.handleCaret(caret);\n        range.enable();\n        editor.syncShadowInputPosition();\n    }\n}\n","import Command from './base';\nimport { KEYBOARD_COMMANDS } from '../base/constants';\n\nexport class UndoCommand extends Command {\n    static name = KEYBOARD_COMMANDS.UNDO;\n    exec() {\n        this._editor._range.disable()\n        this._editor._undoredo.undo();\n        this._editor.refresh();\n\n    }\n}\n\nexport class RedoCommand extends Command {\n    static name = KEYBOARD_COMMANDS.REDO;\n    exec() {\n        this._editor._range.disable()\n        this._editor._undoredo.redo();\n        this._editor.refresh();\n    }\n}","import Node from '../node';\nimport StackMixin from '../stackMixin';\nimport LayoutMixin from '../layoutMixin';\nimport JFlowEvent from '../../events/index';\nimport { requestCacheCanvas } from '../../utils/canvas';\nimport ShadowCache from '../shapes/shadow-cache';\nimport ShadowInput from './base/shadow-input';\n\nimport Caret from './base/caret';\nimport Range from './base/range';\nimport UndoRedo from './undoredo';\nimport {\n    Area,\n    FlattenTextElements,\n    Line,\n    TextElement\n} from './storage';\n\nimport { \n    Input,\n    ArrowLeftCommand,\n    ArrowRightCommand,\n    ArrowUpCommand,\n    ArrowDownCommand,\n    StartEditCommand,\n    ShiftDownCommand,\n    ShiftUpCommand,\n    ShiftOnClickCommand,\n    EditClickCommand,\n    CtrlACommand,\n    DoubleClickCommand,\n    // ReturnCommand,\n    // DeleteCommand,\n    UndoCommand,\n    RedoCommand,\n} from './command'\nimport { EDITOR_EVENTS, KEYBOARD_COMMANDS, MOUSE_COMMANDS } from './base/constants';\n\nclass TextGroup extends Node {\n\n    get currentLineHeight() {\n        return this.lineHeight || parseInt(this.fontSize);\n    }\n\n    constructor(configs) {\n        super(configs);\n        this.initStack(configs);\n        this.initLayout(configs);\n\n        this._undoredo = new UndoRedo();\n        this._undoredo._editor = this;\n        this._caret = new Caret();\n        this._range = new Range();\n        this._shadowInput = undefined;\n\n        this.textColor = configs.textColor || 'transparent';\n        this.fontFamily = configs.fontFamily || '-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji'\n        this.fontSize = configs.fontSize || '28px';\n        this.fontWeight = configs.fontWeight || '';\n        this.elementSpace = configs.elementSpace || 5;\n        this.lineSpace = configs.lineSpace || 5;\n        this.placeholder = configs.placeholder || '请输入';\n        this.placeholderColor = configs.placeholderColor || '#eee';\n        this.cursorColor = configs.cursorColor || '#60CFC4';\n        this.textRangeColor = configs.textRangeColor || '#4E75EC1A';\n        this.minWidth = configs.minWidth || 0;\n\n        \n        this.resolver = () => {\n            const elements = configs.resolver();\n            if(elements.length === 0 || elements[elements.length-1].type !== 'text') {\n                elements.push(new TextElement('text', ''))\n            }\n            return elements;\n        }\n\n        // this._lines = [];\n        this._area = new Area();\n        this._flattenTxtElem = FlattenTextElements.create(this.resolver()); \n        this._status = {\n            editing: false,\n            dragover: false,\n\n        }\n\n        this.commands = new Map();\n        this.registCommand(StartEditCommand);\n        this.registCommand(EditClickCommand);\n        this.registCommand(ShiftUpCommand);\n        this.registCommand(ShiftDownCommand);\n        this.registCommand(ShiftOnClickCommand);\n        this.registCommand(Input);\n        this.registCommand(ArrowLeftCommand);\n        this.registCommand(ArrowRightCommand);\n        this.registCommand(ArrowUpCommand);\n        this.registCommand(ArrowDownCommand);\n        this.registCommand(CtrlACommand);\n        this.registCommand(DoubleClickCommand);\n        // this.registCommand(ReturnCommand);\n        // this.registCommand(DeleteCommand);\n        this.registCommand(UndoCommand);\n        this.registCommand(RedoCommand);\n        this._makeFunctional();\n\n        this._cacheViewBox = [];\n    }\n\n    registCommand(cmd) {\n        if(!this.commands.has(cmd.name)) {\n            this.commands.set(cmd.name, cmd.create(this));\n        }\n    }\n\n    _makeFunctional() {\n        this.addEventListener('dblclick', (event) => {\n            if(event.currentTarget !== this) {\n                return\n            }\n            event.detail.bubbles = false;\n            if(this._status.editing) {\n                this.execCommand(MOUSE_COMMANDS.DOUBLE_CLICK)\n            } \n        });\n        this.addEventListener('click', (event) => {\n            if(event.currentTarget !== this) {\n                return\n            }\n            event.detail.bubbles = false;\n            let commnd;\n            if(this._status.editing) {\n                if(this._status.shiftOn) {\n                    commnd = MOUSE_COMMANDS.SHIFT_ON_CLICK\n                } else {\n                    commnd = MOUSE_COMMANDS.EDIT_CLICK\n                }\n            } else {\n                commnd = MOUSE_COMMANDS.START_EDIT\n            }\n            this.execCommand(commnd)\n        });\n\n        this.addEventListener('blur', (event) => {\n            this._status.editing = false;\n            if(this._shadowInput) {\n                this._shadowInput.destroy();\n            }\n            if(this._belongs) {\n                this._jflow._render();\n            } \n\n            this.dispatchEvent(new JFlowEvent('change', {\n                target: this,\n                textElements: this._flattenTxtElem.copy(),\n            }));\n\n            this._range.disable();\n            this._caret.cancelAnimate();\n        });\n\n        this.addEventListener('instancePressStart', (event) => {\n            if(this._status.editing && !this._status.shiftOn) {\n                event.detail.bubbles = false;\n                event.detail.preventDefault();\n                // event.detail.jflow.setMovingTargets(null);\n                const point = this._currentp;\n                const c = this._positionToCursorOffset(point);\n                // this._cursor = c;\n                const range = this._range;\n                range.setInitialRange([c.row, ...c.column]);\n                const jflow = event.detail.jflow;\n                let moved = false;\n                const t = (e => {\n                    this._status.editing = false;\n                    moved = true;\n                    const { offsetX, offsetY } = e;\n                    const p = jflow._calculatePointBack([offsetX, offsetY]);\n                    jflow._stack.checkHit(p)\n                    const point = this._currentp;\n                    const c = this._positionToCursorOffset(point);\n                    // this._cursor = c;\n                    range.setRange([c.row, ...c.column]);\n                    range.enable();\n                }).bind(this);\n\n                document.addEventListener('pointermove', t)\n                document.addEventListener('pointerup', (e) => {\n                    document.removeEventListener('pointermove', t);\n                    range.setInitialRange(null);\n                    if(!moved) {\n                        return;\n                    }\n                    range.handleCaret(this._caret)\n                    this._status.editing = true;\n                    this._shadowInput.focus();   \n                }, {\n                    once: true,\n                })\n            }\n        });\n\n        this.addEventListener('dragenter', () => {\n            this.moveCaretByHitPoint();\n            this._status.dragover = true;\n        });\n        this.addEventListener('dragover', () => {\n            this.moveCaretByHitPoint();\n        });\n        this.addEventListener('dragleave', () => {\n            this._status.dragover = false;\n        });\n\n        const onDrop = ((event) => {\n            if(!this._status.dragover) {\n                return;\n            }\n            event.detail.bubbles = false;\n            this._status.dragover = false;\n            const caret = this._caret;\n            const row = caret.getRow();\n            const column = caret.getColumn();\n            const line = this._area.get(row);\n            let [elemidx, offset] = column;\n            const element = line.get(elemidx);\n            const preElem = line.get(elemidx-1);\n            let flattenTxtElem = this._flattenTxtElem;\n            \n            let idx = flattenTxtElem.findIndex(element)\n            if(element.type !== 'text' && preElem?.type ==='text') {\n                offset = preElem.source.length;\n                idx = flattenTxtElem.findIndex(preElem)   \n            }\n\n            const lastLength = flattenTxtElem.length()\n            this.dispatchEvent(new JFlowEvent('insert', {\n                ...event.detail,\n                type: event.type,\n                textElements: flattenTxtElem.copy(),\n                idx, offset,\n            }));\n            // after insert\n            flattenTxtElem = this._flattenTxtElem;\n            if(this._status.editing) {\n                if(flattenTxtElem.length() > lastLength) {\n                    caret.setColumn([\n                        elemidx + flattenTxtElem.length() - lastLength,\n                        0\n                    ])\n                }\n                this._shadowInput.focus(); \n            }\n            if(this._status.editing) {\n                this._caret.refresh();\n            }\n            this.syncShadowInputPosition();\n            this._range.disable();\n        }).bind(this)\n        this.addEventListener('pressEnd', onDrop)\n        this.addEventListener('drop', onDrop);\n    }\n\n    toggleShift(val) {\n        this._status.shiftOn = val;\n    }\n\n    execCommand(kind) {\n        const cmd = this.commands.get(kind);\n        cmd.exec();\n    }\n\n    createShadowInput() {\n        const jflow = this._jflow;\n        this._shadowInput = new ShadowInput(jflow.DOMwrapper);\n        this._shadowInput.addEventListener(EDITOR_EVENTS.CONTROL_CMD, e => {\n            const kind = e.detail.kind;\n            this.execCommand(kind)\n        });\n\n        this._shadowInput.addEventListener(EDITOR_EVENTS.INPUT, e => {\n            const kind = e.detail.kind;\n            const data = e.detail.data;\n            const cmd = this.commands.get(EDITOR_EVENTS.INPUT);\n            cmd.exec(kind, data);\n        });\n        this._status.editing = true;\n        jflow.setFocusInstance(this);\n    }\n\n    moveCaretByHitPoint() {\n        const point = this._currentp;\n        const caret = this._caret;\n        const { row, column } = this._positionToCursorOffset(point);\n        caret.setRow(row);\n        caret.setColumn(column);\n    }\n\n    refresh() {\n        this.recalculateUp();\n        this.syncShadowInputPosition();\n        this._jflow._render();\n    }\n\n    refreshTextElements() {\n        this._flattenTxtElem = FlattenTextElements.create(this.resolver()); \n    }\n\n    _positionToCursorOffset(point) {\n        const [x, y] = point;\n        // const [x0, y0] = this.anchor;\n        const area = this._area;\n        const w = this.width/2;\n        const h = this.height/2;\n        const offsetX = x + w;\n        const offsetY = y + h;\n        const row = area.getLineAbove(offsetY)\n        const currLine = area.get(row);\n        const column = currLine.getColumnNearest(offsetX, this.elementSpace, this.fontSize, this.fontFamily);\n        return {\n            row, \n            column,\n        }\n    }\n\n    _caretToPosition() {\n        const row = this._caret.getRow();\n        const column = this._caret.getColumn();\n        const line = this._area.get(row);\n        const [elemidx, offset] = column;\n        const meta = line.get(elemidx);\n        const idx = this._flattenTxtElem.findIndex(meta);\n        const preElem = this._flattenTxtElem.get(idx-1);\n        let cw;\n        let c_len = this.currentLineHeight/2;\n        if(meta.type === 'text') {\n            const c = meta.source.substring(0, offset);\n            requestCacheCanvas((ctx) => {\n                ctx.beginPath();\n                ctx.font = `${this.fontSize} ${this.fontFamily}`;\n                cw = meta.anchorX - meta.width/2 + ctx.measureText(c).width\n            })\n        } else {\n            cw = meta.anchorX - meta.width/2\n            c_len = Math.max(c_len, meta.height/2);\n        }\n        if(offset === 0 && preElem && preElem.type !== 'text') {\n            c_len = Math.max(c_len, preElem.height/2);\n        }\n        return [cw, c_len, line.anchorY, preElem, meta]\n    }\n\n    syncShadowInputPosition() {\n        if(this._status.editing) {\n            const [cw, c_len, anchorY] = this._caretToPosition();\n            const point = this.calculateToRealWorld([cw, anchorY + c_len]);\n            const canvasMeta = this._jflow.canvasMeta;\n            const px = Math.min(canvasMeta.actual_width - 120, point[0]);\n            // return [px, point[1]];\n            this._shadowInput.syncPosition(px, point[1]);\n            this._shadowInput.focus();\n        }\n    }\n\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        } else if(this.opacity !== 1) {\n            ctx.globalAlpha = this.opacity;\n        }\n        const [cx, cy] = this.anchor;\n        const jflow = this._jflow;\n        const area = this._area;\n        ctx.translate(cx, cy);\n        // ctx.beginPath();\n        // ctx.rect(-width/2, -height/2, width, height);\n        // ctx.stroke();\n        const flattenTxtElem = this._flattenTxtElem;\n        if(flattenTxtElem.isEmpty()) {\n            ctx.beginPath();\n            ctx.font = `${this.fontWeight} ${this.fontSize} ${this.fontFamily}`;\n            ctx.textAlign = 'center';\n            ctx.textBaseline = 'middle';\n            ctx.fillStyle = this.placeholderColor;\n            ctx.fillText(this.placeholder, 0, 0);\n\n            this._randerCursor(ctx);\n\n            ctx.translate(-cx, -cy);\n            ctx.restore();\n            return;\n        }\n\n        ctx.beginPath();\n        ctx.font = `${this.fontWeight} ${this.fontSize} ${this.fontFamily}`;\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillStyle = this.textColor;\n        area.forEach(line => {\n            line.forEach(el => {\n                if(el.type === 'text') {\n                    ctx.fillText(el.source, el.anchorX, el.anchorY)\n                } \n            })\n        })\n        flattenTxtElem.forEach(elem => {\n            if(elem.type !== 'text') {\n                const instance = jflow.getRenderNodeBySource(elem.source);\n                if(instance.visible) {\n                    ctx.save();\n                    instance.render(ctx);\n                    ctx.restore();\n                }\n            }\n        })\n\n        this._randerCursor(ctx);\n        this._renderRange(ctx);\n        ctx.translate(-cx, -cy);\n        ctx.restore();\n    }\n\n    _randerCursor(ctx) {\n        if(this._caret.isShow() && (this._status.editing || this._status.dragover)) {\n            const [cw, c_len, anchorY] = this._caretToPosition();\n            ctx.beginPath();\n            ctx.moveTo(cw, anchorY - c_len);\n            ctx.lineTo(cw, anchorY + c_len);\n            ctx.lineWidth = 2;\n            ctx.strokeStyle = this.cursorColor;\n            ctx.stroke();\n        }\n    }\n\n    _renderRange(ctx) {\n        const range = this._range;\n        if(range.isEnable()) {\n            const area = this._area;\n            const textRangeColor = this.textRangeColor;\n            const blockheight = this.height;\n            const blockwidth = this.width;\n            const lineSpace = this.lineSpace;\n            const [r_f, idx_f, offset_f] = range.getRangeFrom();\n            const [r_t, idx_t, offset_t] = range.getRangeTo();\n            if(r_f === r_t) {\n                if(idx_f === idx_t && offset_f == offset_t) {\n                    return;\n                }\n                const line = area.get(r_f);\n                let space = (r_f === area.length()-1 ? 0 : lineSpace);\n                const lty = line.reduceHeight - space - line.height - blockheight/2;\n                const height = line.height;\n                const x1 = this._measureElementOffsetX(line.get(idx_f), offset_f, ctx);\n                const x2 = this._measureElementOffsetX(line.get(idx_t), offset_t, ctx);\n                ctx.beginPath();\n                ctx.rect(x1, lty , x2 - x1, height);\n                ctx.fillStyle = textRangeColor\n                ctx.fill();\n            } else {\n                let _r = r_f;\n                let beginning = true;\n                while(_r <= r_t) {\n                    const line = area.get(_r);\n                    let space = (_r === area.length()-1 ? 0 : lineSpace);\n                    const lty = line.reduceHeight - space - line.height - blockheight/2;\n                    const height = line.height;\n    \n                    if(beginning) {\n                        const elem = line.get(idx_f);\n                        const x = this._measureElementOffsetX(elem, offset_f, ctx);\n                        const lastElem = line.tail();\n                        const t = lastElem.anchorX + lastElem.width/2;\n    \n                        ctx.beginPath();\n                        ctx.rect(x, lty, t - x, height);\n                        ctx.fillStyle = textRangeColor\n                        ctx.fill();\n                    } else if(_r === r_t){\n                        const elem = line.get(idx_t);\n                        const x = this._measureElementOffsetX(elem, offset_t, ctx);\n                        ctx.beginPath();\n                        ctx.rect(-blockwidth/2, lty , elem.reduceWidth + (x - elem.anchorX + elem.width/2), height);\n                        ctx.fillStyle = textRangeColor\n                        ctx.fill();\n                    } else {\n                        ctx.beginPath();\n                        ctx.rect(-blockwidth/2, lty, line.width, height);\n                        ctx.fillStyle = textRangeColor\n                        ctx.fill();\n                    }\n                    \n                    beginning = false;\n                    _r++;\n                }\n            }\n        }\n    }\n\n    _measureElementOffsetX(element, offset, ctx) {\n        if(element.type !== 'text' || offset === 0){\n            return element.anchorX - element.width/2;\n        }\n        return element.anchorX - element.width/2 + ctx.measureText(element.source.substring(0, offset)).width;\n    }\n\n    measureTextWidth(content) {\n        let t;\n        requestCacheCanvas((ctx) => {\n            ctx.font = `${this.fontSize} ${this.fontFamily}`;\n            t = ctx.measureText(content).width;\n        });\n        return t;\n    }\n\n    getBoundingDimension() {\n        return {\n            width: this.width,\n            height: this.height,\n        } \n    }\n\n    getBoundingRect() {\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        const ltx = anchor[0] - w;\n        const lty = anchor[1] - h;\n        const rbx = anchor[0] + w;\n        const rby = anchor[1] + h;\n        const br = this._boundingrect;\n        br[0] = ltx;\n        br[1] = lty;\n        br[2] = rbx;\n        br[3] = rby;\n        return br\n    }\n\n    _getViewBox() {\n        const belongs_vbox = this._belongs.getCacheViewBox();\n        const cacheViewBox = this._cacheViewBox;\n        \n        this._calculatePointBackWithPoint(belongs_vbox[0], belongs_vbox[1], cacheViewBox, 0, 1);\n        this._calculatePointBackWithPoint(belongs_vbox[2], belongs_vbox[3], cacheViewBox, 2, 3);\n        return this._cacheViewBox;\n    }\n    \n    getCacheViewBox() {\n        return this._cacheViewBox;\n    }\n\n    calculateToCoordination(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this.anchor;\n        // const p = [cx + anchor[0] - spanH, cy + anchor[1] - spanV];\n        const p = [gx + cx, gy + cy]\n        if(this._belongs && this._belongs.calculateToCoordination) {\n            return this._belongs.calculateToCoordination(p);\n        } else {\n            return p;\n        }\n    }\n\n    calculateToRealWorld(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this.anchor;\n        const p = [gx + cx, gy + cy]\n        if(this._belongs && this._belongs.calculateToRealWorld) {\n            return this._belongs.calculateToRealWorld(p);\n        }\n    }\n\n    _calculatePointBack(point) {\n        const [gx, gy] = point;\n        const [cx, cy] = this.anchor;\n        const p = [gx - cx, gy - cy]\n        return p\n    }\n\n    _calculatePointBackWithPoint(a, b, arr, idx1, idx2) {\n        arr[idx1] = a - this.anchor[0];\n        arr[idx2] = b - this.anchor[1];\n    }\n\n    isHit(point, condition) {\n        const p = this._calculatePointBack(point);\n        const jflow = this._jflow;\n        this._currentp = p; // 暂存，为了后续计算别的位置\n        let validInstance = [];\n        const flattenTxtElem = this._flattenTxtElem;\n        flattenTxtElem.forEach(elem => {\n            if(elem.type !== 'text') {\n                const instance = jflow.getRenderNodeBySource(elem.source);\n                if(instance.visible) {\n                    validInstance.push(instance);\n                }\n            }\n        })\n        const target = this._stack.checkHit(p, condition, (i) => validInstance.includes(i));\n        \n        if(target) return target;\n\n        const anchor = this.anchor;\n        const w = this.width /2;\n        const h = this.height/2;\n        return point[0] > anchor[0] - w\n            && point[0] < anchor[0] + w\n            && point[1] > anchor[1] - h\n            && point[1] < anchor[1] + h;\n    }\n\n    clone() {\n        const t = new ShadowCache({\n            width: this.width,\n            height: this.height,\n            cache: (ctx) => {\n                const [cx, cy] = this.anchor;\n                ctx.translate(-cx + this.width/2, -cy + this.height/2);\n                this.render(ctx);\n            }\n        })\n\n        return t;\n    }\n\n    destroy() {\n        if(this._jflow._focus.instance === this) {\n            this._jflow.blur();\n        }\n    }\n}\n\nObject.assign(TextGroup.prototype, StackMixin);\nObject.assign(TextGroup.prototype, LayoutMixin);\nObject.assign(TextGroup.prototype, {\n        // 屏蔽这两个方法，只根据reflow重算\n    _getBoundingGroupRect() {},\n    resetChildrenPosition() {},\n    reflow() {\n        let lineHeight = this.currentLineHeight;\n        const flattenTxtElem = this._flattenTxtElem;\n        const area = this._area;\n        if(flattenTxtElem.isEmpty()) {\n            let width = 0;\n            const t = flattenTxtElem.get(0);\n            requestCacheCanvas((ctx) => {\n                ctx.font = `${this.fontSize} ${this.fontFamily}`;\n                width = ctx.measureText(this.placeholder).width;\n            });\n            const line = area.truncate({\n                height: lineHeight,\n                reduceHeight: lineHeight,\n            });\n            line.insert(0, t);\n            Object.assign(t, {\n                anchorX: -width/2,\n                height: lineHeight,\n                isTail: true,\n            })\n            this.width = width;\n            this.height = lineHeight;\n            return;\n        }\n        const jflow = this._jflow;\n        requestCacheCanvas((ctx) => {\n            ctx.font = `${this.fontSize} ${this.fontFamily}`;\n            flattenTxtElem.forEach(element => {\n                if(element.type === 'text' && element.dirty) {\n                    element.width = ctx.measureText(element.source).width;\n                    element.dirty = false;\n                }\n            });\n        });\n        const nextArea = new Area();\n        nextArea.truncate({\n            height: lineHeight,\n        });\n        let line = nextArea.get(0);\n        let allHeight = 0;\n        let allWidth = 0;\n        let lastElem = null;\n        const lineSpace = this.lineSpace;\n        const elementSpace = this.elementSpace;\n        flattenTxtElem.forEach(element => {\n            line.push(element);\n            element.reduceWidth = line.width;\n            if(element.type === 'text') {\n                element.height = lineHeight;\n                line.width += element.width;\n                if(element.needWrap){\n                    allHeight += (line.height + lineSpace);\n                    line.reduceHeight = allHeight;\n                    allWidth = Math.max(line.width, allWidth);\n                    line = Line.create({\n                        height: lineHeight,\n                    });\n                    nextArea.push(line);\n                }\n            } else {\n                const node = jflow.getRenderNodeBySource(element.source);\n                element.height = node.height;\n                line.height = Math.max(line.height, node.height);\n                const margin = (!lastElem || lastElem.type === 'text') ? elementSpace*2 : elementSpace;\n                line.width += node.width+margin;\n            }\n            lastElem = element;\n        });\n\n        flattenTxtElem.tail().isTail = true;\n        allHeight += line.height\n        line.reduceHeight = allHeight;\n        allWidth = Math.max(this.minWidth, Math.max(line.width, allWidth));\n        \n        const hh = allHeight/2;\n        const hw = allWidth/2;\n        let ty = -hh;\n        let lastReduceY = 0;\n\n        nextArea.forEach(l => {\n            const { height, reduceHeight } = l;\n            const anchorY = ty + lastReduceY + height / 2;\n            l.anchorY = anchorY;\n            let reduceX = -hw;\n            let lastel = null;\n            l.forEach(el => {\n                if(el.type === 'text') {\n                    el.anchorY = anchorY;\n                    el.anchorX = reduceX + el.width/2;\n                    reduceX += el.width;\n                } else {\n                    const renderNode = jflow.getRenderNodeBySource(el.source);\n                    const doubleMargin = (!lastel || lastel.type === 'text');\n                    const margin = doubleMargin ? elementSpace*2 : elementSpace;\n                    el.width = renderNode.width;\n                    el.anchorY = anchorY;\n                    el.anchorX = reduceX + el.width/2 + (doubleMargin ? margin/2 : 0);\n                    renderNode.anchor = [el.anchorX, el.anchorY];\n                    reduceX += (el.width + margin);\n                }\n                lastel = el;\n            })\n            lastReduceY = reduceHeight;\n        });\n        this._area = nextArea;\n        this.width = allWidth;\n        this.height = allHeight;\n    }\n})\nexport default TextGroup;\n","import Rectangle from './shapes/rectangle';\nimport { DIRECTION } from '../utils/constance';\nimport { requestCacheCanvas } from '../utils/canvas';\nimport JFlowEvent from '../events';\nfunction createInputElement() {\n    const input = document.createElement('span');\n    input.setAttribute('contenteditable', true);\n    input.setAttribute('class', 'jfloweditablespan')\n    input.setAttribute('style',`\n        position: absolute;\n        left: 0;\n        top: 0;\n        border:none;\n        background-image:none;\n        background-color:transparent;\n        -webkit-box-shadow: none;\n        -moz-box-shadow: none;\n        box-shadow: none;`);\n    return input;\n}\n\nexport function createInputTextStyle() {\n    const css = `.jfloweditablespan[contenteditable=true]:empty:before{\n        content: attr(placeholder);\n        opacity: 0.5;\n        pointer-events: none;\n        display: block; \n      }`;\n    const head = document.head || document.getElementsByTagName('head')[0];\n    const style = document.createElement('style');\n\n    head.appendChild(style);\n    style.type = 'text/css';\n    if (style.styleSheet){\n        // This is required for IE8 and below.\n        style.styleSheet.cssText = css;\n    } else {\n        style.appendChild(document.createTextNode(css));\n    }\n}\n/**\n * 文字对齐方式\n * @readonly\n * @enum {string}\n */\nconst TEXT_ALIGN = {\n    CENTER: 'center',\n    LEFT: 'left',\n    RIGHT: 'right',\n};\n/**\n * 文字单元 配置\n * @typedef {Rectangle~RectangleConfigs} Text~TextConfigs\n * @property {String} fontFamily    - 字体\n * @property {Number} fontSize      - 字号\n * @property {String} content       - 内容\n * @property {String} textColor     - 字体颜色\n * @property {TEXT_ALIGN} textAlign     - 文字对齐方式\n * @property {String} backgroundColor     - 背景颜色\n * @property {number} lineHeight    - 行高\n * @property {number} indent        - 缩进\n * @property {Boolean} editable      - 是否可编辑\n * @property {number} minWidth      - 最小宽度\n * @property {string} placeholder   - 占位文字\n * @property {Boolean} emptyWhenInput - 输入状态时是否清空input框\n */\n/**\n * 文字对象\n * @description 可以绘制文字\n * @constructor Text\n * @extends Rectangle\n * @param {Text~TextConfigs} configs - 配置\n */\nclass Text extends Rectangle {\n    constructor(configs) {\n        super(configs);\n        this.type =             'Text';\n        /** @member {String}      - 内容 */\n        this.content =          configs.content || '';\n        /** @member {String}      - 字体 */\n        this.fontFamily =       configs.fontFamily || '-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Tahoma,Arial,Noto Sans,PingFang SC,Microsoft YaHei,Hiragino Sans GB,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji'\n        /** @member {String}      - 字号 */\n        this.fontSize =         configs.fontSize || '28px';\n        /** @member {String}      - 字体 */\n        this.fontWeight =       configs.fontWeight || '';\n        /** @member {String}      - 字体颜色 */\n        this.textColor =        configs.textColor || 'white';\n        this.placeholderColor = configs.placeholderColor ||  configs.textColor || 'white';\n        /** @member {String}      - 文字对齐方式 */\n        this.textAlign =        configs.textAlign || TEXT_ALIGN.CENTER;\n        /** @member {String}      - 文字基线方式 */\n        this.textBaseline =     configs.textBaseline || 'middle';\n        /** @member {Number}      - 行高 */\n        this.lineHeight =       configs.lineHeight ;\n        /** @member {Number}      - 缩进 */\n        this.indent =           configs.indent || 0;\n        this.backgroundColor =  configs.backgroundColor;\n        /** @member {Boolean}      - 是否可编辑 */\n        this.editable =         configs.editable;\n        // this.acceptPatten =     configs.acceptPatten;\n        /** @member {number}      - 最小宽度 */\n        this.minWidth =         configs.minWidth || 0;\n        this.maxWidth =         configs.maxWidth;\n        this.ellipsis =         configs.ellipsis;\n\n        this.placeholder =          configs.placeholder || '';\n        this.emptyWhenInput =       configs.emptyWhenInput || false;\n        this.editting =  false;\n        this.disabled =        configs.disabled;\n        this.textBuffer = document.createElement('canvas');\n        requestCacheCanvas((ctx) => {\n            this.renderShadowText(ctx);\n            this.cacheText();\n        });\n        this._makeEditable();\n    }\n\n    get currentContent() {\n        return this.content || this.placeholder;\n    }\n\n    get isEmpty() {\n        return !this.content;\n    }\n\n    cacheText() {\n        const scale = 4;\n        const textBuffer = this.textBuffer;\n        const { fontSize:fs, fontFamily, fontWeight } = this;\n        let content = this.currentContent;\n        if(this.ellipsisContent) {\n            content = this.ellipsisContent;\n        }\n        if(!content) {\n            this.cacheTextBounding = null;\n            return;\n        }\n        const fontSize = parseInt(fs);\n        const w = this._textWidth * scale;\n        const h = fontSize * scale;\n        textBuffer.width = w;\n        textBuffer.height = h\n        const ctx = textBuffer.getContext('2d');\n        ctx.clearRect(-1000, -1000, 10000, 10000);\n        ctx.fillStyle = this.textColor;\n        ctx.font = `${fontWeight} ${h}px ${fontFamily}`;\n        ctx.textBaseline = 'middle';\n        ctx.fillText(content, 0, h/2);\n        this.cacheTextBounding = [0, 0, w, h];\n    }\n    _renderCache(ctx) {\n        if(!this.cacheTextBounding) {\n            return;\n        }\n        const [a, b, c, d] = this.cacheTextBounding;\n        const w = this._textWidth;\n        const h = parseInt(this.fontSize);\n        if(this.textAlign === TEXT_ALIGN.LEFT){\n            const hw = this.width / 2;\n            ctx.drawImage(this.textBuffer, \n                a, b, c, d,\n                this.anchor[0] - hw + this.indent / 2, this.anchor[1] - h/2, w, h);\n        } else if(this.textAlign === TEXT_ALIGN.RIGHT) {\n            const hw = this.width / 2;\n            const tx = this._textWidth;\n            ctx.drawImage(this.textBuffer, \n                a, b, c, d,\n                this.anchor[0] + hw - tx, this.anchor[1] - h/2, w, h);\n        } else {\n            const tx = this._textWidth / 2;\n            ctx.drawImage(this.textBuffer, \n                a, b, c, d,\n                this.anchor[0] - tx + this.indent / 2, this.anchor[1] - h/2, w, h);\n        }\n        \n    }\n\n    /**\n     * 编辑态\n     */\n    _makeEditable() {\n        if(this.editable) {\n            this.addEventListener('click', (event) => {\n                event.detail.bubbles = false;\n                this.click();\n            })\n        }\n    }\n\n    calculateInputElementPos() {\n        let x;\n        const hw = this.width / 2;\n        const _height = this.height * 1.15;\n        if(this.textAlign === TEXT_ALIGN.LEFT){\n            x = this.anchor[0] - hw + this.indent / 2;\n        } else if(this.textAlign === TEXT_ALIGN.RIGHT) {\n            x = this.anchor[0] + hw;\n        } else {\n            x = this.anchor[0] + this.indent / 2;\n        }\n\n        const p = [ x, this.anchor[1]-_height/2 ];\n\n        return this.calculateToRealWorld(p)\n    }\n\n    click() {\n        if(this.disabled || !this.editable) {\n            return;\n        }\n       \n        const _height = this.height * 1.15;\n        const size = this.calculateToRealWorldWithScalar(_height);\n        const fontSize = +/(\\d+)/.exec(this.fontSize)[1];\n\n        const [offsetX, offsetY] = this.calculateInputElementPos();\n        let inputElement = createInputElement();\n        const jflow = this._jflow;\n        const wrapper = jflow.DOMwrapper;\n        let oldVal = this.content;\n        let textColor = this.textColor;\n        inputElement.setAttribute('placeholder', this.placeholder);\n        inputElement.style.margin = 0;\n        inputElement.style.padding = 0;\n        inputElement.style.transform =`translate(${offsetX}px, ${offsetY}px)`;\n        \n        // inputElement.style.width = this.calculateToRealWorldWithScalar(this.width) + 'px';\n        inputElement.style.height =  size+ 'px';\n        inputElement.style.fontFamily = this.fontFamily;\n        wrapper.style.fontSize = `${fontSize * jflow.scale}px`;\n        // inputElement.style.letterSpacing = jflow.scale;\n        inputElement.style.fontSize = `${fontSize * jflow.scale}px`;\n        inputElement.style.lineHeight = `${this.lineHeight * jflow.scale}px`;\n        inputElement.style.textIndent = `${this.indent * jflow.scale}px`;\n        inputElement.innerText = this.emptyWhenInput ? '' : this.content;\n        inputElement.style.color = this.textColor;\n        inputElement.style.whiteSpace = 'nowrap';\n        inputElement.style.outline = \"none\";\n        inputElement.style.paddingRight = '1em';\n        inputElement.style.letterSpacing = `${(1.414 + 0.181) / (1 + Math.pow(jflow.scale / 1.81, -3.56) ) - 0.181}px`;\n        inputElement.setAttribute('placeholder', this.placeholder);\n\n        // inputElement.addEventListener(\"focus\",  (e) => {\n        //     // e.preventDefault();\n        //     // this.content = '';\n            \n            \n        // });\n        let blurHandler = () => {\n            this.editting = false;\n            this.dispatchEvent(new JFlowEvent('blur', {\n                target: this,\n            }))\n            const val = inputElement.innerText;\n            /**\n                * 文字改变事件\n                * @event Text#change\n                * @type {object}\n                * @property {Text} target           - 当前文字对象\n                * @property {String} oldVal         - 原始文字\n                * @property {String} val            - 当前文字\n                */\n            this.dispatchEvent(new JFlowEvent('change', {\n                target: this,\n                oldVal,\n                val,\n            }))\n            this.textColor = textColor;\n            if(this._belongs.recalculateUp) {\n                this._belongs.recalculateUp()\n            }\n            // this.content = oldVal;\n            jflow._render();\n            jflow.removeEventListener('zoompan', blurHandler)\n            inputElement.removeEventListener('focusout', blurHandler)\n            inputElement.removeEventListener('keypress', keyUpHandler)\n            wrapper.removeChild(inputElement);\n            inputElement = null;\n            blurHandler = null;\n            this.inputElement = null;\n        };\n        jflow.addEventListener('zoompan', blurHandler);\n        inputElement.addEventListener('focusout', blurHandler);\n        const keyUpHandler = (e) => {\n            if (e.key === 'Enter' || e.keyCode === 13) {\n                e.preventDefault();\n                let defaultAct = true;\n                this.dispatchEvent(new JFlowEvent('enterkeypressed', {\n                    target: this,\n                    handler: (val) => {\n                        defaultAct = val;\n                    },\n                }))\n                if(defaultAct){\n                    inputElement.removeEventListener('keypress', keyUpHandler)\n                    blurHandler();\n                }\n            }\n        };\n        inputElement.addEventListener('keypress', keyUpHandler)\n        inputElement.addEventListener('input', (e) => {\n            // let changed = false;\n            const val = inputElement.innerText;\n            this.dispatchEvent(new JFlowEvent('input', {\n                target: this,\n                oldVal,\n                val,\n                // handler(val) {\n                //     oldVal = val;\n                //     inputElement.innerText = val;\n                //     changed = true;\n                // }\n            }));\n            requestCacheCanvas((ctx) => {\n                this.content = inputElement.innerText;\n                this.renderShadowText(ctx);\n            });\n            if(this._belongs.recalculateUp) {\n                this._belongs.recalculateUp()\n            }\n            const [offsetX, offsetY] = this.calculateInputElementPos();\n            inputElement.style.transform =`translate(${offsetX}px, ${offsetY}px)`;\n            \n            this._jflow.scheduleRender();\n            // inputElement.style.width = e.target.value.length + \"em\";\n            // if(!changed) {\n            //     oldVal = inputElement.innerText;\n            // }\n        })\n        this.textColor = 'transparent'\n        this.editting = true;\n        jflow._render();\n        wrapper.append(inputElement);\n        inputElement.focus({\n            preventScroll: true\n        });\n        if(inputElement.firstChild) {\n            const range = document.createRange()\n            const sel = window.getSelection()\n            \n            range.setStart(inputElement.firstChild, inputElement.innerText.length)\n            range.collapse(true)\n            \n            sel.removeAllRanges()\n            sel.addRange(range)\n        }\n        \n        this.inputElement = inputElement;\n        inputElement._jflowInstance = this;\n    }\n\n    renderShadowText(ctx) {\n        ctx.beginPath();\n        ctx.font = `${this.fontSize} ${this.fontFamily}`;\n        ctx.textAlign = this.textAlign;\n        ctx.textBaseline = this.textBaseline;\n        ctx.fillStyle = this.textColor;\n        const t_h = parseInt(this.fontSize);\n        const content = this.currentContent;\n        const {\n            // actualBoundingBoxLeft,\n            // actualBoundingBoxRight,\n            fontBoundingBoxAscent,\n            fontBoundingBoxDescent,\n            width,\n        } = ctx.measureText(content);\n        this._textWidth = this.indent + width;\n        if(this.maxWidth && this.ellipsis) {\n            if(this._textWidth > this.maxWidth) {\n                const ratio =this.maxWidth / this._textWidth;\n                const l = Math.floor(content.length * ratio - 3);\n                this.ellipsisContent = content.substring(0, l) + '...'; \n            }  else {\n                this.ellipsisContent = content;\n            }\n            this.width = this.maxWidth;\n        } else{ \n            this.width = Math.max(this.minWidth, this._textWidth);\n        }\n        \n        const height = (Math.abs(fontBoundingBoxAscent) + Math.abs(fontBoundingBoxDescent)) || t_h;\n        if(this.lineHeight) {\n            this.height = this.lineHeight;\n        } else {\n            this.height = height;\n        }\n\n    }\n\n    setConfig(configs) {\n        Object.keys(configs).forEach(k => {\n            if(configs[k] !== undefined && configs[k] !== null) {\n                // if(this.editting && k === 'content') {\n                //     return;\n                // }\n                this[k] = configs[k];\n                this._rawConfigs[k] = configs[k];\n            }\n        });\n        requestCacheCanvas((ctx) => {\n            this.renderShadowText(ctx);\n            this.cacheText();\n        });\n    }\n\n    render(ctx) {\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        if(this.editting) {\n            return;\n        }\n        if(!ctx.disableCache && this._jflow.scale * parseInt(this.fontSize) < 8) {\n            this._renderCache(ctx);\n            return;\n        }\n        ctx.beginPath();\n        \n        ctx.font = `${this.fontWeight} ${this.fontSize} ${this.fontFamily}`;\n        ctx.textAlign = this.textAlign;\n        ctx.textBaseline = this.textBaseline;\n        ctx.fillStyle = this.isEmpty ? this.placeholderColor : this.textColor;\n        let content = this.currentContent;\n        if(this.ellipsisContent) {\n            content = this.ellipsisContent;\n        }\n        if(content) {\n            if(this.textAlign === TEXT_ALIGN.LEFT){\n                const hw = this.width / 2;\n                ctx.fillText(content, this.anchor[0] - hw + this.indent / 2, this.anchor[1]);\n            } else if(this.textAlign === TEXT_ALIGN.RIGHT) {\n                const hw = this.width / 2;\n                ctx.fillText(content, this.anchor[0] + hw, this.anchor[1]);\n            } else {\n                ctx.fillText(content, this.anchor[0] + this.indent / 2, this.anchor[1]);\n            }\n        }\n    }\n}\n\nexport default Text;","import { createCanvas, resizeCanvas, listenOnDevicePixelRatio } from '../utils/canvas';\nimport { bounding_box, doOverlap, debounce } from '../utils/functions';\nimport { JFLOW_MODE } from '../utils/constance';\nimport GhostNode from '../instance/ghostNode';\nimport { NodeWeakMapMixin } from '../instance/nodeWeakMap';\nimport StackMixin from '../instance/stackMixin';\nimport LayoutMixin from '../instance/layoutMixin';\nimport MessageMixin from '../instance/messageMixin';\nimport AnimeMixin from '../anime/animeMixin';\nimport MiniMapMixin from '../miniMap/minimap-mixin';\nimport ScrollBarMixin from '../scrollbar/scrollbarMixin';\nimport ScheduleMixin from './schedule';\n// import { setUniqueId, getUniqueId } from '../utils/functions';\nimport JFlowEvent from '../events';\n\nimport EventAdapter from '../events/adapter';\n\nimport GroupFactory from '../instance/groupFactory';\nimport Point from '../instance/shapes/point';\nimport Rectangle from '../instance/shapes/rectangle';\nimport Capsule from '../instance/shapes/capsule';\nimport CapsuleVertical from '../instance/shapes/capsule-vertical';\nimport Rhombus from '../instance/shapes/rhombus';\nimport Diamond from '../instance/shapes/diamond';\nimport DiamondVertical from '../instance/shapes/diamond-vertical';\nimport { createInputTextStyle } from '../instance/text';\ncreateInputTextStyle();\n/**\n * @funtion setInitialPosition\n * @param {Number} RealboxX - 内容映射到canvas上的 X\n * @param {Number} RealboxY - 内容映射到canvas上的 Y \n * @param {Number} RealboxW - 内容映射到canvas上的宽度\n * @param {Number} RealboxH - 内容映射到canvas上的高度 \n * @param {Number} CanvasWidth  - 视窗宽度\n * @param {Number} CanvasHeight  - 视窗高度\n * @return {Object} - 初始位置 { x, y }\n */\n\n/**\n * @funtion linkGen\n * @param {Node} from - 出发绘图节点\n * @param {Node} to - 临时节点，当前鼠标指的地方\n * @return {BaseeLink} - 连线对象\n */\n\n\n/** \n * @class Group\n * @classdesc 矩形组单元 由 {@link GroupFactory} 通过 {@link Rectangle} 生成\n * @groupfrom Rectangle\n * @augments GroupTemplate\n * @augments Rectangle\n * @param {(Rectangle~RectangleConfigs|GroupTemplate~GroupConfigs)} configs - 配置\n */\nexport const Group = GroupFactory(Rectangle);\n/** \n * @class CapsuleGroup\n * @classdesc 胶囊组单元 由 {@link GroupFactory} 通过 {@link Capsule} 生成\n * @groupfrom Capsule\n * @augments GroupTemplate\n * @augments Capsule\n * @param {(Capsule~CapsuleConfigs|GroupTemplate~GroupConfigs)} configs - 配置\n */\nexport const CapsuleGroup = GroupFactory(Capsule);\n/** \n * @class RhombusGroup\n * @classdesc 菱形组单元 由 {@link GroupFactory} 通过 {@link Rhombus} 生成\n * @augments GroupTemplate\n * @augments Rhombus\n * @groupfrom Rhombus\n * @param {(Rhombus~RhombusConfigs|GroupTemplate~GroupConfigs)} configs - 配置\n */\nexport const RhombusGroup = GroupFactory(Rhombus);\n/** \n * @class DiamondGroup\n * @classdesc 钻石形组单元 由 {@link GroupFactory} 通过 {@link Diamond} 生成\n * @groupfrom Diamond\n * @augments GroupTemplate\n * @augments Diamond\n * @param {(Diamond~DiamondConfigs|GroupTemplate~GroupConfigs)} configs - 配置\n */\nexport const DiamondGroup = GroupFactory(Diamond, {\n    shapeShift(width, height) {\n        return [width + height * 0.28865, height]\n    }\n});\n/** \n * @class DiamondVerticalGroup\n * @classdesc 垂直钻石形组单元 由 {@link GroupFactory} 通过 {@link DiamondVertical} 生成\n * @groupfrom DiamondVertical\n * @augments GroupTemplate\n * @augments DiamondVertical\n * @param {(Diamond~DiamondConfigs|GroupTemplate~GroupConfigs)} configs - 配置\n */\nexport const DiamondVerticalGroup = GroupFactory(DiamondVertical, {\n    shapeShift(width, height) {\n        return [width, height + width * 0.5773]\n    }\n});\n/** \n * @class CapsuleVerticalGroup\n * @classdesc 垂直钻石形组单元 由 {@link GroupFactory} 通过 {@link CapsuleVertical} 生成\n * @groupfrom CapsuleVertical\n * @augments GroupTemplate\n * @augments CapsuleVertical\n * @param {(Capsule~CapsuleConfigs|GroupTemplate~GroupConfigs)} configs - 配置\n */\nexport const CapsuleVerticalGroup = GroupFactory(CapsuleVertical);\n\nexport const PointGroup = GroupFactory(Point, {\n    shapeShift(width, height, p) {\n        const r = Math.ceil(Math.sqrt(width * width + height * height) / 2);\n        p.radius = r;\n        const w = r * 2;\n        return [w, w];\n    }\n});\n\nexport { default as ScrollGroup } from '../instance/groups/scroll-group'; \n/**\n * @typedef JFlow~JFlowConfigs\n * @type {object}\n * @property {Boolean} allowDrop      - 是否允许 dragdrop\n * @property {Number} maxZoom         - 最大缩放\n * @property {Number} minZoom         - 最小缩放\n * @property {number} initialZoom     - 初始缩放比\n * @property {EventAdapter~pluginDef} eventAdapter\n */\n\n/**\n * @typedef {JFlow~JFlowConfigs | LayoutMixin~LayoutConfigs} JFlow~JFlowLayoutConfigs\n */\n/** \n * JFlow 对象\n * JFlow 是 canvas 上面封装的一个顶层对象，具有处理事件和绘制的功能\n * @constructor JFlow\n * @param {JFlow~JFlowLayoutConfigs} configs - 配置项\n * @mixes LayoutMixin\n * @mixes StackMixin\n * @mixes MessageMixin\n */\nclass JFlow extends EventTarget{\n    constructor(configs) {\n        super();\n        this.uniqueName = 'jflow';\n        /**\n         * @member {EventAdapter} eventAdapter    - eventAdapter 对象\n         **/\n        this.eventAdapter = new EventAdapter(configs.eventAdapter);\n        this.initNodeWeakMap();\n        this.initAnime();\n        this.initStack(configs);\n        this.initLayout(configs);\n        /** @member {Context2d}     - Context2d 对象 */\n        this.ctx = null;\n        /** @member {Element}       - canvas 元素 */\n        this.canvas = null;\n        /** @member {number}       - 设备DPR */\n        this.dpr = 1;\n        /** @member {number}       - 内边距 */\n        this.padding = 20;\n        this.position = null;\n        /** @member {number}     - 缩放 */\n\t\tthis.scale = null;\n        /** @member {number}     - 初始缩放 */\n        this.initialZoom = configs.initialZoom;\n        /** @member {setInitialPosition} - 初始位置计算 */\n        this.initialPosition = configs.setInitialPosition;\n        /** @member {number}     - 最大缩放 */\n        this.maxZoom = configs.maxZoom || 3;\n        /** @member {number}     - 最小缩放 */\n        this.minZoom = configs.minZoom || .5;\n        \n        this.NodeRenderTop = !!configs.NodeRenderTop\n\n        this.worldMargin = configs.worldMargin;\n\n        this.draggingbehavior = Object.assign({\n            panInBorder: {\n                enable: true,\n                padding: 20,\n                deltamovement: 8,\n                allowMovingTargetInPan: true,\n            },\n        }, configs.draggingbehavior || {});\n        this.scrollBarBehavior = Object.assign({\n            enable: true,\n        }, configs.scrollBarBehavior || {})\n\t\t// this.initScale = 1;\n\t\t// this.initPosition = null\n\t\tthis.offeset = null;\n        this._lastState = {\n            x: null,\n            y: null,\n            dragging: false,\n            processing: false\n        };\n        this._lastDragState = {\n            target: null,\n            targetLink: null,\n            processing: false,\n        }\n\n        this._target = {\n            instance: null,\n            link: null,\n            moving: null,\n            isInstanceDirty: false, \n            isLinkDirty: false, \n            // isMovingDirty: false, \n            cache: {\n                stack: null,\n                belongs: null,\n                point: null,\n            },\n            meta: {\n                x: undefined,\n                y: undefined,\n                initialX: undefined,\n                initialY: undefined, \n            },\n            status: {\n                dragovering: false,\n                dragging: false,\n                processing: false,\n                movingState: false,\n            }\n        }\n\n        this._focus = {\n            instance: null,\n        }\n\n        this._dragOverTarget = null;\n        // this.lock = configs.lock;\n\n        this.allowDrop = configs.allowDrop;\n        // 临时绘制的对象\n        this._tempNode = null;\n        this._tempLink = null;\n\n        this.mode = JFLOW_MODE.DEFAULT;\n\n        this._allowMovingTarget = true;\n\n        this.canvasMeta = {}\n\n        this._cacheViewBox = []\n\n        // this._allowZoom = true;\n    }\n\n    // allowZoom() {\n    //     this._allowZoom = true;\n    // }\n\n    // abandonZoom() {\n    //     this._allowZoom = false;\n    // }\n    /**\n     * 设置当前拖动的 JFlow 对象\n     * @param {Object[]} targets - 具有 anchor 属性的对象\n     */\n    setMovingTargets(targets) {\n        Object.assign(this._target, {\n            moving: targets,       \n        })\n    }\n\n    /**\n     * 设置当前拖动的 JFlow 对象\n     * @param {Instance} instance - JFlow 对象\n     */\n    setTempDraggingInstance(instance) {\n        instance._belongs = this;\n        this._tempNode = instance;\n        Object.assign(this._target, {\n            moving: [this._tempNode],\n            dragging: true,\n        })\n    }\n\n    /**\n     * 取消当前拖动的 JFlow 对象\n     * @return {number[]} point - JFlow 坐标\n     */\n    removeTempDraggingInstance() {\n        if(this._tempNode) {\n            // this.removeFromStack(this._tempNode);\n            const anchor = this._tempNode.anchor;\n            this._tempNode = null;\n            return anchor;\n        }\n    }\n    /**\n     * 关闭默认对象拖动效果\n     */\n    preventDefaultDragging() {\n        this._allowMovingTarget = false;\n    }\n    /**\n     * 开启默认对象拖动效果\n     */\n    allowDefaultDragging() {\n        this._allowMovingTarget = true;\n    }\n    /**\n     * 在 Document 元素上初始化实例\n     * @param {Element} dom \n     */\n    $mount(dom) {\n        const { \n            canvas, \n            ctx, \n            scale: dpr, \n            width: c_width, \n            height: c_height, \n            raw_width,\n            raw_height,\n            left, top \n        } = createCanvas(dom);\n        this.reflow();\n        this.ctx = ctx //new CanvasContext2d(ctx, dpr);\n        this.DOMwrapper = dom;\n        this.canvas = canvas;\n        this.canvas.setAttribute('data-jflow', true);\n        this.canvas.$jflow = this;\n        this.canvasMeta = {\n            width: raw_width,\n            height: raw_height,\n            actual_width: c_width,\n            actual_height: c_height\n        }\n        this.dpr = dpr;\n        \n        this._getBoundingGroupRect();\n\n        const padding = this.padding;\n        const { width: p_width, height: p_height, x: p_x, y: p_y } = this.bounding_box;\n        const contentBox = {\n            x: padding,\n            y: padding,\n            width: c_width - padding * 2,\n            height: c_height - padding * 2,\n        }\n        const position = { x: 0, y: 0, offsetX: 0, offsetY: 0 };\n        const w_ratio = contentBox.width / p_width;\n        const h_ratio = contentBox.height / p_height;\n        const align = w_ratio <= h_ratio ? 'x' : 'y';\n        let scaleRatio;\n        if(this.initialZoom) {\n            scaleRatio = this.initialZoom;\n        } else {\n            scaleRatio = Math.min(w_ratio, h_ratio);\n        }\n       \n        this.scale = scaleRatio;\n        if(scaleRatio > this.maxZoom) {\n            this.maxZoom = scaleRatio;\n        }\n        if(scaleRatio < this.minZoom) {\n            this.minZoom = scaleRatio;\n        }\n        const realboxX = p_x * scaleRatio;\n        const realboxY = p_y * scaleRatio;\n        const realboxW = contentBox.width;\n        const realboxH = contentBox.height;\n        if(this.initialPosition) {\n            const { x, y } = this.initialPosition(realboxX, realboxY, realboxW, realboxH, contentBox.x, contentBox.y, c_width, c_height, p_x, p_y, p_width, p_height);\n            position.x = x;\n            position.y = y;\n        } else {\n            position.x = align === 'x' ? contentBox.x : (realboxW - p_width * scaleRatio) / 2 + padding\n            position.y = align === 'y' ? contentBox.y : (realboxH - p_height * scaleRatio) / 2 + padding\n        }\n        \n        position.offsetX = position.x - realboxX;\n        position.offsetY = position.y - realboxY;\n        this.position = position;\n        this._readyToRender = true;\n        if(this.scrollBarBehavior.enable) {\n            this.initScrollBar(this.scrollBarBehavior);\n        }\n        // this.initSchedule();\n        // this.scheduleRender(() => {\n        //     this._createEventHandler();\n        // });\n        this.__render();\n        this._createEventHandler();\n        \n        listenOnDevicePixelRatio((dpr) => {\n            this.dpr = dpr;\n            // this.ctx.setDPR(dpr)\n            this.resizeCanvas();\n            this.scheduleRender();\n        }, (handler) => {\n            this.destroyDprListener = handler;\n        });\n        \n    }\n\n    /**\n     * 设置Jflow进入连线模式\n     * @param {Object} source - 当前连线的出发原始数据\n     * @param {linkGen} linkGen - 生成连线单元的方法\n     */\n    setLinkingMode(source, linkGen, isTail) {\n        const renderNode = this.getRenderNodeBySource(source)\n        this._tempNode = new GhostNode();\n        if(isTail) {\n            this._tempLink = linkGen({\n                from: this._tempNode,\n                to: renderNode,\n            })\n        } else {\n            this._tempLink = linkGen({\n                from: renderNode,\n                to: this._tempNode,\n            })\n        }\n        \n        this.sendMessage({\n            instance: source\n        });\n        this.mode = JFLOW_MODE.LINKING;\n    }\n\n    isInLinkingMode() {\n        return this.mode === JFLOW_MODE.LINKING;\n    }\n\n    /**\n     * 连线模式下，设置当前临时连线的属性\n     * @param {BaseLink~Configs} configs - 当前连线的出发原始数据\n     */\n    setLinkingLink(configs) {\n        if(this.mode === JFLOW_MODE.LINKING) {\n            this._tempLink.setConfig(configs);\n        }\n    }\n    /**\n     * 连线模式下，重连回临时鼠标节点\n     */\n    resetLinkingLink() {\n        if(this.mode === JFLOW_MODE.LINKING) {\n            this._tempLink.setConfig({\n                to: this._tempNode\n            })\n        }\n    }\n\n    clearTemp() {\n        if(this._tempNode) {\n            this._tempNode.destroy();\n            this._tempNode = null;\n        }\n        if(this._tempLink) {\n            this._tempLink.destroy();\n            this._tempLink = null;\n        }\n        this._render();\n    }\n\n    preventClearTemp() {\n        this._preventClearTemp = true;\n    }\n\n    /**\n     * 外层容器大小变化后，调用此方法可以改变当前canvas的状态\n     */\n    resizeCanvas() {\n        if(this.canvas && this.DOMwrapper) {\n            const {\n                width: c_width, \n                height: c_height, \n                raw_width,\n                raw_height,\n            } = resizeCanvas(this.canvas, this.DOMwrapper);\n            this.canvasMeta = {\n                width: raw_width,\n                height: raw_height,\n                actual_width: c_width,\n                actual_height: c_height\n            }\n        }\n    }\n\n    setFocusInstance(node) {\n        this._focus.instance = node;\n    }\n\n    /**\n     * 移动画布到以目标绘图节点为中心的位置上\n     * @param {Node} node - 绘图节点\n     */\n    focusOn(node) {\n        const center = this._calculatePointBack([\n            this.canvasMeta.actual_width/2,\n            this.canvasMeta.actual_height/2\n        ]);\n        let offset = node.anchor;\n        if(node._belongs.calculateToCoordination) {\n            offset = node._belongs.calculateToCoordination(offset);\n        }\n\n        const deltaX = (center[0] - offset[0]) * this.scale;\n        const deltaY = (center[1] - offset[1]) * this.scale;\n        \n\n        this._recalculatePosition(deltaX, deltaY)\n        this._render();\n    }\n    \n    _getBoundingGroupRect() {\n        const points = this._stack.getBoundingRectPoints();\n        if(this.bounding_box) {\n            this.bounding_box = bounding_box(points);\n            const {\n                x: nowx,\n                y: nowy,\n            } = this.bounding_box;\n            const scale = this.scale;\n            this.position.x = this.position.offsetX + nowx * scale;\n            this.position.y = this.position.offsetY + nowy * scale;\n        } else {\n            this.bounding_box = bounding_box(points);\n        }\n    }\n\n    _createEventHandler() { \n        const canvas = this.canvas;\n        let destroyListener;\n        this.eventAdapter.apply(this);\n        const destroyPlainEventListener = () => {\n            this.eventAdapter.unload(this);\n            this.destroyDprListener();\n        }\n        destroyListener = destroyPlainEventListener;\n\n        if(this.allowDrop) {\n            const dragoverHandler = this._onDragover.bind(this);\n            const dropHandler = this._onDrop.bind(this);\n            const dragleaveHanlder = this._onDragLeave.bind(this);\n            canvas.addEventListener('dragstart', (e) => {\n                e.preventDefault()\n            })\n            canvas.addEventListener('dragover', dragoverHandler);\n            canvas.addEventListener('drop', dropHandler);\n            canvas.addEventListener('dragleave', dragleaveHanlder);\n            destroyListener = () => {\n                destroyPlainEventListener();\n                canvas.removeEventListener('dragover', dragoverHandler);\n                canvas.removeEventListener('drop', dropHandler);\n                canvas.removeEventListener('dragleave', dragleaveHanlder);\n            }\n        } \n        this.destroy = destroyListener;\n    }\n\n    _targetLockOn(offsetPoint, event) {\n        let point = this._calculatePointBack(offsetPoint);\n        const topLayerPoint = point;\n        this._currentp = point;\n        let stack = this._stack;\n        const br = this._getViewBox();\n        const target = stack.checkHit(\n            point, \n            // 应用于所有\n            (instance) => {\n                return (this._target.status.dragging \n                    && (instance === this._getMovingTarget()))\n            },\n            // 仅对于本层过滤\n            (instance) => {\n                return doOverlap(br, instance.getBoundingRect())\n            });\n        let linkStack = this._linkStack;\n        let belongs = this;\n        /*\n        if(target) {\n            linkStack = target._belongs._linkStack;\n            point = target._belongs._currentp;\n            stack = target._belongs._stack;\n            belongs = target._belongs\n        }*/\n        // 暂时设定只有顶层有连线\n        let targetLink;\n        if(!target || target._belongs === this) {\n            targetLink = linkStack.checkHit(point, (link) => {\n                if(!this._target.status.dragging) {\n                    return false;\n                }\n                const movingtarget = this._getMovingTarget();\n                return link.from === movingtarget || link.to === movingtarget;\n            });\n        }\n        if(!targetLink) {\n            targetLink = linkStack.checkHit(point, (link) => {\n                return !link.ON_TOP;\n            });\n        }\n        \n        Object.assign(this._target, {\n            instance: target,\n            link: targetLink, \n            isInstanceDirty: target === this._target.instance,\n            isLinkDirty: targetLink === this._target.link,\n        });\n        Object.assign(this._target.cache, {\n            stack,\n            belongs,\n            point,\n            topLayerPoint,\n        })\n        Object.assign(this._target.meta, {\n            x: offsetPoint[0],\n            y: offsetPoint[1],\n        });\n     \n        if(event === 'pressStart' && !this._target.status.dragging && !this._target.status.dragovering) {\n            let movingtarget = target;\n            while (movingtarget && movingtarget._belongs.lock && movingtarget !== this) {\n                movingtarget = movingtarget._belongs;\n            }\n            this.setMovingTargets(movingtarget && [ movingtarget ])\n            if(movingtarget) {\n                /**\n                 * \n                 * 开始拖拽时，拖拽对象设置之前\n                 * @event Node#afterResolveMovingTarget\n                 * @type {object}\n                 * @property {Event} event           - 原始事件 \n                 * @property {JFlow} jflow           - 当前JFlow对象 \n                 * @property {Node} target           - 目标节点\n                 */\n                target.bubbleEvent(new JFlowEvent('afterResolveMovingTarget', {\n                    event,\n                    target: movingtarget,\n                    jflow: this,\n                    bubbles: true,\n                }))\n            }\n        }\n        \n        if(['pressStart', 'click', 'dblclick', 'contextclick'].includes(event)) {\n            if(this._focus.instance && this._focus.instance !== target) {\n                this._focus.instance.dispatchEvent(new JFlowEvent('blur', {\n                    relatedTarget: target,\n                }));\n                this._focus.instance = null;\n            }   \n        }\n        return this._target;\n    }\n\n    blur() {\n        if(this._focus.instance) {\n            this._focus.instance.dispatchEvent(new JFlowEvent('blur', {\n                relatedTarget: null,\n            }));\n            this._focus.instance = null;\n        }  \n    }\n\n    _getMovingTarget() {\n        return this._target.moving && this._target.moving[0];\n    }\n\n    _processDragOver(instance, event) {\n        if(this._dragOverTarget !== instance) {\n            const target = this.readMessage()?.instance;\n            this._dragCurrentData = target;\n            const { point } = this._target.cache;\n            // console.log('_processDragOver', this._dragOverTarget)\n            if(this._dragOverTarget) {\n                const oldIns = this._dragOverTarget;\n                /**\n                * dragleave 退出事件\n                * @event Instance#dragleave\n                * @type {object}\n                * @property {Event} event           - 原始事件 \n                * @property {Object} instance       - dragleave的对象 \n                * @property {target} target         - drag 携带的对象（特指从外面拖进canvas的对象） \n                */\n                oldIns.dispatchEvent(new JFlowEvent('dragleave', {\n                    event,\n                    instance: oldIns,\n                    target,\n                    jflow: this,\n                    point,\n                }));\n            }\n            if(instance) {\n                /**\n                * dragenter 进入事件\n                * @event Instance#dragenter\n                * @type {object}\n                * @property {Event} event           - 原始事件 \n                * @property {Object} instance       - dragenter的对象 \n                * @property {target} target         - drag 携带的对象（特指从外面拖进canvas的对象） \n                */\n                instance.dispatchEvent(new JFlowEvent('dragenter', {\n                    event,\n                    instance,\n                    target,\n                    jflow: this,\n                    point\n                }));\n            }\n            this._dragOverTarget = instance;\n        } else if(this._dragOverTarget){\n            /**\n            * dragover 进入事件\n            * @event Instance#dragover\n            * @type {object}\n            * @property {Event} event           - 原始事件 \n            * @property {Object} instance       - dragover的对象 \n            * @property {target} target         - drag 携带的对象（特指从外面拖进canvas的对象） \n            */\n            this._dragOverTarget.dispatchEvent(new JFlowEvent('dragover', {\n                event,\n                instance,\n                jflow: this,\n                target: this._dragCurrentData,\n            }));\n        }\n\n        this._processPanInBorder();\n    }\n\n    _processPanInBorder() {\n        if(this.draggingbehavior?.panInBorder?.enable) {\n            if(!this.draggingbehavior.panInBorder.timer) {\n                this.draggingbehavior.panInBorder.timer = Date.now();\n            }\n            if(Date.now() - this.draggingbehavior.panInBorder.timer > 500) {\n                const [x, y, w, h] = this._cacheViewBox;\n                const [px, py] = this._currentp;\n                const {\n                    padding,\n                    deltamovement\n                } = this.draggingbehavior.panInBorder;\n                let deltaX = 0;\n                let deltaY = 0;\n                if(px < x + padding) {\n                    deltaX = deltamovement;\n                } \n                if(px > w - padding) {\n                    deltaX = -deltamovement;\n                } \n                if(py < y + padding) {\n                    deltaY = deltamovement;\n                } \n                if(py > h - padding) {\n                    deltaY = -deltamovement;\n                } \n                if(this.__processOverAnime) {\n                    this.__processOverAnime.cancel();\n                }\n                if(deltaX || deltaY) {\n                    this.__processOverAnime = this.requestJFlowAnime(() => {\n                        this.panHandler(deltaX, deltaY);\n                    }) \n                } else {\n                    this.draggingbehavior.panInBorder.timer = null;\n                }\n            }\n        }\n    }\n\n    _onDragover(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if(this._lastDragState.processing) return;\n        this._lastDragState.processing = true;\n        const { offsetX, offsetY } = event\n        Object.assign(this._target.status, {\n            dragovering: true,\n        })\n        this._targetLockOn([offsetX, offsetY])\n        const instance = this._target.instance || this._target.link;\n        this._processDragOver(instance, event);\n        if(this._target.isLinkDirty || this._target.isInstanceDirty) {\n            Promise.resolve().then(() => {\n                this._render();    \n                this._target.isLinkDirty = false; \n                this._target.isInstanceDirty = false;\n                this._lastDragState.processing = false;\n            })\n        } else {\n            this._lastDragState.processing = false;\n        } \n    }\n\n    _cancelPanInBorder() {\n        if(this.__processOverAnime) {\n            this.__processOverAnime.cancel();\n        }\n        if(this.draggingbehavior?.panInBorder) {\n            this.draggingbehavior.panInBorder.timer = null;\n        }\n    }\n\n    _onDragLeave() {\n        this._cancelPanInBorder();\n    }\n\n    _onDrop(event) {\n        this._cancelPanInBorder();\n        const payload = this.consumeMessage();\n        const instance = payload?.instance;\n        if(this._dragOverTarget) {\n            const oldIns = this._dragOverTarget;\n            oldIns.dispatchEvent(new JFlowEvent('dragoverend', {\n                event,\n                instance: oldIns,\n            }));\n            this._dragOverTarget = null;\n        }\n        const {\n            link,\n            instance: target,\n        } = this._target;\n        const {\n            point, belongs\n        } = this._target.cache;\n        if(link) {   \n            /**\n             * 丢在线上事件\n             *\n             * @event BaseLink#drop\n             * @type {object}\n             * @property {Event} event           - 原始事件 \n             * @property {Object} instance       - 拖动的对象 \n             * @property {BaseLink} link         - 目标连线 \n             * @property {JFlow} jflow           - 当前JFlow对象 \n             * @property {Group|JFlow} belongs   - 连线所在的绘图栈的对象\n             * @property {number[]} point        - 已经计算到绘图栈对应坐标系下的坐标\n             */\n            // instance.anchor = point;\n            link.dispatchEvent(new JFlowEvent('drop', {\n                event,\n                instance,\n                link,\n                jflow: this,\n                belongs,\n                point\n            }))\n        } else if(target) {\n            /**\n             * 丢在节点上事件\n             *\n             * @event Node#drop\n             * @type {object}\n             * @property {Event} event           - 原始事件 \n             * @property {Object} instance       - 拖动的对象 \n             * @property {JFlow} jflow           - 当前JFlow对象 \n             * @property {Node} target           - 目标节点\n             * @property {number[]} point        - 已经计算到绘图栈对应坐标系下的坐标\n             */\n            target.bubbleEvent(new JFlowEvent('drop', {\n                event,\n                instance,\n                jflow: this,\n                target,\n                point,\n                bubbles: true,\n            }));\n        } else {\n            /**\n            * 丢在主图上事件\n            *\n            * @event JFlow#drop\n            * @type {object}\n            * @property {Event} event           - 原始事件 \n            * @property {Object} instance       - 拖动的对象 \n            * @property {JFlow} jflow           - 当前JFlow对象 \n            * @property {number[]} point        - 已经计算到绘图栈对应坐标系下的坐标\n            */\n            this.dispatchEvent(new JFlowEvent('drop', {\n                event,\n                instance,\n                jflow: this,\n                target,\n                point,\n            }))\n        }\n        requestAnimationFrame(() => {\n            this.cancelDrop();\n        })\n    }\n    cancelDrop() {\n        this._target.instance = null;\n        this._target.link = null;\n        Object.assign(this._target.status, {\n            dragovering: false,\n        })\n    }\n    \n    /**\n     * 缩放操作处理函数\n     * @param {Number} offsetX - 事件对象与canvas的内填充边（padding edge）在 X 轴方向上的偏移量。\n     * @param {Number} offsetY - 事件对象与canvas的内填充边（padding edge）在 Y 轴方向上的偏移量。 \n     * @param {Number} deltaX  - 水平滚动量\n     * @param {Number} deltaY  - 垂直滚动量\n     * @param {Number} event - 原生事件\n     */\n    zoomHandler(offsetX, offsetY, deltaX, deltaY, event) {\n        // if(!this._allowZoom) return;\n        if(this._zooming) return;\n        this._zooming = true;\n        const { width: p_width, height: p_height, x, y } = this.bounding_box;\n        const { actual_width: cw, actual_height: ch } = this.canvasMeta;\n        let minZoom = this.minZoom;\n        if(this.worldMargin) {\n            const m = this.worldMargin;\n            const maxWidth = p_width + m * 2;\n            const maxHeight = p_height + m * 2;\n            minZoom = Math.max(minZoom, Math.max(cw / maxWidth, ch / maxHeight));\n        }\n        let newScale = this.scale;\n        const amount = deltaY > 0 ? 1.05 : 1 / 1.05;\n        newScale *= amount;\n        newScale = Math.min(this.maxZoom, Math.max(minZoom, newScale))\n        // console.log(newScale);\n        // if (this.maxZoom && newScale > this.maxZoom){\n        //     // could just return but then won't stop exactly at maxZoom\n        //     newScale = this.maxZoom;\n        // }\n\n        // if(this.minZoom && newScale < this.minZoom) {\n        //     newScale = this.minZoom;\n        // }\n\n        var deltaScale    = newScale - this.scale;\n        var currentWidth  = p_width * this.scale;\n        var currentHeight = p_height * this.scale;\n        var deltaWidth    = p_width * deltaScale;\n        var deltaHeight   = p_height * deltaScale;\n\n        var tX = offsetX - this.position.x;\n        var tY = offsetY - this.position.y;\n        var pX = -tX / currentWidth;\n        var pY = -tY / currentHeight;\n\n        this.scale = newScale;\n        this._recalculatePosition(pX * deltaWidth, pY * deltaHeight);\n        \n        // this.position.x += pX * deltaWidth;\n        // this.position.y += pY * deltaHeight;\n        // this.position.offsetX = this.position.x - x * newScale;\n        // this.position.offsetY = this.position.y - y * newScale;\n        this.dispatchEvent(new JFlowEvent('zoompan', {\n             deltaX: 0, deltaY: 0\n        }));\n        // this.setAnimeClock()\n        this.scheduleRender(() => {\n            this._zooming = false;\n        })\n        // requestAnimationFrame((timestamp) => {\n        //     this.setAnimeClock(timestamp);\n        //     this._render();\n        //     this._zooming = false;\n        // })\n    }\n    /**\n     * 平移画布操作处理函数\n     * @param {Number} deltaX  - 水平滚动量\n     * @param {Number} deltaY  - 垂直滚动量\n     * @param {Number} event - 原生事件\n     */\n    panHandler(deltaX, deltaY, event) {\n        if(this._panning) return;\n        this._panning = true;\n        const {\n            dragging,\n        } = this._target.status;\n        if(dragging) {\n            const movingtarget = this._target.moving;\n            if(movingtarget) {\n                if(this.draggingbehavior.panInBorder.allowMovingTargetInPan) {\n                    movingtarget.forEach(t => {\n                        t.anchor[0] += -deltaX / this.scale;\n                        t.anchor[1] += -deltaY / this.scale;\n                    })\n                }\n            }\n        }\n\n        this._recalculatePosition(deltaX, deltaY);\n        /**\n         * 缩放平移事件\n         *\n         * @event JFlow#zoompan\n        */\n        this.dispatchEvent(new JFlowEvent('zoompan', {\n            deltaX,\n            deltaY\n        }));\n        this.scheduleRender(() => {\n            this._panning = false;\n        })\n        // requestAnimationFrame((timestamp) => {\n        //     this.setAnimeClock(timestamp);\n        //     this._render();\n        //     this._panning = false;\n        // })\n    }\n    /**\n     * 开始按压处理函数\n     * @param {Number} offsetX - 事件对象与canvas的内填充边（padding edge）在 X 轴方向上的偏移量。\n     * @param {Number} offsetY - 事件对象与canvas的内填充边（padding edge）在 Y 轴方向上的偏移量。 \n     * @param {Number} event - 原生事件\n     */\n    pressStartHandler(offsetX, offsetY, event) {\n        if(this.checkScrollDragging()) {\n            return;\n        }\n        Object.assign(this._target.meta, {\n            initialX: offsetX,\n            initialY: offsetY,\n        })\n        const {\n            link,\n            instance\n        } = this._targetLockOn([offsetX, offsetY], 'pressStart');\n        // 后续只支持 click 动作\n        if(this.mode === JFLOW_MODE.LINKING) return;\n        Object.assign(this._target.status, {\n            dragging: true,\n            processing: false,\n        });\n        if(this._target.moving) {\n            const moving = this._getMovingTarget();\n            /**\n             * 开始拖动组的事件（特指lock的顶层组）\n             *\n             * @event Node#pressStart\n             * @type {object}\n             * @property {Event} event           - 原始事件 \n             * @property {Node} instance       - 拖动的对象 \n             * @property {JFlow} jflow           - 当前JFlow对象 \n             */\n            moving.dispatchEvent(new JFlowEvent('pressStart', {\n                event,\n                instance: moving,\n                jflow: this,\n            }))\n        }\n        const t = this._resolveLockOnTarget(link, instance)\n        if(t) {\n            /**\n             * 开始拖动对象事件（就是目标对象的拖动事件，事件支持冒泡）\n             *\n             * @event Node#instancePressStart\n             * @type {object}\n             * @property {Event} event           - 原始事件 \n             * @property {Node} instance     - 拖动的对象 \n             * @property {JFlow} jflow           - 当前JFlow对象 \n             * @property {Boolean} bubbles       - 冒泡\n             */\n            // const t = this._target.instance;\n            t.bubbleEvent(new JFlowEvent('instancePressStart', {\n                event,\n                target: t,\n                jflow: this,\n                bubbles: true,\n                preventDefault: () => {\n                    this._preventPressSequeence = true;\n                    this._clearTarget();\n                    document.addEventListener('pointerup', e => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        this._preventPressSequeence = false;\n                    }, { once: true });\n                }\n            }))\n        }\n        if(!this._preventPressSequeence) {\n            this.dispatchEvent(new JFlowEvent('jflowPressStart', {\n                event,\n                jflow: this,\n            }));\n        }\n    }\n    /**\n     * 按压中处理函数\n     * @param {Number} offsetX - 事件对象与canvas的内填充边（padding edge）在 X 轴方向上的偏移量。\n     * @param {Number} offsetY - 事件对象与canvas的内填充边（padding edge）在 Y 轴方向上的偏移量。 \n     * @param {Number} event - 原生事件\n     */\n    pressMoveHandler(offsetX, offsetY, event) {\n        if(this._preventPressSequeence) {\n            return;\n        }\n        if(this.checkScrollDragging()) {\n            return;\n        }\n        const {\n            dragging, processing\n        } = this._target.status;\n        const { x, y } = this._target.meta;\n        // this.canvas.style.cursor = 'default';\n        if(!dragging) {\n            if(this.checkScrollBarHover(offsetX, offsetY)) {\n                return;\n            } else {\n                this.resetScrollBarHover();\n            }\n            \n        }\n\n        if(!dragging && !processing) {\n            const {\n                link,\n                instance\n            } = this._targetLockOn([offsetX, offsetY]);\n            const t = this._resolveLockOnTarget(link, instance);\n            if(t) {\n                \n                /**\n                * instance mousemove 原生事件，仅在无拖拽时触发\n                *\n                * @event Node#instancemousemove\n                * @type {object}\n                * @property {Event} event           - 原始事件\n                * @property {Node} instance           - 原始事件\n                * @property {JFlow} jflow           - 当前JFlow对象 \n                */\n                // instance.dispatchEvent(new JFlowEvent('instancemousemove', {\n                //     event,\n                //     instance,\n                //     jflow: this,\n                // }))\n                t.bubbleEvent(new JFlowEvent('instancemousemove', {\n                    event,\n                    instance: t,\n                    jflow: this,\n                    bubbles: true\n                }));\n            } else {\n                this.dispatchEvent(new JFlowEvent('instancemousemove', {\n                    event,\n                    instance: null,\n                    jflow: this,\n                }));\n            }\n            \n\n            if(this.mode === JFLOW_MODE.LINKING) {\n                // if(instance) {\n                //     instance.bubbleEvent(new JFlowEvent('linking', {\n                //         event,\n                //         target: instance,\n                //         jflow: this,\n                //         bubbles: true,\n                //         callback: (p) => {\n                //             this._currentp = p;\n                //         }\n                //     }))\n                // }\n                \n\n                this._tempNode.anchor = this._currentp;\n                \n                this.scheduleRender(() => {\n                    this._target.isLinkDirty = false; \n                    this._target.isInstanceDirty = false;\n                    this._target.status.processing = false;\n                })\n                this._processPanInBorder();\n                // requestAnimationFrame((timestamp) => {\n                //     this.setAnimeClock(timestamp);\n                //     this._render();\n                //     this._target.isLinkDirty = false; \n                //     this._target.isInstanceDirty = false;\n                //     this._target.status.processing = false;\n                // })\n                return;\n            }\n        }\n\n        \n        /**\n         * canvas mousemove 原生事件\n         *\n         * @event JFlow#canvasmousemove\n         * @type {object}\n         * @property {Event} event           - 原始事件\n         * @property {JFlow} jflow           - 当前JFlow对象 \n         */\n        this.dispatchEvent(new JFlowEvent('canvasmousemove', {\n            event,\n            jflow: this,\n        }))\n\n        \n        \n        if(!dragging) return;\n        // this.canvas.style.cursor = 'grabbing';\n        if(processing) return;\n        \n        const movingtarget = this._target.moving;// this._tempNode ? [this._tempNode] : this._target.moving;\n        this._target.status.movingState = true\n        this._target.status.processing = true;\n        const deltaX = offsetX - x;\n        const deltaY = offsetY - y;\n        if(movingtarget) {\n            if(this._allowMovingTarget) {\n                movingtarget.forEach(t => {\n                    t.anchor[0] += deltaX / this.scale;\n                    t.anchor[1] += deltaY / this.scale;\n                })\n            }\n        } else {\n            this._recalculatePosition(deltaX, deltaY);    \n            this.dispatchEvent(new JFlowEvent('zoompan', {\n                deltaX, deltaY\n            }));\n        }\n        const { instance, link } = this._targetLockOn([offsetX, offsetY]);\n\n        this._processDragOver(instance || link, event);\n        \n        this.scheduleRender(() => {\n            this._target.isLinkDirty = false; \n            this._target.isInstanceDirty = false;\n            this._target.status.processing = false;\n        })\n        // requestAnimationFrame((timestamp) => {\n        //     this._render();\n        //     this._target.isLinkDirty = false; \n        //     this._target.isInstanceDirty = false;\n        //     this._target.status.processing = false;\n        // })\n    }\n    /**\n     * 按压结束处理函数\n     * @param {Boolean} isDocument - 是否为 document 触发\n     * @param {Number} event - 原生事件\n     */\n    pressUpHanlder(isDocument, event) {\n        if(this._preventPressSequeence) {\n            return;\n        }\n        \n        if(this.__processOverAnime) {\n            this.__processOverAnime.cancel();\n        }\n        this._cancelPanInBorder();\n        // this.resetScollBarStatus();\n        const meta = this._target.meta;\n        if(this.mode === JFLOW_MODE.LINKING) {\n            const t = this._target.instance;\n            const payload = this.consumeMessage();\n            // console.log(payload)\n            let _preventDefault = false;\n            const preventDefault = () => {\n                _preventDefault = true;\n            } \n            if(t) {\n                /**\n                 * canvas mousemove 原生事件\n                 *\n                 * @event Node#link\n                 * @type {object}\n                 * @property {Event} event           - 原始事件\n                 * @property {Node} target           - 原始事件\n                 * @property {object} payload        - 传入的消息\n                 * @property {JFlow} jflow           - 当前JFlow对象       - 当前JFlow对象 \n                 */\n                t.bubbleEvent(new JFlowEvent('link', {\n                    event,\n                    target: t,\n                    jflow: this,\n                    payload,\n                    bubbles: true,\n                    link: this._tempLink,\n                    preventDefault,\n                }))        \n            } else {\n                const { offsetX, offsetY } = event\n                this.dispatchEvent(new JFlowEvent('link', {\n                    event,\n                    jflow: this,\n                    payload,\n                    anchor: this._calculatePointBack([offsetX, offsetY]),\n                    link: this._tempLink,\n                    preventDefault\n                }));\n            }\n            if(_preventDefault) {\n                return;\n            }\n            this._clearTarget();\n            if(!this._preventClearTemp) {\n                if(this._tempNode) {\n                    this._tempNode.destroy();\n                    this._tempNode = null;\n                }\n                if(this._tempLink) {\n                    this._tempLink.destroy();\n                    this._tempLink = null;\n                }\n            }\n            this._preventClearTemp = false\n            this.mode = JFLOW_MODE.DEFAULT;\n            this._render();\n            return;\n        }\n        \n        if(this._target.moving) {\n            let checkresult = false;\n            if(this._layout.static) {\n                checkresult = this.staticCheck(this._getMovingTarget());\n            }\n            if(!checkresult && this._target.link) {\n                \n                const {\n                    point, belongs\n                } = this._target.cache;\n                const link = this._target.link;\n                const instance = this._getMovingTarget();\n                /**\n                 * 拖动到线上事件\n                 *\n                 * @event BaseLink#drop\n                 * @type {object}\n                 * @property {Event} event           - 原始事件 \n                 * @property {Object} instance     - 拖动的对象 \n                 * @property {BaseLink} link         - 目标连线 \n                 * @property {JFlow} jflow           - 当前JFlow对象 \n                 * @property {Group|JFlow} belongs   - 连线所在的绘图栈的对象\n                 */\n                link.dispatchEvent(new JFlowEvent('drop', {\n                    event,\n                    instance,\n                    link,\n                    jflow: this,\n                    belongs,\n                }));\n                this._target.link = null;\n                this._target.instance = null;\n            }\n            if(this._target.moving) {\n                if(this._target.instance) {\n                    /**\n                     * 拖动后放置到 Instance 上的事件，由被拖动到的对象触发\n                     *\n                     * @event Node#pressEnd\n                     * @type {object}\n                     * @property {Event} event           - 原始事件 \n                     * @property {Node} instance         - 拖动的对象 \n                     * @property {JFlow} jflow           - 当前JFlow对象 \n                     * @property {Instance} target       - 拖动到的对象\n                     * @property {boolean} bubbles       - 冒泡\n                     */\n                    //  console.log('pressEnd', this._target.instance)\n                    this._target.instance.bubbleEvent(new JFlowEvent('pressEnd', {\n                        event,\n                        instance: this._getMovingTarget(),\n                        jflow: this,\n                        target: this._target.instance,\n                        bubbles: true\n                    }));\n                } else {\n                    /**\n                     * 拖动后放置到主图上的事件\n                     *\n                     * @event JFlow#pressEnd\n                     * @type {object}\n                     * @property {Event} event           - 原始事件 \n                     * @property {Instance} instance       - 拖动的对象 \n                     * @property {JFlow} jflow           - 当前JFlow对象 \n                     */\n                    this.dispatchEvent(new JFlowEvent('pressEnd', {\n                        event,\n                        instance: this._getMovingTarget(),\n                        jflow: this,\n                    }))\n                }\n            }\n            this._target.moving = null;\n            this.removeTempDraggingInstance()\n            // this._target.isMovingDirty = false;\n            this._render();\n        }\n        this._clearTarget();\n    }\n     /**\n     * 菜单弹出处理函数\n     * @param {Number} offsetX - 事件对象与canvas的内填充边（padding edge）在 X 轴方向上的偏移量。\n     * @param {Number} offsetY - 事件对象与canvas的内填充边（padding edge）在 Y 轴方向上的偏移量。 \n     * @param {Number} event - 原生事件\n     */\n    clickHanlder(offsetX, offsetY, event) {\n        const {\n            link,\n            instance,\n            meta\n        } = this._targetLockOn([offsetX, offsetY], 'click');\n        if(Math.abs(meta.initialX - meta.x) < 1\n            && Math.abs(meta.initialY - meta.y) < 1) { \n                if(event.target !== this.canvas){\n                    this._clearTarget();\n                    Object.assign(this._target.meta, {\n                        initialX: undefined,\n                        initialY: undefined, \n                    });\n                    return;\n                }\n                const { topLayerPoint } = this._target.cache\n                const t = this._resolveLockOnTarget(link, instance);\n                if(t) {\n                    const target = t;\n                    /**\n                     * 点击事件（冒泡）\n                     *\n                     * @event Instance#contextclick\n                     * @type {object}\n                     * @property {Event} event           - 原始事件 \n                     * @property {Instance} target       - 右键对象 \n                     * @property {JFlow} jflow           - 当前JFlow对象\n                     * @property {number[]} topLayerPoint  - jflow坐标系上的位置\n                     * @property {Boolean} bubbles       - 冒泡\n                     */\n                    target.bubbleEvent(new JFlowEvent('click', {\n                        event,\n                        jflow: this,\n                        target,\n                        topLayerPoint,\n                        bubbles: true\n                    }));\n                } else {\n                    /**\n                     * 点击事件\n                     *\n                     * @event JFlow#contextclick\n                     * @type {object}\n                     * @property {Event} event           - 原始事件 \n                     * @property {JFlow} jflow           - 当前JFlow对象\n                     * @property {number[]} topLayerPoint  - jflow坐标系上的位置\n                     */\n                    this.dispatchEvent(new JFlowEvent('click', {\n                        event,\n                        jflow: this,\n                        topLayerPoint,\n                    }));\n                }\n                this._clearTarget();\n                Object.assign(this._target.meta, {\n                    initialX: undefined,\n                    initialY: undefined, \n                });\n            }\n    }\n    /**\n     * 菜单弹出处理函数\n     * @param {Number} offsetX - 事件对象与canvas的内填充边（padding edge）在 X 轴方向上的偏移量。\n     * @param {Number} offsetY - 事件对象与canvas的内填充边（padding edge）在 Y 轴方向上的偏移量。 \n     * @param {Number} event - 原生事件\n     */\n    contextMenuHanlder(offsetX, offsetY, event) {\n        const {\n            link,\n            instance\n        } = this._targetLockOn([offsetX, offsetY], 'contextclick');\n        const { topLayerPoint } = this._target.cache\n        const t = this._resolveLockOnTarget(link, instance);\n        if(t) {\n            const target = t;\n            /**\n             * 右键事件（冒泡）\n             *\n             * @event Instance#contextclick\n             * @type {object}\n             * @property {Event} event           - 原始事件 \n             * @property {Instance} target       - 右键对象 \n             * @property {JFlow} jflow           - 当前JFlow对象\n             * @property {number[]} topLayerPoint  - jflow坐标系上的位置\n             * @property {Boolean} bubbles       - 冒泡\n             */\n            target.bubbleEvent(new JFlowEvent('contextclick', {\n                event,\n                jflow: this,\n                target,\n                topLayerPoint,\n                bubbles: true\n            }));\n        } else {\n            /**\n             * 右键事件\n             *\n             * @event JFlow#contextclick\n             * @type {object}\n             * @property {Event} event           - 原始事件 \n             * @property {JFlow} jflow           - 当前JFlow对象\n             * @property {number[]} topLayerPoint  - jflow坐标系上的位置\n             */\n            this.dispatchEvent(new JFlowEvent('contextclick', {\n                event,\n                jflow: this,\n                topLayerPoint,\n            }));\n        }\n    }\n\n    dblclickHandler(offsetX, offsetY, event) {\n        const {\n            link,\n            instance\n        } = this._targetLockOn([offsetX, offsetY], 'dblclick');\n        const { topLayerPoint } = this._target.cache\n        const t = this._resolveLockOnTarget(link, instance);\n        if(t) {\n            const target = t;\n            /**\n             * 右键事件\n             *\n             * @event Instance#dblclick\n             * @type {object}\n             * @property {Event} event           - 原始事件 \n             * @property {Instance} target       - 右键对象 \n             * @property {JFlow} jflow           - 当前JFlow对象\n             * @property {number[]} topLayerPoint  - jflow坐标系上的位置\n             * @property {Boolean} bubbles       - 冒泡\n             */\n            target.bubbleEvent(new JFlowEvent('dblclick', {\n                event,\n                jflow: this,\n                target,\n                topLayerPoint,\n                bubbles: true\n            }));\n        } else {\n            this.dispatchEvent(new JFlowEvent('dblclick', {\n                event,\n                jflow: this,\n                topLayerPoint,\n            }));\n        }\n    }\n\n    /*_onZoom(event) {\n        event.preventDefault();\n        let { offsetX, offsetY, deltaX, deltaY } = event\n        if(event.ctrlKey) { \n            deltaY = -deltaY;\n            this.zoomHandler(offsetX, offsetY, deltaX, deltaY);\n        } else {\n            this.panHandler(-deltaX, -deltaY);\n        }\n    }\n\n    _onPressStart(event) { \n        const { offsetX, offsetY, deltaY, button } = event\n        if(button !== 0) return;\n        this.pressStartHandler(offsetX, offsetY);\n    }\n\n    _onPressMove(event) {\n        const { offsetX, offsetY } = event\n        this.pressMoveHandler(offsetX, offsetY);\n    }\n\n    _onPressUp(event, isDocument) {\n        event.preventDefault();\n        event.stopPropagation();\n        const { button } = event\n        if(button !== 0) return;\n        this.pressUpHanlder(isDocument)\n    }\n\n    _onPressUpDocument(event) {\n        this._onPressUp(event, true);\n    }\n\n    _onContextMenu(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        const { offsetX, offsetY } = event;\n        this.contextMenuHanlder(offsetX, offsetY);\n    }*/\n    _resolveLockOnTarget(link, instance) {\n        return link?.ON_TOP ? link : (instance || link);\n    }\n\n    _clearTarget(){\n        Object.assign(this._target.meta, {\n            x: undefined,\n            y: undefined,\n            // initialX: undefined,\n            // initialY: undefined, \n        })\n        Object.assign(this._target.status, {\n            dragging: false,\n            processing: false,\n            movingState: false,\n        });\n        Object.assign(this._target, {\n            instance: null,\n            link: null,\n            moving: null,\n        });\n    }\n\n    _recalculatePosition(deltaX, deltaY, scale) {\n        const { x, y, width, height } = this.bounding_box;\n        const { actual_width: cw, actual_height: ch } = this.canvasMeta;\n        if(scale === undefined) {\n            scale = this.scale;\n        }\n        \n\n        if(this.worldMargin) {\n            // console.log(scale)\n            const m = this.worldMargin;\n            const bx1 = (x + width + m)*scale - cw;\n            const bx2 = (x - m)*scale;\n            // console.log(bx1, bx2)\n            const sx = x * scale;\n            const px = this.position.x + deltaX;\n            const cx = px - sx;\n            this.position.offsetX = Math.min(Math.max(-bx1, cx), -bx2);\n            // console.log(this.position.offsetX)\n            // this.position.offsetX = Math.max(Math.min(-bx2, cx), -bx1);\n            this.position.x = this.position.offsetX + sx;\n            // console.log(this.position.x, deltaX)\n            // console.log(this.position.offsetX)\n\n            const by1 = (y + height + m)*scale - ch;\n            const by2 = (y - m)*scale;\n            // console.log(by1, by2)\n            const sy = y * scale;\n            const py = this.position.y + deltaY;\n            const cy = py - sy;\n            this.position.offsetY = Math.min(Math.max(-by1, cy), -by2);\n            // this.position.offsetY = Math.max(Math.min(-by2, cy), -by1);\n            this.position.y = this.position.offsetY + sy;\n        } else {\n            this.position.x += deltaX;\n            this.position.y += deltaY; \n            this.position.offsetX = this.position.x - x * scale;\n            this.position.offsetY = this.position.y - y * scale;\n        }\n        \n    }\n\n    calculateToRealWorld(p) {\n        const scale = this.scale;\n        const position = this.position;\n        return [p[0] * scale + position.offsetX, p[1] * scale + position.offsetY]\n    }\n\n    _calculatePointBack(p) {\n        const scale = this.scale;\n        const position = this.position;\n        return [(p[0] - position.offsetX)/scale, (p[1] - position.offsetY) / scale];\n    }\n\n    _calculatePointBackWithPoint(a, b, arr, idx1, idx2) {\n        const scale = this.scale;\n        const position = this.position;\n        arr[idx1] = (a - position.offsetX) / scale;\n        arr[idx2] = (b - position.offsetY) / scale\n    }\n\n    _calculateDistance(l) {\n        return this.scale * l;\n    }\n\n    _resetTransform() {\n        const { width: c_width, height: c_height } = this.canvasMeta;\n        const position = this.position;\n        const scale = this.scale;\n        const ctx = this.ctx;\n        ctx.setTransform();\n        ctx.clearRect(0, 0, c_width, c_height);\n        ctx.scale(this.dpr, this.dpr);\n        ctx.transform(scale, 0, 0, scale, position.offsetX, position.offsetY);\n        // ctx._ctx.setTransform();\n        // ctx._ctx.clearRect(0, 0, c_width, c_height);\n        // ctx._ctx.scale(this.dpr, this.dpr);\n        // ctx.transform(scale, position.offsetX, position.offsetY);\n    }\n\n    resetTransform(ctx) {\n        const position = this.position;\n        const scale = this.scale;\n        ctx.setTransform();\n        ctx.scale(this.dpr, this.dpr);\n        ctx.transform(scale, 0, 0, scale, position.offsetX, position.offsetY);\n    }\n\n    _getViewBox() {\n        // const cacheViewBox = [\n        //     ...this._calculatePointBack([0,0]),\n        //     ...this._calculatePointBack([this.canvasMeta.actual_width,this.canvasMeta.actual_height]),\n        // ];\n        const cacheViewBox = this._cacheViewBox;\n        this._calculatePointBackWithPoint(0,0, cacheViewBox, 0, 1);\n        this._calculatePointBackWithPoint(\n            this.canvasMeta.actual_width,\n            this.canvasMeta.actual_height, \n            cacheViewBox, 2, 3);\n        return cacheViewBox;\n    }\n\n    setNodeToTopLayer(node) {\n        const index = this._stack.findIndex(n => n === node);\n        if(index !== -1) {\n            const [renderNode] = this._stack.splice(index, 1);\n            this._stack.push(renderNode);\n        }\n    }\n\n    getCacheViewBox() {\n        return this._cacheViewBox;\n    }\n\n    \n    _render() {\n        this.scheduleRender();\n    }\n\n     /**\n     * 绘制画布\n     */\n    __render() {\n        if(!this._readyToRender) return;\n        // if(this.hasAnimeAndFrameRendered()) return;\n        this.runAnimeFrame();\n        this._resetTransform();\n        const ctx = this.ctx;\n        this.dispatchEvent(new JFlowEvent('beforeJflowRender', {\n            ctx\n        }));\n        const br = this._getViewBox();\n\n        if(this.NodeRenderTop) {\n            this._linkStack.render(ctx, (link) => !link.ON_TOP && link.isInViewBox(br));\n            this._stack.render(ctx, (instance) => {\n                const result = doOverlap(br, instance.getBoundingRect());\n                instance._isInViewBox = result;\n                return result;\n            });\n            this._linkStack.render(ctx, (link) => link.ON_TOP && link.isInViewBox(br));\n        } else {\n            this._stack.render(ctx, (instance) => {\n                const result = doOverlap(br, instance.getBoundingRect());\n                // console.log(instance._layoutNode.type, result)\n                instance._isInViewBox = result;\n                return result;\n            });\n            this._linkStack.render(ctx, (link) => link.isInViewBox(br));\n        }\n        // ctx.save();\n        // for(let i =0;i<2000;i++) {\n        //     ctx.beginPath();\n        //     ctx.fillStyle = `rgb(${parseInt(Math.random()*255)},${parseInt(Math.random()*255)},${parseInt(Math.random()*255)})`\n        //     ctx.fillRect(\n        //         Math.random()*250, \n        //         Math.random()*240, \n        //         Math.random()*200, \n        //         Math.random()*300)\n        // }\n        \n        // ctx.restore();\n\n        if(this._tempNode) {\n            ctx.save();\n            this._tempNode.render(ctx)\n            ctx.restore();\n        }\n        if(this._tempLink) {\n            ctx.save();\n            this._tempLink.isInViewBox(br)\n            this._tempLink.render(ctx)\n            ctx.restore();\n        }\n\n        this.dispatchEvent(new JFlowEvent('afterJflowRender', {\n            ctx\n        }));\n        this.renderScrollBar(ctx);\n        // this.setFrameRendered();\n    }\n}\nObject.assign(JFlow.prototype, MessageMixin);\nObject.assign(JFlow.prototype, StackMixin);\nObject.assign(JFlow.prototype, LayoutMixin);\nObject.assign(JFlow.prototype, NodeWeakMapMixin);\nObject.assign(JFlow.prototype, AnimeMixin);\nObject.assign(JFlow.prototype, MiniMapMixin);\nObject.assign(JFlow.prototype, ScheduleMixin);\nObject.assign(JFlow.prototype, ScrollBarMixin);\n\nexport default JFlow;\nexport { JFLOW_MODE } from '../utils/constance';\nexport { default as JFlowEvent } from '../events';\nexport { default as commonEventAdapter } from '../events/commonAdapter';\nexport { default as Instance } from '../instance/instance';\nexport { default as Node } from '../instance/node';\nexport { default as BaseLink } from '../instance/base-link';\nexport { default as Point } from '../instance/shapes/point';\nexport { default as Rectangle } from '../instance/shapes/rectangle';\n// export { default as Group } from '../instance/shapes/rectangle-group';\nexport { default as Capsule } from '../instance/shapes/capsule';\nexport { default as CapsuleVertical } from '../instance/shapes/capsule-vertical';\n// export { default as CapsuleGroup } from '../instance/shapes/capsule-group';\n// export { default as CapsuleVerticalGroup } from '../instance/shapes/capsule-vertical-group';\nexport { default as Diamond } from '../instance/shapes/diamond';\n// export { default as DiamondGroup } from '../instance/shapes/diamond-group';\n// export { default as DiamondVerticalGroup } from '../instance/shapes/diamond-vertical-group';\nexport { default as Rhombus } from '../instance/shapes/rhombus';\n// export { default as RhombusGroup } from '../instance/shapes/rhombus-group';\nexport { default as Text } from '../instance/elements/text';\nexport { default as Icon } from '../instance/image';\nexport { default as ShadowDom } from '../instance/shadowDom';\nexport { default as GroupFactory } from '../instance/groupFactory';\nexport { default as Link } from '../instance/link';\nexport { default as PolyLink } from '../instance/poly-link';\nexport { default as BezierLink } from '../instance/bezier-link';\nexport { default as LinearLayout} from '../layout/linear-layout';\n// export { default as TreeLayout } from '../ler-layouta;yout/tree-layout';\nexport { default as Lowcodelayout } from '../layout/low-code-layout';\nexport { default as ERLayout } from '../layout/er-layout/er-layout';\n// export { default as Orange } from '../instance/nodeWrapper/orange/orange'\n// export { default as TextEditor } from '../instance/text-editor';\n// export { default as TextGroup} from '../instance/text-group';\nexport { default as TextGroup} from '../instance/text-group/text-group';\nexport { TextElement } from '../instance/text-group/storage';\n// export { JFlowPath2D } from '../utils/path-2d';","import Diamond from './diamond';\nconst backsqrt3 = 1/Math.sqrt(3)\n\n/**\n * 垂直钻石形单元\n * @constructor DiamondVertical\n * @param {Diamond~DiamondConfigs} configs - 配置\n * @extends Diamond\n */\nclass DiamondVertical extends Diamond {\n    constructor(configs) {\n        super(configs)\n    }\n\n    render(ctx) {\n        ctx.save();\n        if(this._isMoving){\n            ctx.globalAlpha = 0.6\n        }\n        ctx.beginPath();\n        const [x, y] = this.anchor;\n        const hw = this.width/2;\n        const hh = this.height/2;\n        const yy = hw / 1.732\n\n        const top = y - hh;\n        const bottom = y + hh;\n        const topmiddle = y - hh + yy;\n        const bottommiddle = y + hh - yy;\n        const xleft = x - hw;\n        const xright = x + hw;\n\n        ctx.moveTo(x, top);\n        ctx.lineTo(xright, topmiddle);\n        ctx.lineTo(xright, bottommiddle);\n        ctx.lineTo(x, bottom);\n        ctx.lineTo(xleft, bottommiddle);\n        ctx.lineTo(xleft, topmiddle);\n        ctx.closePath();\n        ctx.fillStyle = this.backgroundColor;\n        if (this.shadowColor) {\n            ctx.shadowColor = this.shadowColor;\n            ctx.shadowBlur = this.shadowBlur;\n            ctx.shadowOffsetX = this.shadowOffsetX;\n            ctx.shadowOffsetY = this.shadowOffsetY;\n        }\n        ctx.fill();\n        if(this.borderWidth) {\n            ctx.lineWidth = this.borderWidth;\n            ctx.strokeStyle = this.borderColor;\n            ctx.stroke();\n        }\n\n        ctx.restore();\n        this._cachePoints = [\n            [x, top],\n            [xright, topmiddle],\n            [xright, bottommiddle],\n            [x, bottom],\n            [xleft, bottommiddle],\n            [xleft, topmiddle]\n        ];\n    }\n}\nexport default DiamondVertical;","const packageJson = require('../package.json');\nimport { default as JFlow } from './core/flow'; \nexport default JFlow;\nexport * from './core/flow';\n// export { default as JFlowVuePlugin, JFlowLinkGroup } from './vue-plugin/JFlowPlugin.js';\nwindow.$jflow_version = packageJson.version;\n// console.log(`jflow version@${packageJson.version}`)"],"names":["createCanvas","wrapper","canvas","document","createElement","ctx","getContext","width","height","left","top","getBoundingClientRect","style","userSelect","scale","window","devicePixelRatio","Math","floor","position","overflow","append","raw_width","raw_height","caheCanvas","caheCanvasctx","requestCacheCanvas","render","clearRect","save","restore","listenOnDevicePixelRatio","callback","destroyHandler","target","matchMedia","onChange","console","log","removeEventListener","once","addEventListener","abs","cos","sin","acos","atan2","sqrt","pow","crt","v","pi","PI","tau","quart","nMax","Number","MAX_SAFE_INTEGER","nMin","MIN_SAFE_INTEGER","ZERO","x","y","z","utils","Tvalues","Cvalues","arcfn","t","derivativeFn","d","l","compute","points","_3d","order","length","mt","p","ret","a","b","c","mt2","t2","dCpts","JSON","parse","stringify","i","splice","computeWithRatios","ratios","r","f1","f2","f3","f4","derive","dpoints","list","dpt","j","push","between","m","M","approximately","precision","len","sum","map","ds","de","ts","te","lerp","v1","v2","undefined","pointToString","s","pointsToString","join","copy","obj","angle","o","dx1","dy1","dx2","dy2","round","pos","indexOf","parseFloat","substring","dist","p1","p2","dx","dy","closest","LUT","point","mpos","mdist","forEach","idx","abcratio","n","bottom","projectionratio","lli8","x1","y1","x2","y2","x3","y3","x4","y4","lli4","p3","p4","lli","makeline","Bezier","findbbox","sections","mx","my","MX","MY","bbox","min","max","mid","size","shapeintersections","s1","bbox1","s2","bbox2","curveIntersectionThreshold","bboxoverlap","intersections","a1","startcap","forward","back","endcap","a2","l1","virtual","l2","iss","intersects","c1","c2","makeshape","bpl","fpl","start","end","shape","getminmax","curve","concat","get","align","line","tx","ty","roots","aligned","reduce","m1","m2","filter","pa","pb","pc","q","q2","discriminant","u1","mp3","phi","t1","sd","droots","curvature","d1","d2","kOnly","num","dnm","adk","dk","k","dd","qdsum","pk","nk","inflections","slice","v3","trm","sq","b1","b2","dims","dim","expandbox","_bbox","pairiteration","c1b","c2b","threshold","_t1","_t2","cc1","split","cc2","pairs","right","pair","results","getccenter","dx1p","dy1p","dx2p","dy2p","mx1","my1","mx2","my2","mx1n","my1n","mx2n","my2n","arc","_","e","numberSort","PolyBezier","constructor","curves","this","valueOf","toString","addCurve","offset","coords","args","Array","from","arguments","coordlen","newargs","higher","Error","step","dimlen","_linear","some","_lut","update","static","abc","getABC","A","S","B","E","C","selen","lx","ly","bx1","by1","bx2","by2","e1","e2","nc1","nc2","getUtils","toSVG","last","setRatios","verify","print","coordDigest","_print","computedirection","clockwise","derivative","bind","u","um","getLUT","steps","on","error","lut","hits","project","ft","raise","np","pim","dderivative","normal","__normal3","__normal2","r1","r2","q1","R","hull","_p","pt","result","span","extrema","mfn","sort","values","overlaps","lbbox","tbbox","nv","simple","n1","n2","segment","pass1","pass2","distanceFn","ov","rc","outline","d3","d4","reduced","fcurves","bcurves","alen","tlen","graduated","linearDistanceFunction","slen","reverse","fs","fe","bs","be","ls","le","segments","outlineshapes","shapes","lineIntersects","curveintersects","selfintersects","arcs","errorThreshold","_iterate","_error","np1","ref","circles","safety","t_s","t_e","np2","np3","prev_arc","done","curr_good","prev_good","t_m","prev_e","interval","DIRECTION","RIGHT","BOTTOM","LEFT","TOP","SELF","JFLOW_MODE","DEFAULT","LINKING","bounding_box","min_x","Infinity","min_y","max_x","max_y","item","sqr","dist2","w","distToSegmentSquared","minIntersectionBetweenNodes","dmsfrom","dmsto","meta","fromDir","fromP","toDir","toP","distMin","Object","keys","df","pf","dt","assign","_resolveControlPoint","dir","spanx","spany","bezierPoints","start_dir","end_dir","minSpanX","minSpanY","cp1","cp2","arrowspan","includes","isVerticalEnd","getBezierAngle","sx","sy","cp1x","cp1y","cp2x","cp2y","ex","ey","polylinePoints","isSelf","dirSpan","isVerticalStart","yp","xp","pmiddle","unshift","minusVec","absVec","vec","scaleVec","doOverlap","rec1","rec2","compareBoundingbox","copyBoundingbox","ishitKey","Symbol","isInViewBox","Instance","EventTarget","configs","super","visible","_belongs","borderWidth","borderColor","backgroundColor","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","opacity","_boundingrect","_isTargeting","_jflow","_target","instance","link","_isMoving","_getMovingTarget","status","movingState","_isHit","uniqueName","ishit","dispatchEvent","CustomEvent","detail","jflow","_isInViewBox","val","onEnterViewbox","onLeaveViewbox","setConfig","isHit","getBoundingRect","calculateIntersection","getIntersectionsInFourDimension","getCenter","anchor","getBoundingDimension","rect","bubbleEvent","customEvent","currentTarget","bubbles","calculateToRealWorld","calculateToRealWorldWithScalar","recalculateUp","belongs","destroy","Node","_rawConfigs","absolutePosition","setAnchorX","setAnchorY","setAnchor","beforeRender","_getViewBox","clone","GhostNode","NodeWeakMap","_map","WeakMap","source","set","layoutNode","jflowNode","jflowlinks","jflowFromLinks","jflowToLinks","has","delete","clear","NodeWeakMapMixin","initNodeWeakMap","source_Layout_Render_NodeMap","getRenderNodeBySource","mapping","getLayoutNodeBySource","getSourceRenderMeta","_getMap","setLayoutNodeBySource","setRenderNodeBySource","addLinkNodeBySource","sourceFrom","sourceTo","removeLinkNodeBySource","findIndex","InstanceStack","_currentHit","condition","movingTarget","resetHitStatus","_stack","checkHit","currentConstraint","ignoreHit","getBoundingRectPoints","getAnchorRectPoints","StackMixin","instances","links","_linkStack","initStack","data","addToStack","replaceFromStack","index","addToLinkStack","removeFromStack","removeFromLinkStack","emptyLink","resetChildrenPosition","addInstanceToLink","targetLink","to","_constuctor","__proto__","interateNodeStack","LayoutMixin","_layout","initLayout","layout","dirty","wold","hold","_getBoundingGroupRect","reflow","wnow","hnow","recalculate","staticCheck","MessageMixin","_message","sendMessage","msg","consumeMessage","readMessage","AnimeMixin","initAnime","anime_queue","__animeClock__","requestJFlowAnime","frameCallBack","enqueueAnime","_runAnime","animeMeta","cancel","_cancelAnime","_render","runAnime","requestAnimationFrame","scheduleRender","runAnimeFrame","timestamp","Date","now","elapsed","MiniMapMixin","captureMap","padding","placement","p_width","p_height","p_x","p_y","miniMap","_renderMap","pressDown","event","offsetX","offsetY","deltaX","deltaY","_onMoveMap","cacheMinimapCtx","pad2","pad","m_x","m_y","cachectx","setTransform","transform","br","NodeRenderTop","_cacheMapImageData","getImageData","putImageData","beginPath","clip","fillStyle","fillRect","_recalculatePosition","ScrollBar","barWidth","barMarginX","barMarginY","plainColor","focusColor","isFocus","radius","cy","by","lc","moveTo","lineTo","closePath","tc","bc","cx","rx","fill","h","ScrollBarMixin","initScrollBar","barColor","barFocusColor","_scrollbarEnable","_scrollbarX","_scrollbarY","_scrollBarStatus","dragging","xscale","yscale","barInitX","barInitY","scrollBarOnPanAndZoom","clientX","clientY","onScrollbarPressStart","checkScrollDragging","barStartX","barStartY","f","onDraggingScrollbar","scollbarHeight","scollbarWidth","realR","realL","realT","realB","actual_width","actual_height","canvasMeta","xnew","ynew","checkScrollBarHover","cursor","resetScrollBarHover","_getScrollViewBoundingbox","vw","vh","anchorX","anchorY","resetScollBarStatus","renderScrollBar","dpr","ScheduleMixin","initSchedule","__clock__","__render","JFlowEvent","originEvent","EventAdapter","plugin","_mouseStatus","pointerDown","wheel","preventDefault","ctrlKey","zoomHandler","panHandler","pointerdown","button","pressStartHandler","pointermove","pressMoveHandler","pointerup","pressUpHanlder","contextmenu","stopPropagation","contextMenuHanlder","dblclick","dblclickHandler","click","clickHanlder","getDefaultPlugin","use","canvasHandlers","documentHandlers","ca","docObj","eventName","hasOwnProperty","apply","handler","handlerWrapperd","options","unload","GroupMixin","_setPadding","paddingTop","paddingRight","paddingBottom","paddingLeft","_setMargin","margin","marginTop","marginRight","marginBottom","marginLeft","_getCenter","centerX","centerY","_shape","_calculatePointBack","gx","gy","_calculatePointBackWithPoint","arr","idx1","idx2","calculateToCoordination","ltx","lty","rbx","rby","vecx","vecy","theta1","theta2","dirx","diry","defaultShift","GroupFactory","jflowNodeConstructor","shapeShift","definedWidth","minWidth","definedHeight","lock","display","transparent","_cacheViewBox","prototype","call","shapeWidth","shapeHeight","paddingWidth","paddingHeight","_paddingWidth","_paddingHeight","belongs_vbox","getCacheViewBox","cacheViewBox","globalAlpha","translate","_currentp","Point","type","_doCache","lineWidth","strokeStyle","stroke","ratio","calculateIntersectionInFourDimension","allIntersections","interDir","Rectangle","borderRadius","_setBorder","border","color","enable","xt","yt","quadraticCurveTo","switchPath","Path2D","topPath","Capsule","hw","hh","leftCenter","rightCenter","ww","rr","CapsuleVertical","topCenter","bottomCenter","yy","Rhombus","diagonalsV","diagonalsH","center","Diamond","side","sinSIDE","cosSIDE","xx","_cachePoints","polygon","odd","InnerScrollBar","setHit","onHit","ScrollGroup","maxWidth","maxHeight","_offset","_resetOffset","_f","hitScrollX","hitScrollY","JFLOW","_scrollWidth","_outerWidth","ratioInX","_innerWidth","_scrollHeight","_outerHeight","_innerHeight","outerWidth","outerHeight","w2","h2","sp","commonAdapter","BaseLink","viewbox","bringToTop","linkStack","ShadowCache","imageBuffer","cache","drawImage","TEXT_ALIGN","Text","content","fontFamily","fontSize","fontWeight","textColor","placeholderColor","textAlign","textBaseline","lineHeight","indent","editable","ellipsis","placeholder","emptyWhenInput","editting","disabled","cursorColor","textRangeColor","_status","editing","cursorshow","cursoranime","lastElapsed","refreshElapsed","cursorDragging","shiftOn","oldVal","inputElement","_cursorOffset","_textRange","rangefrom","rangeTo","initialRange","_makeFunctional","preCalculateText","shadowCache","currentContent","isEmpty","font","t_h","parseInt","fontBoundingBoxAscent","fontBoundingBoxDescent","measureText","_textWidth","_calculateOffset","ellipsisContent","_textHeight","_shadowCache","fillText","flag","_positionToCursorOffset","controlCallback","defaultCallback","input","setAttribute","stopInput","ctrlOn","value","key","code","createInputElement","_controlCallback","_defaultCallback","DOMwrapper","focus","preventScroll","setFocusInstance","syncShadowInputPosition","blurHandler","remove","_selectFullRange","_refreshCursor","moved","ox","cursorOffset","offx","maxL","contentWidth","allwidth","g1","g2","lastidx","w1","spanw","disableCache","textheight","cw","c_len","range","_inputControl","op","_clearTextRange","refresh","afterContent","preContent","cacheIdx","stopInputEvent","defaultAct","blur","px","_onArrowLeft","_onArrowRight","_onShiftToggle","_copy","_cut","_paste","_getSelection","selection","clipboardData","setData","pasteContent","getData","resolvePasteContent","rawEvent","_focus","Icon","image","onload","imageBounding","imageWidth","imageHeight","complete","ShadowDom","domFactory","createDocument","_dom","getRealWorldPosition","container","appendChild","removeChild","Link","lineDash","approximate","_cacheAngle","_cacheBoundingbox","_calculateAnchorPoints","p0","frombox","tobox","_box","actualBoundingBoxLeft","actualBoundingBoxRight","region","ry","rw","rh","setLineDash","rotate","PIINRATIO","PolyLink","doubleLink","noArrow","_static","polyline","l0","r0","cp","isPolyLineIntersectionRectange","pEnd","angleEnd","beginAngle","pLast","pNext","pbefore","pnext","vec1","vec2","absVec1","absVec2","makeRadiusFromVector","lastP","remainPoints","currentP","shift","cloneStatic","BezierLink","bezierCurveTo","hasFlip","P","bezierPoint","distToBezierSegmentSquared","LinearLayout","direction","gap","alignment","justify","group","stack","absoluteStack","groupWidth","reduceHeight","lastInstanceHeight","allHeight","childAll","reduceWidth","lastInstanceWidth","allWidth","withdraw","gapAverage","WIDTH","HEIGHT","shifty","shiftx","_resolveAbsoluteAnchor","config","BaseNode","id","level","sequence","isFree","parent","parentIterateType","hasEndPoint","reflowPreCalculate","spanX","spanY","makeLink","makeEndpoint","traverse","getNodes","nodes","renderNode","linkSource","TYPE_MAPPING","IfStatement","consequent","mapFunc","alternate","isLocked","c_spanX","c_spanY","a_spanX","a_spanY","nextSequeence","Endpoint","lastc","part","lasta","linkMeta","SwitchStatement","cases","lastCase","cc","s_spanX","s_spanY","SwitchCase","ForEachStatement","WhileStatement","body","anticlock","Root","isroot","playgrounditerator","playground","reflowBodyPreCalculate","reflowPlaygroundPreCalculate","preCallback","node","other","makeAST","__endpoint__","LowcodeLayout","linkLength","treeItemDraggable","reOrder","ast","flowStack","flowLinkStack","root","isDraggable","layoutMapping","vertical","horizontal","playgroundLayoutMapping","currentTopNodeId","topNode","_layoutNode","find","nowAnchor","currentAnchor","reflowByMapping","verticalMapping","horizontalMapping","columnNumber","column","rowWidth","rows","rowNumber","row","rowHeight","columns","findLayoutNode","finded","layoutMeta","ERProperty","isNavigation","association","name","_selfLink","parentPropertyRef","getJflowInstance","doubleRef","ERNode","propertyList","navigationPropertyList","idProperty","_traverseProperty","nodeMap","property","idRef","isParentRef","parentRef","objectRef","targetProperty","toProperty","isObjectRef","ERLayout","erNodes","entityRelationship","er","makeER","idMap","id1","id2","fromMeta","lineMapping","computeNodeAnchor","recorded","relativeAnchor","diagramWeight","nx","ny","EDITOR_EVENTS","KEYBOARD_INPUT","KEYBOARD_COMMANDS","MOUSE_COMMANDS","ShadowInput","_inputElement","kind","syncPosition","Caret","_row","_column","show","anime","setRow","setColumn","columnoridx","getRow","getColumn","animate","cancelAnimate","isShow","toRange","fromRange","Area","_lines","getLineAbove","lines","truncate","Line","create","_elements","insert","elem","tail","getColumnNearest","elementSpace","elements","elem_idx","last_c","_c","lastel","el","textmeta","calculateOffsetByWidth","FlattenTextElements","_e","_textElements","_records","_caretRecord","insertBefore","inersetAt","insertAfter","setNeedWrap","needWrap","isTail","removed","startRecord","before","after","getRecord","recordBeforeCaret","caret","recordAfterCaret","getCaretRecord","collectRecords","TextElement","setSource","records","lastSource","lastWrap","nextOffset","tailOffset","headOffset","Range","_enable","_rangeFrom","_rangeTo","_initialRange","setInitialRange","getRangeFrom","getRangeTo","isEnable","disable","handleCaret","setRange","another","_compareRange","editor","area","_area","_caret","rangeFrom","elemFrom","elemTo","flattenTxtElem","_flattenTxtElem","preElement","afterElement","fromIdx","toIdx","endTextNeedWrap","isSetSourceBatch","UndoRedo","_undo","_redo","_editor","write","caretRecord","lastUndo","getLastUndo","_batch","_caretMetaTo","BatchAction","_caretMetaFrom","undo","pop","redo","SKIP_REDO","batch","updateCaretMetaTo","action","_range","Command","exec","ArrowLeftCommand","elemidx","element","preRow","preElemidx","ArrowRightCommand","afterRow","ArrowUpCommand","nextRow","_handler","ArrowDownCommand","_mixin","currElem","currElemReduceWidth","measureTextWidth","nextColumn","_blandAdjacentElement","elem1","elem2","defaultOffset","Input","undoredo","_undoredo","preElem","newElement","test","replace","curElem","_t","deleteop","nextElem","StartEditCommand","_startEdit","moveCaretByHitPoint","createShadowInput","EditClickCommand","DoubleClickCommand","ShiftUpCommand","toggleShift","ShiftDownCommand","ShiftOnClickCommand","CtrlACommand","UndoCommand","RedoCommand","TextGroup","currentLineHeight","_shadowInput","lineSpace","resolver","dragover","commands","Map","registCommand","cmd","execCommand","commnd","textElements","onDrop","lastLength","refreshTextElements","_caretToPosition","_randerCursor","_renderRange","blockheight","blockwidth","r_f","idx_f","offset_f","r_t","idx_t","offset_t","space","_measureElementOffsetX","_r","beginning","lastElem","validInstance","nextArea","lastReduceY","reduceX","doubleMargin","css","head","getElementsByTagName","styleSheet","cssText","createTextNode","createInputTextStyle","Group","CapsuleGroup","RhombusGroup","DiamondGroup","DiamondVerticalGroup","topmiddle","bottommiddle","xleft","xright","CapsuleVerticalGroup","PointGroup","ceil","JFlow","eventAdapter","initialZoom","initialPosition","setInitialPosition","maxZoom","minZoom","worldMargin","draggingbehavior","panInBorder","deltamovement","allowMovingTargetInPan","scrollBarBehavior","offeset","_lastState","processing","_lastDragState","moving","isInstanceDirty","isLinkDirty","initialX","initialY","dragovering","_dragOverTarget","allowDrop","_tempNode","_tempLink","mode","_allowMovingTarget","setMovingTargets","targets","setTempDraggingInstance","removeTempDraggingInstance","preventDefaultDragging","allowDefaultDragging","$mount","dom","c_width","c_height","$jflow","contentBox","w_ratio","h_ratio","scaleRatio","realboxX","realboxY","realboxW","realboxH","_readyToRender","_createEventHandler","resizeCanvas","destroyDprListener","setLinkingMode","linkGen","isInLinkingMode","setLinkingLink","resetLinkingLink","clearTemp","preventClearTemp","_preventClearTemp","focusOn","nowx","nowy","destroyListener","destroyPlainEventListener","dragoverHandler","_onDragover","dropHandler","_onDrop","dragleaveHanlder","_onDragLeave","_targetLockOn","offsetPoint","topLayerPoint","movingtarget","ON_TOP","relatedTarget","_processDragOver","_dragCurrentData","oldIns","_processPanInBorder","timer","py","__processOverAnime","Promise","resolve","then","_cancelPanInBorder","cancelDrop","_zooming","ch","newScale","deltaScale","currentWidth","currentHeight","deltaWidth","deltaHeight","pX","pY","_panning","_resolveLockOnTarget","_preventPressSequeence","_clearTarget","isDocument","payload","_preventDefault","checkresult","_calculateDistance","_resetTransform","resetTransform","setNodeToTopLayer","packageJson","require","$jflow_version","version"],"mappings":"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"}